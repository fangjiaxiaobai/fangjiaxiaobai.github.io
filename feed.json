{
    "version": "https://jsonfeed.org/version/1",
    "title": "æ–¹å®¶å°ç™½",
    "description": "å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±",
    "home_page_url": "https://fangjiaxiaobai.github.io",
    "items": [
        {
            "id": "https://fangjiaxiaobai.github.io/2024/07/09/efficient-work-happy-life/ewhl-01-iterm/",
            "url": "https://fangjiaxiaobai.github.io/2024/07/09/efficient-work-happy-life/ewhl-01-iterm/",
            "title": "Iterm æ›´æ‡‚ä½ ",
            "date_published": "2024-07-09T10:18:18.000Z",
            "content_html": "<h1 id=\"zshrc\"><a class=\"markdownIt-Anchor\" href=\"#zshrc\">#</a> zshrc</h1>\n<p>åŸå†…å®¹æ¥è‡ª <code>git</code> :  <code>https://github.com/Innei/zshrc/tree/renovate/configure</code> .</p>\n<h3 id=\"ä½¿ç”¨æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨æ–¹æ³•\">#</a> ä½¿ç”¨æ–¹æ³•</h3>\n<p>æ‰§è¡Œ init.zsh å³å¯ã€‚</p>\n<h3 id=\"æ•ˆæœå±•ç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æ•ˆæœå±•ç¤º\">#</a> æ•ˆæœå±•ç¤º</h3>\n<ul>\n<li>æ™®é€šç›®å½•</li>\n</ul>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/ewhl/iterm/normal-images.png\" alt=\"\"></p>\n<ul>\n<li><code>git</code>  ä»“åº“ç›®å½•ä¸‹</li>\n</ul>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/ewhl/iterm/git-image.png\" alt=\"\"></p>\n<h3 id=\"å‘¨è¾¹\"><a class=\"markdownIt-Anchor\" href=\"#å‘¨è¾¹\">#</a> å‘¨è¾¹</h3>\n<p><code>theme</code>  æ–‡ä»¶å¤¹ä¸‹æä¾›äº†ç»ˆç«¯çš„é…è‰²</p>\n<p><code>font</code>  æ–‡ä»¶å¤¹ä¸‹æä¾›äº†æˆ‘ä½¿ç”¨çš„ç­‰å®½å­—ä½“ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "é«˜æ•ˆå·¥ä½œ,å¿«ä¹ç”Ÿæ´»"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2024/07/09/efficient-work-happy-life/ewlh-02-vim/",
            "url": "https://fangjiaxiaobai.github.io/2024/07/09/efficient-work-happy-life/ewlh-02-vim/",
            "title": "å¦‚ä½•ä½¿ç”¨vimæˆç¥",
            "date_published": "2024-07-09T10:18:18.000Z",
            "content_html": "<h2 id=\"å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨\"><a class=\"markdownIt-Anchor\" href=\"#å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨\">#</a> å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨</h2>\n<p>ğŸº ä½¿ç”¨æ­¥éª¤</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">git clone -b how-to-use-vim-make-you-god https://gitee.com/fangjiaxiaobai/efficient-work-happy-life.git</span><br><span class=\"line\"></span><br><span class=\"line\">cd efficient-work-happy-life</span><br><span class=\"line\"></span><br><span class=\"line\">bash setup.sh</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>ğŸº æ•ˆæœå±•ç¤º</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/ewhl/vim/show.png\" alt=\"\"></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "é«˜æ•ˆå·¥ä½œ,å¿«ä¹ç”Ÿæ´»"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2024/06/27/mp4/about-gpu/",
            "url": "https://fangjiaxiaobai.github.io/2024/06/27/mp4/about-gpu/",
            "title": "ä»é›¶å¼€å§‹è®¤è¯†æ˜¾å¡",
            "date_published": "2024-06-27T10:18:18.000Z",
            "content_html": "<p>æœ¬æ–‡ä¸­è§†é¢‘æ¥è‡ª  <code>YouTube</code> . <span class=\"red\">ä¾µåˆ ï½ï½ï½ï½</span>  <span class=\"rainbow\">æ–‡ç« åº•éƒ¨å…¬ä¼—å·å³å¯æ‰¾åˆ°æˆ‘ï½</span></p>\n\n\n<div style=\"position: relative; width: 100%; height: 800;\">\n<iframe width=\"100%\" height=\"800\" src=\"https://www.youtube.com/embed/vtR7cgYATdk?si=SQ_jqT1Xry8e9uVa\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>\n</div> \n\n\n<p><span class=\"grey\">è§†é¢‘æ‰“ä¸å¼€ï¼Ÿï¼Ÿï¼Ÿï½</span>  <span class=\"rainbow\">æ–‡ç« åº•éƒ¨å…¬ä¼—å·å³å¯æ‰¾åˆ°æˆ‘ï½</span></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "youtube",
                "gpu"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2024/06/27/mp4/c++/",
            "url": "https://fangjiaxiaobai.github.io/2024/06/27/mp4/c++/",
            "title": "C++ é€šå…³",
            "date_published": "2024-06-27T10:18:18.000Z",
            "content_html": "<p>æœ¬æ–‡ä¸­è§†é¢‘æ¥è‡ª  <code>Bç«™</code> . <span class=\"red\">ä¾µåˆ ï½ï½ï½ï½</span>  <span class=\"rainbow\">æ–‡ç« åº•éƒ¨å…¬ä¼—å·å³å¯æ‰¾åˆ°æˆ‘ï½</span></p>\n\n\n<div style=\"position: relative; width: 100%; height: 800;\">\n<iframe src=\"//player.bilibili.com/player.html?isOutside=true&aid=1054210319&bvid=BV1ZH4y137ws&cid=1596673947&p=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"></iframe>\n</div> \n\n\n<p><span class=\"grey\">è§†é¢‘æ‰“ä¸å¼€ï¼Ÿï¼Ÿï¼Ÿï½</span>  <span class=\"rainbow\">æ–‡ç« åº•éƒ¨å…¬ä¼—å·å³å¯æ‰¾åˆ°æˆ‘ï½</span></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "gpu",
                "BiliBili"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2024/03/18/dataStructuresAndAlgorithms/huffman/huffman/",
            "url": "https://fangjiaxiaobai.github.io/2024/03/18/dataStructuresAndAlgorithms/huffman/huffman/",
            "title": "æ·±å…¥è§£æ Huffman ç¼–ç ï¼šåŸç†ä¸åº”ç”¨",
            "date_published": "2024-03-18T10:18:18.000Z",
            "content_html": "<p><code>Huffman</code>  ç¼–ç ï¼Œä½œä¸ºä¸€ç§é«˜æ•ˆçš„å‰ç¼€ç¼–ç æ–¹å¼ï¼Œç”±ç¾å›½è®¡ç®—æœºç§‘å­¦å®¶ <code>æˆ´ç»´Â·AÂ·å“ˆå¤«æ›¼</code> äº 1952 å¹´æå‡ºã€‚å®ƒåœ¨æ•°æ®å‹ç¼©é¢†åŸŸå…·æœ‰é‡è¦åœ°ä½ï¼Œå°¤å…¶é€‚ç”¨äºæ–‡æœ¬ã€éŸ³é¢‘ã€è§†é¢‘ç­‰æ•°æ®çš„å‹ç¼©å¤„ç†ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿæ ¹æ®å­—ç¬¦å‡ºç°é¢‘ç‡åŠ¨æ€ç”Ÿæˆæœ€ä¼˜çš„ç¼–ç æ–¹æ¡ˆã€‚</p>\n<h1 id=\"huffmanç¼–ç åŸç†\"><a class=\"markdownIt-Anchor\" href=\"#huffmanç¼–ç åŸç†\">#</a>  <code>Huffman</code>  ç¼–ç åŸç†</h1>\n<p><code>Huffman</code>  ç¼–ç çš„åŸºæœ¬æ€æƒ³æ˜¯åŸºäºå­—ç¬¦å‡ºç°çš„é¢‘ç‡æ¥æ„é€ ä¸€ç§å˜é•¿ç¼–ç ã€‚å¯¹äºå‡ºç°é¢‘ç‡é«˜çš„å­—ç¬¦ï¼Œèµ‹äºˆè¾ƒçŸ­çš„ç¼–ç ï¼›åä¹‹ï¼Œå¯¹å‡ºç°é¢‘ç‡ä½çš„å­—ç¬¦èµ‹äºˆè¾ƒé•¿çš„ç¼–ç ã€‚è¿™ç§ç­–ç•¥ç¡®ä¿äº†æ•´ä½“ç¼–ç é•¿åº¦æœ€å°åŒ–ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„æ•°æ®å‹ç¼©ã€‚<br>\nå…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>è®¡ç®—æ¯ä¸ªå­—ç¬¦çš„å‡ºç°é¢‘ç‡ã€‚</li>\n<li>å°†æ¯ä¸ªå­—ç¬¦åŠå¯¹åº”çš„é¢‘ç‡è§†ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ„å»ºä¸€é¢—èµ«å¤«æ›¼æ ‘ï¼ˆ <code>Huffman Tree</code> ï¼‰ã€‚é€šè¿‡ä¸æ–­åˆå¹¶é¢‘ç‡æœ€ä½çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°æ ‘ä¸­åªå‰©ä¸‹ä¸€ä¸ªæ ¹èŠ‚ç‚¹ä¸ºæ­¢ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¿è¯äº†é¢‘ç‡è¶Šé«˜çš„å­—ç¬¦å…¶è·¯å¾„é•¿åº¦è¶ŠçŸ­ã€‚</li>\n<li>ä»æ ¹èŠ‚ç‚¹åˆ°æ¯ä¸ªå­—ç¬¦èŠ‚ç‚¹çš„è·¯å¾„æ‰€ç»è¿‡çš„ â€œå·¦â€ã€â€œå³â€ åˆ†æ”¯å®šä¹‰äº†è¯¥å­—ç¬¦çš„äºŒè¿›åˆ¶ç¼–ç ï¼Œé¢‘ç‡è¾ƒé«˜çš„å­—ç¬¦å¯¹åº”è¾ƒçŸ­çš„ç¼–ç ã€‚</li>\n</ul>\n<h1 id=\"ä»£ç å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç å®ç°\">#</a> ä»£ç å®ç°</h1>\n<h2 id=\"huffmanh\"><a class=\"markdownIt-Anchor\" href=\"#huffmanh\">#</a> huffman.h</h2>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> HFTREE_H</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> HFTREE_H</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unordered_map&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * huffmanæ ‘çš„èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    std::string character; <span class=\"comment\">//å­—ç¬¦ä¸²(å­—ç¬¦orå­—ç¬¦ç»„åˆ)</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> freq;  <span class=\"comment\">//é¢‘ç‡</span></span><br><span class=\"line\">    Node *left;  <span class=\"comment\">//å·¦å­æ ‘</span></span><br><span class=\"line\">    Node *right; <span class=\"comment\">// å·¦å­æ ‘</span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> isLeaf; <span class=\"comment\">// æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">Node</span>(std::string ch, <span class=\"keyword\">int</span> freg);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">Node</span>(std::string ch, <span class=\"keyword\">int</span> freg, <span class=\"keyword\">bool</span> isLeaf);</span><br><span class=\"line\"></span><br><span class=\"line\">    ~<span class=\"built_in\">Node</span>();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ç”¨äºå…¥å †æ—¶çš„æ’åº</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Compare</span> &#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">operator</span><span class=\"params\">()</span><span class=\"params\">(Node *a, Node *b)</span></span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">hfTree</span> &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">encode</span><span class=\"params\">()</span></span>; <span class=\"comment\">// huffmanç¼–ç æ‰§è¡Œå…¥å£</span></span><br><span class=\"line\"></span><br><span class=\"line\">    std::string text;</span><br><span class=\"line\">    Node *root;</span><br><span class=\"line\">    std::unordered_map&lt;std::string, <span class=\"keyword\">int</span>&gt; frequencyMap;  <span class=\"comment\">// å„å­—ç¬¦(ç»„åˆ)çš„é¢‘ç‡è¡¨</span></span><br><span class=\"line\">    std::map&lt;std::string, std::string&gt; huffmanCodeMap;  <span class=\"comment\">// ç¼–ç è¡¨</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">calculateFrequency</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">buildHuffmanTree</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">generateCodes</span><span class=\"params\">(Node *node, <span class=\"keyword\">const</span> std::string &amp;str)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">deleteTree</span><span class=\"params\">(Node *node)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"keyword\">class</span> <span class=\"title\">Option</span> &#123;</span></span><br><span class=\"line\">        SingleChar,</span><br><span class=\"line\">        MultiChar</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    Option op;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">hfTree</span>(<span class=\"keyword\">const</span> std::string &amp;text, Option op);</span><br><span class=\"line\"></span><br><span class=\"line\">    ~<span class=\"built_in\">hfTree</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">std::string <span class=\"title\">getEncodedText</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">std::map&lt;std::string, std::string&gt; <span class=\"title\">getCodingTable</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"huffmancpp\"><a class=\"markdownIt-Anchor\" href=\"#huffmancpp\">#</a> huffman.cpp</h2>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;hftree.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unordered_map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;queue&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> DEBUG 1</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> INFO 2</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> OFF 3</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> LOG_LEVEL OFF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">contains</span><span class=\"params\">(std::vector&lt;std::string&gt; container, std::string v)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> it = std::<span class=\"built_in\">find</span>(container.<span class=\"built_in\">begin</span>(), container.<span class=\"built_in\">end</span>(), v);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (it != container.<span class=\"built_in\">end</span>()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Node æ„é€ å‡½æ•°</span></span><br><span class=\"line\"><span class=\"comment\"> * @param ch å­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\"> * @param freq é¢‘ç‡</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Node::<span class=\"built_in\">Node</span>(std::string ch, <span class=\"keyword\">int</span> freq) : <span class=\"built_in\">character</span>(ch), <span class=\"built_in\">freq</span>(freq), <span class=\"built_in\">left</span>(<span class=\"literal\">nullptr</span>), <span class=\"built_in\">right</span>(<span class=\"literal\">nullptr</span>), <span class=\"built_in\">isLeaf</span>(<span class=\"literal\">false</span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Node æ„é€ å‡½æ•°</span></span><br><span class=\"line\"><span class=\"comment\"> * @param ch å­—ç¬¦</span></span><br><span class=\"line\"><span class=\"comment\"> * @param freq é¢‘ç‡</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Node::<span class=\"built_in\">Node</span>(std::string ch, <span class=\"keyword\">int</span> freq, <span class=\"keyword\">bool</span> isLeaf) : <span class=\"built_in\">character</span>(ch), <span class=\"built_in\">freq</span>(freq), <span class=\"built_in\">left</span>(<span class=\"literal\">nullptr</span>), <span class=\"built_in\">right</span>(<span class=\"literal\">nullptr</span>), <span class=\"built_in\">isLeaf</span>(isLeaf) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Node ææ„å‡½æ•°</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">Node::~<span class=\"built_in\">Node</span>() &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">Compare::operator</span><span class=\"params\">()</span><span class=\"params\">(Node *a, Node *b)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (a-&gt;freq == b-&gt;freq) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a-&gt;character &gt; b-&gt;character;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a-&gt;freq &gt; b-&gt;freq;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">hfTree::<span class=\"built_in\">hfTree</span>(<span class=\"keyword\">const</span> std::string &amp;text, Option op) : <span class=\"built_in\">op</span>(op), <span class=\"built_in\">root</span>(<span class=\"literal\">nullptr</span>), <span class=\"built_in\">text</span>(text) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">encode</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">hfTree::~<span class=\"built_in\">hfTree</span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">deleteTree</span>(root);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">hfTree::deleteTree</span><span class=\"params\">(Node *node)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node == <span class=\"literal\">nullptr</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"built_in\">deleteTree</span>(node-&gt;left);</span><br><span class=\"line\">    <span class=\"built_in\">deleteTree</span>(node-&gt;right);</span><br><span class=\"line\">    <span class=\"keyword\">delete</span> node;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">hfTree::calculateFrequency</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (op == Option::SingleChar) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">char</span> ch: text) &#123;</span><br><span class=\"line\">            <span class=\"function\">std::string <span class=\"title\">key</span><span class=\"params\">(<span class=\"number\">1</span>, ch)</span></span>;</span><br><span class=\"line\">            frequencyMap[key]++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        std::map&lt;std::string, <span class=\"keyword\">int</span>&gt; tempFrequencyMap;</span><br><span class=\"line\">        std::vector&lt;std::string&gt; orderHfNodes;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; text.<span class=\"built_in\">length</span>(); i++) &#123;</span><br><span class=\"line\">            <span class=\"function\">std::string <span class=\"title\">key</span><span class=\"params\">(<span class=\"number\">1</span>, text[i])</span></span>;</span><br><span class=\"line\">            frequencyMap[key]++;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i + <span class=\"number\">1</span> &lt; text.<span class=\"built_in\">length</span>()) &#123;</span><br><span class=\"line\">                key += text[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">                tempFrequencyMap[key]++;</span><br><span class=\"line\">                orderHfNodes.<span class=\"built_in\">push_back</span>(key);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// é€‰æ‹©é¢‘ç‡æœ€é«˜çš„å‰ä¸‰ä¸ªå­—ç¬¦ç»„åˆ</span></span><br><span class=\"line\">        std::vector&lt;std::pair&lt;std::string, <span class=\"keyword\">int</span>&gt;&gt; <span class=\"built_in\">vec</span>(tempFrequencyMap.<span class=\"built_in\">begin</span>(), tempFrequencyMap.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        std::<span class=\"built_in\">sort</span>(vec.<span class=\"built_in\">begin</span>(), vec.<span class=\"built_in\">end</span>(), [](<span class=\"keyword\">const</span> <span class=\"keyword\">auto</span> &amp;a, <span class=\"keyword\">const</span> <span class=\"keyword\">auto</span> &amp;b) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a.second &gt; b.second || (a.second == b.second &amp;&amp; a.first &lt; b.first);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœå­—ç¬¦ç»„åˆä¸è¶³ä¸‰ä¸ªï¼Œåˆ™å…¨éƒ¨é€‰æ‹©</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> topComboCount = std::<span class=\"built_in\">min</span>(<span class=\"number\">3</span>, <span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&gt;(vec.<span class=\"built_in\">size</span>()));</span><br><span class=\"line\"></span><br><span class=\"line\">        std::vector&lt;std::string&gt; top3;</span><br><span class=\"line\">        <span class=\"comment\">// æ›´æ–°å•å­—ç¬¦é¢‘ç‡è¡¨ï¼Œå‡å»ç»„åˆä¸­å­—ç¬¦çš„é¢‘ç‡</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; topComboCount; ++i) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å°†å‰ä¸‰ä¸ªå­—ç¬¦ç»„åˆæ·»åŠ åˆ°é¢‘ç‡è¡¨ä¸­</span></span><br><span class=\"line\">            frequencyMap[vec[i].first] = vec[i].second;</span><br><span class=\"line\">            top3.<span class=\"built_in\">push_back</span>(vec[i].first);</span><br><span class=\"line\">            <span class=\"comment\">// å‡å»ç»„åˆä¸­çš„å•ä¸ªå­—ç¬¦çš„é¢‘ç‡</span></span><br><span class=\"line\">            frequencyMap[std::<span class=\"built_in\">string</span>(<span class=\"number\">1</span>, vec[i].first[<span class=\"number\">0</span>])] -= vec[i].second;</span><br><span class=\"line\">            frequencyMap[std::<span class=\"built_in\">string</span>(<span class=\"number\">1</span>, vec[i].first[<span class=\"number\">1</span>])] -= vec[i].second;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (; i &lt; orderHfNodes.<span class=\"built_in\">size</span>() - <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">contains</span>(top3, orderHfNodes[i]) &amp;&amp;</span><br><span class=\"line\">                <span class=\"built_in\">contains</span>(top3, orderHfNodes[i + <span class=\"number\">1</span>])) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"built_in\">contains</span>(top3, orderHfNodes[i + <span class=\"number\">2</span>])) &#123;</span><br><span class=\"line\">                    frequencyMap[orderHfNodes[++i]]--;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    std::string k = orderHfNodes[++i];</span><br><span class=\"line\">                    frequencyMap[k]--;</span><br><span class=\"line\">                    frequencyMap[std::<span class=\"built_in\">string</span>(<span class=\"number\">1</span>, orderHfNodes[i][<span class=\"number\">1</span>])]++;</span><br><span class=\"line\">                    frequencyMap[std::<span class=\"built_in\">string</span>(<span class=\"number\">1</span>, orderHfNodes[i][<span class=\"number\">0</span>])]++;</span><br><span class=\"line\"><span class=\"comment\">//                    std::cout &lt;&lt; i &lt;&lt; &quot;:&quot; &lt;&lt; k &lt;&lt; std::endl;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"comment\">//        std::cout &lt;&lt; &quot;_t:&quot; &lt;&lt; frequencyMap[&quot; t&quot;] &lt;&lt; &quot; t:&quot; &lt;&lt; frequencyMap[&quot;t&quot;] &lt;&lt; endl;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(i==orderHfNodes.<span class=\"built_in\">size</span>() - <span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">contains</span>(top3, orderHfNodes[i]) &amp;&amp;</span><br><span class=\"line\">                <span class=\"built_in\">contains</span>(top3, orderHfNodes[i + <span class=\"number\">1</span>]))&#123;</span><br><span class=\"line\">                frequencyMap[orderHfNodes[++i]]--;</span><br><span class=\"line\">                frequencyMap[std::<span class=\"built_in\">string</span>(<span class=\"number\">1</span>, orderHfNodes[i][<span class=\"number\">1</span>])]++;</span><br><span class=\"line\">                frequencyMap[std::<span class=\"built_in\">string</span>(<span class=\"number\">1</span>, orderHfNodes[i][<span class=\"number\">0</span>])]++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> LOG_LEVEL &lt;= DEBUG</span></span><br><span class=\"line\">        std::cout &lt;&lt; <span class=\"string\">&quot;\\nå­—ç¬¦å¯¹ç¼–ç :å»0å‰:&quot;</span> &lt;&lt; std::endl;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> p: frequencyMap) &#123;</span><br><span class=\"line\">            std::cout &lt;&lt; p.first &lt;&lt; <span class=\"string\">&quot;-&quot;</span> &lt;&lt; p.second &lt;&lt; <span class=\"string\">&quot;,&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        std::cout &lt;&lt; std::endl;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è¿‡æ»¤æ‰vä¸º0çš„pair</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> it = frequencyMap.<span class=\"built_in\">begin</span>(); it != frequencyMap.<span class=\"built_in\">end</span>(); <span class=\"comment\">/* no increment here */</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (it-&gt;second &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Erase element by iterator and get the next iterator position</span></span><br><span class=\"line\">                it = frequencyMap.<span class=\"built_in\">erase</span>(it);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Only increment the iterator if not erasing</span></span><br><span class=\"line\">                ++it;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> LOG_LEVEL &lt;= DEBUG</span></span><br><span class=\"line\">        std::cout &lt;&lt; <span class=\"string\">&quot;å»0å:&quot;</span> &lt;&lt; std::endl;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> p: frequencyMap) &#123;</span><br><span class=\"line\">            std::cout &lt;&lt; p.first &lt;&lt; <span class=\"string\">&quot;-&quot;</span> &lt;&lt; p.second &lt;&lt; std::endl;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        std::cout &lt;&lt; std::endl;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> LOG_LEVEL &lt;= INFO</span></span><br><span class=\"line\">    std::cout &lt;&lt; <span class=\"string\">&quot;\\n&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1ã€æ„å»ºå­—ç¬¦é¢‘ç‡è¡¨:&quot;</span> &lt;&lt; std::endl;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> p: frequencyMap) &#123;</span><br><span class=\"line\">        std::cout &lt;&lt; p.first &lt;&lt; <span class=\"string\">&quot;-&quot;</span> &lt;&lt; p.second &lt;&lt; std::endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    std::cout &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span> &lt;&lt; std::endl;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">hfTree::buildHuffmanTree</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    std::priority_queue&lt;Node *, std::vector&lt;Node *&gt;, Compare&gt; minHeap;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> <span class=\"keyword\">auto</span> &amp;pair: frequencyMap) &#123;</span><br><span class=\"line\">        Node *newNode = <span class=\"keyword\">new</span> <span class=\"built_in\">Node</span>(pair.first, pair.second, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        minHeap.<span class=\"built_in\">push</span>(newNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> LOG_LEVEL &lt;= DEBUG</span></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\n å°é¡¶å †æ„å»ºè¿‡ç¨‹:\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (minHeap.<span class=\"built_in\">size</span>() &gt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        Node *left = minHeap.<span class=\"built_in\">top</span>();</span><br><span class=\"line\">        minHeap.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">        Node *right = minHeap.<span class=\"built_in\">top</span>();</span><br><span class=\"line\">        minHeap.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">        <span class=\"keyword\">auto</span> chs = <span class=\"built_in\">min</span>(left-&gt;character, right-&gt;character) + <span class=\"built_in\">max</span>(left-&gt;character, right-&gt;character);</span><br><span class=\"line\">        Node *sum = <span class=\"keyword\">new</span> <span class=\"built_in\">Node</span>(chs, left-&gt;freq + right-&gt;freq);</span><br><span class=\"line\">        sum-&gt;left = left;</span><br><span class=\"line\">        sum-&gt;right = right;</span><br><span class=\"line\">        minHeap.<span class=\"built_in\">push</span>(sum);</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> LOG_LEVEL &lt;= DEBUG</span></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;left:%s-%d, right:%s-%d, parent:%s-%d\\n&quot;</span>, (left-&gt;character.<span class=\"built_in\">c_str</span>()), left-&gt;freq,</span><br><span class=\"line\">               right-&gt;character.<span class=\"built_in\">c_str</span>(), right-&gt;freq,</span><br><span class=\"line\">               sum-&gt;character.<span class=\"built_in\">c_str</span>(), sum-&gt;freq);</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> LOG_LEVEL &lt;= DEBUG</span></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot; å°é¡¶å †æ„å»ºæ„å»ºå®Œæˆ\\n&quot;</span>);</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">    root = minHeap.<span class=\"built_in\">top</span>();</span><br><span class=\"line\">    minHeap.<span class=\"built_in\">pop</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">hfTree::generateCodes</span><span class=\"params\">(Node *node, <span class=\"keyword\">const</span> std::string &amp;str)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node == <span class=\"literal\">nullptr</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node-&gt;isLeaf) &#123;</span><br><span class=\"line\">        huffmanCodeMap[node-&gt;character] = str;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">generateCodes</span>(node-&gt;left, str + <span class=\"string\">&quot;0&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">generateCodes</span>(node-&gt;right, str + <span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">hfTree::encode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">calculateFrequency</span>(); <span class=\"comment\">// ç»Ÿè®¡å„å­—ç¬¦å‡ºç°çš„æ¬¡æ•°(é¢‘ç‡)</span></span><br><span class=\"line\">    <span class=\"built_in\">buildHuffmanTree</span>();  <span class=\"comment\">// æ„å»ºhaffmanæ ‘</span></span><br><span class=\"line\">    <span class=\"built_in\">generateCodes</span>(root, <span class=\"string\">&quot;&quot;</span>); <span class=\"comment\">//å¯¹huffmanä¸­çš„å­—ç¬¦(ç»„åˆ)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> LOG_LEVEL == INFO</span></span><br><span class=\"line\">    std::cout &lt;&lt; <span class=\"string\">&quot;\\n&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 1ã€æ„å»ºå­—ç¬¦ç¼–ç è¡¨:&quot;</span> &lt;&lt; std::endl;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> p: huffmanCodeMap) &#123;</span><br><span class=\"line\">        std::cout &lt;&lt; p.first &lt;&lt; <span class=\"string\">&quot;:&quot;</span> &lt;&lt; p.second &lt;&lt; std::endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    std::cout &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span> &lt;&lt; std::endl;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">std::string <span class=\"title\">hfTree::getEncodedText</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    std::string encodedText;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">char</span> ch: text) &#123;</span><br><span class=\"line\">        encodedText += huffmanCodeMap[std::<span class=\"built_in\">string</span>(<span class=\"number\">1</span>, ch)];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> encodedText;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">std::map&lt;std::string, std::string&gt; <span class=\"title\">hfTree::getCodingTable</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> huffmanCodeMap;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è·å–å®Œæ•´ä»£ç æ¡ˆä¾‹ï¼Œå…³æ³¨å…¬ä¼—å·ï¼Œå›å¤ <code>huffman</code>  å³å¯è·å–ã€‚</p>\n<h1 id=\"huffman-ç¼–ç çš„åº”ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#huffman-ç¼–ç çš„åº”ç”¨\">#</a> Huffman ç¼–ç çš„åº”ç”¨</h1>\n<ul>\n<li>æ•°æ®å‹ç¼©ï¼šåœ¨æ–‡æœ¬æ–‡ä»¶ã€éŸ³é¢‘æµå’Œè§†é¢‘æµç­‰æ•°æ®å‹ç¼©åœºæ™¯ä¸­å¹¿æ³›åº”ç”¨ï¼Œå¦‚ JPEG å›¾åƒæ ¼å¼ã€MPEG è§†é¢‘æ ¼å¼ä»¥åŠ PNG å›¾åƒæ ¼å¼çš„éƒ¨åˆ†å‹ç¼©æµç¨‹éƒ½ä½¿ç”¨åˆ°äº† <code>Huffman</code>  ç¼–ç ã€‚</li>\n<li>é€šä¿¡ä¼ è¾“ï¼šåœ¨ç½‘ç»œé€šä¿¡é¢†åŸŸï¼Œ <code>Huffman</code>  ç¼–ç èƒ½æœ‰æ•ˆå‡å°‘æ•°æ®ä¼ è¾“é‡ï¼Œæé«˜å¸¦å®½åˆ©ç”¨ç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å¸¦å®½èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ï¼Œå…¶æ•ˆæœå°¤ä¸ºæ˜¾è‘—ã€‚</li>\n<li>å­˜å‚¨ä¼˜åŒ–ï¼šåœ¨ç£ç›˜å­˜å‚¨æˆ–å†…å­˜ç®¡ç†ä¸­ï¼Œé€šè¿‡ <code>Huffman</code>  ç¼–ç å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œæå‡å­˜å‚¨æ•ˆç‡ã€‚</li>\n</ul>\n<h1 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h1>\n<p><code>Huffman</code>  ç¼–ç åˆ©ç”¨ä¿¡æ¯ç†µç†è®ºï¼Œå°†æ•°æ®ç¼–ç ä¸ºæ›´çŸ­çš„å½¢å¼ï¼Œå®ç°äº†æ•°æ®çš„æœ‰æ•ˆå‹ç¼©ï¼Œæ˜¯ç°ä»£ä¿¡æ¯æŠ€æœ¯ä¸­çš„å…³é”®æŠ€æœ¯ä¹‹ä¸€ã€‚å°½ç®¡éšç€æŠ€æœ¯å‘å±•å‡ºç°äº†è®¸å¤šæ›´ä¸ºå¤æ‚çš„å‹ç¼©ç®—æ³•ï¼Œä½† <code>Huffman</code>  ç¼–ç å› å…¶ç®€æ´é«˜æ•ˆã€æ˜“äºå®ç°çš„ç‰¹æ€§ï¼Œåœ¨å¾ˆå¤šå®é™…åº”ç”¨åœºæ™¯ä¸­ä»å æ®ç€ä¸å¯æ›¿ä»£çš„åœ°ä½ã€‚åŒæ—¶ï¼Œç†è§£å¹¶æŒæ¡ <code>Huffman</code>  ç¼–ç çš„æ€æƒ³å’Œæ–¹æ³•ï¼Œä¹Ÿæœ‰åŠ©äºæˆ‘ä»¬æ·±å…¥ç†è§£æ•°æ®ç»“æ„ã€ç®—æ³•è®¾è®¡ç­‰ç›¸å…³é¢†åŸŸçš„åŸºç¡€çŸ¥è¯†ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "éœå¤«æ›¼ç¼–ç ",
                "å“ˆå¤«æ›¼ç¼–ç ",
                "C++"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2023/02/15/onedayday/2023-02-15-cache-multi/",
            "url": "https://fangjiaxiaobai.github.io/2023/02/15/onedayday/2023-02-15-cache-multi/",
            "title": "åˆ†å¸ƒå¼ç¼“å­˜",
            "date_published": "2023-02-15T10:18:18.000Z",
            "content_html": "<h3 id=\"ç¼“å­˜é›ªå´©\"><a class=\"markdownIt-Anchor\" href=\"#ç¼“å­˜é›ªå´©\">#</a> ç¼“å­˜é›ªå´©</h3>\n<p><b>ç¼“å­˜åœ¨åŒä¸€æ—¶åˆ»ä¸€èµ·å¤±æ•ˆï¼Œ å¤§é‡çš„è¯·æ±‚ç›´æ¥æ‰“åˆ°äº† <code>DB</code>  ä¸Šã€‚</b></b></p>\n<p><b>è§£å†³æ–¹æ¡ˆ:</b></p>\n<ul>\n<li><b>ç¼“å­˜å¤±æ•ˆæ—¶é—´è®¾ç½®ä¸€ä¸ªéšæœºå€¼ï¼Œé¿å…å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆã€‚</b></li>\n<li><b>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸï¼Œæœ‰æ›´æ–°æ“ä½œå°±æ›´æ–°ç¼“å­˜ã€‚</b></li>\n</ul>\n<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>\n<p>å‡è®¾æœ‰ä¸ªå®šæ—¶ä»»åŠ¡åœ¨æ¯å¤©å‡Œæ™¨ 3 ç‚¹çš„æ—¶å€™ä¼šæ›´æ–°ç¼“å­˜ï¼Œå¥½å·§ä¸å·§ã€‚å‡Œæ™¨ <code>3</code>  ç‚¹ï¼Œæœ‰ä¸€ä¸ªç§’æ€æ´»åŠ¨ã€‚å¾—ï¼æ¸…é™¤ç¼“å­˜çš„ä¸€åˆ¹é‚£ï¼Œå¤§é‡è¯·æ±‚æ¶Œå…¥ï¼Œç›´æ¥æ‰“åˆ°äº† DB ä¸Šã€‚è¿™ä¸å°±åˆºæ¿€äº†ä¹ˆï¼Œ  <code>DBA</code>  æœ‰äº†ä¸€ä¸ªä¸çœ å¤œã€‚</p>\n<p>é‡å¯ <code>DBA</code> ï¼Œè¿˜æ˜¯ä¼šè¢«ç¬é—´æ‰“æŒ‚ã€‚</p>\n<h3 id=\"ç¼“å­˜å‡»ç©¿\"><a class=\"markdownIt-Anchor\" href=\"#ç¼“å­˜å‡»ç©¿\">#</a> ç¼“å­˜å‡»ç©¿</h3>\n<p><b>ä¸€ä¸ª <code>Key</code>  éå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ª <code>Key</code>  åœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ã€‚</b></p>\n<p>ç†è§£å°±æ˜¯é€šè¿‡ä¸€ä¸ªç‚¹ï¼Œå‡»ç©¿äº†ç¼“å­˜è¿™ä¸ªå±éšœã€‚</p>\n<p><b>è§£å†³æ–¹æ¡ˆ:</b></p>\n<ul>\n<li><b>è®¾ç½®çƒ­ç‚¹æ•°æ®ä¸è¿‡æœŸ</b></li>\n<li><b>åŒä¸€ä¸ªæ•°æ®ï¼ŒæŸ¥ <code>DB</code>  äº’æ–¥ã€‚</b></li>\n</ul>\n<p>ä¾‹å­åŒä¸Šï¼ŒåŒºåˆ«åœ¨äº ç¼“å­˜å‡»ç©¿æ˜¯ä¸€ä¸ªçƒ­ç‚¹ <code>key</code> ï¼Œ è€Œç¼“å­˜é›ªå´©æ—¶å¤§é¢ç§¯çš„ <code>key</code> .</p>\n<h3 id=\"ç¼“å­˜ç©¿é€\"><a class=\"markdownIt-Anchor\" href=\"#ç¼“å­˜ç©¿é€\">#</a> ç¼“å­˜ç©¿é€</h3>\n<p><b>ç¼“å­˜ç©¿é€æ˜¯æŒ‡ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®ã€‚è¯·æ±‚é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ã€‚</b></p>\n<p><b>è§£å†³åŠæ³•:</b></p>\n<ul>\n<li><b>ç‰¹å®šæ¥å£å¯ä»¥é€šè¿‡å‚æ•°æ ¡éªŒæ¥è§£å†³</b></li>\n<li><b>å¸ƒéš†è¿‡æ»¤å™¨ã€‚</b></li>\n<li><b>ä¸å­˜åœ¨çš„å€¼ä¹Ÿç¼“å­˜ã€‚</b></li>\n</ul>\n<p>è¿™ä¸ªæ›´ç®€å•äº†ã€‚æ¯”å¦‚ æ ¹æ® <code>id</code>  å»è¯·æ±‚å•†å“ï¼Œå•†å“ <code>id</code>  éƒ½æ˜¯å¤§äº <code>0</code>  çš„ï¼Œ è¯·æ±‚ååç”¨äº† <code>id=-1</code> . è¿™ä¸åˆåˆºæ¿€äº†ä¹ˆåˆ.</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "æ—¥æ‹±ä¸€å’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2023/02/14/onedayday/2023-02-14.jvm-gc/",
            "url": "https://fangjiaxiaobai.github.io/2023/02/14/onedayday/2023-02-14.jvm-gc/",
            "title": "JVM GC åˆ†æ",
            "date_published": "2023-02-14T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢‘ç¹gc\"><a class=\"markdownIt-Anchor\" href=\"#é¢‘ç¹gc\">#</a> é¢‘ç¹ GC</h2>\n<p>ä»Šå¤©åˆ†äº«ä¸€ä¸ªé¢è¯•é¢˜ï¼Œé¢‘ç¹ <code>GC</code>  æ€ä¹ˆå¤„ç†â€¦</p>\n<p>ä¸”ä¸è¯´ä¸ºä»€ä¹ˆé¢‘ç¹ <code>GC</code> , å…ˆèŠèŠä½ æ€ä¹ˆå‘ç°  <code>JVM</code>  é¢‘ç¹ <code>GC</code>  çš„å‘¢ï¼Ÿ</p>\n<p>å‘Šè­¦å•Šï¼å¯¹çš„ã€‚<br>\nç¬¬ä¸€ç§å°±æ˜¯  <code>FullGC</code>  çš„å‘Šè­¦ï¼Œ<br>\nç¬¬äºŒç§å°±æ˜¯ æœºå™¨ CPU çš„è´Ÿè½½è¿‡é«˜<br>\nç¬¬ä¸‰ç§å°±æ˜¯ å¤§é¢ç§¯çš„æ¥å£è¶…æ—¶ï¼Œæ— æ³•å¤„ç†è¯·æ±‚ã€‚</p>\n<p>é‚£å°±å¥½è¯´äº†ï¼Œå’±ä»¬åˆ†æä¸‹ä»€ä¹ˆåœ°æ–¹å¯ä»¥è¿›è¡Œ <code>GC</code> ?</p>\n<p>å †ï¼ ä½†ä¸ä»…ä»…æ˜¯å †ï¼Œè¿˜æ˜¯å †å¤–å†…å­˜ä¹Ÿä¼šè¿›è¡Œ <code>GC</code> ã€‚</p>\n<p>å½“ç„¶æˆ‘ä»¬ä¸»è¦è¯´å †ï¼</p>\n<p>å…ˆçœ‹ä¸€ä¸‹å¸¸ç”¨çš„åè¯.</p>\n<p><img data-src=\"./images/2023-02-14-01.png\" alt=\"\"></p>\n<h3 id=\"younggc\"><a class=\"markdownIt-Anchor\" href=\"#younggc\">#</a>  <code>YoungGC</code></h3>\n<p><code>YoungGC</code>  æŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œæ‰€ä»¥  <code>Minor GC</code>  éå¸¸é¢‘ç¹ï¼Œå›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚é¢‘ç¹çš„ <code>YoungGC</code>  æ˜¯æ­£å¸¸çš„ï¼Œè¦çœ‹ä¸‹  <code>YoungGC</code>  ä¹‹åå­˜æ´»çš„å¯¹è±¡æ˜¯å¦æœ‰é—®é¢˜ã€‚</p>\n<p>å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£  <code>Eden</code>  åŒºä¸­åˆ†é…ï¼Œå¦‚æœ  <code>Eden</code>  åŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡  <code>Young GC</code>  ã€‚</p>\n<p>æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†å™¨æœ‰ <code>Serial</code> ,  <code>ParNew</code> .</p>\n<p>ç»è¿‡å‡ æ¬¡ YGC è¿˜å­˜æ´»çš„å°±åˆ°äº†è€å¹´ä»£ã€‚</p>\n<h3 id=\"old-gc\"><a class=\"markdownIt-Anchor\" href=\"#old-gc\">#</a>  <code>old GC</code></h3>\n<p>æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ <code>GC</code> ï¼Œé€Ÿåº¦ä¸€èˆ¬æ¯”  <code>Minor GC</code>  æ…¢åå€ä»¥ä¸Šã€‚<br>\nè€å¹´ä»£çš„åƒåœ¾æ”¶é›†å™¨æœ‰  <code>Serial Old</code> ,  <code>Parallel Old</code> ï¼Œ <code>CMS</code> .</p>\n<p>è€å¹´ä»£ä¼šåœ¨ä¸¤ç§æƒ…å†µä¸‹è§¦å‘  <code>Old GC</code> ï¼š<br>\nä¸€æ˜¯å¼€å¯åˆ†é…æ‹…ä¿æœºåˆ¶ï¼Œæ ¹æ®å†æ¬¡  <code>Minor GC</code>  åè¿›å…¥è€å¹´ä»£çš„å¯¹è±¡å¤§äºå½“å‰è€å¹´ä»£å†…å­˜å¤§å°ï¼Œåˆ¤æ–­  <code>Minor GC</code>  æœ‰é£é™©ï¼Œåˆ™ä¼šè§¦å‘  <code>Old GC</code> ï¼›æ¯”å¦‚ï¼š</p>\n<ul>\n<li>1. ç³»ç»Ÿå¹¶å‘é«˜ã€æ‰§è¡Œè€—æ—¶è¿‡é•¿ï¼Œæˆ–è€…æ•°æ®é‡è¿‡å¤§ï¼Œå¯¼è‡´  <code>young gc</code>  é¢‘ç¹ï¼Œä¸” <code>gc</code>  åå­˜æ´»å¯¹è±¡å¤ªå¤šï¼Œä½†æ˜¯  <code>survivor</code>  åŒºå­˜æ”¾ä¸ä¸‹ï¼ˆå¤ªå° æˆ– åŠ¨æ€å¹´é¾„åˆ¤æ–­ï¼‰ å¯¼è‡´å¯¹è±¡å¿«é€Ÿè¿›å…¥è€å¹´ä»£ è€å¹´ä»£è¿…é€Ÿå †æ»¡</li>\n<li>2. ç¨‹åºä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šå¯¹è±¡åˆ°å†…å­˜ ï¼ˆå¤§å¯¹è±¡ï¼‰ï¼Œå¯¼è‡´é¢‘ç¹æœ‰å¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£</li>\n<li>3. å­˜åœ¨å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œè€å¹´ä»£é©»ç•™äº†å¤§é‡é‡Šæ”¾ä¸æ‰çš„å¯¹è±¡ï¼Œ åªè¦æœ‰ä¸€ç‚¹ç‚¹å¯¹è±¡è¿›å…¥è€å¹´ä»£ å°±è¾¾åˆ°  <code>full gc</code>  çš„æ°´ä½äº†<br>\näºŒæ˜¯  <code>Minor GC</code>  åå‰©ä½™å¯¹è±¡å¤ªå¤šï¼Œè€å¹´ä»£æ”¾ä¸ä¸‹äº†ä¹Ÿä¼šè§¦å‘  <code>Old GC</code> ã€‚</li>\n</ul>\n<h3 id=\"full-gc\"><a class=\"markdownIt-Anchor\" href=\"#full-gc\">#</a>  <code>Full GC</code></h3>\n<p><code>FGC</code>  æ”¶é›†æ•´ä¸ª  <code>Young Gen</code>  ä»¥åŠéƒ¨åˆ†  <code>old gen</code>  çš„  <code>GC</code> ï¼Œåªæœ‰åƒåœ¾æ”¶é›†å™¨  <code>G1</code>  æœ‰è¿™ä¸ªæ¨¡å¼ã€‚ä½†æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„ <code>Full GC</code>  æŒ‡çš„æ˜¯ é’ˆå¯¹æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„å…¨ä½“å†…å­˜ç©ºé—´çš„åƒåœ¾å›æ”¶ã€‚</p>\n<p><code>full gc</code>  è§¦å‘æ¡ä»¶æœ‰</p>\n<ul>\n<li>1ã€è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œ æ‰€ä»¥è¿½å› çš„æ–¹å‘å°±æ˜¯å¯¼è‡´ è€å¹´ä»£ç©ºé—´ä¸è¶³çš„åŸå› ï¼š<br>\nå¤§é‡å¯¹è±¡é¢‘ç¹è¿›å…¥è€å¹´ä»£ + è€å¹´ä»£ç©ºé—´é‡Šæ”¾ä¸æ‰</li>\n<li>2ã€å…ƒç©ºé—´å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¼šè§¦å‘ <code>Full GC</code></li>\n<li>3ã€å †å¤–å†…å­˜  <code>direct buffer memory</code>  ä½¿ç”¨ä¸å½“å¯¼è‡´</li>\n<li>4ã€ä»£ç é—®é¢˜ã€‚è€å¹´ä»£å ç”¨ä¸é«˜ï¼Œé‡å¯æ•ˆæœä¸æ˜æ˜¾ã€‚è¿™ç§æƒ…å†µï¼Œå¤§æ¦‚ç‡æ˜¯åœ¨ä»£ç é‡Œææ‰§è¡Œäº†  <code>System.gc()</code> ;</li>\n</ul>\n<h3 id=\"è§£å†³\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³\">#</a> è§£å†³</h3>\n<p>çŸ¥é“äº†ä¸Šé¢çš„é—®é¢˜ä¹‹åï¼Œè§£å†³å°±ç®€å•äº†ã€‚</p>\n<ul>\n<li>1ã€è§‚å¯Ÿå¹´è½»ä»£  <code>gc</code>  çš„æƒ…å†µï¼Œå¤šä¹…æ‰§è¡Œä¸€æ¬¡ã€æ¯æ¬¡ <code>gc</code>  åå­˜æ´»å¯¹è±¡æœ‰å¤šå°‘  <code>survivor</code>  åŒºå¤šå¤§<br>\nå­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤š è¶…è¿‡  <code>survivor</code>  åŒºå¤§å°æˆ–è§¦å‘åŠ¨æ€å¹´é¾„åˆ¤æ–­ =&gt; è°ƒæ•´å†…å­˜åˆ†é…æ¯”ä¾‹</li>\n<li>2ã€è§‚å¯Ÿè€å¹´ä»£çš„å†…å­˜æƒ…å†µ æ°´ä½æƒ…å†µï¼Œå¤šä¹…æ‰§è¡Œä¸€æ¬¡ã€æ‰§è¡Œè€—æ—¶å¤šå°‘ã€å›æ”¶æ‰å¤šå°‘å†…å­˜<br>\nå¦‚æœåœ¨æŒç»­çš„ä¸Šæ¶¨ï¼Œè€Œä¸” <code>full gc</code>  åå›æ”¶æ•ˆæœä¸å¥½ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯å†…å­˜æº¢å‡ºäº† =&gt; æŸ¥çœ‹å †å¿«ç…§ï¼Œå®šä½å†…å­˜æº¢å‡ºä½ç½®ï¼Œä¿®å¤ä»£ç ã€‚</li>\n<li>3ã€å¦‚æœå¹´è½»ä»£å’Œè€å¹´ä»£çš„å†…å­˜éƒ½æ¯”è¾ƒä½ï¼Œè€Œä¸”é¢‘ç‡ä½ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æ˜¯å…ƒæ•°æ®åŒºåŠ è½½å¤ªå¤šä¸œè¥¿äº†</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "æ—¥æ‹±ä¸€å’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2023/02/12/onedayday/2023-02-12.Https/",
            "url": "https://fangjiaxiaobai.github.io/2023/02/12/onedayday/2023-02-12.Https/",
            "title": "Httpsè¿æ¥è¿‡ç¨‹",
            "date_published": "2023-02-12T10:18:18.000Z",
            "content_html": "<h2 id=\"https-çš„è¿æ¥è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#https-çš„è¿æ¥è¿‡ç¨‹\">#</a> Https çš„è¿æ¥è¿‡ç¨‹</h2>\n<p><code>Https</code>  å…¨ç§°æ˜¯  <code>Hypertext Transfer Protocol Secure</code> ï¼Œè¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®.</p>\n<p><code>Https</code>  ç›¸æ¯”  <code>Http</code>  æ˜¯åœ¨  <code>TCP</code>  ä¸  <code>HTTP</code>  ä¹‹é—´å¤šåŠ äº†ä¸€å±‚  <code>SSL</code> ( <code>Secure Socket Layer</code>  åè®®ä½äº  <code>TCP/IP</code>  åè®®ä¸å„ç§åº”ç”¨å±‚åè®®ä¹‹é—´ï¼Œä¸ºæ•°æ®é€šè®¯æä¾›å®‰å…¨æ”¯æŒ)/ <code>TLS</code> ï¼ˆ <code>Transport Layer Security</code> ï¼Œå®‰å…¨ä¼ è¾“å±‚åè®®ï¼‰</p>\n<p><code>Http</code>  åè®®é‡‡ç”¨æ˜æ–‡ä¼ è¾“ä¿¡æ¯ï¼Œå­˜åœ¨ä¿¡æ¯çªƒå¬ã€ä¿¡æ¯ç¯¡æ”¹å’Œä¿¡æ¯åŠ«æŒçš„é£é™©ï¼Œè€Œåè®® <code>TLS/SSL</code>  å…·æœ‰èº«ä»½éªŒè¯ã€ä¿¡æ¯åŠ å¯†å’Œå®Œæ•´æ€§æ ¡éªŒçš„åŠŸèƒ½ï¼Œå¯ä»¥é¿å…æ­¤ç±»é—®é¢˜å‘ç”Ÿï¼Œæ‰€ä»¥ <code>HTTP</code>  ä¸  <code>Https</code>  ä¹‹é—´çš„å…³ç³»ï¼š <code>HTTP+åŠ å¯†+è®¤è¯+å®Œæ•´æ€§ä¿æŠ¤ = Https</code> ã€‚</p>\n<h3 id=\"è¿æ¥è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#è¿æ¥è¿‡ç¨‹\">#</a> è¿æ¥è¿‡ç¨‹</h3>\n<p><img data-src=\"/images/onedayday/2023-02-12-01.png\" alt=\"\"></p>\n<p>Https ä¼šå‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œç»è¿‡éå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°åŠ å¯†ä¸¤ä¸ªåŠ å¯†è¿‡ç¨‹.</p>\n<p>1. å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <code>https</code>  çš„è¯·æ±‚åˆ°æœåŠ¡ç«¯ã€‚é¦–å…ˆè¿˜æ˜¯ä¼šç»è¿‡ Http çš„ä¸‰æ¬¡æ¡æ‰‹ã€‚åœ¨ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™ï¼Œä¼šå‘é€å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†å¥—ä»¶å’Œä¸€ä¸ªéšæœºæ•° (éšæœºæ•° 1) å‘é€ç»™æœåŠ¡ç«¯ã€‚<br>\n2. æœåŠ¡ç«¯ç”³è¯·é…ç½®å¥½æ•°å­—è¯ä¹¦ï¼ŒåŒ…å«å…¬é’¥å’Œç§é’¥ã€‚<br>\n3. æœåŠ¡ç«¯ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•° (éšæœºæ•° 2)ï¼Œå°†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„åŠ å¯†å¥—ä»¶ä¸­é€‰æ‹©ä¸€ç§ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆçš„éšæœºæ•°ï¼Œè¯ä¹¦ä¼ é€ç»™å®¢æˆ·ç«¯ï¼Œè¯ä¹¦ä¸­åŒ…å«äº†å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚è¯ä¹¦çš„é¢å‘æœºæ„ï¼Œè¿‡æœŸæ—¶é—´ï¼Œç½‘å€ï¼Œå…¬é’¥ç­‰<br>\n 4. å®¢æˆ·ç«¯è§£æè¯ä¹¦ï¼Œç”±å®¢æˆ·ç«¯çš„ TLS å®Œæˆï¼Œé¦–å…ˆä¼šéªŒè¯å…¬é’¥æ˜¯å¦æœ‰æ•ˆï¼Œæ¯”å¦‚é¢å‘æœºæ„ï¼Œè¿‡æœŸæ—¶é—´ç­‰ã€‚å¦‚æœæœ‰å¼‚å¸¸ï¼Œå°±ä¼šå¼¹å‡ºè­¦å‘Šä¿¡æ¯ï¼Œå¹¶ç»“æŸé€šä¿¡ã€‚å¦‚æœæ­£å¸¸ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼ˆç”¨äºå¯¹ç§°åŠ å¯†ï¼‰ï¼Œç„¶åç”¨æœåŠ¡ç«¯çš„å…¬é’¥å¯¹éšæœºå€¼è¿›è¡Œ<b>éå¯¹ç§°åŠ å¯†</b>ã€‚<br>\n5. å®¢æˆ·ç«¯ä¿å­˜æœåŠ¡ç«¯çš„éšæœºæ•°ï¼Œå®¢æˆ·ç«¯ä¼šä½¿ç”¨éšæœºæ•° 1 å’Œéšæœºæ•° 2 å†æ¬¡ç”Ÿæˆä¸€ä¸ªéšæœºæ•° (éšæœºæ•° 3) å¹¶ä½¿ç”¨æœåŠ¡ç«¯å‘é€å›æ¥çš„åŠ å¯†å¥—ä»¶ä¸æœåŠ¡ç«¯å‘é€æ¥å…¬é’¥åŠ å¯†å (é¢„ä¸»ç§˜é’¥) ä¼ é€åˆ°æœåŠ¡ç«¯ã€‚<br>\n6. æœåŠ¡ç«¯ä½¿ç”¨è¯ä¹¦çš„ç§é’¥å¯¹åŠ å¯†åçš„é¢„ä¸»å¯†é’¥è¿›è¡Œéå¯¹ç§°è§£å¯†å¾—åˆ°é¢„ä¸»å¯†é’¥ã€‚ ä½¿ç”¨çº¦å®šçš„åŠ å¯†ç®—æ³•å¯¹é¢„ä¸»å¯†é’¥ + éšæœºæ•° 1 + éšæœºæ•° 2 è¿›è¡ŒåŠ å¯†ç”Ÿæˆä¼šè¯ç§˜é’¥ã€‚<br>\n7. æœåŠ¡ç«¯æŠŠå¯¹ç§°åŠ å¯†åçš„ä¼šè¯ç§˜é’¥åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¹Ÿä¼šä½¿ç”¨éšæœºæ•° 1ï¼Œéšæœºæ•° 2ï¼Œéšæœºæ•° 3 ç”Ÿæˆä¸€ä¸ªä¼šè¯ç§˜é’¥ï¼Œå¹¶ä¸”æ˜¯å’ŒæœåŠ¡ç«¯çš„ä¼šè¯ç§˜é’¥æ˜¯ä¸€æ ·çš„ã€‚<br>\n8. å®¢æˆ·ç«¯é€šè¿‡ä¼šè¯ç§˜é’¥å¯¹æ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œç„¶åè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p>\n<h3 id=\"https-è¿æ¥ä¸ºä»€ä¹ˆåªç”¨ä¸€æ¬¡éå¯¹ç§°åŠ å¯†å†…å®¹ä¼ è¾“éƒ½ä½¿ç”¨å¯¹ç§°ä¼ è¾“\"><a class=\"markdownIt-Anchor\" href=\"#https-è¿æ¥ä¸ºä»€ä¹ˆåªç”¨ä¸€æ¬¡éå¯¹ç§°åŠ å¯†å†…å®¹ä¼ è¾“éƒ½ä½¿ç”¨å¯¹ç§°ä¼ è¾“\">#</a> Https è¿æ¥ä¸ºä»€ä¹ˆåªç”¨ä¸€æ¬¡éå¯¹ç§°åŠ å¯†ï¼Œå†…å®¹ä¼ è¾“éƒ½ä½¿ç”¨å¯¹ç§°ä¼ è¾“ï¼Ÿ</h3>\n<p>éå¯¹ç§°åŠ å¯†ç®—æ³•ååˆ†å¤æ‚ï¼ŒåŠ å¯†è§£å¯†æ—¶é—´é•¿ï¼Œæ•ˆç‡ä½ï¼Œå› æ­¤æˆ‘ä»¬åªåœ¨ TSL è¿æ¥å»ºç«‹æ—¶æ‰ä½¿ç”¨ï¼Œåé¢çš„æ•°æ®ä¼ è¾“ç¯èŠ‚ç»Ÿä¸€ä½¿ç”¨å¯¹ç§°åŠ å¯†ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æ•ˆç‡ï¼Œåˆèƒ½æå¤§çš„å¢å¼ºå®‰å…¨æ€§ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "æ—¥æ‹±ä¸€å’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2023/02/03/onedayday/2023-02-03.JUC/",
            "url": "https://fangjiaxiaobai.github.io/2023/02/03/onedayday/2023-02-03.JUC/",
            "title": "JUCçš„çº¿ç¨‹åŒæ­¥ç±»",
            "date_published": "2023-02-03T10:18:18.000Z",
            "content_html": "<p><code>Juc</code>  æä¾›äº†å¾ˆå¤šå…³äºçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œæ¯”å¦‚:</p>\n<ul>\n<li>çº¿ç¨‹æ± ç›¸å…³çš„:  <code>ThreadPoolExecutor</code> ã€ <code>Executors</code>  ç­‰ï¼›</li>\n<li>é”ç›¸å…³çš„ï¼Œå¦‚  <code>Lock</code> ã€ <code>ReadWriteLock</code> ã€ <code>ReentrantLock</code> ,  <code>ReentrantReadWriteLock</code>  ç­‰ï¼›</li>\n<li>çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œåº”ç”¨äºçº¿ç¨‹å®‰å…¨çš„é›†åˆä¸­ï¼Œå¦‚  <code>ConcurrentHashMap</code> ã€ <code>LinkedBlockingQueue</code> ã€ <code>DelayQueue</code>  ç­‰ï¼›</li>\n<li>è¿˜æœ‰é«˜çº§çš„çº¿ç¨‹åŒæ­¥çš„ç±»ï¼Œå¦‚  <code>CountDownLatch</code> ã€ <code>CyclicBarrier</code> ã€ <code>Semaphore</code> , <code>Phaser</code>  ç­‰ã€‚</li>\n<li>è¿˜æœ‰ä¸€äº›åŸå­ç±»ã€‚å¦‚  <code>AtomicInteger</code> , <code>AtomicLong</code> ,  <code>AtomicReference</code>  ç­‰ç­‰</li>\n</ul>\n<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹ä¸‹  <code>JUC</code>  æä¾›çš„çº¿ç¨‹åŒæ­¥ç±»ã€‚</p>\n<h2 id=\"countdownlatch\"><a class=\"markdownIt-Anchor\" href=\"#countdownlatch\">#</a>  <code>CountDownLatch</code></h2>\n<p><code>CountDownLatch</code>  ä¸€ç§å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°åœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ç»„æ“ä½œå®Œæˆçš„åŒæ­¥è¾…åŠ©å·¥å…·ç±»ã€‚ å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ã€‚</p>\n<p><code>CountDownLatch</code>  æä¾›äº†ä¸ªå¥½ç”¨çš„æ–¹æ³•:</p>\n<ul>\n<li><code>countDown()</code> ï¼šè°ƒç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å™¨å‡  <code>1</code> ã€‚ç›´åˆ°å‡ä¸º 0.</li>\n<li><code>await()</code> ï¼šå½“è®¡æ•°å™¨ä¸ä¸º  <code>0</code>  æ—¶ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹é˜»å¡ï¼Œå½“è®¡æ•°å™¨ä¸º  <code>0</code>  æ—¶ï¼Œå¯ä»¥å”¤é†’ç­‰å¾…çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨çº¿ç¨‹ã€‚</li>\n</ul>\n<h3 id=\"countdownlatch-ä½¿ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#countdownlatch-ä½¿ç”¨åœºæ™¯\">#</a>  <code>CountDownLatch</code>  ä½¿ç”¨åœºæ™¯ï¼š</h3>\n<ul>\n<li>æ’é˜Ÿï¼Œæ¯”å¦‚æ’é˜Ÿåšæ ¸é…¸ã€‚å‡è®¾æœ‰ä¸ª 5 ä¸ªäººåšæ ¸é…¸.</li>\n</ul>\n<p><code>CountDownLatch</code>  ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.time.LocalDateTime;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.format.DateTimeFormatter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        CountDownLatch nucleinCountDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">5</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;å¼€å§‹åšæ ¸é…¸å•¦~~~&quot;</span>);</span><br><span class=\"line\">        ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> j = i;</span><br><span class=\"line\">            executorService.execute(() -&gt; &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;user&quot;</span> + j + <span class=\"string\">&quot; &quot;</span>+ LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)) + <span class=\"string\">&quot;åšå®Œäº†æ ¸é…¸&quot;</span>);</span><br><span class=\"line\">                nucleinCountDownLatch.countDown();</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        nucleinCountDownLatch.await();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;æ ¸ç®—å‘˜ç€æ€¥å¿™æ…Œçš„ä¸‹ç­äº†, å¯æ‹…å¿ƒå†æ¥ä¸€ä¸ªåšæ ¸é…¸çš„....&quot;</span>);</span><br><span class=\"line\">        executorService.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å¼€å§‹åšæ ¸é…¸å•¦~~~</span><br><span class=\"line\">userï¼š0 2023-02-03 22:26:44åšå®Œäº†æ ¸é…¸</span><br><span class=\"line\">userï¼š1 2023-02-03 22:26:46åšå®Œäº†æ ¸é…¸</span><br><span class=\"line\">userï¼š2 2023-02-03 22:26:48åšå®Œäº†æ ¸é…¸</span><br><span class=\"line\">userï¼š3 2023-02-03 22:26:50åšå®Œäº†æ ¸é…¸</span><br><span class=\"line\">userï¼š4 2023-02-03 22:26:52åšå®Œäº†æ ¸é…¸</span><br><span class=\"line\">æ ¸ç®—å‘˜ç€æ€¥å¿™æ…Œçš„ä¸‹ç­äº†, å¯æ‹…å¿ƒå†æ¥ä¸€ä¸ªåšæ ¸ç®—çš„....</span><br></pre></td></tr></table></figure>\n<h3 id=\"cyclicbarrier\"><a class=\"markdownIt-Anchor\" href=\"#cyclicbarrier\">#</a>  <code>CyclicBarrier</code></h3>\n<p><code>CyclicBarrier</code> , ç›´è¯‘è¿‡æ¥å°±æ˜¯ å¾ªç¯å±éšœã€‚å®ƒå…è®¸ä¸€ç»„çº¿ç¨‹å…¨éƒ¨ç­‰å¾…ï¼Œç›´æ¥è¿™ç»„çº¿ç¨‹åˆ°è¾¾ç›¸åŒçš„çŠ¶æ€çš„ä¸€ç§åŒæ­¥è¾…åŠ©å·¥å…·.  CyclicBarriers åœ¨æ¶‰åŠå¿…é¡»å¶å°”ç›¸äº’ç­‰å¾…çš„å›ºå®šå¤§å°çº¿ç¨‹ç»„çš„ç¨‹åºä¸­å¾ˆæœ‰ç”¨ã€‚ å±éšœä¹‹æ‰€ä»¥ç§°ä¸ºå¾ªç¯å±éšœï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥åœ¨ç­‰å¾…çº¿ç¨‹è¢«é‡Šæ”¾åé‡æ–°ä½¿ç”¨ã€‚è¿™å¥è¯æ•²é‡ç‚¹ï¼ï¼ï¼</p>\n<p>ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯ç›¸å½“ç®€å•ï¼</p>\n<p>å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œawait ().  ç­‰å¾…è¿™ä¸€ç»„çº¿ç¨‹éƒ½æ‰§è¡Œç›¸åŒçš„çŠ¶æ€ã€‚ä¸  <code>CountDownLatch</code>  ä¸åŒçš„æ˜¯ï¼Œ  <code>CyclicBarrier</code>  æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨çš„å‘¦ã€‚</p>\n<p><code>CyclicBarrier</code>  åº”ç”¨èµ·æ¥å¤ªå¹¿æ³›äº†ï¼Œæˆ‘å¸æœ‰ç­è½¦ï¼Œä¸å¥½æ„æ€ï¼Œæˆ‘å¸æ—©æ™šæä¾›å…è´¹ç­è½¦â€¦ ä½ æ‡‚å¾— fa~</p>\n<p>ä¸Šä»£ç â€¦</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CyclicBarrierTest</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å‡è®¾æ¯ä¸ªç­è½¦æœ‰50ä¸ªåº§ä½.</span></span><br><span class=\"line\">        CyclicBarrier cyclicBarrier = <span class=\"keyword\">new</span> CyclicBarrier(<span class=\"number\">50</span>, () -&gt; System.out.println(<span class=\"string\">&quot;æ»¡åº§äº†!  å¼€å§‹èµ·é£.....&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 100äºº</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> RegularBus(cyclicBarrier, i)).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ç­è½¦</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RegularBus</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> CyclicBarrier cyclicBarrier;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * å‘˜å·¥å·¥å·</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Integer ppId;</span><br><span class=\"line\"></span><br><span class=\"line\">        RegularBus(CyclicBarrier cyclicBarrier, Integer poorPeopleId) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.cyclicBarrier = cyclicBarrier;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.ppId = poorPeopleId;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ppId % <span class=\"number\">10</span> == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;å·¥å·ä¸º&quot;</span> + ppId + <span class=\"string\">&quot;çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                cyclicBarrier.await();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å·¥å·ä¸º10çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º0çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º30çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º20çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º40çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">æ»¡åº§äº†!  å¼€å§‹èµ·é£.....</span><br><span class=\"line\">å·¥å·ä¸º50çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º60çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º70çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º80çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">å·¥å·ä¸º90çš„å‘˜å·¥æŠ¢åˆ°äº†ä¸€ä¸ªçš„åº§ä½.....</span><br><span class=\"line\">æ»¡åº§äº†!  å¼€å§‹èµ·é£.....</span><br></pre></td></tr></table></figure>\n<h3 id=\"semaphore\"><a class=\"markdownIt-Anchor\" href=\"#semaphore\">#</a>  <code>Semaphore</code></h3>\n<p><code>Semaphore</code>  è¿™ä¸ªæ›´ç®€å•äº†ï¼Œç›´è¯‘ï¼ä¿¡å·é‡ã€‚   ä»–ç”¨äºç®¡ç†å¤šçº¿ç¨‹ä¸­æ§åˆ¶èµ„æºçš„è®¿é—®ä¸ä½¿ç”¨ã€‚ å¸¸è§çš„å°±æ˜¯é™æµã€‚å¯¹åº”ç”Ÿæ´»ä¸­çš„æ —å­ï¼Œæˆ‘æƒ³ä¸€ä¸‹å“ˆï¼</p>\n<p>è¿˜æ˜¯æˆ‘å¸ï¼ é—¨å«ï¼æ¯å¤©æ—©ä¸Šï¼Œæˆ‘å¸å¤§é—¨å£ï¼Œéƒ½æœ‰ä¸¤ä¸ªäº”å¤§ä¸‰ç²—çš„å£®æ±‰åœ¨æ•° è¿›æ¥äº†å¤šå°‘è¾†è½¦ï¼Œå‡ºå»äº†å¤šå°‘è¾†è½¦ã€‚è¿˜æ—¶ä¸æ—¶çš„ç”¨å¯¹è®²æœºï¼šæ´å¹ºï¼Œ æ´å¹ºï¼Œ æˆ‘æ˜¯æ´ä¸¤ï¼Œè¿˜æœ‰å‡ ä¸ªè½¦ä½ï¼Œè¿˜æœ‰å‡ ä¸ªè½¦ä½.<br>\n å¯¹è®²æœºé‚£è¾¹ï¼šæˆ‘è‰ï¼Œæˆ‘çœ‹çœ‹ã€‚åœ°ä¸‹æ²¡æœ‰è½¦ä½äº†ï¼Œåœ°ä¸Šé—®é—®æ‹å“¥.<br>\n æ´ä¸¤: â€œæ´æ‹ï¼Œæ´æ‹ï¼Œåœ°ä¸Šè¿˜æœ‰å‡ ä¸ªè½¦ä½ï¼Ÿâ€<br>\n æ´æ‹: â€œå¤šå¾—å¾ˆï¼Œå¤šå¾—å¾ˆã€‚â€</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SemaphoreTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è½¦ä½æ€»æ•°</span></span><br><span class=\"line\">        Semaphore semaphore = <span class=\"keyword\">new</span> Semaphore(<span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¼€è½¦ä¸Šç­çš„äºº</span></span><br><span class=\"line\">        ThreadPoolExecutor richManThreadPool = <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">10</span>, <span class=\"number\">50</span>, <span class=\"number\">60</span>, TimeUnit.SECONDS, <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> finalI = i;</span><br><span class=\"line\">            richManThreadPool.execute(() -&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// å µå¡è·å–è®¸å¯ï¼Œå³è·å–ä¸€ä¸ªè½¦ä½.</span></span><br><span class=\"line\">                    semaphore.acquire();</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼š&quot;</span> + Thread.currentThread().getName() + <span class=\"string\">&quot; æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š&quot;</span> + LocalDateTime.now().format(DateTimeFormatter.ofPattern(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)));</span><br><span class=\"line\">                    <span class=\"comment\">// å‡è®¾åœ¨ä¸Šç­ä¸­....</span></span><br><span class=\"line\">                    TimeUnit.SECONDS.sleep(<span class=\"number\">2</span>);</span><br><span class=\"line\">                    <span class=\"comment\">// é‡Šæ”¾è®¸å¯, å¼€è½¦å›å®¶äº†...</span></span><br><span class=\"line\">                    semaphore.release();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">5</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:<span class=\"number\">07</span></span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:<span class=\"number\">07</span></span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">1</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:<span class=\"number\">07</span></span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">3</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:<span class=\"number\">07</span></span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">4</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:<span class=\"number\">07</span></span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">6</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:09</span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">7</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:09</span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">8</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:09</span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">9</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:09</span><br><span class=\"line\">å¼€è½¦ä¸Šç­çš„å‘˜å·¥ï¼špool-<span class=\"number\">1</span>-thread-<span class=\"number\">10</span> æŠ¢åˆ°äº†ä¸€ä¸ªè½¦ä½ï¼š<span class=\"number\">2023</span>-<span class=\"number\">02</span>-<span class=\"number\">03</span> <span class=\"number\">23</span>:<span class=\"number\">01</span>:09</span><br></pre></td></tr></table></figure>\n<h3 id=\"phaser\"><a class=\"markdownIt-Anchor\" href=\"#phaser\">#</a>  <code>Phaser</code></h3>\n<p>è¯´å®è¯ï¼Œè¿™ä¸ªä¸œè¥¿ï¼Œæ˜¯æˆ‘å†™è¿™ç¯‡æ–‡ç« ï¼Œæ”¶è·æœ€å¤§çš„ä¸€ä¸ªä¸œè¥¿ã€‚æ‰«ç›²äº†ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘ç¡®å®ä¸çŸ¥é“è¿˜æœ‰è¿™å“¥ä»¬.</p>\n<p><code>Phaser</code> ï¼ˆç§»ç›¸å™¨ï¼‰æ˜¯ JDK 7 æä¾›çš„ï¼Œæ˜¯ä¸€ä¸ªå¯é‡ç”¨çš„åŒæ­¥å±éšœï¼Œåœ¨åŠŸèƒ½ä¸Šç±»ä¼¼äº CyclicBarrier å’Œ CountDownLatchï¼Œä½†æ”¯æŒæ›´çµæ´»çš„ä½¿ç”¨ã€‚ å®ƒçš„åŠŸèƒ½æ˜¯ç­‰å¾…æ‰€æœ‰çº¿ç¨‹åˆ°è¾¾ä¹‹åï¼Œæ‰ç»§ç»­æˆ–è€…å¼€å§‹è¿›è¡Œæ–°çš„ä¸€ç»„ä»»åŠ¡ã€‚</p>\n<p><code>Phaser</code>  çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæ‰€ä»¥æ–¹æ³•ä¹Ÿæ¯”è¾ƒå¤šï¼Œæˆ‘ç®€å•ä¸€è¯´ï¼Œå¤§å®¶ç»†ç»†ç ”ç©¶ï¼</p>\n<ul>\n<li><code>register()</code> ï¼šæ³¨å†Œæ–°çš„å‚ä¸è€…åˆ°  <code>Phaser</code></li>\n<li><code>arriveAndAwaitAdvance()</code> ï¼šç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œ</li>\n<li><code>arriveAndDeregister()</code> ï¼šæ³¨é”€æ­¤çº¿ç¨‹</li>\n<li><code>forceTermination()</code> ï¼šå¼ºåˆ¶  <code>Phaser</code>  è¿›å…¥ç»ˆæ­¢æ€</li>\n<li><code>isTerminated()</code> ï¼šåˆ¤æ–­  <code>Phaser</code>  æ˜¯å¦ç»ˆæ­¢</li>\n</ul>\n<p>è¿™ä¸ªæˆ‘å¸çš„ <code>case</code>  å°±ä¸å¥½ä¸¾ä¾‹äº†ã€‚å› ä¸ºç­è½¦çš„æ —å­ä¸¾è¿‡äº†å‘€ã€‚ æ‰€ä»¥ï¼Œæˆ‘å°±æƒ³èµ·äº†æœ‰ä¸€æ¬¡æˆ‘åœ¨æ•…å®«ç©ï¼Œçœ‹åˆ°äº†ä¸€ä¸ªæ—…è¡Œå›¢â€¦</p>\n<p>å¯¼æ¸¸: â€œé¦–å…ˆï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šå¤ªå’Œæ®¿ï¼Œxxx (å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§ï¼Œæ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆï¼Œå’±ä»¬å»ä¸‹ä¸€ä¸ªæ®¿â€<br>\nâ€¦ æ—…å®¢åœ¨æ”é¦–å¼„å§¿â€¦<br>\n å¯¼æ¸¸: â€œé‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¸­å’Œæ®¿ï¼Œxxx (å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§ï¼Œæ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆï¼Œå’±ä»¬å»ä¸‹ä¸€ä¸ªæ®¿â€<br>\nâ€¦ æ—…å®¢åœ¨æ”é¦–å¼„å§¿â€¦ãƒ»<br>\nå¯¼æ¸¸: â€œæœ€åï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¿å’Œæ®¿ï¼Œxxx (å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§ï¼Œæ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆï¼Œå’±ä»¬å»çœ‹çœ‹çš‡å¸å’Œçš‡åç¡è§‰çš„åœ°æ–¹â€<br>\n æ—…å®¢ï¼šæ‹å•¥æ‹äº†ï¼Œç›´æ¥å»çœ‹å§</p>\n<p><code>Phaser</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Phaser;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PhaserTest</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¯¼æ¸¸</span></span><br><span class=\"line\">        Phaser phaser = <span class=\"keyword\">new</span> TouristGuide();</span><br><span class=\"line\">        <span class=\"comment\">// æ¸¸å®¢</span></span><br><span class=\"line\">        Tourist[] tourists = <span class=\"keyword\">new</span> Tourist[<span class=\"number\">5</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; tourists.length; i++) &#123;</span><br><span class=\"line\">            tourists[i] = <span class=\"keyword\">new</span> Tourist(phaser, <span class=\"string\">&quot;æ¸¸å®¢&quot;</span> + i);</span><br><span class=\"line\">            <span class=\"comment\">// æ³¨å†Œ Phaser ç­‰å¾…çš„çº¿ç¨‹æ•°ï¼Œæ‰§è¡Œä¸€æ¬¡ç­‰å¾…çº¿ç¨‹æ•° +1</span></span><br><span class=\"line\">            phaser.register();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ¯ä¸ªæ¸¸å®¢è‡ªè¡Œæ´»åŠ¨..</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; tourists.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> Thread(tourists[i]).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Tourist</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Phaser phaser;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Tourist</span><span class=\"params\">(Phaser phaser, String name)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.phaser = phaser;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"keyword\">this</span>.name + <span class=\"string\">&quot; | åˆ°äº†&quot;</span>);</span><br><span class=\"line\">            phaser.arriveAndAwaitAdvance();</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">5</span>) * <span class=\"number\">1000</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"keyword\">this</span>.name + <span class=\"string\">&quot; | æ‹å®Œç…§ç‰‡äº†...&quot;</span>);</span><br><span class=\"line\">                phaser.arriveAndAwaitAdvance();</span><br><span class=\"line\">                Thread.sleep(<span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">5</span>) * <span class=\"number\">1000</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"keyword\">this</span>.name + <span class=\"string\">&quot; | æ‹å®Œç…§ç‰‡äº†...&quot;</span>);</span><br><span class=\"line\">                phaser.arriveAndAwaitAdvance();</span><br><span class=\"line\">                Thread.sleep(<span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">5</span>) * <span class=\"number\">1000</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"keyword\">this</span>.name + <span class=\"string\">&quot;:\\&quot;æ‹å•¥æ‹ï¼Œèµ¶ç´§å»çœ‹çš‡å¸çš‡åç¡è§‰å§\\&quot;&quot;</span>);</span><br><span class=\"line\">                phaser.arriveAndAwaitAdvance();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Phaser æ¯ä¸ªé˜¶æ®µå®Œæˆä¹‹åçš„äº‹ä»¶é€šçŸ¥.  (===&gt; å¯¼æ¸¸ï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TouristGuide</span> <span class=\"keyword\">extends</span> <span class=\"title\">Phaser</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * æ¯ä¸ªé˜¶æ®µæ‰§è¡Œå®Œä¹‹åçš„å›è°ƒ</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onAdvance</span><span class=\"params\">(<span class=\"keyword\">int</span> phase, <span class=\"keyword\">int</span> registeredParties)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (phase) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"number\">0</span> -&gt; &#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;é¦–å…ˆï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šå¤ªå’Œæ®¿, xxx(å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§, æ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆ, å’±ä»¬å»ä¸‹ä¸€ä¸ªæ®¿&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"number\">1</span>-&gt; &#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;é‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¸­å’Œæ®¿, xxx(å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§, æ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆ, å’±ä»¬å»ä¸‹ä¸€ä¸ªæ®¿&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> <span class=\"number\">2</span> -&gt; &#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;æœ€åï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¿å’Œæ®¿, xxx(å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§, æ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆ, å’±ä»¬å»çœ‹çœ‹çš‡å¸å’Œçš‡åç¡è§‰çš„åœ°æ–¹&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">default</span> -&gt; &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ¸¸å®¢0 | åˆ°äº†</span><br><span class=\"line\">æ¸¸å®¢4 | åˆ°äº†</span><br><span class=\"line\">æ¸¸å®¢3 | åˆ°äº†</span><br><span class=\"line\">æ¸¸å®¢2 | åˆ°äº†</span><br><span class=\"line\">æ¸¸å®¢1 | åˆ°äº†</span><br><span class=\"line\">é¦–å…ˆï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šå¤ªå’Œæ®¿, xxx(å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§, æ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆ, å’±ä»¬å»ä¸‹ä¸€ä¸ªæ®¿</span><br><span class=\"line\">æ¸¸å®¢3 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢1 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢2 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢0 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢4 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">é‚£ä¹ˆï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¸­å’Œæ®¿, xxx(å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§, æ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆ, å’±ä»¬å»ä¸‹ä¸€ä¸ªæ®¿</span><br><span class=\"line\">æ¸¸å®¢3 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢4 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢0 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢1 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æ¸¸å®¢2 | æ‹å®Œç…§ç‰‡äº†...</span><br><span class=\"line\">æœ€åï¼Œè¿™é‡Œæˆ‘çœ‹åˆ°çš„æ˜¯ï¼šä¿å’Œæ®¿, xxx(å·´å•¦å•¦ï¼Œè¯´ä¸€é€šå†å²), å¤§å®¶å…ˆå»æ‹ç…§, æ‹å®Œç…§åˆ°æˆ‘è¿™é‡Œé›†åˆ, å’±ä»¬å»çœ‹çœ‹çš‡å¸å’Œçš‡åç¡è§‰çš„åœ°æ–¹</span><br><span class=\"line\">æ¸¸å®¢0:<span class=\"string\">&quot;æ‹å•¥æ‹ï¼Œèµ¶ç´§å»çœ‹çš‡å¸çš‡åç¡è§‰å§&quot;</span></span><br><span class=\"line\">æ¸¸å®¢2:<span class=\"string\">&quot;æ‹å•¥æ‹ï¼Œèµ¶ç´§å»çœ‹çš‡å¸çš‡åç¡è§‰å§&quot;</span></span><br><span class=\"line\">æ¸¸å®¢1:<span class=\"string\">&quot;æ‹å•¥æ‹ï¼Œèµ¶ç´§å»çœ‹çš‡å¸çš‡åç¡è§‰å§&quot;</span></span><br><span class=\"line\">æ¸¸å®¢4:<span class=\"string\">&quot;æ‹å•¥æ‹ï¼Œèµ¶ç´§å»çœ‹çš‡å¸çš‡åç¡è§‰å§&quot;</span></span><br><span class=\"line\">æ¸¸å®¢3:<span class=\"string\">&quot;æ‹å•¥æ‹ï¼Œèµ¶ç´§å»çœ‹çš‡å¸çš‡åç¡è§‰å§&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "æ—¥æ‹±ä¸€å’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2023/02/02/onedayday/2023-02-02.ThreadPool/",
            "url": "https://fangjiaxiaobai.github.io/2023/02/02/onedayday/2023-02-02.ThreadPool/",
            "title": "çº¿ç¨‹æ± å·¥ä½œåŸç†",
            "date_published": "2023-02-02T10:18:18.000Z",
            "content_html": "<h2 id=\"threadpoolexecutor-å‚æ•°è¯´æ˜\"><a class=\"markdownIt-Anchor\" href=\"#threadpoolexecutor-å‚æ•°è¯´æ˜\">#</a>  <code>ThreadPoolExecutor</code>  å‚æ•°è¯´æ˜</h2>\n<p><code>ThreadPoolExecutor</code>  æ„é€ æ–¹æ³•æœ‰ä»¥ä¸‹å››ä¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://images.gitbook.cn/ce89fc40-d2d4-11e9-b6c4-07be7ef1cd0f\" alt=\"enter image descriptionhere\"></p>\n<p>å…¶ä¸­æœ€åä¸€ä¸ªæ„é€ æ–¹æ³•æœ‰  <code>7</code>  ä¸ªæ„é€ å‚æ•°ï¼ŒåŒ…å«äº†å‰ä¸‰ä¸ªæ–¹æ³•çš„æ„é€ å‚æ•°ï¼Œè¿™  <code>7</code>  ä¸ªå‚æ•°åç§°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                            <span class=\"keyword\">int</span> maximumPoolSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                            <span class=\"keyword\">long</span> keepAliveTime,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                            TimeUnit unit,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                            BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                            ThreadFactory threadFactory,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                            RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å…¶ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>\n<h3 id=\"1-corepoolsize\"><a class=\"markdownIt-Anchor\" href=\"#1-corepoolsize\">#</a> â‘   <code>corePoolSize</code></h3>\n<p>çº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ ¸å¿ƒçº¿ç¨‹ä¸€ç›´å­˜æ´»åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå¦‚æœå°†  <code>ThreadPoolExecutor</code>  çš„  <code>allowCoreThreadTimeOut</code>  å±æ€§è®¾ä¸º  <code>true</code> ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸€ç›´é—²ç½®å¹¶è¶…è¿‡äº†  <code>keepAliveTime</code>  æ‰€æŒ‡å®šçš„æ—¶é—´ï¼Œæ ¸å¿ƒçº¿ç¨‹å°±ä¼šè¢«ç»ˆæ­¢ã€‚</p>\n<h3 id=\"2-maximumpoolsize\"><a class=\"markdownIt-Anchor\" href=\"#2-maximumpoolsize\">#</a> â‘¡  <code>maximumPoolSize</code></h3>\n<p>çº¿ç¨‹æ± ä¸­æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœæ´»åŠ¨çš„çº¿ç¨‹è¾¾åˆ°è¿™ä¸ªæ•°å€¼ä»¥åï¼Œåç»­çš„æ–°ä»»åŠ¡å°†ä¼šè¢«é˜»å¡ï¼ˆæ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€‚</p>\n<h3 id=\"3-keepalivetime\"><a class=\"markdownIt-Anchor\" href=\"#3-keepalivetime\">#</a> â‘¢  <code>keepAliveTime</code></h3>\n<p>çº¿ç¨‹æ± çš„é—²ç½®è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯¹éæ ¸å¿ƒçº¿ç¨‹ç”Ÿæ•ˆï¼Œå¦‚æœé—²ç½®æ—¶é—´è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œéæ ¸å¿ƒçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ã€‚å¦‚æœ  <code>ThreadPoolExecutor</code>  çš„<br>\n <code>allowCoreThreadTimeOut</code>  è®¾ä¸º  <code>true</code>  çš„æ—¶å€™ï¼Œæ ¸å¿ƒçº¿ç¨‹å¦‚æœè¶…è¿‡é—²ç½®æ—¶é•¿ä¹Ÿä¼šè¢«å›æ”¶ã€‚</p>\n<h3 id=\"4-unit\"><a class=\"markdownIt-Anchor\" href=\"#4-unit\">#</a> â‘£  <code>unit</code></h3>\n<p>é…åˆ  <code>keepAliveTime</code>  ä½¿ç”¨ï¼Œç”¨æ¥æ ‡è¯†  <code>keepAliveTime</code>  çš„æ—¶é—´å•ä½ã€‚</p>\n<h3 id=\"5-workqueue\"><a class=\"markdownIt-Anchor\" href=\"#5-workqueue\">#</a> â‘¤  <code>workQueue</code></h3>\n<p>çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½¿ç”¨  <code>execute()</code>  æˆ–  <code>submit()</code>  æ–¹æ³•æäº¤çš„ä»»åŠ¡éƒ½ä¼šå­˜å‚¨åœ¨æ­¤é˜Ÿåˆ—ä¸­ã€‚</p>\n<h3 id=\"6-threadfactory\"><a class=\"markdownIt-Anchor\" href=\"#6-threadfactory\">#</a> â‘¥  <code>threadFactory</code></h3>\n<p>ä¸ºçº¿ç¨‹æ± æä¾›åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ã€‚</p>\n<h3 id=\"7-rejectedexecutionhandler\"><a class=\"markdownIt-Anchor\" href=\"#7-rejectedexecutionhandler\">#</a> â‘¦  <code>rejectedExecutionHandler</code></h3>\n<p>çº¿ç¨‹æ± ä»»åŠ¡é˜Ÿåˆ—è¶…è¿‡æœ€å¤§å€¼ä¹‹åçš„æ‹’ç»ç­–ç•¥ï¼Œ   <code>RejectedExecutionHandler</code>  æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ª  <code>rejectedExecution</code>  æ–¹æ³•ï¼Œå¯åœ¨æ­¤æ–¹æ³•å†…æ·»åŠ ä»»åŠ¡è¶…å‡ºæœ€å¤§å€¼çš„äº‹ä»¶å¤„ç†ã€‚  <code>ThreadPoolExecutor</code>  ä¹Ÿæä¾›äº† 4 ç§é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼š</p>\n<ul>\n<li><code>new ThreadPoolExecutor.DiscardPolicy()</code> ï¼šä¸¢å¼ƒæ‰è¯¥ä»»åŠ¡ï¼Œä¸è¿›è¡Œå¤„ç†</li>\n<li><code>new ThreadPoolExecutor.DiscardOldestPolicy()</code> ï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡</li>\n<li><code>new ThreadPoolExecutor.AbortPolicy()</code> ï¼šç›´æ¥æŠ›å‡º  <code>RejectedExecutionException</code>  å¼‚å¸¸</li>\n<li><code>new ThreadPoolExecutor.CallerRunsPolicy()</code> ï¼šæ—¢ä¸æŠ›å¼ƒä»»åŠ¡ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥ä½¿ç”¨ä¸»çº¿ç¨‹æ¥æ‰§è¡Œæ­¤ä»»åŠ¡</li>\n</ul>\n<h2 id=\"çº¿ç¨‹æ± çš„å·¥ä½œåŸç†\"><a class=\"markdownIt-Anchor\" href=\"#çº¿ç¨‹æ± çš„å·¥ä½œåŸç†\">#</a> çº¿ç¨‹æ± çš„å·¥ä½œåŸç†</h2>\n<p>å½“çº¿ç¨‹æ± ä¸­æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­å¦‚æœçº¿ç¨‹æ•°é‡æ²¡æœ‰è¶…è¿‡æ ¸å¿ƒæ•°é‡å°±ä¼šæ–°å»ºçº¿ç¨‹æ± è¿›è¡Œä»»åŠ¡æ‰§è¡Œï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å·²ç»è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè¿™æ—¶å€™ä»»åŠ¡å°±ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œï¼›å¦‚æœä»»åŠ¡é˜Ÿåˆ—è¶…è¿‡æœ€å¤§é˜Ÿåˆ—æ•°ï¼Œå¹¶ä¸”çº¿ç¨‹æ± æ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±ä¼šæ–°å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›å¦‚æœè¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œå°±ä¼šæ‰§è¡Œæ‹’ç»æ‰§è¡Œç­–ç•¥ã€‚</p>\n<h2 id=\"çº¿ç¨‹æ± å…³é—­\"><a class=\"markdownIt-Anchor\" href=\"#çº¿ç¨‹æ± å…³é—­\">#</a> çº¿ç¨‹æ± å…³é—­</h2>\n<p>çº¿ç¨‹æ± å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨  <code>shutdown()</code>  æˆ–  <code>shutdownNow() </code> æ–¹æ³•ï¼Œå®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š</p>\n<ul>\n<li><code>shutdown()</code> ï¼šä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œè€Œæ˜¯è¦ç­‰æ‰€æœ‰ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ä¼šç»ˆæ­¢ã€‚æ‰§è¡Œå®Œ shutdown æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹æ± å°±ä¸ä¼šå†æ¥å—æ–°ä»»åŠ¡äº†ã€‚</li>\n<li><code>shutdownNow()</code> ï¼šæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€ç«‹åˆ»å˜æˆ  <code>STOP</code>  çŠ¶æ€ï¼Œå¹¶è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¸å†å¤„ç†è¿˜åœ¨æ± é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡ï¼Œæ‰§è¡Œæ­¤æ–¹æ³•ä¼šè¿”å›æœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "æ—¥æ‹±ä¸€å’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2023/02/01/onedayday/2023-02-01.ThreadLocal/",
            "url": "https://fangjiaxiaobai.github.io/2023/02/01/onedayday/2023-02-01.ThreadLocal/",
            "title": "ThreadLocal å†…å­˜æº¢å‡º",
            "date_published": "2023-02-01T10:18:18.000Z",
            "content_html": "<h2 id=\"threadlocal-å†…å­˜æº¢å‡ºä»£ç æ¼”ç¤º\"><a class=\"markdownIt-Anchor\" href=\"#threadlocal-å†…å­˜æº¢å‡ºä»£ç æ¼”ç¤º\">#</a> ThreadLocal å†…å­˜æº¢å‡ºä»£ç æ¼”ç¤º</h2>\n<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç å®ç°  <code>ThreadLocal</code>  å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadLocalTest</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ThreadLocal threadLocal = <span class=\"keyword\">new</span> ThreadLocal();</span><br><span class=\"line\">    <span class=\"keyword\">static</span> Integer MOCK_MAX = <span class=\"number\">10000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> Integer THREAD_MAX = <span class=\"number\">100</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        ExecutorService executorService = Executors.newFixedThreadPool(THREAD_MAX);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; THREAD_MAX; i++) &#123;</span><br><span class=\"line\">            executorService.execute(() -&gt; &#123;</span><br><span class=\"line\">                threadLocal.set(<span class=\"keyword\">new</span> ThreadLocalTest().getList());</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName());</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        executorService.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\">List <span class=\"title\">getList</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; MOCK_MAX; i++) &#123;</span><br><span class=\"line\">            list.add(<span class=\"string\">&quot;Versionï¼šJDK 8&quot;</span>);</span><br><span class=\"line\">            list.add(<span class=\"string\">&quot;ThreadLocal&quot;</span>);</span><br><span class=\"line\">            list.add(<span class=\"string\">&quot;Authorï¼šè€ç‹&quot;</span>);</span><br><span class=\"line\">            list.add(<span class=\"string\">&quot;DateTimeï¼š&quot;</span> + LocalDateTime.now());</span><br><span class=\"line\">            list.add(<span class=\"string\">&quot;Testï¼šThreadLocal OOM&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è®¾ç½®  <code>JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰</code> å¯åŠ¨å‚æ•°  <code>-Xmx100m</code>  ï¼ˆæœ€å¤§è¿è¡Œå†…å­˜  <code>100 M</code> ï¼‰ï¼Œè¿è¡Œç¨‹åºä¸ä¹…åå°±ä¼šå‡ºç°å¦‚ä¸‹å¼‚å¸¸ï¼š<br>\n<img data-src=\"https://images.gitbook.cn/8d5895b0-d43c-11e9-b555-8d750b738917\" alt=\"\"></p>\n<p>æ­¤æ—¶æˆ‘ä»¬ç”¨  <code>VisualVM</code>  è§‚å¯Ÿåˆ°ç¨‹åºè¿è¡Œçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå‘ç°å†…å­˜ä¸€ç›´åœ¨ç¼“æ…¢åœ°ä¸Šå‡ç›´åˆ°å†…å­˜è¶…å‡ºæœ€å¤§å€¼ï¼Œä»è€Œå‘ç”Ÿå†…å­˜æº¢å‡ºçš„æƒ…å†µã€‚</p>\n<p>å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img data-src=\"https://images.gitbook.cn/9eacecd0-d43c-11e9-b555-8d750b738917\" alt=\"\"></p>\n<h4 id=\"å†…å­˜æº¢å‡ºåŸç†åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#å†…å­˜æº¢å‡ºåŸç†åˆ†æ\">#</a> å†…å­˜æº¢å‡ºåŸç†åˆ†æ</h4>\n<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸‹  <code>ThreadLocal</code>  æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ã€‚<br>\né¦–å…ˆï¼Œæ‰¾åˆ°  <code>ThreadLocal.set()</code>  çš„æºç ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">set</span><span class=\"params\">(T value)</span> </span>&#123;</span><br><span class=\"line\">    Thread t = Thread.currentThread();</span><br><span class=\"line\">    ThreadLocalMap map = getMap(t);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (map != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        map.set(<span class=\"keyword\">this</span>, value);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        createMap(t, value);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹å‡º  <code>ThreadLocal</code>  é¦–å…ˆè·å–åˆ° ThreadLocalMap å¯¹è±¡ï¼Œç„¶åå†æ‰§è¡Œ  <code>ThreadLocalMap.set()</code>  æ–¹æ³•ï¼Œè¿›è€Œæ‰“å¼€æ­¤æ–¹æ³•çš„æºç ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">set</span><span class=\"params\">(ThreadLocal&lt;?&gt; key, Object value)</span> </span>&#123;</span><br><span class=\"line\">    Entry[] tab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len = tab.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = key.threadLocalHashCode &amp; (len-<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Entry e = tab[i];</span><br><span class=\"line\">         e != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">         e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class=\"line\">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (k == key) &#123;</span><br><span class=\"line\">            e.value = value;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (k == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            replaceStaleEntry(key, value, i);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    tab[i] = <span class=\"keyword\">new</span> Entry(key, value);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> sz = ++size;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class=\"line\">        rehash();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»æ•´ä¸ªä»£ç å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆ  <code>ThreadLocal</code>  å¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯ä¾é   <code>ThreadLocalMap</code>  æ¥å­˜å‚¨æ•°æ®ï¼Œ <code>ThreadLocalMap</code>  ä¸­æœ‰ä¸€ä¸ª<br>\n <code>Entry</code>  æ•°ç»„ï¼Œæ¯ä¸ª  <code>Entry</code>  å¯¹è±¡æ˜¯ä»¥ K/V çš„å½¢å¼å¯¹æ•°æ®è¿›è¡Œå­˜å‚¨çš„ï¼Œå…¶ä¸­  <code>K</code>  å°±æ˜¯  <code>ThreadLocal</code>  æœ¬èº«ï¼Œè€Œ V<br>\n å°±æ˜¯è¦å­˜å‚¨çš„å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"https://images.gitbook.cn/b2f02680-d43c-11e9-a4b6-d1d2b628f523\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹å‡ºï¼šä¸€ä¸ª Thread ä¸­åªæœ‰ä¸€ä¸ª  <code>ThreadLocalMap</code> ï¼Œæ¯ä¸ª  <code>ThreadLocalMap</code>  ä¸­å­˜æœ‰å¤šä¸ª  <code>ThreadLocal</code> ï¼Œ <code>ThreadLocal</code>  å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"https://images.gitbook.cn/8cb725e0-d7bb-11e9-b208-c16ced46e7a1\" alt=\"enter image descriptionhere\"></p>\n<p>å…¶ä¸­ï¼šå®çº¿ä»£è¡¨å¼ºå¼•ç”¨ï¼Œè™šçº¿ä»£è¡¨å¼±å¼•ç”¨ï¼ˆå¼±å¼•ç”¨å…·æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œä¸€æ—¦å‘ç°åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ï¼‰ã€‚</p>\n<p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±ç†è§£äº†  <code>ThreadLocal</code>  é€ æˆå†…å­˜æº¢å‡ºçš„åŸå› ï¼šå¦‚æœ ThreadLocal æ²¡æœ‰è¢«ç›´æ¥å¼•ç”¨ï¼ˆå¤–éƒ¨å¼ºå¼•ç”¨ï¼‰ï¼Œåœ¨ GCï¼ˆåƒåœ¾å›æ”¶ï¼‰æ—¶ï¼Œç”±äº<br>\n <code>ThreadLocalMap</code>  ä¸­çš„  <code>key</code>  æ˜¯å¼±å¼•ç”¨ï¼Œæ‰€ä»¥ä¸€å®šå°±ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥  <code>ThreadLocalMap</code>  ä¸­å°±ä¼šå‡ºç°  <code>key</code>  ä¸º  <code>null</code>  çš„<br>\n Entryï¼Œå¹¶ä¸”æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›æ•°æ®ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯ï¼Œè¿™äº›  <code>key</code>  ä¸º  <code>null</code>  çš„  <code>Entry</code>  çš„  <code>value</code>  å°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾ï¼š <code>Thread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; value</code>  å¹¶ä¸”æ°¸è¿œæ— æ³•å›æ”¶ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p>\n<h2 id=\"è§£å†³\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³\">#</a> è§£å†³</h2>\n<p>åˆ‡è®° ç”¨å®Œä¹‹åå°±  <code>remove</code>  æ‰ï¼</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "æ—¥æ‹±ä¸€å’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/11/04/MySQL-series/MySQL-7-03-BinLog/",
            "url": "https://fangjiaxiaobai.github.io/2022/11/04/MySQL-series/MySQL-7-03-BinLog/",
            "title": "MySQL æ—¥å¿—ç³»ç»Ÿ - binLog",
            "date_published": "2022-11-04T10:18:18.000Z",
            "content_html": "<h2 id=\"å‰è¨€\"><a class=\"markdownIt-Anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9pbnRlcm5hbHMvZW4vYmluYXJ5LWxvZy1vdmVydmlldy5odG1s\">MySQL æ‰‹å†Œ - binary Log</span></p>\n<h2 id=\"ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h2>\n<p><code>binLog</code>  æ—¥å¿—ç³»ç»Ÿæ˜¯ç”±ä¸€ç»„äºŒè¿›åˆ¶æ–‡ä»¶å’Œä¸€ä¸ªç´¢å¼•æ–‡ä»¶ç»„æˆã€‚</p>\n<p><code>binLog</code>  å…¨ç§°æ˜¯  <code>binary log</code> ï¼Œå³ä¸ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ã€‚ <code>binlog</code>  æ˜¯è®°å½•æ‰€æœ‰æ•°æ®åº“è¡¨ç»“æ„å˜æ›´ä»¥åŠè¡¨æ•°æ®ä¿®æ”¹çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚ä¸ä¼šè®°å½• <code>Select</code> , <code>show</code>  ç­‰æ“ä½œã€‚ <code>binLog</code>  æ—¥å¿—æ˜¯ä»¥äº‹ä»¶å½¢å¼è®°å½•ï¼ŒåŒ…å«äº†è¯­å¥æ‰§è¡Œçš„æ¶ˆè€—æ—¶é—´ï¼Œæ­£ç¡®é‡ç°è¯¥è¯­å¥æ‰€éœ€çš„æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ï¼Œé”™è¯¯ä»£ç ï¼Œç»´æŠ¤ <code>binlog</code>  æœ¬èº«æ‰€éœ€çš„å…ƒæ•°æ®ç­‰ã€‚</p>\n<p>å‡†ç¡®åœ°è¯´:<br>\n äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶æè¿°äº†å¯ç”¨äºé‡ç°æœåŠ¡å™¨ä¸Šå‘ç”Ÿçš„ç›¸åŒå…¨å±€çŠ¶æ€æ›´æ”¹çš„æ“ä½œã€‚</p>\n<p>ç´¢å¼•æ–‡ä»¶æ˜¯è®°å½•äº†å½“å‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p>\n<p>æ—¥å¿—æ–‡ä»¶ä½¿ç”¨.NNNNNN åç¼€é¡ºåºç¼–å·ã€‚ ç´¢å¼•æ–‡ä»¶çš„åç¼€ä¸º.indexã€‚ æ‰€æœ‰æ–‡ä»¶å…±äº«ä¸€ä¸ªé€šç”¨åŸºåã€‚ é»˜è®¤çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å‘½ååŸºåç§°ä¸º â€œHOSTNAME-binâ€ã€‚ ä½¿ç”¨é»˜è®¤çš„åŸºæœ¬åç§°ï¼ŒäºŒè¿›åˆ¶æ—¥å¿—åŒ…å«å…·æœ‰ä»¥ä¸‹åç§°çš„æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># bin-logæ–‡ä»¶</span><br><span class=\"line\">fangjiaxiaobai-bin.0000001</span><br><span class=\"line\">fangjiaxiaobai-bin.0000002</span><br><span class=\"line\">fangjiaxiaobai-bin.0000003</span><br><span class=\"line\">...</span><br><span class=\"line\"># ç´¢å¼•æ–‡ä»¶</span><br><span class=\"line\">fangjiaxiaobai-bin.index</span><br></pre></td></tr></table></figure>\n<h2 id=\"binlog-çš„ä½¿ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#binlog-çš„ä½¿ç”¨åœºæ™¯\">#</a> binLog çš„ä½¿ç”¨åœºæ™¯ã€‚</h2>\n<ul>\n<li>ä¸»ä»å¤åˆ¶ï¼šä¸»åº“ä¸­å¼€å¯ <code>binlog</code> , ä»åº“è¯»å– <code>binlog</code>  åï¼Œæ‰§è¡Œ <code>binlog</code> ï¼Œä»è€Œè¾¾åˆ°æ•°æ®ä¸€è‡´æ€§ã€‚</li>\n<li>æ•°æ®æ¢å¤ï¼šé€šè¿‡ä¿å­˜çš„ <code>binlog</code> ï¼Œå¯ä»¥ä½¿ç”¨ <code>mysqlbinlog</code>  å·¥å…·æ¥æ¢å¤æ•°æ®ã€‚</li>\n</ul>\n<h2 id=\"binlong-è®°å½•æ¨¡å¼\"><a class=\"markdownIt-Anchor\" href=\"#binlong-è®°å½•æ¨¡å¼\">#</a> binlong è®°å½•æ¨¡å¼</h2>\n<p><code>binLog</code>  æ–‡ä»¶é»˜è®¤ä¸º <code>&lt;ä¸»æœºå&gt;_binlog_&lt;åºåˆ—å·&gt;</code>  æ ¼å¼ã€‚ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šåç§°ã€‚<br>\næ–‡ä»¶è®°å½•æ¨¡å¼æœ‰  <code>STATEMENT</code> , <code>ROW</code> , <code>MIXED</code>  ä¸‰ç§ã€‚å…·ä½“å«ä¹‰å¦‚ä¸‹:</p>\n<ul>\n<li><code>ROW</code> ğŸ˜¦ <code>row-based replication</code> , <code>RBR</code> )ï¼š æ—¥å¿—ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œæ•°æ®è¢«ä¿®æ”¹çš„æƒ…å†µï¼Œç„¶å <code>Slave</code>  ç«¯å¯¹ç›¸åŒçš„æ•°æ®è¿›è¡Œä¿®æ”¹.\n<ul>\n<li>ä¼˜ç‚¹ï¼šå¯ä»¥æ¸…æ¥šçš„è®°å½•æ¯è¡Œæ•°æ®çš„ä¿®æ”¹ç»†èŠ‚ï¼Œèƒ½å®Œå…¨å®ç°ä¸»ä»æ•°æ®åŒæ­¥å’Œæ•°æ®çš„æ¢å¤ã€‚</li>\n<li>ç¼ºç‚¹ï¼šæ‰¹é‡æ“ä½œä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œå°¤å…¶æ˜¯ <code>alter table</code>  æ“ä½œï¼Œä¼šè®©æ—¥å¿—çˆ†æ¶¨ã€‚</li>\n</ul>\n</li>\n<li><code>STATEMENT</code> : ( <code>statement-based replication,SBR</code> )ï¼š\n<ul>\n<li>ä¼˜ç‚¹ï¼šæ—¥å¿—é‡å°ï¼Œå‡å°‘ç£ç›˜ IO, æä¾›å­˜å‚¨å’Œæ¢å¤é€Ÿåº¦ã€‚</li>\n<li>ç¼ºç‚¹ï¼š ä¸å¯é ã€‚å¦‚æœæ˜¯ä¸»ä»æ¶æ„çš„è¯ä½¿ç”¨ <code>last_insert_id()</code> , <code>now()</code>  ç­‰å‡½æ•°ï¼Œä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚</li>\n</ul>\n</li>\n<li><code>MIXED</code> : ( <code>mixed-based replication</code> ,  <code>MBR</code> )ï¼šä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ··åˆä½¿ç”¨ã€‚é»˜è®¤ä½¿ç”¨ <code>STATEMENT</code>  æ¨¡å¼ä¿å­˜  <code>binlog</code> , ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦åˆ‡æ¢åˆ° <code>ROW</code>  æ¨¡å¼ï¼Œå¯¹äº <code>STATEMENT</code>  æ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œä½¿ç”¨ <code>ROW</code>  æ¨¡å¼ä¿å­˜ <code>binlog</code> , <code>MySQL</code>  ä¼šæ ¹æ®æ‰§è¡Œçš„ <code>SQL</code>  è¯­å¥é€‰æ‹©å†™å…¥æ¨¡å¼ã€‚</li>\n</ul>\n<h2 id=\"binlog-æ–‡ä»¶æ ¼å¼\"><a class=\"markdownIt-Anchor\" href=\"#binlog-æ–‡ä»¶æ ¼å¼\">#</a> binLog æ–‡ä»¶æ ¼å¼</h2>\n<p><code>binlog</code>  æ–‡ä»¶çš„æ ¼å¼ä¹Ÿéšç€ <code>mysql</code>  çš„å‘å±•ï¼Œå‘ç”Ÿäº†å‡ æ¬¡å˜æ›´ã€‚<br>\näºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ ¼å¼æœ‰å‡ ä¸ªç‰ˆæœ¬:<br>\n <code>v1ç‰ˆæœ¬</code> ï¼šåœ¨ <code>MySQL3.23</code>  ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚<br>\n <code>v2ç‰ˆæœ¬</code> ï¼šåœ¨æ—©æœŸçš„ <code>MySQL 4.0</code>  ä¸­ï¼Œç®€å•åœ°ä½¿ç”¨äº† <code>v2</code>  æ ¼å¼ã€‚)ï¼Œä½†å®ƒå·²ç»è¿‡æ—¶ï¼Œä¸å†å—æ”¯æŒã€‚<br>\n <code>v3ç‰ˆæœ¬</code> ï¼šåœ¨ <code>MySQL 4.0.2</code>  åˆ° <code>4.1</code>  ä¸­ä½¿ç”¨ã€‚<br>\n <code>v4ç‰ˆæœ¬</code> ï¼šé€‚ç”¨äº <code>MySQL 5.0</code>  åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</p>\n<p>ä¸€ä¸ª <code>binlog</code>  æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆ: <b>4 å­—èŠ‚çš„é­”æ•°</b> å’Œ <b>æ ‡è¯†æ–‡ä»¶æ ¼å¼çš„åˆå§‹æè¿°ç¬¦äº‹ä»¶</b>ã€‚å¹¶ä¸”ï¼šåˆè¯†æè¿°ç¬¦äº‹ä»¶ä¹Ÿæ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:  <code>header</code>  å’Œ  <code>data</code>  éƒ¨åˆ†ã€‚</p>\n<p>è¿™é‡Œåªä»‹ç» V4 ç‰ˆæœ¬:<br>\n<img data-src=\"/images/MySQL-series/BinLog-even%E5%9B%BE%E7%A4%BA%E7%BB%93%E6%9E%84.png\" alt=\"BinLog-eventå›¾ç¤ºç»“æ„.png\"></p>\n<p>åœ¨ <code>event header</code>  è¿™ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸‹å­—æ®µ:</p>\n<ul>\n<li><code>timestamp</code> :  <code>4</code>  ä¸ªå­—èŠ‚ã€‚ æ ‡è¯†æŸæ¡è¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶é—´ã€‚å®ƒè¡¨ç¤ºä¸ºè‡ª <code>1970</code>  å¹´ä»¥æ¥çš„ç§’æ•° ( <code>UTC</code> )ï¼Œä¸ <code>SQL</code>  æ—¶é—´æˆ³æ•°æ®ç±»å‹ç±»ä¼¼ã€‚</li>\n<li><code>type_code</code> :  <code>1</code>  ä¸ªå­—èŠ‚ã€‚äº‹ä»¶çš„ç±»å‹ã€‚ <code>1</code>  è¡¨ç¤ºå¼€å§‹äº‹ä»¶ <code>V3</code> ,  <code>2</code>  è¡¨ç¤ºæŸ¥è¯¢äº‹ä»¶ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¿™äº›æ•°å­—åœ¨ Log event.h ä¸­çš„ <code>enum</code>  æ—¥å¿—äº‹ä»¶ç±»å‹æšä¸¾ä¸­å®šä¹‰ã€‚(è¯·å‚é˜…é™„å½• 1ã€‚)</li>\n<li><code>server_id</code> :4 å­—èŠ‚ã€‚ æœ€åˆåˆ›å»ºäº‹ä»¶çš„ <code>mysqld</code>  æœåŠ¡å™¨çš„ <code>ID</code> ã€‚ å®ƒæ¥è‡ªæœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­ä¸ºå¤åˆ¶ç›®çš„è®¾ç½®çš„ <code>server-id</code>  é€‰é¡¹ã€‚ ä½¿ç”¨å¾ªç¯å¤åˆ¶æ—¶ï¼ˆä½¿ç”¨é€‰é¡¹ <code>--log-slave-updates</code>  å¯ç”¨ï¼‰ï¼ŒæœåŠ¡å™¨ ID å¯ä»¥é¿å…æ— é™å¾ªç¯</li>\n<li><code>event_length</code> : 4 ä¸ªå­—èŠ‚ã€‚è¿™æ¬¡æ´»åŠ¨çš„æ€»è§„æ¨¡ã€‚è¿™åŒ…æ‹¬å¤´å’Œæ•°æ®éƒ¨åˆ†ã€‚å¤§å¤šæ•°äº‹ä»¶å°äº <code>1000</code>  å­—èŠ‚ï¼Œé™¤äº†ä½¿ç”¨åŠ è½½æ•°æ® INFILE æ—¶ (å…¶ä¸­äº‹ä»¶åŒ…å«åŠ è½½çš„æ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥å¾ˆå¤§)</li>\n<li><code>next_position</code> : 4 ä¸ªå­—èŠ‚ã€‚ä¸‹ä¸€ä¸ªäº‹ä»¶åœ¨ä¸»ç¨‹åºäºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„ä½ç½®ã€‚è¿™ä¸ªå­—æ®µä¸»è¦æ˜¯åœ¨ <code>slave</code>  ç«¯ä½¿ç”¨ï¼š\n<ul>\n<li>ä¸ºäº†æ˜¾ç¤º <code>Slave</code>  çš„çŠ¶æ€ï¼Œèƒ½å¤Ÿåœ¨ä¸»åæ ‡ç³»ç»Ÿä¸­æ˜¾ç¤º æœ€åæ‰§è¡Œçš„äº‹ä»¶çš„åæ ‡ã€‚</li>\n<li>ä¸ºäº†éªŒè¯  <code>START SLAVE UNTIL MASTER LOG FILE=x</code> ,  <code>MASTER LOG POS=y</code> ï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨ MASTER çš„åæ ‡ã€‚</li>\n</ul>\n</li>\n<li><code>flags</code> :  <code>1</code>  ä¸ªå­—èŠ‚ã€‚æ ‡è¯†ã€‚å…·ä½“å«ä¹‰è§é™„å½• 2ã€‚</li>\n<li><code>extra_headers</code> ï¼š å¤§å°å¯å˜çš„ã€‚æ­¤å­—æ®µçš„å¤§å°ç”±ä½œä¸ºæ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„æ ¼å¼æè¿°äº‹ä»¶å†³å®šã€‚ç›®å‰ï¼Œå¤§å°ä¸º <code>0</code> ï¼Œå› æ­¤ï¼Œå®é™…ä¸Šï¼Œè¯¥å­—æ®µåœ¨ä»»ä½•äº‹ä»¶ä¸­éƒ½ä¸ä¼šå®é™…å‘ç”Ÿã€‚å½“å¤§å°å˜ä¸ºéé›¶æ—¶ï¼Œè¯¥å­—æ®µä»ç„¶ä¸ä¼šå‡ºç°åœ¨æ ¼å¼æè¿°äº‹ä»¶æˆ–æ—‹è½¬äº‹ä»¶ç±»å‹çš„äº‹ä»¶ä¸­ã€‚</li>\n</ul>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯¦ç»†çš„çœ‹ä¸‹ <code>event-data</code>  éƒ¨åˆ†çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„.</p>\n<p><img data-src=\"/images/MySQL-series/binLog-event%E6%A0%BC%E5%BC%8F.png\" alt=\"binLog-eventæ ¼å¼.png\"></p>\n<p><code>event-data</code>  è¡¨ç¤ºï¼šç‰¹å®šçš„äº‹ä»¶æ•°æ®ã€‚<br>\näº‹ä»¶çš„æ•°æ®éƒ¨åˆ†ç”±å›ºå®šå¤§å°çš„éƒ¨åˆ†å’Œå¯å˜å¤§å°çš„éƒ¨åˆ†ç»„æˆã€‚ æ ¹æ®äº‹ä»¶ç±»å‹ï¼Œè¿™ä¸¤ä¸ªéƒ¨åˆ†ä¸­çš„ä¸€ä¸ªæˆ–ä¸¤ä¸ªéƒ½å¯èƒ½ä¸ºç©ºã€‚ äº‹ä»¶æ•°æ®éƒ¨åˆ†çš„å¤§å°æ˜¯äº‹ä»¶å¤§å°ï¼ˆåŒ…å«åœ¨æ ‡å¤´ä¸­ï¼‰å‡å»æ ‡å¤´å¤§å°ã€‚ å›ºå®šæ•°æ®éƒ¨åˆ†çš„å¤§å°æ˜¯äº‹ä»¶ç±»å‹çš„å‡½æ•°ã€‚ å¯å˜æ•°æ®éƒ¨åˆ†çš„å¤§å°æ˜¯äº‹ä»¶å¤§å°å‡å»æ ‡é¢˜çš„å¤§å°å†å‡å»å›ºå®šæ•°æ®éƒ¨åˆ†çš„å¤§å°ã€‚</p>\n<p>binLog çš„åŸºæœ¬æ¦‚å¿µå°±ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸‹é¢å±•ç¤ºä¸€äº› binlog ç›¸å…³çš„å‘½ä»¤:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹binLogå±æ€§</span></span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\"> show variables like <span class=\"string\">&#x27;%log_bin%&#x27;</span>;</span></span><br><span class=\"line\">+---------------------------------+-------------------------------------------------------------+</span><br><span class=\"line\">| Variable_name                   | Value                                                       |</span><br><span class=\"line\">+---------------------------------+-------------------------------------------------------------+</span><br><span class=\"line\">| log_bin                         | ON                                                          |</span><br><span class=\"line\">| log_bin_basename                | /usr/local/mysql-8.0.20-macos10.15-x86_64/data/binlog       |</span><br><span class=\"line\">| log_bin_index                   | /usr/local/mysql-8.0.20-macos10.15-x86_64/data/binlog.index |</span><br><span class=\"line\">| log_bin_trust_function_creators | OFF                                                         |</span><br><span class=\"line\">| log_bin_use_v1_row_events       | OFF                                                         |</span><br><span class=\"line\">| sql_log_bin                     | ON                                                          |</span><br><span class=\"line\">+---------------------------------+-------------------------------------------------------------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># å¼€å¯/å…³é—­ binLogåŠŸèƒ½ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ã€‚</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">set</span> global log_bin; ä¼šæŠ¥é”™ã€‚</span></span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æŸ¥çœ‹binlogæ–‡ä»¶</span></span></span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\"> show binary logs;</span></span><br><span class=\"line\">+---------------+-----------+-----------+</span><br><span class=\"line\">| Log_name      | File_size | Encrypted |</span><br><span class=\"line\">+---------------+-----------+-----------+</span><br><span class=\"line\">| binlog.000038 |       156 | No        |</span><br><span class=\"line\">| binlog.000039 |       156 | No        |</span><br><span class=\"line\">| binlog.000040 |       179 | No        |</span><br><span class=\"line\">| binlog.000041 |       179 | No        |</span><br><span class=\"line\">| binlog.000042 |       179 | No        |</span><br><span class=\"line\">| binlog.000043 |      5307 | No        |</span><br><span class=\"line\">| binlog.000044 |       179 | No        |</span><br><span class=\"line\">| binlog.000045 |       156 | No        |</span><br><span class=\"line\">+---------------+-----------+-----------+</span><br><span class=\"line\">8 rows in set (0.01 sec)</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\"> show master status</span></span><br><span class=\"line\">    -&gt; ;</span><br><span class=\"line\">+---------------+----------+--------------+------------------+-------------------+</span><br><span class=\"line\">| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class=\"line\">+---------------+----------+--------------+------------------+-------------------+</span><br><span class=\"line\">| binlog.000045 |      156 |              |                  |                   |</span><br><span class=\"line\">+---------------+----------+--------------+------------------+-------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\"> show binlog events;</span></span><br><span class=\"line\">+---------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class=\"line\">| Log_name      | Pos | Event_type     | Server_id | End_log_pos | Info                              |</span><br><span class=\"line\">+---------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class=\"line\">| binlog.000038 |   4 | Format_desc    |         1 |         125 | Server ver: 8.0.20, Binlog ver: 4 |</span><br><span class=\"line\">| binlog.000038 | 125 | Previous_gtids |         1 |         156 |                                   |</span><br><span class=\"line\">+---------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">ERROR 1220 (HY000): Error when executing command SHOW BINLOG EVENTS: Could not find target log</span><br><span class=\"line\"><span class=\"meta\">mysql&gt;</span><span class=\"bash\"> show binlog events <span class=\"keyword\">in</span> <span class=\"string\">&#x27;binlog.000045&#x27;</span>;</span></span><br><span class=\"line\">+---------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class=\"line\">| Log_name      | Pos | Event_type     | Server_id | End_log_pos | Info                              |</span><br><span class=\"line\">+---------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class=\"line\">| binlog.000045 |   4 | Format_desc    |         1 |         125 | Server ver: 8.0.20, Binlog ver: 4 |</span><br><span class=\"line\">| binlog.000045 | 125 | Previous_gtids |         1 |         156 |                                   |</span><br><span class=\"line\">+---------------+-----+----------------+-----------+-------------+-----------------------------------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># ä½¿ç”¨ mysqlbinlog å‘½ä»¤</span></span></span><br><span class=\"line\">mysqlbinlog &#x27;æ–‡ä»¶å&#x27;</span><br><span class=\"line\">mysqlbinlog &#x27;æ–‡ä»¶å&#x27; &gt; test.sql</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># ä½¿ç”¨binLogæ¢å¤æ•°æ®</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŒ‡å®šæ—¶é—´æ¢å¤</span></span><br><span class=\"line\">mysqlbinlog --start-datetime=&#x27;2020-12-01 00:00:00&#x27; --stop-datetime=&#x27;2020-12-02 00:00:00&#x27;  binlog.000045 | mysql -uroot -p123456</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŒ‡å®šä½ç½®æ¢å¤</span></span><br><span class=\"line\">mysqlbinlog --start-pos=100 --stop-pos=120  binlog.000045 | mysql -uroot -p123456</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># åˆ é™¤binlog</span></span></span><br><span class=\"line\">purge binary log to &#x27;binlog.000001&#x27;</span><br><span class=\"line\">purge binary log before &#x27;2020-12-01 00:00:00&#x27;</span><br><span class=\"line\">reset master;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"é™„å½•\"><a class=\"markdownIt-Anchor\" href=\"#é™„å½•\">#</a> é™„å½•</h2>\n<p>1: äº‹ä»¶ç±»å‹</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Log_event_type</span> &#123;</span> </span><br><span class=\"line\">  UNKNOWN_EVENT= <span class=\"number\">0</span>, </span><br><span class=\"line\">  START_EVENT_V3= <span class=\"number\">1</span>, </span><br><span class=\"line\">  QUERY_EVENT= <span class=\"number\">2</span>, </span><br><span class=\"line\">  STOP_EVENT= <span class=\"number\">3</span>, </span><br><span class=\"line\">  ROTATE_EVENT= <span class=\"number\">4</span>, </span><br><span class=\"line\">  INTVAR_EVENT= <span class=\"number\">5</span>, </span><br><span class=\"line\">  LOAD_EVENT= <span class=\"number\">6</span>, </span><br><span class=\"line\">  SLAVE_EVENT= <span class=\"number\">7</span>, </span><br><span class=\"line\">  CREATE_FILE_EVENT= <span class=\"number\">8</span>, </span><br><span class=\"line\">  APPEND_BLOCK_EVENT= <span class=\"number\">9</span>, </span><br><span class=\"line\">  EXEC_LOAD_EVENT= <span class=\"number\">10</span>, </span><br><span class=\"line\">  DELETE_FILE_EVENT= <span class=\"number\">11</span>, </span><br><span class=\"line\">  NEW_LOAD_EVENT= <span class=\"number\">12</span>, </span><br><span class=\"line\">  RAND_EVENT= <span class=\"number\">13</span>, </span><br><span class=\"line\">  USER_VAR_EVENT= <span class=\"number\">14</span>, </span><br><span class=\"line\">  FORMAT_DESCRIPTION_EVENT= <span class=\"number\">15</span>, </span><br><span class=\"line\">  XID_EVENT= <span class=\"number\">16</span>, </span><br><span class=\"line\">  BEGIN_LOAD_QUERY_EVENT= <span class=\"number\">17</span>, </span><br><span class=\"line\">  EXECUTE_LOAD_QUERY_EVENT= <span class=\"number\">18</span>, </span><br><span class=\"line\">  TABLE_MAP_EVENT = <span class=\"number\">19</span>, </span><br><span class=\"line\">  PRE_GA_WRITE_ROWS_EVENT = <span class=\"number\">20</span>, </span><br><span class=\"line\">  PRE_GA_UPDATE_ROWS_EVENT = <span class=\"number\">21</span>, </span><br><span class=\"line\">  PRE_GA_DELETE_ROWS_EVENT = <span class=\"number\">22</span>, </span><br><span class=\"line\">  WRITE_ROWS_EVENT = <span class=\"number\">23</span>, </span><br><span class=\"line\">  UPDATE_ROWS_EVENT = <span class=\"number\">24</span>, </span><br><span class=\"line\">  DELETE_ROWS_EVENT = <span class=\"number\">25</span>, </span><br><span class=\"line\">  INCIDENT_EVENT= <span class=\"number\">26</span>, </span><br><span class=\"line\">  HEARTBEAT_LOG_EVENT= <span class=\"number\">27</span>, </span><br><span class=\"line\">  IGNORABLE_LOG_EVENT= <span class=\"number\">28</span>,</span><br><span class=\"line\">  ROWS_QUERY_LOG_EVENT= <span class=\"number\">29</span>,</span><br><span class=\"line\">  WRITE_ROWS_EVENT = <span class=\"number\">30</span>,</span><br><span class=\"line\">  UPDATE_ROWS_EVENT = <span class=\"number\">31</span>,</span><br><span class=\"line\">  DELETE_ROWS_EVENT = <span class=\"number\">32</span>,</span><br><span class=\"line\">  GTID_LOG_EVENT= <span class=\"number\">33</span>,</span><br><span class=\"line\">  ANONYMOUS_GTID_LOG_EVENT= <span class=\"number\">34</span>,</span><br><span class=\"line\">  PREVIOUS_GTIDS_LOG_EVENT= <span class=\"number\">35</span>, </span><br><span class=\"line\">  ENUM_END_EVENT </span><br><span class=\"line\">  <span class=\"comment\">/* end marker */</span> </span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>2: æ ‡è¯†</p>\n<ul>\n<li>LOG_EVENT_BINLOG_IN_USE_F = 0x1 (New in 5.0.3) ï¼šç”¨äºæŒ‡ç¤ºäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ˜¯å¦å·²æ­£ç¡®å…³é—­ã€‚å®ƒæ˜¯åœ¨äº‹ä»¶å†™å…¥æ—¥å¿—æ–‡ä»¶æ—¶è®¾ç½®çš„ã€‚ç¨åå…³é—­æ—¥å¿—æ–‡ä»¶æ—¶ï¼Œè¯¥æ ‡å¿—å°†è¢«æ¸…é™¤ã€‚è¯¥æ ‡å¿—ä»…å¯¹ FORMAT_DESCRIPTION_EVENT æœ‰æ„ä¹‰ã€‚</li>\n<li>LOG_EVENT_THREAD_SPECIFIC_F = 0x4 (New in 4.1.0)ï¼šä»…ç”± mysqlbinlog ä½¿ç”¨ï¼ˆæ ¹æœ¬æ²¡æœ‰å¤åˆ¶ä»£ç ä½¿ç”¨ï¼‰ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ­£ç¡®å¤„ç†ä¸´æ—¶è¡¨ã€‚</li>\n<li>LOG_EVENT_SUPPRESS_USE_F = 0x8 (New in 4.1.7)ï¼šç¦æ­¢åœ¨è¦è®°å½•çš„å®é™…è¯­å¥ä¹‹å‰ç”Ÿæˆ USE è¯­å¥ã€‚</li>\n<li>LOG_EVENT_UPDATE_TABLE_MAP_VERSION_F = 0x10 (New in 5.1.4)ï¼šå°†äº‹ä»¶å†™å…¥æ—¥å¿—åï¼Œå¯¼è‡´äºŒè¿›åˆ¶æ—¥å¿—å†…éƒ¨çš„è¡¨æ˜ å°„ç‰ˆæœ¬å¢åŠ ã€‚</li>\n</ul>\n<p>æ˜æ—¥å†è§ï½</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±ï½ï¼Œä¸€èµ·äº¤æµï¼Œä¸€èµ·è¿›æ­¥</p>\n<p><img data-src=\"/images/MySQL-series/qrcode.jpg\" alt=\"qrcode.jpg\"></p>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/11/03/MySQL-series/MySQL-2-01.MySQL-artific/",
            "url": "https://fangjiaxiaobai.github.io/2022/11/03/MySQL-series/MySQL-2-01.MySQL-artific/",
            "title": "05.ä½“ç³»æ¶æ„",
            "date_published": "2022-11-03T10:18:18.000Z",
            "content_html": "<p>æœ¬ç¯‡æ–‡ç« æ˜¯æˆ‘ä»¬ã€æ·±å…¥ä¸€ç‚¹ç‚¹ã€‘éƒ¨åˆ†ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæ—¢ç„¶æˆ‘ä»¬è¦ â€œæ·±å…¥ä¸€ç‚¹ç‚¹â€ï¼Œé‚£ä¹ˆå°±å‰¥å¼€ MySQL çš„å¤–è¡£ï½<br>\n å…ˆçœ‹çœ‹ MySQL çš„å„ä¸ª â€œéƒ¨ä½â€ã€‚<br>\næ•´ä½“æ¥è¯´ï¼ŒMySQL ä½“ç³»æ•´ä½“åˆ†ä¸ºå®¢æˆ·ç«¯è¿æ¥å™¨ï¼ŒæœåŠ¡ç«¯ï¼Œå­˜å‚¨å¼•æ“ä¸‰éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¯¦ç»†çš„èŠèŠ MySQL æ•°æ®çš„ä½“ç³»ç»“æ„è¿™ä¸ªè¯é¢˜ã€‚</p>\n<p>æœ¬æ–‡æˆ‘ä»¬å›´ç»•ç€ä¸‹é¢è¿™å¼ å›¾æ¥è¯´ã€‚</p>\n<p><img data-src=\"/images/MySQL-series/20101-MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%9B%BE.png\" alt=\"20101-MySQLä½“ç³»ç»“æ„å›¾.png\"></p>\n<h2 id=\"å®¢æˆ·ç«¯è¿æ¥å™¨\"><a class=\"markdownIt-Anchor\" href=\"#å®¢æˆ·ç«¯è¿æ¥å™¨\">#</a> å®¢æˆ·ç«¯è¿æ¥å™¨</h2>\n<p>ä¸»è¦çš„åŠŸèƒ½æ˜¯ï¼šè´Ÿè´£å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€‚æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰å†™è¿‡çš„  <code>mysql -p</code>  å‘½ä»¤å’Œä½¿ç”¨ <code>java</code>  è¿æ¥æ•°æ®åº“çš„ç¨‹åºå°±æ˜¯å……å½“è¿™ä¸ªè§’è‰²ã€‚</p>\n<h2 id=\"serverå±‚\"><a class=\"markdownIt-Anchor\" href=\"#serverå±‚\">#</a> Server å±‚</h2>\n<h3 id=\"è¿æ¥æ± è¿æ¥å™¨\"><a class=\"markdownIt-Anchor\" href=\"#è¿æ¥æ± è¿æ¥å™¨\">#</a> è¿æ¥æ±  (è¿æ¥å™¨)</h3>\n<p>å¦‚ä¸Šå›¾ä¸­ <code>connect pool</code>  éƒ¨åˆ†æ‰€ç¤ºã€‚</p>\n<p>ä¸»è¦æ˜¯è´Ÿè´£ç®¡å®¢æˆ·ç«¯å’Œæ•°æ®åº“åˆ›å»ºçš„è¿æ¥ï¼Œç»´æŒï¼Œå¤„ç†ï¼Œå’Œç”¨æˆ·è®¤è¯ï¼Œå³ç”¨æˆ·ç™»å½•èº«ä»½çš„è®¤è¯å’Œé‰´æƒåŠå®‰å…¨ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·æ‰§è¡Œæ“ä½œæƒé™æ ¡éªŒã€‚</p>\n<p>å½“æˆ‘ä»¬è¾“å…¥  <code>mysql -p</code>  è¿™ç±»å‘½ä»¤å»è¿æ¥æ•°æ®åº“çš„æ—¶å€™ï¼Œè¾“å…¥å‘½ä»¤çš„ shell æ˜¯å®¢æˆ·ç«¯çš„è§’è‰²ï¼Œè¿æ¥åˆ°æ•°æ®åº“ä¸­ç»„ä»¶å°±æ˜¯è¿æ¥å™¨äº†ã€‚</p>\n<p>å½“æˆ‘è¾“å…¥ <code>mysql -p</code> , ä¹‹åï¼Œshell ä¸­æ˜¾ç¤º  <code>enter password:</code>  è¿™ä¸ªå°±æ˜¯è¿æ¥å™¨åšå‡ºçš„å“åº”ï¼Œæˆ‘ä»¬è¾“å…¥å¯†ç è¿›å…¥åï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ï¼š <code>show processlist</code>  æ¥æŸ¥çœ‹è¿æ¥æ± ä¸­æ‰€æœ‰çš„è¿æ¥ã€‚å¦‚ä¸‹å›¾</p>\n<p><img data-src=\"/images/MySQL-series/20103-%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%86%85%E5%AE%B9.png\" alt=\"20103-æŸ¥çœ‹è¿æ¥æ± å†…å®¹.png\"></p>\n<h3 id=\"dæŸ¥è¯¢ç¼“å­˜mysql80ä¸­å·²ç»åˆ é™¤äº†æ­¤åŠŸèƒ½d\"><a class=\"markdownIt-Anchor\" href=\"#dæŸ¥è¯¢ç¼“å­˜mysql80ä¸­å·²ç»åˆ é™¤äº†æ­¤åŠŸèƒ½d\">#</a> <d>æŸ¥è¯¢ç¼“å­˜ (MySQL8.0 ä¸­å·²ç»åˆ é™¤äº†æ­¤åŠŸèƒ½)</d></h3>\n<p><del>å›¾ç‰‡æ˜¯è€å›¾ï¼Œåœ¨ <code>MySQL8.0</code>  ç‰ˆæœ¬ä¸­å·²ç»åˆ é™¤ã€‚æ‰€ä»¥è¯¥éƒ¨åˆ†ä¸åšè¯´æ˜</del></p>\n<h3 id=\"è§£æå™¨parser\"><a class=\"markdownIt-Anchor\" href=\"#è§£æå™¨parser\">#</a> è§£æå™¨ ( <code>parser</code> )</h3>\n<p>ä¸»è¦è´Ÿè´£å¯¹ SQL çš„è¯­å¥è¿›è¡Œè§£æï¼Œç”Ÿæˆè§£ææ ‘ã€‚</p>\n<p>é¦–å…ˆä¼šå°† SQL è¯­å¥è§£ææˆæ•°æ®åº“ç»“æ„ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ•°æ®ç»“æ„ä¼ é€’åˆ°åç»­çš„æ­¥éª¤ä¸­ã€‚å¦‚æœå†è§£æçš„è¿‡ç¨‹ä¸­å‘ç°é”™è¯¯ï¼Œå°±ç›´æ¥è¿”å›é”™è¯¯ç»“æœã€‚</p>\n<h3 id=\"ä¼˜åŒ–å™¨optimizer\"><a class=\"markdownIt-Anchor\" href=\"#ä¼˜åŒ–å™¨optimizer\">#</a> ä¼˜åŒ–å™¨ ( <code>Optimizer</code> )</h3>\n<p>ç»è¿‡äº†è§£æå™¨çš„å·¥ä½œä¹‹åï¼Œ <code>MySQL Server</code>  å°±çŸ¥é“äº†ä½ çš„éœ€æ±‚æ˜¯ä»€ä¹ˆäº†ï¼Œä¼˜åŒ–å™¨çš„å·¥ä½œå°±æ˜¯å¯¹éœ€æ±‚è¿›è¡Œä¼˜åŒ–ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½è¦æ±‚ã€‚</p>\n<p>ä¸»è¦çš„å·¥ä½œæ˜¯ï¼šä¼˜åŒ–å™¨ä¼šæ ¹æ®è§£ææ ‘ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ç´¢å¼•ï¼Œç„¶åæŒ‰ç…§æ‰§è¡Œè®¡åˆ’æ‰§è¡Œ  <code>SQL</code>  è¯­è¨€å¹¶ä¸å„ä¸ªå­˜å‚¨å¼•æ“äº¤äº’ã€‚</p>\n<p>æ¯”å¦‚æœ‰ä¸€æ¡ SQL :  <code> select * from test01_optimizer where id = 1 and value=1;</code></p>\n<p>å†æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰ä¸€ä¸‹ä¸¤ç§æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>å…ˆå¯¹æ¯”è¡¨ä¸­çš„æ•°æ®ï¼Œæ‰¾åˆ° id=1 çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶ååœ¨è¿™äº›æ•°æ®ä¸­å†å»æŸ¥æ‰¾æ‰€æœ‰ value=1 çš„æ•°æ®ã€‚</li>\n<li>å…ˆå¯¹æ¯”è¡¨ä¸­çš„æ•°æ®ï¼Œæ‰¾åˆ°æ‰€æœ‰ value=2 çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶åå†è¿™äº›æ•°æ®ä¸­å†å»æŸ¥æ‰¾æ‰€æœ‰ id=1 çš„æ•°æ®ã€‚</li>\n</ul>\n<p>ä¼˜åŒ–å™¨å°±æ˜¯ç¡®å®šä½¿ç”¨æ€§èƒ½æ›´é«˜ä¸€ç‚¹çš„æ–¹æ¡ˆå»æ‰§è¡Œä»»åŠ¡ã€‚</p>\n<h3 id=\"æ‰§è¡Œå™¨\"><a class=\"markdownIt-Anchor\" href=\"#æ‰§è¡Œå™¨\">#</a> æ‰§è¡Œå™¨</h3>\n<p>é€šè¿‡ä¸Šä¸€æ­¥ä¼˜åŒ–å™¨çš„å·¥ä½œï¼Œå¾—åˆ°äº†è¯¥æ¡ SQL çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œæ‰§è¡Œå™¨å°±ä¼šæŒ‰ç…§æ‰§è¡Œæ–¹æ¡ˆå»æ‰§è¡ŒæŸ¥è¯¢ã€‚</p>\n<p>æŸ¥è¯¢æ‰§è¡Œå¼•æ“ä¼šæ ¹æ® SQL ä¸è¯­å¥ä¸­ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ç±»å‹ï¼Œè°ƒç”¨ä¸åŒå¯¹åº”çš„ API æ¥å£ï¼Œå»ä¸åº•å±‚å­˜å‚¨å¼•æ“ç¼“å­˜æˆ–è€…ç‰©ç†æ–‡ä»¶äº¤äº’ï¼Œå¾—åˆ°æŸ¥è¯¢ç»“æœï¼Œå¹¶ç”± MySQL è¿‡æ»¤åï¼Œå°†æŸ¥è¯¢ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>\n<h2 id=\"å­˜å‚¨å¼•æ“å±‚\"><a class=\"markdownIt-Anchor\" href=\"#å­˜å‚¨å¼•æ“å±‚\">#</a> å­˜å‚¨å¼•æ“å±‚</h2>\n<p>å­˜å‚¨å¼•æ“æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ InnoDBï¼ŒMyISAM ç­‰ç­‰ï¼Œåé¢æˆ‘ä»¬ä¼šæœ‰ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»å­˜å‚¨å¼•æ“ï¼Œè¿™é‡Œä¸å¤šè¯´ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯¦ç»†çš„æ¥è¯´ä¸‹ MySQL æœåŠ¡å™¨ç«¯çš„å„ä¸ªç»„ä»¶çš„å·¥ä½œåŸç†ã€‚<br>\nè¿™ç¯‡æ–‡ç« å°±åˆ°è¿™é‡Œå•¦ï½</p>\n<p>æ˜æ—¥å†è§ï½</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±ï½ï¼Œä¸€èµ·äº¤æµï¼Œä¸€èµ·è¿›æ­¥</p>\n<p><img data-src=\"/images/MySQL-series/qrcode.jpg\" alt=\"qrcode.jpg\"></p>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/11/02/MySQL-series/MySQL-1-04.connect_to_server/",
            "url": "https://fangjiaxiaobai.github.io/2022/11/02/MySQL-series/MySQL-1-04.connect_to_server/",
            "title": "04.è¿æ¥åˆ°æœåŠ¡ç«¯",
            "date_published": "2022-11-02T10:18:18.000Z",
            "content_html": "<p>åŒå­¦ï¼Œ <code>MySQL</code>  æ•°æ®åº“ï¼Œä¸€èˆ¬æŒ‡çš„ <code>MySQL</code>  æœåŠ¡ç«¯ã€‚ä½†æ˜¯ <code>MySQL</code>  è‡ªå·±å‘¢ä¹Ÿæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨  <code>mysql</code>  åœ¨ <code>shell</code>  çª—å£ä¸­è¿æ¥æ•°æ®åº“æ—¶ï¼Œå…¶å®è¿™å°±æ˜¯ä»¥ä¸€ä¸ªå®¢æˆ·ç«¯çš„èº«ä»½å»è¿æ¥åˆ° <code>MySQL</code>  çš„æœåŠ¡ç«¯çš„ã€‚</p>\n<p>æœ¬ç« ï¼Œå°±ä»‹ç»ä¸‹å¸¸ç”¨è¿æ¥æ•°æ®åº“çš„æ–¹å¼:</p>\n<ul>\n<li>MySQL client è¿æ¥</li>\n<li>Java - JDBC åŸç”Ÿçš„è¿æ¥</li>\n<li>Python è¿æ¥</li>\n<li>go è¿æ¥</li>\n</ul>\n<h2 id=\"mysql-client-è¿æ¥æ•°æ®åº“\"><a class=\"markdownIt-Anchor\" href=\"#mysql-client-è¿æ¥æ•°æ®åº“\">#</a>  <code>MySQL client</code>  è¿æ¥æ•°æ®åº“</h2>\n<p>è¿™ç§è¿æ¥æ–¹å¼ï¼Œåœ¨ä¸Šä¸€ç«  <code>MySQL</code>  æ•°æ®åº“çš„å®‰è£…ä¸­æˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡äº†ã€‚è¿™é‡Œå‘¢æˆ‘ä»¬å†è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹ã€‚</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨  <code>mysql --help</code>  å‘½ä»¤ï¼ŒæŸ¥çœ‹ <code>mysql</code>  å‘½ä»¤å¯ä»¥æ‹¼æ¥çš„å‚æ•°ã€‚å›è½¦ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„å‚æ•°</p>\n<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦åˆ—ä¸¾ä¸‹ï¼Œè¿æ¥ç”¨åˆ°çš„å‚æ•°ï¼š</p>\n<ul>\n<li>-h : host ï¼Œè¡¨ç¤ºéœ€è¦è¿æ¥çš„ä¸»æœºåœ°å€ã€‚ é»˜è®¤æ˜¯ localhost</li>\n<li>-P : port , è¡¨ç¤ºè¦å»ºç«‹è¿æ¥çš„ä¸»æœºç«¯å£ã€‚é»˜è®¤æ˜¯ 3306</li>\n<li>-u : user , è¡¨ç¤ºå»ºç«‹è¿æ¥ä½¿ç”¨çš„ç”¨æˆ·åã€‚ é»˜è®¤æ˜¯ root</li>\n<li>-p : password , è¡¨ç¤ºå»ºç«‹è¿æ¥ä½¿ç”¨çš„å¯†ç ã€‚</li>\n</ul>\n<p>å»ºç«‹è¿æ¥æ—¶ï¼Œå®Œæ•´çš„å‘½ä»¤æ˜¯:  <code>mysql -h 127.0.0.1 -P 3306 -u root -p</code>  è¡¨ç¤ºä½¿ç”¨  <code>root</code>  ç”¨æˆ·ï¼Œè¿æ¥ <code>127.0.0.1</code>  çš„ <code>3306</code>  ç«¯å£ã€‚<br>\nå›è½¦ä¹‹åï¼Œè¾“å…¥å¯†ç ï¼Œå›è½¦ï¼Œå³å¯ç™»é™†æˆåŠŸã€‚</p>\n<p><img data-src=\"/images/MySQL-series/10301-%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10301-ç™»å½•æ•°æ®åº“.png\"></p>\n<p>åœ¨æ˜ç™½äº†è¿™å‡ ä¸ªé€‰é¡¹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨  <code>mysql -p</code>  æ¥ç™»å½•æœ¬æœºçš„ <code>MySQL</code>  æœåŠ¡ç«¯ã€‚</p>\n<p><img data-src=\"/images/MySQL-series/10302-%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10302-ç™»å½•æ•°æ®åº“.png\"></p>\n<p>å»ºç«‹è¿æ¥ä¹‹åï¼Œæ€ä¹ˆé€€å‡ºå‘¢ï¼Ÿæœ‰ä¸‰ç§æ–¹å¼å¯ä»¥é€€å‡ºã€‚</p>\n<ul>\n<li>è¾“å…¥  <code>exit</code>  å‘½ä»¤</li>\n<li>è¾“å…¥  <code>quit</code>  å‘½ä»¤</li>\n<li>ä½¿ç”¨  <code>control + D</code></li>\n</ul>\n<h3 id=\"ä½¿ç”¨jdbcè¿æ¥mysqlæ•°æ®åº“\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨jdbcè¿æ¥mysqlæ•°æ®åº“\">#</a> ä½¿ç”¨ <code>JDBC</code>  è¿æ¥ <code>MySQL</code>  æ•°æ®åº“</h3>\n<p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ <code>MySQL-client</code>  è¿æ¥ä¸Šæ•°æ®åº“ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å»åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å’Œå®Œæˆå»ºè¡¨æ“ä½œ</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">drop</span> database test01_jdbc;</span><br><span class=\"line\">Query OK, <span class=\"number\">0</span> <span class=\"keyword\">rows</span> affected (<span class=\"number\">0.08</span> sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">create</span> database test01_jdbc;</span><br><span class=\"line\">Query OK, <span class=\"number\">1</span> <span class=\"type\">row</span> affected (<span class=\"number\">0.06</span> sec)</span><br><span class=\"line\"></span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> use test01_jdbc;</span><br><span class=\"line\">Database changed</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">create</span> <span class=\"keyword\">table</span> test1(id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key auto_increment, <span class=\"keyword\">value</span> <span class=\"type\">int</span> );</span><br><span class=\"line\">Query OK, <span class=\"number\">0</span> <span class=\"keyword\">rows</span> affected (<span class=\"number\">0.29</span> sec)</span><br></pre></td></tr></table></figure>\n<p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶ä¸‹é¢çš„ä»£ç ï¼Œåˆ°ä½ çš„ç¼–è¾‘å™¨é‡Œè¿›è¡Œæ‰§è¡Œã€‚æºç æˆ‘æ”¾åˆ° <code>github</code>  é‡Œäº†ã€‚åœ°å€åœ¨å…¬ä¼—å·é‡Œå“¦</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDemo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Connection connection = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        PreparedStatement preparedStatement = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        ResultSet resultSet = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 1.åŠ è½½é©±åŠ¨</span></span><br><span class=\"line\">            Class.forName(<span class=\"string\">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">// æ¢æˆä½ çš„æ•°æ®åº“åœ°å€</span></span><br><span class=\"line\">            String url = <span class=\"string\">&quot;jdbc:mysql://10.127.138.75:3306/test01_jdbc&quot;</span>;</span><br><span class=\"line\">            String username = <span class=\"string\">&quot;root&quot;</span>;</span><br><span class=\"line\">            String password = <span class=\"string\">&quot;123456&quot;</span>;</span><br><span class=\"line\">            <span class=\"comment\">/// è·å–è¿æ¥</span></span><br><span class=\"line\">            connection = DriverManager.getConnection(url, username, password);</span><br><span class=\"line\">            String sql = <span class=\"string\">&quot;show tables&quot;</span>;</span><br><span class=\"line\">            <span class=\"comment\">// åˆ›å»º Statement</span></span><br><span class=\"line\">            preparedStatement = connection.prepareStatement(sql);</span><br><span class=\"line\">            <span class=\"comment\">// æ‰§è¡Œç»“æœï¼Œè·å–resultSet</span></span><br><span class=\"line\">            resultSet = preparedStatement.executeQuery();</span><br><span class=\"line\">            <span class=\"comment\">// å¤„ç†ç»“æœ</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (resultSet.next()) &#123;</span><br><span class=\"line\">                System.out.println(resultSet.getString(<span class=\"number\">1</span>));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å…³é—­è¿æ¥</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span>!=resultSet) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    resultSet.close();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (SQLException throwables) &#123;</span><br><span class=\"line\">                    throwables.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span>!=preparedStatement) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    preparedStatement.close();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (SQLException throwables) &#123;</span><br><span class=\"line\">                    throwables.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span>!=connection) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    connection.close();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (SQLException throwables) &#123;</span><br><span class=\"line\">                    throwables.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œç»“æœ:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test1</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œå‘¢ï¼Œå°±ç®€å•çš„ç†è§£ä¸‹ï¼Œ <code>Java</code>  è¿æ¥ <code>MySQL</code>  æœåŠ¡ç«¯çš„è¿‡ç¨‹ã€‚å®é™…çš„å¼€å‘ä¸­ä¹Ÿä¸ä¼šé‡åˆ°è¿™ç§å†™æ³•ï¼Œä½†æ˜¯éƒ½æ˜¯ä½¿ç”¨è¿™ç§åŸç†è¿›è¡Œäº†å°è£…å’Œä¼˜åŒ–ï¼Œæ¯”å¦‚æ•°æ®åº“çš„è¿æ¥æ± çš„ä½¿ç”¨ã€‚è¿™é‡Œå°±ç†è§£ä¸‹ï¼Œä½¿ç”¨ <code>Java</code>  å®ç°äº†æ•°æ®åº“çš„å®¢æˆ·ç«¯è¿æ¥ã€‚</p>\n<p>å…¶ä»–è¯­è¨€è¿æ¥æ•°æ®åº“çš„æ–¹å¼ï¼Œæˆ‘æ”¾åˆ° <code>github</code>  ä»“åº“é‡Œã€‚æœ‰éœ€è¦çš„è‡ªå–å“ˆã€‚åœ¨å…¬ä¼—å·é‡Œå›å¤ã€è¿æ¥æ•°æ®åº“ã€‘å°±å¯ä»¥è·å–å•¦ï½</p>\n<p>æœ€åï¼Œå¸Œæœ›å’Œä½ æˆä¸ºæœ‹å‹ï¼Œä¸€èµ·äº¤æµï½</p>\n<p><img data-src=\"/images/MySQL-series/qrcode.jpg\" alt=\"qrcode.jpg\"></p>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/11/01/MySQL-series/MySQL-1-02.install/",
            "url": "https://fangjiaxiaobai.github.io/2022/11/01/MySQL-series/MySQL-1-02.install/",
            "title": "02.å®‰è£…MySQL",
            "date_published": "2022-11-01T10:18:18.000Z",
            "content_html": "<p>å®˜ç½‘ä¸Šæœ‰å¾ˆå¤šç§å®‰è£…æ–¹å¼:<br>\n <code>https://dev.mysql.com/doc/refman/8.0/en/installing.html</code></p>\n<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä¸€ç§æ¯”è¾ƒæ¸…æ™°å’Œç®€å•çš„å®‰è£…æ–¹å¼è¿›è¡Œå®‰è£….</p>\n<h2 id=\"å‡†å¤‡\"><a class=\"markdownIt-Anchor\" href=\"#å‡†å¤‡\">#</a> å‡†å¤‡</h2>\n<h3 id=\"mysql-80çš„rpm-å®‰è£…åŒ…\"><a class=\"markdownIt-Anchor\" href=\"#mysql-80çš„rpm-å®‰è£…åŒ…\">#</a> MySQL 8.0 çš„ rpm å®‰è£…åŒ…</h3>\n<p>åœ¨é¡µé¢  <code>https://dev.mysql.com/downloads/repo/yum/</code>  ä¸­æ ¹æ®è‡ªå·±çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬é€‰æ‹©éœ€è¦ä¸‹è½½çš„æ•°æ®åº“ç‰ˆæœ¬ã€‚<br>\nï¼ˆæŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬ä½¿ç”¨  <code>uname -a</code>  å°±å¯ä»¥äº†ï¼Œï¼‰</p>\n<p><img data-src=\"/images/MySQL-series/10101-%E6%9F%A5%E7%9C%8B%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%89%88%E6%9C%AC.png\" alt=\"10101-æŸ¥çœ‹æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬.png\"></p>\n<p>è¿™é‡Œçœ‹åˆ°æˆ‘çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬æ˜¯  <code>el7</code> . æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>el7</code>  ç‰ˆæœ¬çš„ æ•°æ®åº“å°±å¯ä»¥äº†ã€‚</p>\n<p><img data-src=\"/images/MySQL-series/10102-%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC.png\" alt=\"10102-ä¸‹è½½æ•°æ®åº“ç‰ˆæœ¬.png\"></p>\n<p>ä¸‹è½½ä¸‹æ¥ä¹‹åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå®‰è£…æ•°æ®åº“ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/MySQL-series/10103-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10103-å®‰è£…æ•°æ®åº“.png\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install mysql-server</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/MySQL-series/10104-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10104-å®‰è£…æ•°æ®åº“.png\"></p>\n<p>ä¿®æ”¹ <code>MySQL</code>  æ–‡ä»¶æƒé™</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown mysql:mysql -R /var/lib/mysql</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/MySQL-series/10105-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10105-å®‰è£…æ•°æ®åº“.png\"></p>\n<p>åˆå§‹åŒ– <code>MySQL</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqld --initialize</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/MySQL-series/10106-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10106-å®‰è£…æ•°æ®åº“.png\"></p>\n<p>å¯åŠ¨ <code>MySQL</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start mysqld</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/MySQL-series/10107-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10107-å®‰è£…æ•°æ®åº“.png\"></p>\n<p>æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status mysqld.service</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/MySQL-series/10107-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93.png\" alt=\"10107-å®‰è£…æ•°æ®åº“.png\"></p>\n<p>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl enable mysqld</span><br><span class=\"line\">systemctl daemon-reload</span><br></pre></td></tr></table></figure>\n<p>æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqladmin --version</span><br></pre></td></tr></table></figure>\n<p>è®¾ç½®æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç </p>\n<p>MySQL é»˜è®¤çš„ç”¨æˆ·åä¸º rootï¼Œå¯†ç å‘¢ï¼Ÿ</p>\n<p>å®˜æ–¹æ–‡æ¡£é‡Œè¯´ï¼›</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A superuser account &#x27;root&#x27;@&#x27;localhost&#x27; is created. A password for the superuser is set and stored in the error log file. To reveal it, use the following command for RHEL, Oracle Linux, CentOS, and Fedora systems:</span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨  <code>shell&gt; sudo grep 'temporary password' /var/log/mysqld.log</code>  æˆ–è€…  <code> sudo grep 'temporary password' /var/log/mysql/mysqld.log</code>  è¿™æ¡å‘½ä»¤å°±å¯ä»¥æŸ¥è¯¢åˆ°äº†ï¼Œæˆ‘è¯•äº†ã€‚ã€‚æˆ‘ä¿¡ä½ ä¸ªé¬¼ã€‚</p>\n<p><img data-src=\"/images/MySQL-series/10110-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93%E9%97%AE%E9%A2%98.png\" alt=\"10110-å®‰è£…æ•°æ®åº“é—®é¢˜.png\"></p>\n<p>å¹¶æ²¡æœ‰ã€‚ã€‚</p>\n<p>è¿˜æ˜¯å¼ºåˆ¶å¤„ç†å§ã€</p>\n<ul>\n<li>é¦–å…ˆï¼šåœæ­¢ MySQL æœåŠ¡ï¼š  <code>systemctl stop mysqld</code></li>\n<li>ç„¶åè·³è¿‡éªŒè¯å¯åŠ¨ï¼š <code>mysqld --user=root --skip-grant-tables &amp;</code></li>\n<li>ç„¶åï¼š <code>mysqlï¼šmysql -u root -p</code> , è¾“å…¥å¯†ç æ˜¯ç›´æ¥å›è½¦ã€‚</li>\n<li>è¿›å…¥åï¼šæ‰§è¡Œ  <code>flush privileges;</code></li>\n<li>æœ€å  <code>flush privileges;</code></li>\n<li>é€€å‡ºï¼Œé‡å¯æ­£å¸¸å¯åŠ¨ MySQL</li>\n</ul>\n<p>ç™»å½•æˆåŠŸï¼Œè‡³æ­¤ï¼Œæ•°æ®åº“å®‰è£…å®Œæ¯•ï¼</p>\n<h2 id=\"é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#é—®é¢˜\">#</a> é—®é¢˜</h2>\n<p>è¿è¡Œ  <code>systemctl start mysqld</code>  å¯åŠ¨ MySQL çš„æ—¶å€™ï¼Œå‡ºç°ä¸‹é¢çš„æŠ¥é”™</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Job for mysqld.service failed because the control process exited with error code. See &quot;systemctl status mysqld.service&quot; and &quot;journalctl -xe&quot; for details.</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªæ—¶å€™æŸ¥çœ‹ MySQL çš„å¯åŠ¨æ—¥å¿—</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -n 200 /var/log/mysqld.log </span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/MySQL-series/10109-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93%E9%97%AE%E9%A2%98.png\" alt=\"10109-å®‰è£…æ•°æ®åº“é—®é¢˜.png\"></p>\n<p>æƒé™é—®é¢˜ï¼Œæ— æ³•åˆ›å»º  <code>/varlib/mysql/</code>  è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p>\n<p>åªéœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹ç›®å½•çš„æƒé™å°±å¯ä»¥äº†ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chgrp -R mysql  /var/lib/mysql/ &amp;&amp; chown -R mysql  /var/lib/mysql/</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/09/19/k8s/seris100-kuboard/",
            "url": "https://fangjiaxiaobai.github.io/2022/09/19/k8s/seris100-kuboard/",
            "title": "k8s ç›‘æ§ç¥å™¨ kuboard",
            "date_published": "2022-09-19T10:18:00.000Z",
            "content_html": "<p><code>Kubernetes</code>  å®¹å™¨ç¼–æ’å·²è¶Šæ¥è¶Šè¢«å¤§å®¶å…³æ³¨ï¼Œç„¶è€Œå­¦ä¹   <code>Kubernetes</code>  çš„é—¨æ§›å´ä¾ç„¶å¾ˆé«˜ï¼Œä¸»è¦ä½“ç°åœ¨è¿™å‡ ä¸ªæ–¹é¢ï¼š</p>\n<ul>\n<li>é›†ç¾¤çš„å®‰è£…å¤æ‚</li>\n<li><code>Kubernetes</code>  ç›¸è¾ƒäºå®¹å™¨ï¼Œå¼•å…¥äº†è®¸å¤šæ–°çš„æ¦‚å¿µ</li>\n<li>éœ€è¦æ‰‹å·¥ç¼–å†™  <code>YAML</code>  æ–‡ä»¶</li>\n<li>æ²¡æœ‰å¥½çš„å‚è€ƒæ¡ˆä¾‹å¯ä»¥éµå¾ª</li>\n</ul>\n<p>ä»Šå¤©ç»™å¤§å®¶ä»‹ç»çš„è¿™æ¬¾å·¥å…·  <code>Kuboard</code> ï¼Œæ˜¯ä¸€æ¬¾å…è´¹çš„  <code>Kubernetes</code>  å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼Œ <code>Kuboard</code>  åŠ›å›¾å¸®åŠ©ç”¨æˆ·å¿«é€Ÿåœ¨  <code>Kubernetes</code>  ä¸Šè½åœ°å¾®æœåŠ¡ã€‚ä¸ºäº†è¾¾åˆ°æ­¤ç›®æ ‡ï¼Œ <code>Kuboard</code>  æä¾›äº†é’ˆå¯¹ä¸Šè¿°é—®é¢˜çš„è§£å†³åŠæ³•ï¼š</p>\n<p><code>Kuboard</code>  æä¾›  <code>Kubernetes</code>  å…è´¹å®‰è£…æ–‡æ¡£ã€å…è´¹åœ¨çº¿ç­”ç–‘ï¼Œæ¯å¤©çº¦æœ‰  <code>200</code>  ä½ç½‘å‹å‚ç…§  <code>Kuboard</code>  æä¾›çš„æ–‡æ¡£è¿›è¡Œ K8S é›†ç¾¤å®‰è£…ã€‚<br>\n <code>Kuboard</code>  æä¾›  <code>Kubernetes</code>  å…è´¹ä¸­æ–‡æ•™ç¨‹ã€ç”¨æˆ·æ— éœ€ä»˜è´¹è´­ä¹°è§†é¢‘æ•™ç¨‹æˆ–å‚åŠ çº¿ä¸‹åŸ¹è®­ç­ï¼Œå°±å¯å‚ç…§  <code>Kuboard</code>  æä¾›çš„å…è´¹æ•™ç¨‹å®Œæˆ  <code>K8S</code>  çš„å­¦ä¹ ï¼Œæ›´æœ‰  <code>QQ</code>  ç¤¾ç¾¤å¯ä»¥å’Œç½‘å‹äº’ç›¸è®¨è®ºï¼Œå…±åŒè¿›æ­¥ã€‚<br>\n <code>Kuboard</code>  æ˜¯  <code>Kubernetes</code>  çš„ä¸€æ¬¾å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ Kuboardï¼Œç”¨æˆ·æ— éœ€ç¼–å†™  <code>YAML</code>  æ–‡ä»¶ï¼Œå°±å¯ä»¥å®Œæˆåº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œç®¡ç†ã€‚<br>\n <code>Kuboard</code>  æä¾›  <code>Spring Cloud</code>  ç­‰å¾®æœåŠ¡å‚è€ƒæ¶æ„åœ¨  <code>K8S</code>  ä¸Šçš„è¯¦ç»†éƒ¨ç½²æ–‡æ¡£å’Œæ­¥éª¤ï¼Œæ˜¯  <code>Spring Cloud</code>  ç”¨æˆ·å°†è‡ªå·±çš„åº”ç”¨è¿ç§»åˆ°  <code>K8S</code>  éƒ¨ç½²ç¯å¢ƒçš„éå¸¸å¥½çš„å‚è€ƒèµ„æ–™ã€‚<br>\n <code>Kuboard</code>  æ˜¯ä¸€æ¬¾ä¸“ä¸º  <code>Kubernetes</code>  è®¾è®¡çš„å…è´¹ç®¡ç†ç•Œé¢ï¼Œå…¼å®¹  <code>Kubernetes</code>  ç‰ˆæœ¬  <code>1.13</code>  åŠä»¥ä¸Šã€‚ <code>Kuboard</code>  æ¯å‘¨å‘å¸ƒä¸€ä¸ª  <code>beta</code>  ç‰ˆæœ¬ï¼Œæœ€é•¿æ¯æœˆå‘å¸ƒä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ï¼Œç»è¿‡ä¸¤å¹´çš„ä¸æ–­è¿­ä»£å’Œä¼˜åŒ–ï¼Œå·²ç»å…·å¤‡å¤šé›†ç¾¤ç®¡ç†ã€æƒé™ç®¡ç†ã€ç›‘æ§å¥—ä»¶ã€æ—¥å¿—å¥—ä»¶ç­‰ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¹¶ä¸”æœ‰  <code>1000+</code>  çš„ä¼ä¸šå°†  <code>Kuboard</code>  åº”ç”¨äºå…¶ç”Ÿäº§ç¯å¢ƒã€‚ <code>Kuboard</code>  è‡ª  <code>2019å¹´8æœˆ</code> å‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ä»¥æ¥ï¼Œå¾—åˆ°äº†ä¼—å¤šç”¨æˆ·çš„è®¤å¯ï¼Œç›®å‰å·²ç»è·å¾—äº†  <code>10000+ GitHub Star</code></p>\n<h2 id=\"å®‰è£…\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…\">#</a> å®‰è£…</h2>\n<h3 id=\"ç»™-master-èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾\"><a class=\"markdownIt-Anchor\" href=\"#ç»™-master-èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾\">#</a> ç»™  <code>master</code>  èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾.</h3>\n<p>é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹  <code>master</code>  èŠ‚ç‚¹æ˜¯å¦æœ‰  <code>&quot;k8s.kuboard.cn/role=etcd&quot;</code>  æ ‡ç­¾:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get nodes --show-labels=true</span><br></pre></td></tr></table></figure>\n<p>å¦‚æœæœ‰åˆ™è¿›è¡Œä¸‹ä¸€æ­¥.<br>\n å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ æ ‡ç­¾:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl label nodes k8s-master-01 k8s.kuboard.cn/role=etcd</span><br></pre></td></tr></table></figure>\n<p>å…¶ä¸­ å°†  <code>k8s-master-01</code>  æ›¿æ¢æˆä½ çš„ <code>master</code>  èŠ‚ç‚¹ã€‚</p>\n<h3 id=\"å®‰è£…-kuboard\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…-kuboard\">#</a> å®‰è£… kuboard.</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl create -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæŸ¥çœ‹å¯åŠ¨æƒ…å†µ</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8s-master-01 yamls]# kubectl get pod -n kuboard</span><br><span class=\"line\">NAME                               READY   STATUS    RESTARTS      AGE</span><br><span class=\"line\">kuboard-agent-2-8644cd44c9-wdq5h   1/1     Running   2 (21m ago)   22m</span><br><span class=\"line\">kuboard-agent-8467cc9799-2n4wl     1/1     Running   0             9m5s</span><br><span class=\"line\">kuboard-agent-8467cc9799-p9qb6     1/1     Running   2 (21m ago)   22m</span><br><span class=\"line\">kuboard-etcd-pmdxq                 1/1     Running   0             22m</span><br><span class=\"line\">kuboard-v3-84f9bf8bfc-8gt5z        1/1     Running   0             22m</span><br></pre></td></tr></table></figure>\n<p>éƒ½å¯åŠ¨æˆåŠŸä¹‹åã€‚</p>\n<p>é€šè¿‡æµè§ˆå™¨è®¿é—®  <code>&lt;MasterIp&gt;:30080</code>  å³å¯ã€‚</p>\n<p><img data-src=\"/mages/k8s/10-01.png\" alt=\"\"></p>\n<h2 id=\"é¡µé¢æ“ä½œ\"><a class=\"markdownIt-Anchor\" href=\"#é¡µé¢æ“ä½œ\">#</a> é¡µé¢æ“ä½œ</h2>\n<p><code>Kuboard</code>  æ˜¯ä¸€æ¬¾ä¸“ä¸º  <code>Kubernetes</code>  è®¾è®¡çš„å…è´¹ç®¡ç†ç•Œé¢ï¼Œå…¼å®¹  <code>Kubernetes</code>  ç‰ˆæœ¬  <code>1.13</code>  åŠä»¥ä¸Šã€‚  <code>Kuboard</code>  å·²ç»å…·å¤‡å¤šé›†ç¾¤ç®¡ç†ã€æƒé™ç®¡ç†ã€ç›‘æ§å¥—ä»¶ã€æ—¥å¿—å¥—ä»¶ç­‰ä¸°å¯Œçš„åŠŸèƒ½.</p>\n<h3 id=\"å¤šé›†ç¾¤ç®¡ç†\"><a class=\"markdownIt-Anchor\" href=\"#å¤šé›†ç¾¤ç®¡ç†\">#</a> å¤šé›†ç¾¤ç®¡ç†</h3>\n<p>ç®¡ç†å‘˜å¯ä»¥æŠŠ ä¸åŒçš„ <code>Kubernetes</code>  é›†ç¾¤æ·»åŠ åŒä¸€ä¸ª <code>Kuboard</code>  ä¸­ï¼Œ å¹¶ä¸”å¯ä»¥åˆ†é…ä¸åŒçš„æƒé™è¿›è¡Œæ§åˆ¶ï¼Œå°†ä¸åŒé›†ç¾¤ / åç§°ç©ºé—´çš„æƒé™åˆ†é…ç»™æŒ‡å®šçš„ç”¨æˆ·æˆ–ç”¨æˆ·ç»„ã€‚</p>\n<p><img data-src=\"/mages/k8s/10-02.png\" alt=\"\"></p>\n<h3 id=\"å¾®æœåŠ¡åˆ†å±‚å±•ç¤º\"><a class=\"markdownIt-Anchor\" href=\"#å¾®æœåŠ¡åˆ†å±‚å±•ç¤º\">#</a> å¾®æœåŠ¡åˆ†å±‚å±•ç¤º</h3>\n<p>åœ¨  <code>Kuboard</code>  çš„åç§°ç©ºé—´æ¦‚è¦é¡µä¸­ï¼Œä»¥ç»å…¸çš„å¾®æœåŠ¡åˆ†å±‚æ–¹å¼å°†å·¥ä½œè´Ÿè½½åˆ’åˆ†åˆ°ä¸åŒçš„åˆ†å±‚ï¼Œæ›´åŠ ç›´è§‚åœ°å±•ç¤ºå¾®æœåŠ¡æ¶æ„çš„ç»“æ„ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºæ¯ä¸€ä¸ªåç§°ç©ºé—´è‡ªå®šä¹‰åç§°ç©ºé—´å¸ƒå±€ã€‚</p>\n<p><img data-src=\"/mages/k8s/10-03.png\" alt=\"\"></p>\n<p>è¿›å…¥å‘½åç©ºé—´ä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹å„ç§èµ„æºä¿¡æ¯ã€‚è¿˜æ”¯æŒå„ç§å¸¸ç”¨æ“ä½œã€‚</p>\n<p><img data-src=\"/mages/k8s/10-04.png\" alt=\"\"></p>\n<h2 id=\"é™„å½•-kuboard-v3å®‰è£…æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#é™„å½•-kuboard-v3å®‰è£…æ–‡ä»¶\">#</a> é™„å½• - kuboard-v3 å®‰è£…æ–‡ä»¶</h2>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Namespace</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ConfigMap</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard-v3-config</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\"><span class=\"attr\">data:</span></span><br><span class=\"line\">  <span class=\"comment\"># å…³äºå¦‚ä¸‹å‚æ•°çš„è§£é‡Šï¼Œè¯·å‚è€ƒæ–‡æ¡£ https://kuboard.cn/install/v3/install-built-in.html</span></span><br><span class=\"line\">  <span class=\"comment\"># [common]</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_SERVER_NODE_PORT:</span> <span class=\"string\">&#x27;30080&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_AGENT_SERVER_UDP_PORT:</span> <span class=\"string\">&#x27;30081&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_AGENT_SERVER_TCP_PORT:</span> <span class=\"string\">&#x27;30081&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_SERVER_LOGRUS_LEVEL:</span> <span class=\"string\">info</span>  <span class=\"comment\"># error / debug / trace</span></span><br><span class=\"line\">  <span class=\"comment\"># KUBOARD_AGENT_KEY æ˜¯ Agent ä¸ Kuboard é€šä¿¡æ—¶çš„å¯†é’¥ï¼Œè¯·ä¿®æ”¹ä¸ºä¸€ä¸ªä»»æ„çš„åŒ…å«å­—æ¯ã€æ•°å­—çš„32ä½å­—ç¬¦ä¸²ï¼Œæ­¤å¯†é’¥å˜æ›´åï¼Œéœ€è¦åˆ é™¤ Kuboard Agent é‡æ–°å¯¼å…¥ã€‚</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_AGENT_KEY:</span> <span class=\"string\">32b7d6572c6255211b4eec9009e4a816</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_AGENT_IMAG:</span> <span class=\"string\">eipwork/kuboard-agent</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_QUESTDB_IMAGE:</span> <span class=\"string\">questdb/questdb:6.0.5</span></span><br><span class=\"line\">  <span class=\"attr\">KUBOARD_DISABLE_AUDIT:</span> <span class=\"string\">&#x27;false&#x27;</span> <span class=\"comment\"># å¦‚æœè¦ç¦ç”¨ Kuboard å®¡è®¡åŠŸèƒ½ï¼Œå°†æ­¤å‚æ•°çš„å€¼è®¾ç½®ä¸º &#x27;true&#x27;ï¼Œå¿…é¡»å¸¦å¼•å·ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># å…³äºå¦‚ä¸‹å‚æ•°çš„è§£é‡Šï¼Œè¯·å‚è€ƒæ–‡æ¡£ https://kuboard.cn/install/v3/install-gitlab.html</span></span><br><span class=\"line\">  <span class=\"comment\"># [gitlab login]</span></span><br><span class=\"line\">  <span class=\"comment\"># KUBOARD_LOGIN_TYPE: &quot;gitlab&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># KUBOARD_ROOT_USER: &quot;your-user-name-in-gitlab&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># GITLAB_BASE_URL: &quot;http://gitlab.mycompany.com&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># GITLAB_APPLICATION_ID: &quot;7c10882aa46810a0402d17c66103894ac5e43d6130b81c17f7f2d8ae182040b5&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># GITLAB_CLIENT_SECRET: &quot;77c149bd3a4b6870bffa1a1afaf37cba28a1817f4cf518699065f5a8fe958889&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># å…³äºå¦‚ä¸‹å‚æ•°çš„è§£é‡Šï¼Œè¯·å‚è€ƒæ–‡æ¡£ https://kuboard.cn/install/v3/install-github.html</span></span><br><span class=\"line\">  <span class=\"comment\"># [github login]</span></span><br><span class=\"line\">  <span class=\"comment\"># KUBOARD_LOGIN_TYPE: &quot;github&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># KUBOARD_ROOT_USER: &quot;your-user-name-in-github&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># GITHUB_CLIENT_ID: &quot;17577d45e4de7dad88e0&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># GITHUB_CLIENT_SECRET: &quot;ff738553a8c7e9ad39569c8d02c1d85ec19115a7&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># å…³äºå¦‚ä¸‹å‚æ•°çš„è§£é‡Šï¼Œè¯·å‚è€ƒæ–‡æ¡£ https://kuboard.cn/install/v3/install-ldap.html</span></span><br><span class=\"line\">  <span class=\"comment\"># [ldap login]</span></span><br><span class=\"line\">  <span class=\"comment\"># KUBOARD_LOGIN_TYPE: &quot;ldap&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># KUBOARD_ROOT_USER: &quot;your-user-name-in-ldap&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_HOST: &quot;ldap-ip-address:389&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_BIND_DN: &quot;cn=admin,dc=example,dc=org&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_BIND_PASSWORD: &quot;admin&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_BASE_DN: &quot;dc=example,dc=org&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_FILTER: &quot;(objectClass=posixAccount)&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_ID_ATTRIBUTE: &quot;uid&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_USER_NAME_ATTRIBUTE: &quot;uid&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_EMAIL_ATTRIBUTE: &quot;mail&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_DISPLAY_NAME_ATTRIBUTE: &quot;cn&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_GROUP_SEARCH_BASE_DN: &quot;dc=example,dc=org&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_GROUP_SEARCH_FILTER: &quot;(objectClass=posixGroup)&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_USER_MACHER_USER_ATTRIBUTE: &quot;gidNumber&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_USER_MACHER_GROUP_ATTRIBUTE: &quot;gidNumber&quot;</span></span><br><span class=\"line\">  <span class=\"comment\"># LDAP_GROUP_NAME_ATTRIBUTE: &quot;cn&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard-boostrap</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard-boostrap-crb</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">cluster-admin</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard-boostrap</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-etcd</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard-etcd</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-etcd</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-etcd</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"attr\">nodeSelectorTerms:</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">                  <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\">                    <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">                  <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/control-plane</span></span><br><span class=\"line\">                    <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">              <span class=\"bullet\">-</span> <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">                  <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">k8s.kuboard.cn/role</span></span><br><span class=\"line\">                    <span class=\"attr\">operator:</span> <span class=\"string\">In</span></span><br><span class=\"line\">                    <span class=\"attr\">values:</span></span><br><span class=\"line\">                      <span class=\"bullet\">-</span> <span class=\"string\">etcd</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">HOSTNAME</span></span><br><span class=\"line\">              <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">                <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">                  <span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\">                  <span class=\"attr\">fieldPath:</span> <span class=\"string\">spec.nodeName</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">HOSTIP</span></span><br><span class=\"line\">              <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">                <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">                  <span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\">                  <span class=\"attr\">fieldPath:</span> <span class=\"string\">status.hostIP</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">&#x27;eipwork/etcd-host:3.4.16-2&#x27;</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">etcd</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">2381</span></span><br><span class=\"line\">              <span class=\"attr\">hostPort:</span> <span class=\"number\">2381</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">server</span></span><br><span class=\"line\">              <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">2382</span></span><br><span class=\"line\">              <span class=\"attr\">hostPort:</span> <span class=\"number\">2382</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">peer</span></span><br><span class=\"line\">              <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">          <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">            <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">            <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">              <span class=\"attr\">path:</span> <span class=\"string\">/health</span></span><br><span class=\"line\">              <span class=\"attr\">port:</span> <span class=\"number\">2381</span></span><br><span class=\"line\">              <span class=\"attr\">scheme:</span> <span class=\"string\">HTTP</span></span><br><span class=\"line\">            <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">30</span></span><br><span class=\"line\">            <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">            <span class=\"attr\">successThreshold:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"attr\">timeoutSeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/data</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">data</span></span><br><span class=\"line\">      <span class=\"attr\">dnsPolicy:</span> <span class=\"string\">ClusterFirst</span></span><br><span class=\"line\">      <span class=\"attr\">hostNetwork:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccount:</span> <span class=\"string\">kuboard-boostrap</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">kuboard-boostrap</span></span><br><span class=\"line\">      <span class=\"attr\">tolerations:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\">          <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/control-plane</span></span><br><span class=\"line\">          <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/usr/share/kuboard/etcd</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">data</span></span><br><span class=\"line\">  <span class=\"attr\">updateStrategy:</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span></span><br><span class=\"line\">      <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">RollingUpdate</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span> &#123;&#125;</span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-v3</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard-v3</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">revisionHistoryLimit:</span> <span class=\"number\">10</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-v3</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-v3</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">affinity:</span></span><br><span class=\"line\">        <span class=\"attr\">nodeAffinity:</span></span><br><span class=\"line\">          <span class=\"attr\">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">preference:</span></span><br><span class=\"line\">                <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">                  <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\">                    <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">              <span class=\"attr\">weight:</span> <span class=\"number\">100</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">preference:</span></span><br><span class=\"line\">                <span class=\"attr\">matchExpressions:</span></span><br><span class=\"line\">                  <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/control-plane</span></span><br><span class=\"line\">                    <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\">              <span class=\"attr\">weight:</span> <span class=\"number\">100</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">HOSTIP</span></span><br><span class=\"line\">              <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">                <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">                  <span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\">                  <span class=\"attr\">fieldPath:</span> <span class=\"string\">status.hostIP</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">HOSTNAME</span></span><br><span class=\"line\">              <span class=\"attr\">valueFrom:</span></span><br><span class=\"line\">                <span class=\"attr\">fieldRef:</span></span><br><span class=\"line\">                  <span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\">                  <span class=\"attr\">fieldPath:</span> <span class=\"string\">spec.nodeName</span></span><br><span class=\"line\">          <span class=\"attr\">envFrom:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">configMapRef:</span></span><br><span class=\"line\">                <span class=\"attr\">name:</span> <span class=\"string\">kuboard-v3-config</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">&#x27;eipwork/kuboard:v3&#x27;</span></span><br><span class=\"line\">          <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\">          <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">            <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">            <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">              <span class=\"attr\">path:</span> <span class=\"string\">/kuboard-resources/version.json</span></span><br><span class=\"line\">              <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">              <span class=\"attr\">scheme:</span> <span class=\"string\">HTTP</span></span><br><span class=\"line\">            <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">30</span></span><br><span class=\"line\">            <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">            <span class=\"attr\">successThreshold:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"attr\">timeoutSeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\">          <span class=\"attr\">ports:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">web</span></span><br><span class=\"line\">              <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">443</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">              <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">10081</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">peer</span></span><br><span class=\"line\">              <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">10081</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">peer-u</span></span><br><span class=\"line\">              <span class=\"attr\">protocol:</span> <span class=\"string\">UDP</span></span><br><span class=\"line\">          <span class=\"attr\">readinessProbe:</span></span><br><span class=\"line\">            <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">            <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">              <span class=\"attr\">path:</span> <span class=\"string\">/kuboard-resources/version.json</span></span><br><span class=\"line\">              <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">              <span class=\"attr\">scheme:</span> <span class=\"string\">HTTP</span></span><br><span class=\"line\">            <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">30</span></span><br><span class=\"line\">            <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">            <span class=\"attr\">successThreshold:</span> <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"attr\">timeoutSeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">          <span class=\"attr\">resources:</span> &#123;&#125;</span><br><span class=\"line\">          <span class=\"comment\"># startupProbe:</span></span><br><span class=\"line\">          <span class=\"comment\">#   failureThreshold: 20</span></span><br><span class=\"line\">          <span class=\"comment\">#   httpGet:</span></span><br><span class=\"line\">          <span class=\"comment\">#     path: /kuboard-resources/version.json</span></span><br><span class=\"line\">          <span class=\"comment\">#     port: 80</span></span><br><span class=\"line\">          <span class=\"comment\">#     scheme: HTTP</span></span><br><span class=\"line\">          <span class=\"comment\">#   initialDelaySeconds: 5</span></span><br><span class=\"line\">          <span class=\"comment\">#   periodSeconds: 10</span></span><br><span class=\"line\">          <span class=\"comment\">#   successThreshold: 1</span></span><br><span class=\"line\">          <span class=\"comment\">#   timeoutSeconds: 1</span></span><br><span class=\"line\">      <span class=\"attr\">dnsPolicy:</span> <span class=\"string\">ClusterFirst</span></span><br><span class=\"line\">      <span class=\"attr\">restartPolicy:</span> <span class=\"string\">Always</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccount:</span> <span class=\"string\">kuboard-boostrap</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">kuboard-boostrap</span></span><br><span class=\"line\">      <span class=\"attr\">tolerations:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\">          <span class=\"attr\">operator:</span> <span class=\"string\">Exists</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span> &#123;&#125;</span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-v3</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kuboard-v3</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kuboard</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">web</span></span><br><span class=\"line\">      <span class=\"attr\">nodePort:</span> <span class=\"number\">30080</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">      <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">tcp</span></span><br><span class=\"line\">      <span class=\"attr\">nodePort:</span> <span class=\"number\">30081</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">10081</span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">      <span class=\"attr\">targetPort:</span> <span class=\"number\">10081</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">udp</span></span><br><span class=\"line\">      <span class=\"attr\">nodePort:</span> <span class=\"number\">30081</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">10081</span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">UDP</span></span><br><span class=\"line\">      <span class=\"attr\">targetPort:</span> <span class=\"number\">10081</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s.kuboard.cn/name:</span> <span class=\"string\">kuboard-v3</span></span><br><span class=\"line\">  <span class=\"attr\">sessionAffinity:</span> <span class=\"string\">None</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span></span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Š  <code>yaml</code>  æ–‡ä»¶å¯ä»¥é€šè¿‡  <code>https://github.com/fangjiaxiaobai/k8s/tree/main/yamls</code>  è¿›è¡Œè·å–ã€‚</p>\n",
            "tags": [
                "k8s",
                "kubernetes"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/09/18/k8s/seris05-service/",
            "url": "https://fangjiaxiaobai.github.io/2022/09/18/k8s/seris05-service/",
            "title": "k8s-Service",
            "date_published": "2022-09-18T10:18:00.000Z",
            "content_html": "<h2 id=\"æœåŠ¡service\"><a class=\"markdownIt-Anchor\" href=\"#æœåŠ¡service\">#</a> æœåŠ¡ (Service)</h2>\n<h3 id=\"è§£å†³çš„é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³çš„é—®é¢˜\">#</a> è§£å†³çš„é—®é¢˜</h3>\n<p><code>Pod</code>  æ˜¯éæ°¸ä¹…æ€§èµ„æºã€‚ å¦‚æœä½ ä½¿ç”¨  <code>Deployment</code>  æ¥è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºï¼Œåˆ™å®ƒå¯ä»¥åŠ¨æ€åˆ›å»ºå’Œé”€æ¯ Podã€‚</p>\n<p>æ¯ä¸ª  <code>Pod</code>  éƒ½æœ‰è‡ªå·±çš„  <code>IP</code>  åœ°å€ï¼Œä½†æ˜¯åœ¨  <code>Deployment</code>  ä¸­ï¼Œåœ¨åŒä¸€æ—¶åˆ»è¿è¡Œçš„  <code>Pod</code>  é›†åˆå¯èƒ½ä¸ç¨åè¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„  <code>Pod</code>  é›†åˆä¸åŒã€‚</p>\n<p>è¿™å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼š å¦‚æœä¸€ç»„  <code>Pod</code> ï¼ˆç§°ä¸º â€œåç«¯â€ï¼‰ä¸ºé›†ç¾¤å†…çš„å…¶ä»–  <code>Pod</code> ï¼ˆç§°ä¸º â€œå‰ç«¯â€ï¼‰æä¾›åŠŸèƒ½ï¼Œ é‚£ä¹ˆå‰ç«¯å¦‚ä½•æ‰¾å‡ºå¹¶è·Ÿè¸ªè¦è¿æ¥çš„  <code>IP</code>  åœ°å€ï¼Œä»¥ä¾¿å‰ç«¯å¯ä»¥ä½¿ç”¨æä¾›å·¥ä½œè´Ÿè½½çš„åç«¯éƒ¨åˆ†ï¼Ÿ</p>\n<h3 id=\"å®šä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#å®šä¹‰\">#</a> å®šä¹‰</h3>\n<p><code>Kubernetes Service</code>  å®šä¹‰äº†è¿™æ ·ä¸€ç§æŠ½è±¡ï¼šä¸€ä¸ª  <code>Pod</code>  çš„é€»è¾‘åˆ†ç»„ï¼Œä¸€ç§å¯ä»¥è®¿é—®å®ƒä»¬çš„ç­–ç•¥ â€”â€” é€šå¸¸ç§°ä¸ºå¾®æœåŠ¡ã€‚ è¿™ä¸€ç»„  <code>Pod</code>  èƒ½å¤Ÿè¢«  <code>Service</code>  è®¿é—®åˆ°ï¼Œé€šå¸¸æ˜¯é€šè¿‡  <code>Label Selector</code> .</p>\n<p><code>Service</code>  èƒ½å¤Ÿæä¾›è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šæœ‰ä»¥ä¸‹é™åˆ¶ï¼š<br>\nåªæä¾›  <code>4</code>  å±‚è´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œè€Œæ²¡æœ‰  <code>7</code>  å±‚åŠŸèƒ½ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¯èƒ½éœ€è¦æ›´å¤šçš„åŒ¹é…è§„åˆ™æ¥è½¬å‘è¯·æ±‚ï¼Œè¿™ç‚¹ä¸Š  <code>4</code>  å±‚è´Ÿè½½å‡è¡¡æ˜¯ä¸æ”¯æŒçš„</p>\n<p>å‡è®¾ï¼Œä½ æœ‰ä¸€ç»„  <code>pod</code>  , é‚£å¦‚ä½•ä½¿ç”¨ä¸€ä¸ª  <code>Service</code>  ä¸ºè¿™ç»„  <code>pod</code>  æä¾›è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›å‘¢ï¼Ÿåˆšæ‰è¯´äº†ï¼Œé€šè¿‡  <code>Label Selector</code>  é€‰æ‹©å‡ºç¬¦åˆæ¡ä»¶çš„  <code>Pod</code> . å½“è¯·æ±‚è®¿é—®åˆ°  <code>Service</code> , åˆ™ä¼šè¯·æ±‚è½¬åˆ°å¯¹åº”çš„ä¸€ä¸ª  <code>pod</code>  ä¸Šã€‚ è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯  <code>é Label Selector</code>  æ–¹å¼.</p>\n<h4 id=\"selectorå…³è”\"><a class=\"markdownIt-Anchor\" href=\"#selectorå…³è”\">#</a> Selector å…³è”</h4>\n<p>ä¸¾ä¸€ä¸ªä¾‹å­:</p>\n<p>å‡å®šæœ‰ä¸€ç»„ Podï¼Œå®ƒä»¬å¯¹å¤–æš´éœ²äº† 80 ç«¯å£ï¼ŒåŒæ—¶è¿˜è¢«æ‰“ä¸Š <span class=\"exturl\" data-url=\"aHR0cDovL2FwcC5rdWJlcm5ldGVzLmlvL25hbWU9cHJveHk=\">app.kubernetes.io/name=proxy</span> æ ‡ç­¾</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app.kubernetes.io/name:</span> <span class=\"string\">proxy</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nginx</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">nginx:stable</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">http-web-svc</span></span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>\n<p>ç„¶ååˆ›å»ºäº†ä¸€ä¸ª  <code>Service</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nginx-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app.kubernetes.io/name:</span> <span class=\"string\">proxy</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">name-of-service-port</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"string\">http-web-svc</span></span><br></pre></td></tr></table></figure>\n<p><code>Kubernetes</code>  ä¸ºè¯¥æœåŠ¡åˆ†é…ä¸€ä¸ª  <code>IP</code>  åœ°å€ï¼ˆæœ‰æ—¶ç§°ä¸º â€œé›†ç¾¤ IPâ€ï¼‰ï¼Œè¯¥  <code>IP</code>  åœ°å€ç”±æœåŠ¡ä»£ç†ä½¿ç”¨ã€‚æœåŠ¡é€‰æ‹©ç®—ç¬¦çš„æ§åˆ¶å™¨ä¸æ–­æ‰«æä¸å…¶é€‰æ‹©ç®—ç¬¦åŒ¹é…çš„  <code>Pod</code>  (å³  <code>app.kubernetes.io/name=proxy</code>  çš„  <code>Pod</code> ) ï¼Œç„¶åå°†æ‰€æœ‰æ›´æ–°å‘å¸ƒåˆ°ä¹Ÿç§°ä¸º  <code>â€œmy-serviceâ€</code>  çš„  <code>Endpoint</code>  å¯¹è±¡ã€‚</p>\n<p>å³ä½¿  <code>Service</code>  ä¸­ä½¿ç”¨åŒä¸€é…ç½®åç§°æ··åˆä½¿ç”¨å¤šä¸ª  <code>Pod</code> ï¼Œå„  <code>Pod</code>  é€šè¿‡ä¸åŒçš„ç«¯å£å·æ”¯æŒç›¸åŒçš„ç½‘ç»œåè®®ï¼Œ æ­¤åŠŸèƒ½ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚è¿™ä¸º  <code>Service</code>  çš„éƒ¨ç½²å’Œæ¼”åŒ–æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨æ–°ç‰ˆæœ¬ä¸­æ›´æ”¹  <code>Pod</code>  ä¸­åç«¯è½¯ä»¶å…¬å¼€çš„ç«¯å£å·ï¼Œè€Œä¸ä¼šç ´åå®¢æˆ·ç«¯ã€‚</p>\n<h4 id=\"éselectorå…³è”\"><a class=\"markdownIt-Anchor\" href=\"#éselectorå…³è”\">#</a> é Selector å…³è”</h4>\n<p>ä¸¾ä¸ªä¾‹å­:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-service</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">      <span class=\"attr\">targetPort:</span> <span class=\"number\">9376</span></span><br></pre></td></tr></table></figure>\n<p>åˆ›å»º ä¸€ä¸ª  <code>Service</code> . ç”±äºæ­¤æœåŠ¡æ²¡æœ‰é€‰æ‹©ç®—ç¬¦ï¼Œå› æ­¤ä¸ä¼šè‡ªåŠ¨åˆ›å»ºç›¸åº”çš„  <code>Endpoints</code>  å¯¹è±¡ã€‚ ä½ å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ   <code>Endpoints</code>  å¯¹è±¡ï¼Œå°†æœåŠ¡æ‰‹åŠ¨æ˜ å°„åˆ°è¿è¡Œè¯¥æœåŠ¡çš„ç½‘ç»œåœ°å€å’Œç«¯å£ï¼š</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Endpoints</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"comment\"># è¿™é‡Œçš„ name è¦ä¸ Service çš„åå­—ç›¸åŒ</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-service</span></span><br><span class=\"line\"><span class=\"attr\">subsets:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">addresses:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">ip:</span> <span class=\"number\">192.0</span><span class=\"number\">.2</span><span class=\"number\">.42</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">9376</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"service-å¯ä»¥ç®¡ç†å¤šå°‘ä¸ª-endpoint\"><a class=\"markdownIt-Anchor\" href=\"#service-å¯ä»¥ç®¡ç†å¤šå°‘ä¸ª-endpoint\">#</a> Service å¯ä»¥ç®¡ç†å¤šå°‘ä¸ª Endpoint</h4>\n<p>æˆªæ­¢ç›®å‰  <code>kubernetes v1.22</code> . ä¸€ä¸ª  <code>Service</code>  æœ€å¤šç®¡ç†  <code>1000</code>  ä¸ª  <code>Pod</code> .  å¦‚æœæŸä¸ª  <code>Endpoints</code>  èµ„æºä¸­åŒ…å«çš„ç«¯ç‚¹ä¸ªæ•°è¶…è¿‡  <code>1000</code> ï¼Œåˆ™  <code>Kubernetes v1.22</code>  ç‰ˆæœ¬ ï¼ˆåŠæ›´æ–°ç‰ˆæœ¬ï¼‰çš„é›†ç¾¤ä¼šå°†ä¸ºè¯¥  <code>Endpoints</code>  æ·»åŠ æ³¨è§£  <code>endpoints.kubernetes.io/over-capacity: truncated</code> ã€‚ è¿™ä¸€æ³¨è§£è¡¨æ˜æ‰€å½±å“åˆ°çš„  <code>Endpoints</code>  å¯¹è±¡å·²ç»è¶…å‡ºå®¹é‡ï¼Œæ­¤å¤–  <code>Endpoints</code>  æ§åˆ¶å™¨è¿˜ä¼šå°†  <code>Endpoints</code>  å¯¹è±¡æ•°é‡æˆªæ–­åˆ°  <code>1000ã€‚</code></p>\n<h5 id=\"å¦‚ä½•è§£å†³\"><a class=\"markdownIt-Anchor\" href=\"#å¦‚ä½•è§£å†³\">#</a> å¦‚ä½•è§£å†³</h5>\n<p>å¯ä»¥ä½¿ç”¨  <code>EndpointSlices</code>  æ¥è§£å†³.</p>\n<p><code>EndpointSlices</code>  æ˜¯ä¸€ç§  <code>API</code>  èµ„æºï¼Œå¯ä»¥ä¸º  <code>Endpoints</code>  æä¾›æ›´å¯æ‰©å±•çš„æ›¿ä»£æ–¹æ¡ˆã€‚ å°½ç®¡ä»æ¦‚å¿µä¸Šè®²ä¸  <code>Endpoints</code>  éå¸¸ç›¸ä¼¼ï¼Œä½†  <code>EndpointSlices</code>  å…è®¸è·¨å¤šä¸ªèµ„æºåˆ†å¸ƒç½‘ç»œç«¯ç‚¹ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€æ—¦åˆ°è¾¾  <code>100</code>  ä¸ª  <code>Endpoint</code> ï¼Œè¯¥  <code>EndpointSlice</code>  å°†è¢«è§†ä¸º â€œå·²æ»¡â€ï¼Œ å±Šæ—¶å°†åˆ›å»ºå…¶ä»–  <code>EndpointSlices</code>  æ¥å­˜å‚¨ä»»ä½•å…¶ä»–  <code>Endpoints</code>  ã€‚</p>\n<h3 id=\"serviceçš„ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#serviceçš„ç±»å‹\">#</a>  <code>Service</code>  çš„ç±»å‹</h3>\n<p><code>Service</code>  åœ¨  <code>K8s</code>  ä¸­æœ‰ä»¥ä¸‹äº”ç§ç±»å‹</p>\n<ul>\n<li><code>ClusterIp</code> ï¼šé»˜è®¤ç±»å‹ï¼Œè‡ªåŠ¨åˆ†é…ä¸€ä¸ªä»…  <code>Cluster</code>  å†…éƒ¨å¯ä»¥è®¿é—®çš„è™šæ‹Ÿ  <code>IP</code> ï¼Œè¿™ç§ç±»å‹ä½¿å¾— Service åªèƒ½ä»é›†ç¾¤å†…è®¿é—®ã€‚</li>\n<li><code>NodePort</code> ï¼šåœ¨  <code>ClusterIP</code>  åŸºç¡€ä¸Šä¸º  <code>Service</code>  åœ¨æ¯å°æœºå™¨ä¸Šç»‘å®šä¸€ä¸ªç«¯å£ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ :  <code>NodePort</code>  æ¥è®¿é—®è¯¥æœåŠ¡</li>\n<li><code>LoadBalancer</code> ï¼šåœ¨  <code>NodePort</code>  çš„åŸºç¡€ä¸Šï¼Œå€ŸåŠ©  <code>cloud provider</code>  åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°:  <code>NodePort</code></li>\n<li><code>ExternalName</code> ï¼šæŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥åˆ°é›†ç¾¤å†…éƒ¨æ¥ï¼Œåœ¨é›†ç¾¤å†…éƒ¨ç›´æ¥ä½¿ç”¨ã€‚æ²¡æœ‰ä»»ä½•ç±»å‹ä»£ç†è¢«åˆ›å»ºï¼Œè¿™åªæœ‰  <code>kubernetes 1.7</code>  æˆ–æ›´é«˜ç‰ˆæœ¬çš„  <code>kube-dns</code>  æ‰æ”¯æŒ</li>\n<li><code>Ingress</code> :  <code>Ingress</code>  æ˜¯å¯¹é›†ç¾¤ä¸­æœåŠ¡çš„å¤–éƒ¨è®¿é—®è¿›è¡Œç®¡ç†çš„  <code>API</code>  å¯¹è±¡ï¼Œå…¸å‹çš„è®¿é—®æ–¹å¼æ˜¯  <code>HTTP</code> ã€‚ <code>Ingress</code>  å¯ä»¥æä¾›è´Ÿè½½å‡è¡¡ã€  <code>SSL</code>  ç»ˆç»“å’ŒåŸºäºåç§°çš„è™šæ‹Ÿæ‰˜ç®¡ã€‚ <code>Ingress</code>  å…¬å¼€ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„  <code>HTTP</code>  å’Œ  <code>HTTPS</code>  è·¯ç”±ã€‚ æµé‡è·¯ç”±ç”±  <code>Ingress</code>  èµ„æºä¸Šå®šä¹‰çš„è§„åˆ™æ§åˆ¶ã€‚</li>\n</ul>\n<h2 id=\"ä»£ç†\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç†\">#</a> ä»£ç†</h2>\n<h3 id=\"vip-å’Œ-serviceä»£ç†\"><a class=\"markdownIt-Anchor\" href=\"#vip-å’Œ-serviceä»£ç†\">#</a>  <code>VIP</code>  å’Œ  <code>Service</code>  ä»£ç†</h3>\n<p>åœ¨  <code>Kubernetes</code>  é›†ç¾¤ä¸­ï¼Œæ¯ä¸ª  <code>Node</code>  è¿è¡Œä¸€ä¸ª  <code>kube-proxy</code>  è¿›ç¨‹ã€‚  <code>kube-proxy</code>  è´Ÿè´£ä¸º  <code>Service</code>  å®ç°äº†ä¸€ç§  <code>VIP(è™šæ‹ŸIP)</code>  çš„å½¢å¼ï¼Œè€Œä¸æ˜¯  <code>ExternalName</code>  çš„å½¢å¼ã€‚ åœ¨  <code>Kubernetes v1.0</code>  ç‰ˆæœ¬ï¼Œä»£ç†å®Œå…¨åœ¨  <code>userspace</code> ã€‚åœ¨  <code>Kubernetes v1.1</code>  ç‰ˆæœ¬ï¼Œæ–°å¢äº†  <code>iptables</code>  ä»£ç†ï¼Œä½†å¹¶ä¸æ˜¯é»˜è®¤çš„è¿è¡Œæ¨¡å¼ã€‚ ä»  <code>Kubernetes v1.2</code>  èµ·ï¼Œé»˜è®¤å°±æ˜¯ <code>iptables</code>  ä»£ç†ã€‚ åœ¨  <code>Kubernetes v1.8.0-beta.0</code>  ä¸­ï¼Œæ·»åŠ äº† ipvs ä»£ç†åœ¨  <code>Kubernetes 1.14</code>  ç‰ˆæœ¬å¼€å§‹é»˜è®¤ä½¿ç”¨  <code>ipvs</code>  ä»£ç†ã€‚åœ¨  <code>Kubernetes v1.0</code>  ç‰ˆæœ¬ï¼Œ  <code>Service</code>  æ˜¯  <code>â€œ4å±‚â€</code> ï¼ˆ <code>TCP/UDP over IP</code> ï¼‰æ¦‚å¿µã€‚ åœ¨  <code>Kubernetes v1.1</code>  ç‰ˆæœ¬ï¼Œæ–°å¢äº†  <code>Ingress API(beta ç‰ˆ)</code> ï¼Œç”¨æ¥è¡¨ç¤º  <code>â€œ7å±‚â€(HTTP)</code>  æœåŠ¡</p>\n<h3 id=\"ä»£ç†æ¨¡å¼çš„åˆ†ç±»\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç†æ¨¡å¼çš„åˆ†ç±»\">#</a> ä»£ç†æ¨¡å¼çš„åˆ†ç±»</h3>\n<h4 id=\"userspace\"><a class=\"markdownIt-Anchor\" href=\"#userspace\">#</a>  <code>userspace</code></h4>\n<p><code>kube-proxy</code>  ä¼šç›‘è§†  <code>Kubernetes kubelet</code>  å¯¹  <code>Service</code>  å¯¹è±¡å’Œ  <code>Endpoints</code>  å¯¹è±¡çš„æ·»åŠ å’Œç§»é™¤æ“ä½œã€‚ å¯¹æ¯ä¸ª  <code>Service</code> ï¼Œå®ƒä¼šåœ¨æœ¬åœ°  <code>Node</code>  ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼ˆéšæœºé€‰æ‹©ï¼‰ã€‚ ä»»ä½•è¿æ¥åˆ° â€œä»£ç†ç«¯å£â€ çš„è¯·æ±‚ï¼Œéƒ½ä¼šè¢«ä»£ç†åˆ°  <code>Service</code>  çš„æŸä¸ª  <code>pod</code>  ä¸Šã€‚ä½¿ç”¨å“ªä¸ªåç«¯  <code>Pod</code>  ï¼Œæ˜¯  <code>kube-proxy</code>  åŸºäº  <code>SessionAffinity</code>  æ¥ç¡®å®šçš„ã€‚</p>\n<p>æœ€åï¼Œå®ƒé…ç½®  <code>iptables</code>  è§„åˆ™ï¼Œæ•è·åˆ°è¾¾è¯¥  <code>Service</code>  çš„  <code>clusterIP</code> ï¼ˆæ˜¯è™šæ‹Ÿ IPï¼‰ å’Œ  <code>Port</code>  çš„è¯·æ±‚ï¼Œå¹¶é‡å®šå‘åˆ°ä»£ç†ç«¯å£ï¼Œä»£ç†ç«¯å£å†ä»£ç†è¯·æ±‚åˆ°åç«¯ <code>Pod</code> ã€‚</p>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·ç©ºé—´æ¨¡å¼ä¸‹çš„  <code>kube-proxy</code>  é€šè¿‡è½®è½¬ç®—æ³•é€‰æ‹©åç«¯ã€‚</p>\n<p><img data-src=\"/images/k8s/05-01.svg\" alt=\"\"></p>\n<h4 id=\"iptables\"><a class=\"markdownIt-Anchor\" href=\"#iptables\">#</a> iptables</h4>\n<p>è¿™ç§æ¨¡å¼ï¼Œ <code>kube-proxy</code>  ä¼šç›‘è§†  <code>Kubernetes</code>  æ§åˆ¶èŠ‚ç‚¹å¯¹  <code>Service</code>  å¯¹è±¡å’Œ  <code>Endpoints</code>  å¯¹è±¡çš„æ·»åŠ å’Œç§»é™¤ã€‚ å¯¹æ¯ä¸ª  <code>Service</code> ï¼Œå®ƒä¼šé…ç½®  <code>iptables</code>  è§„åˆ™ï¼Œä»è€Œæ•è·åˆ°è¾¾è¯¥  <code>Service</code>  çš„  <code>clusterIP</code>  å’Œç«¯å£çš„è¯·æ±‚ï¼Œè¿›è€Œå°†è¯·æ±‚é‡å®šå‘åˆ°  <code>Service</code>  çš„ä¸€ç»„åç«¯ä¸­çš„æŸä¸ª  <code>Pod</code>  ä¸Šé¢ã€‚ å¯¹äºæ¯ä¸ª  <code>Endpoints</code>  å¯¹è±¡ï¼Œå®ƒä¹Ÿä¼šé…ç½®  <code>iptables</code>  è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™ä¼šé€‰æ‹©ä¸€ä¸ªåç«¯ç»„åˆã€‚</p>\n<p>é»˜è®¤çš„ç­–ç•¥æ˜¯ï¼Œ <code>kube-proxy</code>  åœ¨  <code>iptables</code>  æ¨¡å¼ä¸‹éšæœºé€‰æ‹©ä¸€ä¸ªåç«¯ã€‚</p>\n<p>ä½¿ç”¨  <code>iptables</code>  å¤„ç†æµé‡å…·æœ‰è¾ƒä½çš„ç³»ç»Ÿå¼€é”€ï¼Œå› ä¸ºæµé‡ç”±  <code>Linux netfilter</code>  å¤„ç†ï¼Œ è€Œæ— éœ€åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´åˆ‡æ¢ã€‚ è¿™ç§æ–¹æ³•ä¹Ÿå¯èƒ½æ›´å¯é ã€‚</p>\n<p>å¦‚æœ  <code>kube-proxy</code>  åœ¨  <code>iptables</code>  æ¨¡å¼ä¸‹è¿è¡Œï¼Œå¹¶ä¸”æ‰€é€‰çš„ç¬¬ä¸€ä¸ª  <code>Pod</code>  æ²¡æœ‰å“åº”ï¼Œåˆ™è¿æ¥å¤±è´¥ã€‚ è¿™ä¸ç”¨æˆ·ç©ºé—´æ¨¡å¼ä¸åŒï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>kube-proxy</code>  å°†æ£€æµ‹åˆ°ä¸ç¬¬ä¸€ä¸ª  <code>Pod</code>  çš„è¿æ¥å·²å¤±è´¥ï¼Œ å¹¶ä¼šè‡ªåŠ¨ä½¿ç”¨å…¶ä»–åç«¯  <code>Pod</code>  é‡è¯•ã€‚</p>\n<p>ä½ å¯ä»¥ä½¿ç”¨  <code>Pod</code>  å°±ç»ªæ¢æµ‹å™¨ éªŒè¯åç«¯  <code>Pod</code>  å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä»¥ä¾¿  <code>iptables</code>  æ¨¡å¼ä¸‹çš„  <code>kube-proxy</code>  ä»…çœ‹åˆ°æµ‹è¯•æ­£å¸¸çš„åç«¯ã€‚ è¿™æ ·åšæ„å‘³ç€ä½ é¿å…å°†æµé‡é€šè¿‡  <code>kube-proxy</code>  å‘é€åˆ°å·²çŸ¥å·²å¤±è´¥çš„  <code>Pod</code></p>\n<p><img data-src=\"/images/k8s/05-02.svg\" alt=\"\"></p>\n<h4 id=\"ipvs\"><a class=\"markdownIt-Anchor\" href=\"#ipvs\">#</a> ipvs</h4>\n<p>è¿™ç§æ¨¡å¼ï¼Œ <code>kube-proxy</code>  ä¼šç›‘è§†  <code>Kubernetes Service</code>  å¯¹è±¡å’Œ  <code>Endpoints</code>  ï¼Œè°ƒç”¨  <code>netlink</code>  æ¥å£ä»¥ç›¸åº”åœ°åˆ›å»º <code>ipvs</code>  è§„åˆ™å¹¶å®šæœŸä¸  <code>Kubernetes Service</code>  å¯¹è±¡å’Œ  <code>Endpoints</code>  å¯¹è±¡åŒæ­¥  <code>ipvs</code>  è§„åˆ™ï¼Œä»¥ç¡®ä¿  <code>ipvs</code>  çŠ¶æ€ä¸æœŸæœ›ä¸€è‡´ã€‚è®¿é—®æœåŠ¡æ—¶ï¼Œæµé‡å°†è¢«é‡å®šå‘åˆ°å…¶ä¸­ä¸€ä¸ªåç«¯  <code>Pod</code> . ä¸  <code>iptables</code>  ç±»ä¼¼ï¼Œ <code>ipvs</code>  äº  <code>netï¬lter</code>  çš„  <code>hook</code>  åŠŸèƒ½ï¼Œä½†ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„å¹¶åœ¨å†…æ ¸ç©ºé—´ä¸­å·¥ä½œã€‚è¿™æ„å‘³ç€  <code>ipvs</code>  å¯ä»¥æ›´å¿«åœ°é‡å®šå‘æµé‡ï¼Œå¹¶ä¸”åœ¨åŒæ­¥ä»£ç†è§„åˆ™æ—¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚æ­¤å¤–ï¼Œ <code>ipvs</code>  ä¸ºè´Ÿè½½å‡è¡¡ç®—æ³•æä¾›äº†æ›´å¤šé€‰é¡¹ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li><code>rr</code> ï¼šè½®è¯¢è°ƒåº¦</li>\n<li><code>lc</code>  ï¼šæœ€å°è¿æ¥æ•°</li>\n<li><code>dh</code>  ï¼šç›®æ ‡å“ˆå¸Œ</li>\n<li><code>sh</code>  ï¼šæºå“ˆå¸Œ</li>\n<li><code>sed</code>  ï¼šæœ€çŸ­æœŸæœ›å»¶è¿Ÿ</li>\n<li><code>nq</code>  ï¼š ä¸æ’é˜Ÿè°ƒåº¦</li>\n</ul>\n<p><img data-src=\"/images/k8s/05-03.svg\" alt=\"\"></p>\n<h2 id=\"service-ç±»å‹å®éªŒ\"><a class=\"markdownIt-Anchor\" href=\"#service-ç±»å‹å®éªŒ\">#</a> Service ç±»å‹å®éªŒ</h2>\n<h3 id=\"clusterip\"><a class=\"markdownIt-Anchor\" href=\"#clusterip\">#</a>  <code>ClusterIP</code></h3>\n<p><code>clusterIP</code>  ä¸»è¦åœ¨æ¯ä¸ª  <code>node</code>  èŠ‚ç‚¹ä½¿ç”¨  <code>iptables</code>  ç­‰ä»£ç†æ–¹å¼ï¼Œå°†å‘å‘  <code>clusterIP</code>  å¯¹åº”ç«¯å£çš„æ•°æ®ï¼Œè½¬å‘åˆ°  <code>kube-proxy</code>  ä¸­ã€‚ç„¶å  <code>kube-proxy</code>  è‡ªå·±å†…éƒ¨å®ç°æœ‰è´Ÿè½½å‡è¡¡çš„æ–¹æ³•ï¼Œå¹¶å¯ä»¥æŸ¥è¯¢åˆ°è¿™ä¸ª  <code>service</code>  ä¸‹å¯¹åº”  <code>pod</code>  çš„åœ°å€å’Œç«¯å£ï¼Œè¿›è€ŒæŠŠæ•°æ®è½¬å‘ç»™å¯¹åº”çš„  <code>pod</code>  çš„åœ°å€å’Œç«¯å£ã€‚ è¿™ç§ç±»å‹ä½¿å¾— Service åªèƒ½ä»é›†ç¾¤å†…è®¿é—®ã€‚</p>\n<p><img data-src=\"/images/k8s/05-04.png\" alt=\"\"></p>\n<p>ä¸ºäº†å®ç°å›¾ä¸Šçš„åŠŸèƒ½ï¼Œä¸»è¦éœ€è¦ä»¥ä¸‹å‡ ä¸ªç»„ä»¶çš„ååŒå·¥ä½œï¼š</p>\n<ul>\n<li><code>apiserver</code>  ç”¨æˆ·é€šè¿‡ <code>kubectl</code>  å‘½ä»¤å‘ <code>apiserver</code>  å‘é€åˆ›å»º <code>service</code>  çš„å‘½ä»¤ï¼Œ <code>apiserver</code>  æ¥æ”¶åˆ°è¯·æ±‚åå°†æ•°æ®å­˜å‚¨åˆ° <code>etcd</code>  ä¸­</li>\n<li><code>kube-proxy kubernetes</code>  çš„æ¯ä¸ªèŠ‚ç‚¹ä¸­éƒ½æœ‰ä¸€ä¸ªå«åš <code>kube-porxy</code>  çš„è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹è´Ÿè´£æ„ŸçŸ¥ <code>service</code> ï¼Œ <code>pod</code>  çš„å˜åŒ–ï¼Œå¹¶å°†å˜åŒ–çš„ä¿¡æ¯å†™å…¥æœ¬åœ°çš„ <code>iptables</code>  è§„åˆ™ä¸­.</li>\n<li><code>iptables</code>  ä½¿ç”¨ <code>NAT</code>  ç­‰æŠ€æœ¯å°† <code>virtualIP</code>  çš„æµé‡è½¬è‡³ <code>endpoint</code>  ä¸­</li>\n</ul>\n<h4 id=\"åˆ›å»ºä¸€ä¸ªdeploy\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºä¸€ä¸ªdeploy\">#</a> åˆ›å»ºä¸€ä¸ª deploy</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">cluster-ip-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">cluster-ip-demo</span></span><br><span class=\"line\">      <span class=\"attr\">tag:</span> <span class=\"string\">cluster-ip-v1</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">cluster-ip-demo</span></span><br><span class=\"line\">        <span class=\"attr\">tag:</span> <span class=\"string\">cluster-ip-v1</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span> <span class=\"string\">test</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cluster-ip-demo-container</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v3</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">http</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;MY_APP_VERSION&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;3.0&quot;</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/05-06.png\" alt=\"\"></p>\n<h4 id=\"æŠŠ-deploymenet-ç»‘å®šåˆ°-service-ä¸Š\"><a class=\"markdownIt-Anchor\" href=\"#æŠŠ-deploymenet-ç»‘å®šåˆ°-service-ä¸Š\">#</a> æŠŠ  <code>Deploymenet</code>  ç»‘å®šåˆ°  <code>Service</code>  ä¸Š</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">service-cluster-ip-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">ClusterIP</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">cluster-ip-demo</span></span><br><span class=\"line\">    <span class=\"attr\">tag:</span> <span class=\"string\">cluster-ip-v1</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">http</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/05-07.png\" alt=\"\"></p>\n<h4 id=\"headless-service\"><a class=\"markdownIt-Anchor\" href=\"#headless-service\">#</a>  <code>Headless Service</code></h4>\n<p>æœ‰æ—¶ä¸éœ€è¦æˆ–ä¸æƒ³è¦è´Ÿè½½å‡è¡¡ sc ä»¥åŠå•ç‹¬çš„  <code>Service IP</code>  ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡æŒ‡å®š  <code>Cluster IP(spec.clusterIP)</code>  çš„å€¼ä¸º  <code>â€œNoneâ€</code>  æ¥åˆ›å»º  <code>Headless Service</code>  ã€‚è¿™ç±»  <code>Service</code>  å¹¶ä¸ä¼šåˆ†é…  <code>Cluster IP</code> ï¼Œ  <code>kube-proxy</code>  ä¸ä¼šå¤„ç†å®ƒä»¬ï¼Œè€Œä¸”å¹³å°ä¹Ÿä¸ä¼šä¸ºå®ƒä»¬è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">headless-service</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">headless-app</span></span><br><span class=\"line\">    <span class=\"attr\">clusterIp:</span> <span class=\"string\">&quot;None&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨ <code>dig</code>  å‘½ä»¤å¯ä»¥éªŒè¯ä¸€ä¸‹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dig -t A headless-service.default.svc.cluster.local. @10.96.0.10</span><br></pre></td></tr></table></figure>\n<h3 id=\"nodeport\"><a class=\"markdownIt-Anchor\" href=\"#nodeport\">#</a>  <code>NodePort</code></h3>\n<p><code>nodePort</code>  çš„åŸç†åœ¨äºåœ¨  <code>node</code>  ä¸Šå¼€äº†ä¸€ä¸ªç«¯å£ï¼Œå°†å‘è¯¥ç«¯å£çš„æµé‡å¯¼å…¥åˆ°  <code>kube-proxy</code> ï¼Œç„¶åç”±  <code>kube-proxy</code>  è¿›ä¸€æ­¥åˆ°ç»™å¯¹åº”çš„  <code>pod</code></p>\n<h4 id=\"åˆ›å»º-deployment\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-deployment\">#</a> åˆ›å»º  <code>Deployment</code></h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">node-port-container-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">node-port-service</span></span><br><span class=\"line\">      <span class=\"attr\">tag:</span> <span class=\"string\">node-port-tag-v3</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">node-port-service</span></span><br><span class=\"line\">        <span class=\"attr\">tag:</span> <span class=\"string\">node-port-tag-v3</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span> <span class=\"string\">test</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cluster-ip-demo-container</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v3</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">http</span></span><br><span class=\"line\">          <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;MY_APP_VERSION&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&quot;3.0&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"ç»‘å®šåˆ°-service-ä¸Š\"><a class=\"markdownIt-Anchor\" href=\"#ç»‘å®šåˆ°-service-ä¸Š\">#</a> ç»‘å®šåˆ°  <code>Service</code>  ä¸Šã€‚</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">node-port-service</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">node-port-service</span></span><br><span class=\"line\">    <span class=\"attr\">tag:</span> <span class=\"string\">node-port-tag-v3</span></span><br><span class=\"line\">    <span class=\"attr\">env:</span> <span class=\"string\">test</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">http</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/05-08.png\" alt=\"\"></p>\n<p>å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè®¿é—®  <code>Node</code>  çš„  <code>IP</code> ( <code>http://192.168.0.10:31024/</code> ), å¤šæ¬¡è®¿é—®æŸ¥çœ‹  <code>hostname</code>  å’Œ  <code>ip</code>  çš„å˜åŒ–.</p>\n<h3 id=\"loadbalancer\"><a class=\"markdownIt-Anchor\" href=\"#loadbalancer\">#</a>  <code>LoadBalancer</code></h3>\n<p><code>loadBalancer</code>  å’Œ  <code>nodePort</code>  å…¶å®æ˜¯åŒä¸€ç§æ–¹å¼ã€‚åŒºåˆ«åœ¨äº  <code>loadBalancer</code>  æ¯”  <code>nodePort</code>  å¤šäº†ä¸€æ­¥ï¼Œå°±æ˜¯å¯ä»¥è°ƒç”¨  <code>cloud provider</code>  å»åˆ›å»º  <code>LB</code>  æ¥å‘èŠ‚ç‚¹å¯¼æµ.</p>\n<h3 id=\"externalname\"><a class=\"markdownIt-Anchor\" href=\"#externalname\">#</a>  <code>ExternalName</code></h3>\n<p>è¿™ç§ç±»å‹çš„  <code>Service</code>  é€šè¿‡è¿”å›  <code>CNAME</code>  å’Œå®ƒçš„å€¼ï¼Œå¯ä»¥å°†æœåŠ¡æ˜ å°„åˆ°  <code>externalName</code>  å­—æ®µçš„å†…å®¹ ( ä¾‹å¦‚ï¼š<br>\n <code>hub.atguigu.com</code>  )ã€‚  <code>ExternalName Service</code>  æ˜¯  <code>Service</code>  çš„ç‰¹ä¾‹ï¼Œå®ƒæ²¡æœ‰  <code>selector</code>  ï¼Œä¹Ÿæ²¡æœ‰å®šä¹‰ä»»ä½•çš„ç«¯å£å’Œ  <code>Endpoint</code>  ã€‚ç›¸åçš„ï¼Œå¯¹äºè¿è¡Œåœ¨é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡è¿”å›è¯¥å¤–éƒ¨æœåŠ¡çš„åˆ«åè¿™ç§æ–¹å¼æ¥æä¾›æœåŠ¡</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">external-name-service</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">ExternalName</span></span><br><span class=\"line\">  <span class=\"attr\">externalName:</span> <span class=\"string\">www.fangjiaxiaobai.cn</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/05-09.png\" alt=\"\"></p>\n<p>å½“æŸ¥è¯¢ä¸»æœº  <code>my-service.defalut.svc.cluster.local</code>  (  <code>SVC_NAME.NAMESPACE.svc.cluster.local</code>  ) æ—¶ï¼Œé›†ç¾¤çš„  <code>DNS</code>  æœåŠ¡å°†è¿”å›ä¸€ä¸ªå€¼  <code>my.database.example.com</code>  çš„  <code>CNAME</code>  è®°å½•ã€‚è®¿é—®è¿™ä¸ªæœåŠ¡çš„å·¥ä½œæ–¹å¼å’Œå…¶ä»–çš„ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯é‡å®šå‘å‘ç”Ÿåœ¨  <code>DNS</code>  å±‚ï¼Œè€Œä¸”ä¸ä¼šè¿›è¡Œä»£ç†æˆ–è½¬å‘</p>\n<p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬ä»‹ç»å¦å¤–ä¸€ç§ èµ„æºæ§åˆ¶å™¨  <code>Ingress</code> .</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "k8s",
                "kubernetes"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/08/07/k8s/seris04-work-load/",
            "url": "https://fangjiaxiaobai.github.io/2022/08/07/k8s/seris04-work-load/",
            "title": "k8s-èµ„æºæ§åˆ¶å™¨",
            "date_published": "2022-08-07T10:18:00.000Z",
            "content_html": "<h2 id=\"pod\"><a class=\"markdownIt-Anchor\" href=\"#pod\">#</a> Pod</h2>\n<p><code>Pod</code>  æ˜¯å¯ä»¥åœ¨  <code>Kubernetes</code>  ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚  <code>Pod</code>  æ˜¯ä¸€ç»„å®¹å™¨ï¼Œä¸€ä¸ª  <code>pod</code>  çš„æ‰€æœ‰å®¹å™¨å…±äº«  <code>pod</code>  çš„ç½‘è·¯ï¼Œå­˜å‚¨ ä»¥åŠè¿è¡Œå®¹å™¨çš„å£°æ˜ã€‚</p>\n<p>é€šå¸¸ç”¨æˆ·éœ€è¦ç›´æ¥åˆ›å»º  <code>Pod</code>  , è€Œæ˜¯ä½¿ç”¨è´Ÿè½½èµ„æºæ¥æ›¿ç”¨æˆ·ç®¡ç†ä¸€ç»„  <code>Pod</code>  . è¿™äº›è´Ÿè½½èµ„æºé€šè¿‡é…ç½® <strong>æ§åˆ¶å™¨</strong> æ¥ç¡®ä¿æ­£ç¡®ç±»å‹çš„ã€å¤„äºè¿è¡ŒçŠ¶æ€çš„  <code>Pod</code>  ä¸ªæ•°æ˜¯æ­£ç¡®çš„ï¼Œä¸ç”¨æˆ·æ‰€æŒ‡å®šçš„çŠ¶æ€ç›¸ä¸€è‡´ã€‚</p>\n<h2 id=\"æ§åˆ¶å™¨\"><a class=\"markdownIt-Anchor\" href=\"#æ§åˆ¶å™¨\">#</a> æ§åˆ¶å™¨</h2>\n<h3 id=\"replication-controller-å’Œ-replicaset\"><a class=\"markdownIt-Anchor\" href=\"#replication-controller-å’Œ-replicaset\">#</a>  <code>Replication Controller</code>  å’Œ  <code>ReplicaSet</code></h3>\n<p><code>ReplicationController(RC)</code>  ç”¨æ¥ç¡®ä¿å®¹å™¨åº”ç”¨çš„å‰¯æœ¬æ•°å§‹ç»ˆä¿æŒåœ¨ç”¨æˆ·å®šä¹‰çš„å‰¯æœ¬æ•°ï¼Œå³å¦‚æœæœ‰å®¹å™¨å¼‚å¸¸é€€<br>\nå‡ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„  <code>Pod</code>  æ¥æ›¿ä»£ï¼›è€Œå¦‚æœå¼‚å¸¸å¤šå‡ºæ¥çš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å›æ”¶ï¼›<br>\n åœ¨æ–°ç‰ˆæœ¬çš„  <code>Kubernetes</code>  ä¸­å»ºè®®ä½¿ç”¨  <code>ReplicaSet</code>  æ¥å–ä»£  <code>ReplicationController</code>  ã€‚  <code>ReplicaSet</code>  è·Ÿ<br>\n <code>ReplicationController</code>  æ²¡æœ‰æœ¬è´¨çš„ä¸åŒï¼Œåªæ˜¯åå­—ä¸ä¸€æ ·ï¼Œå¹¶ä¸”  <code>ReplicaSet</code>  æ”¯æŒé›†åˆå¼çš„  <code>selector</code> .</p>\n<h4 id=\"å®éªŒ\"><a class=\"markdownIt-Anchor\" href=\"#å®éªŒ\">#</a> å®éªŒ</h4>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ReplicaSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">replica-set-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">rs_label:</span> <span class=\"string\">rs-demo</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">rs_label:</span> <span class=\"string\">rs-demo</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">replica-set-demo-container</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">JAVA_VERSION</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"string\">&#x27;11&#x27;</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>æŸ¥çœ‹ å½“å‰çš„ <code>pod</code> <br>\n<img data-src=\"/images/k8s/04-01.png\" alt=\"\"></p>\n</li>\n<li>\n<p>æ–°å¼€ä¸€ä¸ªçª—å£ï¼Œä½¿ç”¨å‘½ä»¤:  <code>kubectl get pod -o wide -w</code>  æ¥æŸ¥çœ‹ pod çš„å˜åŒ–è¿‡ç¨‹.<br>\n<img data-src=\"/images/k8s/04-02.png\" alt=\"\"></p>\n</li>\n<li>\n<p>ç„¶åä½¿ç”¨å‘½ä»¤  <code>kubectl delete pod replica-set-demo-2wlcm</code>  åˆ é™¤å…¶ä¸­çš„ä»»æ„ä¸€ä¸ª  <code>pod</code></p>\n</li>\n<li>\n<p>ç„¶å å¯ä»¥çœ‹åˆ°æ–°çª—å£ä¸­å‡ºç°äº†å¦‚ä¸‹çš„å˜åŒ–:<br>\n<img data-src=\"/images/k8s/04-04.png\" alt=\"\"><br>\n åˆ é™¤çš„ <code>pod</code> ( <code>2wlcm</code> ) å…ˆä»  <code>Running</code>  å˜æˆäº†  <code>Terminating</code> , ç„¶åå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„  <code>pod (z48pp)</code> , çŠ¶æ€ä»  <code>Pending</code>  -&gt;  <code>ContainerCreating</code> -&gt; <code>Running</code> .</p>\n</li>\n</ul>\n<h5 id=\"ä¿®æ”¹æ ‡ç­¾\"><a class=\"markdownIt-Anchor\" href=\"#ä¿®æ”¹æ ‡ç­¾\">#</a> ä¿®æ”¹æ ‡ç­¾</h5>\n<p><img data-src=\"/images/k8s/04-05.png\" alt=\"\"></p>\n<ul>\n<li>é€šè¿‡å‘½ä»¤  <code>kubectl get pod --show-labels</code>  æŸ¥çœ‹  <code>pod</code>  çš„æ ‡ç­¾ã€‚</li>\n<li>é€šè¿‡å‘½ä»¤  <code>kubectl label pod replica-set-demo-z48pp rs_label=rs-edit-label-exp --overwrite=True</code>  ä¿®æ”¹  <code>pod</code>  çš„æ ‡ç­¾ã€‚</li>\n<li>æŸ¥çœ‹  <code>pod</code></li>\n</ul>\n<p>å‘ç° æ–°å¯åŠ¨äº†ä¸€ä¸ª  <code>pod</code> , å¦‚ä¸Šå›¾ä¸­çš„  <code>(Pod)nbxnf</code> ã€‚æ­¤æ—¶ åŸæ¥çš„ pod å°±å˜æˆäº†æ–°çš„æ ‡ç­¾ã€‚</p>\n<p>ç”±æ­¤å¯ä»¥çœ‹å‡º:  <code>ReplicaSet</code>  æ˜¯é€šè¿‡  <code>labels</code>  æ¥åˆ¤æ–­ <code>pod</code>  æ˜¯å¦å±äºå½“å‰çš„  <code>RS</code>  çš„ã€‚</p>\n<p>é‚£ æ–°å»ºä¸€ä¸ªç›¸åŒæ ‡ç­¾çš„ <code>pod</code>  ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<h5 id=\"ä¿®æ”¹å›åŸæ¥çš„æ ‡ç­¾\"><a class=\"markdownIt-Anchor\" href=\"#ä¿®æ”¹å›åŸæ¥çš„æ ‡ç­¾\">#</a> ä¿®æ”¹å›åŸæ¥çš„æ ‡ç­¾</h5>\n<p>æˆ‘å…ˆæŠŠ æ ‡ç­¾ä¿®æ”¹æˆåŸæ¥çš„  <code>kubectl label pod replica-set-demo-z48pp rs_label=rs-demo --overwrite=True</code></p>\n<p><img data-src=\"/images/k8s/04-06.png\" alt=\"\"></p>\n<p><code>k8s</code>  åˆ æ‰äº†æœ€æ–°åˆ›å»ºçš„é‚£ä¸ªå®¹å™¨ã€‚</p>\n<h5 id=\"æ–°å»ºä¸€ä¸ªç›¸åŒæ ‡ç­¾çš„podå®¹å™¨\"><a class=\"markdownIt-Anchor\" href=\"#æ–°å»ºä¸€ä¸ªç›¸åŒæ ‡ç­¾çš„podå®¹å™¨\">#</a> æ–°å»ºä¸€ä¸ªç›¸åŒæ ‡ç­¾çš„ <code>pod</code>  å®¹å™¨</h5>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">rs-demo-add-sample-label-ex</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">rs_label:</span> <span class=\"string\">rs-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">rs-demo-add-sample-label-ex-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<p>åˆ›å»ºè¿™ä¸ªå®¹å™¨ä¹‹åï¼Œä¼šå‘ç°</p>\n<p><img data-src=\"/images/k8s/04-07.png\" alt=\"\"></p>\n<p>è¿™ä¸ªå®¹å™¨åœ¨åˆ›å»ºæ—¶æœºå°±ä¼šè¢« <code>kill</code>  æ‰ã€‚</p>\n<h5 id=\"åˆ é™¤-replicaset\"><a class=\"markdownIt-Anchor\" href=\"#åˆ é™¤-replicaset\">#</a> åˆ é™¤ ReplicaSet</h5>\n<p>ä½¿ç”¨å‘½ä»¤  <code>kubectl delete rs replica-set-demo</code>  åˆ é™¤å³å¯.</p>\n<p><img data-src=\"/images/k8s/04-08.png\" alt=\"\"></p>\n<h3 id=\"deployment\"><a class=\"markdownIt-Anchor\" href=\"#deployment\">#</a>  <code>Deployment</code></h3>\n<p><img data-src=\"/images/k8s/04-11.png\" alt=\"\"></p>\n<p><code>Deployment</code>  ä¸º  <code>Pod</code>  å’Œ  <code>ReplicaSet</code>  æä¾›äº†ä¸€ä¸ªå£°æ˜å¼å®šä¹‰ ( <code>declarative</code> ) æ–¹æ³•ï¼Œç”¨æ¥æ›¿ä»£ä»¥å‰çš„  <code>ReplicationController</code>  æ¥æ–¹ä¾¿çš„ç®¡ç†åº”ç”¨ã€‚å…¸å‹çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼›</p>\n<ul>\n<li>å®šä¹‰  <code>Deployment</code>  æ¥åˆ›å»º  <code>Pod</code>  å’Œ  <code>ReplicaSet</code></li>\n<li>æ»šåŠ¨å‡çº§å’Œå›æ»šåº”ç”¨</li>\n<li>æ‰©å®¹å’Œç¼©å®¹</li>\n<li>æš‚åœå’Œç»§ç»­  <code>Deployment</code> .</li>\n</ul>\n<h5 id=\"å‡çº§ç­–ç•¥\"><a class=\"markdownIt-Anchor\" href=\"#å‡çº§ç­–ç•¥\">#</a> å‡çº§ç­–ç•¥</h5>\n<p><code>Deployment</code>  å¯ä»¥ä¿è¯åœ¨å‡çº§æ—¶åªæœ‰ä¸€å®šæ•°é‡çš„  <code>Pod</code>  æ˜¯  <code>down</code>  çš„ã€‚é»˜è®¤çš„ï¼Œå®ƒä¼šç¡®ä¿è‡³å°‘æœ‰æ¯”æœŸæœ›çš„ Pod æ•°é‡å°‘ä¸€ä¸ªæ˜¯ <code>up</code>  çŠ¶æ€ (æœ€å¤šä¸€ä¸ªä¸å¯ç”¨)</p>\n<p><code>Deployment</code>  åŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿åªåˆ›å»ºå‡ºè¶…è¿‡æœŸæœ›æ•°é‡çš„ä¸€å®šæ•°é‡çš„  <code>Pod</code> ã€‚é»˜è®¤çš„ï¼Œå®ƒä¼šç¡®ä¿æœ€å¤šæ¯”æœŸæœ›çš„ <code>Pod</code>  æ•°<br>\né‡å¤šä¸€ä¸ªçš„  <code>Pod</code>  æ˜¯  <code>up</code>  çš„ (æœ€å¤š <code>1</code>  ä¸ª  <code>surge</code>  )</p>\n<p>æœªæ¥çš„  <code>Kuberentes</code>  ç‰ˆæœ¬ä¸­ï¼Œå°†ä» <code>1-1</code>  å˜æˆ <code>25%-25%</code></p>\n<h4 id=\"å®éªŒ-2\"><a class=\"markdownIt-Anchor\" href=\"#å®éªŒ-2\">#</a> å®éªŒ</h4>\n<h5 id=\"åˆ›å»ºdeployment\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºdeployment\">#</a> åˆ›å»º <code>Deployment</code></h5>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">deployment-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">3</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">demo_name:</span> <span class=\"string\">deployment-labels</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">demo_name:</span> <span class=\"string\">deployment-labels</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">deployment-demo-container</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>ä½¿ç”¨å‘½ä»¤  <code>kubectl get pod -w</code>  ç›‘å¬ Pod çš„å˜åŒ–</li>\n<li>ä½¿ç”¨å‘½ä»¤  <code>kubectl apply -f 07-deployment-demo.yaml</code>  åˆ›å»º  <code>deployment</code> <br>\n<img data-src=\"/images/k8s/04-09.png\" alt=\"\"></li>\n<li>æŸ¥çœ‹å¯¹åº” <code>Pod</code>  çš„å˜åŒ–ã€‚<br>\n<img data-src=\"/images/k8s/04-10.png\" alt=\"\"></li>\n</ul>\n<h5 id=\"æ‰©ç¼©å®¹\"><a class=\"markdownIt-Anchor\" href=\"#æ‰©ç¼©å®¹\">#</a> æ‰©ç¼©å®¹</h5>\n<p>ä¸‹é¢æˆ‘ä»¬å…ˆæ¼”ç¤ºä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ¡ˆä¾‹ï¼Œæ‰©ç¼©å®¹ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl scale deployment deployment-demo --replicas=4</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/04-12.png\" alt=\"\"></p>\n<p>å¦‚æœé›†ç¾¤æ”¯æŒè‡ªåŠ¨æ‰©å®¹çš„è¯ï¼Œè¿˜å¯ä»¥ä¸ºé›†ç¾¤è®¾ç½®  <code>autoscaling</code> .</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl autoscale deployment xxx --min=10 --max=15 --cpu-percent=80</span><br></pre></td></tr></table></figure>\n<h5 id=\"è®¾ç½®é•œåƒ\"><a class=\"markdownIt-Anchor\" href=\"#è®¾ç½®é•œåƒ\">#</a> è®¾ç½®é•œåƒ</h5>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl set image xxxx imagesName:v1</span><br></pre></td></tr></table></figure>\n<p>å…·ä½“å¦‚ä½•æ“ä½œæ¥ç€å¾€ä¸‹çœ‹ã€‚</p>\n<h5 id=\"æ»šåŠ¨å‡çº§\"><a class=\"markdownIt-Anchor\" href=\"#æ»šåŠ¨å‡çº§\">#</a> æ»šåŠ¨å‡çº§</h5>\n<p>åœ¨çœŸæ˜¯çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡è®¾ç½®å‡çº§é•œåƒçš„ç‰ˆæœ¬æ¥è§¦å‘  <code>deployment</code>  çš„å‡çº§.</p>\n<ul>\n<li>ä½¿ç”¨å‘½ä»¤  <code>kubectl set image deployment/deployment-demo deployment-demo-container=fangjiaxiaobai/my-app:v2</code>  ä¿®æ”¹  <code>deployment</code>  çš„ç‰ˆæœ¬ã€‚<br>\n<img data-src=\"/images/k8s/04-14.png\" alt=\"\"></li>\n<li>æŸ¥çœ‹  <code>Deployment</code>  çš„å˜åŒ–è¿‡ç¨‹<br>\n<img data-src=\"/images/k8s/04-13.png\" alt=\"\"><br>\nå¯ä»¥çœ‹åˆ°  <code>k8s</code>  å…ˆå¯åŠ¨ä¸€ä¸ª <code>pod</code> , ç„¶å <code>kill</code>  ä¸€ä¸ª <code>pod</code> . æœ€ç»ˆå®Œæˆæ•´ä¸ª  <code>Deployment</code>  çš„æ›´æ–°ã€‚</li>\n<li>ç„¶åï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸‹é¡µé¢ï¼Œçœ‹ä¸€ä¸ªåº”ç”¨çš„ç‰ˆæœ¬<br>\n<img data-src=\"/images/k8s/04-15.png\" alt=\"\"></li>\n</ul>\n<h5 id=\"å›æ»š-rollover\"><a class=\"markdownIt-Anchor\" href=\"#å›æ»š-rollover\">#</a> å›æ»š rollover</h5>\n<ul>\n<li>ä½¿ç”¨å‘½ä»¤  <code>kubectl rollout undo deployment/deployment-demo</code>  å°†  <code>Deployment</code>  å›æ»šåˆ°ä¸Šä¸€æ¬¡çš„ç‰ˆæœ¬</li>\n</ul>\n<p><img data-src=\"/images/k8s/04-16.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°å·²ç»å›æ»šåˆ°äº†  <code>V1</code>  ç‰ˆæœ¬ã€‚</p>\n<h5 id=\"æ¸…ç†ç­–ç•¥\"><a class=\"markdownIt-Anchor\" href=\"#æ¸…ç†ç­–ç•¥\">#</a> æ¸…ç†ç­–ç•¥</h5>\n<p>å¯ä»¥é€šè¿‡è®¾ç½®  <code>.spec.revisonHistoryLimit</code>  æ¥æŒ‡å®š  <code>deploymenet</code>  æœ€å¤šä¿ç•™  <code>revison</code>  å†å²ç‰ˆæœ¬ã€‚é»˜è®¤ä¼šä¿ç•™æ‰€æœ‰å†å²ç‰ˆæœ¬ï¼Œå¦‚æœè®¾ç½®ä¸º <code>0</code> , åˆ™  <code>Deployment</code>  å°±ä¸å…è®¸å›æ»šäº†ã€‚</p>\n<blockquote>\n<p>å‘½ä»¤å¼ç¼–ç¨‹ å’Œ å‘½ä»¤å¼ç¼–ç¨‹</p>\n<ul>\n<li>å‘½ä»¤å¼ç¼–ç¨‹ï¼šå®ƒä¾§é‡äº å¦‚ä½•å®ç°ç¨‹åºï¼Œå°±åƒæˆ‘ä»¬åˆšæ¥è§¦ç¼–ç¨‹çš„æ—¶å€™é‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç¨‹åºçš„å®ç°è¿‡ç¨‹æŒ‰ç…§é€»è¾‘ä¸€æ­¥æ­¥å†™ä¸‹æ¥ã€‚é¢å‘è¿‡ç¨‹ç¼–ç¨‹ã€‚</li>\n<li>å£°æ˜å¼ç¼–ç¨‹ï¼šå®ƒä¾§é‡äºå®šä¹‰æƒ³è¦ä»€ä¹ˆï¼Œç„¶åå‘Šè¯‰è®¡ç®—æœº / å¼•æ“ï¼Œè®©ä»–å¸®ä½ å»å®ç°ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹.</li>\n</ul>\n</blockquote>\n<h3 id=\"daemonset\"><a class=\"markdownIt-Anchor\" href=\"#daemonset\">#</a>  <code>Daemonset</code></h3>\n<p><code>DaemonSet</code>  ç¡®ä¿å…¨éƒ¨ (æˆ–è€…ä¸€äº›) <code>Node</code>  ä¸Šè¿è¡Œä¸€ä¸ª  <code>Pod</code>  çš„å‰¯æœ¬ã€‚å½“æœ‰  <code>Node</code>  åŠ å…¥é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª  <code>Pod</code>  ã€‚å½“æœ‰  <code>Node</code>  ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº›  <code>Pod</code>  ä¹Ÿä¼šè¢«å›æ”¶ã€‚åˆ é™¤  <code>DaemonSet</code>  å°†ä¼šåˆ é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰  <code>Pod</code> . ä½¿ç”¨  <code>DaemonSet</code>  çš„ä¸€äº›å…¸å‹ç”¨æ³•:</p>\n<ul>\n<li>è¿è¡Œé›†ç¾¤å­˜å‚¨  <code>daemon</code>  ï¼Œä¾‹å¦‚åœ¨æ¯ä¸ª  <code>Node</code>  ä¸Šè¿è¡Œ  <code>glusterd</code>  ã€  <code>ceph</code></li>\n<li>åœ¨æ¯ä¸ª  <code>Node</code>  ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›†  <code>daemon</code>  ï¼Œä¾‹å¦‚  <code>fluentd</code>  ã€  <code>logstash</code></li>\n<li>åœ¨æ¯ä¸ª  <code>Node</code>  ä¸Šè¿è¡Œç›‘æ§  <code>daemon</code>  ï¼Œä¾‹å¦‚ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Byb21ldGhldXMvbm9kZV9leHBvcnRlcg==\">Prometheus Node Exporter</span>ã€  <code>collectd</code>   <code>ã€Datadog</code>  ä»£ç†ã€  <code>New Relic</code>  ä»£ç†ï¼Œæˆ– <code> Ganglia gmond</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">DaemonSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">daemon-set-demo</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">daemon-set</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">daemon-set</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">daemon-set</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">daemon-set-demo-container</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/04-17.png\" alt=\"\"></p>\n<h3 id=\"job\"><a class=\"markdownIt-Anchor\" href=\"#job\">#</a> Job</h3>\n<p><code>Job</code>  è´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå³ä»…æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå®ƒä¿è¯æ‰¹å¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ª  <code>Pod</code>  æˆåŠŸç»“æŸ</p>\n<ul>\n<li>ç‰¹æ®Šè¯´æ˜\n<ul>\n<li><code>spec.template</code> : æ ¼å¼åŒ  <code>pod</code> .</li>\n<li><code>RestartPolicy</code> : ä»…æ”¯æŒ  <code>Never</code>  æˆ–è€…  <code>OnFailure</code> .</li>\n<li>å•ä¸ª  <code>Pod</code>  æ—¶ é»˜è®¤  <code>Pod</code>  æˆåŠŸè¿è¡Œå  <code>Job</code>  å³ç»“æŸã€‚</li>\n<li><code>.spec.completios</code> : æ ‡å¿— Job ç»“æŸæ—¶éœ€è¦æˆåŠŸè¿è¡Œçš„ <code>Pod</code>  ä¸ªæ•°ã€‚</li>\n<li><code>.spec.parallelism</code> : æ ‡è¯† å¹¶è¡Œè¿è¡Œçš„ <code>pod</code>  çš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º 1</li>\n<li><code>.spec.activeDeadlineSeconds</code> : æ ‡è¯†å¤±è´¥ <code>Pod</code>  é‡è¯•çš„æœ€åé—´éš”æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°†ä¸ä¼šå†é‡è¯•</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"å®éªŒ-3\"><a class=\"markdownIt-Anchor\" href=\"#å®éªŒ-3\">#</a> å®éªŒ</h4>\n<ul>\n<li>åˆ›å»ºä¸€ä¸ª Job</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">batch/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Job</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">job-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">job-demo-template</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">job-demo-container</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">perl:5.34.0</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span> [<span class=\"string\">&quot;perl&quot;</span>, <span class=\"string\">&quot;-Mbignum=bpi&quot;</span>, <span class=\"string\">&quot;-wle&quot;</span>, <span class=\"string\">&quot;print bpi(2000)&quot;</span>]</span><br><span class=\"line\">      <span class=\"attr\">restartPolicy:</span> <span class=\"string\">Never</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/04-18.png\" alt=\"\"></p>\n<h3 id=\"cron-job\"><a class=\"markdownIt-Anchor\" href=\"#cron-job\">#</a> Cron Job</h3>\n<p><code>Cron Job</code>  ç®¡ç†åŸºäºæ—¶é—´çš„  <code>Job</code> ï¼Œå³:<br>\n åœ¨ç»™å®šæ—¶é—´ç‚¹åªè¿è¡Œä¸€æ¬¡<br>\nå‘¨æœŸæ€§åœ°åœ¨ç»™å®šæ—¶é—´ç‚¹è¿è¡Œ<br>\nä½¿ç”¨å‰ææ¡ä»¶:<strong> å½“å‰ä½¿ç”¨çš„ Kubernetes é›†ç¾¤ï¼Œç‰ˆæœ¬ &gt;= 1.8 (å¯¹ CronJob)ã€‚å¯¹äºå…ˆå‰ç‰ˆæœ¬çš„é›†ç¾¤ï¼Œç‰ˆæœ¬ &lt; 1.8ï¼Œå¯åŠ¨ API Server æ—¶ï¼Œé€šè¿‡ä¼ é€’é€‰é¡¹ --runtime-config=batch/v2alpha1=true å¯ä»¥å¼€å¯ batch/v2alpha1 API</strong><br>\n å…¸å‹çš„ç”¨æ³•å¦‚ä¸‹æ‰€ç¤º:</p>\n<ul>\n<li>åœ¨ç»™å®šçš„æ—¶é—´ç‚¹è°ƒåº¦  <code>Job</code>  è¿è¡Œ</li>\n<li>åˆ›å»ºå‘¨æœŸæ€§è¿è¡Œçš„  <code>Job</code> ï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“å¤‡ä»½ã€å‘é€é‚®ä»¶</li>\n</ul>\n<h4 id=\"ç‰¹æ®Šè¯´æ˜\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹æ®Šè¯´æ˜\">#</a> ç‰¹æ®Šè¯´æ˜</h4>\n<ul>\n<li><code>spec.schedule</code>  ï¼šè°ƒåº¦ï¼Œå¿…éœ€å­—æ®µï¼ŒæŒ‡å®šä»»åŠ¡è¿è¡Œå‘¨æœŸï¼Œæ ¼å¼åŒ  <code>Cron</code></li>\n<li><code>spec.jobTemplate</code>  ï¼š  <code>Job</code>  æ¨¡æ¿ï¼Œå¿…éœ€å­—æ®µï¼ŒæŒ‡å®šéœ€è¦è¿è¡Œçš„ä»»åŠ¡ï¼Œæ ¼å¼åŒ  <code>Job</code></li>\n<li><code>spec.startingDeadlineSeconds</code>  ï¼šå¯åŠ¨  <code>Job</code>  çš„æœŸé™ï¼ˆç§’çº§åˆ«ï¼‰ï¼Œè¯¥å­—æ®µæ˜¯å¯é€‰çš„ã€‚å¦‚æœå› ä¸ºä»»ä½•åŸå› è€Œé”™<br>\nè¿‡äº†è¢«è°ƒåº¦çš„æ—¶é—´ï¼Œé‚£ä¹ˆé”™è¿‡æ‰§è¡Œæ—¶é—´çš„  <code>Job</code>  å°†è¢«è®¤ä¸ºæ˜¯å¤±è´¥çš„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™æ²¡æœ‰æœŸé™</li>\n<li><code>spec.concurrencyPolicy</code>  ï¼šå¹¶å‘ç­–ç•¥ï¼Œè¯¥å­—æ®µä¹Ÿæ˜¯å¯é€‰çš„ã€‚å®ƒæŒ‡å®šäº†å¦‚ä½•å¤„ç†è¢«  <code>Cron Job</code>  åˆ›å»ºçš„  <code>Job</code>  çš„å¹¶å‘æ‰§è¡Œã€‚åªå…è®¸æŒ‡å®šä¸‹é¢ç­–ç•¥ä¸­çš„ä¸€ç§ï¼š\n<ul>\n<li><code>Allow</code>  ï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸å¹¶å‘è¿è¡Œ  <code>Job</code></li>\n<li><code>Forbid</code>  ï¼šç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœå‰ä¸€ä¸ªè¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™ç›´æ¥è·³è¿‡ä¸‹ä¸€ä¸ª</li>\n<li><code>Replace</code>  ï¼šå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„  <code>Job</code> ï¼Œç”¨ä¸€ä¸ªæ–°çš„æ¥æ›¿æ¢ã€‚<br>\næ³¨æ„ï¼Œå½“å‰ç­–ç•¥åªèƒ½åº”ç”¨äºåŒä¸€ä¸ª  <code>Cron Job</code>  åˆ›å»ºçš„  <code>Job</code> ã€‚å¦‚æœå­˜åœ¨å¤šä¸ª  <code>Cron Job</code> ï¼Œå®ƒä»¬åˆ›å»ºçš„  <code>Job</code>  ä¹‹é—´æ€»æ˜¯å…è®¸å¹¶å‘è¿è¡Œã€‚</li>\n</ul>\n</li>\n<li><code>spec.suspend</code>  ï¼šæŒ‚èµ·ï¼Œè¯¥å­—æ®µä¹Ÿæ˜¯å¯é€‰çš„ã€‚å¦‚æœè®¾ç½®ä¸º  <code>true</code>  ï¼Œåç»­æ‰€æœ‰æ‰§è¡Œéƒ½ä¼šè¢«æŒ‚èµ·ã€‚å®ƒå¯¹å·²ç»å¼€å§‹æ‰§è¡Œçš„  <code>Job</code>  ä¸èµ·ä½œç”¨ã€‚é»˜è®¤å€¼ä¸º  <code>false</code>  ã€‚</li>\n<li><code>spec.successfulJobsHistoryLimit</code>  å’Œ  <code>.spec.failedJobsHistoryLimit</code>  ï¼šå†å²é™åˆ¶ï¼Œæ˜¯å¯é€‰çš„å­—æ®µã€‚å®ƒä»¬æŒ‡å®šäº†å¯ä»¥ä¿ç•™å¤šå°‘å®Œæˆå’Œå¤±è´¥çš„  <code>Job</code> ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬åˆ†åˆ«è®¾ç½®ä¸º  <code>3</code>  å’Œ  <code>1</code>  ã€‚è®¾ç½®é™åˆ¶çš„å€¼ä¸º  <code>0</code>  ï¼Œç›¸å…³ç±»å‹çš„  <code>Job</code>  å®Œæˆåå°†ä¸ä¼šè¢«ä¿ç•™ã€‚</li>\n</ul>\n<h4 id=\"å®éªŒ-4\"><a class=\"markdownIt-Anchor\" href=\"#å®éªŒ-4\">#</a> å®éªŒ</h4>\n<h5 id=\"åˆ›å»º-cronjob\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-cronjob\">#</a> åˆ›å»º  <code>CronJob</code></h5>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">batch/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">CronJob</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">cron-job-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">schedule:</span> <span class=\"string\">&quot;*/1 * * * *&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">jobTemplate:</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">template:</span></span><br><span class=\"line\">        <span class=\"attr\">spec:</span></span><br><span class=\"line\">          <span class=\"attr\">containers:</span></span><br><span class=\"line\">          <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">cron-job-demo-container</span></span><br><span class=\"line\">            <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">            <span class=\"attr\">args:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">/bin/sh</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">-c</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">date;</span> <span class=\"string\">echo</span> <span class=\"string\">&#x27;hello ,Iâ€˜m from K8s cluster.&#x27;</span></span><br><span class=\"line\">          <span class=\"attr\">restartPolicy:</span> <span class=\"string\">OnFailure</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/04-20.png\" alt=\"\"></p>\n<p>ç„¶åå¯ä»¥æŸ¥çœ‹ä¸€ä¸ª <code>pod</code>  çš„è¿è¡Œæƒ…å†µ:</p>\n<p><img data-src=\"/images/k8s/04-21.png\" alt=\"\"></p>\n<p>æ¯ä¸ª <code>job</code>  éƒ½æ˜¯ç›¸éš”ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</p>\n<h3 id=\"statefulset\"><a class=\"markdownIt-Anchor\" href=\"#statefulset\">#</a>  <code>StatefulSet</code></h3>\n<p><code>StatefulSet</code>  ä½œä¸º  <code>Controller</code>  ä¸º  <code>Pod</code>  æä¾›å”¯ä¸€çš„æ ‡è¯†ã€‚å®ƒå¯ä»¥ä¿è¯éƒ¨ç½²å’Œ  <code>scale</code>  çš„é¡ºåº<br>\n <code>StatefulSet</code>  æ˜¯ä¸ºäº†è§£å†³æœ‰çŠ¶æ€æœåŠ¡çš„é—®é¢˜ (å¯¹åº”  <code>Deployments</code>  å’Œ  <code>ReplicaSets</code>  æ˜¯ä¸ºæ— çŠ¶æ€æœåŠ¡è€Œè®¾è®¡)ï¼Œå…¶åº”ç”¨ åœºæ™¯åŒ…æ‹¬:</p>\n<ul>\n<li>ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨ï¼Œå³ <code>Pod</code>  é‡æ–°è°ƒåº¦åè¿˜æ˜¯èƒ½è®¿é—®åˆ°ç›¸åŒçš„æŒä¹…åŒ–æ•°æ®ï¼ŒåŸºäº <code>PVC</code>  æ¥å®ç° ç¨³å®šçš„ç½‘ç»œæ ‡å¿—ï¼Œå³ <code>Pod</code>  é‡æ–°è°ƒåº¦åå…¶ <code>PodName</code>  å’Œ <code>HostName</code>  ä¸å˜ï¼ŒåŸºäº <code>Headless Service</code>  (å³æ²¡æœ‰  <code>Cluster IP</code>  çš„ <code>Service</code> ) æ¥å®ç°ã€‚</li>\n<li>æœ‰åºéƒ¨ç½²ï¼Œæœ‰åºæ‰©å±•ï¼Œå³ <code>Pod</code>  æ˜¯æœ‰é¡ºåºçš„ï¼Œåœ¨éƒ¨ç½²æˆ–è€…æ‰©å±•çš„æ—¶å€™è¦ä¾æ®å®šä¹‰çš„é¡ºåºä¾æ¬¡ä¾æ¬¡è¿›è¡Œ (å³ä» <code>0</code>  åˆ°  <code>N-1</code> ï¼Œåœ¨ä¸‹ä¸€ä¸ª <code>Pod</code>  è¿è¡Œä¹‹å‰æ‰€æœ‰ä¹‹å‰çš„ <code>Pod</code>  å¿…é¡»éƒ½æ˜¯ <code>Running</code>  å’Œ <code>Ready</code>  çŠ¶æ€)ï¼ŒåŸºäº <code>init containers</code>  æ¥å® ç°<br>\næœ‰åºæ”¶ç¼©ï¼Œæœ‰åºåˆ é™¤ (å³ä» <code>N-1</code>  åˆ° <code>0</code> )</li>\n</ul>\n<h3 id=\"horizontal-pod-autoscaling\"><a class=\"markdownIt-Anchor\" href=\"#horizontal-pod-autoscaling\">#</a>  <code>Horizontal Pod Autoscaling</code></h3>\n<p>åº”ç”¨çš„èµ„æºä½¿ç”¨ç‡é€šå¸¸éƒ½æœ‰é«˜å³°å’Œä½è°·çš„æ—¶å€™ï¼Œå¦‚ä½•å‰Šå³°å¡«è°·ï¼Œæé«˜é›†ç¾¤çš„æ•´ä½“èµ„æºåˆ©ç”¨ç‡ï¼Œè®© <code>service</code>  ä¸­çš„ <code>Pod</code>  ä¸ªæ•°è‡ªåŠ¨è°ƒæ•´å‘¢ï¼Ÿè¿™å°±æœ‰èµ–äº <code>Horizontal Pod Autoscaling</code>  äº†ï¼Œé¡¾åæ€ä¹‰ï¼Œä½¿ <code>Pod</code>  æ°´å¹³è‡ªåŠ¨ç¼©æ”¾</p>\n<p>æ–‡ä¸­æ‰€æœ‰çš„ <code>k8s yaml</code>  é…ç½®æ–‡ä»¶å‡å¯ä»  <code>https://github.com/fangjiaxiaobai/k8s/tree/main/yamls</code>  è·å–ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "k8s",
                "kubernetes"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/07/31/k8s/seris03-pod-lifecycle/",
            "url": "https://fangjiaxiaobai.github.io/2022/07/31/k8s/seris03-pod-lifecycle/",
            "title": "k8s-Podçš„ç”Ÿå‘½å‘¨æœŸ",
            "date_published": "2022-07-31T10:18:00.000Z",
            "content_html": "<p><code>K8s</code>  ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œèµ„æºå®ä¾‹åŒ–ä¸ºå¯¹è±¡ã€‚</p>\n<h2 id=\"é›†ç¾¤èµ„æºçš„åˆ†ç±»\"><a class=\"markdownIt-Anchor\" href=\"#é›†ç¾¤èµ„æºçš„åˆ†ç±»\">#</a> é›†ç¾¤èµ„æºçš„åˆ†ç±»</h2>\n<h3 id=\"åç§°ç©ºé—´çº§åˆ«\"><a class=\"markdownIt-Anchor\" href=\"#åç§°ç©ºé—´çº§åˆ«\">#</a> åç§°ç©ºé—´çº§åˆ«</h3>\n<ul>\n<li>å·¥ä½œè´Ÿè½½å‹èµ„æº (  <code>workload</code>  )ï¼š  <code>Pod</code> ã€ <code>ReplicaSet</code> ã€ <code>Deployment</code> ã€ <code>StatefulSet</code> ã€ <code>DaemonSetã€Job</code> ã€  <code>CronJob</code>  (  <code>ReplicationController</code>  åœ¨  <code>v1.11</code>  ç‰ˆæœ¬è¢«åºŸå¼ƒ )</li>\n<li>æœåŠ¡å‘ç°åŠè´Ÿè½½å‡è¡¡å‹èµ„æº (  <code>ServiceDiscovery LoadBalance</code>  ):  <code>Service</code> ã€ <code>Ingress</code> ã€â€¦</li>\n<li>é…ç½®ä¸å­˜å‚¨å‹èµ„æºï¼š <code> Volume</code>  (å­˜å‚¨å·)ã€ <code>CSI</code>  (å®¹å™¨å­˜å‚¨æ¥å£ï¼Œå¯ä»¥æ‰©å±•å„ç§å„æ ·çš„ç¬¬ä¸‰æ–¹å­˜å‚¨å·)</li>\n<li>ç‰¹æ®Šç±»å‹çš„å­˜å‚¨å·ï¼š <code>ConfigMap</code>  (å½“é…ç½®ä¸­å¿ƒæ¥ä½¿ç”¨çš„èµ„æºç±»å‹)ã€ <code>Secret</code>  (ä¿å­˜æ•æ„Ÿæ•°æ®)ã€  <code>DownwardAPI</code>  (æŠŠå¤–éƒ¨ç¯å¢ƒä¸­çš„ä¿¡æ¯è¾“å‡ºç»™å®¹å™¨)</li>\n</ul>\n<h3 id=\"é›†ç¾¤çº§åˆ«\"><a class=\"markdownIt-Anchor\" href=\"#é›†ç¾¤çº§åˆ«\">#</a> é›†ç¾¤çº§åˆ«</h3>\n<p>ä¸€æ—¦å®šä¹‰åœ¨é›†ç¾¤å†…éƒ½å¯è§ã€‚</p>\n<p><code>Namespace</code> ,  <code>Node</code> ,  <code>Role</code> ,  <code>ClusterRole</code> ,  <code>RoleBindiing</code> ,  <code>ClusterRoleBinding</code></p>\n<h3 id=\"å…ƒæ•°æ®å‹\"><a class=\"markdownIt-Anchor\" href=\"#å…ƒæ•°æ®å‹\">#</a> å…ƒæ•°æ®å‹</h3>\n<p><code>HPA</code> ã€ <code>PodTemplate</code> ã€ <code>LimitRange</code></p>\n<p>åœ¨ <code>k8s</code>  ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨  <code>yaml</code>  æ ¼å¼çš„æ–‡ä»¶æ¥åˆ›å»ºç¬¦åˆæˆ‘ä»¬é¢„æœŸæœŸæœ›çš„ <code>pod</code> , è¿™æ ·çš„  <code>yaml</code>  æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬æˆä¸º èµ„æºæ¸…å•ã€‚</p>\n<ul>\n<li><code>apiVersion</code> :   <code>String</code> ,  <code>K8s Api</code>  çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨ <code>kubectl api-versions</code>  å‘½ä»¤æŸ¥è¯¢</li>\n<li><code>kind</code> :  <code>String</code> ,  <code>yaml</code>  å®šä¹‰çš„èµ„æºç±»å‹å’Œè§’è‰²</li>\n<li><code>metadata</code> :  <code>Object</code> , å…ƒæ•°æ®å¯¹è±¡ï¼Œå›ºå®šå€¼å°±å†™  <code>metadata</code>\n<ul>\n<li><code>name</code> : å…ƒæ•°æ®å¯¹è±¡çš„åç§°</li>\n<li><code>namespace</code> : å…ƒæ•°æ®å¯¹è±¡çš„å‘½åç©ºé—´ï¼Œæœ‰æˆ‘ä»¬è‡ªèº«å®šä¹‰</li>\n</ul>\n</li>\n<li><code>spec</code> : <code>Object</code>  è¯¦ç»†å®šä¹‰å¯¹è±¡ï¼Œå›ºå®šå€¼æ˜¯ <code>Spec</code>\n<ul>\n<li><code>containers[]</code> :  <code>list</code>  ç±»å‹ï¼Œè¿™é‡Œæ˜¯ <code>spec</code>  å¯¹è±¡çš„å®¹å™¨åˆ—è¡¨å®šä¹‰ï¼Œæ˜¯ä¸ªåˆ—è¡¨\n<ul>\n<li><code>name</code> :  <code>String</code> , è¿™é‡Œæ˜¯å®šä¹‰å®¹å™¨çš„åå­—</li>\n<li><code>image</code> :  <code>String</code> , è¿™é‡Œå®šä¹‰è¦ç”¨åˆ°çš„é•œåƒåç§°</li>\n<li><code>imagePullPolicy</code> :  <code>String</code> , å®šä¹‰é•œåƒæ‹‰å–ç­–ç•¥ï¼Œæœ‰ <code>Always</code> , <code>Never</code> , <code>IfNotPresent</code> , ä¸‰ä¸ªå€¼ã€‚é»˜è®¤æ˜¯  <code>Always</code> .\n<ul>\n<li>1ã€ <code>Always</code> : æ¯æ¬¡éƒ½å°è¯•æ‹‰å–é•œåƒ</li>\n<li>2ã€ <code>Never</code> : è¡¨ç¤ºä»…ä½¿ç”¨æœ¬åœ°é•œåƒ</li>\n<li>3ã€ <code>IfNotPresent</code> : å¦‚æœæœ¬åœ°æœ‰é•œåƒå°±ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæ²¡æœ‰å°±æ‹‰å–åœ¨çº¿é•œåƒã€‚</li>\n</ul>\n</li>\n<li><code>command[]</code> ,  <code>List</code> , å®¹å™¨å¯åŠ¨å‘½ä»¤ï¼Œå› ä¸ºæ˜¯æ•°æ®å¯ä»¥æŒ‡å®šå¤šä¸ªï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒæ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</li>\n<li><code>args</code> :  <code>Listï¼Œ</code>  æŒ‡å®šå®¹å™¨å¯åŠ¨çš„å‘½ä»¤å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª</li>\n<li><code>workingDir</code> :  <code>String</code> , æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•</li>\n<li><code>volumeMountsp[]</code> ,  <code>List</code> : æŒ‡å®šå®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®\n<ul>\n<li><code>name</code> :  <code>String</code> , æŒ‡å®šå¯ä»¥æŒ‚è½½çš„å­˜å‚¨å·çš„åç§°</li>\n<li><code>mountPath</code> ,  <code>String</code> , æŒ‡å®šå¯ä»¥è¢«å®¹å™¨æŒ‚è½½çš„å­˜å‚¨å·çš„è·¯å¾„</li>\n<li><code>readOnly</code> ,  <code>String</code> , è®¾ç½®å­˜å‚¨å·è·¯å¾„çš„è¯»å†™æ¨¡å‹ï¼Œ  <code>true</code>  æˆ–è€…  <code>false</code> .</li>\n</ul>\n</li>\n<li><code>ports[]</code> ,  <code>List&lt;Object&gt;</code>  , æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„ç«¯å£åˆ—è¡¨\n<ul>\n<li><code>name</code> :  <code>String</code> , ç«¯å£åç§°</li>\n<li><code>containerPort</code> :  <code>String</code> , å®¹å™¨ä½ éœ€è¦ç›‘å¬çš„ç«¯å£å·</li>\n<li><code>hostPort</code> :  <code>String</code> , æŒ‡å®šå®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤è·Ÿä¸Šé¢  <code>containerPort</code>  ç›¸åŒï¼Œ æ³¨æ„è®¾ç½®äº†  <code>hostPort</code>  åŒä¸€å°ä¸»æœºæ— æ³•å¯åŠ¨è¯¥å®¹å™¨çš„ç›¸åŒå‰¯æœ¬</li>\n<li><code>protocol</code> :  <code>String</code> , æŒ‡å®šç«¯å£åè®®ï¼Œæ”¯æŒ  <code>TCP</code> , <code>UDP</code> , é»˜è®¤æ˜¯  <code>TCP</code></li>\n</ul>\n</li>\n<li><code>env[]</code> : <code>List&lt;Object&gt;</code>  , æŒ‡å®šå®¹å™¨è¿è¡Œå‰éœ€è¦è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨\n<ul>\n<li><code>name</code> :  <code>String</code> , ç¯å¢ƒå˜é‡åç§°</li>\n<li><code>value</code> :  <code>String</code> , ç¯å¢ƒå˜é‡å€¼</li>\n</ul>\n</li>\n<li><code>resources</code> :  <code>Object</code> , æŒ‡å®šèµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„å€¼\n<ul>\n<li><code>limits</code> : è®¾ç½®å®¹å™¨è¿è¡Œæ—¶çš„èµ„æºçš„è¿è¡Œä¸Šé™\n<ul>\n<li><code>cpu</code> :  <code>String</code> ,  <code>CPU</code>  çš„é™åˆ¶ï¼Œå•ä½ä¸º  <code>core</code>  æ•°ï¼Œå°†ç”¨äº  <code>docker run --cpu-shares</code>  å‚æ•°ã€‚</li>\n<li><code>memory</code> :  <code>String</code> ,  <code>Mem</code>  å†…å­˜çš„é™åˆ¶ï¼Œå•ä½ä¸º  <code>MIB</code> , <code>GiB</code></li>\n</ul>\n</li>\n<li><code>requests</code> :  <code>Object</code> , æŒ‡å®šå®¹å™¨å¯åŠ¨å’Œè°ƒåº¦æ—¶çš„é™åˆ¶è®¾ç½®\n<ul>\n<li><code>cpu</code> :  <code>m</code> ,   <code>CPU</code>  è¯·æ±‚ã€‚å•ä½ä¸º <code>core</code>  æ•°ï¼Œå®¹å™¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¯ç”¨æ•°é‡</li>\n<li><code>memory</code> :  <code>String</code> , å†…å­˜è¯·æ±‚ï¼Œå•ä½  <code>MIB</code> ,  <code>Gib</code> , å®¹å™¨å¯åŠ¨çš„åˆå§‹åŒ–å¯ç”¨æ•°é‡</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><code>restartPolicy</code> :  <code>String</code> , å®šä¹‰ Pod çš„é‡å¯ç­–ç•¥ï¼Œå¯é€‰å€¼æ˜¯  <code>Always</code> ,  <code>OnFailure</code> , é»˜è®¤å€¼æ˜¯  <code>Always</code> .\n<ul>\n<li>1. <code>Always</code> :  <code>Pod</code>  ä¸€æ—¦ç»ˆæ­¢è¿è¡Œï¼Œåˆ™æ— è®ºå®¹å™¨æ˜¯å¦ç»ˆæ­¢ï¼Œ  <code>kubelet</code>  æœåŠ¡éƒ½å°†é‡å¯å®ƒã€‚</li>\n<li>2ã€ <code>OnFailure</code> : åªæœ‰ <code>Pod</code>  ä»¥é <code>0</code>  é€€å‡ºç ç»ˆæ­¢æ—¶ï¼Œ  <code>kubelet</code>  æ‰ä¼šé‡å¯è¯¥å®¹å™¨ï¼Œå¦‚æœå®¹å™¨æ­£å¸¸ç»“æŸï¼Œåˆ™ä¸ä¼šé‡å¯</li>\n<li>3ã€ <code>Never</code> .  <code>Pod</code>  ç»ˆæ­¢åï¼Œ <code>kubelet</code>  å°†é€€å‡ºç æŠ¥å‘Šç»™ <code>Master</code> ï¼Œä¸ä¼šé‡å¯ <code>Pod</code> .</li>\n</ul>\n</li>\n<li><code>nodeSelector</code> :  <code>Object</code> , å®šä¹‰ <code>Node</code>  çš„ <code>label</code>  è¿‡æ»¤æ ‡ç­¾ï¼Œå·² <code>key</code> , <code>value</code>  çš„æ ¼å¼æŒ‡å®šã€‚</li>\n<li><code>imagePullSecrets</code> :  <code>Object</code> , å®šä¹‰ <code>pull</code>  é•œåƒæ—¶ä½¿ç”¨ Secret åç§°ï¼Œä»¥ <code>name:secretKey</code>  æ ¼å¼æŒ‡å®š</li>\n<li><code>hostNetwork</code> :  <code>Boolean</code> , å®šä¹‰æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œé»˜è®¤å€¼ä¸º <code>false</code> , è®¾ç½®ä¸º <code>true</code>  è¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œ ä¸ä½¿ç”¨ <code>docker</code>  ç½‘æ¡¥ï¼ŒåŒæ—¶è®¾ç½®äº† <code>true</code>  å°†æ— æ³•åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šå¯åŠ¨ç¬¬äºŒä¸ªå‰¯æœ¬ã€‚</li>\n</ul>\n</li>\n</ul>\n<p>å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å®æ—¶æŸ¥çœ‹ yaml çš„é…ç½®å†…å®¹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl explain pod.</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ¡ˆä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#æ¡ˆä¾‹\">#</a> æ¡ˆä¾‹</h3>\n<p>é€šè¿‡èµ„æºæ¸…å•åˆ›å»ºä¸€ä¸ª pod.</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">sample-demo</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">myapp</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">    <span class=\"attr\">containers:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">name:</span> <span class=\"string\">my-app</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨  <code>kubectl create -f 01-sample-yaml.yaml</code>  åˆ›å»º</p>\n<p><img data-src=\"/images/k8s/03-02.png\" alt=\"\"></p>\n<p>ä½¿ç”¨å‘½ä»¤  <code>kubectl get pods -o wide</code>  æŸ¥çœ‹ä¸‹ <code>pod</code>  çš„ <code>ip</code>  å’Œ çŠ¶æ€:</p>\n<p><img data-src=\"/images/k8s/03-03.png\" alt=\"\"></p>\n<p>ç„¶åä½¿ç”¨   <code>curl 10.244.154.195</code>  å¯ä»¥çœ‹åˆ°</p>\n<p><img data-src=\"/images/k8s/03-04.png\" alt=\"\"></p>\n<p>æ­£å¸¸è¿”å›äº†  <code>Nginx</code>  çš„é¦–é¡µä¿¡æ¯ã€‚</p>\n<h2 id=\"pod-çš„ç”Ÿå‘½å‘¨æœŸ\"><a class=\"markdownIt-Anchor\" href=\"#pod-çš„ç”Ÿå‘½å‘¨æœŸ\">#</a>  <code>Pod</code>  çš„ç”Ÿå‘½å‘¨æœŸ</h2>\n<p><img data-src=\"/images/k8s/03-05.png\" alt=\"\"></p>\n<p>å¦‚ä¸Šå›¾ï¼Œ <code>pod</code>  çš„å¯åŠ¨è¿‡ç¨‹æ˜¯:  <code>pod</code>  åˆ›å»ºæ—¶ä¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ª  <code>pause</code>  å®¹å™¨ã€‚ç„¶åæ‰§è¡Œåˆ›å»ºå¤šä¸ª  <code>Init</code>  å®¹å™¨ï¼Œç„¶åå†å¯åŠ¨ ä¸»å®¹å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨é•œåƒåˆ›å»ºèµ·æ¥çš„å…·æœ‰ä¸šåŠ¡å±æ€§çš„å®¹å™¨ï¼Œç§°ä¸ºä¸»å®¹å™¨ã€‚ ä¸»å®¹å™¨ä¼šç»å†  <code>Start-&gt;Running-&gt;Stop</code> , è¿™äº›çŠ¶æ€ã€‚</p>\n<h3 id=\"pause-å®¹å™¨\"><a class=\"markdownIt-Anchor\" href=\"#pause-å®¹å™¨\">#</a> Pause å®¹å™¨</h3>\n<p>ä»åå­—ä¸Šçœ‹ï¼Œ <code>pause</code>  æ˜¯ä¸€ä¸ª &quot;æš‚åœ&quot; çš„å®¹å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šè§£å†³ <code>pod</code>  çš„ç½‘ç»œå’Œå­˜å‚¨çš„é—®é¢˜ã€‚ <code>pause</code>  å®¹å™¨ç§°ä¸º  <code>Infra Container</code> , å…¶ä»–çš„å®¹å™¨ç§°ä¸ºä¸šåŠ¡å®¹å™¨.   <code>Infra container</code>  æ˜¯ä¸€ä¸ªéå¸¸å°çš„é•œåƒï¼Œå¤§æ¦‚  <code>700KB </code> å·¦å³ï¼Œæ˜¯ä¸€ä¸ª <code>C</code>  è¯­è¨€å†™çš„ã€æ°¸è¿œå¤„äº â€œæš‚åœâ€ çŠ¶æ€çš„å®¹å™¨ã€‚ç”±äºæœ‰äº†è¿™æ ·ä¸€ä¸ª  <code>Infra container</code>  ä¹‹åï¼Œå…¶ä»–æ‰€æœ‰å®¹å™¨éƒ½ä¼šé€šè¿‡  <code>Join Namespace</code>  çš„æ–¹å¼åŠ å…¥åˆ°  <code>Infra container</code>  çš„  <code>Network Namespace</code>  ä¸­ã€‚</p>\n<h3 id=\"init-å®¹å™¨\"><a class=\"markdownIt-Anchor\" href=\"#init-å®¹å™¨\">#</a> Init å®¹å™¨</h3>\n<p><code>Pod</code>  èƒ½å¤Ÿå…·æœ‰å¤šä¸ªå®¹å™¨ï¼Œåº”ç”¨è¿è¡Œåœ¨å®¹å™¨é‡Œé¢ï¼Œä½†æ˜¯å®ƒä¹Ÿå¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…ˆäºåº”ç”¨å®¹å™¨å¯åŠ¨çš„ <code>Init</code>  å®¹å™¨ã€‚<br>\n <code>Init</code>  å®¹å™¨ä¸æ™®é€šçš„å®¹å™¨éå¸¸åƒï¼Œé™¤äº†å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p>\n<ul>\n<li><code>Init</code>  å®¹å™¨æ€»æ˜¯è¿è¡Œåˆ°æˆåŠŸå®Œæˆä¸ºæ­¢</li>\n<li>æ¯ä¸ª  <code>Init</code>  å®¹å™¨éƒ½å¿…é¡»åœ¨ä¸‹ä¸€ä¸ª  <code>Init</code>  å®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸå®Œæˆ<br>\nå¦‚æœ  <code>Pod</code>  çš„  <code>Init</code>  å®¹å™¨å¤±è´¥ï¼Œ <code>Kubernetes</code>    <code>Pod</code> ï¼Œç›´åˆ°  <code>Init</code>  å®¹å™¨æˆåŠŸä¸ºæ­¢ã€‚ç„¶è€Œï¼Œå¦‚æœ  <code>Pod</code>  å¯¹åº”çš„  <code>restartPolicy</code>  ä¸º  <code>Never</code> ï¼Œå®ƒä¸ä¼šé‡æ–°å¯åŠ¨</li>\n</ul>\n<p>å› ä¸º  <code>Init</code>  å®¹å™¨å…·æœ‰ä¸åº”ç”¨ç¨‹åºå®¹å™¨åˆ†ç¦»çš„å•ç‹¬é•œåƒï¼Œæ‰€ä»¥å®ƒä»¬çš„å¯åŠ¨ç›¸å…³ä»£ç å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p>\n<ul>\n<li>å®ƒä»¬å¯ä»¥åŒ…å«å¹¶è¿è¡Œå®ç”¨å·¥å…·ï¼Œä½†æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ˜¯ä¸å»ºè®®åœ¨åº”ç”¨ç¨‹åºå®¹å™¨é•œåƒä¸­åŒ…å«è¿™<br>\näº›å®ç”¨å·¥å…·çš„</li>\n<li>å®ƒä»¬å¯ä»¥åŒ…å«ä½¿ç”¨å·¥å…·å’Œå®šåˆ¶åŒ–ä»£ç æ¥å®‰è£…ï¼Œä½†æ˜¯ä¸èƒ½å‡ºç°åœ¨åº”ç”¨ç¨‹åºé•œåƒä¸­ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºé•œåƒæ²¡å¿…è¦  <code>FROM</code>  å¦ä¸€ä¸ªé•œåƒï¼Œåªéœ€è¦åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ç±»ä¼¼  <code>sed</code> ã€  <code>awk</code> ã€  <code>python</code>  æˆ–  <code>dig</code>  è¿™æ ·çš„å·¥å…·ã€‚</li>\n<li>åº”ç”¨ç¨‹åºé•œåƒå¯ä»¥åˆ†ç¦»å‡ºåˆ›å»ºå’Œéƒ¨ç½²çš„è§’è‰²ï¼Œè€Œæ²¡æœ‰å¿…è¦è”åˆå®ƒä»¬æ„å»ºä¸€ä¸ªå•ç‹¬çš„é•œåƒã€‚</li>\n<li><code>Init</code>  å®¹å™¨ä½¿ç”¨  <code>Linux Namespace</code> ï¼Œæ‰€ä»¥ç›¸å¯¹åº”ç”¨ç¨‹åºå®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤ï¼Œå®ƒä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—®  <code>Secret</code>  çš„æƒé™ï¼Œè€Œåº”ç”¨ç¨‹åºå®¹å™¨åˆ™ä¸èƒ½ã€‚</li>\n<li>å®ƒä»¬å¿…é¡»åœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œå®Œæˆï¼Œè€Œåº”ç”¨ç¨‹åºå®¹å™¨æ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œæ‰€ä»¥  <code>Init</code>  å®¹å™¨èƒ½å¤Ÿæä¾›äº†ä¸€ç§ç®€å•çš„é˜»å¡æˆ–å»¶è¿Ÿåº”ç”¨å®¹å™¨çš„å¯åŠ¨çš„æ–¹æ³•ï¼Œç›´åˆ°æ»¡è¶³äº†ä¸€ç»„å…ˆå†³æ¡ä»¶ã€‚</li>\n</ul>\n<h4 id=\"initå°å®éªŒ\"><a class=\"markdownIt-Anchor\" href=\"#initå°å®éªŒ\">#</a>  <code>init</code>  å°å®éªŒã€‚</h4>\n<p>å®éªŒç›®çš„:  <code>init</code>  å®¹å™¨ä¼šä¾æ¬¡å¯åŠ¨ï¼Œåªæœ‰  <code>init</code>  å®¹å™¨å¯åŠ¨å®Œæˆä¹‹åï¼Œ ä¸»å®¹å™¨æ‰ä¼šå¯åŠ¨.</p>\n<h5 id=\"å®éªŒæ­¥éª¤\"><a class=\"markdownIt-Anchor\" href=\"#å®éªŒæ­¥éª¤\">#</a> å®éªŒæ­¥éª¤</h5>\n<ul>\n<li>åˆ›å»º  <code>pod</code> .</li>\n<li>æŸ¥çœ‹  <code>pod</code>  çš„çŠ¶æ€å˜åŒ–</li>\n<li>æŸ¥çœ‹  <code>pod</code>  ä¸­  <code>initC</code>  çš„æ—¥å¿—</li>\n<li>åˆ›å»º  <code>Service-1</code></li>\n<li>æŸ¥çœ‹  <code>pod</code>  çš„çŠ¶æ€å˜åŒ–</li>\n<li>æŸ¥çœ‹  <code>pod</code>  ä¸­  <code>initC</code>  çš„æ—¥å¿—</li>\n<li>åˆ›å»º  <code>Service-2</code></li>\n<li>æŸ¥çœ‹  <code>pod</code>  çš„çŠ¶æ€å˜åŒ–</li>\n<li>æŸ¥çœ‹  <code>pod</code>  ä¸­  <code>initC</code>  çš„æ—¥å¿—</li>\n<li>æŸ¥çœ‹  <code>pod</code>  çš„æ—¥å¿—</li>\n</ul>\n<h6 id=\"åˆ›å»º-pod\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-pod\">#</a> åˆ›å»º  <code>pod</code> .</h6>\n<ul>\n<li><code>02-init-demo.yaml</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">init-demo</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">init-app</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">my-init-demo</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&quot;sh&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;echo the app is running! &amp;&amp; sleep 3600&quot;</span>]</span><br><span class=\"line\">  <span class=\"attr\">initContainers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">init-myservice-1</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&#x27;sh&#x27;</span>, <span class=\"string\">&#x27;-c&#x27;</span>, <span class=\"string\">&quot;until nslookup my-service-1; do echo &#x27;waiting for my-service-1&#x27;; sleep 2; done;&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">init-myservice-2</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">busybox</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&#x27;sh&#x27;</span>, <span class=\"string\">&#x27;-c&#x27;</span>, <span class=\"string\">&quot;until nslookup my-service-2; do echo &#x27;waiting for my-service-2&#x27;; sleep 2; done;&quot;</span>]</span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨å‘½ä»¤  <code>kubectl create -f 02-init-demo.yaml</code>  åˆ›å»º  <code>pod</code> .</p>\n<p>æ–°å¼€ä¸€ä¸ªçª—å£ä½¿ç”¨  <code>kubectl get pods -w -o wide</code>  å‘½ä»¤ æŸ¥çœ‹ pod çš„å¯åŠ¨å˜åŒ–.<br>\n<img data-src=\"/images/k8s/03-07.jpg\" alt=\"\"></p>\n<h6 id=\"æŸ¥çœ‹æŸ¥çœ‹-pod-ä¸­init-c-1çš„æ—¥å¿—\"><a class=\"markdownIt-Anchor\" href=\"#æŸ¥çœ‹æŸ¥çœ‹-pod-ä¸­init-c-1çš„æ—¥å¿—\">#</a> æŸ¥çœ‹æŸ¥çœ‹  <code>pod</code>  ä¸­ <code>init-c-1</code>  çš„æ—¥å¿—</h6>\n<p><img data-src=\"/images/k8s/03-08.jpg\" alt=\"\"></p>\n<p>å‘ç°  <code>initC-1</code>  ä¸€ç›´åœ¨  <code>nslookup</code>  æŸ¥æ‰¾  <code>my-service-1</code> .</p>\n<h6 id=\"åˆ›å»º-service-1\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-service-1\">#</a> åˆ›å»º  <code>Service-1</code></h6>\n<ul>\n<li><code>02-init-demo-my-service-01.yaml</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-service-1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">     <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">     <span class=\"attr\">targetPort:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨å‘½ä»¤  <code>kubectl create -f 02-init-demo-my-service-01.yaml</code></p>\n<p>æŸ¥çœ‹  <code>pod</code>  ä¸­ç¬¬ä¸€ä¸ª  <code>InitC</code>  çš„æ—¥å¿—</p>\n<p><img data-src=\"/images/k8s/03-08.jpg\" alt=\"\"></p>\n<p>ä¼šå‡ºç°</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Server:\t\t10.96.0.10</span><br><span class=\"line\">Address:\t10.96.0.10:53</span><br><span class=\"line\"></span><br><span class=\"line\">Name:\tmy-service-1.default.svc.cluster.local</span><br><span class=\"line\">Address: 10.108.140.48</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæŸ¥çœ‹  <code>pod</code>  çš„çŠ¶æ€ã€‚ä¼šå‡ºç°ä¸€æ¡ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">init-demo   0/1     Init:1/2   0          4m1s   10.244.154.204   k8s-node-01   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n<h6 id=\"åˆ›å»º-service-2\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-service-2\">#</a> åˆ›å»º  <code>Service-2</code></h6>\n<ul>\n<li><code>02-init-demo-my-service-02.yaml</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">my-service-2</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">   <span class=\"bullet\">-</span> <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">     <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">     <span class=\"attr\">targetPort:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨å‘½ä»¤  <code>kubectl create -f 02-init-demo-my-service-01.yaml</code></p>\n<p>æŸ¥çœ‹  <code>pod</code>  ä¸­ç¬¬äºŒä¸ª <code>InitC</code>  çš„æ—¥å¿—ç›´åˆ°å‡ºç°</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Server:\t\t10.96.0.10</span><br><span class=\"line\">Address:\t10.96.0.10:53</span><br><span class=\"line\"></span><br><span class=\"line\">Name:\tmy-service-2.default.svc.cluster.local</span><br><span class=\"line\">Address: 10.107.13.223</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæŸ¥çœ‹  <code>pod</code>  çš„çŠ¶æ€ã€‚ä¼šå‡ºç°ä¸€æ¡ï¼š</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">init-demo   0/1     PodInitializing   0          6m52s   10.244.154.204   k8s-node-01   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n<p>ç„¶åå°±ä¼šå¯åŠ¨  <code>pod</code>  . æœ€ç»ˆå‡ºç°</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">init-demo   1/1     Running           0          6m53s   10.244.154.204   k8s-node-01   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæŸ¥çœ‹  <code>pod</code>  çš„æ—¥å¿—ï¼Œä¼šè¾“å‡º  <code>the app is running.</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8s-master-01 k8s-yamls]# kubectl logs -f init-demo</span><br><span class=\"line\">Defaulted container &quot;my-init-demo&quot; out of: my-init-demo, init-myservice-1 (init), init-myservice-2 (init)</span><br><span class=\"line\">the app is running!</span><br></pre></td></tr></table></figure>\n<h4 id=\"å…³äºinitå®¹å™¨çš„ç‰¹æ®Šè¯´æ˜\"><a class=\"markdownIt-Anchor\" href=\"#å…³äºinitå®¹å™¨çš„ç‰¹æ®Šè¯´æ˜\">#</a> å…³äº init å®¹å™¨çš„ç‰¹æ®Šè¯´æ˜</h4>\n<ul>\n<li>åœ¨  <code>Pod</code>  å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œ  <code>Init</code>  å®¹å™¨ä¼šæŒ‰é¡ºåºåœ¨ç½‘ç»œå’Œæ•°æ®å·åˆå§‹åŒ–ä¹‹åå¯åŠ¨ã€‚æ¯ä¸ªå®¹å™¨å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸé€€å‡º</li>\n<li>å¦‚æœç”±äºè¿è¡Œæ—¶æˆ–å¤±è´¥é€€å‡ºï¼Œå°†å¯¼è‡´å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå®ƒä¼šæ ¹æ®  <code>Pod</code>  çš„  <code>restartPolicy</code>  æŒ‡å®šçš„ç­–ç•¥ è¿›è¡Œé‡è¯•ã€‚ç„¶è€Œï¼Œå¦‚æœ  <code>Pod</code>  çš„  <code>restartPolicy</code>  è®¾ç½®ä¸º  <code>Always</code> ï¼Œ <code>Init</code>  å®¹å™¨å¤±è´¥æ—¶ä¼šä½¿ç”¨  <code>RestartPolicy</code>  ç­–ç•¥</li>\n<li>åœ¨æ‰€æœ‰çš„  <code>Init</code>  å®¹å™¨æ²¡æœ‰æˆåŠŸä¹‹å‰ï¼Œ <code>Pod</code>  å°†ä¸ä¼šå˜æˆ  <code>Ready</code>  çŠ¶æ€ã€‚ <code>Init</code>  å®¹å™¨çš„ç«¯å£å°†ä¸ä¼šåœ¨  <code>Service</code>  ä¸­è¿›è¡Œèšé›†ã€‚ æ­£åœ¨åˆå§‹åŒ–ä¸­çš„  <code>Pod</code>  å¤„äº  <code>Pending</code>  çŠ¶æ€ï¼Œä½†åº”è¯¥ä¼šå°†  <code>Initializing</code>  çŠ¶æ€è®¾ç½®ä¸º  <code>true</code></li>\n<li>å¦‚æœ  <code>Pod</code>  é‡å¯ï¼Œæ‰€æœ‰  <code>Init</code>  å®¹å™¨å¿…é¡»é‡æ–°æ‰§è¡Œ</li>\n<li>å¯¹  <code>Init</code>  å®¹å™¨  <code>spec</code>  çš„ä¿®æ”¹è¢«é™åˆ¶åœ¨å®¹å™¨  <code>image</code>  å­—æ®µï¼Œä¿®æ”¹å…¶ä»–å­—æ®µéƒ½ä¸ä¼šç”Ÿæ•ˆã€‚æ›´æ”¹  <code>Init</code>  å®¹å™¨çš„  <code>image</code>  å­—æ®µï¼Œç­‰ä»·äºé‡å¯è¯¥  <code>Pod</code></li>\n<li><code>Init</code>  å®¹å™¨å…·æœ‰åº”ç”¨å®¹å™¨çš„æ‰€æœ‰å­—æ®µã€‚é™¤äº†  <code>readinessProbe</code>  ï¼Œå› ä¸º  <code>Init</code>  å®¹å™¨æ— æ³•å®šä¹‰ä¸åŒäºå®Œæˆ ( <code>completion</code> ) çš„å°±ç»ªï¼ˆ <code>readiness</code> ï¼‰ä¹‹å¤–çš„å…¶ä»–çŠ¶æ€ã€‚è¿™ä¼šåœ¨éªŒè¯è¿‡ç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œ</li>\n<li>åœ¨  <code>Pod</code>  ä¸­çš„æ¯ä¸ª  <code>app</code>  å’Œ  <code>Init</code>  å®¹å™¨çš„åç§°å¿…é¡»å”¯ä¸€ï¼›ä¸ä»»ä½•å…¶å®ƒå®¹å™¨å…±äº«åŒä¸€ä¸ªåç§°ï¼Œä¼šåœ¨éªŒè¯æ—¶æŠ›å‡ºé”™è¯¯.</li>\n</ul>\n<h2 id=\"æ¢é’ˆæ£€æµ‹\"><a class=\"markdownIt-Anchor\" href=\"#æ¢é’ˆæ£€æµ‹\">#</a> æ¢é’ˆæ£€æµ‹</h2>\n<p>æ¢é’ˆæ˜¯ç”±  <code>kubelet</code>  å¯¹å®¹å™¨æ‰§è¡Œçš„å®šæœŸè¯Šæ–­ã€‚è¦æ‰§è¡Œè¯Šæ–­ï¼Œ <code>kubelet</code>  è°ƒç”¨ç”±å®¹å™¨å®ç°çš„  <code>Handler</code> ã€‚æœ‰ä¸‰ç§ç±»å‹çš„å¤„ç†ç¨‹åºï¼š</p>\n<ul>\n<li><code>ExecAction</code> ï¼šåœ¨å®¹å™¨å†…æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ã€‚å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º  <code>0</code>  åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚</li>\n<li><code>TCPSocketAction</code> ï¼šå¯¹æŒ‡å®šç«¯å£ä¸Šçš„å®¹å™¨çš„  <code>IP</code>  åœ°å€è¿›è¡Œ  <code>TCP</code>  æ£€æŸ¥ã€‚å¦‚æœç«¯å£æ‰“å¼€ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚</li>\n<li><code>HTTPGetAction</code> ï¼šå¯¹æŒ‡å®šçš„ç«¯å£å’Œè·¯å¾„ä¸Šçš„å®¹å™¨çš„  <code>IP</code>  åœ°å€æ‰§è¡Œ  <code>HTTP Get</code>  è¯·æ±‚ã€‚å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº  <code>200</code>  ä¸”å°äº  <code>400</code> ï¼Œåˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„</li>\n</ul>\n<p>æ¯æ¬¡æ¢æµ‹éƒ½å°†è·å¾—ä»¥ä¸‹ä¸‰ç§ç»“æœä¹‹ä¸€ï¼š</p>\n<ul>\n<li>æˆåŠŸï¼šå®¹å™¨é€šè¿‡äº†è¯Šæ–­ã€‚</li>\n<li>å¤±è´¥ï¼šå®¹å™¨æœªé€šè¿‡è¯Šæ–­ã€‚</li>\n<li>æœªçŸ¥ï¼šè¯Šæ–­å¤±è´¥ï¼Œå› æ­¤ä¸ä¼šé‡‡å–ä»»ä½•è¡ŒåŠ¨</li>\n</ul>\n<h3 id=\"æ¢æµ‹çš„æ–¹å¼\"><a class=\"markdownIt-Anchor\" href=\"#æ¢æµ‹çš„æ–¹å¼\">#</a> æ¢æµ‹çš„æ–¹å¼</h3>\n<ul>\n<li><code>livenessProbe</code> ï¼šæŒ‡ç¤ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚å¦‚æœå­˜æ´»æ¢æµ‹å¤±è´¥ï¼Œåˆ™  <code>kubelet</code>  ä¼šæ€æ­»å®¹å™¨ï¼Œå¹¶ä¸”å®¹å™¨å°†å—åˆ°å…¶ é‡å¯ç­–ç•¥ çš„å½±å“ã€‚å¦‚æœå®¹å™¨ä¸æä¾›å­˜æ´»æ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º  <code>Success</code></li>\n<li><code>readinessProbe</code> ï¼šæŒ‡ç¤ºå®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æœåŠ¡è¯·æ±‚ã€‚å¦‚æœå°±ç»ªæ¢æµ‹å¤±è´¥ï¼Œç«¯ç‚¹æ§åˆ¶å™¨å°†ä»ä¸  <code>Pod</code>  åŒ¹é…çš„æ‰€æœ‰  <code>Service</code>  çš„ç«¯ç‚¹ä¸­åˆ é™¤è¯¥  <code>Pod</code>  çš„  <code>IP</code>  åœ°å€ã€‚åˆå§‹å»¶è¿Ÿä¹‹å‰çš„å°±ç»ªçŠ¶æ€é»˜è®¤ä¸º  <code>Failure</code> ã€‚å¦‚æœå®¹å™¨ä¸æä¾›å°±ç»ªæ¢é’ˆï¼Œåˆ™é»˜è®¤çŠ¶æ€ä¸º  <code>Success</code></li>\n</ul>\n<h4 id=\"pod-hook\"><a class=\"markdownIt-Anchor\" href=\"#pod-hook\">#</a> Pod Hook</h4>\n<p><code>Pod hook</code> ï¼ˆé’©å­ï¼‰æ˜¯ç”±  <code>Kubernetes</code>  ç®¡ç†çš„  <code>kubelet</code>  å‘èµ·çš„ï¼Œå½“å®¹å™¨ä¸­çš„è¿›ç¨‹å¯åŠ¨å‰æˆ–è€…å®¹å™¨ä¸­çš„è¿›ç¨‹ç»ˆæ­¢ä¹‹å‰è¿è¡Œï¼Œè¿™æ˜¯åŒ…å«åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¹‹ä¸­ã€‚å¯ä»¥åŒæ—¶ä¸º  <code>Pod</code>  ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½é…ç½®  <code>hook</code></p>\n<p><code>Hook</code>  çš„ç±»å‹åŒ…æ‹¬ä¸¤ç§ï¼š</p>\n<ul>\n<li><code>exec</code> ï¼šæ‰§è¡Œä¸€æ®µå‘½ä»¤</li>\n<li><code>HTTP</code> ï¼šå‘é€ <code>HTTP</code>  è¯·æ±‚</li>\n</ul>\n<p><code>PodSpec</code>  ä¸­æœ‰ä¸€ä¸ª  <code>restartPolicy</code>  å­—æ®µï¼Œå¯èƒ½çš„å€¼ä¸º  <code>Always</code> ã€ <code>OnFailure</code>  å’Œ  <code>Never</code> ã€‚é»˜è®¤ä¸º <code>Always</code> ã€‚  <code>restartPolicy</code>  é€‚ç”¨äº  <code>Pod</code>  ä¸­çš„æ‰€æœ‰å®¹å™¨ã€‚ <code>restartPolicy</code>  ä»…æŒ‡é€šè¿‡åŒä¸€èŠ‚ç‚¹ä¸Šçš„  <code>kubelet</code>  é‡æ–°å¯åŠ¨å®¹å™¨ã€‚å¤±è´¥çš„å®¹å™¨ç”±  <code>kubelet</code>  ä»¥äº”åˆ†é’Ÿä¸ºä¸Šé™çš„æŒ‡æ•°é€€é¿å»¶è¿Ÿï¼ˆ <code>10ç§’</code> ï¼Œ <code>20ç§’</code> ï¼Œ <code>40ç§’</code> â€¦ï¼‰é‡æ–°å¯åŠ¨ï¼Œå¹¶åœ¨æˆåŠŸæ‰§è¡Œååˆ†é’Ÿåé‡ç½®ã€‚å¦‚  <code>Pod</code>  æ–‡æ¡£ ä¸­æ‰€è¿°ï¼Œä¸€æ—¦ç»‘å®šåˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ <code>Pod</code>  å°†æ°¸è¿œä¸ä¼šé‡æ–°ç»‘å®šåˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>\n<h4 id=\"pod-phase\"><a class=\"markdownIt-Anchor\" href=\"#pod-phase\">#</a> Pod phase</h4>\n<p><code>Pod</code>  çš„  <code>status</code>  å­—æ®µæ˜¯ä¸€ä¸ª  <code>PodStatus</code>  å¯¹è±¡ï¼Œ <code>PodStatus</code>  ä¸­æœ‰ä¸€ä¸ª  <code>phase</code>  å­—æ®µã€‚<br>\n <code>PodStatus</code>  çš„ç›¸ä½ï¼ˆ <code>phase</code> ï¼‰æ˜¯  <code>Pod</code>  åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­çš„ç®€å•å®è§‚æ¦‚è¿°ã€‚è¯¥é˜¶æ®µå¹¶ä¸æ˜¯å¯¹å®¹å™¨æˆ–  <code>Pod</code>  çš„ç»¼åˆæ±‡æ€»ï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†åšä¸ºç»¼åˆçŠ¶æ€æœº <code>Pod</code>  ç›¸ä½çš„æ•°é‡å’Œå«ä¹‰æ˜¯ä¸¥æ ¼æŒ‡å®šçš„ã€‚é™¤äº†æœ¬æ–‡æ¡£ä¸­åˆ—ä¸¾çš„çŠ¶æ€å¤–ï¼Œä¸åº”è¯¥å†å‡å®š  <code>Pod</code>  æœ‰å…¶ä»–çš„  <code>phase</code>  å€¼</p>\n<h5 id=\"phaseçš„å€¼\"><a class=\"markdownIt-Anchor\" href=\"#phaseçš„å€¼\">#</a> phase çš„å€¼</h5>\n<ul>\n<li>æŒ‚èµ·ï¼ˆ <code>Pending</code> ï¼‰ï¼š <code>Pod</code>  å·²è¢«  <code>Kubernetes</code>  ç³»ç»Ÿæ¥å—ï¼Œä½†æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨é•œåƒå°šæœªåˆ›å»ºã€‚ç­‰å¾…æ—¶é—´åŒ…æ‹¬è°ƒåº¦  <code>Pod</code>  çš„æ—¶é—´å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒçš„æ—¶é—´ï¼Œè¿™å¯èƒ½éœ€è¦èŠ±ç‚¹æ—¶é—´</li>\n<li>è¿è¡Œä¸­ï¼ˆ <code>Running</code> ï¼‰ï¼šè¯¥  <code>Pod</code>  å·²ç»ç»‘å®šåˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œ <code>Pod</code>  ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å·²è¢«åˆ›å»ºã€‚è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œï¼Œæˆ–è€…æ­£å¤„äºå¯åŠ¨æˆ–é‡å¯çŠ¶æ€</li>\n<li>æˆåŠŸï¼ˆ <code>Succeeded</code> ï¼‰ï¼š <code>Pod</code>  ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½è¢«æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†é‡å¯</li>\n<li>å¤±è´¥ï¼ˆ <code>Failed</code> ï¼‰ï¼š <code>Pod</code>  ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢äº†ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯å› ä¸ºå¤±è´¥ç»ˆæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä»¥é  <code>0</code>  çŠ¶æ€é€€å‡ºæˆ–è€…è¢«ç³»ç»Ÿç»ˆæ­¢</li>\n<li>æœªçŸ¥ï¼ˆ <code>Unknown</code> ï¼‰ï¼šå› ä¸ºæŸäº›åŸå› æ— æ³•å–å¾—  <code>Pod</code>  çš„çŠ¶æ€ï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸  <code>Pod</code>  æ‰€åœ¨ä¸»æœºé€šä¿¡å¤±è´¥</li>\n</ul>\n<h3 id=\"ä¸¤ä¸ªå°å®éªŒ\"><a class=\"markdownIt-Anchor\" href=\"#ä¸¤ä¸ªå°å®éªŒ\">#</a> ä¸¤ä¸ªå°å®éªŒ</h3>\n<h4 id=\"readiness\"><a class=\"markdownIt-Anchor\" href=\"#readiness\">#</a> Readiness</h4>\n<ul>\n<li><code>03-readness-demo.yaml</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">readness-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">readness-demo-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">readinessProbe:</span></span><br><span class=\"line\">      <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/index.html</span></span><br><span class=\"line\">      <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/03-09.jpg\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°  <code>readness-demo</code>  æ­£å¸¸å¯åŠ¨æˆåŠŸï¼Œä¹Ÿå·²ç» <code>ready</code>  äº†ã€‚</p>\n<p>ä¸‹é¢åˆ æ‰  <code>readness-demo</code>  è¿™ä¸ª <code>pod</code>  , ç„¶åæŠŠ  <code>path:/index.html</code>  æ”¹æˆ  <code>path:/index1.html</code>  å¦‚ä¸‹:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">readness-demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">readness-demo-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">readinessProbe:</span></span><br><span class=\"line\">      <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span> <span class=\"number\">80</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/index1.html</span></span><br><span class=\"line\">      <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/03-10.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°  <code>ready: 0/1</code>  , æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹  <code>pod</code>  çš„è¯¦ç»†ä¿¡æ¯.</p>\n<p><img data-src=\"/images/k8s/03-11.png\" alt=\"\"></p>\n<p><code>Readiness Failed</code></p>\n<p>è¿™æ—¶ï¼Œæˆ‘ä»¬è¿›å…¥å®¹å™¨ä¸­ï¼Œæ–°å»ºä¸€ä¸ª  <code>index1.html</code>  é¡µé¢.</p>\n<p><img data-src=\"/images/k8s/03-12.png\" alt=\"\"></p>\n<p>ç„¶åæŸ¥çœ‹ä¸€ä¸‹  <code>pod</code>  çš„çŠ¶æ€ã€‚</p>\n<p><img data-src=\"/images/k8s/03-13.png\" alt=\"\"></p>\n<h4 id=\"liveness\"><a class=\"markdownIt-Anchor\" href=\"#liveness\">#</a> Liveness</h4>\n<h5 id=\"liveness-exec-demo\"><a class=\"markdownIt-Anchor\" href=\"#liveness-exec-demo\">#</a> liveness-exec demo</h5>\n<ul>\n<li><code>04-liveness-demo-exec.yaml</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">liveness-demo</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">liveness-demo-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> [<span class=\"string\">&#x27;/bin/sh&#x27;</span>, <span class=\"string\">&#x27;-c&#x27;</span>, <span class=\"string\">&#x27;touch /tmp/live; sleep 20; rm -rf /tmp/live; sleep 3600;&#x27;</span>]</span><br><span class=\"line\">    <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">      <span class=\"attr\">exec:</span></span><br><span class=\"line\">        <span class=\"attr\">command:</span> [<span class=\"string\">&#x27;test&#x27;</span>, <span class=\"string\">&#x27;-e&#x27;</span>, <span class=\"string\">&#x27;/tmp/live&#x27;</span>]</span><br><span class=\"line\">      <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>ç„¶åæŸ¥çœ‹ <code>pod</code>  çš„çŠ¶æ€</p>\n<p><img data-src=\"/images/k8s/03-14.png\" alt=\"\"></p>\n<h5 id=\"liveness-http-get-demo\"><a class=\"markdownIt-Anchor\" href=\"#liveness-http-get-demo\">#</a> liveness-http-get demo</h5>\n<ul>\n<li><code>04-liveness-httpGet-demo.yaml</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">liveness-http-get-demo</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">liveness-http-get-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">    <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">http-port</span></span><br><span class=\"line\">      <span class=\"attr\">containerPort:</span> <span class=\"number\">80</span></span><br><span class=\"line\">    <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">      <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span> <span class=\"string\">http-port</span></span><br><span class=\"line\">        <span class=\"attr\">path:</span> <span class=\"string\">/index.html</span></span><br><span class=\"line\">      <span class=\"attr\">initialDelaySeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"attr\">periodSeconds:</span> <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"attr\">timeoutSeconds:</span> <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/k8s/03-15.png\" alt=\"\"></p>\n<p>ç„¶åï¼Œæˆ‘ä»¬åˆ é™¤ <code>index.html</code></p>\n<p><code>kubectl exec liveness-http-get-demo -it -- rm -rf /usr/share/nginx/html/index.html</code></p>\n<p>å¯ä»¥å‘ç° pod è¿›è¡Œäº†é‡å¯ã€‚å¦‚ä¸‹å›¾ (æˆ‘åˆ é™¤äº†ä¸¤æ¬¡)</p>\n<p><img data-src=\"/images/k8s/03-16.png\" alt=\"\"></p>\n<h3 id=\"å¯åŠ¨å’Œåœæ­¢\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨å’Œåœæ­¢\">#</a> å¯åŠ¨å’Œåœæ­¢</h3>\n<p><img data-src=\"/images/k8s/03-05.png\" alt=\"\"></p>\n<p>åœ¨ pod çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬è®²å®Œäº†  <code>pause</code> ,  <code>initC</code> ,  <code>liveness</code> ,  <code>readiness</code> . è¿˜å‰©ä¸‹  <code>Starter</code>  å’Œ  <code>Stop</code> .</p>\n<p>è¿™ä¸ªä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘é€šè¿‡ä¸‹é¢è¿™ä¸ªå®éªŒæ¥æ¼”ç¤ºä¸€ä¸‹ pod çš„å¯åŠ¨å’Œåœæ­¢ã€‚</p>\n<ul>\n<li><code>05-start-and-stop-demo.yaml</code></li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Pod</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">starter-stop-demo</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">containers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">stop-stop-demo-container</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">fangjiaxiaobai/my-app:v1</span></span><br><span class=\"line\">    <span class=\"attr\">lifecycle:</span></span><br><span class=\"line\">      <span class=\"attr\">postStart:</span></span><br><span class=\"line\">        <span class=\"attr\">exec:</span></span><br><span class=\"line\">          <span class=\"attr\">command:</span> [<span class=\"string\">&#x27;/bin/sh&#x27;</span>, <span class=\"string\">&#x27;-c&#x27;</span>, <span class=\"string\">&#x27;echo Hello from podStart handler &gt; /usr/share/message&#x27;</span>]</span><br><span class=\"line\">      <span class=\"attr\">preStop:</span></span><br><span class=\"line\">        <span class=\"attr\">exec:</span></span><br><span class=\"line\">          <span class=\"attr\">command:</span> [<span class=\"string\">&#x27;/bin/sh&#x27;</span>, <span class=\"string\">&#x27;-c&#x27;</span>, <span class=\"string\">&#x27;echo Bye from podStop handler&#x27;</span>]</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæŸ¥çœ‹ä¸€ä¸‹  <code>/usr/share/message</code>  æ–‡ä»¶å†…å®¹</p>\n<p><img data-src=\"/images/k8s/03-17.png\" alt=\"\"></p>\n<p>å½“ç„¶ï¼Œåˆ é™¤ä¹‹åï¼Œè¿™ä¸ªå®¹å™¨æˆ‘ä»¬å°±è¿›ä¸å»äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“äº†é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥åœ¨  <code>pod</code>  çš„ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µä¸­åšäº›æ“ä½œã€‚</p>\n",
            "tags": [
                "k8s",
                "kubernetes"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/07/22/k8s/pit01.incompatible-CNI-versions/",
            "url": "https://fangjiaxiaobai.github.io/2022/07/22/k8s/pit01.incompatible-CNI-versions/",
            "title": "k8s-incompatible CNI versions",
            "date_published": "2022-07-22T10:18:00.000Z",
            "content_html": "<h3 id=\"æŠ¥é”™å†…å®¹\"><a class=\"markdownIt-Anchor\" href=\"#æŠ¥é”™å†…å®¹\">#</a> æŠ¥é”™å†…å®¹</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning  FailedCreatePodSandBox  5m17s kubelet Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network <span class=\"keyword\">for</span> sandbox <span class=\"string\">&quot;1ded5da71b38996763e74f28f609d8d8f26a4cc1e4fdd3272312bf3e168e4111&quot;</span>: plugin <span class=\"built_in\">type</span>=<span class=\"string\">&quot;bridge&quot;</span> failed (add): incompatible CNI versions; config is <span class=\"string\">&quot;1.0.0&quot;</span>, plugin supports [<span class=\"string\">&quot;0.1.0&quot;</span> <span class=\"string\">&quot;0.2.0&quot;</span> <span class=\"string\">&quot;0.3.0&quot;</span> <span class=\"string\">&quot;0.3.1&quot;</span> <span class=\"string\">&quot;0.4.0&quot;</span>]</span><br></pre></td></tr></table></figure>\n<h3 id=\"éƒ¨ç½²çš„ç¯å¢ƒ\"><a class=\"markdownIt-Anchor\" href=\"#éƒ¨ç½²çš„ç¯å¢ƒ\">#</a> éƒ¨ç½²çš„ç¯å¢ƒ</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">centos 8</span><br><span class=\"line\">kubernetes 1.24.3</span><br></pre></td></tr></table></figure>\n<h3 id=\"è§£å†³é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³é—®é¢˜\">#</a> è§£å†³é—®é¢˜</h3>\n<p>è¿™ä¸ªé—®é¢˜çš„ä¸»è¦å†…å®¹æ˜¯:  <code>incompatible CNI versions</code> . å½“ä½ å»ç½‘ä¸Šå»æœç´¢è§£å†³æ–¹æ¡ˆå¤§éƒ½æ˜¯ è¯´ ä½¿ç”¨  <code>containerd</code>  çš„ç‰ˆæœ¬ä¸å¯¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¡®å®æ˜¯  <code>CNI</code>  çš„ç‰ˆæœ¬æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>\n<p>å…·ä½“çš„è§£å†³æ–¹æ¡ˆåœ¨å®˜æ–¹ç½‘ç«™ä¸­æ˜¯è¿™æ ·è¯´çš„ï¼š</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/k8s/01-01.png\" alt=\"\"></p>\n<p>å…·ä½“å†…å®¹å¯ä»¥çœ‹è¿™é‡Œ:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL3poLWNuL2RvY3MvdGFza3MvYWRtaW5pc3Rlci1jbHVzdGVyL21pZ3JhdGluZy1mcm9tLWRvY2tlcnNoaW0vdHJvdWJsZXNob290aW5nLWNuaS1wbHVnaW4tcmVsYXRlZC1lcnJvcnMvI3VwZGF0aW5nLXlvdXItY25pLXBsdWdpbnMtYW5kLWNuaS1jb25maWctZmlsZXM=\">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/migrating-from-dockershim/troubleshooting-cni-plugin-related-errors/#updating-your-cni-plugins-and-cni-config-files</span></p>\n<p>é¦–å…ˆå¯ä»¥æŸ¥çœ‹ å½“å‰çš„  <code>containerd</code>  çš„ç‰ˆæœ¬.</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8s-master-01 ~]<span class=\"comment\"># containerd -v</span></span><br><span class=\"line\">containerd github.com/containerd/containerd v1.6.4 212e8b6fa2f44b9c21b2798135fc6fb7c53efc16</span><br></pre></td></tr></table></figure>\n<p>ä¸åœ¨  <code>v1.6.0-v1.6.3</code>  ä¸­ã€‚ æ–‡æ¡£ä¸­è¯´ åœ¨  <code>v1.6.4</code>  ç‰ˆæœ¬ä¸­å·²ç»ä¿®å¤äº†è¿™ä¸ªé—®é¢˜.</p>\n<p>æŸ¥çœ‹  <code>/etc/cni/net.d/10-containerd-net.conflist</code>  è¿™ä¸ªæ–‡ä»¶ï¼Œ cni ç‰ˆæœ¬  <code> &quot;cniVersion&quot;: &quot;1.0.0&quot;,</code> , ä¹Ÿç¡®å®æ˜¯ <code>1.0.0</code></p>\n<p>ç»§ç»­æœç´¢</p>\n<p>åœ¨ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvbnRhaW5lcmQvY29udGFpbmVyZC9pc3N1ZXMvNjg3Ng==\">https://github.com/containerd/containerd/issues/6876</span> ä¸­ï¼Œæœ‰ä¸€ä¸ªäººé‡åˆ°äº†  <code>v1.6.4</code>  ç‰ˆæœ¬ä¸­å‡ºç°äº†  <code>incompatible CNI versions</code>  è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/k8s/01-02.jpg\" alt=\"\"></p>\n<p>ä»”ç»†çœ‹ä»–çš„è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯æˆ‘é‡åˆ°çš„è¿™ä¸ªé—®é¢˜æ˜¯ä¸€æ ·çš„  <code>plugins type='bridge'</code> . è€Œè¿™ä¸ª  <code>issure</code>  ä¸­æåˆ°çš„é—®é¢˜ï¼Œæ˜¯å½“  <code>plugins type = 'loooback'</code> . è¿™ä¹Ÿæ˜¯ä¸Šå›¾ä¸­  <code>hakman</code>  æåˆ°çš„ã€‚</p>\n<p>ä»”ç»†çœ‹  <code>mikebrow</code>  æ‰€è¯´çš„ï¼Œéœ€è¦å®‰è£…ä¸€ä¸ª  <code>1.0.0</code>  ç‰ˆæœ¬çš„  <code>bridge</code> .</p>\n<p>é‚£å°±åœ¨ç½‘ç»œä¸­æœç´¢ :  <code>k8s æ˜¯å®‰è£… bridge</code> ï¼Œ åœ¨  <code>https://blog.csdn.net/m0_48594855/article/details/107870839</code>  çœ‹åˆ° å®‰è£… bridge çš„æ–¹æ³•ï¼Œä»–è¿™é‡Œæ˜¯ä½¿ç”¨ git ä»“åº“ æºç ç¼–è¯‘ã€‚å…¶å®ç›´æ¥æ‰“å¼€ git ä»“åº“  <code>https://github.com/containernetworking/plugins/releases/tag/v1.1.1</code>  ä¸‹è½½å¯¹åº”ç‰ˆæœ¬å³å¯ï¼Œ ä»Šå¤©æ˜¯  <code>2022</code>  å¹´ <code>7</code>  æœˆ <code>22</code>  æ—¥ï¼Œæˆ‘å°±ä¸‹è½½äº†æœ€æ–°çš„ä¸€ç‰ˆæœ¬ã€‚</p>\n<p>ç®€å•ç²—æš´çš„  <code>/opt/cni/bin/</code>  ä¸‹çš„å†…å®¹ï¼Œå…¨éƒ¨æ›¿æ¢æ‰ï¼Œç„¶åé‡å¯  <code>kubelet</code>  æœåŠ¡å°±å¯ä»¥äº†ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸‹è½½åŒ…</span></span><br><span class=\"line\">wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤‡ä»½ä¸€ä¸‹é©±åŠ¨</span></span><br><span class=\"line\">mv /opt/cni/bin /opt/cni/bin.bak</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è§£å‹åˆ°æŒ‡å®šç›®å½•</span></span><br><span class=\"line\">tar -zxvf cni-plugins-linux-amd64-v1.1.1.tgz -C /opt/cni/bin </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é‡å¯ kubelet</span></span><br><span class=\"line\">systemctl restart kubelet</span><br></pre></td></tr></table></figure>\n<p>ç„¶åå†æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šéƒ½æ‰§è¡Œä¸€éä¸Šé¢çš„å†…å®¹ï¼Œç„¶åå°±å¯ä»¥äº†ã€‚</p>\n<p>å¯ä»¥é€šè¿‡   <code>kubectl describe pod</code>  æŸ¥çœ‹ä¸‹æ˜¯å¦å¼€å§‹ä¸‹è½½é•œåƒäº†ã€‚</p>\n<h3 id=\"é—®é¢˜è§£å†³æ€è·¯\"><a class=\"markdownIt-Anchor\" href=\"#é—®é¢˜è§£å†³æ€è·¯\">#</a> é—®é¢˜è§£å†³æ€è·¯</h3>\n<ul>\n<li>å…ˆçœ‹ä¸‹  <code>contrainerd</code>  ç‰ˆæœ¬æ˜¯å¦  <code>&gt;=1.6.4</code></li>\n<li>å¦‚æœ  <code>&lt;=1.6.3</code>  é‚£ä¹ˆå°±éœ€è¦å‡çº§  <code>contrainerd</code>  è¿è¡Œç¯å¢ƒ.</li>\n<li>å¦‚æœè¿˜æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯è¦çœ‹ä¸‹å¯¹åº”çš„æ’ä»¶ç±»å‹æ˜¯å¦æ»¡è¶³ç‰ˆæœ¬è¦æ±‚äº†ã€‚</li>\n<li>å¦‚æœä¸æ»¡è¶³ï¼Œé‚£å°±é‡æ–°å®‰è£…ä¸‹å¯¹åº”çš„æ’ä»¶å°±è¡Œäº†ï¼Œæ¯”å¦‚æˆ‘çš„é—®é¢˜ä¸­çš„  <code>bridge</code>  æ’ä»¶ã€‚</li>\n</ul>\n<h3 id=\"ä¸¾ä¸€åä¸‰\"><a class=\"markdownIt-Anchor\" href=\"#ä¸¾ä¸€åä¸‰\">#</a> ä¸¾ä¸€åä¸‰</h3>\n<p>å‡è®¾æœ‰ä¸€æ£µæ ‘ï¼Œé‚£ä¸ªé—®é¢˜åªæ˜¯è¿™æ£µæ ‘çš„ä¸€ç‰‡å¶å­ï¼Œ è¿™é‡Œé¢è¿˜æ¶‰åŠåˆ°å¾ˆå¤š  <code>k8s</code>  çš„æ¦‚å¿µæ€§çš„ä¸œè¥¿ã€‚æ¯”å¦‚  <code>CNI</code>  ç½‘ç»œæ’ä»¶éƒ½æœ‰ä»€ä¹ˆï¼Œæ¯ç§æ’ä»¶çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¯¹åº”çš„ç½‘ç»œé©±åŠ¨æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚  <code>Calico</code>  ,  <code>fannel</code>  ,  <code>bridge</code>  ã€‚  <code>CNI</code>  å’Œ  <code>containerd</code> ,  <code>cri-o</code>  éƒ½æ˜¯ä»€ä¹ˆå…³ç³»ã€‚æ‰€ä»¥ï¼Œè¦ä»æ ¹å„¿ä¸Šå»ç†è§£è¿™äº›æ¦‚å¿µã€‚ åºŸè¯ä¸å¤šè¯´ï¼Œä¸‹ç¯‡æ–‡ç« è§ã€‚</p>\n<h3 id=\"å‚è€ƒæ–‡æ¡£\"><a class=\"markdownIt-Anchor\" href=\"#å‚è€ƒæ–‡æ¡£\">#</a> å‚è€ƒæ–‡æ¡£</h3>\n<p>1ã€<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvbnRhaW5lcmQvY29udGFpbmVyZC9pc3N1ZXMvNjg3Ng==\">https://github.com/containerd/containerd/issues/6876</span><br>\n2ã€<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ4NTk0ODU1L2FydGljbGUvZGV0YWlscy8xMDc4NzA4Mzk=\">https://blog.csdn.net/m0_48594855/article/details/107870839</span><br>\n3ã€<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvbnRhaW5lcm5ldHdvcmtpbmcvcGx1Z2lucy9yZWxlYXNlcy90YWcvdjEuMS4x\">https://github.com/containernetworking/plugins/releases/tag/v1.1.1</span><br>\n4ã€<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL3poLWNuL2RvY3MvdGFza3MvYWRtaW5pc3Rlci1jbHVzdGVyL21pZ3JhdGluZy1mcm9tLWRvY2tlcnNoaW0vdHJvdWJsZXNob290aW5nLWNuaS1wbHVnaW4tcmVsYXRlZC1lcnJvcnMvI3VwZGF0aW5nLXlvdXItY25pLXBsdWdpbnMtYW5kLWNuaS1jb25maWctZmlsZXM=\">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/migrating-from-dockershim/troubleshooting-cni-plugin-related-errors/#updating-your-cni-plugins-and-cni-config-files</span></p>\n",
            "tags": [
                "k8s",
                "kubernetes"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/07/17/k8s/seris02-how-to-build/",
            "url": "https://fangjiaxiaobai.github.io/2022/07/17/k8s/seris02-how-to-build/",
            "title": "k8s-æ­å»ºK8sé›†ç¾¤",
            "date_published": "2022-07-17T10:18:00.000Z",
            "content_html": "<p>ä½¿ç”¨  <code>kubeadm 1.24.3</code>  æ­å»º  <code>k8s</code>  é›†ç¾¤</p>\n<h2 id=\"ç¯å¢ƒå‡†å¤‡\"><a class=\"markdownIt-Anchor\" href=\"#ç¯å¢ƒå‡†å¤‡\">#</a> ç¯å¢ƒå‡†å¤‡</h2>\n<p><code>Centos8</code>  ä¸‰å°.</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">k8s-master-01 192.168.0.10</span><br><span class=\"line\">k8s-node-01   192.168.0.20</span><br><span class=\"line\">k8s-node-02   192.168.0.21</span><br></pre></td></tr></table></figure>\n<p>æ³¨æ„ï¼Œè¿™ä¸‰å°æœºå™¨ä¸è¦åšä»»ä½•é…ç½®ï¼Œå°¤å…¶ä¸è¦å®‰è£…  <code>docker</code> , å› ä¸ºä» <code>k8s</code>   <code>1.20.x</code>  å¼€å§‹ï¼Œ  <code>kubernetes</code>  å¼ƒç”¨äº†  <code>dockershim</code> , åœ¨  <code>1.20.4</code>  æ­£å¼ç§»é™¤äº†  <code>dockershim</code> .</p>\n<blockquote>\n<p>Docker support in the kubelet is now deprecated and will be removed in a future release. The kubelet uses a module called â€œdockershimâ€ which implements CRI support for Docker and it has seen maintenance issues in the Kubernetes community.</p>\n</blockquote>\n<p>åŸæ–‡åœ°å€: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2t1YmVybmV0ZXMva3ViZXJuZXRlcy9ibG9iL21hc3Rlci9DSEFOR0VMT0cvQ0hBTkdFTE9HLTEuMjAubWQjZGVwcmVjYXRpb24=\">kubernetes 1.20 å˜æ›´æ—¥å¿—</span></p>\n<p>ä½†æ˜¯  <code>kubernetes</code>  æ˜¯æ”¯æŒç¬¦åˆä¸º  <code>Kubernetes</code>  åˆ›å»ºçš„å®¹å™¨è¿è¡Œæ¥å£  <code>Container Runtime Interface (CRI)</code>  çš„è¿è¡Œæ—¶ã€‚  <code>Docker</code>  æ„å»ºçš„é•œåƒï¼Œå°†åœ¨ä½ çš„é›†ç¾¤çš„æ‰€æœ‰è¿è¡Œæ—¶ä¸­ç»§ç»­å·¥ä½œï¼Œä¸€å¦‚æ—¢å¾€ã€‚</p>\n<h3 id=\"è®¾ç½®ç³»ç»Ÿä¸»æœºåä»¥åŠhostæ–‡ä»¶çš„ç›¸äº’è§£æ\"><a class=\"markdownIt-Anchor\" href=\"#è®¾ç½®ç³»ç»Ÿä¸»æœºåä»¥åŠhostæ–‡ä»¶çš„ç›¸äº’è§£æ\">#</a> è®¾ç½®ç³»ç»Ÿä¸»æœºåä»¥åŠ host æ–‡ä»¶çš„ç›¸äº’è§£æ</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hostnamectl set-hostname k8s-master-01</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…ä¾èµ–åŒ…\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…ä¾èµ–åŒ…\">#</a> å®‰è£…ä¾èµ–åŒ…</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y conntrack ipvsadm ipset jq iptables curl sysstat libseccomp wget vim net-tools git</span><br><span class=\"line\"></span><br><span class=\"line\">yum install -y chrony <span class=\"comment\"># é…ç½®æ—¶é—´åŒæ­¥</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å…³é—­é˜²ç«å¢™\"><a class=\"markdownIt-Anchor\" href=\"#å…³é—­é˜²ç«å¢™\">#</a> å…³é—­é˜²ç«å¢™</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld &amp;&amp; systemctl <span class=\"built_in\">disable</span> firewalld</span><br></pre></td></tr></table></figure>\n<h3 id=\"å…³é—­selinux\"><a class=\"markdownIt-Anchor\" href=\"#å…³é—­selinux\">#</a> å…³é—­ <code>SELinux</code></h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swapoff -a &amp;&amp; sed -i <span class=\"string\">&#x27;/ swap / s/^\\(.*\\)$/#\\1/g&#x27;</span> /etc/fstab</span><br><span class=\"line\">setenforce 0 &amp;&amp; sed -i <span class=\"string\">&#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>\n<h3 id=\"è°ƒæ•´å†…æ ¸å‚æ•°\"><a class=\"markdownIt-Anchor\" href=\"#è°ƒæ•´å†…æ ¸å‚æ•°\">#</a> è°ƒæ•´å†…æ ¸å‚æ•°</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; kubernetes.conf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">net.bridge.bridge-nf-call-iptables=1</span></span><br><span class=\"line\"><span class=\"string\">net.bridge.bridge-nf-call-ip6tables=1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.ip_forward=1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.tcp_tw_recycle=0</span></span><br><span class=\"line\"><span class=\"string\">vm.swappiness=0 # ç¦æ­¢ä½¿ç”¨ swap ç©ºé—´ï¼Œåªæœ‰å½“ç³»ç»Ÿ OOM æ—¶æ‰å…è®¸ä½¿ç”¨å®ƒ</span></span><br><span class=\"line\"><span class=\"string\">vm.overcommit</span></span><br><span class=\"line\"><span class=\"string\">_</span></span><br><span class=\"line\"><span class=\"string\">memory=1 # ä¸æ£€æŸ¥ç‰©ç†å†…å­˜æ˜¯å¦å¤Ÿç”¨</span></span><br><span class=\"line\"><span class=\"string\">vm.panic_on_oom=0 # å¼€å¯ OOM</span></span><br><span class=\"line\"><span class=\"string\">fs.inotify.max_user_instances=8192</span></span><br><span class=\"line\"><span class=\"string\">fs.inotify.max_user_watches=1048576</span></span><br><span class=\"line\"><span class=\"string\">fs.file-max=52706963</span></span><br><span class=\"line\"><span class=\"string\">fs.nr</span></span><br><span class=\"line\"><span class=\"string\">_</span></span><br><span class=\"line\"><span class=\"string\">open=52706963</span></span><br><span class=\"line\"><span class=\"string\">net.ipv6.conf.all.disable_ipv6=1</span></span><br><span class=\"line\"><span class=\"string\">net.netfilter.nf</span></span><br><span class=\"line\"><span class=\"string\">_</span></span><br><span class=\"line\"><span class=\"string\">conntrack</span></span><br><span class=\"line\"><span class=\"string\">_</span></span><br><span class=\"line\"><span class=\"string\">max=2310720</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\">cp kubernetes.conf /etc/sysctl.d/kubernetes.conf</span><br><span class=\"line\">sysctl -p /etc/sysctl.d/kubernetes.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"è°ƒæ•´ç³»ç»Ÿæ—¶åŒº\"><a class=\"markdownIt-Anchor\" href=\"#è°ƒæ•´ç³»ç»Ÿæ—¶åŒº\">#</a> è°ƒæ•´ç³»ç»Ÿæ—¶åŒº</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸º ä¸­å›½/ä¸Šæµ·</span></span><br><span class=\"line\">timedatectl set-timezone Asia/Shanghai</span><br><span class=\"line\"><span class=\"comment\"># å°†å½“å‰çš„ UTC æ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿ</span></span><br><span class=\"line\">timedatectl set-local-rtc 0</span><br><span class=\"line\"><span class=\"comment\"># é‡å¯ä¾èµ–äºç³»ç»Ÿæ—¶é—´çš„æœåŠ¡</span></span><br><span class=\"line\">systemctl restart rsyslog</span><br><span class=\"line\">systemctl restart crond</span><br></pre></td></tr></table></figure>\n<h3 id=\"å…³é—­ç³»ç»Ÿä¸éœ€è¦æœåŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#å…³é—­ç³»ç»Ÿä¸éœ€è¦æœåŠ¡\">#</a> å…³é—­ç³»ç»Ÿä¸éœ€è¦æœåŠ¡</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop postfix &amp;&amp; systemctl <span class=\"built_in\">disable</span> postfix</span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¾ç½®-rsyslogd-å’Œ-systemd-journald\"><a class=\"markdownIt-Anchor\" href=\"#è®¾ç½®-rsyslogd-å’Œ-systemd-journald\">#</a> è®¾ç½® rsyslogd å’Œ systemd journald</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /var/<span class=\"built_in\">log</span>/journal <span class=\"comment\"># æŒä¹…åŒ–ä¿å­˜æ—¥å¿—çš„ç›®å½•</span></span><br><span class=\"line\">mkdir /etc/systemd/journald.conf.d</span><br><span class=\"line\">cat &gt; /etc/systemd/journald.conf.d/99-prophet.conf &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">[Journal]</span></span><br><span class=\"line\"><span class=\"string\"># æŒä¹…åŒ–ä¿å­˜åˆ°ç£ç›˜</span></span><br><span class=\"line\"><span class=\"string\">Storage=persistent</span></span><br><span class=\"line\"><span class=\"string\"># å‹ç¼©å†å²æ—¥å¿—</span></span><br><span class=\"line\"><span class=\"string\">Compress=yes</span></span><br><span class=\"line\"><span class=\"string\">SyncIntervalSec=5m</span></span><br><span class=\"line\"><span class=\"string\">RateLimitInterval=30s</span></span><br><span class=\"line\"><span class=\"string\">RateLimitBurst=1000</span></span><br><span class=\"line\"><span class=\"string\"># æœ€å¤§å ç”¨ç©ºé—´ 10G</span></span><br><span class=\"line\"><span class=\"string\">SystemMaxUse=10G</span></span><br><span class=\"line\"><span class=\"string\"># å•æ—¥å¿—æ–‡ä»¶æœ€å¤§ 200M</span></span><br><span class=\"line\"><span class=\"string\">SystemMaxFileSize=200M</span></span><br><span class=\"line\"><span class=\"string\"># æ—¥å¿—ä¿å­˜æ—¶é—´ 2 å‘¨</span></span><br><span class=\"line\"><span class=\"string\">MaxRetentionSec=2week</span></span><br><span class=\"line\"><span class=\"string\"># ä¸å°†æ—¥å¿—è½¬å‘åˆ° syslog</span></span><br><span class=\"line\"><span class=\"string\">ForwardToSyslog=no</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\">systemctl restart systemd-journald</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®‰è£…-containerd\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…-containerd\">#</a> å®‰è£…  <code>containerd</code></h3>\n<h4 id=\"åˆ›å»ºetcmodules-loaddcontainerdconfé…ç½®æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºetcmodules-loaddcontainerdconfé…ç½®æ–‡ä»¶\">#</a> åˆ›å»º <code>/etc/modules-load.d/containerd.conf</code>  é…ç½®æ–‡ä»¶:</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt; <span class=\"string\">EOF &gt; /etc/modules-load.d/containerd.conf</span></span><br><span class=\"line\"><span class=\"string\">overlay</span></span><br><span class=\"line\"><span class=\"string\">br_netfilter</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½¿å…¶ç”Ÿæ•ˆ</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">modprobe overlay</span><br><span class=\"line\">modprobe br_netfilter</span><br></pre></td></tr></table></figure>\n<p>åˆ›å»º <code>/etc/sysctl.d/99-kubernetes-cri.conf</code>  é…ç½®æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt; <span class=\"string\">EOF &gt; /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class=\"line\"><span class=\"string\">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class=\"line\"><span class=\"string\">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class=\"line\"><span class=\"string\">net.ipv4.ip_forward = 1</span></span><br><span class=\"line\"><span class=\"string\">user.max_user_namespaces=28633</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿é…ç½®ç”Ÿæ•ˆ:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf</span><br></pre></td></tr></table></figure>\n<h3 id=\"å…³é—­-swap\"><a class=\"markdownIt-Anchor\" href=\"#å…³é—­-swap\">#</a> å…³é—­  <code>swap</code></h3>\n<p>Kubernetes 1.8 å¼€å§‹è¦æ±‚å…³é—­ç³»ç»Ÿçš„ Swapï¼Œå¦‚æœä¸å…³é—­ï¼Œé»˜è®¤é…ç½®ä¸‹ kubelet å°†æ— æ³•å¯åŠ¨ã€‚ å…³é—­ç³»ç»Ÿçš„ Swap æ–¹æ³•å¦‚ä¸‹:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swapoff -a</span><br></pre></td></tr></table></figure>\n<p>ä¿®æ”¹  <code>/etc/fstab</code>  æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰  <code>SWAP</code>  çš„è‡ªåŠ¨æŒ‚è½½ï¼Œä½¿ç”¨ <code>free -m</code>  ç¡®è®¤ <code>swap</code>  å·²ç»å…³é—­ã€‚</p>\n<p><code>swappiness</code>  å‚æ•°è°ƒæ•´ï¼Œä¿®æ”¹ <code>/etc/sysctl.d/99-kubernetes-cri.conf</code>  æ·»åŠ ä¸‹é¢ä¸€è¡Œï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vm.swappiness=0</span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œ <code>sysctl -p /etc/sysctl.d/99-kubernetes-cri.conf</code>  ä½¿ä¿®æ”¹ç”Ÿæ•ˆã€‚</p>\n<h4 id=\"å®‰è£…-containerd-2\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…-containerd-2\">#</a> å®‰è£…  <code>containerd</code></h4>\n<p>åœ¨å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šå®‰è£…å®¹å™¨è¿è¡Œæ—¶  <code>Containerd</code>  ã€‚</p>\n<p>ä¸‹è½½  <code>Containerd</code>  çš„äºŒè¿›åˆ¶åŒ…:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/containerd/containerd/releases/download/v1.6.4/cri-containerd-cni-1.6.4-linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf cri-containerd-cni-1.6.4-linux-amd64.tar.gz -C /</span><br></pre></td></tr></table></figure>\n<p>ç”Ÿæˆ  <code>containerd</code>  çš„é…ç½®æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /etc/containerd</span><br><span class=\"line\">containerd config default &gt; /etc/containerd/config.toml</span><br></pre></td></tr></table></figure>\n<p>ä¿®æ”¹å‰é¢ç”Ÿæˆçš„é…ç½®æ–‡ä»¶  <code>/etc/containerd/config.toml</code></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[plugins.<span class=\"string\">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc]</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  [plugins.<span class=\"string\">&quot;io.containerd.grpc.v1.cri&quot;</span>.containerd.runtimes.runc.options]</span><br><span class=\"line\">    SystemdCgroup = <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<p>å†ä¿®æ”¹ /etc/containerd/config.toml ä¸­çš„</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[plugins.<span class=\"string\">&quot;io.containerd.grpc.v1.cri&quot;</span>]</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"comment\"># sandbox_image = &quot;k8s.gcr.io/pause:3.6&quot;</span></span><br><span class=\"line\">  sandbox_image = <span class=\"string\">&quot;registry.aliyuncs.com/google_containers/pause:3.7&quot;</span></span><br></pre></td></tr></table></figure>\n<p>é…ç½®  <code>containerd</code>  å¼€æœºå¯åŠ¨ï¼Œå¹¶å¯åŠ¨  <code>containerd</code></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl <span class=\"built_in\">enable</span> containerd --now</span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨ <code>crictl</code>  æµ‹è¯•ä¸€ä¸‹ï¼Œç¡®ä¿å¯ä»¥æ‰“å°å‡ºç‰ˆæœ¬ä¿¡æ¯å¹¶ä¸”æ²¡æœ‰é”™è¯¯ä¿¡æ¯è¾“å‡º:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crictl version</span><br></pre></td></tr></table></figure>\n<p>å¦‚ä¸‹è¾“å‡º:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Version:  0.1.0</span><br><span class=\"line\">RuntimeName:  containerd</span><br><span class=\"line\">RuntimeVersion:  v1.6.4</span><br><span class=\"line\">RuntimeApiVersion:  v1alpha2</span><br></pre></td></tr></table></figure>\n<h3 id=\"é…ç½®æœåŠ¡å™¨æ”¯æŒå¼€å¯ipvs\"><a class=\"markdownIt-Anchor\" href=\"#é…ç½®æœåŠ¡å™¨æ”¯æŒå¼€å¯ipvs\">#</a> é…ç½®æœåŠ¡å™¨æ”¯æŒå¼€å¯ ipvs</h3>\n<p>æ‰§è¡Œä¸‹é¢çš„è„šæœ¬</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"string\">modprobe -- ip_vs</span></span><br><span class=\"line\"><span class=\"string\">modprobe -- ip_vs_rr</span></span><br><span class=\"line\"><span class=\"string\">modprobe -- ip_vs_wrr</span></span><br><span class=\"line\"><span class=\"string\">modprobe -- ip_vs_sh</span></span><br><span class=\"line\"><span class=\"string\">modprobe -- nf_conntrack</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢è„šæœ¬åˆ›å»ºäº†çš„ <code>/etc/sysconfig/modules/ipvs.modules</code>  æ–‡ä»¶ï¼Œä¿è¯åœ¨èŠ‚ç‚¹é‡å¯åèƒ½è‡ªåŠ¨åŠ è½½æ‰€éœ€æ¨¡å—ã€‚ ä½¿ç”¨ <code>lsmod | grep -e ip_vs -e nf_conntrack</code>  å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å·²ç»æ­£ç¡®åŠ è½½æ‰€éœ€çš„å†…æ ¸æ¨¡å—ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨  <code>kubeadm</code>  éƒ¨ç½²  <code>k8s</code>  é›†ç¾¤äº†ã€‚</p>\n<h2 id=\"å®‰è£…k8sé›†ç¾¤\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…k8sé›†ç¾¤\">#</a> å®‰è£… k8s é›†ç¾¤</h2>\n<p>å®‰è£…  <code>k8s</code>  é›†ç¾¤æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨  <code>kubeadm</code>  å®‰è£…</p>\n<h3 id=\"å®‰è£…kubeadm\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…kubeadm\">#</a> å®‰è£… kubeadm</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt;<span class=\"string\">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class=\"line\"><span class=\"string\">[kubernetes]</span></span><br><span class=\"line\"><span class=\"string\">name=Kubernetes</span></span><br><span class=\"line\"><span class=\"string\">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span><br><span class=\"line\"><span class=\"string\">enabled=1</span></span><br><span class=\"line\"><span class=\"string\">gpgcheck=0</span></span><br><span class=\"line\"><span class=\"string\">repo_gpgcheck=0</span></span><br><span class=\"line\"><span class=\"string\">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">yum makecache</span><br><span class=\"line\"></span><br><span class=\"line\">sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> --now kubelet</span><br></pre></td></tr></table></figure>\n<h3 id=\"é…ç½®-kubeadm-é…ç½®æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#é…ç½®-kubeadm-é…ç½®æ–‡ä»¶\">#</a> é…ç½®  <code>kubeadm</code>  é…ç½®æ–‡ä»¶</h3>\n<p>é…ç½®  <code>kubeadm</code>  çš„é…ç½®æ–‡ä»¶.  <code>touch kubeadm-config.yaml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta3</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">InitConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">localAPIEndpoint:</span></span><br><span class=\"line\">  <span class=\"attr\">advertiseAddress:</span> <span class=\"number\">192.168</span><span class=\"number\">.96</span><span class=\"number\">.151</span></span><br><span class=\"line\">  <span class=\"attr\">bindPort:</span> <span class=\"number\">6443</span></span><br><span class=\"line\"><span class=\"attr\">nodeRegistration:</span></span><br><span class=\"line\">  <span class=\"attr\">criSocket:</span> <span class=\"string\">unix:///run/containerd/containerd.sock</span></span><br><span class=\"line\">  <span class=\"attr\">taints:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">effect:</span> <span class=\"string\">PreferNoSchedule</span></span><br><span class=\"line\">    <span class=\"attr\">key:</span> <span class=\"string\">node-role.kubernetes.io/master</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta2</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">kubernetesVersion:</span> <span class=\"string\">v1.24.0</span></span><br><span class=\"line\"><span class=\"attr\">imageRepository:</span> <span class=\"string\">registry.aliyuncs.com/google_containers</span></span><br><span class=\"line\"><span class=\"attr\">networking:</span></span><br><span class=\"line\">  <span class=\"attr\">podSubnet:</span> <span class=\"number\">10.244</span><span class=\"number\">.0</span><span class=\"number\">.0</span><span class=\"string\">/16</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubelet.config.k8s.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">KubeletConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">cgroupDriver:</span> <span class=\"string\">systemd</span></span><br><span class=\"line\"><span class=\"attr\">failSwapOn:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeproxy.config.k8s.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">KubeProxyConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">mode:</span> <span class=\"string\">ipvs</span></span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œå®šåˆ¶äº† <code>imageRepository</code>  ä¸ºé˜¿é‡Œäº‘çš„ <code>registry</code> ï¼Œé¿å…å›  gcr è¢«å¢™ï¼Œæ— æ³•ç›´æ¥æ‹‰å–é•œåƒã€‚ <code>criSocket</code>  è®¾ç½®äº†å®¹å™¨è¿è¡Œæ—¶ä¸º <code>containerd</code> ã€‚ åŒæ—¶è®¾ç½® <code>kubelet</code>  çš„ <code>cgroupDriver</code>  ä¸º <code>systemd</code> ï¼Œè®¾ç½® <code>kube-proxy</code>  ä»£ç†æ¨¡å¼ä¸º <code>ipvs</code> ã€‚</p>\n<p>å¯ä»¥é€šè¿‡  <code>kubeadm config print init-defaults --component-configs KubeletConfiguration</code>  å¯ä»¥æ‰“å°é›†ç¾¤åˆå§‹åŒ–é»˜è®¤çš„ä½¿ç”¨çš„é…ç½®.</p>\n<p>åœ¨å¼€å§‹åˆå§‹åŒ–é›†ç¾¤ä¹‹å‰å¯ä»¥ä½¿ç”¨ <code>kubeadm config images pull --config kubeadm-config.yaml</code>  é¢„å…ˆåœ¨å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šæ‹‰å–æ‰€ <code>k8s</code>  éœ€è¦çš„å®¹å™¨é•œåƒã€‚</p>\n<h3 id=\"åˆå§‹åŒ–-k8s-masterèŠ‚ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#åˆå§‹åŒ–-k8s-masterèŠ‚ç‚¹\">#</a> åˆå§‹åŒ–  <code>k8s</code>   <code>master</code>  èŠ‚ç‚¹</h3>\n<p>åœ¨  <code>master</code>  èŠ‚ç‚¹ä¸Šæ‰§è¡Œ  <code>kubeadm init --config kubeadm-config.yaml</code> ,</p>\n<p>çœ‹åˆ°æœ€åæœ‰æ‰“å°ï¼š  <code>Your Kubernetes control-plane has initialized successfully!</code></p>\n<p>å°±è¯´æ˜æ‰§è¡ŒæˆåŠŸäº†ã€‚</p>\n<p>ç„¶åè¿˜æœ‰æç¤º:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">To start using your cluster, you need to run the following as a regular user:</span><br><span class=\"line\"></span><br><span class=\"line\">  mkdir -p <span class=\"variable\">$HOME</span>/.kube</span><br><span class=\"line\">  sudo cp -i /etc/kubernetes/admin.conf <span class=\"variable\">$HOME</span>/.kube/config</span><br><span class=\"line\">  sudo chown $(id -u):$(id -g) <span class=\"variable\">$HOME</span>/.kube/config</span><br><span class=\"line\"></span><br><span class=\"line\">Alternatively, <span class=\"keyword\">if</span> you are the root user, you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run <span class=\"string\">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class=\"line\">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join 192.168.0.10:6443 --token e0nvot.l8sgzcgl07d5baq6 \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:d07d9a5b919c23177881134e3ccf90e26fcb173133b8f6172cbf3d74f3c6a75d</span><br></pre></td></tr></table></figure>\n<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æŒ‰ç…§æç¤ºæ‰§è¡Œã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p <span class=\"variable\">$HOME</span>/.kube</span><br><span class=\"line\">sudo cp -i /etc/kubernetes/admin.conf <span class=\"variable\">$HOME</span>/.kube/config</span><br><span class=\"line\">sudo chown $(id -u):$(id -g) <span class=\"variable\">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure>\n<p>ç„¶åå† ä¸¤å° <code>node</code>  èŠ‚ç‚¹ä¸Šæ‰§è¡Œ å¦‚ä¸‹å‘½ä»¤æ¥åŠ å…¥åˆ°é›†ç¾¤ä¸­ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join 192.168.0.10:6443 --token e0nvot.l8sgzcgl07d5baq6 \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:d07d9a5b919c23177881134e3ccf90e26fcb173133b8f6172cbf3d74f3c6a75d</span><br></pre></td></tr></table></figure>\n<p>æŸ¥çœ‹ä¸€ä¸‹é›†ç¾¤çŠ¶æ€ï¼Œç¡®è®¤ä¸ªç»„ä»¶éƒ½å¤„äº <code>healthy</code>  çŠ¶æ€ï¼Œæ˜¯å¦æœ‰é”™è¯¯:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get cs</span><br><span class=\"line\">Warning: v1 ComponentStatus is deprecated <span class=\"keyword\">in</span> v1.19+</span><br><span class=\"line\">NAME                 STATUS    MESSAGE                         ERROR</span><br><span class=\"line\">scheduler            Healthy   ok</span><br><span class=\"line\">controller-manager   Healthy   ok</span><br><span class=\"line\">etcd-0               Healthy   &#123;<span class=\"string\">&quot;health&quot;</span>:<span class=\"string\">&quot;true&quot;</span>,<span class=\"string\">&quot;reason&quot;</span>:<span class=\"string\">&quot;&quot;</span>&#125;</span><br></pre></td></tr></table></figure>\n<p>é›†ç¾¤åˆå§‹åŒ–å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ kubeadm reset å‘½ä»¤è¿›è¡Œæ¸…ç†.</p>\n<p>è¿™æ · <code>k8s</code>  é›†ç¾¤å°±éƒ¨ç½²å®Œæˆäº†ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/ml/qrcode.jpg\" alt=\"qrcode\"></p>\n",
            "tags": [
                "k8s",
                "kubernetes"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/07/09/rocketMQ/3-08-save-msg-detail/",
            "url": "https://fangjiaxiaobai.github.io/2022/07/09/rocketMQ/3-08-save-msg-detail/",
            "title": "RocketMQ æ¶ˆæ¯åˆ·ç›˜è¿‡ç¨‹è¯¦è§£",
            "date_published": "2022-07-09T10:18:00.000Z",
            "content_html": "<p>åœ¨ <a href=\"/2022/07/09/rocketMQ/3-08-save-msg-detail/s\">RocketMQ æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯</a> è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† æ¶ˆæ¯å‘é€åˆ°æ¶ˆè´¹ çš„æ•´ä½“æµç¨‹ã€‚è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹  <code>MappedFile</code>  çš„å®ç°ç»†èŠ‚.</p>\n<h2 id=\"å¼•è¨€\"><a class=\"markdownIt-Anchor\" href=\"#å¼•è¨€\">#</a> å¼•è¨€</h2>\n<p>æˆ‘ä»¬éƒ½çŸ¥é“çš„æ˜¯  <code>RocketMQæ¶ˆ</code> æ¯éƒ½æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šçš„ï¼Œæ¶ˆæ¯çš„è¯»å–å’Œå†™å…¥ä¹Ÿéƒ½æ˜¯ä¼šä»ç£ç›˜ä¸Šè¿›è¡Œ <code>IO</code>  çš„ã€‚å¯æ˜¯ç£ç›˜çš„æ€§èƒ½ä¸ç¦å¦ CPU å•§å•§æ’‡å˜´ã€‚ <code>RocketMQ</code>  æ˜¯å¦‚ä½•å®ç°æ¶ˆæ¯çš„é«˜æ€§èƒ½ <code>IO</code>  çš„å‘¢ï¼Ÿ</p>\n<p>ç­”æ¡ˆå°±æ˜¯  <code>MappedFile</code>  è¿™ä¸ª  <code>643</code>  è¡Œçš„ <code>java</code>  æ–‡ä»¶ä¸­ã€‚</p>\n<h2 id=\"rokcetmq-çš„-mappedfile\"><a class=\"markdownIt-Anchor\" href=\"#rokcetmq-çš„-mappedfile\">#</a>  <code>RokcetMQ</code>  çš„  <code>MappedFile</code></h2>\n<p>æˆ‘ä»¬çŸ¥é“çš„æ˜¯  <code>MappedFile</code>  æ˜¯  <code>RocketMQ</code>  çœŸå®æ¶ˆæ¯æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æ˜ å°„ã€‚ä¸»è¦æ˜¯é€šè¿‡  <code>java NIO</code>  æŠ€æœ¯æ¥å®ç°ã€‚</p>\n<p>æˆ‘ä»¬è¿˜æ˜¯ä»æºç å…¥æ‰‹ï¼ŒæŒ‰ç…§  <code>MappedFile</code>  çš„åˆå§‹åŒ–ï¼Œæäº¤æ¶ˆæ¯ (æ¶ˆæ¯å†™å…¥ç‰©ç†å†…å­˜)ï¼Œåˆ·ç›˜ çš„é¡ºåºå»å­¦ä¹ ã€‚</p>\n<h2 id=\"åˆå§‹åŒ–\"><a class=\"markdownIt-Anchor\" href=\"#åˆå§‹åŒ–\">#</a> åˆå§‹åŒ–</h2>\n<p>åœ¨  <code>Broker</code>  çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œ <code>Broker</code>  é€šè¿‡  <code>AllocateMappedFileService</code>  å®Œæˆäº†  <code>MappedFile</code>  çš„ åˆå§‹åŒ–è¿‡ç¨‹ã€‚å…¶ä¸»è¦çš„å®ç°å°±æ˜¯åœ¨  <code>mmapOperation</code>  æ–¹æ³•ä¸­ã€‚ä¸»è¦çš„èŒè´£æœ‰: 1ã€åˆ›å»º  <code>MappedFile</code>  å®ä¾‹  2ã€å¯¹ <code>MappedFile</code>  è¿›è¡Œé¢„çƒ­ã€‚</p>\n<h3 id=\"åˆ›å»º-mappedfileå®ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-mappedfileå®ä¾‹\">#</a> åˆ›å»º  <code>MappedFile</code>  å®ä¾‹</h3>\n<p>æ ¹æ® æ¶ˆæ¯çš„åˆ·ç›˜æ–¹å¼ åˆå§‹åŒ–  <code>MappedFile</code>  å®ä¾‹çš„ä¸åŒçš„å­—æ®µã€‚ å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-01.png\" alt=\"\"></p>\n<h3 id=\"é¢„çƒ­-mappedfile\"><a class=\"markdownIt-Anchor\" href=\"#é¢„çƒ­-mappedfile\">#</a> é¢„çƒ­  <code>MappedFile</code></h3>\n<p><code>MappedFile</code>  é¢„çƒ­çš„æ¡ä»¶ï¼šå®é™…çš„æ¶ˆæ¯æ–‡ä»¶å¤§å°è¶…è¿‡é…ç½®çš„å¤§å° (é»˜è®¤ <code>1G</code> ) å¹¶ä¸” é…ç½®å…è®¸ <code>MappedFile</code>  é¢„çƒ­ã€‚<br>\n <code>MappedFile</code>  é¢„çƒ­çš„ä½œç”¨æ˜¯ï¼šå°† å­˜åœ¨åœ¨ç£ç›˜ä¸Šçš„æ¶ˆæ¯é¢„å…ˆåŠ è½½åˆ°é¡µç¼“å­˜ä¸­ ( <code>Page Cache</code> ), è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„é¢„çƒ­ï¼Œçœå»äº†ç°ç”¨ç°åŠ è½½çš„æ—¶é—´ã€‚</p>\n<p>é¢„çƒ­çš„ä¸»è¦ä»£ç ï¼Œæˆ‘è´´åœ¨ä¸‹é¢</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-03.png\" alt=\"\"></p>\n<p>æ³¨æ„çœ‹ä¸‹æ³¨é‡Šçš„å†…å®¹ã€‚ä¹ä¸€çœ‹å¥½åƒæ²¡æœ‰ä»€ä¹ˆå¥‡æ€ªã€‚</p>\n<p>æˆ‘å…ˆè¡¥å……ä¸€ä¸‹å…³äºæ“ä½œç³»ç»Ÿä¸­å­˜å‚¨çš„å°çŸ¥è¯†ç‚¹:</p>\n<h4 id=\"é¡µ\"><a class=\"markdownIt-Anchor\" href=\"#é¡µ\">#</a> é¡µ</h4>\n<p>é¡µæ˜¯æ“ä½œç³»ç»Ÿè™šæ‹Ÿå†…å­˜ä¸­ç©ºé—´åˆ’åˆ†çš„å•ä½ã€‚æ˜¯é€»è¾‘åœ°å€ç©ºé—´é¡ºåºç­‰åˆ†è€Œæˆçš„ä¸€æ®µé€»è¾‘ç©ºé—´ï¼Œå¹¶ä¾æ¬¡è¿ç»­ç¼–å·ã€‚é¡µçš„å¤§å°ä¸€èˆ¬ä¸º <code>512B~8KB</code> ã€‚</p>\n<h4 id=\"é¡µç¼“å­˜page-cache\"><a class=\"markdownIt-Anchor\" href=\"#é¡µç¼“å­˜page-cache\">#</a> é¡µç¼“å­˜ (Page Cache)</h4>\n<p>ä¸ºäº†æå‡å¯¹æ–‡ä»¶çš„è¯»å†™æ•ˆç‡ï¼Œ <code>Linux</code>  å†…æ ¸ä¼šä»¥é¡µå¤§å°ï¼ˆ <code>4KB</code> ï¼‰ä¸ºå•ä½ï¼Œå°†æ–‡ä»¶åˆ’åˆ†ä¸ºå¤šæ•°æ®å—ã€‚å½“ç”¨æˆ·å¯¹æ–‡ä»¶ä¸­çš„æŸä¸ªæ•°æ®å—è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œå†…æ ¸é¦–å…ˆä¼šç”³è¯·ä¸€ä¸ªå†…å­˜é¡µï¼ˆç§°ä¸º é¡µç¼“å­˜ï¼‰ä¸æ–‡ä»¶ä¸­çš„æ•°æ®å—è¿›è¡Œç»‘å®šã€‚åœ¨ <code>Linux</code>  ç³»ç»Ÿä¸­å†™å…¥æ•°æ®çš„æ—¶å€™å¹¶ä¸ä¼šç›´æ¥å†™åˆ°ç¡¬ç›˜ä¸Šï¼Œè€Œæ˜¯ä¼šå…ˆå†™åˆ° <code>Page Cache</code>  ä¸­ï¼Œå¹¶æ‰“ä¸Š <code>dirty</code>  æ ‡è¯†ï¼Œç”±å†…æ ¸çº¿ç¨‹ <code>flusher</code>  å®šæœŸå°†è¢«æ‰“ä¸Š <code>dirty</code>  çš„é¡µå‘é€ç»™ <code>IO</code>  è°ƒåº¦å±‚ï¼Œæœ€åç”± <code>IO</code>  è°ƒåº¦å†³å®šä½•æ—¶è½åœ°åˆ°ç£ç›˜ä¸­ï¼Œè€Œ <code>Linux</code>  ä¸€èˆ¬ä¼šæŠŠè¿˜æ²¡æœ‰ä½¿ç”¨çš„å†…å­˜å…¨æ‹¿æ¥ç»™ <code>Page Cache</code>  ä½¿ç”¨ã€‚è€Œè¯»çš„è¿‡ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¼šå…ˆåˆ° <code>Page Cache</code>  ä¸­å¯»æ‰¾æ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰çš„è¯ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰æ‰ä¼šåˆ°ç£ç›˜ä¸­å»è¯»å–å¹¶å†™å…¥ <code>Page Cache</code>  ç„¶åå†æ¬¡è¯»å– <code>Page Cache</code>  å¹¶è¿”å›ã€‚è€Œä¸”è¯»çš„è¿™ä¸ªè¿‡ç¨‹ä¸­æ“ä½œç³»ç»Ÿä¹Ÿä¼šæœ‰ä¸€ä¸ªé¢„è¯»çš„æ“ä½œï¼Œä½ çš„æ¯ä¸€æ¬¡è¯»å–æ“ä½œç³»ç»Ÿéƒ½ä¼šå¸®ä½ é¢„è¯»å‡ºåé¢ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè€Œä¸”å½“ä½ ä¸€ç›´åœ¨ä½¿ç”¨é¢„è¯»æ•°æ®çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå¸®ä½ é¢„è¯»å‡ºæ›´å¤šçš„æ•°æ® (æœ€å¤§åˆ° <code>128K</code> )ã€‚</p>\n<p><code>page cache</code>  çš„ä½œç”¨ä¸»è¦æ˜¯å°†ç£ç›˜ä¸­æ–‡ä»¶ç¼“å­˜åˆ°å†…å­˜ï¼Œå¹¶é›†ä¸­ç®¡ç†ï¼Œä¾¿äºå›æ”¶åˆ©ç”¨ã€‚</p>\n<p>äº†è§£äº† é¡µå’Œé¡µç¼“å­˜ ä¹‹åï¼Œå°±åº”è¯¥å¯ä»¥çŸ¥é“äº†  <code>RocketMQ</code>  ä¸ºä»€ä¹ˆä¼šåœ¨  <code>MappedByteBuffer</code>  çš„æ¯ä¸ª  <code>pageSize</code>  å¤§å°çš„ä½ç½® (ä¹Ÿå°±æ˜¯ä¸€ä¸ªé¡µ) å†™å…¥ä¸€ä¸ª <code>0</code>  äº†ã€‚å…¶å®å°±æ˜¯ æŠŠç£ç›˜ä¸Šçš„æ•°æ®å†™åˆ°  <code>PageCache</code>  ä¸­ï¼Œä¹Ÿå°±è¾¾åˆ°é¢„çƒ­çš„æ•ˆæœã€‚</p>\n<p>è¿˜æœ‰ä¸€ä¸ª   <code>mlock</code>  æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<p>è¯¥æ–¹æ³•ä¸»è¦æ˜¯å®ç°æ–‡ä»¶é¢„çƒ­åï¼Œé˜²æ­¢æŠŠé¢„çƒ­è¿‡çš„æ–‡ä»¶è¢«æ“ä½œç³»ç»Ÿè°ƒåˆ° <code>swap</code>  ç©ºé—´ä¸­ã€‚å½“ç¨‹åºå†æ¬¡è¯»å–äº¤æ¢å‡ºå»çš„æ•°æ®çš„æ—¶å€™ä¼šäº§ç”Ÿç¼ºé¡µå¼‚å¸¸ã€‚ è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå…³äºæ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ç‚¹.</p>\n<h4 id=\"page-fault\"><a class=\"markdownIt-Anchor\" href=\"#page-fault\">#</a> Page Fault</h4>\n<p><code>CPU</code>  é€šè¿‡åœ°å€æ€»çº¿å¯ä»¥è®¿é—®è¿æ¥åœ¨åœ°å€æ€»çº¿ä¸Šçš„æ‰€æœ‰å¤–è®¾ï¼ŒåŒ…æ‹¬ç‰©ç†å†…å­˜ã€ <code>IO</code>  è®¾å¤‡ç­‰ç­‰ï¼Œä½†ä» <code>CPU</code>  å‘å‡ºçš„è®¿é—®åœ°å€å¹¶éæ˜¯è¿™äº›å¤–è®¾åœ¨åœ°å€æ€»çº¿ä¸Šçš„ç‰©ç†åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œç”±å†…å­˜ç®¡ç†å•å…ƒ ( <code>MMU</code> ) å°†è™šæ‹Ÿåœ°å€è½¬æ¢æˆç‰©ç†åœ°å€å†ä»åœ°å€æ€»çº¿ä¸Šå‘å‡ºï¼Œå†…å­˜ç®¡ç†å•å…ƒä¸Šçš„è¿™ç§è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„è½¬æ¢å…³ç³»æ˜¯éœ€è¦åˆ›å»ºçš„ï¼Œå¹¶ä¸”å†…å­˜ç®¡ç†å•å…ƒè¿˜å¯ä»¥è®¾ç½®è¿™ä¸ªç‰©ç†é¡µæ˜¯å¦å¯ä»¥è¿›è¡Œå†™æ“ä½œï¼Œå½“æ²¡æœ‰åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„ï¼Œæˆ–è€…åˆ›å»ºäº†è¿™æ ·çš„æ˜ å°„ä½†é‚£ä¸ªç‰©ç†é¡µä¸å¯å†™çš„æ—¶å€™ï¼Œå†…å­˜ç®¡ç†å•å…ƒå°†ä¼šé€šçŸ¥ <code>CPU</code>  äº§ç”Ÿäº†ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ã€‚äº§ç”Ÿäº†  <code>Page Fault</code>  ä¹‹åä¼šäº¤ç»™ <code>PageFaultHandler</code>  å¤„ç†ï¼Œè¿™é‡Œä¸è¯¦ç»†ä»‹ç»äº†ã€‚å¯¼è‡´ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿå¼‚å¸¸ï¼Œæ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>\n<p>è€Œ <b> <code>mlock</code>  å°±æ˜¯ä¸ºäº†é˜»æ­¢å‡ºç°  <code>pageFault</code>  å¼‚å¸¸</b></p>\n<h4 id=\"å†…å­˜ç®¡ç†æœºåˆ¶é¡µæ¡†å›æ”¶æœºåˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#å†…å­˜ç®¡ç†æœºåˆ¶é¡µæ¡†å›æ”¶æœºåˆ¶\">#</a> å†…å­˜ç®¡ç†æœºåˆ¶ï¼šé¡µæ¡†å›æ”¶æœºåˆ¶</h4>\n<p>ç³»ç»Ÿä¸­åˆè¯†åŒ–äº†å¾ˆå¤šé¡µç¼“å­˜ï¼Œä½†æ˜¯è¿™äº›é¡µé•¿æ—¶é—´æ²¡æœ‰ä½¿ç”¨ï¼Œ <code>linux</code>  ä¼šæœ‰ä¸€ä¸ª é¡µæ¡†çš„å›æ”¶æœºåˆ¶ï¼Œå°†  <code>page cache</code>  ä¸­æ•°æ®æ ‡è¯† â€œå¯å›æ”¶â€ã€‚ åœ¨å›æ”¶ä¹‹å‰ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæŠŠ  <code>Page cache</code>  ä¸­çš„å†…å®¹å¤åˆ¶åˆ°  <code>swap cache</code>  ä¸­ (è¿™ä¸ªæ“ä½œä¹Ÿå«åš  <code>swap out</code> ), å¦‚æœè¿›ç¨‹è¦è®¿é—® å½“å‰é¡µçš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°  <code>page Fault</code> . ç„¶å æ ¹æ®  <code>swap cache</code>  å†…å­˜åœ°å€æŠŠå†…å­˜æ‹·è´åˆ°æ–°çš„  <code>PageCache</code>  ä¸­ (è¿™ä¸ªæ“ä½œå«åš  <code>swap in</code> ).</p>\n<h3 id=\"æ€»ç»“é¢„çƒ­mappedfile\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“é¢„çƒ­mappedfile\">#</a> æ€»ç»“ï¼šé¢„çƒ­ <code>MappedFile</code></h3>\n<p>é¢„çƒ­æ—¶å·²ç»å·²ç»å»ºç«‹äº†  <code>MappedByteBuffer</code>  å’Œç‰©ç†å†…å­˜çš„åœ°å€æ˜ å°„ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æŠŠæ¶ˆæ¯åŠ è½½è¿›å†…å­˜ï¼Œæ‰€è°“çš„é¢„çƒ­æ˜¯ä¸ºäº†æŠŠæ¶ˆæ¯è¯»å–åˆ°æ“ä½œç³»ç»Ÿçš„ç‰©ç†å†…å­˜ä¸­ã€‚å¹¶ä¸”ä½¿ç”¨  <code>mlock</code>  æŠŠé”å®šå†…å­˜ï¼Œé˜²æ­¢æ¶ˆæ¯è¢«æ“ä½œç³»ç»Ÿå›æ”¶ã€‚</p>\n<h2 id=\"æ¶ˆæ¯å†™å…¥ç‰©ç†å†…å­˜\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯å†™å…¥ç‰©ç†å†…å­˜\">#</a> æ¶ˆæ¯å†™å…¥ç‰©ç†å†…å­˜</h2>\n<p>è¿™ç¯‡æ–‡ç« <a href=\"./2-02-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E6%B6%88%E6%81%AF.md\">ã€ŠRocketMQ æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯ã€‹</a>æˆ‘ä»¬ä»‹ç»äº†æ¶ˆæ¯å†™å…¥çš„å¤§è‡´è¿‡ç¨‹:  <code>Broker</code>  çš„  <code>Netty Server</code>  æ¥æ”¶åˆ°  <code>Producer</code>  å‘é€æ¥çš„æ¶ˆæ¯ï¼Œé€šè¿‡  <code>SendMessageProcessor</code>  è¿›è¡Œå¤„ç†ï¼Œç„¶å  <code>DefaultMessageStore</code>  æŠŠæ¶ˆæ¯äº¤ç»™  <code>CommitLog</code>  è¿›è¡Œå†™æ¶ˆæ¯å’Œåˆ·ç›˜.</p>\n<p>æˆ‘ä»¬éƒ½çŸ¥é“çš„æ˜¯  <code>CommitLog</code>  è¡¨ç¤ºçš„æ˜¯  <code>RocketMQ</code>  çš„æ¶ˆæ¯æ–‡ä»¶ã€‚å®ƒæä¾›äº†å†™å…¥æ¶ˆæ¯å’Œè¯»å–æ¶ˆæ¯çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å°±ä»  <code>CommitLog</code> . <code>asyncPutMessage</code>  æ¥çœ‹æ¶ˆæ¯çš„å†™å…¥è¿‡ç¨‹ã€‚</p>\n<p><code>asyncPutMessage</code>  è¿™ä¸ªæ–¹æ³• å®ç°äº†ä¸¤ä¸ªåŠŸèƒ½:</p>\n<ul>\n<li>é€šè¿‡  <code>ByteBuffer</code>  å†™å…¥æ¶ˆæ¯ã€‚</li>\n<li>æäº¤åˆ·ç›˜è¯·æ±‚ã€‚</li>\n</ul>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-04.png\" alt=\"\"></p>\n<p>ä¸Šå›¾æºç ä¸­å¯ä»¥çœ‹åˆ°  <code>CommitLog</code>  è°ƒç”¨äº†  <code>MappedFile</code>  æŠŠæ¶ˆæ¯å†™å…¥æ–‡ä»¶ï¼ŒçœŸå®å»å†™å…¥è€…æ˜¯  <code>ByteBuffer.put()</code>  æ–¹æ³•æŠŠæ¶ˆæ¯å†™åˆ°äº†ç‰©ç†å†…å­˜ä¸­.</p>\n<p>æ³¨æ„ï¼Œè¿™ä¸ª <code>ByteBuffer</code>  éå¸¸çš„æœ‰æ„æ€.</p>\n<p>å½“ åˆ·ç›˜æ–¹å¼æ˜¯ åŒæ­¥åˆ·ç›˜çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ï¼š <code>this.mappedByteBuffer.slice()</code>  , è¿™ä¸ª  <code>mappedByteBuffer</code>  å¯¹è±¡æ˜¯æœ‰ <code>FileChannel.map()</code>  æ–¹æ³•ç”Ÿæˆã€‚<br>\nå½“åˆ·ç›˜æ–¹å¼æ˜¯ å¼‚æ­¥åˆ·ç›˜çš„æ—¶å€™ï¼Œåˆ™æ˜¯ä½¿ç”¨  <code>DirectByteBuffer </code> è¿›è¡Œå†™å…¥çš„ã€‚</p>\n<p>è¿™ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæœ¬è´¨ä¸Šå…¶å®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ï¼</p>\n<p><code>FileChannel.map()</code>  å‡ºæ¥çš„  <code>MappedByteBuffer</code>  ç±»å‹æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡  <code>DirectByteBuffer</code>  è¿›è¡Œæ„å»ºå‡ºæ¥çš„ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-05.png\" alt=\"\"></p>\n<p>è¿™æ ·ï¼Œ <code>RocketMQ</code>  å°±æŠŠæ¶ˆæ¯å†™å…¥åˆ°äº†ç‰©ç†å†…å­˜ä¸­.</p>\n<p>ä»€ä¹ˆæ—¶å€™æŠŠæ¶ˆæ¯å†™åˆ°ç£ç›˜ä¸Šçš„å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬è¯»å†™çš„æ•°æ®éƒ½æ˜¯ä»  <code>pageCache</code>  ä¸­è¯»å†™çš„ï¼Œå¹¶ä¸ä¼šç›´æ¥è¯»å†™ç£ç›˜ã€‚</p>\n<p>æ“ä½œç³»ç»Ÿä¸­æä¾›äº†ä¸¤ç§æ–¹å¼æ¥å®ç°  <code>pageCache</code>  å’Œ ç£ç›˜çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>\n<ul>\n<li><code>Write Through</code> ï¼ˆå†™ç©¿ï¼‰ï¼šå‘ç”¨æˆ·å±‚æä¾›ç‰¹å®šæ¥å£ï¼Œåº”ç”¨ç¨‹åºå¯ä¸»åŠ¨è°ƒç”¨æ¥å£æ¥ä¿è¯æ–‡ä»¶ä¸€è‡´æ€§ï¼›</li>\n<li><code>Write back</code> ï¼ˆå†™å›ï¼‰ï¼šç³»ç»Ÿä¸­å­˜åœ¨å®šæœŸä»»åŠ¡ï¼ˆè¡¨ç°å½¢å¼ä¸ºå†…æ ¸çº¿ç¨‹ï¼‰ï¼Œå‘¨æœŸæ€§åœ°åŒæ­¥æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶è„æ•°æ®å—ï¼Œè¿™æ˜¯é»˜è®¤çš„  <code>Linux</code>  ä¸€è‡´æ€§æ–¹æ¡ˆ.</li>\n<li></li>\n</ul>\n<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹  <code>RocketMQ</code>  æ˜¯å¦‚ä½•ç¡®ä¿æ¶ˆæ¯è½ç›˜çš„ã€‚</p>\n<h2 id=\"æ¶ˆæ¯åˆ·ç›˜\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯åˆ·ç›˜\">#</a> æ¶ˆæ¯åˆ·ç›˜</h2>\n<p><code>RocketMQ</code>  æœ‰ä¸‰ç§åˆ·ç›˜æ–¹å¼ã€‚ä¸¤ç§åˆ·ç›˜çš„å®ç°ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-06.png\" alt=\"\"></p>\n<p>åˆ†åˆ«æ˜¯  <code>GroupCommitService</code>  (åŒæ­¥åˆ·ç›˜),  <code>FlushRealTimeService</code>  (å¼‚æ­¥åˆ·ç›˜),  <code>CommitRealTimeService</code>  (å¼‚æ­¥åˆ·ç›˜ + ç¼“å†²åŒº). è¿™ä¸‰ä¸ªç±»æœ‰ä¸€ä¸ªå…±åŒçš„çˆ¶ç±»:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-07.png\" alt=\"\"></p>\n<p>æˆ‘ä»¬è¯¦ç»†çš„å»çœ‹ä¸€ä¸‹åŒæ­¥åˆ·ç›˜çš„è¿‡ç¨‹ã€‚å› ä¸ºå¼‚æ­¥åˆ·ç›˜å’ŒåŒæ­¥åˆ·ç›˜çš„ <code>flush</code>  è¿‡ç¨‹æ˜¯ä¸€æ ·çš„.</p>\n<h3 id=\"åŒæ­¥åˆ·ç›˜\"><a class=\"markdownIt-Anchor\" href=\"#åŒæ­¥åˆ·ç›˜\">#</a> åŒæ­¥åˆ·ç›˜</h3>\n<p>åœ¨æ¶ˆæ¯å¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœé…ç½®äº† ä½¿ç”¨åŒæ­¥åˆ·ç›˜æ–¹å¼çš„è¯ï¼Œ <code>Broker</code>  ä¼šå¯åŠ¨  <code>GroupCommitService</code>  å’Œ  <code>CommitRealTimeService</code>  (è¿™ä¸ªæ˜¯å¼‚æ­¥åˆ·ç›˜å¹¶ä¸”é…ç½®å†…å­˜æ± çš„æ—¶å€™ä½¿ç”¨çš„åˆ·ç›˜æ–¹å¼ï¼Œä¸ç®¡é…ç½®ä»€ä¹ˆæ–¹å¼çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºï¼Œåœ¨å¯ç”¨ <code>isTransientStorePoolEnable</code>  çš„æ—¶å€™æ‰ä¼š  <code>start()</code>  ).</p>\n<p><code>GroupCommitService</code>  åœ¨å¯åŠ¨ä¹‹åï¼Œä¼šæ¯  <code>10ms</code>  æ‰§è¡Œä¸€æ¬¡åˆ·ç›˜æ“ä½œã€‚</p>\n<p>æˆ‘ä»¬ä»  <code>CommitLog</code>  æ·»åŠ å®Œæ¶ˆæ¯æäº¤åˆ·ç›˜è¯·æ±‚å¼€å§‹ï¼Œè¯¦ç»†åˆ†ææ•´ä¸ªè¿‡ç¨‹.</p>\n<p>å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-08.png\" alt=\"\"></p>\n<p><code>CommitLog</code>  æäº¤ä¸€ä¸ª åˆ·ç›˜è¯·æ±‚ï¼Œè¿™æ—¶æ ¹æ®é…ç½® æ˜¯å¦ç­‰å¾…æ¶ˆæ¯å†™å…¥å®Œæˆ æ¥æ‰§è¡Œåˆ·ç›˜æ“ä½œ.</p>\n<ul>\n<li>å¦‚æœä¸ç­‰å¾…æ¶ˆæ¯å†™å…¥å®Œæˆï¼Œåˆ™å”¤é†’  <code>GroupCommitService</code> , ç›´æ¥è¿”å›å†™å…¥æˆåŠŸï¼Œè¿™æ—¶ çº¿ç¨‹æ˜¯å¦æ‰§è¡Œæ˜¯ç”± <code>JVM</code>  å†³å®šçš„ï¼Œæ‰€ä»¥å¹¶ä¸ç¡®å®šçº¿ç¨‹ç«‹åˆ»å°±æ‰§è¡Œäº†ã€‚</li>\n<li>å¦‚æœç­‰å¾…æ¶ˆæ¯å†™å…¥å®Œæˆï¼Œå³ç¬¬äºŒæ­¥ï¼Œåˆ™ä¼šæ”¾å…¥ä¸€ä¸ª  <code>GroupCommitRequest</code>  åŒæ­¥åˆ·ç›˜è¯·æ±‚ã€‚å®é™…ä¸Šæ˜¯æŠŠ è¿™ä¸ª  <code>Request</code>  æ”¾åˆ°  <code>GroupCommitService</code>  çš„  <code>LinkedList</code>  ä¸­ï¼Œä¸ºäº†çº¿ç¨‹å®‰å…¨å’Œæé«˜æ•ˆç‡ï¼Œä½¿ç”¨äº†ä¸¤ä¸ª  <code>LinkedList</code> , åˆ†åˆ«æ˜¯  <code>write</code>  å’Œ  <code>read</code> . å½“æ‰§è¡Œåˆ·ç›˜æ“ä½œçš„æ—¶å€™ï¼Œä¼šå°†  <code>write</code>  å’Œ  <code>read</code>  äº’æ¢ã€‚æ¯æ¬¡éƒ½ä¼šè¯»å–  <code>read</code>  é˜Ÿåˆ—ä¸­çš„  <code>Request</code>  è¿›è¡Œåˆ·ç›˜ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨  <code>waitForRunning</code>  æ–¹æ³•ä¸­æ‰§è¡Œçš„ï¼Œè§å¦‚å›¾ç¬¬ <code>5-7</code>  æ­¥ã€‚<br>\næ¥ä¸‹æ¥å°±æ˜¯åˆ·ç›˜æ“ä½œäº†ï¼Œè°ƒç”¨  <code>mappedFileQueue.flush(0)</code>  æ“ä½œå®Œæˆåˆ·ç›˜åŠ¨ä½œã€‚ç„¶åï¼Œè¿”å›  <code>CompleteFuture</code>  å¦‚å›¾ä¸­ç¬¬ 9 æ­¥ã€‚ å½“éœ€è¦ç­‰å¾…æ¶ˆæ¯å†™å…¥å®Œæˆçš„æ—¶å€™ï¼Œ <code>CommitLog</code>  æ·»åŠ æ¶ˆæ¯æ˜¯åœ¨ä¸€ç›´ç­‰å¾…çš„ã€‚å¦‚ä¸‹å›¾.</li>\n</ul>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-09.png\" alt=\"\"></p>\n<p>é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘å°±è¯¦ç»†çš„æ¥çœ‹ä¸‹  <code>mappedFileQueue</code>  å…¶å®æ˜¯  <code>MappedFile</code>  çš„åˆ·ç›˜è¿‡ç¨‹.</p>\n<h4 id=\"mappedfilequeueflush\"><a class=\"markdownIt-Anchor\" href=\"#mappedfilequeueflush\">#</a> MappedFileQueue.flush</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * åˆ·ç›˜</span></span><br><span class=\"line\"><span class=\"comment\">    *</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> flushLeastPages æœ€åä¸€é¡µ</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">flush</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> flushLeastPages)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> result = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    <span class=\"comment\">// flushWhere. åº”è¯¥åˆ·æ–°æ•°æ®endçš„ä½ç½®ã€‚</span></span><br><span class=\"line\">    MappedFile mappedFile = <span class=\"keyword\">this</span>.findMappedFileByOffset(<span class=\"keyword\">this</span>.flushedWhere, <span class=\"keyword\">this</span>.flushedWhere == <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mappedFile != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> tmpTimeStamp = mappedFile.getStoreTimestamp();</span><br><span class=\"line\">        <span class=\"comment\">// ä½¿ç”¨ MappedFile è¿›è¡Œåˆ·ç›˜ã€‚è¿”å› MappedFile ä¸­ å·²è¢«åˆ·æ–°åˆ°ç£ç›˜çš„æ•°æ®çš„åç§»é‡</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> offset = mappedFile.flush(flushLeastPages);</span><br><span class=\"line\">        <span class=\"comment\">// åœ¨æ•´ä¸ªMappedFileQueueä¸­çš„åç§»é‡</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> where = mappedFile.getFileFromOffset() + offset;</span><br><span class=\"line\">        result = where == <span class=\"keyword\">this</span>.flushedWhere;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.flushedWhere = where;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">0</span> == flushLeastPages) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// åˆ·æ–°ä¹‹å‰ï¼Œæœ€æ–°ä¸€æ¡æ¶ˆæ¯çš„å­˜å‚¨æ—¶é—´æˆ³</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.storeTimestamp = tmpTimeStamp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è·å–åˆ°å½“å‰éœ€è¦å†™å…¥çš„ <code>MappedFile</code> . ç„¶åé€šè¿‡ <code>MappedFile</code>  å†™å…¥ &quot;ç£ç›˜&quot;ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ·ç›˜ã€‚ æŠŠå†™å…¥MappedFile çš„æ•°æ®ï¼Œå†™å…¥ç£ç›˜ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> The current flushed position</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">flush</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">int</span> flushLeastPages)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isAbleToFlush(flushLeastPages)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.hold()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> value = getReadPosition();</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// åªæœ‰åœ¨å¼‚æ­¥åˆ·ç›˜+ç¼“å­˜åŒºæ–¹å¼çš„æ—¶å€™ï¼Œæ‰åˆå§‹åŒ– writeBuffter</span></span><br><span class=\"line\">                    <span class=\"comment\">//We only append data to fileChannel or mappedByteBuffer, never both.</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (writeBuffer != <span class=\"keyword\">null</span> || <span class=\"keyword\">this</span>.fileChannel.position() != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.fileChannel.force(<span class=\"keyword\">false</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// ä¸ç®¡ä»€ä¹ˆåˆ·ç›˜æ–¹å¼ï¼Œéƒ½ä¼šåˆå§‹åŒ–mappedByteBuffer.</span></span><br><span class=\"line\">                        <span class=\"comment\">// åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜æ–¹å¼éƒ½æ˜¯ä½¿ç”¨ mappedByteBuffer è¿›è¡Œåˆ·ç›˜</span></span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.mappedByteBuffer.force();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">                    log.error(<span class=\"string\">&quot;Error occurred when force data to disk.&quot;</span>, e);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.flushedPosition.set(value);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.release();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                log.warn(<span class=\"string\">&quot;in flush, hold failed, flush offset = &quot;</span> + <span class=\"keyword\">this</span>.flushedPosition.get());</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.flushedPosition.set(getReadPosition());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getFlushedPosition();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¼‚æ­¥åˆ·ç›˜\"><a class=\"markdownIt-Anchor\" href=\"#å¼‚æ­¥åˆ·ç›˜\">#</a> å¼‚æ­¥åˆ·ç›˜</h3>\n<p>çœ‹å®ŒåŒæ­¥åˆ·ç›˜çš„æµç¨‹ä¹‹åï¼Œå¼‚æ­¥åˆ·ç›˜å°±ç®€å•å¾ˆå¤šäº†ã€‚<br>\nå¼‚æ­¥åˆ·ç›˜ä»ç„¶æ˜¯ä½¿ç”¨  <code>mappedFileQueue.flush()</code>  è¿›è¡Œåˆ·ç›˜çš„</p>\n<p>å®ç°é€»è¾‘å¦‚ä¸‹å›¾ (ä»£ç æœ‰ç²¾ç®€):</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-10.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå¼‚æ­¥åˆ·ç›˜çš„çº¿ç¨‹åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šé€šè¿‡  <code>Thread.sleep()</code>  è¿›è¡Œçº¿ç¨‹ç­‰å¾… æˆ–è€… é€šè¿‡  <code>CountDownLatch2</code>  è¿›è¡Œç­‰å¾…çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯:  <code>CountDownLatch2</code>  æ˜¯  <code>RocketMQ</code>  å®ç°çš„ä¸€ä¸ªç±»ï¼Œä½œç”¨åŒ <code>CountDownLatch</code>  ä¸€æ ·ã€‚</p>\n<p>è€Œä¸”åœ¨ æ¶ˆæ¯è¿›è¡Œåˆ·ç›˜çš„æ—¶å€™ï¼Œ åªéœ€è¦å°†  <code>FlushRealTimeService</code>  çº¿ç¨‹  <code>wakeup()</code>  å°±å¥½äº†ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-11.png\" alt=\"\"></p>\n<p>æ­¤æ—¶çš„  <code>flushCommitLogService</code>  æ˜¯  <code>FlushRealTimeService</code>  çš„å®ä¾‹ã€‚</p>\n<p>å¼‚æ­¥åˆ·ç›˜çš„æ—¶æœº:</p>\n<ul>\n<li>åˆ¤æ–­æ˜¯å¦è¶…è¿‡ <code>10s</code>  æ²¡æœ‰åˆ·ç›˜äº†ï¼Œå¦‚æœè¶…è¿‡åˆ™å¼ºåˆ¶åˆ·ç›˜ã€‚</li>\n<li>ç­‰å¾… <code>flush</code>  é—´éš”ï¼Œé»˜è®¤ <code>500ms</code></li>\n<li>é€šè¿‡ <code>MappedFile</code>  åˆ·ç›˜</li>\n<li>è¶…è¿‡ <code>500ms</code>  çš„åˆ·ç›˜æ—¥å¿—</li>\n<li><code>Broker</code>  æ­£å¸¸æŒºå€¼é’±ï¼ŒæŠŠå†…å­˜ <code>page</code>  ä¸­çš„æ•°æ®åˆ·ç›˜ã€‚</li>\n</ul>\n<p>å’ŒåŒæ­¥åˆ·ç›˜ç›¸æ¯”ï¼Œå¼‚æ­¥åˆ·ç›˜æé«˜äº† <code>IO</code>  æ€§èƒ½ã€‚</p>\n<h3 id=\"å¼‚æ­¥åˆ·ç›˜ç¼“å†²åŒº\"><a class=\"markdownIt-Anchor\" href=\"#å¼‚æ­¥åˆ·ç›˜ç¼“å†²åŒº\">#</a> å¼‚æ­¥åˆ·ç›˜ + ç¼“å†²åŒº</h3>\n<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ‰§è¡Œçš„æµç¨‹ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-12.png\" alt=\"\"></p>\n<p>ç„¶åå¦‚æœæ˜¯ <code>CountDownLatch2</code>  ç»“æŸï¼Œæ‰§è¡Œçº¿ç¨‹çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œä¸‹é¢çš„é€»è¾‘:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-13.png\" alt=\"\"></p>\n<p>åˆ¤æ–­æ˜¯å¦æœ‰æ–°çš„æ•°æ®æäº¤ï¼Œ å¦‚æœæœ‰ï¼Œåˆ™å”¤é†’å¼‚æ­¥åˆ·ç›˜æ–¹å¼ã€‚æ²¡æœ‰åˆ™ç­‰å¾…ã€‚</p>\n<p><code>waitForRunning</code>  æ–¹æ³•çš„é€»è¾‘æ˜¯ï¼š</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/3-08-14.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ° æ˜¯é€šè¿‡çº¿ç¨‹ç­‰å¾…çš„æ–¹å¼ï¼Œç­‰å¾…æ—¶é—´é—´éš”å®Œæˆã€‚</p>\n<p>å¼€å¯ç¼“å†²åŒºåçš„åˆ·ç›˜ç­–ç•¥:</p>\n<ul>\n<li>åˆ¤æ–­æ˜¯å¦è¶…è¿‡ <code>200</code>  æ¯«ç§’æ²¡æäº¤ï¼Œéœ€è¦å¼ºåˆ¶æäº¤</li>\n<li>æäº¤åˆ° <code>MappedFile</code> ï¼Œæ­¤æ—¶è¿˜æœªåˆ·ç›˜</li>\n<li>ç„¶åå”¤é†’åˆ·ç›˜çº¿ç¨‹</li>\n<li>åœ¨ <code>Broker</code>  æ­£å¸¸åœæ­¢å‰ï¼Œæäº¤å†…å­˜ <code>page</code>  ä¸­çš„æ•°æ®</li>\n</ul>\n<p><code>RocketMQ</code>  ç”³è¯·ä¸€å—å’Œ <code>CommitLog</code>  æ–‡ä»¶å¤§å°ç›¸åŒçš„å †å¤–å†…å­˜åœ¨åšç¼“å†²åŒºï¼Œæ•°æ®ä¼šå…ˆå†™å…¥ç¼“å†²æ± ï¼Œæäº¤çº¿ç¨‹  <code>commitRealTimeService</code>  æ¯éš”  <code>500ms</code>  å°è¯•æäº¤åˆ°  <code>FileChannel</code>  ä¸­è¿›è¡Œåˆ·ç›˜ï¼Œæœ€åä½¿ç”¨  <code>FlushRealTimeService</code>  æ¥å®Œæˆã€‚<br>\nä½¿ç”¨äº†ç¼“å†²åŒºçš„ç›®çš„æ˜¯ å¤šæ¡æ•°æ®åˆå¹¶å†™å…¥ï¼Œæé«˜ <code>IO</code>  æ€§èƒ½.</p>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<p><code>RocketMQ</code>  ä½¿ç”¨  <code>FileChannel</code>  å’Œ  <code>MappedByteBuffer</code>  å®Œæˆäº†æ¶ˆæ¯çš„è½ç›˜ã€‚æä¾›äº†ä¸‰ç§æŒä¹…åŒ–ç­–ç•¥ï¼š</p>\n<ul>\n<li>åŒæ­¥åˆ·ç›˜ï¼šä½¿ç”¨  <code>GroupCommitService</code>  çº¿ç¨‹ï¼Œé€šè¿‡  <code>MappedByteBuffer</code>  çš„  <code>force</code>  æ–¹æ³•å°†æ¶ˆæ¯å†™å…¥æ–‡ä»¶ä¸­ï¼Œå†™å…¥å®Œæˆåæ‰ä¼šè¿”å›  <code>ACK</code> .</li>\n<li>å¼‚æ­¥åˆ·ç›˜ï¼šæ¶ˆæ¯å†™å…¥  <code>pageCache</code>  ä¹‹åï¼Œå°±ç«‹å³è¿”å›  <code>ACK</code> . ä½¿ç”¨  <code>FlushRealTimeService</code>  çº¿ç¨‹ é€šè¿‡  <code>FileChannel</code>  çš„  <code>force</code>  æ–¹æ³•ç¡®ä¿å°†æ¶ˆæ¯å†™å…¥æ–‡ä»¶.</li>\n<li>å¼‚æ­¥åˆ·ç›˜ + å¼€å¯ç¼“å†²åŒº:  <code>RocketMQ</code>  ç”³è¯·ä¸€å—ç›´æ¥å†…å­˜ç”¨ä½œæ•°æ®ç¼“å†²åŒºï¼Œæ¶ˆæ¯å…ˆå†™å…¥ç¼“å†²åŒºï¼Œç„¶åç”±  <code>CommitRealTimeService</code>  çº¿ç¨‹å®šæ—¶å°†ç¼“å†²åŒºæ•°æ®å†™å…¥  <code>FileChannel</code>  ï¼Œå†å”¤é†’  <code>FlushRealTimeService</code>  å°†  <code>FileChannel</code>  ç¼“å†²åŒºæ•°æ®å¼ºåˆ¶åˆ·æ–°åˆ°ç£ç›˜ã€‚</li>\n</ul>\n<p>å›ç­”ä¸€ä¸‹æ–‡ç« å¼€å¤´çš„é—®é¢˜:<br>\n <code>RocketMQ</code>  æ˜¯å¦‚ä½•æé«˜ æ•°æ®è¯»å†™çš„æ€§èƒ½çš„å‘¢ï¼Ÿ<br>\n <code>RocketMQ</code>  çš„å¤§è‡´åšæ³•æ˜¯ï¼Œå°†æ•°æ®æ–‡ä»¶æ˜ å°„åˆ° <code>OS</code>  çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼ˆé€šè¿‡ <code>JDK</code>   <code>NIO</code>  çš„ <code>MappedByteBuffer</code> ï¼‰ï¼Œå†™æ¶ˆæ¯çš„æ—¶å€™é¦–å…ˆå†™å…¥  <code>PageCache</code>  ï¼Œå¹¶é€šè¿‡å¼‚æ­¥åˆ·ç›˜çš„æ–¹å¼å°†æ¶ˆæ¯æ‰¹é‡çš„åšæŒä¹…åŒ–ï¼ˆåŒæ—¶ä¹Ÿæ”¯æŒåŒæ­¥åˆ·ç›˜ï¼‰ï¼›è®¢é˜…æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼ˆå¯¹ <code>CommitLog</code>  æ“ä½œæ˜¯éšæœºè¯»å–ï¼‰ï¼Œç”±äº <code>PageCache</code>  çš„å±€éƒ¨æ€§çƒ­ç‚¹åŸç†ä¸”æ•´ä½“æƒ…å†µä¸‹è¿˜æ˜¯ä»æ—§åˆ°æ–°çš„æœ‰åºè¯»ï¼Œå› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ¶ˆæ¯è¿˜æ˜¯å¯ä»¥ç›´æ¥ä» <code>Page Cache</code> ï¼ˆ <code>cache hit</code> ï¼‰ä¸­è¯»å–ï¼Œä¸ä¼šäº§ç”Ÿå¤ªå¤šçš„ç¼ºé¡µï¼ˆ <code>Page Fault</code> ï¼‰ä¸­æ–­è€Œä»ç£ç›˜è¯»å–ã€‚å½“ç„¶ï¼Œ <code>PageCache</code>  æœºåˆ¶ä¹Ÿä¸æ˜¯å®Œå…¨æ— ç¼ºç‚¹çš„ï¼Œå½“é‡åˆ° <code>OS</code>  è¿›è¡Œè„é¡µå›å†™ï¼Œå†…å­˜å›æ”¶ï¼Œå†…å­˜ <code>swap</code>  ç­‰æƒ…å†µæ—¶ï¼Œå°±ä¼šå¼•èµ·è¾ƒå¤§çš„æ¶ˆæ¯è¯»å†™å»¶è¿Ÿã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œ  <code>RocketMQ</code>  é‡‡ç”¨äº†å¤šç§ä¼˜åŒ–æŠ€æœ¯ï¼Œæ¯”å¦‚å†…å­˜é¢„åˆ†é…ï¼Œæ–‡ä»¶é¢„çƒ­ï¼Œ  <code>mlock</code>  ç³»ç»Ÿè°ƒç”¨ç­‰ï¼Œæ¥ä¿è¯åœ¨æœ€å¤§å¯èƒ½åœ°å‘æŒ¥  <code>PageCache</code>  æœºåˆ¶ä¼˜ç‚¹çš„åŒæ—¶ï¼Œå°½å¯èƒ½åœ°å‡å°‘å…¶ç¼ºç‚¹å¸¦æ¥çš„æ¶ˆæ¯è¯»å†™å»¶è¿Ÿ.</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.iohttps://fangjiaxiaobai.github.io/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/06/05/others/cat-movie/",
            "url": "https://fangjiaxiaobai.github.io/2022/06/05/others/cat-movie/",
            "title": "çŒ«å½±è§†æ¥å£é…ç½®ã€ä¸å®šæ—¶æ›´æ–°ã€‘",
            "date_published": "2022-06-05T10:18:00.000Z",
            "content_html": "<p>æ‰€æœ‰æ¥å£å‡ä¸ºç½‘ä¸Šæœé›†ï¼Œç¦æ­¢ğŸˆ²å”®å–ï¼Œåˆ«æ‹¿åˆ«äººçš„æˆæœå…è´¹å»èµšå–è‡ªå·±çš„åˆ©ç›Šã€‚</p>\n<h2 id=\"2022-06-06\"><a class=\"markdownIt-Anchor\" href=\"#2022-06-06\">#</a> 2022-06-06</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXcuaXFpcS5pby9pbHZqeXcvT3BlbkdHL21hc3Rlci9kb2cuanNvbg==\">https://raw.iqiq.io/ilvjyw/OpenGG/master/dog.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZ2xibGIuY29kaW5nLm5ldC9wL2EvZC9jL2dpdC9yYXcvbWFzdGVyLzUx\">https://pglblb.coding.net/p/a/d/c/git/raw/master/51</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oazEubW9uaWthLmxvdmUvdHZiYS90L21haW4vbQ==\">https://hk1.monika.love/tvba/t/main/m</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" checked=\"true\" disabled=\"true\"><label for=\"cbx_3\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXcuZmFzdGdpdC5vcmcveGxjNTIwL01hb1RWL21haW4vbWFvLzIyMDUwOC5qc29u\">https://raw.fastgit.org/xlc520/MaoTV/main/mao/220508.json</span> (æ¥æº <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3hsYzUyMC9NYW9UVg==\">https://github.com/xlc520/MaoTV</span>)</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L1oyM3NuaDhZ\">https://pastebin.com/raw/Z23snh8Y</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\"><label for=\"cbx_5\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL3B1YnRhcmd1cw==\">http://gg.gg/pubtargus</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" checked=\"true\" disabled=\"true\"><label for=\"cbx_6\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL211amlu\">http://gg.gg/mujin</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" checked=\"true\" disabled=\"true\"><label for=\"cbx_7\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL3hpYW9t\">http://gg.gg/xiaom</span></label></li>\n</ul>\n<h3 id=\"steve-å°æ˜å¤åˆ»åœ°å€\"><a class=\"markdownIt-Anchor\" href=\"#steve-å°æ˜å¤åˆ»åœ°å€\">#</a> Steve - å°æ˜å¤åˆ»åœ°å€</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" checked=\"true\" disabled=\"true\"><label for=\"cbx_8\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96eGZjY21tNC5jb2RpbmcubmV0L3AvbWFvdHYvZC9tYW90di9naXQvcmF3L21hc3Rlci90ZXN0Lmpzb24=\">https://zxfccmm4.coding.net/p/maotv/d/maotv/git/raw/master/test.json</span></label></li>\n</ul>\n<h3 id=\"yangyang1957\"><a class=\"markdownIt-Anchor\" href=\"#yangyang1957\">#</a> yangyang1957</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_9\" checked=\"true\" disabled=\"true\"><label for=\"cbx_9\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96eGZjY21tNC5jb2RpbmcubmV0L3AvbWFvdHYvZC9tYW90di9naXQvcmF3L21hc3Rlci9zdGV2ZS5qc29u\">https://zxfccmm4.coding.net/p/maotv/d/maotv/git/raw/master/steve.json</span></label></li>\n</ul>\n<h3 id=\"green-é…ç½®\"><a class=\"markdownIt-Anchor\" href=\"#green-é…ç½®\">#</a> Green é…ç½®</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_10\" checked=\"true\" disabled=\"true\"><label for=\"cbx_10\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96eGZjY21tNC5jb2RpbmcubmV0L3AvbWFvdHYvZC9tYW90di9naXQvcmF3L21hc3Rlci9ncmVlbi5qc29u\">https://zxfccmm4.coding.net/p/maotv/d/maotv/git/raw/master/green.json</span></label></li>\n</ul>\n<h3 id=\"yellow-é…ç½®\"><a class=\"markdownIt-Anchor\" href=\"#yellow-é…ç½®\">#</a> Yellow é…ç½®</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_11\" checked=\"true\" disabled=\"true\"><label for=\"cbx_11\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96eGZjY21tNC5jb2RpbmcubmV0L3AvbWFvdHYvZC9tYW90di9naXQvcmF3L21hc3Rlci95ZWxsb3cuanNvbiVFNyU5RiVBRCVFOSU5MyVCRQ==\">https://zxfccmm4.coding.net/p/maotv/d/maotv/git/raw/master/yellow.json çŸ­é“¾</span></label></li>\n</ul>\n<h3 id=\"çŒ«ç¾¤æ¥å£\"><a class=\"markdownIt-Anchor\" href=\"#çŒ«ç¾¤æ¥å£\">#</a> çŒ«ç¾¤æ¥å£</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_12\" checked=\"true\" disabled=\"true\"><label for=\"cbx_12\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24veWVsbG93\">https://c1n.cn/yellow</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_13\" checked=\"true\" disabled=\"true\"><label for=\"cbx_13\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL3llbGxvdzc3\">http://gg.gg/yellow77</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_14\" checked=\"true\" disabled=\"true\"><label for=\"cbx_14\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZ2xibGIuY29kaW5nLm5ldC9wL2EvZC9jL2dpdC9yYXcvbWFzdGVyLzUx\">https://pglblb.coding.net/p/a/d/c/git/raw/master/51</span></label></li>\n</ul>\n<h3 id=\"å°æ˜æ¥å£åªå‰©å–µç‹¸ç›˜æœ-æˆæ›²-æ¨é€\"><a class=\"markdownIt-Anchor\" href=\"#å°æ˜æ¥å£åªå‰©å–µç‹¸ç›˜æœ-æˆæ›²-æ¨é€\">#</a> å°æ˜æ¥å£ (åªå‰©å–µç‹¸ç›˜æœ æˆæ›² æ¨é€ï¼‰</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_15\" checked=\"true\" disabled=\"true\"><label for=\"cbx_15\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb2xhbWludC5jb2RpbmcubmV0L3AvY29sYWNhdC9kL0NvbGFDYXQvZ2l0L3Jhdy9tYXN0ZXIvYQ==\">https://colamint.coding.net/p/colacat/d/ColaCat/git/raw/master/a</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_16\" checked=\"true\" disabled=\"true\"><label for=\"cbx_16\"> <span class=\"exturl\" data-url=\"aHR0cDovL3htLmMxbi5jbg==\">http://xm.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_17\" checked=\"true\" disabled=\"true\"><label for=\"cbx_17\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL2NvbGFtaW50\">http://gg.gg/colamint</span></label></li>\n</ul>\n<h3 id=\"é•¿è€æ¥å£\"><a class=\"markdownIt-Anchor\" href=\"#é•¿è€æ¥å£\">#</a> é•¿è€æ¥å£</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_18\" checked=\"true\" disabled=\"true\"><label for=\"cbx_18\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXcubml0ZTA3LmNvbS9uaXRlMDc=\">https://raw.nite07.com/nite07</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_19\" checked=\"true\" disabled=\"true\"><label for=\"cbx_19\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW95cy5jMW4uY24=\">https://maoys.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_20\" checked=\"true\" disabled=\"true\"><label for=\"cbx_20\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3lveW84MjUyMC9odWFpcHR2L21haW4vbWFvLmpzb24=\">https://raw.githubusercontent.com/yoyo82520/huaiptv/main/mao.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_21\" checked=\"true\" disabled=\"true\"><label for=\"cbx_21\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24vbW9hb28=\">https://c1n.cn/moaoo</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_22\" checked=\"true\" disabled=\"true\"><label for=\"cbx_22\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL2hhb21vbw==\">http://gg.gg/haomoo</span></label></li>\n</ul>\n<h3 id=\"å…¶ä»–æ¥å£\"><a class=\"markdownIt-Anchor\" href=\"#å…¶ä»–æ¥å£\">#</a> å…¶ä»–æ¥å£</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_23\" checked=\"true\" disabled=\"true\"><label for=\"cbx_23\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMS5jMW4uY24=\">https://c1.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_24\" checked=\"true\" disabled=\"true\"><label for=\"cbx_24\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMi5jMW4uY24=\">https://c2.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_25\" checked=\"true\" disabled=\"true\"><label for=\"cbx_25\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMy5jMW4uY24=\">https://c3.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_26\" checked=\"true\" disabled=\"true\"><label for=\"cbx_26\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jNC5jMW4uY24=\">https://c4.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_27\" checked=\"true\" disabled=\"true\"><label for=\"cbx_27\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jNS5jMW4uY24=\">https://c5.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_28\" checked=\"true\" disabled=\"true\"><label for=\"cbx_28\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly94bS5jMW4uY24=\">https://xm.c1n.cn</span></label></li>\n</ul>\n<h3 id=\"çŒ«æ¥å£\"><a class=\"markdownIt-Anchor\" href=\"#çŒ«æ¥å£\">#</a> çŒ«æ¥å£:</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_29\" checked=\"true\" disabled=\"true\"><label for=\"cbx_29\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaHV5dWFuLm1pYW9nb25nemkubmV0L3NodXl1YW4vMTY1MzM5NDg2OS5qc29u\">https://shuyuan.miaogongzi.net/shuyuan/1653394869.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_30\" checked=\"true\" disabled=\"true\"><label for=\"cbx_30\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaHV5dWFuLm1pYW9nb25nemkubmV0L3NodXl1YW4vMTY1MzAzMzg3NS50eHQ=\">https://shuyuan.miaogongzi.net/shuyuan/1653033875.txt</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_31\" checked=\"true\" disabled=\"true\"><label for=\"cbx_31\"> <span class=\"exturl\" data-url=\"aHR0cDovL2pzb24ubXlhaXhpeGkuY29tL210di9qay5qc29u\">http://json.myaixixi.com/mtv/jk.json</span></label></li>\n</ul>\n<p>###ã€çŒ«å½±è§† TV æœ€æ–°æ¥å£ã€‘</p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_32\" checked=\"true\" disabled=\"true\"><label for=\"cbx_32\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIyNDI2Ni5qc29u\">https://wds.ecsxs.com/224266.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_33\" checked=\"true\" disabled=\"true\"><label for=\"cbx_33\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMjc1Ny5qc29u\">https://wds.ecsxs.com/212757.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_34\" checked=\"true\" disabled=\"true\"><label for=\"cbx_34\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMjAxMC5qc29u\">https://wds.ecsxs.com/212010.json</span></label></li>\n</ul>\n<p>å»ºè®®ç”¨ä¸Šé¢é•¿é“¾æ¥ï¼ŒçŸ­é“¾æ¥å®¹æ˜“å‡ºé—®é¢˜ï¼</p>\n<h4 id=\"çŸ­è¿æ¥\"><a class=\"markdownIt-Anchor\" href=\"#çŸ­è¿æ¥\">#</a> çŸ­è¿æ¥</h4>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_35\" checked=\"true\" disabled=\"true\"><label for=\"cbx_35\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ta2suYzFuLmNu\">https://mkk.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_36\" checked=\"true\" disabled=\"true\"><label for=\"cbx_36\"> <span class=\"exturl\" data-url=\"aHR0cDovL21hb3lzLmMxbi5jbg==\">http://maoys.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_37\" checked=\"true\" disabled=\"true\"><label for=\"cbx_37\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24uY2F0\">https://c1n.cn.cat</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_38\" checked=\"true\" disabled=\"true\"><label for=\"cbx_38\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9nZy5nZy9jYXQ2NjY=\">https://gg.gg/cat666</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_39\" checked=\"true\" disabled=\"true\"><label for=\"cbx_39\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYXRiNS5jMW4uY24=\">https://catb5.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_40\" checked=\"true\" disabled=\"true\"><label for=\"cbx_40\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL2NjY3Z2dg==\">http://gg.gg/cccvvv</span></label></li>\n</ul>\n<h3 id=\"ç‰¹æ®Š\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹æ®Š\">#</a> ç‰¹æ®Š</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_41\" checked=\"true\" disabled=\"true\"><label for=\"cbx_41\"> <span class=\"exturl\" data-url=\"aHR0cDovL2ZqMzY1Lm1sL20uanNvbg==\">http://fj365.ml/m.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_42\" checked=\"true\" disabled=\"true\"><label for=\"cbx_42\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzg4NC5qc29u\">https://wds.ecsxs.com/213884.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_43\" checked=\"true\" disabled=\"true\"><label for=\"cbx_43\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aGlnZXdlaXd1MTEuY29kaW5nLm5ldC9wL2MvZC9tYW8yL2dpdC9yYXcvbWFpbi9jb25mLmpzb24=\">https://zhigeweiwu11.coding.net/p/c/d/mao2/git/raw/main/conf.json</span></label></li>\n</ul>\n<h3 id=\"ç¾¤èµ„æº\"><a class=\"markdownIt-Anchor\" href=\"#ç¾¤èµ„æº\">#</a> ç¾¤èµ„æº</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_44\" checked=\"true\" disabled=\"true\"><label for=\"cbx_44\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzgyMS5qc29u\">https://wds.ecsxs.com/213821.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_45\" checked=\"true\" disabled=\"true\"><label for=\"cbx_45\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzY3OS5qc29u\">https://wds.ecsxs.com/213679.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_46\" checked=\"true\" disabled=\"true\"><label for=\"cbx_46\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzAxMy5qc29u\">https://wds.ecsxs.com/213013.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_47\" checked=\"true\" disabled=\"true\"><label for=\"cbx_47\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxNjUzNy5qc29u\">https://wds.ecsxs.com/216537.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_48\" checked=\"true\" disabled=\"true\"><label for=\"cbx_48\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzc2Ni50eHQ=\">https://wds.ecsxs.com/213766.txt</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_49\" checked=\"true\" disabled=\"true\"><label for=\"cbx_49\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzMxMy5qc29u\">https://wds.ecsxs.com/213313.json</span></label></li>\n</ul>\n<h3 id=\"å…¶ä»–æ¥å£æº\"><a class=\"markdownIt-Anchor\" href=\"#å…¶ä»–æ¥å£æº\">#</a> å…¶ä»–æ¥å£æº</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_50\" checked=\"true\" disabled=\"true\"><label for=\"cbx_50\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24vMg==\">https://c1n.cn/2</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_51\" checked=\"true\" disabled=\"true\"><label for=\"cbx_51\"> <span class=\"exturl\" data-url=\"aHR0cDovL2Mxbi5jbi9tYW8=\">http://c1n.cn/mao</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_52\" checked=\"true\" disabled=\"true\"><label for=\"cbx_52\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL2NjY3Z2dg==\">http://gg.gg/cccvvv</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_53\" checked=\"true\" disabled=\"true\"><label for=\"cbx_53\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL21hb3R2MTA=\">http://gg.gg/maotv10</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_54\" checked=\"true\" disabled=\"true\"><label for=\"cbx_54\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL21hb3R2Mjg=\">http://gg.gg/maotv28</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_55\" checked=\"true\" disabled=\"true\"><label for=\"cbx_55\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW95cy5jMW4uY24=\">https://maoys.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_56\" checked=\"true\" disabled=\"true\"><label for=\"cbx_56\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW90di5jMW4uY24=\">https://maotv.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_57\" checked=\"true\" disabled=\"true\"><label for=\"cbx_57\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMjc1Ny5qc29u\">https://wds.ecsxs.com/212757.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_58\" checked=\"true\" disabled=\"true\"><label for=\"cbx_58\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzgyMS5qc29u\">https://wds.ecsxs.com/213821.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_59\" checked=\"true\" disabled=\"true\"><label for=\"cbx_59\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzY3OS5qc29u\">https://wds.ecsxs.com/213679.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_60\" checked=\"true\" disabled=\"true\"><label for=\"cbx_60\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzc2Ni50eHQ=\">https://wds.ecsxs.com/213766.txt</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_61\" checked=\"true\" disabled=\"true\"><label for=\"cbx_61\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzAxMy5qc29u\">https://wds.ecsxs.com/213013.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_62\" checked=\"true\" disabled=\"true\"><label for=\"cbx_62\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L0dHNTF5MEpH\">https://pastebin.com/raw/GG51y0JG</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_63\" checked=\"true\" disabled=\"true\"><label for=\"cbx_63\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMjAxMC5qc29u\">https://wds.ecsxs.com/212010.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_64\" checked=\"true\" disabled=\"true\"><label for=\"cbx_64\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxMzMxMy5qc29u\">https://wds.ecsxs.com/213313.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_65\" checked=\"true\" disabled=\"true\"><label for=\"cbx_65\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxNjUzNy5qc29u\">https://wds.ecsxs.com/216537.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_66\" checked=\"true\" disabled=\"true\"><label for=\"cbx_66\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIxNjczMS5qc29u\">https://wds.ecsxs.com/216731.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_67\" checked=\"true\" disabled=\"true\"><label for=\"cbx_67\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L0Z1TXNmSld3\">https://pastebin.com/raw/FuMsfJWw</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_68\" checked=\"true\" disabled=\"true\"><label for=\"cbx_68\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L0tHUmR1QnFh\">https://pastebin.com/raw/KGRduBqa</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_69\" checked=\"true\" disabled=\"true\"><label for=\"cbx_69\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L3lNTnEyNk5E\">https://pastebin.com/raw/yMNq26ND</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_70\" checked=\"true\" disabled=\"true\"><label for=\"cbx_70\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZHMuZWNzeHMuY29tLzIyMDkxMi5qc29u\">https://wds.ecsxs.com/220912.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_71\" checked=\"true\" disabled=\"true\"><label for=\"cbx_71\"> <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5uaWhhb2dlZ2UuY29tL2NhdC95bC5qcw==\">http://www.nihaogege.com/cat/yl.js</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_72\" checked=\"true\" disabled=\"true\"><label for=\"cbx_72\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29sLndvdGlhbm5hLmNvbS9teXNqay5qc29u\">https://tool.wotianna.com/mysjk.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_73\" checked=\"true\" disabled=\"true\"><label for=\"cbx_73\"> <span class=\"exturl\" data-url=\"aHR0cDovL3BnbGJsYi50ZXN0LnVwY2RuLm5ldC9tYW8uanNvbg==\">http://pglblb.test.upcdn.net/mao.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_74\" checked=\"true\" disabled=\"true\"><label for=\"cbx_74\"> <span class=\"exturl\" data-url=\"aHR0cDovL3BnbGJsYi50ZXN0LnVwY2RuLm5ldC8yMDIyMDIxNi5qc29u\">http://pglblb.test.upcdn.net/20220216.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_75\" checked=\"true\" disabled=\"true\"><label for=\"cbx_75\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly90dmFwcC5ndWlsYWlsZS5jbi93cC1jb250ZW50L3VwbG9hZHMvMjAyMS8wOC9kc2h6amsudHh0\">https://tvapp.guilaile.cn/wp-content/uploads/2021/08/dshzjk.txt</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_76\" checked=\"true\" disabled=\"true\"><label for=\"cbx_76\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb2RlYmVyZy5vcmcvYXR0YWNobWVudHMvMzZlNzUwY2MtZTdiMC00YTE5LWE5ODUtMjJmZmNlMTY0YTJi\">https://codeberg.org/attachments/36e750cc-e7b0-4a19-a985-22ffce164a2b</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_77\" checked=\"true\" disabled=\"true\"><label for=\"cbx_77\"> <span class=\"exturl\" data-url=\"aHR0cDovLzExOC4xOTAuMjQ0LjE5NS9nZW5nZHVveml5dWFuc291d2VpeGluZ29uZ3pob25naGFvYmt0eDEyMy8wMjI2Lmpzb24=\">http://118.190.244.195/gengduoziyuansouweixingongzhonghaobktx123/0226.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_78\" checked=\"true\" disabled=\"true\"><label for=\"cbx_78\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tby14aWFvLmNvZGluZy5uZXQvcC9jL2QvYy9naXQvcmF3L21hc3Rlci9tYW95cy5qc29uP2Rvd25sb2FkPWZhbHNl\">https://mo-xiao.coding.net/p/c/d/c/git/raw/master/maoys.json?download=false</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_79\" checked=\"true\" disabled=\"true\"><label for=\"cbx_79\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vd3l5MDA3Y24vdHYvcmF3L21hc3Rlci90djEuanNvbg==\">https://gitee.com/wyy007cn/tv/raw/master/tv1.json</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_80\" checked=\"true\" disabled=\"true\"><label for=\"cbx_80\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24vY2F0\">https://c1n.cn/cat</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_81\" checked=\"true\" disabled=\"true\"><label for=\"cbx_81\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24vbWFv\">https://c1n.cn/mao</span></label></li>\n</ul>\n<h2 id=\"2022-06-05\"><a class=\"markdownIt-Anchor\" href=\"#2022-06-05\">#</a> 2022-06-05</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_82\" checked=\"true\" disabled=\"true\"><label for=\"cbx_82\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L3RXaGZrSG5r\">https://pastebin.com/raw/tWhfkHnk</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_83\" checked=\"true\" disabled=\"true\"><label for=\"cbx_83\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXcuaXFpcS5pby9haXJ3b29vL210L21haW4vTWEvbTIudHh0\">https://raw.iqiq.io/airwooo/mt/main/Ma/m2.txt</span></label></li>\n</ul>\n<h2 id=\"2022-04-15\"><a class=\"markdownIt-Anchor\" href=\"#2022-04-15\">#</a> 2022-04-15</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_84\" checked=\"true\" disabled=\"true\"><label for=\"cbx_84\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tYW90di5jMW4uY24=\">https://maotv.c1n.cn</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_85\" checked=\"true\" disabled=\"true\"><label for=\"cbx_85\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24vMg==\">https://c1n.cn/2</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_86\" checked=\"true\" disabled=\"true\"><label for=\"cbx_86\"> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jMW4uY24vbWFv\">https://c1n.cn/mao</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_87\" checked=\"true\" disabled=\"true\"><label for=\"cbx_87\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL21hb3R2Mjg=\">http://gg.gg/maotv28</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_88\" checked=\"true\" disabled=\"true\"><label for=\"cbx_88\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL2NjY3Z2dg==\">http://gg.gg/cccvvv</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_89\" checked=\"true\" disabled=\"true\"><label for=\"cbx_89\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL21hb3R2MTA=\">http://gg.gg/maotv10</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_90\" checked=\"true\" disabled=\"true\"><label for=\"cbx_90\"> <span class=\"exturl\" data-url=\"aHR0cDovL2dnLmdnL2Fqa3dhbg==\">http://gg.gg/ajkwan</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_91\" checked=\"true\" disabled=\"true\"><label for=\"cbx_91\"> <span class=\"exturl\" data-url=\"aHR0cDovL2Mxbi5jbi9jYXQ=\">http://c1n.cn/cat</span></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_92\" checked=\"true\" disabled=\"true\"><label for=\"cbx_92\"> <span class=\"exturl\" data-url=\"aHR0cDovL21hb3lzLmMxbi5jbg==\">http://maoys.c1n.cn</span></label></li>\n</ul>\n<h2 id=\"æ›´æ—©\"><a class=\"markdownIt-Anchor\" href=\"#æ›´æ—©\">#</a> æ›´æ—©</h2>\n",
            "tags": [
                "çŒ«å½±è§†"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/05/16/rocketMQ/3-02-reliabllity-msg/",
            "url": "https://fangjiaxiaobai.github.io/2022/05/16/rocketMQ/3-02-reliabllity-msg/",
            "title": "RocketMQ æ¶ˆæ¯å¯é æ€§å®ç°åŸç†",
            "date_published": "2022-05-16T10:18:00.000Z",
            "content_html": "<p>å¸¸ç”¨çš„ç»å¤§å¤šæ•°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚  <code>RocketMQ</code> ã€ <code>RabbitMQ</code>  ç­‰åœ¨æ¶ˆæ¯ä¼ è¾“ä¸Šéƒ½åªèƒ½ä¿è¯<b>è‡³å°‘ä¼ è¾“æˆåŠŸä¸€æ¬¡ ( <code>At least once</code> )</b>, ä½†æ˜¯<b>ä¸èƒ½ä¿è¯åªä¼ è¾“æˆåŠŸä¸€æ¬¡ ( <code>Exactly once</code> )</b>, é‡å¤å‘é€.</p>\n<h2 id=\"ç”Ÿäº§è€…ä¿è¯æ¶ˆæ¯å¯é æ€§\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…ä¿è¯æ¶ˆæ¯å¯é æ€§\">#</a> ç”Ÿäº§è€…ä¿è¯æ¶ˆæ¯å¯é æ€§</h2>\n<h3 id=\"æ¶ˆæ¯å‘é€æ–¹å¼\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯å‘é€æ–¹å¼\">#</a> æ¶ˆæ¯å‘é€æ–¹å¼</h3>\n<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href=\"./2-02-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E6%B6%88%E6%81%AF.md\">æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯</a> ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº† ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯æœ‰ä¸‰ç§æ–¹å¼:</p>\n<ul>\n<li>åŒæ­¥å‘é€ã€‚ å‘é€çº¿ç¨‹åŒæ­¥ç­‰å¾…ï¼Œé€šè¿‡åŒæ­¥æ£€æŸ¥ <code>Brocker</code>  è¿”å›çš„çŠ¶æ€æ¥åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–æˆåŠŸã€‚ä»è€Œä¿è¯æ¶ˆæ¯çš„å¯é æ€§.</li>\n<li>å¼‚æ­¥å‘é€ã€‚ å‘é€çº¿ç¨‹å¼‚æ­¥ç­‰å¾…ï¼Œå¯ä»¥é€šè¿‡ä¼ å…¥çš„å›è°ƒå‡½æ•°æ¥åˆ¤æ–­æ¶ˆæ¯æŒä¹…åŒ–çŠ¶æ€ã€‚æ ¹æ®çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¯•æ¶ˆæ¯ï¼Œä»è€Œä¿è¯æ¶ˆæ¯çš„å¯é æ€§.</li>\n<li><code>one way</code>  æ–¹å¼ã€‚ è¿™ç§æ–¹å¼ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ã€‚å‘é€ç«¯å‘é€å®Œæˆä¹‹åï¼Œè°ƒç”¨è¯¥å‘é€æ¥å£åç«‹åˆ»è¿”å›ï¼Œå¹¶ä¸è¿”å›å‘é€çš„ç»“æœã€‚</li>\n</ul>\n<p>é™¤äº†åŒæ­¥å‘é€å’Œå¼‚æ­¥å‘é€è¿™ä¸¤ç§æ–¹å¼æ¥ä¿è¯æ¶ˆæ¯å¯é æ€§ä¹‹å¤–.</p>\n<h3 id=\"é‡è¯•æœºåˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#é‡è¯•æœºåˆ¶\">#</a> é‡è¯•æœºåˆ¶</h3>\n<p>åœ¨å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œ <code>Producer</code>  è¿˜æœ‰ æ¶ˆæ¯å‘é€çš„é‡è¯•æœºåˆ¶æ¥<b>æé«˜æ¶ˆæ¯çš„å¯é æ€§</b>.</p>\n<p>å¦‚æœ broker åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ broker å®•æœºäº†ï¼Œå³ä½¿ producer æœ‰é‡è¯•æœºåˆ¶ï¼Œä¹Ÿæ²¡ç”¨ï¼Œå› æ­¤åˆ©ç”¨å¤šä¸»æ¨¡å¼ï¼Œå½“æŸå° broker å®•æœºäº†ï¼Œæ¢ä¸€å° broker è¿›è¡ŒæŠ•é€’ã€‚</p>\n<p>å½“å‘é€ç«¯éœ€è¦å‘é€æ¶ˆæ¯æ—¶ï¼Œå¦‚æœå‘é€ç«¯ä¸­ç¼“å­˜äº† <code>topic</code>  çš„è·¯ç”±ä¿¡æ¯ï¼Œå¹¶åŒ…å«äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥è·¯ç”±ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç¼“å­˜æˆ–æ²¡æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåˆ™å‘ <code>NameServer</code>  æŸ¥è¯¢è¯¥ <code>topic</code>  çš„è·¯ç”±ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°è·¯ç”±æ¶ˆæ¯ä¹‹åï¼Œé‡‡ç”¨æŒ‡å®šçš„é˜Ÿåˆ—é€‰æ‹©ç­–ç•¥é€‰æ‹©ç›¸åº”çš„ <code>queue</code>  å‘é€æ¶ˆæ¯ï¼Œé»˜è®¤æ˜¯é‡‡ç”¨è½®è¯¢ç­–ç•¥ï¼Œå‘é€æˆåŠŸåˆ™è¿”å›ï¼Œæ”¶åˆ°å¼‚å¸¸åˆ™æ ¹æ®ç›¸åº”çš„ç­–ç•¥è¿›è¡Œé‡è¯•ï¼Œå¯ä»¥æ ¹æ®å‘é€ç«¯æ„ŸçŸ¥åˆ°çš„ <code>Broker</code>  çš„æ—¶å»¶ã€ä¸Šæ¬¡å‘é€å¤±è´¥çš„ <code>Broker</code>  ä¿¡æ¯å’Œå‘é€ç«¯é…ç½®çš„æ˜¯å¦é‡è¯•ä¸åŒ <code>Broker</code>  çš„å‚æ•°ä»¥åŠå‘é€ç«¯è®¾ç½®çš„æœ€å¤§è¶…æ—¶æ—¶é—´ç­‰ç­‰ç­–ç•¥æ¥çµæ´»åœ°å®ç°ä¸åŒç­‰çº§çš„æ¶ˆæ¯å‘é€å¯é æ€§ä¿è¯ã€‚é‡è¯•ç­–ç•¥å¯ä»¥æœ‰æ•ˆçš„ä¿è¯æ¶ˆæ¯å‘é€æˆåŠŸçš„æ¦‚ç‡ï¼Œæœ€ç»ˆæé«˜æ¶ˆæ¯å‘é€çš„å¯é æ€§ã€‚</p>\n<p>æ€»ç»“ä¸¤ç‚¹:</p>\n<ul>\n<li><code>Producer</code>  é€‰æ‹©ä¸€ä¸ª  <code>MessageQueue</code>  å‘é€æ¶ˆæ¯æ—¶ã€‚é»˜è®¤è½®è¯¢æ–¹å¼é€‰æ‹© <code>MessageQueue</code> ï¼Œ å¦‚æœå¯ç”¨  <code>Broker</code>  ç«¯çš„æ•…éšœå»¶è¿Ÿæœºåˆ¶ï¼Œåˆ™ä¼šåˆ¤æ–­  <code>MessageQueue</code>  çš„ <code>Broker</code>  æ˜¯å¦å¯ç”¨ï¼Œæ‰å‘é€æ¶ˆæ¯åˆ°è¯¥  <code>Message</code>  ä¸­ã€‚</li>\n<li><code>Producer</code>  åœ¨ä½¿ç”¨ Sync æ–¹å¼å‘é€æ¶ˆæ¯æ—¶ä¼šé‡æ–° <code>N</code>  æ¬¡ï¼Œ  <code>N</code>  å¯ç”±  <code>Producer</code>  ç«¯çš„é…ç½®å†³å®šçš„ã€‚</li>\n</ul>\n<h3 id=\"å‘é€æ¶ˆæ¯çš„è¿”å›çŠ¶æ€\"><a class=\"markdownIt-Anchor\" href=\"#å‘é€æ¶ˆæ¯çš„è¿”å›çŠ¶æ€\">#</a> å‘é€æ¶ˆæ¯çš„è¿”å›çŠ¶æ€</h3>\n<p>è¿™é‡Œå†è¡¥å……ä¸€ç‚¹ï¼Œ åŒæ­¥æ–¹å¼å‘é€æˆåŠŸï¼Œå‘é€çš„çŠ¶æ€æ˜¯ç”±  <code>SendStatus</code>  è¿™ä¸ªæšä¸¾ç±»å†³å®šçš„.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">SendStatus</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å‘é€æˆåŠŸ</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    SEND_OK,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ·ç›˜è¶…æ—¶</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    FLUSH_DISK_TIMEOUT,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åŒæ­¥ä»èŠ‚ç‚¹è¶…æ—¶</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    FLUSH_SLAVE_TIMEOUT,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä»èŠ‚ç‚¹ ä¸å¯ç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    SLAVE_NOT_AVAILABLE,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>SEND_OK</code> : è¡¨ç¤ºæ¶ˆæ¯å‘é€æˆåŠŸã€‚ä½†æ˜¯è¿™ä¸ªå¹¶ä¸ä»£è¡¨å®ƒæ˜¯å¯é çš„ã€‚ è¦ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œè¿˜éœ€è¦å¯åŠ¨åŒæ­¥  <code>Master</code>  æœåŠ¡å™¨ æˆ–è€…åŒæ­¥åˆ·ç›˜ï¼Œ å³  <code>SYNC_MASTER</code>  å’Œ  <code>SYNC_FLUSH</code></li>\n<li><code>FLUSH_DISK_TIMEOUT</code> : æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†æ˜¯åˆ·ç›˜è¶…æ—¶ã€‚ æ­¤æ—¶æ¶ˆæ¯å·²ç»è¿›å»äº†å†…å­˜ ( <code>MessageQueue</code> ) ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰æœåŠ¡å™¨å®•æœºï¼Œæ¶ˆæ¯æ‰ä¼šä¸¢å¤±ã€‚</li>\n<li><code>FLUSH_SLAVE_TIMEOUT</code> : æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†æ˜¯åŒæ­¥åˆ°  <code>SLAVE</code>  æ—¶è¶…æ—¶ã€‚åŒæ ·çš„ã€‚æ­¤æ—¶æ¶ˆæ¯å·²ç»è¿›å»äº†å†…å­˜ ( <code>MessageQueue</code> ) ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰æœåŠ¡å™¨å®•æœºï¼Œæ¶ˆæ¯æ‰ä¼šä¸¢å¤±ã€‚</li>\n<li><code>SLAVE_NOT_AVAILABLE</code> : æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰  <code>SLAVE</code>  æœºå™¨å¯ç”¨ã€‚</li>\n</ul>\n<p><code>FLUSH_DISK_TIMEOUT</code> ,  <code>FLUSH_SLAVE_TIMEOUT</code> ,  <code>SLAVE_NOT_AVAILABLE</code>  éƒ½æ˜¯ <code>Broker</code>  ç«¯å¼‚å¸¸å¯¼è‡´çš„ä¸æ­£å¸¸çš„æƒ…å†µã€‚</p>\n<h2 id=\"brokerçš„æ¶ˆæ¯å¯é æ€§\"><a class=\"markdownIt-Anchor\" href=\"#brokerçš„æ¶ˆæ¯å¯é æ€§\">#</a> Broker çš„æ¶ˆæ¯å¯é æ€§</h2>\n<p>æˆ‘ä»¬çŸ¥é“äº† å½“æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå†™å…¥äº†  <code>MessageQueue</code>  ä½†æ˜¯æ²¡æœ‰æŒä¹…åˆ°ç£ç›˜ä¸Šçš„æ—¶å€™ï¼Œå°±ä¼šé€ æˆæ¶ˆæ¯çš„ä¸¢å¤±ã€‚<br>\nåœ¨ å®˜æ–¹çš„æ–‡æ¡£ä¸­ï¼Œ æåŠåˆ°äº† äº”ç§å› ä¸º <code>Broker</code>  ç«¯å¼‚å¸¸å¯¼è‡´çš„æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±çš„æƒ…å†µ:</p>\n<ul>\n<li><code>Broker</code>  éæ­£å¸¸å…³é—­</li>\n<li><code>Broker</code>  å¼‚å¸¸ <code>Crash</code></li>\n<li><code>OS Crash</code></li>\n<li>æœºå™¨æ‰ç”µï¼Œä½†æ˜¯èƒ½ç«‹å³æ¢å¤ä¾›ç”µæƒ…å†µ</li>\n<li>æœºå™¨æ— æ³•å¼€æœºï¼ˆå¯èƒ½æ˜¯ <code>cpu</code> ã€ä¸»æ¿ã€å†…å­˜ç­‰å…³é”®è®¾å¤‡æŸåï¼‰</li>\n<li>ç£ç›˜è®¾å¤‡æŸå</li>\n</ul>\n<p>å…¶ä¸­  <code>1-4</code>  å±äºç¡¬ä»¶èµ„æºå¯ç«‹å³æ¢å¤æƒ…å†µï¼Œ <code>RocketMQ</code>  åœ¨è¿™å››ç§æƒ…å†µä¸‹èƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢ (åŒæ­¥åˆ·ç›˜)ï¼Œæˆ–è€…ä¸¢å¤±å°‘é‡æ•°æ®ï¼ˆå¼‚æ­¥åˆ·ç›˜ï¼‰ã€‚<br>\n <code>5-6</code>  å±äºå•ç‚¹æ•…éšœï¼Œä¸”æ— æ³•æ¢å¤ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œåœ¨æ­¤å•ç‚¹ä¸Šçš„æ¶ˆæ¯å…¨éƒ¨ä¸¢å¤±ã€‚ <code>RocketMQ</code>  åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡å¼‚æ­¥å¤åˆ¶ï¼Œå¯ä¿è¯ <code>99%</code>  çš„æ¶ˆæ¯ä¸ä¸¢ï¼Œä½†æ˜¯ä»ç„¶ä¼šæœ‰æå°‘é‡çš„æ¶ˆæ¯å¯èƒ½ä¸¢å¤±ã€‚é€šè¿‡åŒæ­¥åŒå†™æŠ€æœ¯å¯ä»¥å®Œå…¨é¿å…å•ç‚¹ï¼ŒåŒæ­¥åŒå†™åŠ¿å¿…ä¼šå½±å“æ€§èƒ½ï¼Œé€‚åˆå¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚æé«˜çš„åœºåˆï¼Œä¾‹å¦‚ä¸ Money ç›¸å…³çš„åº”ç”¨ã€‚æ³¨ï¼š <code>RocketMQ</code>  ä» <code>3.0</code>  ç‰ˆæœ¬å¼€å§‹æ”¯æŒåŒæ­¥åŒå†™ã€‚</p>\n<p>å¯ä»¥çœ‹å‡º Broker ç«¯çš„æ¶ˆæ¯å¯é æ€§ä¸»è¦é€šè¿‡ <b>å•æœºæƒ…å†µä¸‹çš„åˆ·ç›˜ç­–ç•¥</b> å’Œ <b>ä¸»ä»ä¹‹é—´æ•°æ®å¤åˆ¶</b> æ¥ä¿è¯çš„ã€‚</p>\n<h3 id=\"åˆ·ç›˜ç­–ç•¥\"><a class=\"markdownIt-Anchor\" href=\"#åˆ·ç›˜ç­–ç•¥\">#</a> åˆ·ç›˜ç­–ç•¥</h3>\n<p>åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ä¼šä» Producer å‘é€ç»™  <code>Broker</code>  ï¼Œ  <code>Broker</code>  ç«¯æŠŠæ¶ˆæ¯å­˜å‚¨åˆ°  <code>MessageQueue</code>  ä¸­ï¼Œä¹Ÿå°±æ˜¯ å†…å­˜ä¸­ï¼Œ åœ¨  <code>RocketMQ</code>  çš„æºç é‡Œæ‰èƒ½å‡ºæ¶ˆæ¯å†…å®¹çš„ç»“æ„æ˜¯  <code>MappedFile</code>  , ç„¶åé€šè¿‡ åˆ·ç›˜æœºåˆ¶ (åŒæ­¥åˆ·ç›˜ï¼Œå¼‚æ­¥åˆ·ç›˜) å†™å…¥åˆ°ç‰©ç†ç£ç›˜ä¸Šã€‚å®Œæˆæ¶ˆæ¯çš„æŒä¹…åŒ–ã€‚</p>\n<p><img data-src=\"./images/3-03-01.png\" alt=\"\"></p>\n<p>åœ¨æºç ä¸­ åˆ·ç›˜çš„çº¿ç¨‹ ç”±  <code>FlushCommitLogService</code>  ç±»è¡¨ç¤ºã€‚ è¿™ä¸ªç±»æœ‰ä¸‰ä¸ªå­ç±»:</p>\n<ul>\n<li><code>FlushRealTimeService</code> : å½“é…ç½®ä¸ºå¼‚æ­¥åˆ·ç›˜ç­–ç•¥ å¹¶ä¸”æ²¡æœ‰å¼€å¯  <code>TransientStorePool</code>  çš„æ—¶å€™ï¼Œ  <code>Broker</code>  ä¼šè¿è¡Œä¸€ä¸ªæœåŠ¡  <code>FlushRealTimeService</code>  ç”¨æ¥åˆ·æ–°ç¼“å†²åŒºçš„æ¶ˆæ¯å†…å®¹åˆ°ç£ç›˜ï¼Œè¿™ä¸ªæœåŠ¡ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥åšåˆ·ç›˜è¿™ä»¶äº‹æƒ…ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯éš”  <code>500ms</code>  æ¥æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦åˆ·ç›˜ã€‚</li>\n<li><code>CommitRealTimeService</code> : å¼‚æ­¥åˆ·ç›˜ä¸”å¼€å¯  <code>TransientStorePool</code>  ï¼Œä½¿ç”¨  <code>CommitRealService</code>  ã€‚</li>\n<li><code>GroupCommitService</code> : åŒæ­¥åˆ·ç›˜ä½¿ç”¨  <code>GroupCommitService</code>  .</li>\n</ul>\n<blockquote>\n<p><code>TransientStorePool</code>  æ˜¯çŸ­æš‚çš„æ¶ˆæ¯å­˜å‚¨æ± ã€‚è¿™é‡Œç›´æ¥å¼€è¾Ÿé»˜è®¤ <code>5</code>  ä¸ª <code>1G</code>  çš„ç›´æ¥å†…å­˜ <code>ByteBuffer</code> ï¼Œç”¨æ¥ä¸´æ—¶å­˜å‚¨æ¶ˆæ¯ã€‚å®ƒè¿˜å¼•å…¥äº†å†…å­˜é”çš„æœºåˆ¶ï¼Œé¿å…ç›´æ¥å†…å­˜çš„æ•°æ®è¢«æ›¿æ¢åˆ°ç³»ç»Ÿä¸­çš„ <code>Swap</code>  åˆ†åŒºä¸­ï¼Œæé«˜ç³»ç»Ÿå­˜å‚¨æ€§èƒ½ï¼Œä½¿ <code>RocketMQ</code>  æ¶ˆæ¯ä½å»¶è¿Ÿã€é«˜ååé‡ã€‚</p>\n</blockquote>\n<h4 id=\"åŒæ­¥åˆ·ç›˜\"><a class=\"markdownIt-Anchor\" href=\"#åŒæ­¥åˆ·ç›˜\">#</a> åŒæ­¥åˆ·ç›˜</h4>\n<p><code>RocketMQ</code>  ä½¿ç”¨  <code>GroupCommitService</code>  è¿™ä¸ªå¯¹è±¡æ¥å®ç° åŒæ­¥åˆ·ç›˜ã€‚</p>\n<p>æ¶ˆæ¯å†™å…¥å†…å­˜çš„  <code>PageCache</code>  åï¼Œç«‹åˆ»é€šçŸ¥åˆ·ç›˜çº¿ç¨‹åˆ·ç›˜ï¼Œç„¶åç­‰å¾…åˆ·ç›˜å®Œæˆï¼Œåˆ·ç›˜çº¿ç¨‹æ‰§è¡Œå®Œæˆåå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¿”å›æ¶ˆæ¯å†™æˆåŠŸçš„çŠ¶æ€ã€‚è¿™ç§æ–¹å¼å¯ä»¥ä¿è¯æ•°æ®ç»å¯¹å®‰å…¨ï¼Œä½†æ˜¯ååé‡ä¸å¤§ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// Broker ä¸å…³é—­æ—¶ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// ç­‰å¾… 10 æ¯«ç§’</span></span><br><span class=\"line\">          <span class=\"keyword\">this</span>.waitForRunning(<span class=\"number\">10</span>);</span><br><span class=\"line\">          <span class=\"comment\">// æ‰§è¡Œä¸€æ¬¡åˆ·ç›˜</span></span><br><span class=\"line\">          <span class=\"keyword\">this</span>.doCommit();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">          CommitLog.log.warn(<span class=\"keyword\">this</span>.getServiceName() + <span class=\"string\">&quot; service has exception. &quot;</span>, e);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// æ­£å¸¸æƒ…å†µä¸‹shutdownï¼Œç­‰å¾…10ms è¯·æ±‚åˆ°æ¥ï¼Œç„¶åflushåˆ°ç£ç›˜ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">      CommitLog.log.warn(<span class=\"string\">&quot;GroupCommitService Exception, &quot;</span>, e);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.swapRequests();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.doCommit();</span><br><span class=\"line\"></span><br><span class=\"line\">  CommitLog.log.info(<span class=\"keyword\">this</span>.getServiceName() + <span class=\"string\">&quot; service end&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»ä»£ç ä¸­çœ‹å‡ºï¼Œå½“ <code>Broker</code>  æ­£å¸¸å…³é—­çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç­‰å¾… <code>10ms</code>  çš„ï¼Œç­‰å¾…è¿™ <code>10ms</code>  å†…çš„è¯·æ±‚ã€‚ å¤„ç†å®Œè¯·æ±‚ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šæ‰ä¼šå…³é—­çº¿ç¨‹ã€‚ ç»†èŠ‚æ»¡æ»¡ã€‚</p>\n<h4 id=\"å¼‚æ­¥åˆ·ç›˜\"><a class=\"markdownIt-Anchor\" href=\"#å¼‚æ­¥åˆ·ç›˜\">#</a> å¼‚æ­¥åˆ·ç›˜</h4>\n<p>æ¶ˆæ¯å†™å…¥åˆ°å†…å­˜çš„  <code>PageCache</code>  ä¸­ï¼Œå°±ç«‹åˆ»ç»™å®¢æˆ·ç«¯è¿”å›å†™æ“ä½œæˆåŠŸï¼Œå½“  <code>PageCache</code>  ä¸­çš„æ¶ˆæ¯ç§¯ç´¯åˆ°ä¸€å®šçš„é‡æ—¶ï¼Œè§¦å‘ä¸€æ¬¡å†™æ“ä½œï¼Œæˆ–è€…å®šæ—¶ç­‰ç­–ç•¥å°†  <code>PageCache</code>  ä¸­çš„æ¶ˆæ¯å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚è¿™ç§æ–¹å¼ååé‡å¤§ï¼Œæ€§èƒ½é«˜ï¼Œä½†æ˜¯  <code>PageCache</code>  ä¸­çš„æ•°æ®å¯èƒ½ä¸¢å¤±ï¼Œä¸èƒ½ä¿è¯æ•°æ®ç»å¯¹çš„å®‰å…¨ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// çœç•¥éƒ¨åˆ†ä»£ç ...</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// flushCommitLogTimed æ˜¯å¦å®šæ—¶åˆ·æ–°</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (flushCommitLogTimed) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// intervalä¸ºé…ç½®çš„æ˜¯å•Šé‡‘</span></span><br><span class=\"line\">                Thread.sleep(interval);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.waitForRunning(interval);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\">            <span class=\"comment\">// åˆ·ç›˜ã€ flushPhysicQueueLeastPages  æ¯æ¬¡åˆ·æ–°çš„é¡µæ•°ã€‚</span></span><br><span class=\"line\">            CommitLog.<span class=\"keyword\">this</span>.mappedFileQueue.flush(flushPhysicQueueLeastPages);</span><br><span class=\"line\">            <span class=\"keyword\">long</span> storeTimestamp = CommitLog.<span class=\"keyword\">this</span>.mappedFileQueue.getStoreTimestamp();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (storeTimestamp &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// è®¾ç½®æ£€æŸ¥ç‚¹</span></span><br><span class=\"line\">                CommitLog.<span class=\"keyword\">this</span>.defaultMessageStore.getStoreCheckpoint().setPhysicMsgTimestamp(storeTimestamp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">            CommitLog.log.warn(<span class=\"keyword\">this</span>.getServiceName() + <span class=\"string\">&quot; service has exception. &quot;</span>, e);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.printFlushProgress();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ­£å¸¸å…³é—­æ—¶ï¼Œä¿è¯åœ¨é€€å‡ºä¹‹å‰å…¨éƒ¨åˆ·æ–°åˆ°ç£ç›˜</span></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> result = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; RETRY_TIMES_OVER &amp;&amp; !result; i++) &#123;</span><br><span class=\"line\">        result = CommitLog.<span class=\"keyword\">this</span>.mappedFileQueue.flush(<span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä¸»ä»åŒæ­¥\"><a class=\"markdownIt-Anchor\" href=\"#ä¸»ä»åŒæ­¥\">#</a> ä¸»ä»åŒæ­¥</h3>\n<p>åœ¨é›†ç¾¤ç¯å¢ƒä¸­ï¼Œ å¦‚æœä¸€ä¸ª  <code>Broker</code>  æœ‰  <code>master</code>  å’Œ  <code>slave</code>  æ—¶ï¼Œå°±éœ€è¦å°†  <code>master</code>  ä¸Šçš„æ¶ˆæ¯å¤åˆ¶åˆ°  <code>slave</code>  ä¸Šï¼Œå¤åˆ¶çš„æ–¹å¼æœ‰ä¸¤ç§:</p>\n<ul>\n<li>åŒæ­¥å¤åˆ¶:  <code>master</code>  å’Œ  <code>slave</code>  å‡å†™æˆåŠŸï¼Œæ‰è¿”å›å®¢æˆ·ç«¯æˆåŠŸã€‚  <code>master</code>  æŒ‚äº†ä»¥åå¯ä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚ä½†æ˜¯æ•°æ®åŒæ­¥å¤åˆ¶ä¼šå¢åŠ æ•°æ®å»¶è¿Ÿé£é™©ï¼Œé™ä½ååé‡ã€‚ç®€å•è¯´ä¸€ä¸‹ï¼ŒåŒæ­¥å¤åˆ¶å…¶å®æ˜¯ åœ¨ CommitLog å°†æ¶ˆæ¯ åˆ·ç›˜ä¹‹åï¼ŒåŒæ­¥çš„æ–¹å¼å°†æ¶ˆæ¯åŒæ­¥ç»™  <code>Slave</code>  èŠ‚ç‚¹.</li>\n<li>å¼‚æ­¥å¤åˆ¶:  <code>master</code>  å†™æˆåŠŸï¼Œè¿”å›å®¢æˆ·ç«¯æˆåŠŸã€‚ æ‹¥æœ‰è¾ƒä½çš„å»¶è¿Ÿå’Œè¾ƒé«˜çš„ååé‡ï¼Œä½†æ˜¯å½“  <code>master</code>  å‡ºç°æ•…éšœåï¼Œæœ‰å¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±ã€‚ å¼‚æ­¥å¤åˆ¶çš„æ–¹å¼ï¼Œå…¶å®æ˜¯  <code>Slave</code>  èŠ‚ç‚¹ä¸­ä¼šå¯åŠ¨ä¸€ä¸ª  <code>HAService</code>  çº¿ç¨‹ï¼Œå®šæ—¶çš„å»åŒæ­¥ Master èŠ‚ç‚¹çš„æ•°æ®ï¼Œå»¶æ—¶å¤§æ¦‚åœ¨æ¯«ç§’çº§ã€‚</li>\n</ul>\n<p>åé¢æˆ‘ä»¬ä¼šæœ‰ä¸€ç¯‡æ–‡ç« ä¸“é—¨ä»‹ç»  <code>RocketMQ</code>  ä¸»ä»å¤åˆ¶çš„å®ç°ç»†èŠ‚ã€‚è¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ã€‚</p>\n<h2 id=\"æ¶ˆè´¹è€…çš„æ¶ˆæ¯å¯é æ€§\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹è€…çš„æ¶ˆæ¯å¯é æ€§\">#</a> æ¶ˆè´¹è€…çš„æ¶ˆæ¯å¯é æ€§</h2>\n<p><code>RocketMQ</code>  åœ¨æ¶ˆè´¹ç«¯ å®ç°äº†  <code>At least Once</code>  æœºåˆ¶ï¼Œæ¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§æ¶ˆè´¹.</p>\n<p>ä»€ä¹ˆæ˜¯  <code>at lease once</code>  å‘¢ï¼Ÿ</p>\n<p><code>consumer</code>  ä¼šæŠŠæ¶ˆæ¯å…ˆ <code>pull</code>  åˆ°æœ¬åœ°ï¼Œæ¶ˆè´¹å®Œæˆä¹‹åï¼Œæ‰å‘  <code>Broker</code>  ç«¯å‘é€  <code>ack</code>  .</p>\n<p><code>RocketMQ</code>  æœ‰ä¸‰ç§æªæ–½æ¥å®ç°å¯é æ€§.</p>\n<h3 id=\"æ¶ˆè´¹é‡è¯•\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹é‡è¯•\">#</a> æ¶ˆè´¹é‡è¯•</h3>\n<p>æ¶ˆè´¹è€…ä»  <code>RocketMQ</code>  æ‹‰å–åˆ°æ¶ˆæ¯ä¹‹åï¼Œéœ€è¦è¿”å›æ¶ˆè´¹æˆåŠŸæ¥è¡¨ç¤ºä¸šåŠ¡æ–¹æ­£å¸¸æ¶ˆè´¹å®Œæˆã€‚å› æ­¤åªæœ‰è¿”å› CONSUME_SUCCESS æ‰ç®—æ¶ˆè´¹å®Œæˆï¼Œå¦‚æœè¿”å›  <code>CONSUME_LATER</code>  åˆ™ä¼šæŒ‰ç…§ä¸åŒçš„  <code>messageDelayLevel</code>  æ—¶é—´è¿›è¡Œå†æ¬¡æ¶ˆè´¹ï¼Œæ—¶é—´åˆ†çº§ä»ç§’åˆ°å°æ—¶ï¼Œæœ€é•¿æ—¶é—´ä¸º 2 ä¸ªå°æ—¶åå†æ¬¡è¿›è¡Œæ¶ˆè´¹é‡è¯•ï¼Œå¦‚æœæ¶ˆè´¹æ»¡  <code>16</code>  æ¬¡ä¹‹åè¿˜æ˜¯æœªèƒ½æ¶ˆè´¹æˆåŠŸï¼Œåˆ™ä¸å†é‡è¯•ï¼Œä¼šå°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œä»è€Œä¿è¯æ¶ˆæ¯å­˜å‚¨çš„å¯é æ€§ã€‚<br>\nè¿™ä¸€æªæ–½ä¸»è¦æ˜¯é€šè¿‡ å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°ã€‚</p>\n<h3 id=\"æ­»ä¿¡é˜Ÿåˆ—\"><a class=\"markdownIt-Anchor\" href=\"#æ­»ä¿¡é˜Ÿåˆ—\">#</a> æ­»ä¿¡é˜Ÿåˆ—</h3>\n<p>æœªèƒ½æˆåŠŸæ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¹¶ä¸ä¼šç«‹åˆ»å°†æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œå…¶åç§°æ˜¯åœ¨åŸé˜Ÿåˆ—åç§°å‰åŠ  <code>%DLQ%</code> ï¼Œå¦‚æœæ¶ˆæ¯æœ€ç»ˆè¿›å…¥äº†æ­»ä¿¡é˜Ÿåˆ—ï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>RocketMQ</code>  æä¾›çš„ç›¸å…³æ¥å£ä»æ­»ä¿¡é˜Ÿåˆ—è·å–åˆ°ç›¸åº”çš„æ¶ˆæ¯ï¼Œä¿è¯äº†æ¶ˆæ¯æ¶ˆè´¹çš„å¯é æ€§ã€‚</p>\n<h3 id=\"æ¶ˆæ¯å›æº¯\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯å›æº¯\">#</a> æ¶ˆæ¯å›æº¯</h3>\n<p>å›æº¯æ¶ˆè´¹æ˜¯æŒ‡  <code>Consumer</code>  å·²ç»æ¶ˆè´¹æˆåŠŸçš„æ¶ˆæ¯ï¼Œæˆ–è€…ä¹‹å‰æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘æœ‰é—®é¢˜ï¼Œç°åœ¨éœ€è¦é‡æ–°æ¶ˆè´¹ã€‚è¦æ”¯æŒæ­¤åŠŸèƒ½ï¼Œåˆ™  <code>Broker</code>  å­˜å‚¨ç«¯åœ¨å‘  <code>Consumer</code>  æ¶ˆè´¹ç«¯æŠ•é€’æˆåŠŸæ¶ˆæ¯åï¼Œæ¶ˆæ¯ä»ç„¶éœ€è¦ä¿ç•™ã€‚é‡æ–°æ¶ˆè´¹ä¸€èˆ¬æ˜¯æŒ‰ç…§æ—¶é—´ç»´åº¦ï¼Œä¾‹å¦‚ç”±äº  <code>Consumer</code>  ç³»ç»Ÿæ•…éšœï¼Œæ¢å¤åéœ€è¦é‡æ–°æ¶ˆè´¹ <code>1</code>  å°æ—¶å‰çš„æ•°æ®ã€‚ <code>RocketMQ Broker</code>  æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥æŒ‰ç…§æ—¶é—´ç»´åº¦æ¥å›é€€æ¶ˆè´¹è¿›åº¦ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯åªè¦å‘é€æˆåŠŸçš„æ¶ˆæ¯ï¼Œåªè¦æ¶ˆæ¯æ²¡æœ‰è¿‡æœŸï¼Œæ¶ˆæ¯å§‹ç»ˆæ˜¯å¯ä»¥æ¶ˆè´¹åˆ°çš„ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/03/12/design_pattern/go/dp01-singleton/",
            "url": "https://fangjiaxiaobai.github.io/2022/03/12/design_pattern/go/dp01-singleton/",
            "title": "Goè®¾è®¡æ¨¡å¼-å•ä¾‹è®¾è®¡æ¨¡å¼",
            "date_published": "2022-03-12T10:18:18.000Z",
            "content_html": "<h2 id=\"å•ä¾‹æ¨¡å¼è§£å†³ä»€ä¹ˆé—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#å•ä¾‹æ¨¡å¼è§£å†³ä»€ä¹ˆé—®é¢˜\">#</a> å•ä¾‹æ¨¡å¼è§£å†³ä»€ä¹ˆé—®é¢˜</h2>\n<ul>\n<li>å¤„ç†èµ„æºè®¿é—®å†²çª</li>\n<li>è¡¨ç¤ºå…¨å±€å”¯ä¸€ã€‚åœ¨æ•´ä¸ªç¨‹åºä¸­ï¼ŒæŸäº›æ•°æ®åº”è¯¥å­˜å‚¨ä¸€ä»½ï¼Œè¿™æ ·çš„ç±»ï¼Œå°±åº”è¯¥è®¾è®¡æˆå•ä¾‹ç±»ã€‚æ¯”å¦‚ï¼ŒSpringBoot åº”ç”¨çš„é…ç½®é¡¹ã€‚å†æ¯”å¦‚ é›ªèŠ±ç®—æ³•çš„å®ç°ç±»ã€‚</li>\n</ul>\n<h2 id=\"å®ç°å•ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#å®ç°å•ä¾‹\">#</a> å®ç°å•ä¾‹</h2>\n<p>å¦‚ä½•å®ç°å•ä¾‹å‘¢ï¼Œæˆ–è€…è¯´æ€æ ·èƒ½ç§°å¾—ä¸Šå•ä¾‹å‘¢ï¼Ÿ<br>\n é¦–å…ˆï¼Œå•ä¾‹è¦æ±‚å…¨å±€å”¯ä¸€ï¼Œé‚£å°±æ˜¯è¯´ <b>ä¸å…è®¸å¤–éƒ¨éšéšä¾¿ä¾¿ new ä¸€ä¸ªæ–°å¯¹è±¡</b>.</p>\n<p>è¿™å¥è¯é‡Œï¼Œè‡³å°‘æœ‰ä¸¤ä¸ªç‚¹:<br>\n1. ä¸å…è®¸å¤–éƒ¨ new å¯¹è±¡ã€‚   2. éœ€è¦ç±»å†…éƒ¨ new å¯¹è±¡ï¼Œå¹¶æä¾›ç»™å¤–éƒ¨è¿›è¡Œä½¿ç”¨ã€‚<br>\nå…¶å®å¾ˆç®€å•çš„ï¼Œ<b>å•ä¾‹ç±»çš„æ„é€ æ–¹æ³•éœ€è¦æ˜¯ private æƒé™çš„ï¼Œæä¾›ä¸€ä¸ª public æ–¹æ³•ï¼Œç”¨äºå¤–éƒ¨è·å–æœ¬å¯¹è±¡ã€‚</b></p>\n<p>å¦å¤–ï¼Œæˆ‘ä»¬å†™çš„ç¨‹åºéƒ½æ˜¯è¿è¡Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚<br>\nè¿˜æœ‰ï¼Œè¯´è¿‡çº¿ç¨‹å®‰å…¨ï¼Œè‡ªç„¶è€Œç„¶ï¼Œå°±ä¼šæƒ³åˆ°é”ï¼Œæƒ³åˆ°é”ï¼Œå°±è¦æƒ³åˆ°æ€§èƒ½é—®é¢˜ã€‚</p>\n<h2 id=\"æ ¸å¿ƒæ¦‚å¿µ\"><a class=\"markdownIt-Anchor\" href=\"#æ ¸å¿ƒæ¦‚å¿µ\">#</a> æ ¸å¿ƒæ¦‚å¿µ</h2>\n<p>ä¿è¯æŸä¸ªç±»åœ¨ä¸€ä¸ªè¿è¡Œç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œ å¹¶æä¾›ä¸€ä¸ªè®¿é—®è¯¥å®ä¾‹çš„å…¨å±€èŠ‚ç‚¹ã€‚</p>\n<h2 id=\"å•ä¾‹çš„å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#å•ä¾‹çš„å®ç°\">#</a> å•ä¾‹çš„å®ç°</h2>\n<h3 id=\"æ‡’æ±‰å¼\"><a class=\"markdownIt-Anchor\" href=\"#æ‡’æ±‰å¼\">#</a> æ‡’æ±‰å¼</h3>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">\tlazySingletonInstance *lazySingleton</span><br><span class=\"line\">\tonce                  = &amp;sync.Once&#123;&#125;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// LazySingleton æ‡’æ±‰å¼</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> lazySingleton <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetLazySingletonInstance</span><span class=\"params\">()</span> *<span class=\"title\">lazySingleton</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> lazySingletonInstance == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tonce.Do(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t\tlazySingletonInstance = &amp;lazySingleton&#123;&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> lazySingletonInstance</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><b>æµ‹è¯•ä»£ç </b></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestGetLazySingletonInstance</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> GetLazySingletonInstance() != GetLazySingletonInstance() &#123;</span><br><span class=\"line\">\t\tt.Error(<span class=\"string\">&quot;æ‡’æ±‰å¼ å•ä¾‹æ¨¡å¼ï¼š å‡ºç°åŒä¸€å¯¹è±¡&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">BenchmarkGetLazySingletonInstance</span><span class=\"params\">(b *testing.B)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; b.N; i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> GetLazySingletonInstance() != GetLazySingletonInstance() &#123;</span><br><span class=\"line\">\t\t\tb.Error(<span class=\"string\">&quot;æ‡’æ±‰å¼ å•ä¾‹æ¨¡å¼ï¼š å‡ºç°åŒä¸€å¯¹è±¡&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"é¥¿æ±‰å¼\"><a class=\"markdownIt-Anchor\" href=\"#é¥¿æ±‰å¼\">#</a> é¥¿æ±‰å¼</h3>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> eagerSingleton <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> eagerSingletonObj *eagerSingleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// init.  ç¨‹åºè¿è¡Œå‰çš„æ³¨å†Œï¼Œå®ç° sync.OnceåŠŸèƒ½ ,åˆå§‹åŒ–ä¸èƒ½é‡‡ç”¨åˆå§‹åŒ–è¡¨è¾¾å¼åˆå§‹åŒ–çš„å˜é‡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// å˜é‡åˆå§‹åŒ–-&gt;init()-&gt;main()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;init in main.go &quot;</span>)</span><br><span class=\"line\">\teagerSingletonObj = &amp;eagerSingleton&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetInstance</span><span class=\"params\">()</span> *<span class=\"title\">eagerSingleton</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> eagerSingletonObj</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><b>æµ‹è¯•ä»£ç </b></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestEagerSingleton</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> GetInstance() != GetInstance() &#123;</span><br><span class=\"line\">\t\tt.Error(<span class=\"string\">&quot;å•ä¾‹æ¨¡å¼-é¥¿æ±‰å¼ï¼šå‡ºç°ä¸åŒçš„å¯¹è±¡&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">BenchmarkGetInstance</span><span class=\"params\">(b *testing.B)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; b.N; i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> GetInstance() != GetInstance() &#123;</span><br><span class=\"line\">\t\t\tb.Error(<span class=\"string\">&quot;å•ä¾‹æ¨¡å¼-é¥¿æ±‰å¼ï¼šå‡ºç°ä¸åŒçš„å¯¹è±¡&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"åŒé‡æ£€æŸ¥é”\"><a class=\"markdownIt-Anchor\" href=\"#åŒé‡æ£€æŸ¥é”\">#</a> åŒé‡æ£€æŸ¥é”</h3>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> doubleCheckSingleton <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> lock = &amp;sync.Mutex&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> doubleCheckSingletonInstance *doubleCheckSingleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetDoubleCheckSingletonInstance</span><span class=\"params\">()</span> *<span class=\"title\">doubleCheckSingleton</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> doubleCheckSingletonInstance == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tlock.Lock()</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> lock.Unlock()</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> doubleCheckSingletonInstance == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;åˆ›å»º å•ä¾‹å¯¹è±¡&quot;</span>)</span><br><span class=\"line\">\t\t\tdoubleCheckSingletonInstance = &amp;doubleCheckSingleton&#123;&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;å•ä¾‹å¯¹è±¡å·²ç»åˆ›å»ºäº†&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;å•ä¾‹å¯¹è±¡å·²ç»åˆ›å»ºäº†&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> doubleCheckSingletonInstance</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><b>æµ‹è¯•ä»£ç </b></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> singleton</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestGetDoubleCheckSingletonInstance</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> GetDoubleCheckSingletonInstance() != GetDoubleCheckSingletonInstance() &#123;</span><br><span class=\"line\">\t\tt.Error(<span class=\"string\">&quot;åŒé‡æ£€æµ‹æ³• è·å–ä¸åŒçš„å¯¹è±¡&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">BenchmarkGetDoubleCheckSingletonInstance</span><span class=\"params\">(b *testing.B)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; b.N; i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> GetDoubleCheckSingletonInstance() != GetDoubleCheckSingletonInstance() &#123;</span><br><span class=\"line\">\t\t\tb.Error(<span class=\"string\">&quot;åŒé‡æ£€æµ‹æ³• è·å–ä¸åŒçš„å¯¹è±¡&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#é—®é¢˜\">#</a> é—®é¢˜</h3>\n<p>1ã€å•ä¾‹æ¨¡å¼åŒäº‹è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥å•ä¾‹æ¨¡å¼è¿åäº†å•ä¸€èŒè´£åŸåˆ™:</p>\n<ul>\n<li>1ã€ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹.</li>\n<li>2ã€ä¸ºè¯¥å®ä¾‹æä¾›äº†ä¸€ä¸ªå…¨å±€è®¿é—®èŠ‚ç‚¹.<br>\n2ã€å•ä¾‹æ¨¡å¼å¯èƒ½ä¼šæ©ç›–ä¸è‰¯è®¾è®¡ï¼Œæ¯”å¦‚ç¨‹åºå„ç»„ä»¶ä¹‹é—´é¡¹ç›®äº†è§£è¿‡å¤šã€‚<br>\n3ã€è¯¥æ¨¡å¼åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œ é¿å…å¤šä¸ªçº¿ç¨‹å¤šæ¬¡åˆ›å»ºå•ä¾‹å¯¹è±¡ã€‚<br>\n4ã€å•ä¾‹çš„å®¢æˆ·ç«¯ä»£ç å•å…ƒæµ‹è¯•å¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾ï¼Œ å› ä¸ºè®¸å¤šæµ‹è¯•æ¡†æ¶ä»¥åŸºäºç»§æ‰¿çš„æ–¹å¼åˆ›å»ºæ¨¡æ‹Ÿå¯¹è±¡ã€‚ ç”±äºå•ä¾‹ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œ è€Œä¸”ç»å¤§éƒ¨åˆ†è¯­è¨€æ— æ³•é‡å†™é™æ€æ–¹æ³•ï¼Œ æ‰€ä»¥ä½ éœ€è¦æƒ³å‡ºä»”ç»†è€ƒè™‘æ¨¡æ‹Ÿå•ä¾‹çš„æ–¹æ³•ã€‚ è¦ä¹ˆå¹²è„†ä¸ç¼–å†™æµ‹è¯•ä»£ç ï¼Œ æˆ–è€…ä¸ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚</li>\n</ul>\n<h2 id=\"ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»\"><a class=\"markdownIt-Anchor\" href=\"#ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»\">#</a> ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»</h2>\n<ul>\n<li>å¤–è§‚æ¨¡å¼ç±»é€šå¸¸å¯ä»¥è½¬æ¢ä¸ºå•ä¾‹æ¨¡å¼ç±»ï¼Œ å› ä¸ºåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸€ä¸ªå¤–è§‚å¯¹è±¡å°±è¶³å¤Ÿäº†ã€‚</li>\n<li>å¦‚æœä½ èƒ½å°†å¯¹è±¡çš„æ‰€æœ‰å…±äº«çŠ¶æ€ç®€åŒ–ä¸ºä¸€ä¸ªäº«å…ƒå¯¹è±¡ï¼Œ é‚£ä¹ˆäº«å…ƒæ¨¡å¼å°±å’Œå•ä¾‹ç±»ä¼¼äº†ã€‚ ä½†è¿™ä¸¤ä¸ªæ¨¡å¼æœ‰ä¸¤ä¸ªæ ¹æœ¬æ€§çš„ä¸åŒã€‚\n<ul>\n<li>åªä¼šæœ‰ä¸€ä¸ªå•ä¾‹å®ä½“ï¼Œ ä½†æ˜¯äº«å…ƒç±»å¯ä»¥æœ‰å¤šä¸ªå®ä½“ï¼Œ å„å®ä½“çš„å†…åœ¨çŠ¶æ€ä¹Ÿå¯ä»¥ä¸åŒã€‚</li>\n<li>å•ä¾‹å¯¹è±¡å¯ä»¥æ˜¯å¯å˜çš„ã€‚ äº«å…ƒå¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚</li>\n</ul>\n</li>\n<li>æŠ½è±¡å·¥å‚æ¨¡å¼ã€ ç”Ÿæˆå™¨æ¨¡å¼å’ŒåŸå‹æ¨¡å¼éƒ½å¯ä»¥ç”¨å•ä¾‹æ¥å®ç°ã€‚</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "go",
                "go-è®¾è®¡æ¨¡å¼"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/03/12/go/goroutine_runtime/",
            "url": "https://fangjiaxiaobai.github.io/2022/03/12/go/goroutine_runtime/",
            "title": "Go è¿è¡Œæ—¶",
            "date_published": "2022-03-12T10:18:18.000Z",
            "content_html": "<h2 id=\"goroutine-å®šä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#goroutine-å®šä¹‰\">#</a>  <code>goroutine</code>  å®šä¹‰</h2>\n<p>â€œ <code>Goroutine</code>  æ˜¯ä¸€ä¸ªä¸å…¶ä»–  <code>goroutines</code>  å¹¶è¡Œè¿è¡Œåœ¨åŒä¸€åœ°å€ç©ºé—´çš„  <code>Go</code>  å‡½æ•°æˆ–æ–¹æ³•ã€‚ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºç”±ä¸€ä¸ªæˆ–æ›´å¤šä¸ª  <code>goroutine</code>  ç»„æˆã€‚å®ƒä¸çº¿ç¨‹ã€åç¨‹ã€è¿›ç¨‹ç­‰ä¸åŒã€‚å®ƒæ˜¯ä¸€ä¸ª  <code>goroutine</code> â€ â€”â€”  <code>Rob Pike</code> <br>\n <code>Goroutines</code>  åœ¨åŒä¸€ä¸ªç”¨æˆ·åœ°å€ç©ºé—´é‡Œå¹¶è¡Œç‹¬ç«‹æ‰§è¡Œ  <code>functions</code>  ï¼Œ  <code>channels</code>  åˆ™ç”¨äº  <code>goroutines</code>  é—´çš„é€šä¿¡å’ŒåŒæ­¥è®¿é—®æ§åˆ¶ã€‚</p>\n<h3 id=\"goroutine-vs-thread\"><a class=\"markdownIt-Anchor\" href=\"#goroutine-vs-thread\">#</a>  <code>goroutine VS thread</code></h3>\n<ul>\n<li><b>å†…å­˜å ç”¨</b>. åˆ›å»ºä¸€ä¸ª  <code>goroutine</code>  çš„æ ˆå†…å­˜æ¶ˆè€—ä¸º  <code>2 KB</code> ( <code>Linux AMD64</code>   <code>Go v1.4</code>  å)ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ ˆç©ºé—´ä¸å¤Ÿç”¨ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹ã€‚ åˆ›å»ºä¸€ä¸ª  <code>thread</code>  ä¸ºäº†å°½é‡é¿å…æç«¯æƒ…å†µä¸‹æ“ä½œç³»ç»Ÿçº¿ç¨‹æ ˆçš„æº¢å‡ºï¼Œé»˜è®¤ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªè¾ƒå¤§çš„æ ˆå†…å­˜ (  <code>1 - 8 MB</code>  æ ˆå†…å­˜ï¼Œçº¿ç¨‹æ ‡å‡† <code>POSIX Thread</code> )ï¼Œè€Œä¸”è¿˜éœ€è¦ä¸€ä¸ªè¢«ç§°ä¸º  <code>â€œguard pageâ€</code>  çš„åŒºåŸŸç”¨äºå’Œå…¶ä»–  <code>thread</code>  çš„æ ˆç©ºé—´è¿›è¡Œéš”ç¦»ã€‚è€Œæ ˆå†…å­˜ç©ºé—´ä¸€æ—¦åˆ›å»ºå’Œåˆå§‹åŒ–å®Œæˆä¹‹åå…¶å¤§å°å°±ä¸èƒ½å†æœ‰å˜åŒ–ï¼Œè¿™å†³å®šäº†<b>åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ç³»ç»Ÿçº¿ç¨‹æ ˆè¿˜æ˜¯æœ‰æº¢å‡ºçš„é£é™©</b>ã€‚</li>\n<li><b>åˆ›å»º / é”€æ¯</b>ï¼Œçº¿ç¨‹åˆ›å»ºå’Œé”€æ¯€éƒ½ä¼šæœ‰å·¨å¤§çš„æ¶ˆè€—ï¼Œæ˜¯å†…æ ¸çº§çš„äº¤äº’ ( <code>trap</code> )ã€‚  <code>POSIX</code>  çº¿ç¨‹ (å®šä¹‰äº†åˆ›å»ºå’Œæ“çºµçº¿ç¨‹çš„ä¸€å¥—  <code>API</code> ) é€šå¸¸æ˜¯åœ¨å·²æœ‰çš„è¿›ç¨‹æ¨¡å‹ä¸­å¢åŠ çš„é€»è¾‘æ‰©å±•ï¼Œæ‰€ä»¥çº¿ç¨‹æ§åˆ¶å’Œè¿›ç¨‹æ§åˆ¶å¾ˆç›¸ä¼¼ã€‚è€Œè¿›å…¥å†…æ ¸è°ƒåº¦æ‰€æ¶ˆè€—çš„æ€§èƒ½ä»£ä»·æ¯”è¾ƒé«˜ï¼Œå¼€é”€è¾ƒå¤§ã€‚  <code>goroutine</code>  æ˜¯ç”¨æˆ·æ€çº¿ç¨‹ï¼Œæ˜¯ç”±  <code>go runtime</code>  ç®¡ç†ï¼Œåˆ›å»ºå’Œé”€æ¯çš„æ¶ˆè€—éå¸¸å°ã€‚</li>\n<li><b>è°ƒåº¦åˆ‡æ¢</b> æŠ›å¼€é™·å…¥å†…æ ¸ï¼Œçº¿ç¨‹åˆ‡æ¢ä¼šæ¶ˆè€—  <code>1000-1500</code>  çº³ç§’ (ä¸Šä¸‹æ–‡ä¿å­˜æˆæœ¬é«˜ï¼Œè¾ƒå¤šå¯„å­˜å™¨ï¼Œå…¬å¹³æ€§ï¼Œå¤æ‚æ—¶é—´è®¡ç®—ç»Ÿè®¡)ï¼Œä¸€ä¸ªçº³ç§’å¹³å‡å¯ä»¥æ‰§è¡Œ  <code>12-18</code>  æ¡æŒ‡ä»¤ã€‚ æ‰€ä»¥ç”±äºçº¿ç¨‹åˆ‡æ¢ï¼Œæ‰§è¡ŒæŒ‡ä»¤çš„æ¡æ•°ä¼šå‡å°‘  <code>12000-18000</code> ã€‚  <code>goroutine</code>  çš„åˆ‡æ¢çº¦ä¸º  <code>200ns</code>  (ç”¨æˆ·æ€ã€3 ä¸ªå¯„å­˜å™¨)ï¼Œç›¸å½“äº  <code>2400-3600</code>  æ¡æŒ‡ä»¤ã€‚å› æ­¤ï¼Œ  <code>goroutines</code>  åˆ‡æ¢æˆæœ¬æ¯”   <code>threads</code>  è¦å°å¾—å¤šã€‚</li>\n<li><b>å¤æ‚æ€§</b> çº¿ç¨‹çš„åˆ›å»ºå’Œé€€å‡ºå¤æ‚ï¼Œå¤šä¸ª  <code>thread</code>  é—´é€šè®¯å¤æ‚ ( <code>share memory</code> )ã€‚ ä¸èƒ½å¤§é‡åˆ›å»ºçº¿ç¨‹ (å‚è€ƒæ—©æœŸçš„  <code>httpd</code> )ï¼Œæˆæœ¬é«˜ï¼Œä½¿ç”¨ç½‘ç»œå¤šè·¯å¤ç”¨ï¼Œå­˜åœ¨å¤§é‡ <code>callback</code>  (å‚è€ƒ <code>twemproxy</code> ã€ <code>nginx</code>  çš„ä»£ç ) ã€‚å¯¹äºåº”ç”¨æœåŠ¡çº¿ç¨‹é—¨æ§›é«˜ï¼Œä¾‹å¦‚éœ€è¦åšç¬¬ä¸‰æ–¹åº“éš”ç¦»ï¼Œéœ€è¦è€ƒè™‘å¼•å…¥çº¿ç¨‹æ± ç­‰ã€‚</li>\n</ul>\n<h2 id=\"goroutine-è¿è¡ŒåŸç†\"><a class=\"markdownIt-Anchor\" href=\"#goroutine-è¿è¡ŒåŸç†\">#</a>  <code>Goroutine</code>  è¿è¡ŒåŸç†</h2>\n<p><code>Go</code>  ç¨‹åºçš„æ‰§è¡Œç”±ä¸¤å±‚ç»„æˆï¼š <code>Go Program</code> ï¼Œ <code>Runtime</code> ï¼Œå³ç”¨æˆ·ç¨‹åºå’Œè¿è¡Œæ—¶ã€‚å®ƒä»¬ä¹‹é—´é€šè¿‡å‡½æ•°è°ƒç”¨æ¥å®ç°å†…å­˜ç®¡ç†ã€ <code>channel</code>  é€šä¿¡ã€ <code>goroutines</code>  åˆ›å»ºç­‰åŠŸèƒ½ã€‚ç”¨æˆ·ç¨‹åºè¿›è¡Œçš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šè¢«  <code>Runtime</code>  æ‹¦æˆªï¼Œä»¥æ­¤æ¥å¸®åŠ©å®ƒè¿›è¡Œè°ƒåº¦ä»¥åŠåƒåœ¾å›æ”¶ç›¸å…³çš„å·¥ä½œã€‚</p>\n<h3 id=\"mn-æ¨¡å‹\"><a class=\"markdownIt-Anchor\" href=\"#mn-æ¨¡å‹\">#</a>  <code>M:N</code>  æ¨¡å‹</h3>\n<p><code>Go runtime</code>  ä¼šè´Ÿè´£  <code>goroutine</code>  çš„ç”Ÿè€ç—…æ­»ï¼Œä»åˆ›å»ºåˆ°é”€æ¯ï¼Œéƒ½ä¸€æ‰‹åŒ…åŠã€‚ <code>Runtime</code>  ä¼šåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ã€‚  <code>Go</code>  åˆ›å»º  <code>M</code>  ä¸ªçº¿ç¨‹ ( <code>CPU</code>  æ‰§è¡Œè°ƒåº¦çš„å•å…ƒï¼Œå†…æ ¸çš„  <code>task_struct</code> )ï¼Œä¹‹ååˆ›å»ºçš„  <code>N</code>  ä¸ª  <code>goroutine</code>  éƒ½ä¼šä¾é™„åœ¨è¿™  <code>M</code>  ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå³  <code>M:N</code>  æ¨¡å‹ã€‚å®ƒä»¬èƒ½å¤ŸåŒæ—¶è¿è¡Œï¼Œä¸çº¿ç¨‹ç±»ä¼¼ï¼Œä½†ç›¸æ¯”ä¹‹ä¸‹éå¸¸è½»é‡ã€‚å› æ­¤ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œ <code>Goroutines</code>  çš„ä¸ªæ•°åº”è¯¥æ˜¯è¿œå¤§äºçº¿ç¨‹çš„ä¸ªæ•°çš„ï¼ˆ<a href=\"https://www.zhihu.com/question/35128513\"> <code>phread</code>  æ˜¯å†…æ ¸çº¿ç¨‹ï¼Ÿ</a>ï¼‰ã€‚</p>\n<p>åŒä¸€ä¸ªæ—¶åˆ»ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½è·‘ä¸€ä¸ª  <code>goroutine</code> ã€‚å½“  <code>goroutine</code>  å‘ç”Ÿé˜»å¡ ( <code>chan</code>  é˜»å¡ã€ <code>mutex</code> ã€ <code>syscall</code>  ç­‰ç­‰) æ—¶ï¼ŒGo ä¼šæŠŠå½“å‰çš„  <code>goroutine</code>  è°ƒåº¦èµ°ï¼Œè®©å…¶ä»–  <code>goroutine</code>  æ¥ç»§ç»­æ‰§è¡Œï¼Œè€Œä¸æ˜¯è®©çº¿ç¨‹é˜»å¡ä¼‘çœ ï¼Œå°½å¯èƒ½å¤šçš„åˆ†å‘ä»»åŠ¡å‡ºå»ï¼Œè®©  <code>CPU</code>  å¿™ã€‚</p>\n<h3 id=\"gm-è°ƒåº¦æ¨¡å‹\"><a class=\"markdownIt-Anchor\" href=\"#gm-è°ƒåº¦æ¨¡å‹\">#</a> GM è°ƒåº¦æ¨¡å‹</h3>\n<p><code>go</code>  åœ¨ <code>1.2</code>  ç‰ˆæœ¬ä¹‹å‰ï¼Œè°ƒåº¦æ¨¡å‹ä½¿ç”¨çš„æ˜¯  <code>GM</code>  è°ƒåº¦æ¨¡å‹ã€‚</p>\n<h4 id=\"g\"><a class=\"markdownIt-Anchor\" href=\"#g\">#</a> G</h4>\n<p><code>goroutine</code>  çš„ç¼©å†™ï¼Œæ¯æ¬¡  <code>go func()</code>  éƒ½ä»£è¡¨ä¸€ä¸ª  <code>G</code> ï¼Œæ— é™åˆ¶ã€‚ ä½¿ç”¨  <code>struct runtime.g</code> ï¼ŒåŒ…å«äº†å½“å‰  <code>goroutine</code>  çš„çŠ¶æ€ã€å †æ ˆã€ä¸Šä¸‹æ–‡ã€‚</p>\n<h4 id=\"m\"><a class=\"markdownIt-Anchor\" href=\"#m\">#</a> M</h4>\n<p>å·¥ä½œçº¿ç¨‹ ( <code>OS thread</code> ) ä¹Ÿè¢«ç§°ä¸º Machineï¼Œä½¿ç”¨  <code>struct runtime.m</code> ï¼Œæ‰€æœ‰  <code>M</code>  æ˜¯æœ‰çº¿ç¨‹æ ˆçš„ã€‚ å¦‚æœä¸å¯¹è¯¥çº¿ç¨‹æ ˆæä¾›å†…å­˜çš„è¯ï¼Œç³»ç»Ÿä¼šç»™è¯¥çº¿ç¨‹æ ˆæä¾›å†…å­˜ (ä¸åŒæ“ä½œç³»ç»Ÿæä¾›çš„çº¿ç¨‹æ ˆå¤§å°ä¸åŒ)<br>\nã€‚å½“æŒ‡å®šäº†çº¿ç¨‹æ ˆï¼Œåˆ™  <code>M.stackâ†’G.stack</code> ï¼Œ <code>M</code>  çš„  <code>PC</code>  å¯„å­˜å™¨æŒ‡å‘  <code>G</code>  æä¾›çš„å‡½æ•°ï¼Œç„¶åå»æ‰§è¡Œã€‚</p>\n<h4 id=\"gm-è°ƒåº¦\"><a class=\"markdownIt-Anchor\" href=\"#gm-è°ƒåº¦\">#</a> GM è°ƒåº¦</h4>\n<p><code>Go 1.2</code>  å‰çš„è°ƒåº¦å™¨å®ç°ï¼Œé™åˆ¶äº†  <code>Go</code>  å¹¶å‘ç¨‹åºçš„ä¼¸ç¼©æ€§ï¼Œå°¤å…¶æ˜¯å¯¹é‚£äº›æœ‰é«˜ååæˆ–å¹¶è¡Œè®¡ç®—éœ€æ±‚çš„æœåŠ¡ç¨‹åºã€‚<br>\næ¯ä¸ª  <code>goroutine</code>  å¯¹åº”äº  <code>runtime</code>  ä¸­çš„ä¸€ä¸ªæŠ½è±¡ç»“æ„ï¼š <code>G</code> ï¼Œè€Œ  <code>thread</code>  ä½œä¸º <code>â€œç‰©ç† CPUâ€</code>  çš„å­˜åœ¨è€Œè¢«æŠ½è±¡ä¸ºä¸€ä¸ªç»“æ„ï¼šM ( <code>machine</code> )ã€‚å½“  <code>goroutine</code>  è°ƒç”¨äº†ä¸€ä¸ªé˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿è¡Œè¿™ä¸ª  <code>goroutine</code>  çš„çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œè¿™æ—¶è‡³å°‘åº”è¯¥å†åˆ›å»º / å”¤é†’ä¸€ä¸ªçº¿ç¨‹æ¥è¿è¡Œåˆ«çš„æ²¡æœ‰é˜»å¡çš„  <code>goroutine</code>  ã€‚çº¿ç¨‹è¿™é‡Œå¯ä»¥åˆ›å»ºä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥æŒ‰éœ€ä¸æ–­åœ°åˆ›å»ºï¼Œè€Œæ´»è·ƒçš„çº¿ç¨‹ï¼ˆå¤„äºéé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼‰çš„æœ€å¤§ä¸ªæ•°å­˜å‚¨åœ¨å˜é‡  <code>GOMAXPROCS</code>  ä¸­ã€‚</p>\n<p>è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º:</p>\n<p><img data-src=\"/images/go/13-75.png\" alt=\"\"></p>\n<p><code>M</code>  æƒ³è¦æ‰§è¡Œã€æ”¾å›  <code>G</code>  éƒ½å¿…é¡»è®¿é—®å…¨å±€  <code>G</code>  é˜Ÿåˆ—ï¼Œå¹¶ä¸”  <code>M</code>  æœ‰å¤šä¸ªï¼Œå³å¤šçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºéœ€è¦åŠ é”è¿›è¡Œä¿è¯äº’æ–¥ / åŒæ­¥ï¼Œæ‰€ä»¥å…¨å±€  <code>G</code>  é˜Ÿåˆ—æ˜¯æœ‰äº’æ–¥é”è¿›è¡Œä¿æŠ¤çš„</p>\n<h4 id=\"gm-è°ƒåº¦æ¨¡å‹çš„é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#gm-è°ƒåº¦æ¨¡å‹çš„é—®é¢˜\">#</a> GM è°ƒåº¦æ¨¡å‹çš„é—®é¢˜</h4>\n<ul>\n<li>å•ä¸€å…¨å±€äº’æ–¥é” ( <code>Sched.Lock</code> ) å’Œé›†ä¸­çŠ¶æ€å­˜å‚¨<br>\nå¯¼è‡´æ‰€æœ‰  <code>goroutine</code>  ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚ï¼šåˆ›å»ºã€ç»“æŸã€é‡æ–°è°ƒåº¦ç­‰éƒ½è¦ä¸Šé”ã€‚</li>\n<li><code>Goroutine</code>  ä¼ é€’é—®é¢˜<br>\n <code>M</code>  ç»å¸¸åœ¨  <code>M</code>  ä¹‹é—´ä¼ é€’â€ å¯è¿è¡Œâ€ çš„  <code>goroutine</code>  ï¼Œè¿™å¯¼è‡´è°ƒåº¦å»¶è¿Ÿå¢å¤§ä»¥åŠé¢å¤–çš„æ€§èƒ½æŸè€—ï¼ˆåˆšåˆ›å»ºçš„  <code>G</code>  æ”¾åˆ°äº†å…¨å±€é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯æœ¬åœ° M æ‰§è¡Œï¼Œä¸å¿…è¦çš„å¼€é”€å’Œå»¶è¿Ÿï¼‰ã€‚</li>\n<li><code>Per-M </code> æŒæœ‰å†…å­˜ç¼“å­˜ ( <code>M.mcache</code> )<br>\n æ¯ä¸ª  <code>M</code>  æŒæœ‰  <code>mcache</code>  å’Œ  <code>stackalloc</code>  ï¼Œç„¶è€Œåªæœ‰åœ¨  <code>M</code>  è¿è¡Œ  <code>Go</code>  ä»£ç æ—¶æ‰éœ€è¦ä½¿ç”¨çš„å†…å­˜ (æ¯ä¸ª  <code>mcache</code>  å¯ä»¥é«˜è¾¾  <code>2mb</code>  )ï¼Œå½“  <code>M</code>  åœ¨å¤„äº  <code>syscall</code>  æ—¶å¹¶ä¸éœ€è¦ã€‚è¿è¡Œ  <code>Go</code>  ä»£ç å’Œé˜»å¡åœ¨  <code>syscall</code>  çš„  <code>M</code>  çš„æ¯”ä¾‹é«˜è¾¾ <code>1:100</code> ï¼Œé€ æˆäº†å¾ˆå¤§çš„æµªè´¹ã€‚åŒæ—¶å†…å­˜äº²ç¼˜æ€§ä¹Ÿè¾ƒå·®ï¼Œ <code>G</code>  å½“å‰åœ¨  <code>M</code>  è¿è¡Œåå¯¹ M çš„å†…å­˜è¿›è¡Œäº†é¢„çƒ­ï¼Œå› ä¸ºç°åœ¨  <code>G</code>  è°ƒåº¦åˆ°åŒä¸€ä¸ª  <code>M</code>  çš„æ¦‚ç‡ä¸é«˜ï¼Œæ•°æ®å±€éƒ¨æ€§ä¸å¥½ã€‚</li>\n<li>ä¸¥é‡çš„çº¿ç¨‹é˜»å¡ / è§£é”<br>\nåœ¨ç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œå·¥ä½œçº¿ç¨‹ç»å¸¸è¢«é˜»å¡å’Œå–æ¶ˆé˜»å¡ï¼Œè¿™å¢åŠ äº†å¾ˆå¤šå¼€é”€ã€‚æ¯”å¦‚  <code>M</code>  æ‰¾ä¸åˆ° <code>G</code> ï¼Œæ­¤æ—¶  <code>M</code>  å°±ä¼šè¿›å…¥é¢‘ç¹é˜»å¡ / å”¤é†’æ¥è¿›è¡Œæ£€æŸ¥çš„é€»è¾‘ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°æ–°çš„  <code>G</code>  æ¥æ‰§è¡Œã€‚<br>\nby Dmitry Vyukov â€œ<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZG9jdW1lbnQvZC8xVFRqNFQySk80MnVENUlEOWU4OW9hMHNMS2hKWUQwWV9rcXhEdjNJM1hNdy9lZGl0IyE=\">Scalable Go Scheduler Design Doc</span>â€</li>\n</ul>\n<h3 id=\"gmp-è°ƒåº¦æ¨¡å‹\"><a class=\"markdownIt-Anchor\" href=\"#gmp-è°ƒåº¦æ¨¡å‹\">#</a> GMP è°ƒåº¦æ¨¡å‹</h3>\n<p>åœ¨  <code>go 1.2</code>  ç‰ˆæœ¬åŠä»¥åï¼Œgo å¼•å…¥  <code>GMP</code>  è°ƒåº¦æ¨¡å‹</p>\n<h4 id=\"g-2\"><a class=\"markdownIt-Anchor\" href=\"#g-2\">#</a> G</h4>\n<p><code>goroutine</code>  çš„ç¼©å†™ï¼Œæ¯æ¬¡  <code>go func()</code>  éƒ½ä»£è¡¨ä¸€ä¸ª  <code>G</code> ï¼Œæ— é™åˆ¶ã€‚ ä½¿ç”¨  <code>struct runtime.g</code> ï¼ŒåŒ…å«äº†å½“å‰  <code>goroutine</code>  çš„çŠ¶æ€ã€å †æ ˆã€ä¸Šä¸‹æ–‡ã€‚</p>\n<h4 id=\"m-2\"><a class=\"markdownIt-Anchor\" href=\"#m-2\">#</a> M</h4>\n<p>å·¥ä½œçº¿ç¨‹ ( <code>OS thread</code> ) ä¹Ÿè¢«ç§°ä¸º Machineï¼Œä½¿ç”¨  <code>struct runtime.m</code> ï¼Œæ‰€æœ‰  <code>M</code>  æ˜¯æœ‰çº¿ç¨‹æ ˆçš„ã€‚ å¦‚æœä¸å¯¹è¯¥çº¿ç¨‹æ ˆæä¾›å†…å­˜çš„è¯ï¼Œç³»ç»Ÿä¼šç»™è¯¥çº¿ç¨‹æ ˆæä¾›å†…å­˜ (ä¸åŒæ“ä½œç³»ç»Ÿæä¾›çš„çº¿ç¨‹æ ˆå¤§å°ä¸åŒ)<br>\nã€‚å½“æŒ‡å®šäº†çº¿ç¨‹æ ˆï¼Œåˆ™  <code>M.stackâ†’G.stack</code> ï¼Œ <code>M</code>  çš„  <code>PC</code>  å¯„å­˜å™¨æŒ‡å‘  <code>G</code>  æä¾›çš„å‡½æ•°ï¼Œç„¶åå»æ‰§è¡Œã€‚</p>\n<h4 id=\"p\"><a class=\"markdownIt-Anchor\" href=\"#p\">#</a> P</h4>\n<p><code>â€œProcessorâ€</code>  æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„ç‰©ç†  <code>CPU</code> ã€‚</p>\n<p><code>Dmitry Vyukov</code>  çš„æ–¹æ¡ˆæ˜¯å¼•å…¥ä¸€ä¸ªç»“æ„  <code>P</code> ï¼Œå®ƒä»£è¡¨äº†  <code>M</code>  æ‰€éœ€çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¹Ÿæ˜¯å¤„ç†ç”¨æˆ·çº§ä»£ç é€»è¾‘çš„å¤„ç†å™¨ã€‚å®ƒè´Ÿè´£è¡”æ¥  <code>M</code>  å’Œ  <code>G</code>  çš„è°ƒåº¦ä¸Šä¸‹æ–‡ï¼Œå°†ç­‰å¾…æ‰§è¡Œçš„  <code>G</code>  ä¸  <code>M</code>  å¯¹æ¥ã€‚å½“ P æœ‰ä»»åŠ¡æ—¶éœ€è¦åˆ›å»ºæˆ–è€…å”¤é†’ä¸€ä¸ª  <code>M</code>  æ¥æ‰§è¡Œå®ƒé˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ã€‚æ‰€ä»¥  <code>P/M</code>  éœ€è¦è¿›è¡Œç»‘å®šï¼Œæ„æˆä¸€ä¸ªæ‰§è¡Œå•å…ƒã€‚  <code>P</code>  å†³å®šäº†å¹¶è¡Œä»»åŠ¡çš„æ•°é‡ï¼Œå¯é€šè¿‡  <code>runtime.GOMAXPROCS</code>  æ¥è®¾å®šã€‚åœ¨  <code>Go1.5</code>  ä¹‹å  <code>GOMAXPROCS</code>  è¢«é»˜è®¤è®¾ç½®å¯ç”¨çš„æ ¸æ•°ï¼Œè€Œä¹‹å‰åˆ™é»˜è®¤ä¸º <code>1</code> ã€‚</p>\n<p><code>Runtime</code>  èµ·å§‹æ—¶ä¼šå¯åŠ¨ä¸€äº›  <code>G</code> ï¼šåƒåœ¾å›æ”¶çš„  <code>G</code> ï¼Œæ‰§è¡Œè°ƒåº¦çš„  <code>G</code> ï¼Œè¿è¡Œç”¨æˆ·ä»£ç çš„  <code>G</code> ï¼›å¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ª  <code>M</code>  ç”¨æ¥å¼€å§‹  <code>G</code>  çš„è¿è¡Œã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ›´å¤šçš„  <code>G</code>  ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ›´å¤šçš„  <code>M</code>  ä¹Ÿä¼šè¢«åˆ›å»ºå‡ºæ¥ã€‚</p>\n<p>Tips: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3ViZXItZ28vYXV0b21heHByb2Nz\">https://github.com/uber-go/automaxprocs</span><br>\n <code>Automatically set GOMAXPROCS to match Linux container CPU quota.</code> <br>\n <code>mcache/stackalloc</code>  ä»  <code>M</code>  ç§»åˆ°äº†  <code>P</code> ï¼Œè€Œ  <code>G</code>  é˜Ÿåˆ—ä¹Ÿè¢«åˆ†æˆä¸¤ç±»ï¼Œä¿ç•™å…¨å±€  <code>G</code>  é˜Ÿåˆ—ï¼ŒåŒæ—¶æ¯ä¸ª  <code>P</code>  ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªæœ¬åœ°çš„  <code>G</code>  é˜Ÿåˆ—ã€‚</p>\n<h4 id=\"gmp-è°ƒåº¦\"><a class=\"markdownIt-Anchor\" href=\"#gmp-è°ƒåº¦\">#</a>  <code>GMP</code>  è°ƒåº¦</h4>\n<p><code>GMP</code>  è°ƒåº¦æ¨¡å‹ï¼Œå¼•å…¥äº†  <code>local queue</code> ï¼Œå› ä¸º  <code>P</code>  çš„å­˜åœ¨ï¼Œ <code>runtime</code>  å¹¶ä¸éœ€è¦åšä¸€ä¸ªé›†ä¸­å¼çš„  <code>goroutine</code>  è°ƒåº¦ï¼Œæ¯ä¸€ä¸ª  <code>M</code>  éƒ½ä¼šåœ¨  <code>P's local queue</code> ã€ <code>global queue</code>  æˆ–è€…å…¶ä»–  <code>P</code>  é˜Ÿåˆ—ä¸­æ‰¾  <code>G</code>  æ‰§è¡Œï¼Œå‡å°‘å…¨å±€é”å¯¹æ€§èƒ½çš„å½±å“ã€‚<br>\nè¿™ä¹Ÿæ˜¯  <code>GMP Work-stealing</code>  è°ƒåº¦ç®—æ³•çš„æ ¸å¿ƒã€‚æ³¨æ„  <code>P</code>  çš„æœ¬åœ°  <code>G</code>  é˜Ÿåˆ—è¿˜æ˜¯å¯èƒ½é¢ä¸´ä¸€ä¸ªå¹¶å‘è®¿é—®çš„åœºæ™¯ï¼Œä¸ºäº†é¿å…åŠ é”ï¼Œè¿™é‡Œ  <code>P</code>  çš„æœ¬åœ°é˜Ÿåˆ—æ˜¯ä¸€ä¸ª  <code>LockFree</code>  çš„é˜Ÿåˆ—ï¼Œçªƒå–  <code>G</code>  æ—¶ä½¿ç”¨  <code>CAS</code>  åŸå­æ“ä½œæ¥å®Œæˆã€‚å…³äº <code>LockFree</code>  å’Œ  <code>CAS</code>  çš„çŸ¥è¯†å‚è§  <code>Lock-Free</code> ã€‚</p>\n<p><img data-src=\"/images/go/13-49.png\" alt=\"\"></p>\n<h3 id=\"work-stealing\"><a class=\"markdownIt-Anchor\" href=\"#work-stealing\">#</a>  <code>Work Stealing</code></h3>\n<p>å½“ä¸€ä¸ª  <code>P</code>  æ‰§è¡Œå®Œæœ¬åœ°æ‰€æœ‰çš„  <code>G</code>  ä¹‹åï¼Œå¹¶ä¸”å…¨å±€é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œä¼šå°è¯•æŒ‘é€‰ä¸€ä¸ªå—å®³è€…  <code>P</code>  ï¼Œä»å®ƒçš„  <code>G</code>  é˜Ÿåˆ—ä¸­çªƒå–ä¸€åŠçš„  <code>G</code> ã€‚å¦åˆ™ä¼šä»å…¨å±€é˜Ÿåˆ—ä¸­è·å– (å½“å‰ä¸ªæ•° / <code>GOMAXPROCS</code> ) ä¸ª  <code>G</code>  ã€‚<br>\nä¸ºäº†ä¿è¯å…¬å¹³æ€§ï¼Œä»éšæœºä½ç½®ä¸Šçš„  <code>P</code>  å¼€å§‹ï¼Œè€Œä¸”éå†çš„é¡ºåºä¹ŸéšæœºåŒ–äº† (é€‰æ‹©ä¸€ä¸ªå°äº  <code>GOMAXPROCS</code>  ï¼Œä¸”å’Œå®ƒäº’ä¸ºè´¨æ•°çš„æ­¥é•¿)ï¼Œä¿è¯éå†çš„é¡ºåºä¹ŸéšæœºåŒ–äº†ã€‚</p>\n<p><img data-src=\"/images/go/13-50.png\" alt=\"\"></p>\n<p>å…‰çªƒå–å¤±è´¥æ—¶è·å–æ˜¯ä¸å¤Ÿçš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¨å±€é˜Ÿåˆ—é¥¥é¥¿ã€‚ <code>P</code>  çš„è°ƒåº¦ç®—æ³•ä¸­è¿˜ä¼šæ¯ä¸ª  <code>N</code>  è½®è°ƒåº¦ä¹‹åå°±å»å…¨å±€é˜Ÿåˆ—æ‹¿ä¸€ä¸ª  <code>G</code> ã€‚ å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"/images/go/13-52.png\" alt=\"\"></p>\n<h4 id=\"è°æ”¾å…¥çš„å…¨å±€é˜Ÿåˆ—å‘¢\"><a class=\"markdownIt-Anchor\" href=\"#è°æ”¾å…¥çš„å…¨å±€é˜Ÿåˆ—å‘¢\">#</a> è°æ”¾å…¥çš„å…¨å±€é˜Ÿåˆ—å‘¢</h4>\n<p>æœ‰ä¸¤ç§æƒ…å†µä¼šæŠŠ <code>G</code>  æ”¾åˆ°å…¨å±€é˜Ÿåˆ—ä¸­ã€‚</p>\n<ul>\n<li>æ–°å»º  <code>G</code>  æ—¶  <code>P</code>  çš„æœ¬åœ°  <code>G</code>  é˜Ÿåˆ—æ”¾ä¸ä¸‹å·²æ»¡å¹¶è¾¾åˆ° <code>256</code>  ä¸ªçš„æ—¶å€™ä¼šæ”¾åŠæ•°  <code>G</code>  åˆ°å…¨å±€é˜Ÿåˆ—å»ã€‚</li>\n<li>é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶æ‰¾ä¸åˆ°ç©ºé—²  <code>P</code>  ä¹Ÿä¼šæ”¾åˆ°å…¨å±€é˜Ÿåˆ—ã€‚</li>\n</ul>\n<p><img data-src=\"/images/go/13-51.png\" alt=\"\"></p>\n<h3 id=\"syscall-ç³»ç»Ÿè°ƒç”¨\"><a class=\"markdownIt-Anchor\" href=\"#syscall-ç³»ç»Ÿè°ƒç”¨\">#</a> SysCall ç³»ç»Ÿè°ƒç”¨</h3>\n<p>å½“  <code>G</code>  è°ƒç”¨  <code>syscall</code>  åä¼šè§£ç»‘  <code>P</code> ï¼Œç„¶å  <code>M</code>  å’Œ  <code>G</code>  è¿›å…¥é˜»å¡ï¼Œè€Œ  <code>P</code>  æ­¤æ—¶çš„çŠ¶æ€å°±æ˜¯  <code>syscall</code> ï¼Œè¡¨æ˜è¿™ä¸ª  <code>P</code>  çš„  <code>G</code>  æ­£åœ¨  <code>syscall</code>  ä¸­ï¼Œè¿™æ—¶çš„  <code>P</code>  æ˜¯ä¸èƒ½è¢«è°ƒåº¦ç»™åˆ«çš„  <code>M</code>  çš„ã€‚å¦‚æœåœ¨çŸ­æ—¶é—´å†…é˜»å¡çš„  <code>M</code>  å°±å”¤é†’äº†ï¼Œé‚£ä¹ˆ  <code>M</code>  ä¼šä¼˜å…ˆæ¥é‡æ–°è·å–è¿™ä¸ª  <code>P</code> ï¼Œèƒ½è·å–åˆ°å°±ç»§ç»­ç»‘å›å»ï¼Œè¿™æ ·æœ‰åˆ©äºæ•°æ®çš„å±€éƒ¨æ€§ã€‚<br>\nç³»ç»Ÿç›‘è§†å™¨ ( <code>system monitor</code> )ï¼Œç§°ä¸º  <code>sysmon</code> ï¼Œä¼šå®šæ—¶æ‰«æã€‚åœ¨æ‰§è¡Œ  <code>syscall</code>  æ—¶ï¼Œå¦‚æœæŸä¸ª  <code>P</code>  çš„  <code>G</code>  æ‰§è¡Œè¶…è¿‡ä¸€ä¸ª  <code>sysmon tick</code> ( <code>10ms</code> )ï¼Œå°±ä¼šæŠŠä»–è®¾ä¸º  <code>idle</code> ï¼Œé‡æ–°è°ƒåº¦ç»™éœ€è¦çš„  <code>M</code> ï¼Œå¼ºåˆ¶è§£ç»‘ã€‚</p>\n<p><img data-src=\"/images/go/13-53.png\" alt=\"\"></p>\n<p><code>P3</code>  å’Œ  <code>M</code>  è„±ç¦»åç›®å‰åœ¨  <code>idle list</code>  ä¸­ç­‰å¾…è¢«ç»‘å®šï¼ˆå¤„äº  <code>syscall</code>  çŠ¶æ€ï¼‰ã€‚è€Œ  <code>syscall</code>  ç»“æŸå  <code>M</code>  æŒ‰ç…§å¦‚ä¸‹è§„åˆ™æ‰§è¡Œç›´åˆ°æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶ï¼š</p>\n<ul>\n<li>å°è¯•è·å–åŒä¸€ä¸ª  <code>P</code> ( <code>P3</code> )ï¼Œæ¢å¤æ‰§è¡Œ  <code>G</code></li>\n<li>å°è¯•è·å–  <code>idle list</code>  ä¸­çš„å…¶ä»–ç©ºé—²  <code>P</code> ï¼Œæ¢å¤æ‰§è¡Œ  <code>G</code></li>\n<li>æ‰¾ä¸åˆ°ç©ºé—²  <code>P</code> ï¼ŒæŠŠ  <code>G</code>  æ”¾å›  <code>global queue</code> ï¼Œ <code>M</code>  æ”¾å›åˆ°  <code>idle list</code></li>\n</ul>\n<p>å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼š<br>\nå¦‚ä¸‹å›¾.<br>\n<img data-src=\"/images/go/13-54.png\" alt=\"\"></p>\n<ul>\n<li>ç¬¬ä¸€æ­¥ï¼š  <code>G35</code>  å‘ç”Ÿäº†ç³»ç»Ÿè°ƒç”¨ï¼Œé•¿æ—¶é—´æ²¡æœ‰è¿”å›ã€‚  <code>P1</code>  å’Œ  <code>M</code>  è§£ç»‘ã€‚( <code>p1</code>  ä¸ä¼šé©¬ä¸Šè¢«æ¨é€åˆ° <code>idle list</code> , è€Œæ˜¯ç»è¿‡ä¸€æ®µæ—¶é—´æ‰ä¼šæ¨é€åˆ° <code>idle list.</code> )</li>\n<li>ç¬¬äºŒæ­¥ï¼š <code>G35</code>  ç³»ç»Ÿè°ƒç”¨å®Œæˆï¼Œå°† <code>G35</code>  æ¨å‘äº†å…¨å±€é˜Ÿåˆ—.</li>\n<li>ç¬¬ä¸‰æ­¥ï¼š <code>G35</code>  è¢«å…¶ä»–çš„ P æåˆ°äº† (å¯èƒ½ <code>P0</code>  ç»è¿‡ <code>1/61</code>  è½®æ¬¡æ­£å¥½ <code>check</code>  å…¨å±€é˜Ÿåˆ—)ï¼Œ è¿™æ ·  <code>G35</code>  å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚</li>\n</ul>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š å½“ä½¿ç”¨äº†  <code>Syscall</code> ï¼Œ <code>Go</code>  æ— æ³•é™åˆ¶  <code>Blocked OS threads</code>  çš„æ•°é‡ï¼š<br>\n <code>The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously. There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit. This packageâ€™s GOMAXPROCS function queries and changes the limit.</code></p>\n<p><code>Tips</code> : ä½¿ç”¨  <code>syscall</code>  å†™ç¨‹åºè¦è®¤çœŸè€ƒè™‘  <code>pthread exhaust</code>  é—®é¢˜ã€‚</p>\n<h3 id=\"spining-thread\"><a class=\"markdownIt-Anchor\" href=\"#spining-thread\">#</a> Spining Thread.</h3>\n<p>çº¿ç¨‹è‡ªæ—‹æ˜¯ç›¸å¯¹äºçº¿ç¨‹é˜»å¡è€Œè¨€çš„ï¼Œè¡¨è±¡å°±æ˜¯å¾ªç¯æ‰§è¡Œä¸€ä¸ªæŒ‡å®šé€»è¾‘ (è°ƒåº¦é€»è¾‘ï¼Œç›®çš„æ˜¯ä¸åœåœ°å¯»æ‰¾ G)ã€‚è¿™æ ·åšçš„é—®é¢˜æ˜¾è€Œæ˜“è§ï¼Œå¦‚æœ  <code>G</code>  è¿Ÿè¿Ÿä¸æ¥ï¼Œ <code>CPU</code>  ä¼šç™½ç™½æµªè´¹åœ¨è¿™æ— æ„ä¹‰çš„è®¡ç®—ä¸Šã€‚ä½†å¥½å¤„ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé™ä½äº† M çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ï¼Œæé«˜äº†æ€§èƒ½ã€‚åœ¨ä¸¤ä¸ªåœ°æ–¹å¼•å…¥è‡ªæ—‹ï¼š</p>\n<ul>\n<li>ç±»å‹ 1:  <code>M</code>  ä¸å¸¦  <code>P</code>  çš„æ‰¾  <code>P</code>  æŒ‚è½½ï¼ˆä¸€æœ‰  <code>P</code>  é‡Šæ”¾å°±ç»“åˆï¼‰</li>\n<li>ç±»å‹ 2:  <code>M</code>  å¸¦  <code>P</code>  çš„æ‰¾  <code>G</code>  è¿è¡Œï¼ˆä¸€æœ‰  <code>runable</code>  çš„  <code>G</code>  å°±æ‰§è¡Œï¼‰ã€‚ è¿™ç§æƒ…å†µä¸‹ä¼šé¦–å…ˆ æŒ‰ç…§  <code>1/61</code>  è½®æ¬¡çš„æŸ¥è¯¢  <code>global Queue</code>  , ç„¶åå†æŸ¥çœ‹  <code>local Queue</code>  æ˜¯å¦æœ‰  <code>G</code> . å¦‚æœæ²¡æœ‰ï¼Œåˆ™å»æŸ¥çœ‹  <code>Global Queue</code> , å¦‚æœæ²¡æœ‰åœ¨å»æ£€æŸ¥   <code>net poller</code> , çœ‹çœ‹æ˜¯å¦æœ‰å¯ç”¨çš„  <code>goroutine</code> .<br>\n ä¸ºäº†é¿å…è¿‡å¤šæµªè´¹  <code>CPU</code>  èµ„æºï¼Œè‡ªæ—‹çš„  <code>M</code>  æœ€å¤šåªå…è®¸  <code>GOMAXPROCS</code>  ( <code>Busy P</code> )ã€‚åŒæ—¶å½“æœ‰ç±»å‹ 1 çš„è‡ªæ—‹  <code>M</code>  å­˜åœ¨æ—¶ï¼Œç±»å‹ <code>2</code>  çš„è‡ªæ—‹  <code>M</code>  å°±ä¸é˜»å¡ï¼Œé˜»å¡ä¼šé‡Šæ”¾  <code>P</code> ï¼Œä¸€é‡Šæ”¾  <code>P</code>  å°±é©¬ä¸Šè¢«ç±»å‹ <code>1</code>  çš„è‡ªæ—‹  <code>M</code>  æŠ¢èµ°äº†ï¼Œæ²¡å¿…è¦ã€‚</li>\n</ul>\n<p>åœ¨æ–°  <code>G</code>  è¢«åˆ›å»ºã€ <code>M</code>  è¿›å…¥ç³»ç»Ÿè°ƒç”¨ã€ <code>M</code>  ä»ç©ºé—²è¢«æ¿€æ´»è¿™ä¸‰ç§çŠ¶æ€å˜åŒ–å‰ï¼Œè°ƒåº¦å™¨ä¼šç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªè‡ªæ—‹  <code>M</code>  å­˜åœ¨ï¼ˆå”¤é†’æˆ–è€…åˆ›å»ºä¸€ä¸ª  <code>M</code> ï¼‰ï¼Œé™¤éæ²¡æœ‰ç©ºé—²çš„  <code>P</code> ã€‚</p>\n<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<ul>\n<li>å½“æ–°  <code>G</code>  åˆ›å»ºï¼Œå¦‚æœæœ‰å¯ç”¨  <code>P</code> ï¼Œå°±æ„å‘³ç€æ–°  <code>G</code>  å¯ä»¥è¢«ç«‹å³æ‰§è¡Œï¼Œå³ä¾¿ä¸åœ¨åŒä¸€ä¸ª  <code>P</code>  ä¹Ÿæ— å¦¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿ç•™ä¸€ä¸ªè‡ªæ—‹çš„ Mï¼ˆè¿™æ—¶åº”è¯¥ä¸å­˜åœ¨ç±»å‹ 1 çš„è‡ªæ—‹åªæœ‰ç±»å‹ 2 çš„è‡ªæ—‹ï¼‰å°±å¯ä»¥ä¿è¯æ–° G å¾ˆå¿«è¢«è¿è¡Œã€‚</li>\n<li>å½“  <code>M</code>  è¿›å…¥ç³»ç»Ÿè°ƒç”¨ï¼Œæ„å‘³ç€  <code>M</code>  ä¸çŸ¥é“ä½•æ—¶å¯ä»¥é†’æ¥ï¼Œé‚£ä¹ˆ  <code>M</code>  å¯¹åº”çš„  <code>P</code>  ä¸­å‰©ä¸‹çš„  <code>G</code>  å°±å¾—æœ‰æ–°çš„  <code>M</code>  æ¥æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿ç•™ä¸€ä¸ªè‡ªæ—‹çš„  <code>M</code>  æ¥æ‰§è¡Œå‰©ä¸‹çš„  <code>G</code> ï¼ˆè¿™æ—¶åº”è¯¥ä¸å­˜åœ¨ç±»å‹ <code>2</code>  çš„è‡ªæ—‹åªæœ‰ç±»å‹ <code>1</code>  çš„è‡ªæ—‹ï¼‰ã€‚</li>\n<li>å¦‚æœ  <code>M</code>  ä»ç©ºé—²å˜æˆæ´»è·ƒï¼Œæ„å‘³ç€å¯èƒ½ä¸€ä¸ªå¤„äºè‡ªæ—‹çŠ¶æ€çš„  <code>M</code>  è¿›å…¥å·¥ä½œçŠ¶æ€äº†ï¼Œè¿™æ—¶è¦æ£€æŸ¥å¹¶ç¡®ä¿è¿˜æœ‰ä¸€ä¸ªè‡ªæ—‹  <code>M</code>  å­˜åœ¨ï¼Œä»¥é˜²è¿˜æœ‰  <code>G</code>  æˆ–è€…è¿˜æœ‰  <code>P</code>  ç©ºç€çš„ã€‚</li>\n</ul>\n<h3 id=\"gmp-æ¨¡å‹é—®é¢˜æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#gmp-æ¨¡å‹é—®é¢˜æ€»ç»“\">#</a>  <code>GMP</code>  æ¨¡å‹é—®é¢˜æ€»ç»“</h3>\n<ul>\n<li>å•ä¸€å…¨å±€äº’æ–¥é” ( <code>Sched.Lock</code> ) å’Œé›†ä¸­çŠ¶æ€å­˜å‚¨<br>\n <code>G</code>  è¢«åˆ†æˆå…¨å±€é˜Ÿåˆ—å’Œ  <code>P</code>  çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå…¨å±€é˜Ÿåˆ—ä¾æ—§æ˜¯å…¨å±€é”ï¼Œä½†æ˜¯ä½¿ç”¨åœºæ™¯æ˜æ˜¾å¾ˆå°‘ï¼Œ <code>P</code>  æœ¬åœ°é˜Ÿåˆ—ä½¿ç”¨æ— é”é˜Ÿåˆ—ï¼Œä½¿ç”¨åŸå­æ“ä½œæ¥é¢å¯¹å¯èƒ½çš„å¹¶å‘åœºæ™¯ã€‚</li>\n<li><code>Goroutine</code>  ä¼ é€’é—®é¢˜<br>\n <code>G</code>  åˆ›å»ºæ—¶å°±åœ¨  <code>P</code>  çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¯ä»¥é¿å…åœ¨  <code>G</code>  ä¹‹é—´ä¼ é€’ï¼ˆçªƒå–é™¤å¤–ï¼‰ï¼Œ <code>G</code>  å¯¹  <code>P</code>  çš„æ•°æ®å±€éƒ¨æ€§å¥½ï¼›å½“  <code>G</code>  å¼€å§‹æ‰§è¡Œäº†ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›å  <code>M</code>  ä¼šå°è¯•è·å–å¯ç”¨  <code>P</code> ï¼Œè·å–åˆ°äº†çš„è¯å¯ä»¥é¿å…åœ¨  <code>M</code>  ä¹‹é—´ä¼ é€’ã€‚è€Œä¸”ä¼˜å…ˆè·å–è°ƒç”¨é˜»å¡å‰çš„  <code>P</code> ï¼Œæ‰€ä»¥  <code>G</code>  å¯¹  <code>M</code>  æ•°æ®å±€éƒ¨æ€§å¥½ï¼Œ <code>G</code>  å¯¹  <code>P</code>  çš„æ•°æ®å±€éƒ¨æ€§ä¹Ÿå¥½ã€‚</li>\n<li><code>Per-M</code>  æŒæœ‰å†…å­˜ç¼“å­˜ ( <code>M.mcache</code> )<br>\n å†…å­˜  <code>mcache</code>  åªå­˜åœ¨  <code>P</code>  ç»“æ„ä¸­ï¼Œ <code>P</code>  æœ€å¤šåªæœ‰  <code>GOMAXPROCS</code>  ä¸ªï¼Œè¿œå°äº  <code>M</code>  çš„ä¸ªæ•°ï¼Œæ‰€ä»¥å†…å­˜æ²¡æœ‰è¿‡å¤šçš„æ¶ˆè€—ã€‚</li>\n<li>ä¸¥é‡çš„çº¿ç¨‹é˜»å¡ / è§£é”<br>\né€šè¿‡å¼•å…¥è‡ªæ—‹ï¼Œä¿è¯ä»»ä½•æ—¶å€™éƒ½æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„è‡ªæ—‹ Mï¼Œé¿å…åœ¨ç­‰å¾…å¯ç”¨çš„  <code>P</code>  å’Œ  <code>G</code>  æ—¶é¢‘ç¹çš„é˜»å¡å’Œå”¤é†’ã€‚</li>\n</ul>\n<h3 id=\"syscon\"><a class=\"markdownIt-Anchor\" href=\"#syscon\">#</a> syscon</h3>\n<p><code>sysmon</code>  ä¹Ÿå«ç›‘æ§çº¿ç¨‹ï¼Œå®ƒ<b>æ— éœ€  <code>P</code>  ä¹Ÿå¯ä»¥è¿è¡Œ</b>ï¼Œä»–æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œæ¯ <code>20us~10ms</code>  å¾ªç¯ä¸€æ¬¡ï¼Œå¾ªç¯å®Œä¸€æ¬¡å°±  <code>sleep</code>  ä¸€ä¼šï¼Œä¸ºä»€ä¹ˆä¼šæ˜¯ä¸€ä¸ªå˜åŠ¨çš„å‘¨æœŸå‘¢ï¼Œä¸»è¦æ˜¯é¿å…ç©ºè½¬ï¼Œå¦‚æœæ¯æ¬¡å¾ªç¯éƒ½æ²¡ä»€ä¹ˆéœ€è¦åšçš„äº‹ï¼Œé‚£ä¹ˆ  <code>sleep</code>  çš„æ—¶é—´å°±ä¼šåŠ å¤§ã€‚</p>\n<ul>\n<li>é‡Šæ”¾é—²ç½®è¶…è¿‡ <code>5</code>  åˆ†é’Ÿçš„  <code>span</code>  ç‰©ç†å†…å­˜ï¼›</li>\n<li>å¦‚æœè¶…è¿‡ 2 åˆ†é’Ÿæ²¡æœ‰åƒåœ¾å›æ”¶ï¼Œå¼ºåˆ¶æ‰§è¡Œï¼›</li>\n<li>å°†é•¿æ—¶é—´æœªå¤„ç†çš„  <code>netpoll</code>  æ·»åŠ åˆ°å…¨å±€é˜Ÿåˆ—ï¼›</li>\n<li>å‘é•¿æ—¶é—´è¿è¡Œçš„  <code>G</code>  ä»»åŠ¡å‘å‡ºæŠ¢å è°ƒåº¦ï¼›</li>\n<li>æ”¶å›å›   <code>syscall</code>  é•¿æ—¶é—´é˜»å¡çš„  <code>P</code> ï¼›</li>\n</ul>\n<p><img data-src=\"/images/go/13-55.png\" alt=\"\"></p>\n<p>å½“  <code>P</code>  åœ¨  <code>M</code>  ä¸Šæ‰§è¡Œæ—¶é—´è¶…è¿‡ <code>10ms</code> ï¼Œ <code>sysmon</code>  è°ƒç”¨  <code>preemptone</code>  å°†  <code>G</code>  æ ‡è®°ä¸º  <code>stackPreempt</code>  ã€‚å› æ­¤éœ€è¦åœ¨æŸä¸ªåœ°æ–¹è§¦å‘æ£€æµ‹é€»è¾‘ï¼Œ <code>Go</code>  å½“å‰æ˜¯åœ¨æ£€æŸ¥æ ˆæ˜¯å¦æº¢å‡ºçš„åœ°æ–¹åˆ¤å®š ( <code>morestack()</code> )ï¼Œ <code>M</code>  ä¼šä¿å­˜å½“å‰  <code>G</code>  çš„ä¸Šä¸‹æ–‡ï¼Œé‡æ–°è¿›å…¥è°ƒåº¦é€»è¾‘ï¼Œè¿™æ ·å°±ä¸ä¼šæ­»å¾ªç¯äº†ã€‚<br>\næ­»å¾ªç¯ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dvbGFuZy9nby9pc3N1ZXMvMTE0NjI=\">issues/11462</span><br>\n ä¿¡å·æŠ¢å ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL3hpYW9ydWkuY2MvYXJjaGl2ZXMvNjUzNQ==\">go1.14 åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦å®ç°åŸç†</span><br>\nå¼‚æ­¥æŠ¢å ï¼Œæ³¨å†Œ  <code>sigurg</code>  ä¿¡å·ï¼Œé€šè¿‡  <code>sysmon</code>  æ£€æµ‹ï¼Œå¯¹  <code>M</code>  å¯¹åº”çš„çº¿ç¨‹å‘é€ä¿¡å·ï¼Œè§¦å‘æ³¨å†Œçš„  <code>handler</code> ï¼Œå®ƒå¾€å½“å‰  <code>G</code>  çš„  <code>PC</code>  ä¸­æ’å…¥ä¸€æ¡æŒ‡ä»¤ (è°ƒç”¨æŸä¸ªæ–¹æ³•)ï¼Œåœ¨å¤„ç†å®Œ  <code>handler</code> ï¼Œ <code>G</code>  æ¢å¤åï¼Œè‡ªå·±æŠŠè‡ªå·±æ¨åˆ°äº†  <code>global queue</code>  ä¸­ã€‚<br>\n<img data-src=\"/images/go/13-56.png\" alt=\"\"></p>\n<h3 id=\"network-poller\"><a class=\"markdownIt-Anchor\" href=\"#network-poller\">#</a> Network poller</h3>\n<p><code>Go</code>  æ‰€æœ‰çš„  <code>I/O</code>  éƒ½æ˜¯é˜»å¡çš„ã€‚ç„¶åé€šè¿‡  <code>goroutine + channel</code>  æ¥å¤„ç†å¹¶å‘ã€‚å› æ­¤æ‰€æœ‰çš„  <code>IO</code>  é€»è¾‘éƒ½æ˜¯ç›´æ¥ç›´å»çš„ï¼Œä½ ä¸å†éœ€è¦å›è°ƒï¼Œä¸å†éœ€è¦  <code>future</code> ï¼Œè¦çš„ä»…ä»…æ˜¯  <code>step by step</code> ã€‚è¿™å¯¹äºä»£ç çš„å¯è¯»æ€§æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚<br>\n <code>G</code>  å‘èµ·ç½‘ç»œ  <code>I/O</code>  æ“ä½œä¹Ÿä¸ä¼šå¯¼è‡´  <code>M</code>  è¢«é˜»å¡ (ä»…é˜»å¡ <code>G</code> )ï¼Œä»è€Œä¸ä¼šå¯¼è‡´å¤§é‡  <code>M</code>  è¢«åˆ›å»ºå‡ºæ¥ã€‚å°†å¼‚æ­¥  <code>I/O</code>  è½¬æ¢ä¸ºé˜»å¡  <code>I/O</code>  çš„éƒ¨åˆ†ç§°ä¸º  <code>netpoller</code> ã€‚æ‰“å¼€æˆ–æ¥å—è¿æ¥éƒ½è¢«è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚å¦‚æœä½ è¯•å›¾å¯¹å…¶è¿›è¡Œ  <code>I/O</code>  æ“ä½œï¼Œå¹¶ä¸”æ–‡ä»¶æè¿°ç¬¦æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œ <code>G</code>  ä¼šè¿›å…¥  <code>gopark</code>  å‡½æ•°ï¼Œå°†å½“å‰æ­£åœ¨æ‰§è¡Œçš„  <code>G</code>  çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œç„¶ååˆ‡æ¢åˆ°æ–°çš„å †æ ˆä¸Šæ‰§è¡Œæ–°çš„  <code>G</code> ã€‚</p>\n<p><img data-src=\"/images/go/13-57.png\" alt=\"\"></p>\n<p>é‚£ä»€ä¹ˆæ—¶å€™  <code>G</code>  è¢«è°ƒåº¦å›æ¥å‘¢ï¼Ÿ</p>\n<ul>\n<li><code>sysmon</code></li>\n<li><code>schedule()</code> ï¼š <code>M</code>  æ‰¾  <code>G</code>  çš„è°ƒåº¦å‡½æ•°</li>\n<li><code>GC</code> ï¼š <code>start the world</code> <br>\n è°ƒç”¨  <code>netpoll()</code>  åœ¨æŸä¸€æ¬¡è°ƒåº¦  <code>G</code>  çš„è¿‡ç¨‹ä¸­ï¼Œå¤„äºå°±ç»ªçŠ¶æ€çš„  <code>fd</code>  å¯¹åº”çš„  <code>G</code>  å°±ä¼šè¢«è°ƒåº¦å›æ¥ã€‚<br>\n <code>G</code>  çš„  <code>gopark</code>  çŠ¶æ€ï¼š <code>G</code>  ç½®ä¸º  <code>waiting</code>  çŠ¶æ€ï¼Œç­‰å¾…æ˜¾ç¤º  <code>goready</code>  å”¤é†’ï¼Œåœ¨  <code>poller</code>  ä¸­ç”¨å¾—è¾ƒå¤šï¼Œè¿˜æœ‰é”ã€ <code>chan</code>  ç­‰ã€‚</li>\n</ul>\n<p><img data-src=\"/images/go/13-58.png\" alt=\"\"></p>\n<h3 id=\"scheduler-affinity-è°ƒåº¦äº²å’Œæ€§\"><a class=\"markdownIt-Anchor\" href=\"#scheduler-affinity-è°ƒåº¦äº²å’Œæ€§\">#</a> Scheduler Affinity è°ƒåº¦äº²å’Œæ€§</h3>\n<p><img data-src=\"/images/go/13-59.png\" alt=\"\"></p>\n<p><code>GM</code>  è°ƒåº¦å™¨æ—¶ä»£çš„ï¼Œ <code>chan</code>  æ“ä½œå¯¼è‡´çš„åˆ‡æ¢ä»£ä»·ã€‚</p>\n<ul>\n<li><code>Goroutine#7</code>  æ­£åœ¨ç­‰å¾…æ¶ˆæ¯ï¼Œé˜»å¡åœ¨  <code>chan</code> ã€‚ä¸€æ—¦æ”¶åˆ°æ¶ˆæ¯ï¼Œè¿™ä¸ª  <code>goroutine</code>  å°±è¢«æ¨åˆ°å…¨å±€é˜Ÿåˆ—ã€‚</li>\n<li>ç„¶åï¼Œ <code>chan</code>  æ¨é€æ¶ˆæ¯ï¼Œ <code>goroutine#X</code>  å°†åœ¨å¯ç”¨çº¿ç¨‹ä¸Šè¿è¡Œï¼Œè€Œ  <code>goroutine#8</code>  å°†é˜»å¡åœ¨  <code>chan</code> ã€‚</li>\n<li><code>goroutine#7</code>  ç°åœ¨åœ¨å¯ç”¨çº¿ç¨‹ä¸Šè¿è¡Œã€‚<br>\nåœ¨  <code>chan</code>  æ¥å›é€šä¿¡çš„  <code>goroutine</code>  ä¼šå¯¼è‡´é¢‘ç¹çš„  <code>blocks</code> ï¼Œå³é¢‘ç¹åœ°åœ¨æœ¬åœ°é˜Ÿåˆ—ä¸­é‡æ–°æ’é˜Ÿã€‚ç„¶è€Œï¼Œç”±äºæœ¬åœ°é˜Ÿåˆ—æ˜¯  <code>FIFO</code>  å®ç°ï¼Œå¦‚æœå¦ä¸€ä¸ª  <code>goroutine</code>  å ç”¨çº¿ç¨‹ï¼Œ <code>unblock goroutine</code>  ä¸èƒ½ä¿è¯å°½å¿«è¿è¡Œã€‚åŒæ—¶  <code>Go</code>  äº²ç¼˜æ€§è°ƒåº¦çš„ä¸€äº›é™åˆ¶ï¼š <code>Work-stealing</code> ã€ç³»ç»Ÿè°ƒç”¨ã€‚<br>\n <code>goroutine #9</code>  åœ¨  <code>chan</code>  è¢«é˜»å¡åæ¢å¤ã€‚ä½†æ˜¯ï¼Œå®ƒå¿…é¡»ç­‰å¾… <code>#2</code> ã€ <code>#5</code>  å’Œ <code>#4</code>  ä¹‹åæ‰èƒ½è¿è¡Œã€‚ <code>goroutine #5</code>  å°†é˜»å¡å…¶çº¿ç¨‹ï¼Œä»è€Œå»¶è¿Ÿ <code>goroutine #9</code> ï¼Œå¹¶ä½¿å…¶é¢ä¸´è¢«å¦ä¸€ä¸ª  <code>P</code>  çªƒå–çš„é£é™©ã€‚<br>\n<img data-src=\"/images/go/13-60.png\" alt=\"\"></li>\n</ul>\n<p>é’ˆå¯¹  <code>communicate-and-wait</code>  æ¨¡å¼ï¼Œè¿›è¡Œäº†äº²ç¼˜æ€§è°ƒåº¦çš„ä¼˜åŒ–ã€‚ <code>Go 1.5</code>  åœ¨  <code>P</code>  ä¸­å¼•å…¥äº†  <code>runnext</code>  ç‰¹æ®Šçš„ä¸€ä¸ªå­—æ®µï¼Œå¯ä»¥é«˜ä¼˜å…ˆçº§æ‰§è¡Œ  <code>unblock G</code> ã€‚<br>\n <code>goroutine #9</code>  ç°åœ¨è¢«æ ‡è®°ä¸ºä¸‹ä¸€ä¸ªå¯è¿è¡Œçš„ã€‚è¿™ç§æ–°çš„ä¼˜å…ˆçº§æ’åºå…è®¸  <code>goroutine</code>  åœ¨å†æ¬¡è¢«é˜»å¡ä¹‹å‰å¿«é€Ÿè¿è¡Œã€‚è¿™ä¸€å˜åŒ–å¯¹è¿è¡Œä¸­çš„æ ‡å‡†åº“äº§ç”Ÿäº†æ€»ä½“ä¸Šçš„ç§¯æå½±å“ï¼Œæé«˜äº†ä¸€äº›åŒ…çš„æ€§èƒ½ã€‚<br>\n<img data-src=\"/images/go/13-61.png\" alt=\"\"></p>\n<h2 id=\"goroutine-lifecycle\"><a class=\"markdownIt-Anchor\" href=\"#goroutine-lifecycle\">#</a> Goroutine Lifecycle</h2>\n<h3 id=\"go-ç¨‹åºçš„å¯åŠ¨\"><a class=\"markdownIt-Anchor\" href=\"#go-ç¨‹åºçš„å¯åŠ¨\">#</a> go ç¨‹åºçš„å¯åŠ¨</h3>\n<p><img data-src=\"/images/go/13-62.png\" alt=\"\"></p>\n<p>æ•´ä¸ªç¨‹åºå§‹äºä¸€æ®µæ±‡ç¼–ï¼Œè€Œåœ¨éšåçš„ runtimeãƒ»rt0_goï¼ˆä¹Ÿæ˜¯æ±‡ç¼–ç¨‹åºï¼‰ä¸­ï¼Œä¼šæ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–å·¥ä½œã€‚</p>\n<p><img data-src=\"/images/go/13-63.png\" alt=\"\"></p>\n<ul>\n<li>ç»‘å®š m0 å’Œ g0ï¼Œm0 å°±æ˜¯ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼Œç¨‹åºå¯åŠ¨å¿…ç„¶ä¼šæ‹¥æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œè¿™ä¸ªå°±æ˜¯ m0ã€‚g0 è´Ÿè´£è°ƒåº¦ï¼Œå³ shedule () å‡½æ•°ã€‚</li>\n<li>åˆ›å»º Pï¼Œç»‘å®š m0 å’Œ p0ï¼Œé¦–å…ˆä¼šåˆ›å»º GOMAXPROCS ä¸ª P ï¼Œå­˜å‚¨åœ¨ sched çš„ ç©ºé—²é“¾è¡¨ (pidle)ã€‚</li>\n<li>æ–°å»ºä»»åŠ¡ g åˆ° p0 æœ¬åœ°é˜Ÿåˆ—ï¼Œm0 çš„ g0 ä¼šåˆ›å»ºä¸€ä¸ª æŒ‡å‘ runtime.main () çš„ g ï¼Œå¹¶æ”¾åˆ° p0 çš„æœ¬åœ°é˜Ÿåˆ—ã€‚<br>\nruntime.main (): å¯åŠ¨ sysmon çº¿ç¨‹ï¼›å¯åŠ¨ GC åç¨‹ï¼›æ‰§è¡Œ initï¼Œå³ä»£ç ä¸­çš„å„ç§ init å‡½æ•°ï¼›æ‰§è¡Œ main.main å‡½æ•°ã€‚</li>\n</ul>\n<h4 id=\"os-thread-åˆ›å»º\"><a class=\"markdownIt-Anchor\" href=\"#os-thread-åˆ›å»º\">#</a> Os Thread åˆ›å»º</h4>\n<p>å‡†å¤‡è¿è¡Œçš„æ–° goroutine å°†å”¤é†’ P ä»¥æ›´å¥½åœ°åˆ†å‘å·¥ä½œã€‚è¿™ä¸ª P å°†åˆ›å»ºä¸€ä¸ªä¸ä¹‹å…³è”çš„ M ç»‘å®šåˆ°ä¸€ä¸ª OS threadã€‚<br>\n<img data-src=\"/images/go/13-64.png\" alt=\"\"><br>\n<img data-src=\"/images/go/13-66.png\" alt=\"\"></p>\n<p><code>go func()</code>  ä¸­ è§¦å‘  <code>Wakeup</code>  å”¤é†’æœºåˆ¶ï¼š<br>\næœ‰ç©ºé—²çš„  <code>P</code>  è€Œæ²¡æœ‰åœ¨  <code>spinning</code>  çŠ¶æ€çš„ M æ—¶å€™ï¼Œéœ€è¦å»å”¤é†’ä¸€ä¸ªç©ºé—² (ç¡çœ ) çš„  <code>M</code>  æˆ–è€…æ–°å»ºä¸€ä¸ªã€‚å½“çº¿ç¨‹é¦–æ¬¡åˆ›å»ºæ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªç‰¹æ®Šçš„  <code>G</code> ï¼Œå³  <code>g0</code> ï¼Œå®ƒè´Ÿè´£ç®¡ç†å’Œè°ƒåº¦  <code>G</code> ã€‚<br>\n<img data-src=\"/images/go/13-65.png\" alt=\"\"></p>\n<h4 id=\"ç‰¹æ®Šçš„g0\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹æ®Šçš„g0\">#</a> ç‰¹æ®Šçš„ g0</h4>\n<p><code>Go</code>  åŸºäºä¸¤ç§æ–­ç‚¹å°†  <code>G</code>  è°ƒåº¦åˆ°çº¿ç¨‹ä¸Šï¼š</p>\n<ul>\n<li>å½“  <code>G</code>  é˜»å¡æ—¶ï¼šç³»ç»Ÿè°ƒç”¨ã€äº’æ–¥é”æˆ–  <code>chan</code> ã€‚é˜»å¡çš„  <code>G</code>  è¿›å…¥ç¡çœ æ¨¡å¼ / è¿›å…¥é˜Ÿåˆ—ï¼Œå¹¶å…è®¸  <code>Go</code>  å®‰æ’å’Œè¿è¡Œç­‰å¾…å…¶ä»–çš„  <code>G</code> ã€‚</li>\n<li>åœ¨å‡½æ•°è°ƒç”¨æœŸé—´ï¼Œå¦‚æœ  <code>G</code>  å¿…é¡»æ‰©å±•å…¶å †æ ˆã€‚è¿™ä¸ªæ–­ç‚¹å…è®¸  <code>Go</code>  è°ƒåº¦å¦ä¸€ä¸ª  <code>G</code>  å¹¶é¿å…è¿è¡Œ  <code>G</code>  å ç”¨  <code>CPU</code> ã€‚<br>\nåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œè¿è¡Œè°ƒåº¦ç¨‹åºçš„  <code>g0</code>  å°†å½“å‰  <code>G</code>  æ›¿æ¢ä¸ºå¦ä¸€ä¸ª  <code>G</code> ï¼Œå³  <code>ready to run</code> ã€‚ç„¶åï¼Œé€‰æ‹©çš„  <code>G</code>  æ›¿æ¢  <code>g0</code>  å¹¶åœ¨çº¿ç¨‹ä¸Šè¿è¡Œã€‚ä¸å¸¸è§„  <code>G</code>  ç›¸åï¼Œ <code>g0</code>  æœ‰ä¸€ä¸ªå›ºå®šå’Œæ›´å¤§çš„æ ˆã€‚</li>\n<li><code>Defer</code>  å‡½æ•°çš„åˆ†é…</li>\n<li><code>GC</code>  æ”¶é›†ï¼Œæ¯”å¦‚  <code>STW</code> ã€æ‰«æ  <code>G</code>  çš„å †æ ˆå’Œæ ‡è®°ã€æ¸…é™¤æ“ä½œ</li>\n<li>æ ˆæ‰©å®¹ï¼Œå½“éœ€è¦çš„æ—¶å€™ï¼Œç”±  <code>g0</code>  è¿›è¡Œæ‰©æ ˆæ“ä½œ</li>\n</ul>\n<p><img data-src=\"/images/go/13-67.png\" alt=\"\"></p>\n<h4 id=\"schedule\"><a class=\"markdownIt-Anchor\" href=\"#schedule\">#</a> Schedule</h4>\n<p>åœ¨  <code>Go</code>  ä¸­ï¼Œ <code>G</code>  çš„åˆ‡æ¢ç›¸å½“è½»ä¾¿ï¼Œå…¶ä¸­éœ€è¦ä¿å­˜çš„çŠ¶æ€ä»…ä»…æ¶‰åŠä»¥ä¸‹ä¸¤ä¸ªï¼š</p>\n<ul>\n<li><code>Goroutine</code>  åœ¨åœæ­¢è¿è¡Œå‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œç¨‹åºå½“å‰è¦è¿è¡Œçš„æŒ‡ä»¤æ˜¯è®°å½•åœ¨ç¨‹åºè®¡æ•°å™¨ï¼ˆ <code>PC</code> ï¼‰ä¸­çš„ï¼Œ  <code>G</code>  ç¨åå°†åœ¨åŒä¸€æŒ‡ä»¤å¤„æ¢å¤è¿è¡Œï¼›</li>\n<li><code>G</code>  çš„å †æ ˆï¼Œä»¥ä¾¿åœ¨å†æ¬¡è¿è¡Œæ—¶è¿˜åŸå±€éƒ¨å˜é‡ï¼›åœ¨åˆ‡æ¢ä¹‹å‰ï¼Œå †æ ˆå°†è¢«ä¿å­˜ï¼Œä»¥ä¾¿åœ¨  <code>G</code>  å†æ¬¡è¿è¡Œæ—¶è¿›è¡Œæ¢å¤ï¼š</li>\n</ul>\n<p><img data-src=\"/images/go/13-68.png\" alt=\"\"><br>\n<img data-src=\"/images/go/13-69.png\" alt=\"\"><br>\n<img data-src=\"/images/go/13-70.png\" alt=\"\"><br>\n<img data-src=\"/images/go/13-71.png\" alt=\"\"></p>\n<p>ä»  <code>g</code>  åˆ°  <code>g0</code>  æˆ–ä»  <code>g0</code>  åˆ°  <code>g</code>  çš„åˆ‡æ¢æ˜¯ç›¸å½“è¿…é€Ÿçš„ï¼Œå®ƒä»¬åªåŒ…å«å°‘é‡å›ºå®šçš„æŒ‡ä»¤ ( <code>9-10ns</code> )ã€‚ç›¸åï¼Œå¯¹äºè°ƒåº¦é˜¶æ®µï¼Œè°ƒåº¦ç¨‹åºéœ€è¦æ£€æŸ¥è®¸å¤šèµ„æºä»¥ä¾¿ç¡®å®šä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„  <code>G</code> ã€‚<br>\nå½“å‰  <code>g</code>  é˜»å¡åœ¨ chan ä¸Šå¹¶åˆ‡æ¢åˆ°  <code>g0</code> ï¼š</p>\n<ul>\n<li>1ã€PC å’Œå †æ ˆæŒ‡é’ˆä¸€èµ·ä¿å­˜åœ¨å†…éƒ¨ç»“æ„ä¸­ï¼›</li>\n<li>2ã€å°† g0 è®¾ç½®ä¸ºæ­£åœ¨è¿è¡Œçš„ goroutineï¼›</li>\n<li>3ã€g0 çš„å †æ ˆæ›¿æ¢å½“å‰å †æ ˆï¼›</li>\n</ul>\n<p><code>g0</code>  å¯»æ‰¾æ–°çš„  <code>Goroutine</code>  æ¥è¿è¡Œ<br>\n <code>g0</code>  ä½¿ç”¨æ‰€é€‰çš„  <code>Goroutine</code>  è¿›è¡Œåˆ‡æ¢ï¼š</p>\n<ul>\n<li>1ã€ <code>PC</code>  å’Œå †æ ˆæŒ‡é’ˆæ˜¯ä»å…¶å†…éƒ¨ç»“æ„ä¸­è·å–çš„ï¼›</li>\n<li>2ã€ç¨‹åºè·³è½¬åˆ°å¯¹åº”çš„  <code>PC</code>  åœ°å€ï¼›</li>\n</ul>\n<p><img data-src=\"/images/go/13-72.png\" alt=\"\"></p>\n<h3 id=\"goroutine-recycle\"><a class=\"markdownIt-Anchor\" href=\"#goroutine-recycle\">#</a> Goroutine Recycle</h3>\n<p><code>goroutine</code>  é‡ç”¨</p>\n<p><code>G</code>  å¾ˆå®¹æ˜“åˆ›å»ºï¼Œæ ˆå¾ˆå°ä»¥åŠå¿«é€Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚åŸºäºè¿™äº›åŸå› ï¼Œå¼€å‘äººå‘˜éå¸¸å–œæ¬¢å¹¶ä½¿ç”¨å®ƒä»¬ã€‚ç„¶è€Œï¼Œä¸€ä¸ªäº§ç”Ÿè®¸å¤š  <code>shortlive</code>  çš„  <code>G</code>  çš„ç¨‹åºå°†èŠ±è´¹ç›¸å½“é•¿çš„æ—¶é—´æ¥åˆ›å»ºå’Œé”€æ¯å®ƒä»¬ã€‚<br>\næ¯ä¸ª  <code>P</code>  ç»´æŠ¤ä¸€ä¸ª  <code>freelist G</code> ï¼Œä¿æŒè¿™ä¸ªåˆ—è¡¨æ˜¯æœ¬åœ°çš„ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸ä½¿ç”¨ä»»ä½•é”æ¥  <code>push/get</code>  ä¸€ä¸ªç©ºé—²çš„  <code>G</code> ã€‚å½“  <code>G</code>  é€€å‡ºå½“å‰å·¥ä½œæ—¶ï¼Œå®ƒå°†è¢«  <code>push</code>  åˆ°è¿™ä¸ªç©ºé—²åˆ—è¡¨ä¸­ã€‚</p>\n<p><img data-src=\"/images/go/13-73.png\" alt=\"\"></p>\n<p>ä¸ºäº†æ›´å¥½åœ°åˆ†å‘ç©ºé—²çš„  <code>G</code>  ï¼Œè°ƒåº¦å™¨ä¹Ÿæœ‰è‡ªå·±çš„åˆ—è¡¨ã€‚å®ƒå®é™…ä¸Šæœ‰ä¸¤ä¸ªåˆ—è¡¨ï¼šä¸€ä¸ªåŒ…å«å·²åˆ†é…æ ˆçš„  <code>G</code> ï¼Œå¦ä¸€ä¸ªåŒ…å«é‡Šæ”¾è¿‡å †æ ˆçš„  <code>G</code> ï¼ˆæ— æ ˆï¼‰ã€‚<br>\né”ä¿æŠ¤  <code>central list</code> ï¼Œå› ä¸ºä»»ä½• M éƒ½å¯ä»¥è®¿é—®å®ƒã€‚å½“æœ¬åœ°åˆ—è¡¨é•¿åº¦è¶…è¿‡ 64 æ—¶ï¼Œè°ƒåº¦ç¨‹åºæŒæœ‰çš„åˆ—è¡¨ä»  <code>P</code>  è·å–  <code>G</code> ã€‚ç„¶åä¸€åŠçš„  <code>G</code>  å°†ç§»åŠ¨åˆ°ä¸­å¿ƒåˆ—è¡¨ ( <code>central list</code> )ã€‚éœ€æ±‚å›æ”¶  <code>G</code>  æ˜¯ä¸€ç§èŠ‚çœåˆ†é…æˆæœ¬çš„å¥½æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œç”±äºå †æ ˆæ˜¯åŠ¨æ€å¢é•¿çš„ï¼Œç°æœ‰çš„ <code>G</code>  æœ€ç»ˆå¯èƒ½ä¼šæœ‰ä¸€ä¸ªå¤§æ ˆã€‚å› æ­¤ï¼Œ<b>å½“å †æ ˆå¢é•¿ï¼ˆå³è¶…è¿‡ <code>2K</code> ï¼‰æ—¶ï¼Œ <code>Go</code>  ä¸ä¼šä¿ç•™è¿™äº›æ ˆã€‚</b></p>\n<p><img data-src=\"/images/go/13-74.png\" alt=\"\"></p>\n<h2 id=\"references\"><a class=\"markdownIt-Anchor\" href=\"#references\">#</a> References</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybmt1LmNvbS9hcnRpY2xlcy80MTcyOA==\">https://learnku.com/articles/41728</span></p>\n",
            "tags": [
                "go",
                "go-runtimes"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/03/04/mylogs/talk_about_log/",
            "url": "https://fangjiaxiaobai.github.io/2022/03/04/mylogs/talk_about_log/",
            "title": "èŠèŠæ—¥å¿—",
            "date_published": "2022-03-04T10:18:18.000Z",
            "content_html": "<p><code>https://github.com/golang/glog</code> ï¼Œæ˜¯  <code>google</code>  æä¾›çš„ä¸€ä¸ªä¸ç»´æŠ¤çš„æ—¥å¿—åº“ï¼Œ <code>glog</code>  æœ‰å…¶ä»–è¯­è¨€çš„ä¸€äº›ç‰ˆæœ¬ï¼Œå¯¹æˆ‘å½“æ—¶ä½¿ç”¨  <code>log</code>  åº“æœ‰å¾ˆå¤§çš„å½±å“ã€‚å®ƒåŒ…å«å¦‚ä¸‹æ—¥å¿—çº§åˆ«ï¼š  <code>Info</code> ,  <code>Warning</code> ,  <code>Error</code> ,  <code>Fatal</code>  (ä¼šä¸­æ–­ç¨‹åºæ‰§è¡Œ)<br>\n è¿˜æœ‰ç±»ä¼¼  <code>log4go</code> ,  <code>loggo</code>  , <code>zap</code>  ç­‰å…¶ä»–ç¬¬ä¸‰æ–¹æ—¥å¿—åº“ï¼Œä»–ä»¬è¿˜æä¾›äº†è®¾ç½®æ—¥å¿—çº§åˆ«çš„å¯è§è¡Œï¼Œä¸€èˆ¬æä¾›æ—¥å¿—çº§åˆ«ï¼š  <code>Trace</code>  ,  <code>Debug</code>  ,  <code>Info</code>  ,  <code>Warning</code>  ,  <code>Error</code>  ,  <code>Critical</code> .</p>\n<h2 id=\"æ—¥å¿—çº§åˆ«\"><a class=\"markdownIt-Anchor\" href=\"#æ—¥å¿—çº§åˆ«\">#</a> æ—¥å¿—çº§åˆ«</h2>\n<h3 id=\"warning\"><a class=\"markdownIt-Anchor\" href=\"#warning\">#</a> Warning</h3>\n<p>æ²¡äººçœ‹è­¦å‘Šï¼Œå› ä¸ºä»å®šä¹‰ä¸Šè®²ï¼Œæ²¡æœ‰ä»€ä¹ˆå‡ºé”™ã€‚ä¹Ÿè®¸å°†æ¥ä¼šå‡ºé—®é¢˜ï¼Œä½†è¿™å¬èµ·æ¥åƒæ˜¯åˆ«äººçš„é—®é¢˜ã€‚æˆ‘ä»¬å°½å¯èƒ½çš„æ¶ˆé™¤è­¦å‘Šçº§åˆ«ï¼Œå®ƒè¦ä¹ˆæ˜¯ä¸€æ¡ä¿¡æ¯æ€§æ¶ˆæ¯ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªé”™è¯¯ã€‚æˆ‘ä»¬å‚è€ƒ  <code>Go</code>  è¯­è¨€è®¾è®¡é¢å“²å­¦ï¼Œæ‰€æœ‰è­¦å‘Šéƒ½æ˜¯é”™è¯¯ï¼Œå…¶ä»–è¯­è¨€çš„  <code>warning</code>  éƒ½å¯ä»¥å¿½ç•¥ï¼Œé™¤é  <code>IDE</code>  æˆ–è€…åœ¨  <code>CICD</code>  æµç¨‹ä¸­å¼ºåˆ¶ä»–ä»¬ä¸º  <code>error</code> ï¼Œç„¶åé€¼ç€ç¨‹åºå‘˜ä»¬å°½å¯èƒ½å»æ¶ˆé™¤ã€‚åŒæ ·çš„ï¼Œå¦‚æœæƒ³è¦æœ€ç»ˆæ¶ˆé™¤  <code>warning</code>  å¯ä»¥è®°å½•ä¸º  <code>error</code> ï¼Œè®©ä»£ç ä½œè€…é‡è§†èµ·æ¥ã€‚</p>\n<h3 id=\"fatal\"><a class=\"markdownIt-Anchor\" href=\"#fatal\">#</a> Fatal</h3>\n<p>è®°å½•æ¶ˆæ¯åï¼Œç›´æ¥è°ƒç”¨  <code>os.Exit(1)</code> ï¼Œè¿™æ„å‘³ç€ï¼š åœ¨å…¶ä»–  <code>goroutine</code>   <code>defer</code>  è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œï¼› å„ç§  <code>buffers</code>  ä¸ä¼šè¢«  <code>flush</code>  ï¼ŒåŒ…æ‹¬æ—¥å¿—çš„ï¼› ä¸´æ—¶æ–‡ä»¶æˆ–è€…ç›®å½•ä¸ä¼šè¢«ç§»é™¤ï¼› ä¸è¦ä½¿ç”¨  <code>fatal</code>  è®°å½•æ—¥å¿—ï¼Œè€Œæ˜¯å‘è°ƒç”¨è€…è¿”å›é”™è¯¯ã€‚å¦‚æœé”™è¯¯ä¸€ç›´æŒç»­åˆ°  <code>main.main</code> ã€‚ <code>main.main</code>  é‚£å°±æ˜¯åœ¨é€€å‡ºä¹‹å‰åšå¤„ç†ä»»ä½•æ¸…ç†æ“ä½œçš„æ­£ç¡®ä½ç½®ã€‚</p>\n<h3 id=\"error\"><a class=\"markdownIt-Anchor\" href=\"#error\">#</a> Error</h3>\n<p>ä¹Ÿæœ‰å¾ˆå¤šäººï¼Œåœ¨é”™è¯¯å‘ç”Ÿçš„åœ°æ–¹è¦ç«‹é©¬è®°å½•æ—¥å¿—ï¼Œå°¤å…¶è¦ä½¿ç”¨  <code>error</code>  çº§åˆ«è®°å½•ã€‚</p>\n<p><img data-src=\"/images/mylogs/12-log-01.png\" alt=\"\"></p>\n<h4 id=\"å¤„ç†-error\"><a class=\"markdownIt-Anchor\" href=\"#å¤„ç†-error\">#</a> å¤„ç† error</h4>\n<p>æŠŠ  <code>error</code>  æŠ›ç»™è°ƒç”¨è€…ï¼Œåœ¨é¡¶éƒ¨æ‰“å°æ—¥å¿—ï¼›<br>\nå¦‚æœæ‚¨é€‰æ‹©é€šè¿‡æ—¥å¿—è®°å½•æ¥å¤„ç†é”™è¯¯ï¼Œé‚£ä¹ˆæ ¹æ®å®šä¹‰ï¼Œå®ƒä¸å†æ˜¯ä¸€ä¸ªé”™è¯¯ â€” æ‚¨å·²ç»å¤„ç†äº†å®ƒã€‚è®°å½•é”™è¯¯çš„è¡Œä¸ºä¼šå¤„ç†é”™è¯¯ï¼Œå› æ­¤ä¸å†é€‚åˆå°†å…¶è®°å½•ä¸ºé”™è¯¯ã€‚</p>\n<p><img data-src=\"/images/mylogs/12-log-02.png\" alt=\"\"></p>\n<h3 id=\"debug\"><a class=\"markdownIt-Anchor\" href=\"#debug\">#</a> DEBUG</h3>\n<p>ç›¸ä¿¡åªæœ‰ä¸¤ä»¶äº‹ä½ åº”è¯¥è®°å½•ï¼š</p>\n<ul>\n<li>å¼€å‘äººå‘˜åœ¨å¼€å‘æˆ–è°ƒè¯•è½¯ä»¶æ—¶å…³å¿ƒçš„äº‹æƒ…ã€‚</li>\n<li>ç”¨æˆ·åœ¨ä½¿ç”¨è½¯ä»¶æ—¶å…³å¿ƒçš„äº‹æƒ…ã€‚</li>\n</ul>\n<p>æ˜¾ç„¶ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯è°ƒè¯•å’Œä¿¡æ¯çº§åˆ«ã€‚<br>\n <code>log.Info</code>  åªéœ€å°†è¯¥è¡Œå†™å…¥æ—¥å¿—è¾“å‡ºã€‚ä¸åº”è¯¥æœ‰å…³é—­å®ƒçš„é€‰é¡¹ï¼Œå› ä¸ºç”¨æˆ·åªåº”è¯¥è¢«å‘ŠçŸ¥å¯¹ä»–ä»¬æœ‰ç”¨çš„äº‹æƒ…ã€‚å¦‚æœå‘ç”Ÿäº†ä¸€ä¸ªæ— æ³•å¤„ç†çš„é”™è¯¯ï¼Œå®ƒå°±ä¼šæŠ›å‡ºåˆ°  <code>main.main</code> ã€‚ <code>main.main</code>  ç¨‹åºç»ˆæ­¢çš„åœ°æ–¹ã€‚åœ¨æœ€åçš„æ—¥å¿—æ¶ˆæ¯å‰é¢æ’å…¥  <code>fatal</code>  å‰ç¼€ï¼Œæˆ–è€…ç›´æ¥å†™å…¥  <code>os.Stderr</code> ã€‚<br>\n <code>log.Debug</code> ï¼Œæ˜¯å®Œå…¨ä¸åŒçš„äº‹æƒ…ã€‚å®ƒç”±å¼€å‘äººå‘˜æˆ–æ”¯æŒå·¥ç¨‹å¸ˆæ§åˆ¶ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•è¯­å¥åº”è¯¥æ˜¯ä¸°å¯Œçš„ï¼Œè€Œä¸å¿…æ±‚åŠ©äº  <code>trace</code>  æˆ–  <code>debug2</code> ï¼ˆæ‚¨çŸ¥é“è‡ªå·±æ˜¯è°ï¼‰çº§åˆ«ã€‚æ—¥å¿—åŒ…åº”è¯¥æ”¯æŒç»†ç²’åº¦æ§åˆ¶ï¼Œä»¥å¯ç”¨æˆ–ç¦ç”¨è°ƒè¯•ï¼Œå¹¶ä¸”åªåœ¨åŒ…æˆ–æ›´ç²¾ç»†çš„èŒƒå›´å†…å¯ç”¨æˆ–ç¦ç”¨è°ƒè¯•è¯­å¥ã€‚</p>\n<p>B ç«™çš„ go æ¡†æ¶æ˜¯å¦‚ä½•è®¾è®¡å’Œæ€è€ƒçš„ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dvLWtyYXRvcy9rcmF0b3MvdHJlZS92Mi4wLngvbG9n\">https://github.com/go-kratos/kratos/tree/v2.0.x/log</span></p>\n<h2 id=\"æ—¥å¿—é€‰å‹\"><a class=\"markdownIt-Anchor\" href=\"#æ—¥å¿—é€‰å‹\">#</a> æ—¥å¿—é€‰å‹</h2>\n<p>ä¸€ä¸ªå®Œæ•´çš„é›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿï¼Œéœ€è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç‰¹ç‚¹ï¼š</p>\n<ul>\n<li>æ”¶é›†ï¼èƒ½å¤Ÿé‡‡é›†å¤šç§æ¥æºçš„æ—¥å¿—æ•°æ®ï¼›</li>\n<li>ä¼ è¾“ï¼èƒ½å¤Ÿç¨³å®šçš„æŠŠæ—¥å¿—æ•°æ®ä¼ è¾“åˆ°ä¸­å¤®ç³»ç»Ÿï¼›</li>\n<li>å­˜å‚¨ï¼å¦‚ä½•å­˜å‚¨æ—¥å¿—æ•°æ®ï¼›</li>\n<li>åˆ†æï¼å¯ä»¥æ”¯æŒ  <code>UI</code>  åˆ†æï¼›</li>\n<li>è­¦å‘Šï¼èƒ½å¤Ÿæä¾›é”™è¯¯æŠ¥å‘Šï¼Œç›‘æ§æœºåˆ¶ï¼›</li>\n</ul>\n<p>å¼€æºç•Œé¼é¼å¤§å  <code>ELK stack</code> ï¼Œåˆ†åˆ«è¡¨ç¤ºï¼š <code>Elasticsearch</code>  ,  <code>Logstash</code> ,  <code>Kibana</code>  , å®ƒä»¬éƒ½æ˜¯å¼€æºè½¯ä»¶ã€‚æ–°å¢äº†ä¸€ä¸ª  <code>FileBeat</code> ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ—¥å¿—æ”¶é›†å¤„ç†å·¥å…· ( <code>Agent</code> )ï¼Œ <code>Filebeat</code>  å ç”¨èµ„æºå°‘ï¼Œé€‚åˆäºåœ¨å„ä¸ªæœåŠ¡å™¨ä¸Šæœé›†æ—¥å¿—åä¼ è¾“ç»™  <code>Logstash</code> ï¼Œå®˜æ–¹ä¹Ÿæ¨èæ­¤å·¥å…·ã€‚</p>\n<h3 id=\"elk\"><a class=\"markdownIt-Anchor\" href=\"#elk\">#</a> ELK</h3>\n<p>æ­¤æ¶æ„ç”±  <code>Logstash</code>  åˆ†å¸ƒäºå„ä¸ªèŠ‚ç‚¹ä¸Šæœé›†ç›¸å…³æ—¥å¿—ã€æ•°æ®ï¼Œå¹¶ç»è¿‡åˆ†æã€è¿‡æ»¤åå‘é€ç»™è¿œç«¯æœåŠ¡å™¨ä¸Šçš„  <code>Elasticsearch</code>  è¿›è¡Œå­˜å‚¨ã€‚<br>\n <code>Elasticsearch</code>  å°†æ•°æ®ä»¥åˆ†ç‰‡çš„å½¢å¼å‹ç¼©å­˜å‚¨å¹¶æä¾›å¤šç§  <code>API</code>  ä¾›ç”¨æˆ·æŸ¥è¯¢ï¼Œæ“ä½œã€‚ç”¨æˆ·äº¦å¯ä»¥æ›´ç›´è§‚çš„é€šè¿‡é…ç½®  <code>Kibana Web</code>  æ–¹ä¾¿çš„å¯¹æ—¥å¿—æŸ¥è¯¢ï¼Œå¹¶æ ¹æ®æ•°æ®ç”ŸæˆæŠ¥è¡¨ã€‚<br>\nå› ä¸º  <code>logstash</code>  å±äº  <code>server</code>  è§’è‰²ï¼Œå¿…ç„¶å‡ºç°æµé‡é›†ä¸­å¼çš„çƒ­ç‚¹é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬ä¸å»ºè®®ä½¿ç”¨è¿™ç§éƒ¨ç½²æ–¹å¼ï¼ŒåŒæ—¶å› ä¸º è¿˜éœ€è¦åšå¤§é‡  <code>match</code>  æ“ä½œï¼ˆæ ¼å¼åŒ–æ—¥å¿—ï¼‰ï¼Œæ¶ˆè€—çš„  <code>CPU</code>  ä¹Ÿå¾ˆå¤šï¼Œä¸åˆ©äº  <code>scale out</code> ã€‚</p>\n<p><img data-src=\"/images/mylogs/12-log-03.png\" alt=\"\"></p>\n<p><img data-src=\"/images/mylogs/12-log-04.png\" alt=\"\"></p>\n<p>æ­¤ç§æ¶æ„å¼•å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶ï¼Œä½äºå„ä¸ªèŠ‚ç‚¹ä¸Šçš„  <code>Logstash Agent</code>  å…ˆå°†æ•°æ® / æ—¥å¿—ä¼ é€’ç»™  <code>Kafka</code> ï¼Œå¹¶å°†é˜Ÿåˆ—ä¸­æ¶ˆæ¯æˆ–æ•°æ®é—´æ¥ä¼ é€’ç»™  <code>Logstash</code> ï¼Œ <code>Logstash</code>  è¿‡æ»¤ã€åˆ†æåå°†æ•°æ®ä¼ é€’ç»™ <code>Elasticsearch</code>  å­˜å‚¨ã€‚æœ€åç”±  <code>Kibana</code>  å°†æ—¥å¿—å’Œæ•°æ®å‘ˆç°ç»™ç”¨æˆ·ã€‚å› ä¸ºå¼•å…¥äº†  <code>Kafka</code> ï¼Œæ‰€ä»¥å³ä½¿è¿œç«¯  <code>Logstash server</code>  å› æ•…éšœåœæ­¢è¿è¡Œï¼Œæ•°æ®å°†ä¼šå…ˆè¢«å­˜å‚¨ä¸‹æ¥ï¼Œä»è€Œé¿å…æ•°æ®ä¸¢å¤±ã€‚<br>\næ›´è¿›ä¸€æ­¥çš„ï¼š  å°†æ”¶é›†ç«¯  <code>logstash</code>  æ›¿æ¢ä¸º  <code>beats</code> , æ›´çµæ´»ï¼Œæ¶ˆè€—èµ„æºæ›´å°‘ï¼Œæ‰©å±•æ€§æ›´å¼ºã€‚</p>\n<p><img data-src=\"/images/mylogs/12-log-05.png\" alt=\"\"></p>\n<h2 id=\"æ—¥å¿—ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡\"><a class=\"markdownIt-Anchor\" href=\"#æ—¥å¿—ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡\">#</a> æ—¥å¿—ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡</h2>\n<ul>\n<li>æ¥å…¥æ–¹å¼æ”¶æ•›ï¼›</li>\n<li>æ—¥å¿—æ ¼å¼è§„èŒƒï¼›</li>\n<li>æ—¥å¿—è§£æå¯¹æ—¥å¿—ç³»ç»Ÿé€æ˜ï¼›</li>\n<li>ç³»ç»Ÿé«˜ååã€ä½å»¶è¿Ÿï¼›</li>\n<li>ç³»ç»Ÿé«˜å¯ç”¨ã€å®¹é‡å¯æ‰©å±•ã€é«˜å¯è¿ç»´æ€§ï¼›</li>\n</ul>\n<h2 id=\"æ—¥å¿—ç³»ç»Ÿçš„æ ¼å¼è§„èŒƒ\"><a class=\"markdownIt-Anchor\" href=\"#æ—¥å¿—ç³»ç»Ÿçš„æ ¼å¼è§„èŒƒ\">#</a> æ—¥å¿—ç³»ç»Ÿçš„æ ¼å¼è§„èŒƒ</h2>\n<p><code>JSON</code>  ä½œä¸ºæ—¥å¿—çš„è¾“å‡ºæ ¼å¼ï¼š<br>\n <code>time</code> : æ—¥å¿—äº§ç”Ÿæ—¶é—´ï¼Œ <code>ISO8601</code>  æ ¼å¼ï¼›<br>\n <code>level</code> : æ—¥å¿—ç­‰çº§ï¼Œ <code>ERROR</code> ã€ <code>WARN</code> ã€ <code>INFO</code> ã€ <code>DEBUG</code> ï¼›<br>\n <code>app_id</code> : åº”ç”¨ <code>id</code> ï¼Œç”¨äºæ ‡ç¤ºæ—¥å¿—æ¥æºï¼›<br>\n <code>instance_id</code> : å®ä¾‹  <code>id</code> ï¼Œç”¨äºåŒºåˆ†åŒä¸€åº”ç”¨ä¸åŒå®ä¾‹ï¼Œå³  <code>hostname</code> ï¼›</p>\n<p><img data-src=\"/images/mylogs/12-log-06.png\" alt=\"\"></p>\n<h2 id=\"æ—¥å¿—ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#æ—¥å¿—ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°\">#</a> æ—¥å¿—ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°</h2>\n<p>æ—¥å¿—ä»äº§ç”Ÿåˆ°å¯æ£€ç´¢ï¼Œç»å†å‡ ä¸ªé˜¶æ®µï¼š</p>\n<ul>\n<li><b>ç”Ÿäº§ &amp; é‡‡é›†</b></li>\n<li><b>ä¼ è¾“ &amp; åˆ‡åˆ†</b></li>\n<li><b>å­˜å‚¨ &amp; æ£€ç´¢</b></li>\n</ul>\n<h3 id=\"é‡‡é›†\"><a class=\"markdownIt-Anchor\" href=\"#é‡‡é›†\">#</a> é‡‡é›†</h3>\n<p><img data-src=\"/images/mylogs/12-log-07.png\" alt=\"\"></p>\n<h4 id=\"logstash\"><a class=\"markdownIt-Anchor\" href=\"#logstash\">#</a>  <code>logstash</code> ï¼š</h4>\n<p>ç›‘å¬  <code>tcp/udp</code> <br>\n é€‚ç”¨äºé€šè¿‡ç½‘ç»œä¸ŠæŠ¥æ—¥å¿—çš„æ–¹å¼</p>\n<h4 id=\"filebeat\"><a class=\"markdownIt-Anchor\" href=\"#filebeat\">#</a>  <code>filebeat</code> ï¼š</h4>\n<p>ç›´æ¥é‡‡é›†æœ¬åœ°ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶<br>\né€‚ç”¨äºæ—¥å¿—æ— æ³•å®šåˆ¶åŒ–è¾“å‡ºçš„åº”ç”¨</p>\n<h4 id=\"logagent\"><a class=\"markdownIt-Anchor\" href=\"#logagent\">#</a>  <code>logagent</code> ï¼š</h4>\n<p>ç‰©ç†æœºéƒ¨ç½²ï¼Œç›‘å¬  <code>unixsocket</code> <br>\n æ—¥å¿—ç³»ç»Ÿæä¾›å„ç§è¯­è¨€  <code>SDK</code> <br>\n ç›´æ¥è¯»å–æœ¬åœ°æ—¥å¿—æ–‡ä»¶</p>\n<p><img data-src=\"/images/mylogs/12-log-08.png\" alt=\"logagentçš„è®¾è®¡\"></p>\n<h3 id=\"ä¼ è¾“\"><a class=\"markdownIt-Anchor\" href=\"#ä¼ è¾“\">#</a> ä¼ è¾“</h3>\n<p>åŸºäº  <code>flume + Kafka</code>  ç»Ÿä¸€ä¼ è¾“å¹³å°<br>\nåŸºäº  <code>LogID</code>  åšæ—¥å¿—åˆ†æµï¼š</p>\n<ul>\n<li>ä¸€èˆ¬çº§åˆ«</li>\n<li>ä½çº§åˆ«</li>\n<li>é«˜çº§åˆ«ï¼ˆ <code>ERROR</code> ï¼‰</li>\n</ul>\n<p>ç°åœ¨æ›¿æ¢ä¸º  <code>Flink + Kafka</code>  çš„å®ç°æ–¹å¼ã€‚</p>\n<p><img data-src=\"/images/mylogs/12-log-09.png\" alt=\"\"></p>\n<h3 id=\"åˆ‡åˆ†\"><a class=\"markdownIt-Anchor\" href=\"#åˆ‡åˆ†\">#</a> åˆ‡åˆ†</h3>\n<p>ä» <code>kafka</code>  æ¶ˆè´¹æ—¥å¿—ï¼Œè§£ææ—¥å¿—ï¼Œå†™å…¥ <code>elasticsearch</code> <br>\n <code>bili-index</code> : è‡ªç ”ï¼Œ <code>golang</code>  å¼€å‘ï¼Œé€»è¾‘ç®€å•ï¼Œæ€§èƒ½ é«˜ï¼Œå¯å®šåˆ¶åŒ–æ–¹ä¾¿ã€‚<br>\nãƒ»æ—¥å¿—è§„èŒƒäº§ç”Ÿçš„æ—¥å¿— ( <code>log agent</code>  æ”¶é›†)<br>\n <code>logstash</code> :  <code>es</code>  å®˜æ–¹ç»„ä»¶ï¼ŒåŸºäº  <code>jruby</code>  å¼€å‘ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œ èµ„æºæ¶ˆè€—é«˜ï¼Œæ€§èƒ½ä½ã€‚<br>\nãƒ»å¤„ç†æœªæŒ‰ç…§æ—¥å¿—è§„èŒƒäº§ç”Ÿçš„æ—¥å¿— ( <code>filebeat</code> ã€ <code>logstash</code>  æ”¶é›†)ï¼Œéœ€é…ç½®å„ç§æ—¥å¿—è§£æè§„åˆ™ã€‚</p>\n<h3 id=\"å­˜å‚¨å’Œæ£€ç´¢\"><a class=\"markdownIt-Anchor\" href=\"#å­˜å‚¨å’Œæ£€ç´¢\">#</a> å­˜å‚¨å’Œæ£€ç´¢</h3>\n<p><code>elasticsearch</code>  å¤šé›†ç¾¤æ¶æ„ï¼š<br>\næ—¥å¿—åˆ†çº§ã€é«˜å¯ç”¨</p>\n<p>å•æ•°æ®é›†ç¾¤å†…:<br>\n <code>master node + data node(hot/stale) + client node</code> <br>\n æ¯æ—¥å›ºå®šæ—¶é—´è¿›è¡Œçƒ­ -&gt; å†·è¿ç§»<br>\n <code>Index</code>  æå‰ä¸€å¤©åˆ›å»ºï¼ŒåŸºäº  <code>template</code>  è¿›è¡Œ <code>mapping</code>  ç®¡ç†<br>\næ£€ç´¢åŸºäº  <code>kibana</code></p>\n<h4 id=\"å­˜å‚¨-æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#å­˜å‚¨-æ–‡ä»¶\">#</a> å­˜å‚¨ - æ–‡ä»¶</h4>\n<ul>\n<li>ä½¿ç”¨è‡ªå®šä¹‰åè®®ï¼Œå¯¹  <code>SDK</code>  è´¨é‡ã€ç‰ˆæœ¬å‡çº§éƒ½æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œå› æ­¤æˆ‘ä»¬é•¿æœŸä¼šä½¿ç”¨ â€œæœ¬åœ°æ–‡ä»¶â€ çš„æ–¹æ¡ˆå®ç°ï¼š</li>\n<li>é‡‡é›†æœ¬åœ°æ—¥å¿—æ–‡ä»¶ï¼šä½ç½®ä¸é™ï¼Œå®¹å™¨å†… <code>or</code>  ç‰©ç†æœº</li>\n<li>é…ç½®è‡ªæè¿°ï¼šä¸åšä¸­å¿ƒåŒ–é…ç½®ï¼Œé…ç½®ç”±  <code>app/paas</code>  è‡ªèº«æä¾›ï¼Œ <code>agent</code>  è¯»å–é…ç½®å¹¶ç”Ÿæ•ˆ</li>\n<li>æ—¥å¿—ä¸é‡ä¸ä¸¢ï¼šå¤šçº§é˜Ÿåˆ—ï¼Œèƒ½å¤Ÿç¨³å®šåœ°å¤„ç†æ—¥å¿—æ”¶é›†è¿‡ç¨‹ä¸­å„ç§å¼‚å¸¸</li>\n<li>å¯ç›‘æ§ï¼šå®æ—¶ç›‘æ§è¿è¡ŒçŠ¶æ€</li>\n<li>å®Œå–„çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼šé™åˆ¶è‡ªèº«å¯¹äºå®¿ä¸»æœºèµ„æºçš„æ¶ˆè€—ï¼Œé™åˆ¶å‘é€é€Ÿåº¦</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "log",
                "go-log"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/02/24/go/go-errors/",
            "url": "https://fangjiaxiaobai.github.io/2022/02/24/go/go-errors/",
            "title": "æµ…ægoçš„error",
            "date_published": "2022-02-24T10:18:18.000Z",
            "content_html": "<p>å¼‚å¸¸å¤„ç† æ–¹æ³•è§£é‡Šï¼š</p>\n<ul>\n<li><code>New</code> : åˆ›å»ºä¸€ä¸ª <code>Error</code></li>\n<li><code>Is</code> ï¼š åˆ¤æ–­æ˜¯ä¸æ˜¯ç‰¹å®šçš„ä¸€ä¸ª <code>Error</code></li>\n<li><code>As</code> ï¼šç±»å‹è½¬æ¢ä¸ºç‰¹å®šçš„ <code>Error</code></li>\n<li><code>UnWrap</code> : è§£é™¤åŒ…è£…ï¼Œè¿”å›è¢«åŒ…è£…çš„ <code>error</code> .</li>\n</ul>\n<p><code>error.New(string)</code>  æ–¹æ³•è¿”å›çš„æ˜¯  <code>error struct</code>  çš„æŒ‡é’ˆã€‚</p>\n<p><code>errors is values</code> .  <code>error</code>  å…¶å®å°±æ˜¯ä¸€ä¸ª <code>interface (struct)</code></p>\n<h1 id=\"errorçš„ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#errorçš„ç±»å‹\">#</a>  <code>error</code>  çš„ç±»å‹</h1>\n<h2 id=\"sentinel-error\"><a class=\"markdownIt-Anchor\" href=\"#sentinel-error\">#</a>  <code>Sentinel Error</code></h2>\n<p><code>Sentinel Error</code>  é¢„å®šä¹‰çš„ç‰¹å®šé”™è¯¯ã€‚æˆ‘ä»¬ç§°ä¸º  <code>Sentinel Error</code> . è¿™ä¸ªåå­—æ¥æºäºè®¡ç®—æœºç¼–ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªç‰¹å®šå€¼æ¥è¡¨ç¤ºä¸å¯èƒ½è¿›ä¸€æ­¥å¤„ç†çš„é”™è¯¯ã€‚ ç±»ä¼¼äºï¼š  <code>io.EOF</code>  æˆ–è€…ï¼Œæ›´åº•å±‚çš„ï¼š <code>syscall.ENOENT</code> .</p>\n<p>å°½å¯èƒ½é¿å…çš„ä½¿ç”¨ <code>Sentinel Error</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">demo1</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\terr := errors.New(<span class=\"string\">&quot;this is a error&quot;</span>)</span><br><span class=\"line\">\t<span class=\"built_in\">println</span>(err.Error())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"error-type-é”™è¯¯ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#error-type-é”™è¯¯ç±»å‹\">#</a>  <code>Error Type</code>  (é”™è¯¯ç±»å‹)</h2>\n<p><code>Error Type</code>  æ˜¯å®ç°äº†  <code>error</code>  æ¥å£çš„è‡ªå®šä¹‰ç±»å‹ã€‚ä¾‹å¦‚ä¸‹é¢çš„ <code>MyError</code> . ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ–­è¨€æ¥è½¬æ¢è¿™ä¸ªé”™è¯¯ï¼Œè·å–æ›´å¤šçš„å¼‚å¸¸ä¿¡æ¯ã€‚ å¦‚ ä¸‹ä»£ç ã€‚ç›¸æ¯”äº  <code>Sentinel Error</code> ,  <code>Error Type</code>  çš„ä¸€å¤§æ”¹è¿›å°±æ˜¯ èƒ½å¤Ÿä¸ºåŒ…è£…åº•å±‚  <code>error</code>  æä¾›ä¸Šä¸‹æ–‡ã€‚ ä¾‹å¦‚ <code>os.PathError</code> . ä½†æ˜¯ï¼šè°ƒç”¨ä½¿ç”¨ç±»å‹æ–­è¨€å’Œç±»å‹  <code>switch</code>  . å°±è¦è®©è‡ªå®šä¹‰çš„  <code>error</code>  å˜ä¸º  <code>public</code>  ã€‚ è¿™ç§æ¨¡å‹ä¼šå¯¼è‡´é”™è¯¯ç±»å‹å’Œè°ƒç”¨è€…å¼ºè€¦åˆï¼Œä»è€Œå¯¼è‡´ <code>Api</code>  å˜å¾—è„†å¼±ã€‚</p>\n<p>å»ºè®®ï¼šé¿å…ä½¿ç”¨  <code>error Type</code>  æˆ–è€… è‡³å°‘é¿å…å°†ä»–ä»¬ä½œä¸ºå…¬å…± <code>API</code>  çš„ä¸€éƒ¨åˆ†ã€‚</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// MyError /** demo2.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyError <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tmsg        <span class=\"keyword\">string</span></span><br><span class=\"line\">\tfileName   <span class=\"keyword\">string</span></span><br><span class=\"line\">\tlineNumber <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å®ç°äº† erroræ¥å£ã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(m *MyError)</span> <span class=\"title\">Error</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> fmt.Sprintf(<span class=\"string\">&quot;%s:%d: %s&quot;</span>, m.fileName, m.lineNumber, m.msg)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">testError</span><span class=\"params\">()</span> <span class=\"title\">error</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;MyError&#123;msg: <span class=\"string\">&quot;this is a error&quot;</span>, fileName: <span class=\"string\">&quot;demo8_error_resolve&quot;</span>, lineNumber: <span class=\"number\">50</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">demo2</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\terr := testError()</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> err := err.(<span class=\"keyword\">type</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"literal\">nil</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> *MyError:</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;error: &quot;</span>, err.lineNumber)</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"opaque-error\"><a class=\"markdownIt-Anchor\" href=\"#opaque-error\">#</a>  <code>Opaque Error</code></h2>\n<p>å°†è¿™ç§é£æ ¼ç§°ä¸º ä¸é€æ˜é”™è¯¯ã€‚è™½ç„¶ä½ çŸ¥é“å‘ç”Ÿäº†é”™è¯¯ï¼Œä½†æ˜¯æ‚¨æ²¡èƒ½åŠ›çœ‹åˆ°é”™è¯¯çš„å†…éƒ¨ï¼Œä½œä¸ºè°ƒç”¨è€…ï¼Œå…³äºæ“ä½œçš„ç»“æœï¼Œæ‚¨æ‰€çŸ¥é“çš„å°±æ˜¯ä»–æˆåŠŸæˆ–è€…å¤±è´¥äº†<br>\n ==&gt; åªè¿”å›é”™è¯¯ï¼Œä½†ä¸è¿”å›é”™è¯¯å†…å®¹ã€‚ ==&gt; åŒæ—¶è¿”å›é”™è¯¯çš„ç±»å‹ï¼Œè€Œä¸æ˜¯é”™è¯¯çš„ç±»å‹ã€‚ å¦‚ä¸‹ç¤ºä¾‹:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Write</span><span class=\"params\">(w io.Writer, buf []<span class=\"keyword\">byte</span>)</span> <span class=\"title\">error</span></span> &#123;</span><br><span class=\"line\">\t_, err := w.Write(buf)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;è¿™é‡Œå‘ç”Ÿäº†é”™è¯¯ï¼Œ%w\\n&quot;</span>, err)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// OpaqueError /***** demo3</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> OpaqueError <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\terror</span><br><span class=\"line\">\tIsTemporary() <span class=\"keyword\">bool</span> <span class=\"comment\">// æ˜¯å¦æ˜¯ä¸´æ—¶é”™è¯¯ã€‚</span></span><br><span class=\"line\">\tIsTimeout() <span class=\"keyword\">bool</span>   <span class=\"comment\">// æ˜¯å¦æ˜¯è¶…æ—¶</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> temporary <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\tTemporary() <span class=\"keyword\">bool</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åˆ¤æ–­æ˜¯å¦ä¸ºTemporary Error.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">isTemporary</span><span class=\"params\">(err error)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\tte, ok := err.(temporary)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ok &amp;&amp; te.Temporary()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"handing-error-å¤„ç†å¼‚å¸¸\"><a class=\"markdownIt-Anchor\" href=\"#handing-error-å¤„ç†å¼‚å¸¸\">#</a>  <code>Handing Error</code>  å¤„ç†å¼‚å¸¸</h1>\n<ul>\n<li>ä¸€ç§å¤„ç† <code>error</code>  çš„æ–¹å¼ï¼Œç¼–å†™ä»£ç æŠ€å·§ï¼Œè®©ä»£ç æ›´æ˜“è¯»ã€‚</li>\n<li><code>wrap Errors</code> . ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ã€‚  <code>github.com/pkg/errors. go</code>  çš„ <code>1.13</code>  ç‰ˆæœ¬ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨:  <code>fmt.Errorf(&quot;%w&quot;,err)</code> . å’Œ  <code>errors.Is()</code> , <code>errors.As()</code> . è§„èŒƒï¼š\n<ul>\n<li>å¦‚æœæ˜¯ä¸€ä¸ªè·¨é¡¹ç›®ï¼Œå¤šé‡å¤ç”¨çš„é¡¹ç›®é‡Œï¼Œåº”è¯¥ç›´æ¥è¿”å› <code>error</code> , è€Œä¸æ˜¯è¿”å›åŒ…è£…åçš„ <code>error</code> .</li>\n<li>å¦‚æœå‡½æ•° / æ–¹æ³•ä¸æ‰“ç®—å¤„ç†é”™è¯¯ï¼Œé‚£ä¹ˆç”¨è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡  <code>wrap error</code>  å¹¶å°†å…¶è¿”å›åˆ°è°ƒç”¨å †æ ˆä¸­ã€‚</li>\n<li>ä¸€æ—¦ç¡®å®šå‡½æ•° / æ–¹æ³•è¦å¤„ç†é”™è¯¯ï¼Œé”™è¯¯å°±ä¸å†æ˜¯é”™è¯¯ï¼Œ å¦‚æœå‡½æ•° / æ–¹æ³•ä»ç„¶éœ€è¦å‘å‡ºè¿”å›ï¼Œåˆ™å®ƒä¸èƒ½è¿”å›é”™è¯¯å€¼ï¼Œå®ƒåº”è¯¥åªè¿”å›é›¶ (æ¯”å¦‚é™çº§å¤„ç†ä¸­ï¼Œ ä½ è¿”å›äº† é™çº§æ•°æ®ï¼Œç„¶åéœ€è¦è¿”å› <code>nil</code> .)</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"go-2x-çš„å‘å±•å‚è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#go-2x-çš„å‘å±•å‚è€ƒ\">#</a>  <code>go 2.x</code>  çš„å‘å±•å‚è€ƒ</h1>\n<p>å»ºè®®å¤šçœ‹çœ‹ï¼Œå¯ä»¥æŠŠæ¡ä¸€ä¸‹  <code>go</code>  æœªæ¥çš„å‘å±•æ–¹å‘</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nby5nb29nbGVzb3VyY2UuY29tL3Byb3Bvc2FsLysvbWFzdGVyL2Rlc2lnbi8yOTkzNC1lcnJvci12YWx1ZXMubWQ=\">https://go.googlesource.com/proposal/+/master/design/29934-error-values.md</span><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9nby5nb29nbGVzb3VyY2UuY29tL3Byb3Bvc2FsLysvbWFzdGVyL2Rlc2lnbi9nbzJkcmFmdC1lcnJvci1oYW5kbGluZy5tZA==\">https://go.googlesource.com/proposal/+/master/design/go2draft-error-handling.md</span><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9nby5nb29nbGVzb3VyY2UuY29tL3Byb3Bvc2FsLysvbWFzdGVyL2Rlc2lnbi9nbzJkcmFmdC1lcnJvci1oYW5kbGluZy1vdmVydmlldy5tZA==\">https://go.googlesource.com/proposal/+/master/design/go2draft-error-handling-overview.md</span></p>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "go",
                "go-error"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/02/11/notes/architecture/Learn_Architecture_From_zero-01-basic/",
            "url": "https://fangjiaxiaobai.github.io/2022/02/11/notes/architecture/Learn_Architecture_From_zero-01-basic/",
            "title": "ã€ç¬”è®°ã€‘ ä»0å¼€å§‹å­¦æ¶æ„ ä¸€ æ¶æ„åŸºç¡€",
            "date_published": "2022-02-11T10:18:18.000Z",
            "content_html": "<p><span class=\"spoiler\" title=\"...\">æœ¬æ–‡æ˜¯å­¦ä¹  æå®¢æ—¶é—´ - æè¿å - ä» 0 å¼€å§‹å­¦æ¶æ„ çš„ç¬”è®°ã€‚ä¾µåˆ ï½</span></p>\n<p class=\"gallery\" data-height=\"300\"><img data-src=\"/images/architecture/Learn_Architecture_From_0/course.jpeg\" alt=\"è´­è¯¾é“¾æ¥\"></p>\n<p><span class=\"label warning\">ğŸ”¥è´­ä¹°ååŠ å¾®ä¿¡ï¼Œè¿”ç°èµé‡‘ (å…¨é¢)</span></p>\n<p><mark>æ¶æ„è®¾è®¡çš„å…³é”®æ€ç»´åœ¨äºåˆ¤æ–­å’Œå–èˆã€‚ç¨‹åºè®¾è®¡çš„å…³é”®æ€ç»´åœ¨äºé€»è¾‘å’Œå®ç°.</mark></p>\n<h2 id=\"å®šä¹‰æ¶æ„\"><a class=\"markdownIt-Anchor\" href=\"#å®šä¹‰æ¶æ„\">#</a> å®šä¹‰æ¶æ„.</h2>\n<p><b>è½¯ä»¶æ¶æ„ æŒ‡è½¯ä»¶ç³»ç»Ÿçš„é¡¶å±‚ç»“æ„</b></p>\n<ul>\n<li>ç³»ç»Ÿæ˜¯ä¸€ç¾¤å…³è”ä¸ªä½“ç»„æˆçš„ã€‚è¿™äº›ä¸ªä½“å¯ä»¥æ˜¯å­ç³»ç»Ÿï¼Œæ¨¡å—ï¼Œç»„ä»¶ç­‰ã€‚æ¶æ„éœ€è¦æ˜ç¡®ç³»ç»Ÿä¸­åŒ…å«å“ªäº›ä¸ªä½“ã€‚</li>\n<li>ç³»ç»Ÿä¸­çš„ä¸ªä½“éœ€è¦â€ æ ¹æ®é­”ç§è§„åˆ™ â€œè¿ä½œï¼Œæ¶æ„éœ€è¦æ˜ç¡®ä¸ªä½“è¿ä½œå’Œåä½œçš„è§„åˆ™ã€‚</li>\n<li>ç»´åŸºç™¾ç§‘å®šä¹‰çš„æ¶æ„ç”¨åˆ°äº† â€œåŸºç¡€ç»“æ„â€ è¿™ä¸ªè¯´æ³•ï¼Œæˆ‘æ”¹ä¸º â€œé¡¶å±‚ç»“æ„â€ï¼Œå¯ä»¥æ›´å¥½<br>\nåœ°åŒºåˆ†ç³»ç»Ÿå’Œå­ç³»ç»Ÿï¼Œé¿å…å°†ç³»ç»Ÿæ¶æ„å’Œå­ç³»ç»Ÿæ¶æ„æ··æ·†åœ¨ä¸€èµ·å¯¼è‡´æ¶æ„å±‚æ¬¡æ··ä¹±ã€‚</li>\n</ul>\n<p>æ¶æ„æ˜¯é¡¶å±‚è®¾è®¡ï¼Œæ¡†æ¶æ˜¯é¢å‘ç¼–ç¨‹æˆ–é…ç½®çš„åŠæˆå“ï¼Œç»„ä»¶æ˜¯ä»æŠ€æœ¯ç»´åº¦ä¸Šçš„å¤ç”¨ï¼Œ æ¨¡å‹æ˜¯ä»ä¸šåŠ¡ç»´åº¦ä¸ŠèŒè´£çš„åˆ’åˆ†ï¼Œç³»ç»Ÿæ˜¯ç›¸äº’ååŒå¯è¿è¡Œçš„å®ä½“ã€‚</p>\n<h2 id=\"æ¶æ„è®¾è®¡çš„å†å²èƒŒæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#æ¶æ„è®¾è®¡çš„å†å²èƒŒæ™¯\">#</a> æ¶æ„è®¾è®¡çš„å†å²èƒŒæ™¯</h2>\n<h3 id=\"è½¯ä»¶å¼€å‘è¿›åŒ–çš„å†å²\"><a class=\"markdownIt-Anchor\" href=\"#è½¯ä»¶å¼€å‘è¿›åŒ–çš„å†å²\">#</a> è½¯ä»¶å¼€å‘è¿›åŒ–çš„å†å²</h3>\n<ul>\n<li><code>1940</code>  å¹´ä¹‹å‰ï¼Œæœºå™¨è¯­è¨€ã€‚\n<ul>\n<li>ç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶  <code>0</code>  å’Œ  <code>1</code>  æ¥æ ‡è¯†æœºå™¨å¯ä»¥è¯†åˆ«çš„æŒ‡ä»¤å’Œæ•°æ®ã€‚</li>\n<li>æœºå™¨è¯­è¨€çš„ä¸»è¦é—®é¢˜æ˜¯ï¼šå¤ªéš¾å†™ï¼Œå¤ªéš¾è¯»ï¼Œå¤ªéš¾æ”¹ã€‚</li>\n</ul>\n</li>\n<li><code>20</code>  ä¸–çºª <code>40</code>  å¹´ä»£ æ±‡ç¼–è¯­è¨€\n<ul>\n<li>ç¬¦å·è¯­è¨€ï¼Œç”¨åŠ©è®°ç¬¦ä»£æ›¿æœºå™¨æŒ‡ä»¤çš„æ“ä½œç ï¼Œç”¨åœ°å€ç¬¦å·æˆ–è€…æ ‡å·ä»£æ›¿æŒ‡ä»¤å’Œæ“ä½œæ•°çš„åœ°å€ã€‚</li>\n<li>ç¼–å†™å¤æ‚ã€‚</li>\n<li>ä¸åŒ <code>CPU</code>  çš„æ±‡ç¼–æŒ‡ä»¤å’Œç»“æ„æ˜¯ä¸åŒçš„ã€‚</li>\n</ul>\n</li>\n<li><code>20</code>  ä¸–ç•Œ <code>50</code>  å¹´ä»£ é«˜çº§è¯­è¨€\n<ul>\n<li>é€šè¿‡ç¼–è¯‘ç¨‹åºçš„å¤„ç†ï¼Œé«˜çº§è¯­è¨€å¯ä»¥è¢«ç¼–è¯‘ä¸ºé€‚åˆä¸åŒ  <code>CPU</code>  æŒ‡ä»¤çš„æœºå™¨è¯­è¨€ã€‚<br>\nç¨‹åºå‘˜åªè¦å†™ä¸€æ¬¡ç¨‹åºï¼Œå°±å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„æœºå™¨ä¸Šç¼–è¯‘è¿è¡Œï¼Œæ— é¡»æ ¹æ®ä¸åŒçš„æœºå™¨æŒ‡ä»¤é‡<br>\nå†™æ•´ä¸ªç¨‹åºã€‚</li>\n</ul>\n</li>\n<li><code>20</code>  ä¸–çºª <code>60</code>  å¹´ä»£ - <code>70</code>  å¹´ä»£ ç¬¬ä¸€æ¬¡è½¯ä»¶å±æœºå’Œç»“æ„åŒ–ç¨‹åºè®¾è®¡\n<ul>\n<li><code>20</code>  ä¸–çºª <code>60</code>  å¹´ä»£ä¸­æœŸï¼Œç”±äºè½¯ä»¶çš„â€ é€»è¾‘ â€œå˜å¾—éå¸¸å¤æ‚ã€‚çˆ†å‘äº†è½¯ä»¶å±æœºï¼Œéšåæå‡ºäº†è½¯ä»¶å·¥ç¨‹çš„è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯ è½¯ä»¶å·¥ç¨‹æ— æ³•æ ¹é™¤è½¯ä»¶å±æœºï¼Œåªèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¯èŠ‚è½¯ä»¶å±æœºã€‚</li>\n<li>å·®ä¸å¤šåŒæ—¶é—´ï¼Œâ€ ç»“æ„åŒ–ç¨‹åºè®¾è®¡ â€œä½œä¸ºå¦å¤–ä¸€ç§è§£å†³è½¯ä»¶å±æœºçš„æ–¹æ¡ˆè¢«æäº†å‡ºæ¥ã€‚å¹¶è¯ç”Ÿäº†ç¬¬ä¸€ä¸ªç»“æ„åŒ–çš„ç¨‹åºè¯­è¨€ï¼š <code>Pascal</code> .</li>\n<li>ç»“æ„åŒ–ç¨‹åºè®¾è®¡æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§é¢å‘è¿‡ç¨‹çš„è®¾è®¡æ€æƒ³ï¼Œä½†é€šè¿‡ â€œè‡ªé¡¶å‘ä¸‹ã€é€æ­¥ç»†åŒ–ã€æ¨¡å—åŒ–â€ çš„æ–¹æ³•ï¼Œå°†è½¯ä»¶çš„å¤æ‚åº¦æ§åˆ¶åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œä»è€Œä»æ•´ä½“ä¸Šé™ä½äº†è½¯ä»¶å¼€å‘çš„å¤æ‚åº¦ã€‚ç»“æ„åŒ–ç¨‹åºæ–¹æ³•æˆä¸ºäº†  <code>20</code>  ä¸–çºª  <code>70</code>  å¹´ä»£è½¯ä»¶å¼€å‘çš„æ½®æµã€‚</li>\n</ul>\n</li>\n<li><code>20</code>  ä¸–çºª <code>80</code>  å¹´ä»£ ç¬¬äºŒæ¬¡è½¯ä»¶å±æœºå’Œé¢å‘å¯¹è±¡\n<ul>\n<li>ç”±äºè½¯ä»¶ç”Ÿäº§åŠ›è¿œè¿œè·Ÿä¸ä¸Šç¡¬ä»¶å’Œä¸šåŠ¡çš„å‘å±•ã€‚ç¬¬äºŒæ¬¡è½¯ä»¶å±æœºçˆ†å‘äº†ã€‚ä¸»è¦è¡¨ç°ä¸º è½¯ä»¶çš„æ‰©å±•å˜å¾—éå¸¸å¤æ‚ã€‚</li>\n<li>è½¯ä»¶é¢†åŸŸè¿«åˆ‡å¸Œæœ›æ‰¾åˆ°æ–°çš„é“¶å¼¹æ¥è§£å†³è½¯ä»¶å±æœºï¼Œåœ¨è¿™ç§èƒŒæ™¯ä¸‹ï¼Œé¢å‘å¯¹è±¡çš„æ€æƒ³å¼€å§‹æµè¡Œèµ·æ¥ã€‚</li>\n<li>é¢å‘å¯¹è±¡çœŸæ­£å¼€å§‹æµè¡Œæ˜¯åœ¨  <code>20</code>  ä¸–çºª  <code>80</code>  å¹´ä»£ï¼Œä¸»è¦å¾—ç›Šäº  <code>C++</code>  çš„åŠŸåŠ³ï¼Œåæ¥çš„  <code>Java</code> ã€ <code>C#</code>  æŠŠé¢å‘å¯¹è±¡æ¨å‘äº†æ–°çš„é«˜å³°ã€‚åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œé¢å‘å¯¹è±¡å·²ç»æˆä¸ºäº†ä¸»æµçš„å¼€å‘æ€æƒ³ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"è½¯ä»¶æ¶æ„çš„å†å²èƒŒæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#è½¯ä»¶æ¶æ„çš„å†å²èƒŒæ™¯\">#</a> è½¯ä»¶æ¶æ„çš„å†å²èƒŒæ™¯</h3>\n<p>è½¯ä»¶æ¶æ„çš„å‡ºç°æœ‰å…¶å†å²å¿…ç„¶æ€§ã€‚  <code>20</code>  ä¸–çºª  <code>60</code>  å¹´ä»£ç¬¬ä¸€æ¬¡è½¯ä»¶å±æœºå¼•å‡ºäº† â€œç»“æ„åŒ–ç¼–ç¨‹â€ï¼Œåˆ›é€ äº† â€œæ¨¡å—â€ æ¦‚å¿µï¼› <code>20</code>  ä¸–çºª  <code>80</code>  å¹´ä»£ç¬¬äºŒæ¬¡è½¯ä»¶å±æœºå¼•å‡ºäº† â€œé¢å‘å¯¹è±¡ç¼–ç¨‹â€ï¼Œåˆ›é€ äº† â€œå¯¹è±¡â€ æ¦‚å¿µï¼›åˆ°äº†  <code>20</code>  ä¸–çºª  <code>90</code>  å¹´ä»£ â€œè½¯ä»¶æ¶æ„â€ å¼€å§‹æµè¡Œï¼Œåˆ›é€ äº† â€œç»„ä»¶â€ æ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œâ€œæ¨¡å—â€â€œå¯¹è±¡â€â€œç»„ä»¶â€ æœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹è¾¾åˆ°ä¸€å®šè§„æ¨¡çš„è½¯ä»¶è¿›è¡Œæ‹†åˆ†ï¼Œå·®åˆ«åªæ˜¯åœ¨äºéšç€è½¯ä»¶çš„å¤æ‚åº¦ä¸æ–­å¢åŠ ï¼Œæ‹†åˆ†çš„ç²’åº¦è¶Šæ¥è¶Šç²—ï¼Œæ‹†åˆ†çš„å±‚æ¬¡è¶Šæ¥è¶Šé«˜ã€‚</p>\n<h2 id=\"æ¶æ„è®¾è®¡çš„ç›®çš„\"><a class=\"markdownIt-Anchor\" href=\"#æ¶æ„è®¾è®¡çš„ç›®çš„\">#</a> æ¶æ„è®¾è®¡çš„ç›®çš„</h2>\n<p><span class=\"label success\">æ¶æ„è®¾è®¡æ˜¯è§£å†³ç³»ç»Ÿå¤æ‚åº¦å¸¦æ¥çš„é—®é¢˜</span></p>\n<h3 id=\"å¤æ‚åº¦æ¥æºé«˜æ€§èƒ½\"><a class=\"markdownIt-Anchor\" href=\"#å¤æ‚åº¦æ¥æºé«˜æ€§èƒ½\">#</a> å¤æ‚åº¦æ¥æºï¼šé«˜æ€§èƒ½</h3>\n<p>è½¯ä»¶ç³»ç»Ÿä¸­ é«˜æ€§èƒ½ å¸¦æ¥çš„å¤æ‚åº¦ä¸»è¦ä½“ç°åœ¨ä¸¤æ–¹é¢ã€‚</p>\n<ul>\n<li>å•å°è®¡ç®—æœºå†…éƒ¨ä¸ºäº†é«˜æ€§èƒ½å¸¦æ¥çš„å¤æ‚åº¦</li>\n<li>å¤šå°è®¡ç®—æœºé›†ç¾¤ä¸ºäº†é«˜æ€§èƒ½å¸¦æ¥çš„å¤æ‚åº¦</li>\n</ul>\n<h3 id=\"å¤æ‚åº¦æ¥æºé«˜å¯ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#å¤æ‚åº¦æ¥æºé«˜å¯ç”¨\">#</a> å¤æ‚åº¦æ¥æºï¼šé«˜å¯ç”¨</h3>\n<p>ç³»ç»Ÿæ— ä¸­æ–­çš„æ‰§è¡Œå…¶åŠŸèƒ½çš„èƒ½åŠ›ï¼Œä»£è¡¨ç³»ç»Ÿçš„å¯ç”¨æ€§ç¨‹åº¦ï¼Œæ˜¯è¿›è¡Œç³»ç»Ÿè®¾è®¡æ—¶çš„å‡†åˆ™ä¹‹ä¸€ã€‚</p>\n<p>æ— ä¸­æ–­ï¼Ÿç¡¬ä»¶ä¼šå‡ºæ•…éšœï¼Œè½¯ä»¶ä¼šæœ‰ <code>bug</code> , ç¡¬ä»¶ä¼šè€åŒ–ï¼Œè½¯ä»¶ä¼šè¶Šæ¥è¶Šå¤æ‚å’Œåºå¤§ã€‚æ–­ç”µï¼Œæ–­ç½‘ï¼Œåœ°éœ‡ç­‰ç­‰å¤–éƒ¨å› ç´ ä¹Ÿä¸å¯èƒ½åšåˆ° â€œæ— ä¸­æ–­â€ã€‚</p>\n<p>ç³»ç»Ÿé«˜å¯ç”¨çš„æ–¹æ¡ˆï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡ å†—ä½™ æ¥å®ç°çš„ã€‚</p>\n<p>é«˜æ€§èƒ½å¢åŠ æœºå™¨çš„ç›®çš„æ˜¯åœ¨äºæ‰©å±•ï¼Œé«˜å¯ç”¨å¢åŠ æœºå™¨çš„ç›®çš„åœ¨äº å†—ä½™ å¤„ç†å•å…ƒã€‚</p>\n<h4 id=\"è®¡ç®—é«˜å¯ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#è®¡ç®—é«˜å¯ç”¨\">#</a> è®¡ç®—é«˜å¯ç”¨</h4>\n<p>è¿™é‡Œçš„è®¡ç®—æ˜¯ä¸ªåè¯ã€‚è®¡ç®—æŒ‡çš„æ˜¯ï¼Œä¸šåŠ¡çš„é€»è¾‘å¤„ç†ã€‚</p>\n<p>ä»ä¸€å°ä¸šåŠ¡æœåŠ¡æ‰©å±•åˆ°ä¸¤å°ä¸šåŠ¡æœåŠ¡æ—¶ï¼Œå¿…é¡»è¦å¢åŠ ä¸€ä¸ªä»»åŠ¡åˆ†é…å™¨ (ç¬¬ä¸‰è€…) æ¥åè°ƒ (è°ƒåº¦) å“ªå°æœºå™¨æä¾›æœåŠ¡ã€‚è¿™é‡Œå°±è¦è€ƒè™‘ï¼š æ€§èƒ½ï¼Œæˆæœ¬ï¼Œå¯ç»´æŠ¤æ€§ï¼Œå¯ç”¨æ€§ç­‰æ–¹é¢å› ç´ ã€‚</p>\n<p>ä»»åŠ¡åˆ†é…å™¨å’ŒçœŸæ­£çš„ä¸šåŠ¡æœåŠ¡å™¨ä¹‹é—´æœ‰è¿æ¥å’Œäº¤äº’ï¼Œéœ€è¦é€‰æ‹©åˆé€‚çš„è¿æ¥æ–¹å¼ï¼Œå¹¶ä¸”å¯¹è¿æ¥è¿›è¡Œç®¡ç†ã€‚ä¾‹å¦‚ï¼Œè¿æ¥å»ºç«‹ã€è¿æ¥æ£€æµ‹ã€è¿æ¥ä¸­æ–­åå¦‚ä½•å¤„ç†ç­‰ã€‚ä»»åŠ¡åˆ†é…å™¨éœ€è¦å¢åŠ åˆ†é…ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œå¸¸è§çš„åŒæœºç®—æ³•æœ‰ä¸»å¤‡ã€ä¸»ä¸»ï¼Œä¸»å¤‡æ–¹æ¡ˆåˆå¯ä»¥ç»†åˆ†ä¸ºå†·å¤‡ã€æ¸©å¤‡ã€çƒ­å¤‡ã€‚</p>\n<p><img data-src=\"/images/architecture/Learn_Architecture_From_0/01-gaokeyong01.png\" alt=\"\"></p>\n<h4 id=\"å­˜å‚¨é«˜å¯ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#å­˜å‚¨é«˜å¯ç”¨\">#</a> å­˜å‚¨é«˜å¯ç”¨</h4>\n<p>å­˜å‚¨å’Œè®¡ç®—ç›¸æ¯”ï¼Œæœ‰ä¸€ä¸ªæœ¬è´¨çš„åŒºåˆ«ï¼šå°†æ•°æ®ä»ä¸€å°æœºå™¨æ¬åˆ°å¦ä¸€å°æœºå™¨ï¼Œéœ€è¦ç»è¿‡çº¿è·¯è¿›è¡Œä¼ è¾“ã€‚</p>\n<p>çº¿è·¯ä¼ è¾“çš„é€Ÿåº¦æ˜¯æ¯«ç§’çº§çš„ï¼Œä½†æ˜¯å¯¹é«˜å¯ç”¨ç³»ç»Ÿï¼Œæœ‰è¿™æœ¬è´¨ä¸Šçš„ä¸åŒã€‚ è¿™æ„å‘³ç€æ•´ä¸ªç³»ç»Ÿåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œæ•°æ®è‚¯å®šæ˜¯ä¸ä¸€è‡´çš„ã€‚æŒ‰ç…§ â€œ<span class=\"label warning\">æ•°æ® + é€»è¾‘ = ä¸šåŠ¡</span>â€ è¿™ä¸ªå…¬å¼æ¥å¥—çš„è¯ï¼Œæ•°æ®ä¸ä¸€è‡´ï¼Œå³ä½¿é€»è¾‘ä¸€è‡´ï¼Œæœ€åçš„ä¸šåŠ¡è¡¨ç°å°±ä¸ä¸€æ ·äº†ã€‚</p>\n<p>æ‰€ä»¥ï¼š å­˜å‚¨é«˜å¯ç”¨çš„éš¾ç‚¹ ä¸åœ¨äº å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Œè€Œåœ¨äºå¦‚ä½•å‡å°‘æˆ–è€…è§„é¿æ•°æ®ä¸ä¸€è‡´å¯¹ä¸šåŠ¡é€ æˆçš„å½±å“ã€‚</p>\n<h4 id=\"é«˜å¯ç”¨çŠ¶æ€å†³ç­–\"><a class=\"markdownIt-Anchor\" href=\"#é«˜å¯ç”¨çŠ¶æ€å†³ç­–\">#</a> é«˜å¯ç”¨çŠ¶æ€å†³ç­–</h4>\n<p>æ— è®ºæ˜¯è®¡ç®—é«˜å¯ç”¨è¿˜æ˜¯å­˜å‚¨é«˜å¯ç”¨ï¼Œå…¶åŸºç¡€éƒ½æ˜¯ â€œçŠ¶æ€å†³ç­–â€ï¼Œå³ç³»ç»Ÿéœ€è¦èƒ½å¤Ÿåˆ¤æ–­å½“å‰çš„çŠ¶æ€æ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸å°±è¦é‡‡å–è¡ŒåŠ¨æ¥ä¿è¯é«˜å¯ç”¨ã€‚ä½†åœ¨å…·ä½“å®è·µçš„è¿‡ç¨‹ä¸­ï¼Œæ°å¥½å­˜åœ¨ä¸€ä¸ªæœ¬è´¨çš„çŸ›ç›¾ï¼šé€šè¿‡å†—ä½™æ¥å®ç°çš„é«˜å¯ç”¨ç³»ç»Ÿï¼ŒçŠ¶æ€å†³ç­–æœ¬è´¨ä¸Šå°±ä¸å¯èƒ½åšåˆ°å®Œå…¨æ­£ç¡®ã€‚</p>\n<h5 id=\"ç‹¬è£å¼å†³ç­–\"><a class=\"markdownIt-Anchor\" href=\"#ç‹¬è£å¼å†³ç­–\">#</a> ç‹¬è£å¼å†³ç­–</h5>\n<p>ç‹¬è£å¼å†³ç­–æŒ‡çš„æ˜¯å­˜åœ¨ä¸€ä¸ªç‹¬ç«‹çš„å†³ç­–ä¸»ä½“ï¼Œæˆ‘ä»¬å§‘ä¸”ç§°å®ƒä¸º â€œå†³ç­–è€…â€ï¼Œè´Ÿè´£æ”¶é›†ä¿¡æ¯ç„¶åè¿›è¡Œå†³ç­–ï¼›æ‰€æœ‰å†—ä½™çš„ä¸ªä½“ï¼Œæˆ‘ä»¬å§‘ä¸”ç§°å®ƒä¸º â€œä¸ŠæŠ¥è€…â€ï¼Œéƒ½å°†çŠ¶æ€ä¿¡æ¯å‘é€ç»™å†³ç­–è€…ã€‚</p>\n<p><img data-src=\"/images/architecture/Learn_Architecture_From_0/01-gaokeyong02.png\" alt=\"\"></p>\n<p>ç‹¬è£å¼çš„å†³ç­–æ–¹å¼ä¸ä¼šå‡ºç°å†³ç­–æ··ä¹±çš„é—®é¢˜ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå†³ç­–è€…ï¼Œä½†é—®é¢˜ä¹Ÿæ­£æ˜¯åœ¨äºåªæœ‰ä¸€ä¸ªå†³ç­–è€…ã€‚å½“å†³ç­–è€…æœ¬èº«æ•…éšœæ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿå°±æ— æ³•å®ç°å‡†ç¡®çš„çŠ¶æ€å†³ç­–ã€‚å¦‚æœå†³ç­–è€…æœ¬èº«åˆåšä¸€å¥—çŠ¶æ€å†³ç­–ï¼Œé‚£å°±é™·å…¥ä¸€ä¸ªé€’å½’çš„æ­»å¾ªç¯äº†ã€‚</p>\n<h5 id=\"åå•†å¼\"><a class=\"markdownIt-Anchor\" href=\"#åå•†å¼\">#</a> åå•†å¼</h5>\n<p>åå•†å¼å†³ç­–æŒ‡çš„æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ä¸ªä½“é€šè¿‡äº¤æµä¿¡æ¯ï¼Œç„¶åæ ¹æ®è§„åˆ™è¿›è¡Œå†³ç­–ï¼Œæœ€å¸¸ç”¨çš„åå•†å¼å†³ç­–å°±æ˜¯ä¸»å¤‡å†³ç­–ã€‚</p>\n<h5 id=\"æ°‘ä¸»å¼\"><a class=\"markdownIt-Anchor\" href=\"#æ°‘ä¸»å¼\">#</a> æ°‘ä¸»å¼</h5>\n<p>æ°‘ä¸»å¼å†³ç­–æŒ‡çš„æ˜¯å¤šä¸ªç‹¬ç«‹çš„ä¸ªä½“é€šè¿‡æŠ•ç¥¨çš„æ–¹å¼æ¥è¿›è¡ŒçŠ¶æ€å†³ç­–ã€‚ä¾‹å¦‚ï¼Œ <code>ZooKeeper</code>  é›†ç¾¤åœ¨é€‰ä¸¾  <code>leader</code>  æ—¶å°±æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚</p>\n<p>è¿™ç§æ–¹å¼å®ç°å¤æ‚ï¼Œè¿˜æœ‰ä¸€ä¸ªç¼ºé™·ï¼šè„‘è£‚ã€‚è„‘è£‚çš„æ ¹æœ¬åŸå› æ˜¯ï¼ŒåŸæ¥ç»Ÿä¸€çš„é›†ç¾¤å› ä¸ºè¿æ¥ä¸­æ–­ï¼Œé€ æˆäº†ä¸¤ä¸ªç‹¬ç«‹åˆ†éš”çš„å­é›†ç¾¤ï¼Œæ¯ä¸ªå­é›†ç¾¤å•ç‹¬è¿›è¡Œé€‰ä¸¾ï¼Œäºæ˜¯é€‰å‡ºäº†  <code>2</code>  ä¸ªä¸»æœºï¼Œç›¸å½“äºäººä½“æœ‰ä¸¤ä¸ªå¤§è„‘äº†ã€‚</p>\n<p>ä¸ºäº†è§£å†³è„‘è£‚é—®é¢˜ï¼Œæ°‘ä¸»å¼å†³ç­–çš„ç³»ç»Ÿä¸€èˆ¬éƒ½é‡‡ç”¨ â€œæŠ•ç¥¨èŠ‚ç‚¹æ•°å¿…é¡»è¶…è¿‡ç³»ç»Ÿæ€»èŠ‚ç‚¹æ•°ä¸€åŠâ€ è§„åˆ™æ¥å¤„ç†ã€‚ï¼Œä½†åŒæ—¶é™ä½äº†ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ï¼Œå³å¦‚æœç³»ç»Ÿä¸æ˜¯å› ä¸ºè„‘è£‚é—®é¢˜å¯¼è‡´æŠ•ç¥¨èŠ‚ç‚¹æ•°è¿‡å°‘ï¼Œè€ŒçœŸçš„æ˜¯å› ä¸ºèŠ‚ç‚¹æ•…éšœæ—¶ç³»ç»Ÿä¹Ÿä¸ä¼šé€‰å‡ºä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ç›¸å½“äºå®•æœºäº†ï¼Œ</p>\n<p>ç»¼åˆåˆ†æï¼Œæ— è®ºé‡‡å–ä»€ä¹ˆæ ·çš„æ–¹æ¡ˆï¼ŒçŠ¶æ€å†³ç­–éƒ½ä¸å¯èƒ½åšåˆ°ä»»ä½•åœºæ™¯ä¸‹éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†å®Œå…¨ä¸åšé«˜å¯ç”¨æ–¹æ¡ˆåˆä¼šäº§ç”Ÿæ›´å¤§çš„é—®é¢˜ï¼Œå¦‚ä½•é€‰å–é€‚åˆç³»ç»Ÿçš„é«˜å¯ç”¨æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¤æ‚çš„åˆ†æã€åˆ¤æ–­å’Œé€‰æ‹©çš„è¿‡ç¨‹ã€‚</p>\n<h3 id=\"å¤æ‚åº¦æ¥æºå¯æ‰©å±•æ€§\"><a class=\"markdownIt-Anchor\" href=\"#å¤æ‚åº¦æ¥æºå¯æ‰©å±•æ€§\">#</a> å¤æ‚åº¦æ¥æºï¼šå¯æ‰©å±•æ€§</h3>\n<p>è®¾è®¡å…·å¤‡è‰¯å¥½å¯æ‰©å±•æ€§çš„ç³»ç»Ÿï¼Œæœ‰ä¸¤ä¸ªåŸºæœ¬æ¡ä»¶ï¼šæ­£ç¡®é¢„æµ‹å˜åŒ–ã€å®Œç¾å°è£…å˜åŒ–ã€‚ä½†è¦è¾¾æˆè¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä»¶å¤æ‚çš„äº‹æƒ…ã€‚</p>\n<h4 id=\"é¢„æµ‹å˜åŒ–\"><a class=\"markdownIt-Anchor\" href=\"#é¢„æµ‹å˜åŒ–\">#</a> é¢„æµ‹å˜åŒ–</h4>\n<p>é¢„æµ‹å˜åŒ–çš„å¤æ‚æ€§åœ¨äºï¼š</p>\n<ul>\n<li><ins class=\"wavy success\">ä¸èƒ½æ¯ä¸ªè®¾è®¡ç‚¹éƒ½è€ƒè™‘å¯æ‰©å±•æ€§ã€‚</ins></li>\n<li><ins class=\"wavy success\">ä¸èƒ½å®Œå…¨ä¸è€ƒè™‘å¯æ‰©å±•æ€§ã€‚</ins></li>\n<li><ins class=\"wavy success\">æ‰€æœ‰çš„é¢„æµ‹éƒ½å­˜åœ¨å‡ºé”™çš„å¯èƒ½æ€§ã€‚</ins></li>\n</ul>\n<p>å¯¹äºæ¶æ„å¸ˆæ¥è¯´ï¼Œå¦‚ä½•æŠŠæ¡é¢„æµ‹çš„ç¨‹åº¦å’Œæå‡é¢„æµ‹ç»“æœçš„å‡†ç¡®æ€§ï¼Œæ˜¯ä¸€ä»¶å¾ˆå¤æ‚çš„äº‹æƒ…ï¼Œè€Œä¸”æ²¡æœ‰é€šç”¨çš„æ ‡å‡†å¯ä»¥ç®€å•å¥—ä¸Šå»ï¼Œæ›´å¤šæ˜¯é è‡ªå·±çš„ç»éªŒã€ç›´è§‰ï¼Œæ‰€ä»¥æ¶æ„è®¾è®¡è¯„å®¡çš„æ—¶å€™ç»å¸¸ä¼šå‡ºç°ä¸¤ä¸ªè®¾è®¡å¸ˆå¯¹æŸä¸ªåˆ¤æ–­äº‰å¾—é¢çº¢è€³èµ¤çš„æƒ…å†µï¼ŒåŸå› å°±åœ¨äºæ²¡æœ‰æ˜ç¡®æ ‡å‡†ï¼Œä¸åŒçš„äººç†è§£å’Œåˆ¤æ–­æœ‰åå·®ï¼Œè€Œæœ€ç»ˆåˆåªèƒ½é€‰æ‹©ä¸€ä¸ªåˆ¤æ–­ã€‚</p>\n<h4 id=\"åº”å¯¹å˜åŒ–\"><a class=\"markdownIt-Anchor\" href=\"#åº”å¯¹å˜åŒ–\">#</a> åº”å¯¹å˜åŒ–</h4>\n<p><ins class=\"wavy success\">é¢„æµ‹å˜åŒ–æ˜¯ä¸€å›äº‹ï¼Œé‡‡å–ä»€ä¹ˆæ–¹æ¡ˆæ¥åº”å¯¹å˜åŒ–ï¼Œåˆæ˜¯å¦å¤–ä¸€ä¸ªå¤æ‚çš„äº‹æƒ….</ins></p>\n<ul>\n<li>\n<p>ç¬¬ä¸€ç§åº”å¯¹å˜åŒ–çš„å¸¸è§æ–¹æ¡ˆæ˜¯å°† â€œå˜åŒ–â€ å°è£…åœ¨ä¸€ä¸ª â€œå˜åŒ–å±‚â€ï¼Œå°†ä¸å˜çš„éƒ¨åˆ†å°è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ â€œç¨³å®šå±‚â€ã€‚é‚£ä¹ˆä¸»è¦çš„é—®é¢˜å°±ä¼šèšç„¦åœ¨ å˜åŒ–å±‚å’Œç¨³å®šå±‚ã€‚</p>\n<ol>\n<li>ç³»ç»Ÿéœ€è¦æ‹†åˆ†å‡ºå˜åŒ–å±‚å’Œç¨³å®šå±‚å¯¹äºå“ªäº›å±äºå˜åŒ–å±‚ï¼Œå“ªäº›å±äºç¨³å®šå±‚ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯åƒå‰é¢çš„ç¤ºä¾‹ï¼ˆä¸åŒæ¥å£åè®®æˆ–è€…ä¸åŒæ•°æ®åº“ï¼‰é‚£æ ·æ˜ç¡®ï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„ç†è§£ï¼Œå¯¼è‡´æ¶æ„è®¾è®¡è¯„å®¡çš„æ—¶å€™å¯èƒ½åµç¿»å¤©ã€‚</li>\n<li>éœ€è¦è®¾è®¡å˜åŒ–å±‚å’Œç¨³å®šå±‚ä¹‹é—´çš„æ¥å£æ¥å£è®¾è®¡åŒæ ·è‡³å…³é‡è¦ï¼Œå¯¹äºç¨³å®šå±‚æ¥è¯´ï¼Œæ¥å£è‚¯å®šæ˜¯è¶Šç¨³å®šè¶Šå¥½ï¼›ä½†å¯¹äºå˜åŒ–å±‚æ¥è¯´ï¼Œåœ¨æœ‰å·®å¼‚çš„å¤šä¸ªå®ç°æ–¹å¼ä¸­æ‰¾å‡ºå…±åŒç‚¹ï¼Œå¹¶ä¸”è¿˜è¦ä¿è¯å½“åŠ å…¥æ–°çš„åŠŸèƒ½æ—¶åŸæœ‰çš„æ¥å£è®¾è®¡ä¸éœ€è¦å¤ªå¤§ä¿®æ”¹ï¼Œè¿™æ˜¯ä¸€ä»¶å¾ˆå¤æ‚çš„äº‹æƒ…ã€‚</li>\n</ol>\n</li>\n<li>\n<p>ç¬¬äºŒç§å¸¸è§çš„åº”å¯¹å˜åŒ–çš„æ–¹æ¡ˆæ˜¯æç‚¼å‡ºä¸€ä¸ª â€œæŠ½è±¡å±‚â€ å’Œä¸€ä¸ª â€œå®ç°å±‚â€ã€‚æŠ½è±¡å±‚æ˜¯ç¨³å®šçš„ï¼Œå®ç°å±‚å¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€è¦å®šåˆ¶å¼€å‘ï¼Œå½“åŠ å…¥æ–°çš„åŠŸèƒ½æ—¶ï¼Œåªéœ€è¦å¢åŠ æ–°çš„å®ç°ï¼Œæ— é¡»ä¿®æ”¹æŠ½è±¡å±‚ã€‚è¿™ç§æ–¹æ¡ˆå…¸å‹çš„å®è·µå°±æ˜¯è®¾è®¡æ¨¡å¼å’Œè§„åˆ™å¼•æ“ã€‚</p>\n</li>\n</ul>\n<p><ins>å°è£…å˜åŒ–ï¼Œéš”ç¦»å¯å˜æ€§</ins></p>\n<h3 id=\"å¤æ‚åº¦æ¥æºä½æˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#å¤æ‚åº¦æ¥æºä½æˆæœ¬\">#</a> å¤æ‚åº¦æ¥æºï¼šä½æˆæœ¬</h3>\n<p>ä½æˆæœ¬ç»™æ¶æ„è®¾è®¡å¸¦æ¥çš„ä¸»è¦å¤æ‚åº¦ä½“ç°åœ¨ï¼Œå¾€å¾€åªæœ‰ â€œåˆ›æ–°â€ æ‰èƒ½è¾¾åˆ°ä½æˆæœ¬ç›®æ ‡ã€‚æ— è®ºæ˜¯å¼•å…¥æ–°æŠ€æœ¯ï¼Œè¿˜æ˜¯è‡ªå·±åˆ›é€ æ–°æŠ€æœ¯ï¼Œéƒ½æ˜¯ä¸€ä»¶å¤æ‚çš„äº‹æƒ…ã€‚å¼•å…¥æ–°æŠ€æœ¯çš„ä¸»è¦å¤æ‚åº¦åœ¨äºéœ€è¦å»ç†Ÿæ‚‰æ–°æŠ€æœ¯ï¼Œå¹¶ä¸”å°†æ–°æŠ€æœ¯ä¸å·²æœ‰æŠ€æœ¯ç»“åˆèµ·æ¥ï¼›åˆ›é€ æ–°æŠ€æœ¯çš„ä¸»è¦å¤æ‚åº¦åœ¨äºéœ€è¦è‡ªå·±å»åˆ›é€ å…¨æ–°çš„ç†å¿µå’ŒæŠ€æœ¯ï¼Œå¹¶ä¸”æ–°æŠ€æœ¯è·Ÿæ—§æŠ€æœ¯ç›¸æ¯”ï¼Œéœ€è¦æœ‰è´¨çš„é£è·ƒã€‚</p>\n<h3 id=\"å¤æ‚åº¦æ¥æºå®‰å…¨\"><a class=\"markdownIt-Anchor\" href=\"#å¤æ‚åº¦æ¥æºå®‰å…¨\">#</a> å¤æ‚åº¦æ¥æºï¼šå®‰å…¨</h3>\n<p>å®‰å…¨æœ¬èº«æ˜¯ä¸€ä¸ªåºå¤§è€Œåˆå¤æ‚çš„æŠ€æœ¯é¢†åŸŸï¼Œå¹¶ä¸”ä¸€æ—¦å‡ºé—®é¢˜ï¼Œå¯¹ä¸šåŠ¡å’Œä¼ä¸šå½¢è±¡å½±å“éå¸¸å¤§ã€‚<br>\nä»æŠ€æœ¯çš„è§’åº¦æ¥è®²ï¼Œå®‰å…¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯åŠŸèƒ½ä¸Šçš„å®‰å…¨ï¼Œä¸€ç±»æ˜¯æ¶æ„ä¸Šçš„å®‰å…¨ã€‚</p>\n<ul>\n<li>åŠŸèƒ½å®‰å…¨æ˜¯ä¸€ä¸ªé€æ­¥å®Œå–„çš„è¿‡ç¨‹ï¼Œè€Œä¸”å¾€å¾€éƒ½æ˜¯åœ¨é—®é¢˜å‡ºç°åæ‰èƒ½æœ‰é’ˆå¯¹æ€§çš„æå‡ºè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬æ°¸è¿œæ— æ³•é¢„æµ‹ç³»ç»Ÿä¸‹ä¸€ä¸ªæ¼æ´åœ¨å“ªé‡Œï¼Œä¹Ÿä¸æ•¢è¯´è‡ªå·±çš„ç³»ç»Ÿè‚¯å®šæ²¡æœ‰ä»»ä½•é—®é¢˜ã€</li>\n<li>æ¶æ„å®‰å…¨ï¼šä¼ ç»Ÿçš„æ¶æ„å®‰å…¨ä¸»è¦ä¾é é˜²ç«å¢™ï¼Œé˜²ç«å¢™æœ€åŸºæœ¬çš„åŠŸèƒ½å°±æ˜¯éš”ç¦»ç½‘ç»œï¼Œé€šè¿‡å°†ç½‘ç»œåˆ’åˆ†æˆä¸åŒçš„åŒºåŸŸï¼Œåˆ¶å®šå‡ºä¸åŒåŒºåŸŸä¹‹é—´çš„è®¿é—®æ§åˆ¶ç­–ç•¥æ¥æ§åˆ¶ä¸åŒä¿¡ä»»ç¨‹åº¦åŒºåŸŸé—´ä¼ é€çš„æ•°æ®æµã€‚</li>\n</ul>\n<p>åŸºäºä¸Šè¿°åŸå› ï¼Œäº’è”ç½‘ç³»ç»Ÿçš„æ¶æ„å®‰å…¨ç›®å‰å¹¶æ²¡æœ‰å¤ªå¥½çš„è®¾è®¡æ‰‹æ®µæ¥å®ç°ï¼Œæ›´å¤šåœ°æ˜¯ä¾é è¿è¥å•†æˆ–è€…äº‘æœåŠ¡å•†å¼ºå¤§çš„å¸¦å®½å’Œæµé‡æ¸…æ´—çš„èƒ½åŠ›ï¼Œè¾ƒå°‘è‡ªå·±æ¥è®¾è®¡å’Œå®ç°ã€‚</p>\n<p><code>2018</code>  å¹´ï¼Œç¾å›½ä¸œéƒ¨æ—¶é—´  <code>2</code>  æœˆ  <code>28</code>  æ—¥ï¼Œ <code>GitHub</code>  åœ¨ä¸€ç¬é—´é­åˆ°é«˜è¾¾  <code>1.35Tbps</code>  çš„å¸¦å®½æ”»å‡»ã€‚</p>\n<h3 id=\"å¤æ‚åº¦æ¥æºè§„æ¨¡\"><a class=\"markdownIt-Anchor\" href=\"#å¤æ‚åº¦æ¥æºè§„æ¨¡\">#</a> å¤æ‚åº¦æ¥æºï¼šè§„æ¨¡</h3>\n<p>è§„æ¨¡å¸¦æ¥å¤æ‚åº¦çš„ä¸»è¦åŸå› å°±æ˜¯ â€œé‡å˜å¼•èµ·è´¨å˜â€ï¼Œå½“æ•°é‡è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼åï¼Œå¤æ‚åº¦ä¼šå‘ç”Ÿè´¨çš„å˜åŒ–ã€‚å¸¸è§çš„è§„æ¨¡å¸¦æ¥çš„å¤æ‚åº¦æœ‰ï¼š</p>\n<ol>\n<li>åŠŸèƒ½è¶Šæ¥è¶Šå¤šï¼Œå¯¼è‡´ç³»ç»Ÿå¤æ‚åº¦æŒ‡æ•°çº§ä¸Šå‡</li>\n<li>æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œç³»ç»Ÿå¤æ‚åº¦å‘ç”Ÿè´¨å˜</li>\n</ol>\n<h2 id=\"æ¶æ„è®¾è®¡åŸåˆ™\"><a class=\"markdownIt-Anchor\" href=\"#æ¶æ„è®¾è®¡åŸåˆ™\">#</a> æ¶æ„è®¾è®¡åŸåˆ™</h2>\n<p>å¯¹äºç¼–ç¨‹æ¥è¯´ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸èƒ½å­˜åœ¨ä¸ç¡®å®šçš„ï¼Œå¯¹äºåŒæ ·ä¸€æ®µä»£ç ï¼Œä¸ç®¡æ˜¯è°å†™çš„ï¼Œä¸ç®¡ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œæ‰§è¡Œçš„ç»“æœåº”è¯¥éƒ½æ˜¯ç¡®å®šçš„ï¼ˆæ³¨æ„ï¼šâ€œç¡®å®šçš„â€ å¹¶ä¸ç­‰äº â€œæ­£ç¡®çš„â€ï¼Œæœ‰  <code>bug</code>  ä¹Ÿæ˜¯ç¡®å®šçš„ï¼‰ã€‚è€Œå¯¹äºæ¶æ„è®¾è®¡æ¥è¯´ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ç¡®å®šçš„ï¼ŒåŒæ ·çš„ä¸€ä¸ªç³»ç»Ÿï¼Œ <code>A</code>  å…¬å¸å’Œ  <code>B</code>  å…¬å¸åšå‡ºæ¥çš„æ¶æ„å¯èƒ½å·®å¼‚å¾ˆå¤§ï¼Œä½†æœ€åéƒ½èƒ½æ­£å¸¸è¿è½¬ï¼›åŒæ ·ä¸€ä¸ªæ–¹æ¡ˆï¼Œ <code>A</code>  è®¾è®¡å¸ˆè®¤ä¸ºåº”è¯¥è¿™æ ·åšï¼Œ <code>B</code>  è®¾è®¡å¸ˆè®¤ä¸ºåº”è¯¥é‚£æ ·åšï¼Œçœ‹èµ·æ¥å¥½åƒéƒ½æœ‰é“ç†â€¦â€¦ ç›¸æ¯”ç¼–ç¨‹æ¥è¯´ï¼Œæ¶æ„è®¾è®¡å¹¶æ²¡æœ‰åƒç¼–ç¨‹è¯­è¨€é‚£æ ·çš„è¯­æ³•æ¥è¿›è¡Œçº¦æŸï¼Œæ›´å¤šçš„æ—¶å€™æ˜¯é¢å¯¹å¤šç§å¯èƒ½æ€§æ—¶è¿›è¡Œé€‰æ‹©ã€‚</p>\n<h3 id=\"åˆé€‚åŸåˆ™\"><a class=\"markdownIt-Anchor\" href=\"#åˆé€‚åŸåˆ™\">#</a> åˆé€‚åŸåˆ™</h3>\n<p><span class=\"label success\">â¤ï¸â¤ï¸â¤ï¸åˆé€‚åŸåˆ™å®£è¨€ï¼šâ€œåˆé€‚ä¼˜äºä¸šç•Œé¢†å…ˆâ€</span></p>\n<p>çœŸæ­£ä¼˜ç§€çš„æ¶æ„éƒ½æ˜¯åœ¨ä¼ä¸šå½“å‰äººåŠ›ã€æ¡ä»¶ã€ä¸šåŠ¡ç­‰å„ç§çº¦æŸä¸‹è®¾è®¡å‡ºæ¥çš„ï¼Œèƒ½å¤Ÿåˆç†åœ°å°†èµ„æºæ•´åˆåœ¨ä¸€èµ·å¹¶å‘æŒ¥å‡ºæœ€å¤§åŠŸæ•ˆï¼Œå¹¶ä¸”èƒ½å¤Ÿå¿«é€Ÿè½åœ°ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤š BAT å‡ºæ¥çš„æ¶æ„å¸ˆåˆ°äº†å°å…¬å¸æˆ–è€…åˆ›ä¸šå›¢é˜Ÿåè€Œåšä¸å‡ºæˆç»©çš„åŸå› ï¼Œå› ä¸ºæ²¡æœ‰äº†å¤§å…¬å¸çš„å¹³å°ã€èµ„æºã€ç§¯ç´¯ï¼Œåªæ˜¯ç”Ÿæ¬ç¡¬å¥—å¤§å…¬å¸çš„åšæ³•ï¼Œå¤±è´¥çš„æ¦‚ç‡éå¸¸é«˜ã€‚</p>\n<h3 id=\"æ¼”åŒ–åŸåˆ™\"><a class=\"markdownIt-Anchor\" href=\"#æ¼”åŒ–åŸåˆ™\">#</a> æ¼”åŒ–åŸåˆ™</h3>\n<p><span class=\"label success\">â¤ï¸â¤ï¸æ¼”åŒ–åŸåˆ™å®£è¨€ï¼šâ€œæ¼”åŒ–ä¼˜äºä¸€æ­¥åˆ°ä½â€</span></p>\n<p>å¯¹äºå»ºç­‘æ¥è¯´ï¼Œæ°¸æ’æ˜¯ä¸»é¢˜ï¼›è€Œå¯¹äºè½¯ä»¶æ¥è¯´ï¼Œå˜åŒ–æ‰æ˜¯ä¸»é¢˜ã€‚è½¯ä»¶æ¶æ„éœ€è¦æ ¹æ®ä¸šåŠ¡çš„å‘å±•è€Œä¸æ–­å˜åŒ–ã€‚è®¾è®¡  <code>Windows</code>  å’Œ  <code>Android</code>  çš„äººéƒ½æ˜¯é¡¶å°–çš„å¤©æ‰ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œä»–ä»¬ä¹Ÿä¸å¯èƒ½åœ¨  <code>1985</code>  å¹´è®¾è®¡å‡º  <code>Windows 8</code> ï¼Œä¸å¯èƒ½åœ¨  <code>2009</code>  å¹´è®¾è®¡å‡º  <code>Android 6.0</code> ã€‚</p>\n<p>è€ƒè™‘åˆ°è½¯ä»¶æ¶æ„éœ€è¦æ ¹æ®ä¸šåŠ¡å‘å±•ä¸æ–­å˜åŒ–è¿™ä¸ªæœ¬è´¨ç‰¹ç‚¹ï¼Œè½¯ä»¶æ¶æ„è®¾è®¡å…¶å®æ›´åŠ ç±»ä¼¼äºå¤§è‡ªç„¶ â€œè®¾è®¡â€ ä¸€ä¸ªç”Ÿç‰©ï¼Œé€šè¿‡æ¼”åŒ–è®©ç”Ÿç‰©é€‚åº”ç¯å¢ƒï¼Œé€æ­¥å˜å¾—æ›´åŠ å¼ºå¤§ï¼š</p>\n<p>é¦–å…ˆï¼Œè®¾è®¡å‡ºæ¥çš„æ¶æ„è¦æ»¡è¶³å½“æ—¶çš„ä¸šåŠ¡éœ€è¦ã€‚<br>\nå…¶æ¬¡ï¼Œæ¶æ„è¦ä¸æ–­åœ°åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­è¿­ä»£ï¼Œä¿ç•™ä¼˜ç§€çš„è®¾è®¡ï¼Œä¿®å¤æœ‰ç¼ºé™·çš„è®¾è®¡ï¼Œæ”¹æ­£é”™è¯¯çš„è®¾è®¡ï¼Œå»æ‰æ— ç”¨çš„è®¾è®¡ï¼Œä½¿å¾—æ¶æ„é€æ¸å®Œå–„ã€‚<br>\nç¬¬ä¸‰ï¼Œå½“ä¸šåŠ¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ¶æ„è¦æ‰©å±•ã€é‡æ„ï¼Œç”šè‡³é‡å†™ï¼›ä»£ç ä¹Ÿè®¸ä¼šé‡å†™ï¼Œä½†æœ‰ä»·å€¼çš„ç»éªŒã€æ•™è®­ã€é€»è¾‘ã€è®¾è®¡ç­‰ï¼ˆç±»ä¼¼ç”Ÿç‰©ä½“å†…çš„åŸºå› ï¼‰å´å¯ä»¥åœ¨æ–°æ¶æ„ä¸­å»¶ç»­ã€‚</p>\n<h3 id=\"ç®€å•åŸåˆ™\"><a class=\"markdownIt-Anchor\" href=\"#ç®€å•åŸåˆ™\">#</a> ç®€å•åŸåˆ™</h3>\n<p><span class=\"label success\">â¤ï¸ç®€å•åŸåˆ™å®£è¨€ï¼šâ€œç®€å•ä¼˜äºå¤æ‚â€</span></p>\n<p>ç»“æ„ä¸Šçš„å¤æ‚æ€§å­˜åœ¨çš„ç¬¬ä¸‰ä¸ªé—®é¢˜æ˜¯ï¼Œå®šä½ä¸€ä¸ªå¤æ‚ç³»ç»Ÿä¸­çš„é—®é¢˜æ€»æ˜¯æ¯”ç®€å•ç³»ç»Ÿæ›´åŠ å›°éš¾ã€‚é¦–å…ˆæ˜¯ç»„ä»¶å¤šï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰å«Œç–‘ï¼Œå› æ­¤è¦é€ä¸€æ’æŸ¥ï¼›å…¶æ¬¡ç»„ä»¶é—´çš„å…³ç³»å¤æ‚ï¼Œæœ‰å¯èƒ½è¡¨ç°æ•…éšœçš„ç»„ä»¶å¹¶ä¸æ˜¯çœŸæ­£é—®é¢˜çš„æ ¹æºã€‚</p>\n<p>é€»è¾‘ä¸Šçš„å¤æ‚ã€‚</p>\n<p>ç»¼åˆå‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç»“æ„çš„å¤æ‚æ€§ï¼Œè¿˜æ˜¯é€»è¾‘çš„å¤æ‚æ€§ï¼Œéƒ½ä¼šå­˜åœ¨å„ç§é—®é¢˜ï¼Œæ‰€ä»¥æ¶æ„è®¾è®¡æ—¶å¦‚æœç®€å•çš„æ–¹æ¡ˆå’Œå¤æ‚çš„æ–¹æ¡ˆéƒ½å¯ä»¥æ»¡è¶³éœ€æ±‚ï¼Œæœ€å¥½é€‰æ‹©ç®€å•çš„æ–¹æ¡ˆã€‚</p>\n<p>è¯¾ç¨‹ä¸­ä»‹ç»äº†ä¸¤ä¸ªæ¡ˆä¾‹ï¼šæ·˜å®å’Œæ‰‹æœº <code>qq</code> .</p>\n<p>ä¸¤æœ¬ä¹¦ï¼šã€Šæ·˜å®æŠ€æœ¯å‘å±•ã€‹ . ã€ŠQQ 1.4 äº¿åœ¨çº¿èƒŒåçš„æ•…äº‹ã€‹</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "æ¶æ„",
                "ç¬”è®°"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/01/07/daily/2022-01-07/",
            "url": "https://fangjiaxiaobai.github.io/2022/01/07/daily/2022-01-07/",
            "title": "Springbooté›†æˆNetty.",
            "date_published": "2022-01-07T10:18:18.000Z",
            "content_html": "<h2 id=\"æ·»åŠ ä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#æ·»åŠ ä¾èµ–\">#</a> æ·»åŠ ä¾èµ–</h2>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/io.netty/netty-all --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.netty<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>netty-all<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.1.72.Final<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºæœåŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæœåŠ¡\">#</a> åˆ›å»ºæœåŠ¡</h2>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line_number&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelFuture;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelInitializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelOption;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.EventLoopGroup;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.handler.codec.LineBasedFrameDecoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.InetSocketAddress;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.PostConstruct;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.PreDestroy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Netty æœåŠ¡ç«¯</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022-01-07 23:37</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RouterServer2</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * boss çº¿ç¨‹ç»„ç”¨äºå¤„ç†è¿æ¥å·¥ä½œ</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> EventLoopGroup boss = <span class=\"keyword\">new</span> NioEventLoopGroup();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * work çº¿ç¨‹ç»„ç”¨äºæ•°æ®å¤„ç†</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> EventLoopGroup work = <span class=\"keyword\">new</span> NioEventLoopGroup();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ChannelHandler childHandler;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * SpringBoot å¯åŠ¨çš„æ—¶å€™ è°ƒç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        ServerBootstrap bootstrap = <span class=\"keyword\">new</span> ServerBootstrap();</span><br><span class=\"line\">        bootstrap.group(boss, work)</span><br><span class=\"line\">            <span class=\"comment\">// æŒ‡å®šChannel </span></span><br><span class=\"line\">            .channel(NioServerSocketChannel.class)</span><br><span class=\"line\">            <span class=\"comment\">//ä½¿ç”¨æŒ‡å®šçš„ç«¯å£è®¾ç½®å¥—æ¥å­—åœ°å€</span></span><br><span class=\"line\">            .localAddress(<span class=\"keyword\">new</span> InetSocketAddress(<span class=\"number\">7788</span>))</span><br><span class=\"line\">            <span class=\"comment\">//æœåŠ¡ç«¯å¯è¿æ¥é˜Ÿåˆ—æ•°,å¯¹åº”TCP/IPåè®®listenå‡½æ•°ä¸­backlogå‚æ•°</span></span><br><span class=\"line\">            .option(ChannelOption.SO_BACKLOG, <span class=\"number\">1024</span>)</span><br><span class=\"line\">            <span class=\"comment\">//è®¾ç½®TCPé•¿è¿æ¥,ä¸€èˆ¬å¦‚æœä¸¤ä¸ªå°æ—¶å†…æ²¡æœ‰æ•°æ®çš„é€šä¿¡æ—¶,TCPä¼šè‡ªåŠ¨å‘é€ä¸€ä¸ªæ´»åŠ¨æ¢æµ‹æ•°æ®æŠ¥æ–‡</span></span><br><span class=\"line\">            .childOption(ChannelOption.SO_KEEPALIVE, <span class=\"keyword\">true</span>)</span><br><span class=\"line\">            <span class=\"comment\">//å°†å°çš„æ•°æ®åŒ…åŒ…è£…æˆæ›´å¤§çš„å¸§è¿›è¡Œä¼ é€ï¼Œæé«˜ç½‘ç»œçš„è´Ÿè½½,å³TCPå»¶è¿Ÿä¼ è¾“</span></span><br><span class=\"line\">            .childOption(ChannelOption.TCP_NODELAY, <span class=\"keyword\">true</span>)</span><br><span class=\"line\">            .childHandler(<span class=\"keyword\">new</span> ChannelInitializer&lt;Channel&gt;() &#123; â‘£</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">initChannel</span><span class=\"params\">(Channel ch)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">                    ch.pipeline()</span><br><span class=\"line\">                        <span class=\"comment\">//æ·»åŠ ç¼–ç å™¨ â“ª</span></span><br><span class=\"line\">                        .addLast(<span class=\"keyword\">new</span> RouterMessageEncode())</span><br><span class=\"line\">                        <span class=\"comment\">//æ·»åŠ Netty è‡ªå¸¦çš„ æ¢è¡Œè§£ç å™¨ï¼ˆç”¨æ¥è§£å†³ æ²¾åŒ…ï¼Œæ‹†åŒ…ï¼‰ â‘ </span></span><br><span class=\"line\">                        .addLast(<span class=\"keyword\">new</span> LineBasedFrameDecoder(<span class=\"number\">1024</span>))</span><br><span class=\"line\">                        <span class=\"comment\">//æ·»åŠ è‡ªå®šä¹‰çš„ è§£ç å™¨ â‘¡</span></span><br><span class=\"line\">                        .addLast(<span class=\"keyword\">new</span> RouterMessageDecode())</span><br><span class=\"line\">                        <span class=\"comment\">//æ·»åŠ  æ¥æ”¶æ¶ˆæ¯çš„ å¤„ç†å™¨ â‘¢</span></span><br><span class=\"line\">                        .addLast(<span class=\"keyword\">new</span> ServiceMessageReceiveHandler());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        ChannelFuture future = bootstrap.bind().sync();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (future.isSuccess()) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;start router Server success on port 7788&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * SpringBoot é”€æ¯çš„æ—¶å€™ è°ƒç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> InterruptedException ä¸­æ–­å¼‚å¸¸</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PreDestroy</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">destory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        boss.shutdownGracefully().sync();</span><br><span class=\"line\">        work.shutdownGracefully().sync();</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;å…³é—­Netty&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ğŸ”¥ â“ª: <code>RouterMessageEncode</code> : è¿™ä¸ªæ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„æ¶ˆæ¯ç¼–ç å™¨ã€‚<br>\nğŸ”¥â‘ : ä½¿ç”¨ <code>Netty</code>  æä¾›çš„åŒ…å¤„ç†å·¥å…·ï¼Œå¤„ç†ç²˜åŒ…é—®é¢˜å·²ç»ç”¨æ¥æ‹†åŒ…ã€‚<br>\nğŸ”¥â‘¡: è‡ªå®šä¹‰çš„è§£ç å™¨ã€‚<br>\nğŸ”¥â‘¢: è‡ªå®šä¹‰çš„æ¶ˆæ¯å¤„ç†å™¨ã€‚ é€šç”¨ç”¨æ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚<br>\nğŸ”¥â‘£: è¿™é‡Œé…ç½®çš„æ˜¯åœ¨ <code>Netty</code>  å¯åŠ¨æ—¶ï¼Œéœ€è¦æ·»åŠ çš„  <code>Channel</code> .</p>\n<h2 id=\"è‡ªå®šä¹‰ç¼–ç å™¨\"><a class=\"markdownIt-Anchor\" href=\"#è‡ªå®šä¹‰ç¼–ç å™¨\">#</a> è‡ªå®šä¹‰ç¼–ç å™¨</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.buffer.ByteBufUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.handler.codec.MessageToMessageEncoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.CharBuffer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.Charset;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ç¼–ç å™¨</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022-01-07 23:50</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RouterMessageEncode</span> <span class=\"keyword\">extends</span> <span class=\"title\">MessageToMessageEncoder</span>&lt;<span class=\"title\">String</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">encode</span><span class=\"params\">(ChannelHandlerContext channelHandlerContext, String message,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        List&lt;Object&gt; list)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        list.add(ByteBufUtil.encodeString(channelHandlerContext.alloc(), CharBuffer.wrap(message), Charset.defaultCharset()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"è‡ªå®šä¹‰è§£ç å™¨\"><a class=\"markdownIt-Anchor\" href=\"#è‡ªå®šä¹‰è§£ç å™¨\">#</a> è‡ªå®šä¹‰è§£ç å™¨</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.buffer.ByteBuf;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.handler.codec.MessageToMessageDecoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.Charset;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * è§£ç å™¨</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022-01-07 23:54</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RouterMessageDecode</span> <span class=\"keyword\">extends</span> <span class=\"title\">MessageToMessageDecoder</span>&lt;<span class=\"title\">ByteBuf</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">decode</span><span class=\"params\">(ChannelHandlerContext ctx, ByteBuf msg, List&lt;Object&gt; list)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// todo è§£ç </span></span><br><span class=\"line\">        String message = msg.toString(Charset.defaultCharset());</span><br><span class=\"line\">        list.add(message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¶ˆæ¯å¤„ç†é€»è¾‘\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯å¤„ç†é€»è¾‘\">#</a> æ¶ˆæ¯å¤„ç†é€»è¾‘</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.handler.timeout.IdleStateEvent;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¶ˆæ¯å¤„ç†å™¨</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022-01-07 23:59</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceMessageReceiveHandler</span> <span class=\"keyword\">extends</span> <span class=\"title\">SimpleChannelInboundHandler</span>&lt;<span class=\"title\">String</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">channelRead0</span><span class=\"params\">(ChannelHandlerContext ctx, String msg)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;æ”¶åˆ°æ¶ˆæ¯:&quot;</span> + msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ³¨å†Œä¸€ä¸ª  channel</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ctx ChannelHandlerContext</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception å¼‚å¸¸</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">channelRegistered</span><span class=\"params\">(ChannelHandlerContext ctx)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.channelRegistered(ctx);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;channel registed ...&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * channel é€€å‡º</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ctx</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">channelUnregistered</span><span class=\"params\">(ChannelHandlerContext ctx)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.channelUnregistered(ctx);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;channel unregistered ....&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ¥æ”¶åˆ°çš„äº‹ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ctx ChannelHandlerContext</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> evt Object</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception å¼‚å¸¸</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">userEventTriggered</span><span class=\"params\">(ChannelHandlerContext ctx, Object evt)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.userEventTriggered(ctx, evt);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (evt <span class=\"keyword\">instanceof</span> IdleStateEvent) &#123;</span><br><span class=\"line\">            IdleStateEvent event = (IdleStateEvent) evt;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;event:&quot;</span> + event.state());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * é€šé“å¼‚å¸¸ åº”è¯¥åœ¨æ­¤å…³é—­é€šé“</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ctx</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> cause</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">exceptionCaught</span><span class=\"params\">(ChannelHandlerContext ctx, Throwable cause)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.exceptionCaught(ctx, cause);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æµ‹è¯•\"><a class=\"markdownIt-Anchor\" href=\"#æµ‹è¯•\">#</a> æµ‹è¯•</h2>\n<p>ç¼–å†™ä¸€ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelFuture;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.ChannelInitializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.EventLoopGroup;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.handler.codec.DelimiterBasedFrameDecoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.handler.codec.Delimiters;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022-01-08 00:40</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RouteClient</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        Bootstrap bootstrap = <span class=\"keyword\">new</span> Bootstrap();</span><br><span class=\"line\">        EventLoopGroup group = <span class=\"keyword\">new</span> NioEventLoopGroup();</span><br><span class=\"line\">        bootstrap.group(group);</span><br><span class=\"line\">        <span class=\"comment\">// ç¬¬2æ­¥ ç»‘å®šå®¢æˆ·ç«¯é€šé“</span></span><br><span class=\"line\">        bootstrap.channel(NioSocketChannel.class);</span><br><span class=\"line\">        <span class=\"comment\">//ç¬¬3æ­¥ ç»™NIoSocketChannelåˆå§‹åŒ–handlerï¼Œ å¤„ç†è¯»å†™äº‹ä»¶</span></span><br><span class=\"line\">        <span class=\"comment\">//é€šé“æ˜¯NioSocketChannel</span></span><br><span class=\"line\">        bootstrap.handler(<span class=\"keyword\">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">initChannel</span><span class=\"params\">(NioSocketChannel ch)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//å­—ç¬¦ä¸²ç¼–ç å™¨ï¼Œä¸€å®šè¦åŠ åœ¨SimpleClientHandler çš„ä¸Šé¢</span></span><br><span class=\"line\">                ch.pipeline().addLast(<span class=\"keyword\">new</span> StringEncoder())</span><br><span class=\"line\">                    .addLast(<span class=\"keyword\">new</span> DelimiterBasedFrameDecoder(</span><br><span class=\"line\">                        Integer.MAX_VALUE, Delimiters.lineDelimiter()[<span class=\"number\">0</span>]));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//è¿æ¥æœåŠ¡å™¨</span></span><br><span class=\"line\">        ChannelFuture future = bootstrap.connect(<span class=\"string\">&quot;localhost&quot;</span>, <span class=\"number\">7788</span>).sync();</span><br><span class=\"line\">        System.out.println(future.isSuccess());</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">            future.channel().writeAndFlush(<span class=\"string\">&quot;test netty message\\r\\n&quot;</span>).sync(); â‘¤</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;å‘é€æˆåŠŸã€‚ã€‚ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ğŸ”¥â‘¤ æ³¨æ„è¿™é‡Œï¼Œéœ€è¦åŠ ä¸Š  <code>\\r\\n</code> , å¦åˆ™ä½ æ°¸è¿œæ”¶ä¸åˆ°æ¶ˆæ¯ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "æ—¥å¸¸",
                "Springboot",
                "Netty"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2022/01/02/rocketMQ/3-01-RocketMQ-Transaction-msg/",
            "url": "https://fangjiaxiaobai.github.io/2022/01/02/rocketMQ/3-01-RocketMQ-Transaction-msg/",
            "title": "RocketMQäº‹åŠ¡å®ç°åŸç†",
            "date_published": "2022-01-02T10:18:00.000Z",
            "content_html": "<p>æœ€è¿‘æœ‰ç‚¹æµ®èºï¼Œç©äº†ä¸€ä¸ªå‘¨ï¼Œæ²¡æœ‰å†™æ–‡ç« äº†ã€‚ä»Šå¤©ç»§ç»­æ <code>RocketMQ</code>  çš„äº‹åŠ¡å®ç°ã€‚</p>\n<h2 id=\"å¾€æœŸæ–‡ç« \"><a class=\"markdownIt-Anchor\" href=\"#å¾€æœŸæ–‡ç« \">#</a> å¾€æœŸæ–‡ç« </h2>\n<ul>\n<li><a href=\"/2021/09/03/rocketMQ/1-03-RocketMQ%E6%90%AD%E5%BB%BA/\">RocketMQ æ­å»º</a></li>\n<li><a href=\"/2021/09/28/rocketMQ/2-01-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E5%90%AF%E5%8A%A8/\">RocketMQ æ¶æ„è®¾è®¡ä¹‹å¯åŠ¨</a></li>\n<li><a href=\"/2021/09/28/rocketMQ/2-02-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E6%B6%88%E6%81%AF/\">RocketMQ æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯</a></li>\n</ul>\n<h2 id=\"åˆ†å¸ƒå¼äº‹åŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†å¸ƒå¼äº‹åŠ¡\">#</a> åˆ†å¸ƒå¼äº‹åŠ¡</h2>\n<p>åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ˜¯æŒ‡äº‹åŠ¡çš„å‘èµ·è€…ã€èµ„æºåŠèµ„æºç®¡ç†å™¨å’Œäº‹åŠ¡åè°ƒè€…åˆ†åˆ«ä½äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¹‹ä¸Šã€‚å½“ç„¶ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿæ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œå°¤å…¶æ˜¯é¢è¯•ä¸­ã€‚å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼šä¸¤é˜¶æ®µæäº¤ï¼Œ <code>TCC</code> ï¼Œ <code>SAGA</code>  ç­‰ç­‰ã€‚</p>\n<p>æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘ä¸»è¦çœ‹çœ‹  <code>RocketMQ</code>  çš„äº‹åŠ¡å®ç°ã€‚</p>\n<h2 id=\"ä»ä¸€ä¸ªä¾‹å­å¼€å§‹\"><a class=\"markdownIt-Anchor\" href=\"#ä»ä¸€ä¸ªä¾‹å­å¼€å§‹\">#</a> ä»ä¸€ä¸ªä¾‹å­å¼€å§‹</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// äº‹åŠ¡æ¶ˆæ¯çš„ç›‘å¬å™¨ã€‚</span></span><br><span class=\"line\">TransactionListener transactionListener = <span class=\"keyword\">new</span> TransactionListenerImpl();</span><br><span class=\"line\"><span class=\"comment\">// åˆ›å»ºä¸€ä¸ª äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…</span></span><br><span class=\"line\">TransactionMQProducer producer = <span class=\"keyword\">new</span> TransactionMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">producer.setTransactionListener(transactionListener);</span><br><span class=\"line\">producer.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    Message msg =</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest1234&quot;</span>, <span class=\"string\">&quot;tag&quot;</span>, <span class=\"string\">&quot;KEY&quot;</span> + i,</span><br><span class=\"line\">            (<span class=\"string\">&quot;Hello RocketMQ &quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET));</span><br><span class=\"line\">    <span class=\"comment\">// å‘é€æ¶ˆæ¯</span></span><br><span class=\"line\">    SendResult sendResult = producer.sendMessageInTransaction(msg, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    System.out.printf(<span class=\"string\">&quot;%s%n&quot;</span>, sendResult);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (MQClientException | UnsupportedEncodingException e) &#123;</span><br><span class=\"line\">    e.printStackTrace();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Thread.sleep(<span class=\"number\">1000L</span> * <span class=\"number\">60</span> * <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">producer.shutdown();</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸‹äº‹åŠ¡æ¶ˆæ¯çš„å¸¸ç”¨çš„ <code>API</code>  å§ã€‚</p>\n<ul>\n<li><code>producer.setTransactionListener()</code> . è®¾ç½®æ£€æµ‹äº‹åŠ¡æ¶ˆæ¯çš„å›è°ƒã€‚å½“å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ£€æµ‹åˆ°æœ‰äº‹åŠ¡æ¶ˆæ¯æ—¶å°±ä¼šè°ƒç”¨  <code>checkLocalTransaction</code>  æ–¹æ³•ã€‚</li>\n<li><code>producer.setExecutorService(ExecutorService executorService)</code> : è®¾ç½®æ£€æŸ¥äº‹åŠ¡çš„çº¿ç¨‹æ± ã€‚é»˜è®¤ä½¿ç”¨: <code>ThreadPoolExecutor</code> , æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</li>\n<li><code>producer.sendMessageInTransaction(final Message msg, final Object arg)</code> : å‘é€äº‹åŠ¡æ¶ˆæ¯ã€‚</li>\n</ul>\n<p>ä»ä¸Šé¢çš„è¿™ä¸ªæ¡ˆä¾‹æ¥çœ‹ï¼Œ å‘é€äº‹åŠ¡æ¶ˆæ¯ å’Œ æ™®é€šæ¶ˆæ¯çš„å‘é€å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„ä¸åŒï¼Œåªæ˜¯éœ€è¦åˆ›å»º  <code>TransactionMQProducer</code>  å’Œ ä½¿ç”¨  <code>sendMessageInTransaction</code>  å‘é€æ¶ˆæ¯å°±å¯ä»¥äº†ã€‚</p>\n<p>å…¶ä¸­ <code>TransactionMQProducer</code>  ç»§æ‰¿äº† <code>DefaultMQProducer</code> , è¿™ä¸ªå¹¶ä¸é™Œç”Ÿäº†ï¼Œæˆ‘ä»¬åœ¨<a href=\"/2021/09/28/rocketMQ/2-01-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E5%90%AF%E5%8A%A8/\"> RocketMQ æ¶æ„è®¾è®¡ä¹‹å¯åŠ¨</a>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå·²ç»çœ‹è¿‡å¾ˆå¤šæ¬¡äº†ã€‚è€Œåœ¨å¯åŠ¨æ—¶ï¼Œæ¡ˆä¾‹ä¸­çš„ <code>producer.start();</code>  å°±æ˜¯ç›´æ¥è°ƒç”¨çˆ¶ç±» <code>DefaultMQProducer</code>  çš„  <code>start()</code>  æ–¹æ³•ï¼Œ <code>DefaultMQProducer</code>  ä¼šé€šè¿‡  <code>defaultMQProducerImpl.start()</code>  å®Œæˆæ•´ä¸ªç”Ÿäº§è€…éƒ¨åˆ†çš„å¯åŠ¨ã€‚è¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>\n<p>æˆ‘ä»¬æ¥çœ‹æœ€ç²¾å½©çš„å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹.</p>\n<p><code>producer.sendMessageInTransaction(msg, null)</code></p>\n<p>æˆ‘ä»¬ä¸€è·¯è¿½è¸ª  <code>sendMessageInTransaction</code>  æ–¹æ³•ï¼Œå¾ˆå®¹æ˜“å°±çœ‹åˆ°äº†ï¼š <code>DefaultMQProducerImpl#sendMessageInTransaction</code></p>\n<p>è¿™ä¸ªæ–¹æ³•ä¸»è¦æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"/images/rocketmq/3-01-01.png\" alt=\"\"></p>\n<p>ç¬¬ä¸€éƒ¨åˆ†ï¼šå‘é€å¸¦æœ‰ äº‹åŠ¡æ ‡è¯† ( <code>TRAN_MSG</code> ) çš„æ¶ˆæ¯.<br>\n ç¬¬äºŒéƒ¨åˆ†ï¼šç»“æŸäº‹åŠ¡ã€‚ ä¸»è¦æœ‰æäº¤  <code>offset</code> , å’Œ åŒæ­¥ç»™  <code>Broker</code>  æ˜¯  <code>commit</code>  è¿˜æ˜¯  <code>rollback</code> .</p>\n<p><b>æ‰€ä»¥ï¼Œ <code>RocketMQ</code>  ä½¿ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆæ˜¯ï¼šäºŒé˜¶æ®µæäº¤ (XA) </b></p>\n<h3 id=\"äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è¿‡ç¨‹\">#</a> äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è¿‡ç¨‹</h3>\n<p>å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ï¼Œåœ¨ä¸Šç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä¹Ÿå·²ç»è¯´è¿‡äº†: <a href=\"/2021/09/28/rocketMQ/2-02-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E6%B6%88%E6%81%AF/\">RocketMQ ç³»åˆ— - æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯</a>ã€‚ å¯ä»¥æ€»ç»“ä¸º <code>3</code>  æ­¥ï¼Œæ ¹æ®  <code>topic</code>  è·å–è·¯ç”±å…ƒæ•°æ®ï¼Œ é€‰æ‹©é€‚åˆçš„  <code>MessageQueue</code>  è¿›è¡Œå­˜å‚¨ï¼Œ å°†  <code>Message</code>  é€šè¿‡  <code>Netty</code>  å‘é€ç»™  <code>Broker</code> .</p>\n<p>ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ—¶å€™ï¼Œåœ¨å‘é€äº‹åŠ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šç»™æ¶ˆæ¯æ·»åŠ äº‹åŠ¡æ ‡å¿—ã€‚  <code>MessageAccessor.putProperty(msg, MessageConst.PROPERTY_TRANSACTION_PREPARED, &quot;true&quot;);</code>  è¿™é‡Œæ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿæ¥ç€å¾€ä¸‹çœ‹</p>\n<p><img data-src=\"/images/rocketmq/3-01-02.png\" alt=\"\"></p>\n<p><code>TransactionalMessageService</code>  å’Œ  <code>MessageStore</code>  è¿™ä¸¤ç§å­˜å‚¨æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p>\n<p>å…¶å®å­˜å‚¨å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œè€Œæ˜¯å­˜å‚¨çš„æ¶ˆæ¯æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼š</p>\n<p><img data-src=\"/images/rocketmq/3-01-03.png\" alt=\"\"></p>\n<p><code>TransactionalMessageService</code>   ä½¿ç”¨çš„å­˜å‚¨å’Œ æ™®é€šæ¶ˆæ¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åœ¨å¯åŠ¨æ—¶å€™åˆ›å»ºçš„  <code>MessageStore</code> . ä¸åŒçš„æ˜¯ï¼Œäº‹åŠ¡æ¶ˆæ¯å­˜å‚¨çš„ ç»è¿‡   <code>parseHalfMessageInner</code>  å¤„ç†ä¹‹åçš„ æ¶ˆæ¯.</p>\n<p><img data-src=\"/images/rocketmq/3-01-04.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œå¤„ç†ä¹‹åæ¶ˆæ¯ï¼Œ <code>topic</code>  å’Œ  <code>queueId</code>  éƒ½è¢«è®¾ç½®æˆäº†é»˜è®¤çš„   <code>RMQ_SYS_TRANS_OP_HALF_TOPIC</code>  å’Œ 0ã€‚</p>\n<p><b>æ‰€ä»¥ï¼šäº‹åŠ¡æ¶ˆæ¯ä¼šè¢«å­˜å‚¨åˆ° é»˜è®¤çš„  <code>RMQ_SYS_TRANS_OP_HALF_TOPIC</code>  ä¸­ï¼Œå¹¶æ ¹æ®æ˜¯å¦ä¸ºå»¶è¿Ÿæ¶ˆæ¯å’Œå»¶è¿Ÿçš„ç­‰çº§å­˜å‚¨åˆ°ä¸åŒçš„  <code>MessageQueue</code>  ä¸­ã€‚</b></p>\n<p>å¼€æº <code>RocketMQ</code>  æ”¯æŒå»¶è¿Ÿæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸æ”¯æŒç§’çº§ç²¾åº¦ã€‚é»˜è®¤æ”¯æŒ <code>18</code>  ä¸ª <code>level</code>  çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œè¿™æ˜¯é€šè¿‡ <code>broker</code>  ç«¯çš„ <code>messageDelayLevel</code>  é…ç½®é¡¹ç¡®å®šçš„.</p>\n<p>å…·ä½“å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è¯¦ç»†çš„åˆ†æä¸€ä¸‹  <code>RocketMQ</code>  å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</span><br></pre></td></tr></table></figure>\n<p>çœ‹å®Œäº†ï¼Œäº‹åŠ¡çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œå‘é€äº‹åŠ¡æ¶ˆæ¯ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ç¬¬äºŒä¸ªé˜¶æ®µã€‚</p>\n<h3 id=\"ç»“æŸäº‹åŠ¡-commit-or-callback\"><a class=\"markdownIt-Anchor\" href=\"#ç»“æŸäº‹åŠ¡-commit-or-callback\">#</a> ç»“æŸäº‹åŠ¡: commit or callback.</h3>\n<p>ç»“æŸäº‹åŠ¡ä¸»è¦æ˜¯åšä¸¤ä»¶äº‹æƒ…:</p>\n<ul>\n<li>æäº¤æ¶ˆæ¯çš„åç§»é‡</li>\n<li>å‘é€æäº¤äº‹åŠ¡è¿˜æ˜¯å›æ»šäº‹åŠ¡ã€‚</li>\n</ul>\n<p>å®ç°é€»è¾‘å¦‚ä¸‹å›¾:</p>\n<p><img data-src=\"/images/rocketmq/3-01-05.png\" alt=\"\"></p>\n<p>ä¸»è¦çš„æµç¨‹å°±æ˜¯ï¼šå°è£… <code>RequestHeader</code> , ä¼šè®¾ç½® äº‹åŠ¡ <code>id</code> , äº‹åŠ¡çš„çŠ¶æ€ã€‚ ç„¶åè®¾ç½®æœ¬æ¬¡è¯·æ±‚çš„ <code>RequestCode</code>  ä¸º  <code>END_TRANSACTION(37)</code> .</p>\n<p>åœ¨  <code>Broker</code>  ç«¯ æ¥æ”¶åˆ°å¯¹åº”çš„è¯·æ±‚ä¹‹åï¼Œä¼šæ ¹æ® äº‹åŠ¡çš„çŠ¶æ€æ‰§è¡Œæäº¤äº‹åŠ¡æˆ–è€…å›æ»šæ“ä½œã€‚å¦‚å³ä¸Šå›¾ã€‚</p>\n<p>æˆ‘ä»¬ä»ä¸¤æ–¹é¢æ¥åˆ†æä¸€ä¸‹ï¼š</p>\n<h4 id=\"æäº¤äº‹åŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#æäº¤äº‹åŠ¡\">#</a> æäº¤äº‹åŠ¡</h4>\n<p><img data-src=\"/images/rocketmq/3-01-06.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ° æ ¹æ®  <code>offset</code>  æŸ¥åˆ°äº†æ¶ˆæ¯ï¼Œç„¶åæ ¹æ®æ¶ˆæ¯çš„çŠ¶æ€å°è£…æˆ  <code>MessageExtBrokerInner</code>  å¯¹è±¡ã€‚é€šè¿‡é€šè¿‡ <code>sendFianlMessage</code>  æ–¹æ³•å®Œæˆå°†æ¶ˆæ¯å†™å…¥åˆ° æ¶ˆæ¯åŸæ¥çš„é˜Ÿåˆ—ä¸­ (ä¸æ˜¯é»˜è®¤çš„äº‹åŠ¡é˜Ÿåˆ—äº†). æœ€ååˆ é™¤  <code>prepare</code>  æ¶ˆæ¯ã€‚å¦‚ä¸Šå›¾ã€‚</p>\n<h3 id=\"å›æ»šäº‹åŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#å›æ»šäº‹åŠ¡\">#</a> å›æ»šäº‹åŠ¡</h3>\n<p><img data-src=\"/images/rocketmq/3-01-07.png\" alt=\"\"></p>\n<p>å›æ»šäº‹åŠ¡å°±æ¯”è¾ƒç®€å•äº†ï¼Œæ£€æŸ¥æ¶ˆæ¯çš„çŠ¶æ€ï¼ŒæŸ¥çœ‹ç›´æ¥åˆ é™¤æ‰  <code>prepare</code>  æ¶ˆæ¯å°± OK äº†ã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯ æ•´ä¸ªäº‹åŠ¡æ¶ˆæ¯çš„ç”Ÿäº§è¿‡ç¨‹äº†ã€‚</p>\n<h3 id=\"äº‹åŠ¡å›æŸ¥\"><a class=\"markdownIt-Anchor\" href=\"#äº‹åŠ¡å›æŸ¥\">#</a> äº‹åŠ¡å›æŸ¥</h3>\n<p>æˆ‘ä»¬åœ¨ä»‹ç»  <code>TranscationMQProducer</code>  çš„ <code>api</code>  æ—¶å€™ï¼Œæœ‰ä¸€ä¸ª  <code>setExecutorService(ExecutorService executorService)</code>  æ–¹æ³•ã€‚ æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šè®¾ç½®æ£€æŸ¥äº‹åŠ¡çš„çº¿ç¨‹æ± ã€‚ è¿™ä¸ªçº¿ç¨‹æ± çš„ä½œç”¨å°±æ˜¯ äº‹åŠ¡å›æŸ¥ã€‚</p>\n<p><img data-src=\"/images/rocketmq/3-01-08.png\" alt=\"\"></p>\n<p>æˆ‘ä»¬è¿½è¸ªè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ–¹ï¼Œå¯ä»¥å‘ç°ï¼Œè°ƒç”¨æ˜¯  <code>NettyServer</code>  è°ƒç”¨çš„ï¼Œé‚£æ˜¯è°è¯·æ±‚çš„å‘¢ï¼Ÿæˆ‘ä»¬è·Ÿè¸ªè¿™ä¸ªè¯·æ±‚ç å‘ç°åœ¨ Broker2Client çš„ç±»ä¸­å‘ç°äº†è¿™ä¸ª è¯·æ±‚ç ã€‚ è·Ÿè¸ªè¿™ä¸ªæ–¹æ³•ï¼ŒæŸ¥çœ‹å…¶è°ƒç”¨æ–¹ï¼Œæœ€ç»ˆç»ˆäºåœ¨  <code>TransactionalMessageCheckService</code>  å‘ç°äº†æ–°å¤§é™†ã€‚<br>\nå½“æˆ‘çœ‹åˆ°  <code>public class TransactionalMessageCheckService extends ServiceThread</code>  çš„æ—¶å€™ï¼Œæˆ‘å°±ä¸ç¦æƒ³èµ·äº†ï¼Œ Broker åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šåˆå§‹åŒ–äº‹åŠ¡ï¼Œè¿™æ˜¯ä¼šåˆ›å»ºä¸€ä¸ª  <code>TransactionalMessageCheckService</code>  å¯¹è±¡.</p>\n<p>æˆ‘ä»¬ä»  <code>Broker</code>  ç«¯å¼€å§‹è¿˜åŸä¸€ä¸‹è¿™ä¸ªäº‹åŠ¡å›æŸ¥çš„åœºæ™¯ã€‚</p>\n<p>åœ¨ Broker ç«¯è¿›è¡Œå¯åŠ¨æ—¶ä¼šåˆè¯†åŒ–</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åˆå§‹åŒ–äº‹åŠ¡é€»è¾‘</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initialTransaction</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.transactionalMessageService = ServiceProvider.loadClass(ServiceProvider.TRANSACTION_SERVICE_ID, TransactionalMessageService.class);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == <span class=\"keyword\">this</span>.transactionalMessageService) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.transactionalMessageService = <span class=\"keyword\">new</span> TransactionalMessageServiceImpl(<span class=\"keyword\">new</span> TransactionalMessageBridge(<span class=\"keyword\">this</span>, <span class=\"keyword\">this</span>.getMessageStore()));</span><br><span class=\"line\">        log.warn(<span class=\"string\">&quot;Load default transaction message hook service: &#123;&#125;&quot;</span>, TransactionalMessageServiceImpl.class.getSimpleName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * Broker æ£€æŸ¥äº‹åŠ¡çŠ¶æ€çš„listner.ã€‚ Producer å†™å…¥ half æ¶ˆæ¯ï¼Œä½†æ˜¯æ²¡æœ‰æ”¶åˆ° finalMessage .å›è°ƒã€‚</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.transactionalMessageCheckListener = ServiceProvider.loadClass(ServiceProvider.TRANSACTION_LISTENER_ID, AbstractTransactionalMessageCheckListener.class);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == <span class=\"keyword\">this</span>.transactionalMessageCheckListener) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.transactionalMessageCheckListener = <span class=\"keyword\">new</span> DefaultTransactionalMessageCheckListener();</span><br><span class=\"line\">        log.warn(<span class=\"string\">&quot;Load default discard message hook service: &#123;&#125;&quot;</span>, DefaultTransactionalMessageCheckListener.class.getSimpleName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.transactionalMessageCheckListener.setBrokerController(<span class=\"keyword\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * Broker æ£€æŸ¥äº‹åŠ¡çŠ¶æ€çš„çº¿ç¨‹ã€‚ Producer å†™å…¥ half æ¶ˆæ¯ï¼Œä½†æ˜¯æ²¡æœ‰æ”¶åˆ° finalMessage.</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.transactionalMessageCheckService = <span class=\"keyword\">new</span> TransactionalMessageCheckService(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œåˆå§‹åŒ–äº†  <code>transactionalMessageCheckService</code>  å’Œ  <code>transactionalMessageCheckListener</code> . ç„¶ååœ¨  <code>start</code>  æ–¹æ³•ä¸­é€šè¿‡  <code>startProcessorByHa</code>  å¯åŠ¨äº†  <code>transactionalMessageCheckService</code>  çº¿ç¨‹</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Brokerçš„å®¹ç¾å¤„ç†</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!messageStoreConfig.isEnableDLegerCommitLog()) &#123;</span><br><span class=\"line\">    startProcessorByHa(messageStoreConfig.getBrokerRole());</span><br><span class=\"line\">    handleSlaveSynchronize(messageStoreConfig.getBrokerRole());</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.registerBrokerAll(<span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·  <code>transactionalMessageCheckService</code>  å°±å¯åŠ¨èµ·æ¥äº†ã€‚è¿è¡Œä»£ç å¦‚ä¸‹:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;Start transaction check service thread!&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">long</span> checkInterval = brokerController.getBrokerConfig().getTransactionCheckInterval();</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// é™åˆ¶åªæœ‰ä¸€ä¸ªæœ¬ç±»å¯ä»¥è¿è¡Œï¼Œæœ€ç»ˆä¼šè°ƒç”¨ onWaitEnd()</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.waitForRunning(checkInterval);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;End transaction check service thread!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onWaitEnd</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">long</span> timeout = brokerController.getBrokerConfig().getTransactionTimeOut();</span><br><span class=\"line\">    <span class=\"comment\">// å›æŸ¥çš„æœ€å¤§æ¬¡æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> checkMax = brokerController.getBrokerConfig().getTransactionCheckMax();</span><br><span class=\"line\">    <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;Begin to check prepare message, begin time:&#123;&#125;&quot;</span>, begin);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// å¼€å§‹å›æŸ¥</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.brokerController.getTransactionalMessageService().check(timeout, checkMax, <span class=\"keyword\">this</span>.brokerController.getTransactionalMessageCheckListener());</span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;End to check prepare message, consumed time:&#123;&#125;&quot;</span>, System.currentTimeMillis() - begin);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨å›æŸ¥çš„è¿‡ç¨‹ä¸­ï¼Œ  <code>RocketMQ</code>  ä¼šè·å– äº‹åŠ¡ Topic ä¸‹çš„æ‰€æœ‰ MessageQueue.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è·å– äº‹åŠ¡topicä¸­ä¸‹çš„æ‰€æœ‰MessageQueue.</span></span><br><span class=\"line\">String topic = TopicValidator.RMQ_SYS_TRANS_HALF_TOPIC;</span><br><span class=\"line\">Set&lt;MessageQueue&gt; msgQueues = transactionalMessageBridge.fetchMessageQueues(topic);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (msgQueues == <span class=\"keyword\">null</span> || msgQueues.size() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    log.warn(<span class=\"string\">&quot;The queue of topic is empty :&quot;</span> + topic);</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç„¶åéå†æ‰€æœ‰çš„  <code>MessageQueue</code> ï¼ŒæŒ‰ä¸ªå¤„ç†æ‰€æœ‰é˜Ÿåˆ—é‡Œçš„å¾…å›æŸ¥çš„æ¶ˆæ¯ã€‚æ€ä¹ˆåˆ¤æ–­æ¶ˆæ¯éœ€è¦å›æŸ¥å‘¢ï¼Ÿå‰é¢è¯´è¿‡äº†ï¼Œé€šè¿‡ <code>Opé˜Ÿåˆ—</code> åˆ¤æ–­ï¼Œå› æ­¤è¿˜éœ€è¦å®šä½åˆ° <code>HalfQueue</code>  å¯¹åº”çš„ <code>OpQueue</code> ï¼Œä»¥åŠå®ƒä»¬çš„ <code>ConsumeQueue</code>  åç§»é‡ï¼Œ è·å–åˆ°  <code>halfMessage</code> , ç„¶ååˆ¤æ–­æ˜¯å¦éœ€è¦æ£€æµ‹äº‹åŠ¡çŠ¶æ€ï¼Œå¦‚æœéœ€è¦æ£€æµ‹åˆ™ä¼šè°ƒç”¨  <code>AbstractTransactionalMessageCheckListener</code>  çš„  <code>resolveHalfMsg</code>  æ–¹æ³•ï¼Œå³ä¼šå‘é€ æ£€æµ‹çš„è¯·æ±‚ ç»™  <code>Producer</code> .</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brokerController.getBroker2Client().checkProducerTransactionState(groupId, channel, checkTransactionStateRequestHeader, msgExt);</span><br></pre></td></tr></table></figure>\n<p><code>checkProducerTransactionState</code>  æ–¹æ³•çš„å®ç°åˆ™æ˜¯ï¼š å‘ Producer ç«¯å‘é€ è¯·æ±‚ç ä¸º 39 ( <code>RequestCode.CHECK_TRANSACTION_STATE</code> ) çš„è¯·æ±‚.</p>\n<p>å¦‚ä¸‹ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RemotingCommand request =</span><br><span class=\"line\">    RemotingCommand.createRequestCommand(RequestCode.CHECK_TRANSACTION_STATE, requestHeader);</span><br><span class=\"line\">request.setBody(MessageDecoder.encode(messageExt, <span class=\"keyword\">false</span>));</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.brokerController.getRemotingServer().invokeOneway(channel, request, <span class=\"number\">10</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">    log.error(<span class=\"string\">&quot;Check transaction failed because invoke producer exception. group=&#123;&#125;, msgId=&#123;&#125;, error=&#123;&#125;&quot;</span>,</span><br><span class=\"line\">            group, messageExt.getMsgId(), e.toString());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·å°±è§¦å‘äº†  <code>Producer</code>  çš„ äº‹åŠ¡å›æŸ¥ã€‚æˆ‘ä»¬æ¥ç€çœ‹ã€</p>\n<p>åœ¨  <code>ClientRemotingProcessor</code>  ä¸­å¯ä»¥çœ‹åˆ°  <code>CHECK_TRANSACTION_STATE</code>  çš„å¤„ç†æ–¹æ³•ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ£€æŸ¥äº‹åŠ¡çŠ¶æ€</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> RequestCode.CHECK_TRANSACTION_STATE:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.checkTransactionState(ctx, request);</span><br></pre></td></tr></table></figure>\n<p>ç„¶åè·å–åˆ°  <code>Producer</code>  å®ä¾‹ï¼Œé€šè¿‡  <code>producer</code>  å¼€å§‹å›æŸ¥äº‹åŠ¡.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æŸ¥è¯¢åˆ°å¯¹åº”çš„ Producerå®ä¾‹</span></span><br><span class=\"line\">MQProducerInner producer = <span class=\"keyword\">this</span>.mqClientFactory.selectProducer(group);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (producer != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> String addr = RemotingHelper.parseChannelRemoteAddr(ctx.channel());</span><br><span class=\"line\">    <span class=\"comment\">// å¼€å§‹å›æŸ¥ã€‚</span></span><br><span class=\"line\">    producer.checkTransactionState(addr, messageExt, requestHeader);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    log.debug(<span class=\"string\">&quot;checkTransactionState, pick producer by group[&#123;&#125;] failed&quot;</span>, group);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç»§ç»­è·Ÿè¸ªè¿™ä¸ª  <code>checkTransactionState</code>  ä¾¿çœ‹åˆ°äº†æˆ‘ä»¬ä¸€å¼€å§‹è¯´çš„è¿™ä¸ªäº‹åŠ¡å›æŸ¥äº†ã€‚</p>\n<p><img data-src=\"/images/rocketmq/3-01-08.png\" alt=\"\"></p>\n<p>å…¶ä¸­  <code>checkExecutor</code>  å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± äº†ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ å›æŸ¥çš„ä»»åŠ¡ï¼Œå³ å›¾ä¸­çš„  <code>Runnable</code>  çš„å®ç°ã€‚</p>\n<p>é¦–å…ˆä¼š è·å–æ¶ˆæ¯çš„äº‹åŠ¡çŠ¶æ€ï¼Œç„¶åå°†æ¶ˆæ¯çš„äº‹åŠ¡çŠ¶æ€å‘é€ç»™ Brokerã€‚ è¿™æ ·å°±å®Œæˆäº† äº‹åŠ¡å›æŸ¥ã€‚</p>\n<p>å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Runnable request = <span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String brokerAddr = addr;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> MessageExt message = msg;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> CheckTransactionStateRequestHeader checkRequestHeader = header;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String group = DefaultMQProducerImpl.<span class=\"keyword\">this</span>.defaultMQProducer.getProducerGroup();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        TransactionCheckListener transactionCheckListener = DefaultMQProducerImpl.<span class=\"keyword\">this</span>.checkListener();</span><br><span class=\"line\">        TransactionListener transactionListener = getCheckListener();</span><br><span class=\"line\">        <span class=\"comment\">// 1ã€æŸ¥çœ‹ æ¶ˆæ¯äº‹åŠ¡çš„çŠ¶æ€</span></span><br><span class=\"line\">        LocalTransactionState localTransactionState = LocalTransactionState.UNKNOW;</span><br><span class=\"line\">        Throwable exception = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (transactionCheckListener != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            localTransactionState = transactionCheckListener.checkLocalTransactionState(message);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (transactionListener != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            log.debug(<span class=\"string\">&quot;Used new check API in transaction message&quot;</span>);</span><br><span class=\"line\">            localTransactionState = transactionListener.checkLocalTransaction(message);</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2ã€å¤„ç†æ¶ˆæ¯äº‹åŠ¡, æŠŠäº‹åŠ¡çš„çŠ¶æ€å‘é€ç»™ Brokerã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.processTransactionState(localTransactionState, group, exception);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * å¤„ç†æ¶ˆæ¯äº‹åŠ¡ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">    *</span></span><br><span class=\"line\"><span class=\"comment\">    * å°†æ¶ˆæ¯äº‹åŠ¡çš„çŠ¶æ€å‘é€ç»™ Broker</span></span><br><span class=\"line\"><span class=\"comment\">    *</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> localTransactionState</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> producerGroup</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> exception</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">processTransactionState</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        <span class=\"keyword\">final</span> LocalTransactionState localTransactionState,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        <span class=\"keyword\">final</span> String producerGroup,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        <span class=\"keyword\">final</span> Throwable exception)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å°è£…RequestHeader</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> EndTransactionRequestHeader thisHeader = <span class=\"keyword\">new</span> EndTransactionRequestHeader();</span><br><span class=\"line\">        thisHeader.setCommitLogOffset(checkRequestHeader.getCommitLogOffset());</span><br><span class=\"line\">        thisHeader.setProducerGroup(producerGroup);</span><br><span class=\"line\">        thisHeader.setTranStateTableOffset(checkRequestHeader.getTranStateTableOffset());</span><br><span class=\"line\">        thisHeader.swetFromTransactionCheck(<span class=\"keyword\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        String uniqueKey = message.getProperties().get(MessageConst.PROPERTY_UNIQ_CLIENT_MESSAGE_ID_KEYIDX);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (uniqueKey == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            uniqueKey = message.getMsgId();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        thisHeader.setMsgId(uniqueKey);</span><br><span class=\"line\">        thisHeader.setTransactionId(checkRequestHeader.getTransactionId());</span><br><span class=\"line\">        <span class=\"comment\">// è®¾ç½® äº‹åŠ¡çš„çŠ¶æ€.</span></span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (localTransactionState) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> COMMIT_MESSAGE:</span><br><span class=\"line\">                thisHeader.setCommitOrRollback(MessageSysFlag.TRANSACTION_COMMIT_TYPE);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> ROLLBACK_MESSAGE:</span><br><span class=\"line\">                thisHeader.setCommitOrRollback(MessageSysFlag.TRANSACTION_ROLLBACK_TYPE);</span><br><span class=\"line\">                log.warn(<span class=\"string\">&quot;when broker check, client rollback this transaction, &#123;&#125;&quot;</span>, thisHeader);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> UNKNOW:</span><br><span class=\"line\">                thisHeader.setCommitOrRollback(MessageSysFlag.TRANSACTION_NOT_TYPE);</span><br><span class=\"line\">                log.warn(<span class=\"string\">&quot;when broker check, client does not know this transaction state, &#123;&#125;&quot;</span>, thisHeader);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        doExecuteEndTransactionHook(msg, uniqueKey, brokerAddr, localTransactionState, <span class=\"keyword\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å‘Brokerç«¯å‘é€è¯·æ±‚ã€‚</span></span><br><span class=\"line\">        DefaultMQProducerImpl.<span class=\"keyword\">this</span>.mQClientFactory.getMQClientAPIImpl().endTransactionOneway(brokerAddr, thisHeader, remark, <span class=\"number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªäº‹åŠ¡å›æŸ¥çš„è¿‡ç¨‹äº†ã€‚è¿™é‡Œæˆ‘å†æ¥æ¢³ç†ä¸€ä¸‹æ‰§è¡Œçš„æ—¶åºå›¾ã€‚</p>\n<p><img data-src=\"/images/rocketmq/3-01-09.png\" alt=\"\"></p>\n<p>æœ€åæˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ äº‹åŠ¡å›æŸ¥å‘¢ï¼Ÿ<br>\n <code>Half</code>  æ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œå¯èƒ½å› ä¸ºç½‘ç»œï¼ŒæœåŠ¡é‡å¯ç­‰ç­‰åŸå› æ²¡æœ‰æ”¶åˆ° <code>Producer</code>  çš„äº‹åŠ¡çŠ¶æ€è¯·æ±‚ï¼Œè¿™æ˜¯ï¼Œ <code>Broker</code>  å°±ä¼šä¸»åŠ¨æ”¾å¼ƒäº‹åŠ¡å›æŸ¥ç»™ <code>Producer</code> . æ¥å†³å®šè¯¥äº‹åŠ¡æ¶ˆæ¯æ˜¯æäº¤è¿˜æ˜¯å›æ»šã€‚ä¸ºäº†é¿å…æ¶ˆæ¯è¢«æ— é™æ¬¡çš„å›æŸ¥ï¼ŒRocketMQ é€šè¿‡ transactionCheckMax å±æ€§è®¾ç½®æ¶ˆæ¯å›æŸ¥çš„æœ€å¤§æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 15 æ¬¡ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h3>\n<ul>\n<li><code>RocketMQ</code>  çš„äº‹åŠ¡æ¶ˆæ¯æ˜¯ä½¿ç”¨ äºŒé˜¶æ®µæäº¤ ( <code>XA</code> ) çš„è¿™ç§åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</li>\n<li><code>RocketMQ</code>  ç¬¬ä¸€é˜¶æ®µä¼šå‘é€å¸¦æœ‰ äº‹åŠ¡æ ‡å¿—çš„æ¶ˆæ¯ç»™ <code>Broker</code> .  <code>Broker</code>  ä¼šæŠŠæ¶ˆæ¯å­˜å‚¨åˆ°å›ºå®šçš„ Topic ä¸­ï¼Œå¹¶æ ¹æ®å»¶è¿Ÿçº§åˆ«å­˜å‚¨åˆ°ä¸åŒçš„ <code>queue</code>  ä¸­ã€‚</li>\n<li><code>RocketMQ</code>  ç¬¬äºŒé˜¶æ®µæ˜¯ç»“æŸäº‹åŠ¡ï¼Œä¼šæäº¤ <code>offset</code> , æ ¹æ®æ¶ˆæ¯çš„äº‹åŠ¡çŠ¶æ€æäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚</li>\n</ul>\n<p><code>RocketMQ</code>  é€šè¿‡æ”¹å†™  <code>Topic</code>  å’Œ  <code>queueId</code>  ï¼Œå°†æ¶ˆæ¯æš‚æ—¶å­˜å‚¨åˆ°çš„ä¸€ä¸ªå¯¹ <code>Consumer</code>  ä¸å¯è§çš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åç­‰å¾… <code>Producer</code>  æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡è£…å¡«åå†å†³å®šå°† <code>Half</code>  æ¶ˆæ¯ <code>commit</code>  æˆ–è€…  <code>rollback</code> .</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/17/machine-learn/Model-evaluation/01-overview/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/17/machine-learn/Model-evaluation/01-overview/",
            "title": "æ¨¡å‹è¯„ä¼°æ¦‚è¿°",
            "date_published": "2021-11-17T10:18:00.000Z",
            "content_html": "<h2 id=\"åˆ†ç±»\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†ç±»\">#</a> åˆ†ç±»</h2>\n<p>æ¨¡å‹è¯„ä¼°å¯ä»¥åˆ†ä¸º ç¦»çº¿è¯„ä¼°å’Œåœ¨çº¿è¯„ä¼° ä¸¤å¤§ç±»ã€‚åœ¨äº§å“çš„ä¸åŒé˜¶æ®µï¼Œæˆ‘ä»¬è¦æ ¹æ®ä¸åŒçš„åœºæ™¯å»åº”ç”¨ä»–ä»¬ã€‚</p>\n<p>ä¸¤ç§è¯„ä¼°æ–¹å¼ç”±äºå…¶åœºæ™¯ä¸åŒï¼Œæ‰€è¯„ä¼°çš„å…³æ³¨ç‚¹ä¹Ÿä¸å°½ç›¸åŒã€‚å…¶ä¸­ï¼Œç¦»çº¿è¯„ä¼°å…³æ³¨çš„æ˜¯æ¨¡å‹æ•ˆæœç›¸å…³çš„æŒ‡æ ‡ï¼Œå¦‚ç²¾å‡†ç‡ã€ <code>KS</code>  ç­‰ç­‰ã€‚åœ¨çº¿è¯„ä¼°å…³æ³¨çš„æ˜¯ä¸šåŠ¡ç›¸å…³æŒ‡æ ‡ï¼Œæ¯”å¦‚æ–°ç”¨æˆ·çš„è½¬åŒ–ç‡ã€ä¼˜æƒ åˆ¸çš„æ ¸é”€ç‡ã€ä¿¡è´·å®¡æ ¸çš„é€šè¿‡ç‡ç­‰ç­‰ã€‚ç”±äºæ¨¡å‹çš„åœ¨çº¿è¯„ä¼°ä¸ä¸šåŠ¡åœºæ™¯å¼ºç›¸å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è¯¾ç¨‹é‡ç‚¹å°†æ”¾åœ¨æ¨¡å‹çš„ç¦»çº¿è¯„ä¼°ä¸Šã€‚</p>\n<h3 id=\"åœ¨çº¿è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#åœ¨çº¿è¯„ä¼°\">#</a> åœ¨çº¿è¯„ä¼°</h3>\n<p>åœ¨çº¿è¯„ä¼°æ˜¯æŒ‡åœ¨æ¨¡å‹éƒ¨ç½²ä¸Šçº¿åï¼Œä½¿ç”¨çº¿ä¸ŠçœŸå®æ•°æ®å¯¹æ¨¡å‹è¿›è¡Œçš„è¯„ä¼°ã€‚è¿™ä¸ªæ—¶å€™ï¼Œäº§å“ç»ç†æˆ–è€…è¿è¥åŒå­¦å¤§å¤šé‡‡ç”¨  <code>ABTest</code>  çš„æ–¹å¼å»åˆ¤æ–­ä¸šåŠ¡çš„è¡¨ç°.</p>\n<h3 id=\"ç¦»çº¿è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#ç¦»çº¿è¯„ä¼°\">#</a> ç¦»çº¿è¯„ä¼°</h3>\n<p>ç¦»çº¿è¯„ä¼°æ˜¯æŒ‡åœ¨æ¨¡å‹éƒ¨ç½²ä¸Šçº¿å‰å¯¹æ¨¡å‹è¿›è¡Œçš„éªŒè¯å’Œè¯„ä¼°å·¥ä½œï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœå‘ç°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹æ¨¡å‹çš„å‚æ•°è¿›è¡Œè°ƒæ•´å’Œæ”¹è¿›ã€‚</p>\n<p>ç¦»çº¿è¯„ä¼°åˆå¯ä»¥åˆ†ä¸º <code>ç‰¹å¾è¯„ä¼°</code> å’Œ <code>æ¨¡å‹è¯„ä¼°</code> ä¸¤å¤§ç±»ã€‚</p>\n<h4 id=\"ç‰¹å¾è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾è¯„ä¼°\">#</a> ç‰¹å¾è¯„ä¼°</h4>\n<p>ä¸ºä»€ä¹ˆè¦å…³æ³¨ç‰¹å¾è¯„ä¼°å‘¢ï¼Ÿå¦‚æœåªè¯„ä¼°æœ€ç»ˆæ¨¡å‹çš„æŒ‡æ ‡æ˜¯å¦åˆè§„çš„æ—¶å€™ï¼Œå°±ç›¸å½“äºæŠŠæ¨¡å‹ä½œä¸ºä¸€ä¸ª é»‘ç›’å­äº†ã€‚ä½†åŒæ—¶ä¹Ÿè¦äº†è§£æ¨¡å‹é‡Œé¢çš„å†…å®¹ï¼Œæ‰€ä»¥æ¨¡å‹ç‰¹å¾çš„è¯„ä¼°ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚ é‚£ç‰¹å¾è¯„ä¼°ä¸»è¦å…³æ³¨é‚£äº›å†…å®¹å‘¢ï¼Ÿ</p>\n<h5 id=\"ç‰¹å¾è‡ªèº«çš„ç¨³å®šæ€§\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾è‡ªèº«çš„ç¨³å®šæ€§\">#</a> ç‰¹å¾è‡ªèº«çš„ç¨³å®šæ€§</h5>\n<p>å¯¹äºç‰¹å¾è‡ªèº«çš„ç¨³å®šï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ <code>PSI</code>  è¿™ä¸ªæŒ‡æ ‡æ¥åˆ¤æ–­ã€‚  <code>PSI</code>  æ˜¯è¯„ä¼°æŸä¸ªç‰¹å¾çš„æ•°æ®éšç€æ—¶é—´æ¨ç§»å‘ç”Ÿå˜åŒ–è€Œä¸å†ç¨³å®šçš„æŒ‡æ ‡ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯çœ‹è¿™ä¸ªç‰¹å¾æ˜¯ä¸æ˜¯ç¨³å®šçš„ï¼Œå¦‚æœä¸€ä¸ªé‡è¦ç‰¹å¾ä¸å¤Ÿç¨³å®šï¼Œå°±ä¼šç›´æ¥å½±å“åˆ°æ¨¡å‹æ•´ä½“çš„ç¨³å®šæ€§ï¼Œè‡ªç„¶ä¹Ÿä¼šå½±å“ä¸šåŠ¡ã€‚</p>\n<blockquote>\n<p><code>PSI</code> : ( <code>Population Stability Index</code> .  <code>PSI</code> ), è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œåé¢æˆ‘ä¼šåœ¨ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œè¯¦ç»†çš„ä»‹ç» ç¾¤ä½“ç¨³å®šæ€§ ( <code>PSI</code> ) è¿™ä¸ªæ¦‚å¿µã€‚ <code>PSI</code>  å¯ç”¨æ¥è¡¡é‡æµ‹è¯•æ ·æœ¬åŠæ¨¡å‹å¼€å‘æ ·æœ¬è¯„åˆ†çš„åˆ†å¸ƒå·®å¼‚ï¼Œä¸ºæœ€å¸¸è§çš„æ¨¡å‹ç¨³å®šåº¦è¯„ä¼°æŒ‡æ ‡ã€‚è®¡ç®—å…¬å¼ä¸º:  <code>PSI = sum(ï¼ˆå®é™…å æ¯”-é¢„æœŸå æ¯”ï¼‰* ln(å®é™…å æ¯”/é¢„æœŸå æ¯”))</code> <br>\n ä¸€èˆ¬ä»¥è®­ç»ƒé›†ï¼ˆ <code>INS</code> ï¼‰çš„æ ·æœ¬åˆ†å¸ƒä½œä¸ºé¢„æœŸåˆ†å¸ƒï¼Œè¿›è€Œè·¨æ—¶é—´çª—æŒ‰æœˆ / å‘¨æ¥è®¡ç®— <code>PSI</code> ï¼Œå¾—åˆ° <code>Monthly/weekly PSI Report</code> ï¼Œè¿›è€Œå‰”é™¤ä¸ç¨³å®šçš„å˜é‡ã€‚åŒç†ï¼Œåœ¨æ¨¡å‹ä¸Šçº¿éƒ¨ç½²åï¼Œä¹Ÿå°†é€šè¿‡ <code>PSI</code>  æ›²çº¿æŠ¥è¡¨æ¥è§‚å¯Ÿæ¨¡å‹çš„ç¨³å®šæ€§ã€‚</p>\n</blockquote>\n<h5 id=\"ç‰¹å¾æ¥æºçš„ç¨³å®šæ€§\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾æ¥æºçš„ç¨³å®šæ€§\">#</a> ç‰¹å¾æ¥æºçš„ç¨³å®šæ€§</h5>\n<p>å…³äº ç‰¹å¾æ¥æºçš„ç¨³å®šæ€§ è¯„ä¼°ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µ:</p>\n<ul>\n<li>å¦‚æœç‰¹å¾æ•°æ®æ¥æºäºé›†å›¢å†…éƒ¨ï¼Œä¸»è¦è€ƒè™‘å…·ä½“æ¥è‡ªå“ªæ¡ä¸šåŠ¡çº¿ï¼Œè¿™æ¡ä¸šåŠ¡æ˜¯å¦ç¨³å®šï¼Œä»¥åŠä¸šåŠ¡æ–¹æ˜¯å¦å¯èƒ½æ”¶å›æˆ–è€…åœæ­¢å…±äº«æ•°æ®ã€‚</li>\n<li>å¦‚æœç‰¹å¾æ¥å…¥æ–¹æ˜¯å¤–éƒ¨å…¬å¸ï¼Œç‰¹åˆ«æ³¨æ„è¦çœ‹è¿™ä¸ªå…¬å¸æ˜¯å¦åˆè§„ï¼Œæ˜¯å¦å…·å¤‡å®Œå–„çš„æŠ€æœ¯å‚¨å¤‡ç­‰ç­‰ã€‚</li>\n</ul>\n<h5 id=\"æˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#æˆæœ¬\">#</a> æˆæœ¬</h5>\n<p>åœ¨è·å–æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿè¦è€ƒè™‘æ¥å…¥çš„æˆæœ¬é—®é¢˜ã€‚</p>\n<ul>\n<li>å…¬å¸å†…éƒ¨æ•°æ®ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸å­˜åœ¨æˆæœ¬ã€‚åœ¨ä¸åŒä¸šåŠ¡çº¿çš„è§’åº¦æ¥è¯´ï¼Œå¯èƒ½ä¼šå­˜åœ¨è´¹ç”¨åˆ†æ‘Šçš„é—®é¢˜ã€‚</li>\n<li>å¤–éƒ¨æ•°æ®ï¼Œè‚¯å®šæ˜¯æœ‰æˆæœ¬çš„ï¼Œæˆ–è®¸æ˜¯å…¬å¸åˆä½œï¼Œæˆ–è®¸æ˜¯å…¬å¸ç›´æ¥è´­ä¹°ï¼Œ æ­£å¸¸æ”¯ä»˜å…¬å¸è´¹ç”¨å°±å¥½äº†ã€‚ç‰¹åˆ«æ˜¯æ³¨æ„ï¼Œå¦‚æœæ•°æ®æ˜¯æŒ‰è°ƒç”¨æ¬¡æ•°ï¼Œæµé‡è®¡è´¹çš„è¯ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡é¢„å…ˆæ‹‰å–æ•°æ®æ¥å‡å°‘è°ƒç”¨ã€‚</li>\n</ul>\n<h4 id=\"æ¨¡å‹è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#æ¨¡å‹è¯„ä¼°\">#</a> æ¨¡å‹è¯„ä¼°</h4>\n<p>æ¨¡å‹çš„è¯„ä¼°ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼šç»Ÿè®¡æ€§ã€æ¨¡å‹æ€§èƒ½å’Œæ¨¡å‹ç¨³å®šæ€§ã€‚</p>\n<h5 id=\"ç»Ÿè®¡æ€§æŒ‡æ ‡\"><a class=\"markdownIt-Anchor\" href=\"#ç»Ÿè®¡æ€§æŒ‡æ ‡\">#</a> ç»Ÿè®¡æ€§æŒ‡æ ‡</h5>\n<p>ç»Ÿè®¡æ€§æŒ‡æ ‡æŒ‡çš„å°±æ˜¯æ¨¡å‹è¾“å‡ºç»“æœçš„è¦†ç›–åº¦ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€äººç¾¤åˆ†å¸ƒç­‰æŒ‡æ ‡ã€‚æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªæ¨¡å‹ï¼Œæœ€å…ˆçœ‹çš„ä¸æ˜¯æ€§èƒ½æŒ‡æ ‡ä¹Ÿä¸æ˜¯ç¨³å®šæ€§ï¼Œè€Œæ˜¯ç»Ÿè®¡æ€§æŒ‡æ ‡ï¼Œå®ƒå†³å®šäº†æ¨¡å‹åˆ°åº•èƒ½ä¸èƒ½ç”¨ã€‚</p>\n<p>åœ¨ä¸åŒçš„åœºæ™¯ä¸‹ï¼Œç”±äºæˆ‘ä»¬çš„ä¸šåŠ¡ä¸åŒï¼Œå¯¹æ¨¡å‹çš„è¦æ±‚ä¸åŒï¼Œå¯¹æ¨¡å‹ç»Ÿè®¡æ€§æŒ‡æ ‡çš„å…³æ³¨ç‚¹ä¹Ÿä¼šä¸åŒã€‚ å¯¹ç»Ÿè®¡æ€§æŒ‡æ ‡è¿›è¡Œè¯„ä¼°çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å……åˆ†è€ƒè™‘ä¸šåŠ¡åœºæ™¯ã€‚</p>\n<p>æ¯”å¦‚:</p>\n<ul>\n<li>è¦†ç›–åº¦ã€‚ åœ¨é‡‘èé£æ§çš„åœºæ™¯ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å‹çš„è¦†ç›–ç‡ä½äº  <code>60%</code> , åŸºæœ¬ä¸Šå°±å¾ˆéš¾ç»™åˆ°å®¢æˆ·ä½¿ç”¨äº†ï¼Œå› ä¸ºè¦†ç›–ä½ä½ï¼Œé£æ§çš„ä¸šåŠ¡äººå‘˜åŸºæœ¬æ²¡åŠæ³•å¯¹è¿™ä¸ªæ¨¡å‹åº”ç”¨åˆ°å†³ç­–å¼•æ“ä¸­ã€‚å¦‚æœéè¦è°ƒç”¨çš„è¯ï¼Œæœ€å¥½çš„æƒ…å†µä¹Ÿå°±æ˜¯ç”¨åˆ°å†³ç­–æ ‘çš„æŸä¸ªåˆ†æ”¯ä¸Šï¼Œä¸“é—¨ç”¨äºæŸä¸€å°éƒ¨åˆ†äººç¾¤ä¸­ï¼Œä¸è¿‡æ„ä¹‰ä¸å¤§ã€‚</li>\n<li>æœ€å¤§æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯åˆ†æ•°èŒƒå›´ï¼Œä»¥ä¿¡ç”¨è¯„åˆ†æ¨¡å‹ä¸ºä¾‹ï¼Œå¦‚æœä¿¡ç”¨è¯„åˆ†æ¨¡å‹è¦†ç›–çš„äººæ•°å¾ˆå¤šï¼Œä½†æ˜¯æ¨¡å‹è¾“å‡ºçš„ä¿¡ç”¨åˆ†æ•°èŒƒå›´å´å¾ˆçª„ï¼Œå‡è®¾æ˜¯ <code>90-95</code> ï¼Œå¾ˆæ˜¾ç„¶ï¼Œäººç¾¤å¹¶æ²¡æœ‰å¥½çš„åŒºåˆ†åº¦ã€‚ å¯ä»¥å‚è€ƒä¸‹èŠéº»åˆ†çš„èŒƒå›´å°±è®¾ç½®åˆ°äº† <code>350-950</code> ã€‚</li>\n<li>äººç¾¤åˆ†å¸ƒï¼šæŒ‡çš„æ˜¯æ¨¡å‹å¯¹äººæ‰“åˆ†åï¼Œåˆ†æ•°å’Œäººç¾¤çš„åˆ†å¸ƒå½¢æ€ï¼Œè¿™ä¸ªåˆ†å¸ƒå½¢æ€åº”è¯¥ç¬¦åˆæˆ‘ä»¬çš„å¸¸è¯†ï¼Œæ¯”å¦‚ç”¨æˆ·æ¶ˆè´¹èƒ½åŠ›è¯„ä¼°æ¨¡å‹ï¼Œå¯¹äºäººç¾¤çš„æ‰“åˆ†ç»“æœå°±åº”è¯¥ç¬¦åˆæ­£æ€åˆ†å¸ƒã€‚</li>\n</ul>\n<h5 id=\"æ¨¡å‹æ€§èƒ½\"><a class=\"markdownIt-Anchor\" href=\"#æ¨¡å‹æ€§èƒ½\">#</a> æ¨¡å‹æ€§èƒ½</h5>\n<p>æ¨¡å‹çš„æ€§èƒ½è¯„ä¼°æŒ‡æ ‡æ˜¯è¯„ä¼°æ¨¡å‹æ•ˆæœçš„æŒ‡æ ‡ï¼Œä»–å’Œæ¨¡å‹è¦è§£å†³çš„é—®é¢˜ç›¸å…³ï¼Œ æ¨¡å‹è¦è§£å†³çš„é—®é¢˜ï¼Œå¯ä»¥åˆ†æˆåˆ†ç±»é—®é¢˜å’Œå›å½’é—®é¢˜ã€‚</p>\n<h6 id=\"åˆ†ç±»æ¨¡å‹\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†ç±»æ¨¡å‹\">#</a> åˆ†ç±»æ¨¡å‹</h6>\n<p>åˆ†ç±»æ¨¡å‹çš„æ€§èƒ½è¯„ä»·æŒ‡æ ‡ä¸»è¦åŒ…æ‹¬ï¼š  <code>æ··æ·†çŸ©é˜µ</code> ï¼Œ <code>KS</code> ï¼Œ  <code>AUC</code>  ç­‰ç­‰ã€‚åˆ†ç±»æ¨¡å‹çš„æ€§èƒ½è¯„ä»·æŒ‡æ ‡ä¸»è¦åŒ…æ‹¬ï¼š <code>æ··æ·†çŸ©é˜µ</code> ã€ <code>KS</code> ã€ <code>AUC</code>  ç­‰ç­‰ã€‚é€šè¿‡æ··æ·†çŸ©é˜µï¼Œæˆ‘ä»¬æ—¢å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¨¡å‹çš„ç²¾ç¡®ç‡ã€å¬å›ç‡è¿™äº›æŒ‡æ ‡ï¼Œä»è€Œå¯ä»¥è¯„ä¼°ä¸€ä¸ªæ¨¡å‹çš„åŒºåˆ†èƒ½åŠ›ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¡ç®—å¾—åˆ°çš„  <code>TPR</code> ã€ <code>FPR</code> ï¼Œä»è€Œè®¡ç®—å‡º  <code>AUC</code> ã€ <code>KS</code>  ç­‰ç›¸å…³æŒ‡æ ‡ã€‚å› æ­¤ï¼Œæ··æ·†çŸ©é˜µæ˜¯è¯„ä¼°äºŒåˆ†ç±»æ¨¡å‹çš„åŸºç¡€å·¥å…·ã€‚</p>\n<h6 id=\"å›å½’æ¨¡å‹\"><a class=\"markdownIt-Anchor\" href=\"#å›å½’æ¨¡å‹\">#</a> å›å½’æ¨¡å‹</h6>\n<p>å›å½’æ¨¡å‹çš„æ€§èƒ½è¯„ä»·æŒ‡æ ‡ä¸»è¦åŒ…æ‹¬  <code>MAE</code>  (å¹³å‡ç»å¯¹è¯¯å·®),  <code>MSE</code>  (å‡æ–¹è¯¯å·®),  <code>RMSE</code>  (å‡æ–¹æ ¹è¯¯å·®), <code>Ræ–¹</code> ã€‚</p>\n<h5 id=\"æ¨¡å‹ç¨³å®šæ€§\"><a class=\"markdownIt-Anchor\" href=\"#æ¨¡å‹ç¨³å®šæ€§\">#</a> æ¨¡å‹ç¨³å®šæ€§</h5>\n<p>æ¨¡å‹çš„ç¨³å®šæ€§å³åˆ¤æ–­æ¨¡å‹è¾“å‡ºç»“æœï¼Œæ˜¯å¦ä¼šéšç€æ—¶é—´æ¨ç§»ï¼Œè€Œå‘ç”Ÿè¾ƒå¤§å˜åŒ–ä¸å†ç¨³å®šçš„æŒ‡æ ‡ï¼Œæ¨¡å‹çš„ç¨³å®šæ€§ä¼šç›´æ¥å½±å“æ¨¡å‹çš„ç»“æœã€‚æ¯”å¦‚åœ¨é£æ§åœºæ™¯ä¸‹ï¼Œå¦‚æœé£æ§æ¨¡å‹ä¸å¤Ÿç¨³å®šï¼Œå¯¹äºç”¨æˆ·é£é™©åˆ¤æ–­çš„ç»“æœå°±ä¼šå‘ç”Ÿè¾ƒå¤§å˜åŒ–ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å®æ—¶è°ƒæ•´é£æ§ç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿè¦æ³¨æ„è°ƒæ•´åé€ æˆå†³ç­–ä¸åˆç†çš„æƒ…å†µã€‚å¯¹äºæ¨¡å‹çš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨  <code>PSI</code>  è¿›è¡Œè¯„ä¼°ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"qrcode\"></p>\n",
            "tags": [
                "MachineLearn",
                "æ¨¡å‹è¯„ä¼°"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/17/machine-learn/Model-evaluation/02-confusion_matrix/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/17/machine-learn/Model-evaluation/02-confusion_matrix/",
            "title": "æ¨¡å‹è¯„ä¼°ä¹‹ åˆ†ç±»æ¨¡å‹çš„è¯„ä¼°æŒ‡æ ‡",
            "date_published": "2021-11-17T10:18:00.000Z",
            "content_html": "<p>æ··æ·†çŸ©é˜µ ( <code>Confusion Matrix</code> ) æ˜¯åˆ†ç±»æ¨¡å‹çš„ä¸€ç§è¯„ä¼°æŒ‡æ ‡ã€‚å®ƒæ˜¯ä½¿ç”¨ä¸€ç§ç‰¹å®šçš„çŸ©é˜µæ¥å‘ˆç°ç®—æ³•æ€§èƒ½çš„å¯è§†åŒ–æ•ˆæœï¼Œé€šå¸¸æ˜¯ç›‘ç£å­¦ä¹ ã€‚(éç›‘ç£å­¦ä¹ ï¼Œé€šå¸¸ç”¨åŒ¹é…çŸ©é˜µï¼šm <code>atching matrix</code> ) å…¶æ¯ä¸€åˆ—ä»£è¡¨é¢„æµ‹å€¼ï¼Œæ¯ä¸€è¡Œä»£è¡¨çš„æ˜¯å®é™…çš„ç±»åˆ«ã€‚è¿™ä¸ªåå­—æ¥æºäºå®ƒå¯ä»¥éå¸¸å®¹æ˜“çš„è¡¨æ˜å¤šä¸ªç±»åˆ«æ˜¯å¦æœ‰æ··æ·†ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ª <code>class</code>  è¢«é¢„æµ‹æˆå¦ä¸€ä¸ª <code>class</code> ï¼‰ã€‚</p>\n<h2 id=\"ä¸¾ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ä¸¾ä¾‹\">#</a> ä¸¾ä¾‹</h2>\n<p>æˆ‘ä»¬ä»¥ æ˜¯å¦æ„ŸæŸ“æ–°å† è‚ºç‚çš„æ¨¡å‹æ¥æ¼”ç¤º æ··æ·†çŸ©é˜µã€‚</p>\n<p>æŒ‰ç…§å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çŸ©é˜µã€‚</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-1.png\" alt=\"\"></p>\n<p>æ¨ªå‘çœ‹ä¸Šå›¾ï¼Œé¢„æµ‹æ„ŸæŸ“æ–°å† ä¸º  <code>Positive</code> , å³ä¸ºé˜³æ€§ï¼Œ æœªæ„ŸæŸ“æ–°å† ä¸º  <code>Negative</code>  , å³ é˜´æ€§ã€‚</p>\n<p>çºµå‘çœ‹ä¸Šå›¾ï¼Œé¢„æµ‹æ­£ç¡®çš„ä¸º  <code>True</code> ,  é¢„æµ‹é”™è¯¯çš„ä¸º <code>False</code> .</p>\n<p>æ‰€ä»¥ä¼šå¾—å‡º å¦‚ä¸‹å››ç§ç»“æœï¼›</p>\n<ul>\n<li><code>True Positive</code> :  <code>TP</code> , çœŸé˜³æ€§ï¼Œå³é¢„æµ‹ç»“æœæ˜¯æ–°å† ï¼ŒçœŸå®å€¼ä¹Ÿæ˜¯æ–°å† ã€‚</li>\n<li><code>True Negative</code> :  <code>TN</code> , çœŸé˜´æ€§ï¼Œå³é¢„æµ‹ç»“æœæ˜¯æœªæ„ŸæŸ“ï¼ŒçœŸå®ä¹Ÿæœªæ„ŸæŸ“æ–°å† ã€‚</li>\n</ul>\n<p>è¿™ä¸¤ä¸ªç»“æœæ˜¯æ¨¡å‹é¢„æµ‹æ­£ç¡®çš„ç»“æœï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€æƒ³å¾—åˆ°çš„éƒ¨åˆ†ï¼Œè¿™ä¸¤éƒ¨åˆ†æ‰€å æ¯”é‡è¶Šå¤§ï¼Œæ¨¡å‹æ•ˆæœè¶Šå¥½ã€‚å¯¹åº”ä¸Šå›¾ä¸­ç»¿è‰²éƒ¨åˆ†ã€‚å…¶å æ¯”æˆä¸ºæ¨¡å‹çš„å‡†ç¡®ç‡ã€‚</p>\n<ul>\n<li><code>False Positive</code> :  <code>FP</code> , å‡é˜³æ€§ï¼Œå³é¢„æµ‹å¾—äº†æ–°å† ï¼Œä½†æ˜¯å®é™…äººå¹¶æ²¡æœ‰æ„ŸæŸ“æ–°å† ã€‚è¿™ç§çš„å±äºè¯¯æŠ¥ã€‚å…¶å æ¯”å±äºè¯¯æŠ¥ç‡ã€‚åœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œ  <code>FP</code>  åˆç§°ä¸º ç¬¬ä¸€ç±»é”™è¯¯ ( <code>Type Error I</code> ï¼Œè¢«åˆ¤å®šä¸ºçœŸçš„å‡)</li>\n<li><code>False Negative</code> :  <code>FN</code> , å‡é˜´æ€§ï¼Œå³é¢„æµ‹æ²¡æœ‰æ„ŸæŸ“æ–°å† ï¼Œä½†æ˜¯å®ä¾‹å·²ç»æ„ŸæŸ“äº†æ–°å† ã€‚è¿™ç§å±äºæ¼æŠ¥ç‡ã€‚å…¶å æ¯”æˆä¸ºæ¼æŠ¥ç‡ã€‚ <code>FN</code>  åˆç§°ä¸º ç¬¬äºŒç±»é”™è¯¯ ( <code>Type Error II</code> , è¢«åˆ¤å®šä¸ºå‡çš„çœŸ)</li>\n</ul>\n<p>è¿™ä¸¤ç§æƒ…å†µï¼Œæ˜¯æ¨¡å‹é¢„æµ‹é”™è¯¯çš„åœºæ™¯ï¼Œæ‰€å æ¯”é‡è¶Šä½è¶Šå¥½ã€‚å¯¹åº”ä¸Šå›¾ä¸­çº¢è‰²éƒ¨åˆ†ã€‚</p>\n<h2 id=\"æŒ‡æ ‡\"><a class=\"markdownIt-Anchor\" href=\"#æŒ‡æ ‡\">#</a> æŒ‡æ ‡</h2>\n<p>å¾ˆå¤šæŒ‡æ ‡éƒ½æ˜¯ä»æ··æ·†çŸ©é˜µå‘å±•å‡ºæ¥çš„ã€‚åœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å‡†ç¡®ç‡ï¼Œè¯¯æŠ¥ç‡ï¼Œæ¼æŠ¥ç‡ã€‚</p>\n<p>ä»¥å›¾ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†çš„çœ‹ä¸‹åˆ†ç±»æ¨¡å‹ä¸­æ··æ·†çŸ©é˜µçš„ç›¸å…³æŒ‡æ ‡.</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-2.png\" alt=\"\"></p>\n<h3 id=\"å‡†ç¡®ç‡\"><a class=\"markdownIt-Anchor\" href=\"#å‡†ç¡®ç‡\">#</a> ğŸ”¥ğŸ”¥å‡†ç¡®ç‡</h3>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mi>c</mi><mi>c</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>y</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">accuracy=\\frac{TP+TN}{TP+TN+FP+FN}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1296600000000003em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.36033em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693300000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>é‚£ä¹ˆï¼Œæœ¬ä¾‹å­ä¸­çš„å‡†ç¡®ç‡ï¼Œå°±æ˜¯ï¼š <code>(10+30)/100=40%</code></p>\n<p>ç†è§£æˆæœ¬æœ€ä½ï¼Œä½†ä¸è¦æ»¥ç”¨ã€‚åœ¨æ ·æœ¬ä¸å‡è¡¡æƒ…å†µä¸‹ï¼ŒæŒ‡æ ‡ç»“æœå®¹æ˜“å‡ºç°è¾ƒå¤§åå·®ï¼›</p>\n<h3 id=\"ç²¾ç¡®ç‡\"><a class=\"markdownIt-Anchor\" href=\"#ç²¾ç¡®ç‡\">#</a> ğŸ”¥ğŸ”¥ç²¾ç¡®ç‡</h3>\n<p>ç²¾ç¡®ç‡æ˜¯åˆ¤æ–­æ¨¡å‹è¯†åˆ«å‡ºæ¥çš„ç»“æœæœ‰å¤šç²¾ç¡®çš„æŒ‡æ ‡ã€‚å¯¹åº”åˆ°ä¿¡ç”¨è¯„åˆ†çš„äº§å“ä¸Šï¼Œå°±æ˜¯æ¨¡å‹æ‰¾åˆ°çš„çœŸçš„åäººï¼ˆå¯¹åº”æ··æ·†çŸ©é˜µä¸­çš„ï¼‰çš„æ¯”ç‡å æ¨¡å‹æ‰¾åˆ°çš„æ‰€æœ‰åäººï¼ˆå¯¹åº”æ··æ·†çŸ©é˜µä¸­çš„ ï¼‰çš„æ¯”ç‡ã€‚</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">precision=\\frac{TP}{TP+FP}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.85396em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1296600000000003em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.36033em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693300000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>ç”¨äºå…³æ³¨ç­›é€‰ç»“æœæ˜¯ä¸æ˜¯æ­£ç¡®çš„åœºæ™¯ï¼Œå®å¯æ²¡æœ‰é¢„æµ‹å‡ºæ¥ï¼Œä¹Ÿä¸èƒ½é¢„æµ‹é”™äº†ã€‚æ¯”å¦‚ï¼Œåœ¨åˆ·è„¸æ”¯ä»˜çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å®å¯å‘Šè¯‰ç”¨æˆ·æ£€æµ‹ä¸é€šè¿‡ï¼Œä¹Ÿä¸èƒ½è®©å¦å¤–ä¸€ä¸ªäººçš„äººè„¸é€šè¿‡æ£€æµ‹ã€‚</p>\n<p>ç²¾ç¡®ç‡ï¼Œåˆç§°ä¸º æŸ¥å‡†ç‡.</p>\n<h3 id=\"æ¼æŠ¥ç‡fnr\"><a class=\"markdownIt-Anchor\" href=\"#æ¼æŠ¥ç‡fnr\">#</a> æ¼æŠ¥ç‡ (FNR)</h3>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>F</mi><mi>N</mi><mi>R</mi><mo>=</mo><mfrac><mrow><mi>F</mi><mi>N</mi></mrow><mrow><mi>F</mi><mi>N</mi><mo>+</mo><mi>T</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">FNR = \\frac{FN}{FN + TP}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1296600000000003em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.36033em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693300000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>é‚£ä¹ˆï¼Œæœ¬ä¾‹å­ä¸­çš„æ¼æŠ¥ç‡ï¼Œå°±æ˜¯ï¼š <code>20/(10+20)=66.67%</code></p>\n<h3 id=\"è¯¯æŠ¥ç‡\"><a class=\"markdownIt-Anchor\" href=\"#è¯¯æŠ¥ç‡\">#</a> è¯¯æŠ¥ç‡</h3>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>F</mi><mi>P</mi><mi>R</mi><mo>=</mo><mfrac><mrow><mi>F</mi><mi>P</mi></mrow><mrow><mi>F</mi><mi>P</mi><mo>+</mo><mi>T</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">FPR = \\frac{FP}{FP + TP}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1296600000000003em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.36033em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693300000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>é‚£ä¹ˆï¼Œæœ¬ä¾‹å­ä¸­çš„æ¼æŠ¥ç‡ï¼Œå°±æ˜¯ï¼š <code>40/(40+30)=37.14%</code></p>\n<h3 id=\"å¬å›ç‡\"><a class=\"markdownIt-Anchor\" href=\"#å¬å›ç‡\">#</a> ğŸ”¥ğŸ”¥å¬å›ç‡</h3>\n<p>è¡¨ç¤ºå®é™…æ‚£è€…ä¸­ï¼Œé¢„æµ‹æ‚£ç—…æˆåŠŸçš„æ¦‚ç‡.  <code>Recall Rate</code>  åˆç§°ä¸º  <code>Sensitive</code> , æŸ¥å…¨ç‡ã€‚é¢„æµ‹æ„ŸæŸ“å å®é™…æ„ŸæŸ“çš„é¢æ¯”ç‡ã€‚å³é¢„æµ‹ä¸ºçœŸå å®é™…ä¸ºçœŸçš„æ¯”ç‡ã€‚</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>S</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mo stretchy=\"false\">(</mo><mi>T</mi><mi>P</mi><mi>R</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">Sensitive(TPR)=\\frac{TP}{TP+FN}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">e</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1296600000000003em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.36033em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693300000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>ç”¨äºå…³æ³¨ç­›é€‰ç»“æœæ˜¯ä¸æ˜¯å…¨é¢çš„åœºæ™¯ï¼Œâ€œå®å¯é”™æ€ä¸€åƒï¼Œç»ä¸æ”¾è¿‡ä¸€ä¸ªâ€ã€‚</p>\n<h3 id=\"specificity\"><a class=\"markdownIt-Anchor\" href=\"#specificity\">#</a> Specificity</h3>\n<p>è¡¨ç¤ºæœªæ‚£ç—…ä¸­ï¼Œé¢„æµ‹æœªæ‚£ç—…æˆåŠŸçš„æ¦‚ç‡ã€‚</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>S</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>c</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy=\"false\">(</mo><mi>T</mi><mi>N</mi><mi>R</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>T</mi><mi>N</mi></mrow><mrow><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">Specificity(TNR)=\\frac{TN}{TN+FP}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.1296600000000003em;vertical-align:-0.7693300000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.36033em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7693300000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>è¿™ä¸¤ä¸ªæŒ‡æ ‡çš„å‡ºç°ï¼Œèƒ½æ›´å¥½çš„å¸®ä½ æ¯”è¾ƒæ¨¡å‹é—´çš„å·®å¼‚ï¼Œå¹¶åœ¨å…¶ä¸­åšå‡ºå–èˆã€‚ä¾‹å¦‚å½“ä¸¤ä¸ªæ¨¡å‹çš„  <code>Accuracy</code>  ç›¸è¿‘æ—¶ï¼Œå¦‚æœä½ æ›´çœ‹é‡äºé¢„æµ‹æ‚£ç—…çš„æ•ˆæœï¼Œä½ åº”è¯¥é€‰  <code>Sensitivity</code>  å€¼è¾ƒé«˜çš„ï¼›ç›¸åï¼Œå¦‚æœä½ æ›´çœ‹é‡äºé¢„æµ‹æœªæ‚£ç—…çš„æ•ˆæœï¼Œä½ å°±åº”è¯¥é€‰æ‹©  <code>Specificity</code>  è¾ƒé«˜çš„ã€‚</p>\n<h3 id=\"f1-score\"><a class=\"markdownIt-Anchor\" href=\"#f1-score\">#</a> ğŸ”¥ğŸ”¥F1 Score</h3>\n<p><code>F1</code>  å¯ä»¥ç»¼åˆååº”ç²¾ç¡®ç‡ å’Œå¬å›ç‡ã€‚  <code>F1</code>  å€¼è¶Šé«˜ï¼Œä»£è¡¨æ¨¡å‹åœ¨ç²¾ç¡®ç‡ å’Œ å¬å›ç‡çš„ç»¼åˆè¡¨ç°è¶Šå¥½ã€‚</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>F</mi><mn>1</mn><mo>=</mo><mfrac><mrow><mn>2</mn><mo>Ã—</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>Ã—</mo><mi>r</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi></mrow><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>+</mo><mi>r</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">F1=\\frac{2 \\times preciosion \\times recall}{precision+recall}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.25188em;vertical-align:-0.8804400000000001em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714399999999998em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804400000000001em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<h3 id=\"p-ræ›²çº¿\"><a class=\"markdownIt-Anchor\" href=\"#p-ræ›²çº¿\">#</a> P-R æ›²çº¿</h3>\n<p TP+FP=\"\"><code>P</code>  è¡¨ç¤ºæŸ¥å‡†ç‡ (æˆ–è€…ç²¾ç¡®ç‡), è®¡ç®—å…¬å¼æ˜¯: \\frac{TP}</p>\n<p TP+FN=\"\"><code>R</code>  è¡¨ç¤ºæŸ¥å…¨ç‡ (æˆ–è€…å¬å›ç‡ï¼ŒSensitive), è®¡ç®—å…¬å¼æ˜¯: \\frac{TP}</p>\n<p><code>P-R</code>  æ›²çº¿æ˜¯æè¿°æŸ¥å‡†ç‡ / æŸ¥å…¨ç‡å˜åŒ–çš„æ›²çº¿ï¼Œ <code>P-R</code>  æ›²çº¿å®šä¹‰å¦‚ä¸‹ï¼šæ ¹æ®å­¦ä¹ å™¨çš„é¢„æµ‹ç»“æœï¼ˆä¸€èˆ¬ä¸ºä¸€ä¸ªå®å€¼æˆ–æ¦‚ç‡ï¼‰å¯¹æµ‹è¯•æ ·æœ¬è¿›è¡Œæ’åºï¼Œå°†æœ€å¯èƒ½æ˜¯ â€œæ­£ä¾‹â€ çš„æ ·æœ¬æ’åœ¨å‰é¢ï¼Œæœ€ä¸å¯èƒ½æ˜¯ â€œæ­£ä¾‹â€ çš„æ’åœ¨åé¢ï¼ŒæŒ‰æ­¤é¡ºåºé€ä¸ªæŠŠæ ·æœ¬ä½œä¸º â€œæ­£ä¾‹â€ è¿›è¡Œé¢„æµ‹ï¼Œæ¯æ¬¡è®¡ç®—å‡ºå½“å‰çš„ <code>P</code>  å€¼å’Œ <code>R</code>  å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-4.png\" alt=\"\"></p>\n<h4 id=\"å¦‚ä½•çœ‹p-ræ›²çº¿\"><a class=\"markdownIt-Anchor\" href=\"#å¦‚ä½•çœ‹p-ræ›²çº¿\">#</a> å¦‚ä½•çœ‹ P-R æ›²çº¿ï¼Ÿ</h4>\n<p><code>P-R</code>  æ›²çº¿å¦‚ä½•è¯„ä¼°å‘¢ï¼Ÿè‹¥ä¸€ä¸ª <code>å­¦ä¹ å™¨A</code>  çš„ <code>P-R</code>  æ›²çº¿è¢«å¦ä¸€ä¸ª <code>å­¦ä¹ å™¨B</code>  çš„ <code>P-R</code>  æ›²çº¿å®Œå…¨åŒ…ä½ï¼Œåˆ™ç§°ï¼š <code>B</code>  çš„æ€§èƒ½ä¼˜äº <code>A</code> ã€‚è‹¥ <code>A</code>  å’Œ <code>B</code>  çš„æ›²çº¿å‘ç”Ÿäº†äº¤å‰ï¼Œåˆ™è°çš„æ›²çº¿ä¸‹çš„é¢ç§¯å¤§ï¼Œè°çš„æ€§èƒ½æ›´ä¼˜ã€‚ä½†ä¸€èˆ¬æ¥è¯´ï¼Œæ›²çº¿ä¸‹çš„é¢ç§¯æ˜¯å¾ˆéš¾è¿›è¡Œä¼°ç®—çš„ï¼Œæ‰€ä»¥è¡ç”Ÿå‡ºäº† â€œå¹³è¡¡ç‚¹â€ï¼ˆ <code>Break-Event Point</code> ï¼Œç®€ç§° <code>BEP</code> ï¼‰ï¼Œå³å½“ <code>P=R</code>  æ—¶çš„å–å€¼ï¼Œå¹³è¡¡ç‚¹çš„å–å€¼è¶Šé«˜ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚</p>\n<p>P å’Œ R æŒ‡æ ‡æœ‰æ—¶ä¼šå‡ºç°çŸ›ç›¾çš„æƒ…å†µï¼Œè¿™æ ·å°±éœ€è¦ç»¼åˆè€ƒè™‘ä»–ä»¬ï¼Œæœ€å¸¸è§çš„æ–¹æ³•å°±æ˜¯ F-Measureï¼Œåˆç§° F-Scoreã€‚F-Measure æ˜¯ P å’Œ R çš„åŠ æƒè°ƒå’Œå¹³å‡ï¼Œå³ï¼š</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-5.png\" alt=\"\"></p>\n<p>ç‰¹åˆ«åœ°ï¼Œå½“ Î²=1 æ—¶ï¼Œä¹Ÿå°±æ˜¯å¸¸è§çš„ F1 åº¦é‡ï¼Œæ˜¯ P å’Œ R çš„è°ƒå’Œå¹³å‡ï¼Œå½“ F1 è¾ƒé«˜æ—¶ï¼Œæ¨¡å‹çš„æ€§èƒ½è¶Šå¥½ã€‚</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-6.png\" alt=\"\"></p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-7.png\" alt=\"\"></p>\n<p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šæœ‰å¤šä¸ªäºŒåˆ†ç±»æ··æ·†çŸ©é˜µï¼Œä¾‹å¦‚ï¼šå¤šæ¬¡è®­ç»ƒæˆ–è€…åœ¨å¤šä¸ªæ•°æ®é›†ä¸Šè®­ç»ƒï¼Œé‚£ä¹ˆä¼°ç®—å…¨å±€æ€§èƒ½çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œåˆ†ä¸ºå®è§‚å’Œå¾®è§‚ã€‚ç®€å•ç†è§£ï¼Œå®è§‚å°±æ˜¯å…ˆç®—å‡ºæ¯ä¸ªæ··æ·†çŸ©é˜µçš„ <code>P</code>  å€¼å’Œ <code>R</code>  å€¼ï¼Œç„¶åå–å¾—å¹³å‡ <code>P</code>  å€¼ <code>macro-P</code>  å’Œå¹³å‡ <code>R</code>  å€¼ <code>macro-R</code> ï¼Œåœ¨ç®—å‡º <code>FÎ²</code>  æˆ– <code>F1</code> ï¼Œè€Œå¾®è§‚åˆ™æ˜¯è®¡ç®—å‡ºæ··æ·†çŸ©é˜µçš„å¹³å‡ <code>TP</code> ã€ <code>FP</code> ã€ <code>TN</code> ã€ <code>FN</code> ï¼Œæ¥ç€è¿›è¡Œè®¡ç®— <code>P</code> ã€ <code>R</code> ï¼Œè¿›è€Œæ±‚å‡º <code>FÎ²</code>  æˆ– <code>F1</code> ã€‚</p>\n<h3 id=\"roc-æ›²çº¿-å’Œ-auc\"><a class=\"markdownIt-Anchor\" href=\"#roc-æ›²çº¿-å’Œ-auc\">#</a> ğŸ”¥ğŸ”¥ROC æ›²çº¿ å’Œ AUC</h3>\n<p><code>ROC</code>  æ›²çº¿ä¸ <code>P-R</code>  æ›²çº¿ååˆ†ç±»ä¼¼ï¼Œéƒ½æ˜¯æŒ‰ç…§æ’åºçš„é¡ºåºé€ä¸€æŒ‰ç…§æ­£ä¾‹é¢„æµ‹ï¼Œä¸åŒçš„æ˜¯ <code>ROC</code>  æ›²çº¿ä»¥ â€œçœŸæ­£ä¾‹ç‡â€ï¼ˆ <code>True Positive Rate</code> ï¼Œç®€ç§° <code>TPR</code> , è®¡ç®—å…¬å¼: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{TP}{TP+FN}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.275662em;vertical-align:-0.403331em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.872331em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.403331em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>ï¼‰ä¸ºæ¨ªè½´ï¼Œçºµè½´ä¸º â€œå‡æ­£ä¾‹ç‡â€ï¼ˆ <code>False Positive Rate</code> ï¼Œç®€ç§° <code>FPR</code> , è®¡ç®—å…¬å¼: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>F</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>N</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{FP}{TN+FP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.275662em;vertical-align:-0.403331em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.872331em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.403331em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>, åˆç§°ä¸ºç‰¹å¼‚æ€§ã€‚ <code>Specificity</code> ã€‚ï¼‰ï¼Œ <code>ROC</code>  åé‡ç ”ç©¶åŸºäºæµ‹è¯•æ ·æœ¬è¯„ä¼°å€¼çš„æ’åºå¥½åã€‚</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-9.png\" alt=\"\"></p>\n<p>ç®€å•åˆ†æå›¾åƒï¼Œå¯ä»¥å¾—çŸ¥ï¼šå½“ <code>FN=0</code>  æ—¶ï¼Œ <code>TN</code>  ä¹Ÿå¿…é¡» <code>0</code> ï¼Œåä¹‹ä¹Ÿæˆç«‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”»ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¯•ç€ä½¿ç”¨ä¸åŒçš„æˆªæ–­ç‚¹ï¼ˆå³é˜ˆå€¼ï¼‰å»åˆ†å‰²é˜Ÿåˆ—ï¼Œæ¥åˆ†ææ›²çº¿çš„å½¢çŠ¶ï¼Œ <code>(0,0)</code>  è¡¨ç¤ºå°†æ‰€æœ‰çš„æ ·æœ¬é¢„æµ‹ä¸ºè´Ÿä¾‹ï¼Œ <code>(1,1)</code>  åˆ™è¡¨ç¤ºå°†æ‰€æœ‰çš„æ ·æœ¬é¢„æµ‹ä¸ºæ­£ä¾‹ï¼Œ <code>(0,1)</code>  è¡¨ç¤ºæ­£ä¾‹å…¨éƒ¨å‡ºç°åœ¨è´Ÿä¾‹ä¹‹å‰çš„ç†æƒ³æƒ…å†µï¼Œ <code>(1,0)</code>  åˆ™è¡¨ç¤ºè´Ÿä¾‹å…¨éƒ¨å‡ºç°åœ¨æ­£ä¾‹ä¹‹å‰çš„æœ€å·®æƒ…å†µã€‚</p>\n<h4 id=\"æ€ä¹ˆçœ‹-rocæ›²çº¿å‘¢\"><a class=\"markdownIt-Anchor\" href=\"#æ€ä¹ˆçœ‹-rocæ›²çº¿å‘¢\">#</a> æ€ä¹ˆçœ‹ ROC æ›²çº¿å‘¢ï¼Ÿ</h4>\n<p>è‹¥ä¸€ä¸ªå­¦ä¹ å™¨ <code>A</code>  çš„ <code>ROC</code>  æ›²çº¿è¢«å¦ä¸€ä¸ªå­¦ä¹ å™¨ <code>B</code>  çš„ <code>ROC</code>  æ›²çº¿å®Œå…¨åŒ…ä½ï¼Œåˆ™ç§° <code>B</code>  çš„æ€§èƒ½ä¼˜äº <code>A</code> ã€‚è‹¥ <code>A</code>  å’Œ <code>B</code>  çš„æ›²çº¿å‘ç”Ÿäº†äº¤å‰ï¼Œåˆ™è°çš„æ›²çº¿ä¸‹çš„é¢ç§¯å¤§ï¼Œè°çš„æ€§èƒ½æ›´ä¼˜ã€‚ <code>ROC</code>  æ›²çº¿ä¸‹çš„é¢ç§¯å®šä¹‰ä¸º <code>AUC</code> ï¼ˆ <code>Area Uder ROC Curve</code> ï¼‰ï¼Œä¸åŒäº <code>P-R</code>  çš„æ˜¯ï¼Œè¿™é‡Œçš„ <code>AUC</code>  æ˜¯å¯ä¼°ç®—çš„ï¼Œå³ <code>AOC</code>  æ›²çº¿ä¸‹æ¯ä¸€ä¸ªå°çŸ©å½¢çš„é¢ç§¯ä¹‹å’Œã€‚æ˜“çŸ¥ï¼š <code>AUC</code>  è¶Šå¤§ï¼Œè¯æ˜æ’åºçš„è´¨é‡è¶Šå¥½ï¼Œ <code>AUC</code>  ä¸º <code>1</code>  æ—¶ï¼Œè¯æ˜æ‰€æœ‰æ­£ä¾‹æ’åœ¨äº†è´Ÿä¾‹çš„å‰é¢ï¼Œ <code>AUC</code>  ä¸º <code>0</code>  æ—¶ï¼Œæ‰€æœ‰çš„è´Ÿä¾‹æ’åœ¨äº†æ­£ä¾‹çš„å‰é¢ã€‚</p>\n<p><code>AUC</code>  è®¡ç®—å…¬å¼:</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-10.png\" alt=\"\"></p>\n<h3 id=\"ä»£ä»·æ•æ„Ÿé”™è¯¯ç‡ä¸ä»£ä»·æ›²çº¿\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ä»·æ•æ„Ÿé”™è¯¯ç‡ä¸ä»£ä»·æ›²çº¿\">#</a> ä»£ä»·æ•æ„Ÿé”™è¯¯ç‡ä¸ä»£ä»·æ›²çº¿</h3>\n<p>ä¸Šé¢çš„æ–¹æ³•ä¸­ï¼Œå°†å­¦ä¹ å™¨çš„çŠ¯é”™åŒç­‰å¯¹å¾…ï¼Œä½†åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå°†æ­£ä¾‹é¢„æµ‹æˆå‡ä¾‹ä¸å°†å‡ä¾‹é¢„æµ‹æˆæ­£ä¾‹çš„ä»£ä»·å¸¸å¸¸æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¾‹å¦‚ï¼šå°†æ— ç–¾ç—…â€“&gt; æœ‰ç–¾ç—…åªæ˜¯å¢å¤šäº†æ£€æŸ¥ï¼Œä½†æœ‰ç–¾ç—…â€“&gt; æ— ç–¾ç—…å´æ˜¯å¢åŠ äº†ç”Ÿå‘½å±é™©ã€‚ä»¥äºŒåˆ†ç±»ä¸ºä¾‹ï¼Œç”±æ­¤å¼•å…¥äº† â€œä»£ä»·çŸ©é˜µâ€ï¼ˆ <code>cost matrix</code> ï¼‰ã€‚</p>\n<p>åœ¨éå‡ç­‰é”™è¯¯ä»£ä»·ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯æœ€å°åŒ– â€œæ€»ä½“ä»£ä»·â€ï¼Œè¿™æ · â€œä»£ä»·æ•æ„Ÿâ€ çš„é”™è¯¯ç‡ä¸º:</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-11.png\" alt=\"\"></p>\n<p>åŒæ ·å¯¹äº ROC æ›²çº¿ï¼Œåœ¨éå‡ç­‰é”™è¯¯ä»£ä»·ä¸‹ï¼Œæ¼”å˜æˆäº† â€œä»£ä»·æ›²çº¿â€ï¼Œä»£ä»·æ›²çº¿æ¨ªè½´æ˜¯å–å€¼åœ¨ [0,1] ä¹‹é—´çš„æ­£ä¾‹æ¦‚ç‡ä»£ä»·ï¼Œå¼ä¸­ p è¡¨ç¤ºæ­£ä¾‹çš„æ¦‚ç‡ï¼Œçºµè½´æ˜¯å–å€¼ä¸º [0,1] çš„å½’ä¸€åŒ–ä»£ä»·ã€‚</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-12.png\" alt=\"\"><br>\n<img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-13.png\" alt=\"\"></p>\n<p>ä»£ä»·æ›²çº¿çš„ç»˜åˆ¶å¾ˆç®€å•ï¼šè®¾ <code>ROC</code>  æ›²çº¿ä¸Šä¸€ç‚¹çš„åæ ‡ä¸º ( <code>TPR</code> ï¼Œ <code>FPR</code> ) ï¼Œåˆ™å¯ç›¸åº”è®¡ç®—å‡º <code>FNR</code> ï¼Œç„¶ååœ¨ä»£ä»·å¹³é¢ä¸Šç»˜åˆ¶ä¸€æ¡ä» ( <code>0</code> ï¼Œ <code>FPR</code> ) åˆ° ( <code>1</code> ï¼Œ <code>FNR</code> ) çš„çº¿æ®µï¼Œçº¿æ®µä¸‹çš„é¢ç§¯å³è¡¨ç¤ºäº†è¯¥æ¡ä»¶ä¸‹çš„æœŸæœ›æ€»ä½“ä»£ä»·ï¼›å¦‚æ­¤å°† <code>ROC</code>  æ›²çº¿å›¾çš„æ¯ä¸ªç‚¹è½¬åŒ–ä¸ºä»£ä»·å¹³é¢ä¸Šçš„ä¸€æ¡çº¿æ®µï¼Œç„¶åå–æ‰€æœ‰çº¿æ®µçš„ä¸‹ç•Œï¼Œå›´æˆçš„é¢ç§¯å³ä¸ºåœ¨æ‰€æœ‰æ¡ä»¶ä¸‹å­¦ä¹ å™¨çš„æœŸæœ›æ€»ä½“ä»£ä»·ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-confusionMetrix-14.png\" alt=\"\"></p>\n<p>ä»¥ä¸Šå°±æ˜¯ ç”±æ··æ·†çŸ©é˜µå¼•ç”³å‡ºæ¥çš„æŒ‡æ ‡äº†ï¼Œå½“ç„¶è¿™äº›æŒ‡æ ‡éƒ½æ˜¯ç”¨æ¥è¯„ä¼°åˆ†ç±»æ¨¡å‹çš„ã€‚ä¸‹ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å†æ¥ä»‹ç»å›å½’æ¨¡å‹çš„è¯„ä¼°æŒ‡æ ‡ã€‚</p>\n<h3 id=\"æŒ‡æ ‡å›¾\"><a class=\"markdownIt-Anchor\" href=\"#æŒ‡æ ‡å›¾\">#</a> æŒ‡æ ‡å›¾</h3>\n<p><img data-src=\"/images/ml/model_evalution/model-evalution-4.png\" alt=\"\"></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"qrcode\"></p>\n",
            "tags": [
                "MachineLearn",
                "æ¨¡å‹è¯„ä¼°"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/13/BQ/LeetCode/0520-detect-capital/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/13/BQ/LeetCode/0520-detect-capital/",
            "title": "LC:520.æ£€æµ‹å¤§å†™å­—æ¯",
            "date_published": "2021-11-13T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>æˆ‘ä»¬å®šä¹‰ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œå•è¯çš„å¤§å†™ç”¨æ³•æ˜¯æ­£ç¡®çš„ï¼š</p>\n<p>å…¨éƒ¨å­—æ¯éƒ½æ˜¯å¤§å†™ï¼Œæ¯”å¦‚  <code>USA</code> ã€‚<br>\nå•è¯ä¸­æ‰€æœ‰å­—æ¯éƒ½ä¸æ˜¯å¤§å†™ï¼Œæ¯”å¦‚  <code>leetcode</code>  ã€‚<br>\nå¦‚æœå•è¯ä¸åªå«æœ‰ä¸€ä¸ªå­—æ¯ï¼Œåªæœ‰é¦–å­—æ¯å¤§å†™ï¼ŒÂ æ¯”å¦‚  <code>Google</code>  ã€‚<br>\nç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²  <code>word</code>  ã€‚å¦‚æœå¤§å†™ç”¨æ³•æ­£ç¡®ï¼Œè¿”å›  <code>true</code>  ï¼›å¦åˆ™ï¼Œè¿”å›  <code>false</code>  ã€‚</p>\n<p></p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1</h3>\n<p>è¾“å…¥ï¼šword = â€œUSAâ€<br>\n è¾“å‡ºï¼štrue</p>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹ 2</h3>\n<p>è¾“å…¥ï¼šword = â€œFlaGâ€<br>\n è¾“å‡ºï¼šfalse</p>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h2>\n<p>1. <code>1 &lt;= word.length &lt;= 100</code> <br>\n2. <code>word</code>  ç”±å°å†™å’Œå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆ</p>\n<p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>\né“¾æ¥ï¼š<br>\nè‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰520.æ£€æµ‹å¤§å†™å­—ç¬¦\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZGV0ZWN0LWNhcGl0YWw=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZGV0ZWN0LWNhcGl0YWw=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰520.æ£€æµ‹å¤§å†™å­—ç¬¦</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h3 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Locale;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">detectCapitalUse</span><span class=\"params\">(String word)</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (word.length() == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">char</span> c = word.charAt(<span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c &lt;= <span class=\"string\">&#x27;Z&#x27;</span> &amp;&amp; c &gt;= <span class=\"string\">&#x27;A&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// é¦–å­—ç¬¦å¤§å†™</span></span><br><span class=\"line\">            <span class=\"keyword\">char</span> c2 = word.charAt(<span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (c2 &lt;= <span class=\"string\">&#x27;Z&#x27;</span> &amp;&amp; c2 &gt;= <span class=\"string\">&#x27;A&#x27;</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> word.equals(word.toUpperCase(Locale.ROOT));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                String substring = word.substring(<span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> substring.equals(substring.toLowerCase(Locale.ROOT));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// é¦–å­—æ¯å°å†™</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> word.equals(word.toLowerCase(Locale.ROOT));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜",
                "ä¸åšä¹Ÿç½¢çš„ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/13/BQ/LeetCode/0495-teemo-attacking/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/13/BQ/LeetCode/0495-teemo-attacking/",
            "title": "LC:495.æè«æ”»å‡»",
            "date_published": "2021-11-13T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>åœ¨ã€Šè‹±é›„è”ç›Ÿã€‹çš„ä¸–ç•Œä¸­ï¼Œæœ‰ä¸€ä¸ªå« â€œæè«â€ çš„è‹±é›„ã€‚ä»–çš„æ”»å‡»å¯ä»¥è®©æ•Œæ–¹è‹±é›„è‰¾å¸Œï¼ˆç¼–è€…æ³¨ï¼šå¯’å†°å°„æ‰‹ï¼‰è¿›å…¥ä¸­æ¯’çŠ¶æ€ã€‚</p>\n<p>å½“æè«æ”»å‡»è‰¾å¸Œï¼Œè‰¾å¸Œçš„ä¸­æ¯’çŠ¶æ€æ­£å¥½æŒç»­Â  <code>duration</code>  ç§’ã€‚</p>\n<p>æ­£å¼åœ°è®²ï¼Œæè«åœ¨ t å‘èµ·å‘èµ·æ”»å‡»æ„å‘³ç€è‰¾å¸Œåœ¨æ—¶é—´åŒºé—´  <code>[t, t + duration - 1]</code> ï¼ˆå«  <code>t</code>  å’Œ  <code>t + duration - 1</code> ï¼‰å¤„äºä¸­æ¯’çŠ¶æ€ã€‚å¦‚æœæè«åœ¨ä¸­æ¯’å½±å“ç»“æŸ å‰ å†æ¬¡æ”»å‡»ï¼Œä¸­æ¯’çŠ¶æ€è®¡æ—¶å™¨å°†ä¼š é‡ç½® ï¼Œåœ¨æ–°çš„æ”»å‡»ä¹‹åï¼Œä¸­æ¯’å½±å“å°†ä¼šåœ¨  <code>duration</code>  ç§’åç»“æŸã€‚</p>\n<p>ç»™ä½ ä¸€ä¸ª éé€’å‡ çš„æ•´æ•°æ•°ç»„  <code>timeSeries</code>  ï¼Œå…¶ä¸­  <code>timeSeries[i]</code>  è¡¨ç¤ºæè«åœ¨  <code>timeSeries[i]</code>  ç§’æ—¶å¯¹è‰¾å¸Œå‘èµ·æ”»å‡»ï¼Œä»¥åŠä¸€ä¸ªè¡¨ç¤ºä¸­æ¯’æŒç»­æ—¶é—´çš„æ•´æ•°  <code>duration</code>  ã€‚</p>\n<p>è¿”å›è‰¾å¸Œå¤„äºä¸­æ¯’çŠ¶æ€çš„ æ€» ç§’æ•°ã€‚</p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1ï¼š</h3>\n<p>è¾“å…¥ï¼štimeSeries = [1,4], duration = 2<br>\n è¾“å‡ºï¼š4<br>\n è§£é‡Šï¼šæè«æ”»å‡»å¯¹è‰¾å¸Œçš„å½±å“å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>ç¬¬ 1 ç§’ï¼Œæè«æ”»å‡»è‰¾å¸Œå¹¶ä½¿å…¶ç«‹å³ä¸­æ¯’ã€‚ä¸­æ¯’çŠ¶æ€ä¼šç»´æŒ 2 ç§’ï¼Œå³ç¬¬ 1 ç§’å’Œç¬¬ 2 ç§’ã€‚</li>\n<li>ç¬¬ 4 ç§’ï¼Œæè«å†æ¬¡æ”»å‡»è‰¾å¸Œï¼Œè‰¾å¸Œä¸­æ¯’çŠ¶æ€åˆæŒç»­ 2 ç§’ï¼Œå³ç¬¬ 4 ç§’å’Œç¬¬ 5 ç§’ã€‚<br>\nè‰¾å¸Œåœ¨ç¬¬ 1ã€2ã€4ã€5 ç§’å¤„äºä¸­æ¯’çŠ¶æ€ï¼Œæ‰€ä»¥æ€»ä¸­æ¯’ç§’æ•°æ˜¯ 4 ã€‚</li>\n</ul>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹ 2ï¼š</h3>\n<p>è¾“å…¥ï¼štimeSeries = [1,2], duration = 2<br>\n è¾“å‡ºï¼š3<br>\n è§£é‡Šï¼šæè«æ”»å‡»å¯¹è‰¾å¸Œçš„å½±å“å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>ç¬¬ 1 ç§’ï¼Œæè«æ”»å‡»è‰¾å¸Œå¹¶ä½¿å…¶ç«‹å³ä¸­æ¯’ã€‚ä¸­æ¯’çŠ¶æ€ä¼šç»´æŒ 2 ç§’ï¼Œå³ç¬¬ 1 ç§’å’Œç¬¬ 2 ç§’ã€‚</li>\n<li>ç¬¬ 2 ç§’ï¼Œæè«å†æ¬¡æ”»å‡»è‰¾å¸Œï¼Œå¹¶é‡ç½®ä¸­æ¯’è®¡æ—¶å™¨ï¼Œè‰¾å¸Œä¸­æ¯’çŠ¶æ€éœ€è¦æŒç»­ 2 ç§’ï¼Œå³ç¬¬ 2 ç§’å’Œç¬¬ 3 ç§’ã€‚<br>\nè‰¾å¸Œåœ¨ç¬¬ 1ã€2ã€3 ç§’å¤„äºä¸­æ¯’çŠ¶æ€ï¼Œæ‰€ä»¥æ€»ä¸­æ¯’ç§’æ•°æ˜¯ 3 ã€‚</li>\n</ul>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h2>\n<ul>\n<li>1 &lt;= timeSeries.length &lt;= 104</li>\n<li>0 &lt;= timeSeries[i], duration &lt;= 107</li>\n<li>timeSeries æŒ‰ éé€’å‡ é¡ºåºæ’åˆ—</li>\n</ul>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰495.æè«æ”»å‡»\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdGVlbW8tYXR0YWNraW5n\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdGVlbW8tYXR0YWNraW5n\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰495.æè«æ”»å‡»</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h3 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">findPoisonedDuration</span><span class=\"params\">(<span class=\"keyword\">int</span>[] timeSeries, <span class=\"keyword\">int</span> duration)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ä¸­æ¯’æ—¶é•¿</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> poisonedCount = duration;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; timeSeries.length; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(timeSeries[i-<span class=\"number\">1</span>]+duration &lt; timeSeries[i])&#123;</span><br><span class=\"line\">                poisonedCount += duration;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                poisonedCount += (timeSeries[i] - timeSeries[i-<span class=\"number\">1</span>]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> poisonedCount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜",
                "ä¸åšä¹Ÿç½¢çš„ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/11/JDK%E6%BA%90%E7%A0%81/versions/jdk11/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/11/JDK%E6%BA%90%E7%A0%81/versions/jdk11/",
            "title": "ä¸è¦å†åœ¨ç”¨JDK11å†™JDK8çš„ä»£ç äº†!",
            "date_published": "2021-11-11T10:18:18.000Z",
            "content_html": "<p>å…¥èŒæ–°å…¬å¸ä¸¤ä¸ªæœˆäº†ï¼Œç”¨ <code>JDK11</code>  å†™äº†ä¸¤ä¸ªæœˆ <code>JDK8</code>  çš„ä»£ç ï¼Œå†ä¹Ÿæ†‹ä¸ä½æƒ³çœ‹çœ‹ <code>JDK11</code>  çš„æ–°ç‰¹æ€§äº†ã€‚æ²¡ç”¨è¿‡ <code>JDK9,10</code> . é‚£å°±è¯´è¯´ <code>JDK8-JDK11</code>  çš„å˜åŒ–å§ã€‚</p>\n<h2 id=\"æ–°\"><a class=\"markdownIt-Anchor\" href=\"#æ–°\">#</a> æ–°</h2>\n<ul>\n<li>è¯­æ³•å¢å¼º\n<ul>\n<li>æœ¬åœ°å˜é‡ç±»å‹æ¨æ–­</li>\n<li><code>Collection</code>  å¢å¼º</li>\n<li><code>Stream</code>  å¢å¼º</li>\n<li><code>Optional</code>  å¢å¼º</li>\n<li><code>InputStream</code>  å¢å¼º</li>\n<li><code>String</code>  å¢å¼º</li>\n</ul>\n</li>\n<li>æ¨¡å—åŒ–å¼€å‘</li>\n<li>æ–°å·¥å…·\n<ul>\n<li><code>REPL</code>  äº¤äº’å¼ç¼–ç¨‹</li>\n<li><code>Low-Overhead Heap Profiling</code></li>\n<li><code>Flight Recorder</code></li>\n</ul>\n</li>\n<li>æ–°åŠŸèƒ½\n<ul>\n<li>æºä»£ç ç›´æ¥æ‰§è¡Œ</li>\n<li>å®Œå…¨æ”¯æŒ <code>Linux</code>  å®¹å™¨</li>\n<li>æ”¯æŒ <code>Unicode 10</code></li>\n<li>æ–°æ”¯æŒçš„åŠ å¯†ç®—æ³•</li>\n<li><code>HttpClient</code></li>\n</ul>\n</li>\n<li>åƒåœ¾å›æ”¶å™¨\n<ul>\n<li><code>ZGC</code></li>\n<li><code>Epsilon</code></li>\n<li>æ›´å¥½çš„ <code>G1</code></li>\n</ul>\n</li>\n<li>ç§»é™¤ä¸ä¸å†æ¨èä½¿ç”¨çš„ç±»åº“æˆ–åŠŸèƒ½\n<ul>\n<li>ç§»é™¤äº† <code>Java EE</code>  å’Œ <code>CORBA Moudles</code></li>\n<li>å°† <code>Nashorn Javascript</code>  æ ‡è®°ä¸ºä¸æ¨è</li>\n<li>å°† <code>Pack200 Tools and API</code>  æ ‡è®°ä¸ºä¸æ¨è</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"jdk8-jdk11çš„è¯­æ³•æ–°ç‰¹æ€§\"><a class=\"markdownIt-Anchor\" href=\"#jdk8-jdk11çš„è¯­æ³•æ–°ç‰¹æ€§\">#</a> JDK8-JDK11 çš„è¯­æ³•æ–°ç‰¹æ€§</h2>\n<h3 id=\"æœ¬åœ°å˜é‡ç±»å‹æ¨æ–­\"><a class=\"markdownIt-Anchor\" href=\"#æœ¬åœ°å˜é‡ç±»å‹æ¨æ–­\">#</a> æœ¬åœ°å˜é‡ç±»å‹æ¨æ–­</h3>\n<p><code>since JDK10</code></p>\n<p><code>Java10</code>  ä»¥åå¯ä»¥ç”¨ <code>var</code>  å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œä¸ç”¨æ˜¾å¼å†™å‡ºå®ƒçš„ç±»å‹ã€‚ä½†è¦æ³¨æ„ï¼Œè¢« <code>var</code>  å®šä¹‰çš„å˜é‡ä»ç„¶æ˜¯é™æ€ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šè¯•å›¾å»æ¨æ–­å…¶ç±»å‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„  <code>1</code> . ä¸å…¼å®¹çš„ç±»å‹æ˜¯ä¸èƒ½é‡æ–°èµ‹å€¼çš„ï¼ <code>2</code> . åªè¦ç¼–è¯‘å™¨æ— æ³•æ¨æ–­å‡ºå˜é‡ç±»å‹ï¼Œå°±ä¼šç¼–è¯‘é”™è¯¯ï¼</p>\n<p>ä¸¾ä¸ªæ —å­:</p>\n<h4 id=\"åŸºæœ¬ä½¿ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#åŸºæœ¬ä½¿ç”¨\">#</a> åŸºæœ¬ä½¿ç”¨</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> str1 = <span class=\"string\">&quot;local variable type interface&quot;</span>;</span><br><span class=\"line\">    String str2 = <span class=\"string\">&quot;local variable type interface&quot;</span>;</span><br><span class=\"line\">    System.out.println(str1 == str2); <span class=\"comment\">//true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç®€åŒ–æ³›å‹å£°æ˜\"><a class=\"markdownIt-Anchor\" href=\"#ç®€åŒ–æ³›å‹å£°æ˜\">#</a> ç®€åŒ–æ³›å‹å£°æ˜</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ç®€åŒ–æ³›å‹å£°æ˜</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> lists = <span class=\"keyword\">new</span> ArrayList&lt;Map&lt;String, List&lt;String&gt;&gt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> item : lists) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> entries = item.entrySet();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> entry : entries) &#123;</span><br><span class=\"line\">            String key = entry.getKey();</span><br><span class=\"line\">            <span class=\"keyword\">var</span> values = entry.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> value : values) &#123;</span><br><span class=\"line\">                System.out.println(value);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¹¸å¥½ç¼–è¯‘å™¨ä¼šæœ‰ç±»å‹æç¤ºã€‚å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"/images/java/jdk/versions/jdk8-jdk11-1.png\" alt=\"\"></p>\n<h4 id=\"ç®€åŒ–lambdaå‚æ•°\"><a class=\"markdownIt-Anchor\" href=\"#ç®€åŒ–lambdaå‚æ•°\">#</a> ç®€åŒ– lambda å‚æ•°</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * lambdaå‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"> * ä»Java 11å¼€å§‹ï¼Œlambdaå‚æ•°ä¹Ÿå…è®¸ä½¿ç”¨varå…³é”®å­—ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Predicate&lt;String&gt; predNotNull = (<span class=\"keyword\">var</span> a) -&gt; a != <span class=\"keyword\">null</span> &amp;&amp; !a.isBlank();</span><br><span class=\"line\"></span><br><span class=\"line\">    String strAfterFilter = Stream.of(<span class=\"string\">&quot;I&quot;</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;love&quot;</span>, <span class=\"string\">&quot; &quot;</span>, <span class=\"string\">&quot;my&quot;</span>, <span class=\"string\">&quot;wife&quot;</span>, <span class=\"keyword\">null</span>, <span class=\"string\">&quot;very&quot;</span>, <span class=\"string\">&quot;much&quot;</span>)</span><br><span class=\"line\">            .filter(predNotNull)</span><br><span class=\"line\">            .collect(Collectors.joining(<span class=\"string\">&quot; &quot;</span>));</span><br><span class=\"line\">    System.out.println(strAfterFilter); <span class=\"comment\">//I love my wife very much</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä¸å…¼å®¹çš„ç±»å‹èµ‹å€¼\"><a class=\"markdownIt-Anchor\" href=\"#ä¸å…¼å®¹çš„ç±»å‹èµ‹å€¼\">#</a> ä¸å…¼å®¹çš„ç±»å‹èµ‹å€¼</h4>\n<p>è¿™ç§ç›´æ¥ç¼–è¯‘å¤±è´¥ï¼Œç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œå·²ç»æ¨æ–­å‡ºæ¥äº†  <code>str</code>  æ˜¯  <code>String</code>  ç±»å‹ã€‚ ç¬¬ä¸‰è¡Œå°±ä¸èƒ½èµ‹å€¼ä¸º <code>double</code>  ç±»å‹äº†ã€‚</p>\n<p><img data-src=\"/images/java/jdk/versions/jdk8-jdk11-2.png\" alt=\"\"></p>\n<h4 id=\"ä¸èƒ½æ¨æµ‹çš„ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#ä¸èƒ½æ¨æµ‹çš„ç±»å‹\">#</a> ä¸èƒ½æ¨æµ‹çš„ç±»å‹</h4>\n<p><img data-src=\"/images/java/jdk/versions/jdk8-jdk11-3.png\" alt=\"\"></p>\n<p>ä½†æ˜¯ï¼Œå¯¹äºç”¨ä¹ æƒ¯äº†  <code>IDEA</code>  å¿«æ·æŒ‡ä»¤çš„æˆ‘æ¥è¯´ï¼Œè¿™ä¸ª <code>var</code>  å˜é‡ï¼Œå¯¹æˆ‘æ¥è¯´æ¯«æ— æ„ä¹‰ã€‚æ„Ÿè§‰ <code>jdk</code>  æ˜¯åœ¨ç‚«æŠ€ï¼Œä½†æˆ‘æ¯«æ— å…´è¶£ã€‚</p>\n<p>æ¯”å¦‚ï¼Œåœ¨ <code>idea</code>  ä¸­ï¼Œä½ è¾“å…¥  <code>new ArrayList().var</code>  , ç„¶åå›è½¦ï¼Œ <code>IDEA</code>  å°±ä¼šä¸ºä½ è‡ªåŠ¨ç”Ÿæˆç±»å‹ã€‚<br>\nç±»ä¼¼çš„è¿˜æœ‰  <code>lists.for</code> ,  <code>lists.fori</code>  ç­‰ç­‰ã€‚æ‰€ä»¥ï¼Œä¸ªäººå¹¶ä¸æ¨èå¤§å®¶ä½¿ç”¨è¯¥è¯­æ³•ï¼Œå¹¶éä¸èƒ½ç”¨ï¼Œæ¯”å¦‚åœ¨  <code>lambda</code>  ä¸­ä½¿ç”¨æ›¿æ¢ç±»å‹æ—¶è¿˜æ˜¯æ¯”è¾ƒå¥½çš„ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰æŒæ¡  <code>xx.var</code>  è¿™ç§å¼‚èƒ½åŠ æŒçš„è¯ï¼Œæƒ³ç”¨å°±ç”¨å§ã€‚</p>\n<p>æ€»ä¹‹ï¼Œçœ‹åˆ«äººå†™äº†ä¸ª  <code>var</code>  æ—¶ï¼Œä¸è¦å‘å‡º â€œå“‡è—•ï¼Œ <code>Java</code>  è¿˜å¯ä»¥è¿™ä¹ˆå†™â€ã€‚</p>\n<h3 id=\"collectionå¢å¼º\"><a class=\"markdownIt-Anchor\" href=\"#collectionå¢å¼º\">#</a> Collection å¢å¼º</h3>\n<p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯  <code>List</code>  ,  <code>Set</code> ,  <code>Map</code>  è¿™ä¸‰ç§é›†åˆå¤šäº†ä¸¤ä¸ªæ–¹æ³•  <code>of</code>  å’Œ  <code>copyOf</code> .</p>\n<p><code>since jdk9</code></p>\n<p>è¿™é‡Œç›´æ¥ç”¨ä¸‰ä¸ªæ —å­åˆ†åˆ«æ¼”ç¤ºä¸€ä¸‹</p>\n<h4 id=\"list\"><a class=\"markdownIt-Anchor\" href=\"#list\">#</a> List</h4>\n<p><code>List.of</code>  å†…éƒ¨æ˜¯åˆ›å»ºä¸€ä¸ªçš„   <code>immutable collections</code> ã€‚ä¸å¯å˜é›†åˆã€‚æ‰€ä»¥ä¸å¯ä»¥å¢åˆ æ”¹å…ƒç´ ã€‚</p>\n<p><code>List.of()</code>   å’Œ  <code>List.copyOf()</code>  éƒ½æ˜¯åˆ›å»ºçš„ä¸å¯å˜é›†åˆ</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤º List</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    List&lt;Integer&gt; integers = List.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">    List&lt;Integer&gt; integers1 = List.copyOf(integers);</span><br><span class=\"line\">    System.out.println(integers == integers1); <span class=\"comment\">// true</span></span><br><span class=\"line\">    integers.add(<span class=\"number\">5</span>); <span class=\"comment\">//  UnsupportedOperationException</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"set\"><a class=\"markdownIt-Anchor\" href=\"#set\">#</a> Set</h4>\n<p><code>Set</code>  å’Œ  <code>List</code>  çš„ç”¨æ³•ç±»ä¼¼ã€‚ åŒæ ·çš„ï¼Œä¹Ÿæ˜¯ä¸å¯å˜é›†åˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ <code>copyOf</code>  æ–¹æ³•ï¼Œå¦‚æœå½¢å‚æ˜¯å¯å˜é›†åˆï¼Œåˆ™è¿”å›çš„ä¹Ÿæ˜¯å¯å˜é›†åˆã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤º Set</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Set&lt;Integer&gt; integers = Set.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>);</span><br><span class=\"line\">    Set&lt;Integer&gt; integers1 = Set.copyOf(integers);</span><br><span class=\"line\">    System.out.println(integers == integers1); <span class=\"comment\">// true</span></span><br><span class=\"line\"><span class=\"comment\">//        integers.add(5); //  UnsupportedOperationException</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Set&lt;Integer&gt; integers2 = <span class=\"keyword\">new</span> HashSet&lt;&gt;();</span><br><span class=\"line\">    integers2.add(<span class=\"number\">1</span>);</span><br><span class=\"line\">    integers2.add(<span class=\"number\">2</span>);</span><br><span class=\"line\">    integers2.add(<span class=\"number\">3</span>);</span><br><span class=\"line\">    Set&lt;Integer&gt; integers3 = Set.copyOf(integers2);</span><br><span class=\"line\">    System.out.println(integers3 == integers2); <span class=\"comment\">// false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å…ƒç´ ä¸èƒ½é‡å¤ =&gt;  java.lang.IllegalArgumentException</span></span><br><span class=\"line\">    Set&lt;Integer&gt; integers4 = Set.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"map\"><a class=\"markdownIt-Anchor\" href=\"#map\">#</a> Map</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤ºMap</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨ofåˆ›å»ºMap</span></span><br><span class=\"line\">    Map&lt;String, Integer&gt; map1 = Map.of(<span class=\"string\">&quot;k1&quot;</span>, <span class=\"number\">2</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">    Map&lt;String, Integer&gt; map2 = Map.copyOf(map1);</span><br><span class=\"line\">    System.out.println(map1 == map2); <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// copyOfï¼Œå–å†³äºä¼ å…¥çš„mapæ˜¯å¦ä¸ºå¯å˜é›†åˆ</span></span><br><span class=\"line\">    HashMap&lt;String, Integer&gt; map3 = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">    map3.put(<span class=\"string\">&quot;k1&quot;</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">    map3.put(<span class=\"string\">&quot;k2&quot;</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\">    Map&lt;String, Integer&gt; map4 = Map.copyOf(map3);</span><br><span class=\"line\">    System.out.println(map3 == map4); <span class=\"comment\">//false</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// keyä¸èƒ½é‡å¤ =&gt; java.lang.IllegalArgumentExceptio</span></span><br><span class=\"line\">    Map&lt;String, Integer&gt; map5 = Map.of(<span class=\"string\">&quot;k1&quot;</span>, <span class=\"number\">2</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"number\">2</span>, <span class=\"string\">&quot;k1&quot;</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"streamå¢å¼º\"><a class=\"markdownIt-Anchor\" href=\"#streamå¢å¼º\">#</a> Stream å¢å¼º</h3>\n<p><code>since JDK9</code></p>\n<p><code>Stream</code>  ç›¸å…³å†…å®¹ï¼Œæ–°å¢äº† <code>4</code>  ä¸ªæ–¹æ³•.</p>\n<h4 id=\"å¢åŠ å•ä¸ªå‚æ•°æ„é€ æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#å¢åŠ å•ä¸ªå‚æ•°æ„é€ æ–¹æ³•\">#</a> å¢åŠ å•ä¸ªå‚æ•°æ„é€ æ–¹æ³•</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ–°å¢å•ä¸ªå…ƒç´ çš„Streamæ„é€ ,å…è®¸ä¸ºç©º</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    System.out.println(Stream.ofNullable(<span class=\"keyword\">null</span>).count()); <span class=\"comment\">// 0</span></span><br><span class=\"line\">    System.out.println(Stream.of(<span class=\"number\">1</span>).count()); <span class=\"comment\">//1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¢åŠ takewhileæ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#å¢åŠ takewhileæ–¹æ³•\">#</a> å¢åŠ  takeWhile æ–¹æ³•</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * æ¼”ç¤ºtake whileæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">  * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">  * ä»å¤´å¼€å§‹è®¡ç®—ï¼Œé‡åˆ°ä¸æ»¡è¶³Predicateçš„å…ƒç´ å³åœæ­¢ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    List&lt;Integer&gt; collect1 = Stream.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>).takeWhile(i -&gt; i &lt;= <span class=\"number\">3</span>).collect(Collectors.toList());</span><br><span class=\"line\">    System.out.println(collect1); <span class=\"comment\">// [1, 2, 3]</span></span><br><span class=\"line\"></span><br><span class=\"line\">    List&lt;Integer&gt; collect2 = Stream.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">4</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>).takeWhile(i -&gt; i &gt; <span class=\"number\">6</span>).collect(Collectors.toList());</span><br><span class=\"line\">    System.out.println(collect2); <span class=\"comment\">// [ ]</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å¢åŠ -dropwhile-æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#å¢åŠ -dropwhile-æ–¹æ³•\">#</a> å¢åŠ  dropWhile æ–¹æ³•</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * æ¼”ç¤º dropWhile æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">  * ä»å¤´å¼€å§‹è®¡ç®—ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ Predicteçš„å…ƒç´ æ—¶ï¼Œå¼€å§‹è®¡ç®—ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    List&lt;Integer&gt; collect1 = Stream.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">4</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>).dropWhile(i -&gt; i &lt;= <span class=\"number\">3</span>).collect(Collectors.toList());</span><br><span class=\"line\">    System.out.println(collect1); <span class=\"comment\">// [1, 2, 3, 4, 5, 4, 3, 2, 1]</span></span><br><span class=\"line\"></span><br><span class=\"line\">    List&lt;Integer&gt; collect2 = Stream.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">4</span>, <span class=\"number\">3</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>).dropWhile(i -&gt; i &gt; <span class=\"number\">3</span>).collect(Collectors.toList());</span><br><span class=\"line\">    System.out.println(collect2); <span class=\"comment\">// [4, 5, 4, 3, 2, 1]</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"iterate-é‡è½½æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#iterate-é‡è½½æ–¹æ³•\">#</a> iterate é‡è½½æ–¹æ³•</h4>\n<p>è¿™ä¸ª  <code>iterate</code>  æ–¹æ³•çš„æ–°é‡è½½æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ æä¾›ä¸€ä¸ª  <code>Predicate</code>  (åˆ¤æ–­æ¡ä»¶) æ¥æŒ‡å®šä»€ä¹ˆæ—¶å€™ç»“æŸè¿­ä»£ã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šç›¸æ¯” <code>JDK8</code>  çš„æ–¹æ³•ï¼Œ <code>iterator</code>  æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>Prediction</code> ã€‚ <code>Prediction</code>  ä¸­è¿›è¡Œåˆ¤æ–­çš„å–å€¼æ˜¯è¿­ä»£ä¹‹åçš„æ•°å€¼ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * æ¼”ç¤º iterate çš„é‡è½½æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo4</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Jdk8æ”¯æŒä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œ ç”Ÿæˆä»1å¼€å§‹çš„å¹³æ–¹æ•°</span></span><br><span class=\"line\">    List&lt;Integer&gt; collect1 = Stream.iterate(<span class=\"number\">1</span>, i -&gt; i * <span class=\"number\">2</span>).limit(<span class=\"number\">5</span>).collect(Collectors.toList());</span><br><span class=\"line\">    System.out.println(collect1); <span class=\"comment\">// [1, 2, 4, 8, 16]</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// JDK9 æ”¯æŒï¼ŒåŠ å…¥ä¸€ä¸ª Prediction, åˆ¤æ–­å¦‚ä½•ç»ˆæ­¢ã€‚</span></span><br><span class=\"line\">    List&lt;Integer&gt; collect2 = Stream.iterate(<span class=\"number\">1</span>, i -&gt; i &lt;= <span class=\"number\">16</span>, i -&gt; i * <span class=\"number\">2</span>).limit(<span class=\"number\">10</span>).collect(Collectors.toList());</span><br><span class=\"line\">    System.out.println(collect2); <span class=\"comment\">// [1, 2, 4, 8, 16]</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"optional-å¢å¼º\"><a class=\"markdownIt-Anchor\" href=\"#optional-å¢å¼º\">#</a> Optional å¢å¼º</h3>\n<p><code>Since JDK 9</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * æä¾›ä¸€ä¸ªé»˜è®¤çš„Optionalå¯¹è±¡</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å®šä¹‰ä¸€ä¸ªå˜é‡, å¯èƒ½ä¸ºç©º or not</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> variable = <span class=\"string\">&quot;jdk 11&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// jdk 8 æ”¯æŒof(),ofNullable() è½¬æ¢ä¸ºOptionalå¯¹è±¡ã€‚</span></span><br><span class=\"line\">    List&lt;String&gt; collect = Optional.of(variable).stream().collect(Collectors.toList());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// JDK 8 å¯ä»¥é€šè¿‡ orElse, å½“ variable ä¸ºç©ºçš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„å­—ç¬¦ä¸²å€¼ã€‚</span></span><br><span class=\"line\">    Optional.ofNullable(variable).orElse(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// jdk 9 æä¾›äº†æä¾› or() è¿”å›ä¸€ä¸ªé»˜è®¤Optionalå¯¹è±¡ã€‚</span></span><br><span class=\"line\">    Optional.empty().or(() -&gt; Optional.of(<span class=\"string\">&quot;jdk 11&quot;</span>)).get();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"inputstream-åŠ å¼º\"><a class=\"markdownIt-Anchor\" href=\"#inputstream-åŠ å¼º\">#</a> InputStream åŠ å¼º</h3>\n<p><code>InputStream</code>  ç»ˆäºæœ‰äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼š <code>transferTo</code> ï¼Œå¯ä»¥ç”¨æ¥å°†æ•°æ®ç›´æ¥ä¼ è¾“åˆ°  <code>OutputStream</code> ï¼Œè¿™æ˜¯åœ¨å¤„ç†åŸå§‹æ•°æ®æµæ—¶éå¸¸å¸¸è§çš„ä¸€ç§ç”¨æ³•ã€‚</p>\n<p>è¿˜æ˜¯ä¸¾ä¸ªæ —å­å§:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * ç›´æ¥å°†æ•°æ®å†™å…¥è¾“å‡ºæµ</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> classLoader = ClassLoader.getSystemClassLoader();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> inputStream = classLoader.getResourceAsStream(<span class=\"string\">&quot;readFile.txt&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> javastack = File.createTempFile(<span class=\"string\">&quot;writeFile&quot;</span>, <span class=\"string\">&quot;txt&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> (<span class=\"keyword\">var</span> outputStream = <span class=\"keyword\">new</span> FileOutputStream(javastack)) &#123;</span><br><span class=\"line\">        inputStream.transferTo(outputStream);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"stringå¢å¼º\"><a class=\"markdownIt-Anchor\" href=\"#stringå¢å¼º\">#</a> String å¢å¼º</h3>\n<h4 id=\"isblank\"><a class=\"markdownIt-Anchor\" href=\"#isblank\">#</a> isBlank</h4>\n<p>åˆ¤æ–­ç›®æ ‡å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ç©ºç™½å­—ç¬¦ã€‚</p>\n<p>ä½¿ç”¨åŠŸèƒ½ä¸Šçš„é—®é¢˜ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¾‹å­æ¥çš„èˆ’æœã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// åŠè§’ç©ºæ ¼  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; &quot;</span>.isBlank());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å…¨è§’ç©ºæ ¼  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;ã€€&quot;</span>.isBlank());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// åŠè§’ç©ºæ ¼çš„unicodeå­—ç¬¦å€¼  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;\\u0020&quot;</span>.isBlank());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å…¨è§’ç©ºæ ¼çš„unicodeå­—ç¬¦å€¼  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;\\u3000&quot;</span>.isBlank());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// åˆ¶è¡¨ç¬¦  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;\\t&quot;</span>.isBlank());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å›è½¦  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;\\r&quot;</span>.isBlank());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ¢è¡Œ  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;\\n&quot;</span>.isBlank());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å„ç§ç©ºç™½å­—ç¬¦æ‹¼æ¥  ===&gt; true</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot; \\t\\r\\nã€€&quot;</span>.isBlank());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"stripstripleadingä¸striptrailing\"><a class=\"markdownIt-Anchor\" href=\"#stripstripleadingä¸striptrailing\">#</a> stripï¼ŒstripLeading ä¸ stripTrailing</h4>\n<p>å»é™¤å­—ç¬¦ä¸²çš„å‰åå­—ç¬¦ä¸²</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å…¨è§’ç©ºæ ¼ + åˆ¶è¡¨ç¬¦ + å›è½¦ + æ¢è¡Œ + åŠè§’ç©ºæ ¼ + &lt;å†…å®¹&gt; + å…¨è§’ç©ºæ ¼ + åˆ¶è¡¨ç¬¦ + å›è½¦ + æ¢è¡Œ + åŠè§’ç©ºæ ¼</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> strTest = <span class=\"string\">&quot;ã€€\\t\\r\\n ä½ å¥½ jdk11ã€€\\t\\r\\n &quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// strip å»é™¤ä¸¤è¾¹ç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;[&quot;</span> + strTest.strip() + <span class=\"string\">&quot;]&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// stripLeading å»é™¤å¼€å¤´çš„ç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;[&quot;</span> + strTest.stripLeading() + <span class=\"string\">&quot;]&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// stripTrailing å»é™¤ç»“å°¾çš„ç©ºç™½å­—ç¬¦</span></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;[&quot;</span> + strTest.stripTrailing() + <span class=\"string\">&quot;]&quot;</span>);</span><br></pre></td></tr></table></figure>\n<h4 id=\"repeat\"><a class=\"markdownIt-Anchor\" href=\"#repeat\">#</a> repeat</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> strOri = <span class=\"string\">&quot;jdk11&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> str1 = strOri.repeat(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> str2 = strOri.repeat(<span class=\"number\">3</span>);</span><br><span class=\"line\">System.out.println(str1);</span><br><span class=\"line\">System.out.println(str2);</span><br><span class=\"line\"><span class=\"comment\">// repeatä¼ å…¥å‚æ•°ä¸º1æ—¶ï¼Œä¸ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›åŸæ¥çš„Stringå¯¹è±¡ã€‚</span></span><br><span class=\"line\">System.out.println(str1 == strOri);</span><br></pre></td></tr></table></figure>\n<h4 id=\"lines\"><a class=\"markdownIt-Anchor\" href=\"#lines\">#</a> lines</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * æŒ‰ç…§æ¢è¡Œç¬¦æ‹†åˆ†å­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> strContent = <span class=\"string\">&quot;hello java\\rhello jdk11\\nhello world\\r\\nhello everyone&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">// linesæ–¹æ³•ç”¨ \\r æˆ– \\n æˆ– \\r\\n å¯¹å­—ç¬¦ä¸²åˆ‡å‰²å¹¶è¿”å›streamå¯¹è±¡</span></span><br><span class=\"line\">    strContent.lines().forEach(System.out::println);</span><br><span class=\"line\">    System.out.println(strContent.lines().count());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¨¡å—åŒ–å¼€å‘\"><a class=\"markdownIt-Anchor\" href=\"#æ¨¡å—åŒ–å¼€å‘\">#</a> æ¨¡å—åŒ–å¼€å‘</h2>\n<p><code>Java9</code>  å¼•å…¥äº†æ¨¡å—åŒ–ï¼Œ <code>Java Platform Module System</code> ï¼Œ <code>java</code>  å¹³å°æ¨¡å—ç³»ç»Ÿï¼Œç®€ç§° <code>JPMS</code> ã€‚</p>\n<p>è¿™é‡Œå’Œå¤§å®¶ä¸€èµ·åšä¸€ä¸‹ã€‚</p>\n<h3 id=\"æ–°å»ºä¸¤ä¸ª-module\"><a class=\"markdownIt-Anchor\" href=\"#æ–°å»ºä¸¤ä¸ª-module\">#</a> æ–°å»ºä¸¤ä¸ª module</h3>\n<p>æˆ‘ä»¬æ–°å»ºä¸¤ä¸ªæ¨¡å— core å’Œ businessã€‚ å¦‚ä¸‹å›¾</p>\n<p><img data-src=\"/images/java/jdk/versions/jdk8-jdk11-5.png\" alt=\"\"></p>\n<h3 id=\"core-æ¨¡å—é…ç½®\"><a class=\"markdownIt-Anchor\" href=\"#core-æ¨¡å—é…ç½®\">#</a> core æ¨¡å—é…ç½®</h3>\n<ul>\n<li>æ–°å»ºä¸€ä¸ªç±» RestResult ï¼Œè¡¨ç¤ºå…¬å…±è°ƒç”¨çš„ç±»ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RestResult</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> T data;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer code;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String errMsg;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">RestResult</span><span class=\"params\">(T data)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.data = data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>æ–°å»ºä¸€ä¸ª  <code>module-info.java</code> . å£°æ˜  <code>module</code>  ä¿¡æ¯.   <code>exports</code>  å°†  <code>com.fxb.learn.module.core</code>  è¿™ä¸ªåŒ…ä¸‹çš„ç±»éƒ½ export å‡ºå»ã€‚\n<ul>\n<li>å¦‚æœæ˜¯ä¸€ä¸ª <code>java</code>  çš„æ™®é€šåº”ç”¨ï¼Œåˆ™åœ¨  <code>src</code>  ç›®å½•ä¸‹ï¼Œæ–°å»º  <code>module-info.java</code>  æ–‡ä»¶å³å¯ã€‚</li>\n<li>å¦‚æœæ˜¯ä¸€ä¸ª <code>maven</code>  åº”ç”¨ï¼Œåˆ™éœ€è¦åœ¨  <code>src/main/java</code>  ç›®å½•ä¸‹ï¼Œæ–°å»º  <code>module-info.java </code> æ–‡ä»¶ã€‚</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// core æ˜¯moduleçš„åç§°</span></span><br><span class=\"line\"><span class=\"keyword\">module</span> core &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å°†æŒ‡å®šçš„åŒ…ä¸‹ç±»ï¼Œexportå‡ºå»</span></span><br><span class=\"line\">    <span class=\"keyword\">exports</span> com.fxb.learn.<span class=\"keyword\">module</span>.core;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"business-æ¨¡å—é…ç½®\"><a class=\"markdownIt-Anchor\" href=\"#business-æ¨¡å—é…ç½®\">#</a> business æ¨¡å—é…ç½®</h3>\n<ul>\n<li>åœ¨ <code>business</code>  æ¨¡å—ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª  <code>module-info.java</code> . æ–‡ä»¶ä½ç½®ä¸Š <code>core</code>  æ¨¡å—ä¸­çš„ä¸€è‡´ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">module</span> business &#123;</span><br><span class=\"line\">    <span class=\"keyword\">requires</span> core;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>åœ¨ <code>Idea</code>  ä¸­é…ç½®ï¼Œ <code>business</code>  æ¨¡å—å¼•ç”¨ <code>core</code>  æ¨¡å—ã€‚</li>\n</ul>\n<p><img data-src=\"/images/java/jdk/versions/jdk8-jdk11-4.png\" alt=\"\"></p>\n<h3 id=\"å†™ä¸ªä¾‹å­çœ‹çœ‹\"><a class=\"markdownIt-Anchor\" href=\"#å†™ä¸ªä¾‹å­çœ‹çœ‹\">#</a> å†™ä¸ªä¾‹å­çœ‹çœ‹</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * æ¼”ç¤ºæ¨¡å—è°ƒç”¨ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> RestResult&lt;User&gt; <span class=\"title\">getUserById</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> RestResult&lt;&gt;(<span class=\"keyword\">new</span> User(<span class=\"number\">1</span>, <span class=\"string\">&quot;fangjiaxiaobai&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ–°å·¥å…·\"><a class=\"markdownIt-Anchor\" href=\"#æ–°å·¥å…·\">#</a> æ–°å·¥å…·</h2>\n<p><code>JDK</code>  è¿˜æä¾›äº†ä¸€äº›æ–°çš„å·¥å…·ï¼Œ  <code>REPL</code>  äº¤äº’å¼ç¼–ç¨‹ï¼Œ <code>Low-Overhead Heap Profiling</code>  (å…è´¹çš„ä½è€—èƒ½é£è¡Œè®°å½•ä»ªå’Œå †åˆ†æä»ª), <code>Flight Recorder</code>  (é»‘ç›’å­)</p>\n<h3 id=\"repläº¤äº’å¼ç¼–ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#repläº¤äº’å¼ç¼–ç¨‹\">#</a>  <code>REPL</code>  äº¤äº’å¼ç¼–ç¨‹</h3>\n<p>ä½ æ˜¯å¦ä½¿ç”¨ j <code>upter</code> ,  <code>java </code> ä¹Ÿæœ‰äº†ï¼</p>\n<p><code>Java</code>  æä¾›äº†ä¸€ä¸ªæ–°çš„å·¥å…· <code>jshell</code> ï¼Œ <code>Java</code>  ç»ˆäºå¯ä»¥åƒ <code>python</code> ï¼Œ <code>scala</code>  ç­‰è¯­è¨€é‚£æ ·ï¼Œäº¤äº’å¼æ¼”ç¤ºè¯­æ³•äº†</p>\n<p><img data-src=\"/images/java/jdk/versions/jdk8-jdk11-6.png\" alt=\"\"></p>\n<p>å…·ä½“å‘½ä»¤å¯ä»¥ä½¿ç”¨  <code>/help</code>  å‘½ä»¤æŸ¥çœ‹ã€‚</p>\n<h3 id=\"low-overhead-heap-profiling\"><a class=\"markdownIt-Anchor\" href=\"#low-overhead-heap-profiling\">#</a> Low-Overhead Heap Profiling</h3>\n<p>å…è´¹çš„ä½è€—èƒ½é£è¡Œè®°å½•ä»ªå’Œå †åˆ†æä»ªã€‚</p>\n<p>é€šè¿‡ <code>JVMTI</code>  çš„ <code>SampledObjectAlloc</code>  å›è°ƒæä¾›äº†ä¸€ä¸ªå¼€é”€ä½çš„ <code>heap</code>  åˆ†ææ–¹å¼æä¾›ä¸€ä¸ªä½å¼€é”€çš„ï¼Œä¸ºäº†æ’é”™ <code>java</code>  åº”ç”¨é—®é¢˜ï¼Œä»¥åŠ <code>JVM</code>  é—®é¢˜çš„æ•°æ®æ”¶é›†æ¡†æ¶ã€‚<br>\nå…·æœ‰ä¸€ä¸‹åŠŸèƒ½:</p>\n<ul>\n<li>æä¾›ç”¨äºç”Ÿäº§å’Œæ¶ˆè´¹æ•°æ®ä½œä¸ºäº‹ä»¶çš„ <code>API</code></li>\n<li>æä¾›ç¼“å­˜æœºåˆ¶å’ŒäºŒè¿›åˆ¶æ•°æ®æ ¼å¼</li>\n<li>å…è®¸äº‹ä»¶é…ç½®å’Œäº‹ä»¶è¿‡æ»¤</li>\n<li>æä¾› <code>OS</code> , <code>JVM</code>  å’Œ <code>JDK</code>  åº“çš„äº‹ä»¶</li>\n</ul>\n<h3 id=\"flight-recorder\"><a class=\"markdownIt-Anchor\" href=\"#flight-recorder\">#</a> Flight Recorder</h3>\n<p><code>Flight Recorder</code>  æºè‡ªé£æœºçš„é»‘ç›’å­ã€‚  <code>Flight Recorder</code>  ä»¥å‰æ˜¯å•†ä¸šç‰ˆçš„ç‰¹æ€§ï¼Œåœ¨ <code>java11</code>  å½“ä¸­å¼€æºå‡ºæ¥ï¼Œå®ƒå¯ä»¥å¯¼å‡ºäº‹ä»¶åˆ°æ–‡ä»¶ä¸­ï¼Œä¹‹åå¯ä»¥ç”¨ <code>Java Mission Control</code>  æ¥åˆ†æã€‚</p>\n<p>ä¸¤ç§å¯åŠ¨æ–¹å¼:</p>\n<p>å¯ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶é…ç½® <code>java -XX:StartFlightRecording</code> <br>\n åº”ç”¨å¯åŠ¨ä¹‹åï¼Œä½¿ç”¨ <code>jcmd</code>  æ¥å½•åˆ¶ï¼Œå¦‚ä¸‹ä»£ç :</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ jcmd &lt;pid&gt; JFR.start  <span class=\"comment\"># å¯åŠ¨è®°å½•ä»ª</span></span><br><span class=\"line\">$ jcmd &lt;pid&gt; JFR.dump.filename=recording.jfr  <span class=\"comment\"># å°†è®°å½•å†…å®¹ä¿å­˜åˆ°æ–‡ä»¶é‡Œ</span></span><br><span class=\"line\">$ jcmd &lt;pid&gt; JFR.stop  <span class=\"comment\"># åœæ­¢è®°å½•ä»ª</span></span><br></pre></td></tr></table></figure>\n<p>ä¸è¿‡åœ¨  <code>jdk11</code>  æ˜¯æ²¡åŠæ³•æŸ¥çœ‹  <code>jfr</code>  çš„ã€‚å¦‚æœæƒ³çœ‹ï¼Œå®‰è£…  <code>jdk12</code>  å§ã€‚ ä¸ï¼Œå¯ä»¥è¯•è¯•  <code>jdk16</code>  ,   <code>jdk16</code>  ä¹Ÿæ˜¯ <code>LTS</code>  ç‰ˆæœ¬ï¼ãƒ»</p>\n<blockquote>\n<p>JFR æ˜¯ä¸€å¥—é›†æˆè¿›å…¥ JDKã€JVM å†…éƒ¨çš„äº‹ä»¶æœºåˆ¶æ¡†æ¶ï¼Œé€šè¿‡è‰¯å¥½æ¶æ„å’Œè®¾è®¡çš„æ¡†æ¶ï¼Œç¡¬ä»¶å±‚é¢çš„æè‡´ä¼˜åŒ–ï¼Œç”Ÿäº§ç¯å¢ƒçš„å¹¿æ³›éªŒè¯ï¼Œå®ƒå¯ä»¥åšåˆ°æè‡´çš„å¯é å’Œä½å¼€é”€ã€‚åœ¨ SPECjbb2015 ç­‰åŸºå‡†æµ‹è¯•ä¸­ï¼ŒJFR çš„æ€§èƒ½å¼€é”€æœ€å¤§ä¸è¶…è¿‡ 1%ï¼Œæ‰€ä»¥ï¼Œå·¥ç¨‹å¸ˆå¯ä»¥åŸºæœ¬æ²¡æœ‰å¿ƒç†è´Ÿæ‹…åœ°åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼çš„ç”Ÿäº§ç³»ç»Ÿä½¿ç”¨ï¼Œè¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥éšæ—¶ä¸»åŠ¨å¼€å¯ JFR è¿›è¡Œç‰¹å®šè¯Šæ–­ï¼Œä¹Ÿå¯ä»¥è®©ç³»ç»Ÿé•¿æœŸè¿è¡Œ JFR, ç”¨ä»¥åœ¨å¤æ‚ç¯å¢ƒä¸­è¿›è¡Œ &quot;After-the-fact&quot; åˆ†æã€‚è¿˜éœ€è¦è‹¦æ¼é‡ç°éšæœºé—®é¢˜å—ï¼ŸJFR è®©é—®é¢˜ç®€åŒ–äº†å¾ˆå¤š<br>\nåœ¨ä¿è¯ä½å¼€é”€çš„åŸºç¡€ä¸Šï¼ŒJFR æä¾›çš„èƒ½åŠ›ä¹Ÿä»¤äººçœ¼å‰ä¸€äº®ï¼Œä¾‹å¦‚ï¼šæˆ‘ä»¬æ— éœ€ BCI å°±å¯ä»¥è¿›è¡Œ Object Allocation Profilingï¼Œ ç»ˆäºä¸ç”¨æ‹…å¿ƒ BTrace ä¹‹ç±»æŠŠè¿›ç¨‹ææŒ‚äº†ã€‚å¯¹é”ç«äº‰ã€é˜»å¡ã€å»¶è¿Ÿï¼ŒJVM GCã€SafePoint ç­‰é¢†åŸŸï¼Œè¿›è¡Œéå¸¸ç»†ç²’åº¦åˆ†æã€‚ç”šè‡³æ·±å…¥ JIT Compiler å†…éƒ¨ï¼Œå…¨é¢æŠŠæ¡çƒ­ç‚¹æ–¹æ³•ã€å†…è”ã€é€†ä¼˜åŒ–ç­‰ç­‰ã€‚JFR æä¾›äº†æ ‡å‡†çš„ Java,C++ ç­‰æ‰©å±• API, å¯ä»¥ä¸å„ç§å±‚é¢çš„åº”ç”¨è¿›è¡Œå®šåˆ¶ã€é›†æˆï¼Œä¸ºå¤æ‚çš„ä¼ä¸šåº”ç”¨æ ˆæˆ–è€…å¤æ‚çš„åˆ†å¸ƒå¼åº”ç”¨ï¼Œæä¾› All-in-One è§£å†³æ–¹æ¡ˆã€‚è€Œè¿™ä¸€åˆ‡éƒ½æ˜¯å†…å»ºåœ¨ JDK å’Œ JVM å†…éƒ¨çš„ï¼Œå¹¶ä¸éœ€è¦é¢å¤–çš„ä¾èµ–ï¼Œå¼€ç®±å³ç”¨ã€‚</p>\n</blockquote>\n<h2 id=\"æ–°åŠŸèƒ½\"><a class=\"markdownIt-Anchor\" href=\"#æ–°åŠŸèƒ½\">#</a> æ–°åŠŸèƒ½</h2>\n<h3 id=\"httpclient\"><a class=\"markdownIt-Anchor\" href=\"#httpclient\">#</a> HttpClient</h3>\n<p><code>JDK 9</code>  å¼€å§‹å¼•å…¥ <code>HttpClient API</code>  æ¥å¤„ç† <code>HTTP</code>  è¯·æ±‚ã€‚ ä» <code>JDK 11</code>  å¼€å§‹ï¼Œè¿™ä¸ªãƒ»æ­£å¼è¿›å…¥æ ‡å‡†åº“åŒ…ã€‚<br>\nå‚è€ƒç½‘å€ï¼š<span class=\"exturl\" data-url=\"aHR0cDovL29wZW5qZGsuamF2YS5uZXQvZ3JvdXBzL25ldC9odHRwY2xpZW50L2ludHJvLmh0bWw=\">http://openjdk.java.net/groups/net/httpclient/intro.html</span></p>\n<p><code>HttpClient</code>  å…·æœ‰ä»¥ä¸‹ç‰¹æ€§:</p>\n<ul>\n<li>æ”¯æŒ  <code>HTTP1.1</code>  å’Œ  <code>HTTP2</code> ,  <code>websocket</code>  åè®®</li>\n<li>æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ç¼–ç¨‹æ¨¡å‹</li>\n<li>å°†è¯·æ±‚å’Œå“åº”ä¸»ä½“ä½œä¸ºå“åº”å¼æµ ( <code>reactive-streams</code> ) å¤„ç†ï¼Œå¹¶ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼</li>\n<li>è¦å‘é€ <code>http</code>  è¯·æ±‚ï¼Œé¦–å…ˆè¦ä½¿ç”¨å…¶æ„å»ºå™¨åˆ›å»ºä¸€ä¸ª <code>HttpClient</code> ã€‚è¿™ä¸ªæ„å»ºå™¨èƒ½å¤Ÿé…ç½®æ¯ä¸ªå®¢æˆ·ç«¯çš„çŠ¶æ€ï¼š\n<ul>\n<li>é¦–é€‰åè®®ç‰ˆæœ¬ (  <code>HTTP/1.1</code>  æˆ–  <code>HTTP/2</code>  )</li>\n<li>æ˜¯å¦è·Ÿéšé‡å®šå‘</li>\n<li>ä»£ç†</li>\n<li>èº«ä»½éªŒè¯</li>\n</ul>\n</li>\n</ul>\n<p>ä¸€æ—¦æ„å»ºå®Œæˆï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>HttpClient</code>  å‘é€å¤šä¸ªè¯·æ±‚ã€‚</p>\n<h4 id=\"httprequest\"><a class=\"markdownIt-Anchor\" href=\"#httprequest\">#</a> HttpRequest</h4>\n<p><code>HttpRequest</code>  æ˜¯ç”±å®ƒçš„æ„å»ºå™¨åˆ›å»ºçš„ã€‚è¯·æ±‚çš„æ„å»ºå™¨å¯ç”¨äºè®¾ç½®:</p>\n<ul>\n<li>è¯·æ±‚ <code>URI</code></li>\n<li>è¯·æ±‚ <code>Method</code>  (  <code>GET</code> ,  <code>PUT</code> ,  <code>POST</code>  )</li>\n<li>è¯·æ±‚ä¸»ä½“ (å¦‚æœæœ‰)</li>\n<li>è¶…æ—¶æ—¶é—´</li>\n<li>è¯·æ±‚å¤´</li>\n</ul>\n<p><code>HttpRequest</code>  æ„å»ºä¹‹åæ˜¯ä¸å¯å˜çš„ï¼Œä½†å¯ä»¥å‘é€å¤šæ¬¡ã€‚</p>\n<h4 id=\"synchronous-or-asynchronous\"><a class=\"markdownIt-Anchor\" href=\"#synchronous-or-asynchronous\">#</a> Synchronous or Asynchronous</h4>\n<p>è¯·æ±‚æ—¢å¯ä»¥åŒæ­¥å‘é€ï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥å‘é€ã€‚å½“ç„¶åŒæ­¥çš„ <code>API</code>  ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ç›´åˆ° <code>HttpResponse</code>  å¯ç”¨ã€‚å¼‚æ­¥ <code>API</code>  ç«‹å³è¿”å›ä¸€ä¸ª <code>CompletableFuture</code> ï¼Œå½“ <code>HttpResponse</code>  å¯ç”¨æ—¶ï¼Œå®ƒå°†è·å– <code>HttpResponse</code>  å¹¶æ‰§è¡Œåç»­å¤„ç†ã€‚</p>\n<h4 id=\"data-as-reactive-streams\"><a class=\"markdownIt-Anchor\" href=\"#data-as-reactive-streams\">#</a> Data as reactive-streams</h4>\n<p>è¯·æ±‚å’Œå“åº”çš„ä¸»ä½“ä½œä¸ºå“åº”å¼æµ (å…·æœ‰éé˜»å¡èƒŒå‹çš„å¼‚æ­¥æ•°æ®æµ) ä¾›å¤–éƒ¨ä½¿ç”¨ã€‚ <code>HttpClient</code>  å®é™…ä¸Šæ˜¯è¯·æ±‚æ­£æ–‡çš„è®¢é˜…è€…å’Œå“åº”æ­£æ–‡å­—èŠ‚çš„å‘å¸ƒè€…ã€‚ <code>BodyHandler</code>  æ¥å£å…è®¸åœ¨æ¥æ”¶å®é™…å“åº”ä½“ä¹‹å‰æ£€æŸ¥å“åº”ä»£ç å’ŒæŠ¥å¤´ï¼Œå¹¶è´Ÿè´£åˆ›å»ºå“åº” <code>BodySubscriber</code> ã€‚</p>\n<p><code>HttpRequest</code>  å’Œ <code>HttpResponse</code>  ç±»å‹æä¾›äº†è®¸å¤šä¾¿åˆ©çš„å·¥å‚æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºè¯·æ±‚å‘å¸ƒè€…å’Œå“åº”è®¢é˜…è€…ï¼Œä»¥å¤„ç†å¸¸è§çš„ä¸»ä½“ç±»å‹ï¼Œå¦‚æ–‡ä»¶ã€å­—ç¬¦ä¸²å’Œå­—èŠ‚ã€‚è¿™äº›ä¾¿åˆ©çš„å®ç°è¦ä¹ˆç´¯ç§¯æ•°æ®ï¼Œç›´åˆ°å¯ä»¥åˆ›å»ºæ›´é«˜çº§åˆ«çš„ <code>Java</code>  ç±»å‹ï¼ˆå¦‚ <code>String</code> ï¼‰ï¼Œè¦ä¹ˆå°±æ–‡ä»¶æµä¼ è¾“æ•°æ®ã€‚ <code>BodySubscriber</code>  å’Œ <code>BodyPublisher</code>  æ¥å£å¯ä»¥å®ç°ä¸ºè‡ªå®šä¹‰ååº”æµå¤„ç†æ•°æ®ã€‚</p>\n<p><code>HttpRequest</code>  å’Œ <code>HttpResponse</code>  è¿˜æä¾›äº†è½¬æ¢å™¨ï¼Œç”¨äºå°†  <code>java.util.concurrent.Flow</code>  çš„  <code>Publisher/Subscriber</code>  ç±»å‹è½¬æ¢ä¸º  <code>HTTP Client</code>  çš„  <code>BodyPublisher/BodySubscriber</code>  ç±»å‹ã€‚</p>\n<h4 id=\"è¯·æ±‚åè®®-http2\"><a class=\"markdownIt-Anchor\" href=\"#è¯·æ±‚åè®®-http2\">#</a> è¯·æ±‚åè®® HTTP/2</h4>\n<p><code>Java HTTP Client</code>  æ”¯æŒ  <code>HTTP/1.1</code>  å’Œ  <code>HTTP/2</code> ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å°†ä½¿ç”¨  <code>HTTP/2</code>  å‘é€è¯·æ±‚ã€‚å‘é€åˆ°å°šä¸æ”¯æŒ  <code>HTTP/2 </code> çš„æœåŠ¡å™¨çš„è¯·æ±‚å°†è‡ªåŠ¨é™çº§ä¸º  <code>HTTP/1.1</code> ã€‚</p>\n<p>ä»¥ä¸‹æ˜¯ <code>HTTP/2</code>  å¸¦æ¥çš„ä¸»è¦æ”¹è¿›:</p>\n<ul>\n<li>æ ‡å¤´å‹ç¼©ã€‚ HTTP/2 ä½¿ç”¨ HPACK å‹ç¼©ï¼Œä»è€Œå‡å°‘äº†å¼€é”€ã€‚</li>\n<li>ä¸æœåŠ¡å™¨çš„å•ä¸€è¿æ¥å‡å°‘äº†å»ºç«‹å¤šä¸ª TCP è¿æ¥æ‰€éœ€çš„å¾€è¿”æ¬¡æ•°ã€‚</li>\n<li>å¤šè·¯å¤ç”¨ã€‚ åœ¨åŒä¸€è¿æ¥ä¸Šï¼ŒåŒæ—¶å…è®¸å¤šä¸ªè¯·æ±‚ã€‚</li>\n<li>æœåŠ¡å™¨æ¨é€ã€‚ å¯ä»¥å°†å…¶ä»–å°†æ¥éœ€è¦çš„èµ„æºå‘é€ç»™å®¢æˆ·ç«¯ã€‚</li>\n<li>äºŒè¿›åˆ¶æ ¼å¼ã€‚ æ›´ç´§å‡‘ã€‚</li>\n</ul>\n<p>ç”±äº <code>HTTP/2</code>  æ˜¯é»˜è®¤çš„é¦–é€‰åè®®ï¼Œå¹¶ä¸”åœ¨éœ€è¦çš„åœ°æ–¹æ— ç¼åœ°å®ç°å›é€€åˆ° <code>HTTP/1.1</code> ï¼Œé‚£ä¹ˆå½“ <code>HTTP/2</code>  è¢«æ›´å¹¿æ³›åœ°éƒ¨ç½²æ—¶ï¼Œ <code>Java HTTP</code>  å®¢æˆ·ç«¯å°±æ— éœ€ä¿®æ­£å®ƒçš„åº”ç”¨ä»£ç ã€‚</p>\n<p>å…·ä½“çš„ <code>Java Doc</code>  å¯ä»¥å‚è€ƒ: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vamF2YS9qYXZhc2UvMTEvZG9jcy9hcGkvamF2YS5uZXQuaHR0cC9qYXZhL25ldC9odHRwL3BhY2thZ2Utc3VtbWFyeS5odG1s\">https://docs.oracle.com/en/java/javase/11/docs/api/java.net.http/java/net/http/package-summary.html</span></p>\n<p>çœ‹äº†  <code>Java Doc</code> , æ„Ÿè§‰ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ã€‚è¿™é‡Œå°±ä¸ä¸¾ä¾‹äº†ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥è‡ªè¡Œæ·±å…¥ç ”ç©¶ä¸€ä¸‹ã€‚</p>\n<h3 id=\"æºä»£ç ç›´æ¥æ‰§è¡Œ\"><a class=\"markdownIt-Anchor\" href=\"#æºä»£ç ç›´æ¥æ‰§è¡Œ\">#</a> æºä»£ç ç›´æ¥æ‰§è¡Œ</h3>\n<p>ä¸€ä¸ªå•æ–‡ä»¶æºä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå•ç‹¬çš„ <code>java</code>  æ–‡ä»¶ï¼Œæœ‰ <code>main</code>  æ–¹æ³•ï¼Œä¸”åªä¾èµ– <code>jdk</code>  ç±»åº“ä»¥åŠè‡ªå·±æ–‡ä»¶å†…éƒ¨å®šä¹‰çš„ç±»ï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>java</code>  æ‰§è¡Œè€Œæ— éœ€å…ˆç¼–è¯‘å†æ‰§è¡Œç¼–è¯‘åçš„ <code>class</code>  æ–‡ä»¶äº†ã€‚</p>\n<p>ä½ å¯èƒ½é—®äº†ï¼Œæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘å¹³æ—¶ä¹Ÿä¸å…³ç³»å®ƒæ˜¯å¦ç”Ÿæˆäº† <code>class</code>  æ–‡ä»¶ã€‚</p>\n<p>å¦‚æœä½ æ˜¯åšæ•°æ®ç›¸å…³çš„å·¥ä½œï¼Œå¯èƒ½éœ€è¦å†™ä¸€äº›è„šæœ¬çš„æ—¶å€™ï¼Œè¿™å´æ˜¯è½»æ¾äº†å¾ˆå¤šã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  learn git:(master) âœ— ll</span><br><span class=\"line\">total 8</span><br><span class=\"line\">-rw-r--r--  1 wangxiyue  staff   411B Nov  9 22:58 SourceCodeExecDemo.java</span><br><span class=\"line\">âœ  learn git:(master) âœ— java SourceCodeExecDemo.java</span><br><span class=\"line\">1.è§£ææ•°æ®æ ¼å¼.....</span><br><span class=\"line\">2.å¤„ç†æ•°æ®.....</span><br><span class=\"line\">3.é‡ç»„æ•°æ®.....</span><br><span class=\"line\">âœ  learn git:(master) âœ— ll                          </span><br><span class=\"line\">total 8</span><br><span class=\"line\">-rw-r--r--  1 wangxiyue  staff   411B Nov  9 22:58 SourceCodeExecDemo.java</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ç¡®å®æ²¡æœ‰  <code>class</code>  æ–‡ä»¶ç”Ÿæˆã€‚</p>\n<h3 id=\"å®Œå…¨æ”¯æŒlinuxå®¹å™¨\"><a class=\"markdownIt-Anchor\" href=\"#å®Œå…¨æ”¯æŒlinuxå®¹å™¨\">#</a> å®Œå…¨æ”¯æŒ Linux å®¹å™¨</h3>\n<p>åœ¨ <code>Docker</code>  å®¹å™¨ä¸­è¿è¡Œ <code>Java</code>  åº”ç”¨ç¨‹åºä¸€ç›´å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨å®¹å™¨ä¸­è¿è¡Œçš„ <code>JVM</code>  ç¨‹åºåœ¨è®¾ç½®å†…å­˜å¤§å°å’Œ <code>CPU</code>  ä½¿ç”¨ç‡åï¼Œä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚è¿™æ˜¯å› ä¸º <code>Java</code>  åº”ç”¨ç¨‹åºæ²¡æœ‰æ„è¯†åˆ°å®ƒæ­£åœ¨å®¹å™¨ä¸­è¿è¡Œã€‚éšç€ <code>Java10</code>  çš„å‘å¸ƒï¼Œè¿™ä¸ªé—®é¢˜æ€»ç®—å¾—ä»¥è§£è¯€ï¼Œ <code>JVM</code>  ç°åœ¨å¯ä»¥è¯†åˆ«ç”±å®¹å™¨æ§åˆ¶ç»„ ( <code>cgroups</code> ) è®¾ç½®çš„çº¦æŸï¼Œå¯ä»¥åœ¨å®¹å™¨ä¸­ä½¿ç”¨å†…å­˜å’Œ <code>CPU</code>  çº¦æŸæ¥ç›´æ¥ç®¡ç† <code>Java</code>  åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…æ‹¬:</p>\n<ul>\n<li>éµå®ˆå®¹å™¨ä¸­è®¾ç½®çš„å†…å­˜é™åˆ¶</li>\n<li>åœ¨å®¹å™¨ä¸­è®¾ç½®å¯ç”¨çš„ <code>CPU</code></li>\n<li>åœ¨å®¹å™¨ä¸­è®¾ç½® <code>CPU</code>  çº¦æŸ</li>\n</ul>\n<h3 id=\"æ”¯æŒunicode-10\"><a class=\"markdownIt-Anchor\" href=\"#æ”¯æŒunicode-10\">#</a> æ”¯æŒ Unicode 10</h3>\n<p><code>Unicode 10</code>  æ–°å¢äº† <code>8518</code>  ä¸ªå­—ç¬¦ï¼Œæ€»è®¡è¾¾åˆ°äº† <code>136690</code>  ä¸ªå­—ç¬¦ã€‚åŒ…æ‹¬ <code>56</code>  ä¸ªæ–°çš„ <code>emoji</code>  è¡¨æƒ…ç¬¦å·ã€‚</p>\n<p><code>JDK11</code>  åœ¨ <code>java.lang</code>  ä¸‹å¢åŠ äº† 4 ä¸ªç±»æ¥å¤„ç†:</p>\n<ul>\n<li><code>CharacterData00.class</code></li>\n<li><code>CharacterData01.class</code></li>\n<li><code>CharacterData02.class</code></li>\n<li><code>CharacterData0E.class</code></li>\n</ul>\n<h3 id=\"æ–°æ”¯æŒçš„åŠ å¯†ç®—æ³•\"><a class=\"markdownIt-Anchor\" href=\"#æ–°æ”¯æŒçš„åŠ å¯†ç®—æ³•\">#</a> æ–°æ”¯æŒçš„åŠ å¯†ç®—æ³•</h3>\n<p><code>Java</code>  å®ç°äº† <code>RFC7539</code>  ä¸­æŒ‡å®šçš„ <code>ChaCha20</code>  å’Œ <code>Poly1305</code>  ä¸¤ç§åŠ å¯†ç®—æ³•ï¼Œä»£æ›¿ <code>RC4</code> ã€‚<br>\n <code>RFC7748</code>  å®šä¹‰çš„å¯†é’¥åå•†æ–¹æ¡ˆæ›´é«˜æ•ˆï¼Œæ›´å®‰å…¨ï¼Œ <code>JDK</code>  å¢åŠ äº†ä¸¤ä¸ªæ–°çš„æ¥å£ <code>XECPublicKey</code>  å’Œ <code>XECPrivateKey</code> ã€‚</p>\n<h2 id=\"åƒåœ¾å›æ”¶å™¨\"><a class=\"markdownIt-Anchor\" href=\"#åƒåœ¾å›æ”¶å™¨\">#</a> åƒåœ¾å›æ”¶å™¨</h2>\n<h3 id=\"zgc\"><a class=\"markdownIt-Anchor\" href=\"#zgc\">#</a> ZGC</h3>\n<p>å¯ç”¨æ–¹æ³•ï¼š <code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code></p>\n<p>è¯´æ˜ï¼š <code>ZGC</code> , <code> A Scalable Low-Latency Garbage collector</code> (  <code>Experimental</code> ) ï¼Œä¸€ä¸ªå¯ä¼¸ç¼©çš„ä½å»¶æ—¶çš„åƒåœ¾å›æ”¶å™¨ã€‚ <code>GC</code>  æš‚åœæ—¶é—´ä¸ä¼šè¶…è¿‡ <code>10ms</code> ï¼Œæ—¢èƒ½å¤„ç†å‡ ç™¾å…†çš„å°å †ï¼Œä¹Ÿèƒ½å¤„ç†å‡ ä¸ª <code>T</code>  çš„å¤§å †ã€‚å’Œ <code>G1</code>  ç›¸æ¯”ï¼Œåº”ç”¨ååèƒ½åŠ›ä¸ä¼šä¸‹é™è¶…è¿‡ <code>15%</code> ï¼Œä¸ºæœªæ¥çš„ <code>GC</code>  åŠŸèƒ½å’Œåˆ©ç”¨ <code>colord</code>  æŒ‡é’ˆä»¥åŠ <code>Load barriers</code>  ä¼˜åŒ–å¥ å®šäº†åŸºç¡€ã€‚åˆå§‹åªæ”¯æŒ <code>64</code>  ä½ç³»ç»Ÿã€‚</p>\n<p><code>ZGC</code>  çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šæ”¯æŒ <code>TB</code>  çº§å†…å­˜å®¹é‡ï¼Œæš‚åœæ—¶é—´ä½ ( <code>&lt;10ms</code> )ï¼Œå¯¹æ•´ä¸ªç¨‹åºååé‡çš„å½±å“å°äº <code>15%</code> ã€‚å°†æ¥è¿˜å¯ä»¥æ‰© å±•å®ç°æœºåˆ¶ï¼Œä»¥æ”¯æŒä¸å°‘ä»¤äººå…´å¥‹çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¤šå±‚å † (å³çƒ­å¯¹è±¡ç½®äº <code>DRAM</code>  å’Œå†·å¯¹è±¡ç½®äº <code>NVMe</code>  é—ªå­˜)ï¼Œæˆ–å‹ç¼©å †ã€‚</p>\n<p><code>GC</code>  æ˜¯ <code>java</code>  ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œå½“ <code>GC</code>  åœé¡¿å¤ªé•¿ï¼Œå°±ä¼šå¼€å§‹å½±å“åº”ç”¨çš„å“åº”æ—¶é—´ã€‚æ¶ˆé™¤æˆ–è€…å‡å°‘ <code>GC</code>  åœé¡¿æ—¶é•¿ï¼Œ <code>java</code>  å°†æœ‰å¯èƒ½åœ¨æ›´å¹¿æ³›çš„åº”ç”¨åœºæ™¯ä¸­æˆé•¿ä¸ºä¸€ä¸ªæ›´æœ‰å¸å¼•åŠ›çš„å¹³å°ã€‚æ­¤å¤–ï¼Œç°ä»£ç³»ç»Ÿä¸­å¯ç”¨å†…å­˜ä¸æ–­å¢é•¿ï¼Œç”¨æˆ·å’Œç¨‹åºå‘˜å¸Œæœ› <code>JVM</code>  èƒ½å¤Ÿä»¥é«˜æ•ˆçš„æ–¹å¼å……åˆ†åˆ©ç”¨è¿™äº›å†…å­˜ï¼Œå¹¶ä¸”æ— éœ€é•¿æ—¶é—´çš„ <code>GC</code>  æš‚åœæ—¶é—´ã€‚</p>\n<p><code>ZGC</code>  æ˜¯ä¸€ä¸ªå¹¶å‘ï¼ŒåŸºäº <code>region</code> , å‹ç¼©å‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåªæœ‰ <code>root</code>  æ‰«æé˜¶æ®µä¼š <code>STW</code> , å› æ­¤ <code>GC</code>  åœé¡¿æ—¶é—´ä¸ä¼šéšç€å †çš„å¢é•¿å’Œå­˜æ´»å¯¹è±¡çš„å¢é•¿è€Œå˜é•¿ã€‚</p>\n<h3 id=\"epsilon\"><a class=\"markdownIt-Anchor\" href=\"#epsilon\">#</a> Epsilon</h3>\n<p>å®éªŒæ€§è´¨ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚</p>\n<p>å¯ç”¨æ–¹æ³•ï¼š <code>-XX:+UnlockExperimentalVMOptions -XX:+UseEpsilonGC</code></p>\n<p>è¯´æ˜ï¼šå¼€å‘ä¸€ä¸ªå¤„ç†å†…å­˜åˆ†é…ä½†ä¸å®ç°ä»»ä½•å®é™…å†…å­˜å›æ”¶æœºåˆ¶çš„ <code>GC</code> , ä¸€æ—¦å¯ç”¨å †å†…å­˜ç”¨å®Œï¼Œ <code>JVM</code>  å°±ä¼šé€€å‡ºï¼Œå¦‚æœæœ‰ <code>System.gc()</code>  è°ƒç”¨ï¼Œå®é™…ä¸Šä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ (è¿™ç§åœºæ™¯ä¸‹å’Œ <code>-XX:+DisableExplicitGC</code>  æ•ˆæœä¸€æ ·), å› ä¸ºæ²¡æœ‰å†…å­˜å›æ”¶ï¼Œè¿™ä¸ªå®ç°å¯èƒ½ä¼šè­¦å‘Šç”¨æˆ·å°è¯•å¼ºåˆ¶ <code>GC</code>  æ˜¯å¾’åŠ³çš„ã€‚</p>\n<p>ä¸»è¦ç”¨é€”å¦‚ä¸‹:</p>\n<ul>\n<li>æ€§èƒ½æµ‹è¯• (å®ƒå¯ä»¥å¸®åŠ©è¿‡æ»¤æ‰ <code>GC</code>  å¼•èµ·çš„æ€§èƒ½å‡è±¡)</li>\n<li>å†…å­˜å‹åŠ›æµ‹è¯• (ä¾‹å¦‚ï¼ŒçŸ¥é“æµ‹è¯•ç”¨ä¾‹åº”è¯¥åˆ†é…ä¸è¶…è¿‡ <code>1GB</code>  çš„å†…å­˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>-Xmx1g -XX:+UseEpsilonGC</code> ï¼Œå¦‚æœç¨‹åºæœ‰é—®é¢˜ï¼Œåˆ™ç¨‹åºä¼šå´©æºƒã€‚</li>\n<li>éå¸¸çŸ­çš„ <code>JOB</code>  ä»»åŠ¡ (å¯¹äºè¿™ç§ä»»åŠ¡ï¼Œ <code>GC</code>  æ˜¯åœ¨æµªè´¹èµ„æº)</li>\n<li><code>VM</code>  æ¥å£æµ‹è¯•</li>\n<li><code>Last-drop</code>  å»¶è¿Ÿ &amp; ååæ”¹è¿›</li>\n</ul>\n<h3 id=\"æ›´å¥½çš„g1\"><a class=\"markdownIt-Anchor\" href=\"#æ›´å¥½çš„g1\">#</a> æ›´å¥½çš„ G1</h3>\n<p>å¯¹äº <code>G1 GC</code> , ç›¸æ¯”äº <code>JDK8</code> , å‡çº§åˆ° <code>JDK 11</code>  å³å¯å…è´¹äº«å—åˆ°ï¼šå¹¶è¡Œçš„ <code>Full GC</code> , å¿«é€Ÿçš„ <code>CardTable</code>  æ‰«æï¼Œè‡ªé€‚åº”çš„å †å ç”¨æ¯”ä¾‹è°ƒæ•´ ( <code>IHOP</code> ), åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µçš„ç±»å‹å¸è½½ç­‰ç­‰ã€‚è¿™äº›éƒ½æ˜¯é’ˆå¯¹ <code>G1</code>  çš„ä¸æ–­å¢å¼ºï¼Œå…¶ä¸­ä¸²è¡Œ <code>FullGC</code>  ç­‰ç”šè‡³æ˜¯æ›¾ç»è¢«å¹¿æ³›è¯Ÿç—…çš„çŸ­æ¿ï¼Œä½ ä¼šå‘ç° <code>GC</code>  é…ç½®å’Œè°ƒä¼˜åœ¨ <code>JDK11</code>  ä¸­è¶Šæ¥è¶Šæ–¹ä¾¿ã€‚</p>\n<h2 id=\"ç§»é™¤ä¸ä¸å†æ¨èä½¿ç”¨çš„ç±»åº“æˆ–åŠŸèƒ½\"><a class=\"markdownIt-Anchor\" href=\"#ç§»é™¤ä¸ä¸å†æ¨èä½¿ç”¨çš„ç±»åº“æˆ–åŠŸèƒ½\">#</a> ç§»é™¤ä¸ä¸å†æ¨èä½¿ç”¨çš„ç±»åº“æˆ–åŠŸèƒ½</h2>\n<p><code>Jdk9</code>  åˆ° <code>Jdk11</code> ï¼Œé™†ç»­ç§»é™¤äº†ä¸€äº›ç±»åº“æˆ–åŠŸèƒ½ã€‚</p>\n<h3 id=\"ç§»é™¤äº†java-eeå’Œcorba-moudles\"><a class=\"markdownIt-Anchor\" href=\"#ç§»é™¤äº†java-eeå’Œcorba-moudles\">#</a> ç§»é™¤äº† Java EE å’Œ CORBA Moudles</h3>\n<p>åœ¨ <code>java11</code>  ä¸­ç§»é™¤äº†ä¸å¤ªä½¿ç”¨çš„ <code>JavaEE</code>  æ¨¡å—å’Œ <code>CORBA</code>  æŠ€æœ¯ã€‚</p>\n<p><code>CORBA</code>  æ¥è‡ªäºäºŒåä¸–çºªä¹åå¹´ä»£ï¼Œ <code>Oracle</code>  è®¤ä¸ºï¼Œç°åœ¨ç”¨ <code>CORBA</code>  å¼€å‘ç°ä»£ <code>Java</code>  åº”ç”¨ç¨‹åºå·²ç»æ²¡æœ‰æ„ä¹‰äº†ï¼Œç»´æŠ¤ <code>CORBA</code>  çš„æˆæœ¬å·²ç»è¶…è¿‡äº†ä¿ç•™å®ƒå¸¦æ¥çš„å¥½å¤„ã€‚</p>\n<p>ä½†æ˜¯åˆ é™¤ <code>CORBA</code>  å°†ä½¿å¾—é‚£äº›ä¾èµ–äº <code>JDK</code>  æä¾›éƒ¨åˆ† <code>CORBAAPI</code>  çš„ <code>CORBA</code>  å®ç°æ— æ³•è¿è¡Œã€‚ç›®å‰è¿˜æ²¡æœ‰ç¬¬ä¸‰æ–¹ <code>CORBA</code>  ç‰ˆæœ¬ï¼Œä¹Ÿä¸ç¡®å®šæ˜¯å¦ä¼šæœ‰ç¬¬ä¸‰æ–¹æ„¿æ„æ¥æ‰‹ <code>CORBA API</code>  çš„ç»´æŠ¤å·¥ä½œã€‚</p>\n<p>åœ¨ <code>java11</code>  ä¸­å°† <code>java9</code>  æ ‡è®°åºŸå¼ƒçš„ <code>Java EE</code>  åŠ <code>CORBA</code>  æ¨¡å—ç§»é™¤æ‰ï¼Œå…·ä½“å¦‚ä¸‹:</p>\n<p><code>xml</code>  ç›¸å…³è¢«ç§»é™¤çš„ï¼š</p>\n<ul>\n<li><code>java.xml.ws</code></li>\n<li><code>java.xml.bind</code></li>\n<li><code>java.xml.ws</code></li>\n<li><code>java.xml.ws.annotation</code></li>\n<li><code>jdk.xml.bind</code></li>\n<li><code>jdk.xml.ws</code></li>\n</ul>\n<p>åªå‰©ä¸‹ <code>java.xml</code> ,  <code>java.xml.crypto.jdk.xml.dom</code>  è¿™å‡ ä¸ªæ¨¡å—ã€‚</p>\n<p>å…¶å®ƒè¢«ç§»é™¤çš„ Java EE å’Œ CORBA ç›¸å…³ç±»åº“:</p>\n<ul>\n<li><code>java.corba</code></li>\n<li><code>java.se.ee</code></li>\n<li><code>java.activation</code></li>\n<li><code>java.transaction</code>  (ä½†æ˜¯ <code>java11</code>  æ–°å¢äº†ä¸€ä¸ª <code>java.transaction.xa</code>  æ¨¡å—)</li>\n</ul>\n<h3 id=\"å…¶ä»–ç§»é™¤çš„ç±»åº“\"><a class=\"markdownIt-Anchor\" href=\"#å…¶ä»–ç§»é™¤çš„ç±»åº“\">#</a> å…¶ä»–ç§»é™¤çš„ç±»åº“</h3>\n<ul>\n<li><code>com.sun.awt.AWTUtilities</code></li>\n<li><code>sun.miss.Unsafe.defineClass</code></li>\n<li><code>Thread.destroy()</code>  ä»¥åŠ  <code>Thread.stop(Throwable)</code>  æ–¹æ³•</li>\n<li><code>sun.nio.ch.disableSystemWideOverlappingFileLockCheck</code>  å±æ€§</li>\n<li><code>sun.locale.formatasdefault</code>  å±æ€§</li>\n<li><code>jdk snmp</code>  æ¨¡å—</li>\n<li><code>javafx</code></li>\n<li><code>java Mission Control</code></li>\n<li><code>Root Certificates</code> : ä¸€äº›æ ¹è¯ä¹¦è¢«ç§»é™¤ï¼š <code>Baltimore Cybertrust Code Signing CA, SECOM Root Certificate, AOL and Swisscom Root Certificates</code></li>\n</ul>\n<p>å…¶ä¸­ï¼Œä½¿ç”¨ <code>java.lang.invoke.MethodHandles.Lookup.defineClass</code>  æ¥æ›¿ä»£ç§»é™¤çš„ <code>sun.miss.Unsafe.defineClass</code> ã€‚</p>\n<h3 id=\"å°†nashorn-javascriptæ ‡è®°ä¸ºä¸æ¨è\"><a class=\"markdownIt-Anchor\" href=\"#å°†nashorn-javascriptæ ‡è®°ä¸ºä¸æ¨è\">#</a> å°† Nashorn Javascript æ ‡è®°ä¸ºä¸æ¨è</h3>\n<p>å°† <code>Javascript</code>  å¼•æ“æ ‡è®°ä¸º <code>Deprecate</code> ï¼Œåç»­ç‰ˆæœ¬ä¼šç§»é™¤ï¼Œæœ‰éœ€è¦çš„å¯ä»¥è€ƒè™‘ä½¿ç”¨å¼€æºçš„ <code>GraalVM</code> ã€‚</p>\n<h3 id=\"å°†pack200-tools-and-apiæ ‡è®°ä¸ºä¸æ¨è\"><a class=\"markdownIt-Anchor\" href=\"#å°†pack200-tools-and-apiæ ‡è®°ä¸ºä¸æ¨è\">#</a> å°† Pack200 Tools and API æ ‡è®°ä¸ºä¸æ¨è</h3>\n<p><code>java11</code>  ä¸­å°† <code>pack200</code>  ä»¥åŠ <code>unpack200</code>  å·¥å…·ä»¥åŠ <code>java.tiljar</code>  ä¸­çš„ <code>Pack200 API</code>  æ ‡è®°ä¸º <code>Deprecate</code> ã€‚å› ä¸º <code>Pack200</code>  ä¸»è¦æ˜¯ç”¨æ¥å‹ç¼© <code>jar</code>  åŒ…çš„å·¥å…·ï¼Œç”±äºç½‘ç»œä¸‹è½½é€Ÿåº¦çš„æå‡ä»¥åŠ <code>java9</code>  å¼•å…¥æ¨¡å—åŒ–ç³»ç»Ÿä¹‹åä¸å†ä¾èµ– <code>Pack200</code> ï¼Œå› æ­¤è¿™ä¸ªç‰ˆæœ¬å°†å…¶æ ‡è®°ä¸º <code>Deprecate</code> ã€‚</p>\n<h2 id=\"é¢„å‘Š\"><a class=\"markdownIt-Anchor\" href=\"#é¢„å‘Š\">#</a> é¢„å‘Š</h2>\n<p>ç»§ <code>LTS JDK8</code>  ä¹‹åï¼Œåˆä¸€ <code>LTS</code> , ä½ ä¼šç”¨å—ï¼Ÿ <code>JDK16</code> , å®ƒæ¥äº†ã€‚</p>\n<h2 id=\"å¯¹äº†\"><a class=\"markdownIt-Anchor\" href=\"#å¯¹äº†\">#</a> å¯¹äº†</h2>\n<p><code>JDK11</code>  å†™  <code>JDK8</code>  çš„ä»£ç ï¼Ÿ</p>\n<p>ä»£ç å§‹ç»ˆæ˜¯ä»£ç ï¼Œå†™çš„å†å¤šï¼Œå†™ä¸æ‡‚ä½ æˆ‘ã€‚</p>\n<p>å¤šçœ‹ä¸€ç‚¹ï¼Œå°±æ¯”å…¶ä»–ä»¬å¤šæ‡‚ä¸€ç‚¹ã€‚æ‰€ä»¥ï¼Œä½ å…³ä¸å…³æ³¨æˆ‘ï¼Œé—®é¢˜ä¸å¤§ï¼</p>\n<p>äººæƒ…ä¸–æ•…ã€‚ä¸æ˜¯ä¸–æ•…ï¼Œå°±æ˜¯äº‹æ•…ã€‚é—®é¢˜çœŸçš„ä¸å¤§ã€‚</p>\n<p>æ–‡ä¸­æ‰€æœ‰ä»£ç ï¼Œåœ¨ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVhcm5famF2YS90cmVlL21hc3Rlci9meGJfamRrMTE=\">https://gitee.com/fangjiaxiaobai/learn_java/tree/master/fxb_jdk11</span></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/java/jdk/versions/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "JDK",
                "JDKç‰ˆæœ¬",
                "JDK11"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/06/BQ/LeetCode/0268-miss-number/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/06/BQ/LeetCode/0268-miss-number/",
            "title": "LC:268.ä¸¢å¤±çš„æ•°å­—",
            "date_published": "2021-11-06T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>ç»™å®šä¸€ä¸ªåŒ…å«  <code>[0, n]</code> Â ä¸­Â  <code>n</code> Â ä¸ªæ•°çš„æ•°ç»„  <code>nums</code>  ï¼Œæ‰¾å‡º  <code>[0, n]</code>  è¿™ä¸ªèŒƒå›´å†…æ²¡æœ‰å‡ºç°åœ¨æ•°ç»„ä¸­çš„é‚£ä¸ªæ•°ã€‚</p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šnums = [3,0,1]</span><br><span class=\"line\">è¾“å‡ºï¼š2</span><br><span class=\"line\">è§£é‡Šï¼šn = 3ï¼Œå› ä¸ºæœ‰ 3 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,3] å†…ã€‚2 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹ 2</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šnums = [0,1]</span><br><span class=\"line\">è¾“å‡ºï¼š2</span><br><span class=\"line\">è§£é‡Šï¼šn = 2ï¼Œå› ä¸ºæœ‰ 2 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,2] å†…ã€‚2 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-3\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-3\">#</a> ç¤ºä¾‹ 3</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šnums = [9,6,4,2,3,5,7,0,1]</span><br><span class=\"line\">è¾“å‡ºï¼š8</span><br><span class=\"line\">è§£é‡Šï¼šn = 9ï¼Œå› ä¸ºæœ‰ 9 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,9] å†…ã€‚8 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-4\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-4\">#</a> ç¤ºä¾‹ 4</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šnums = [0]</span><br><span class=\"line\">è¾“å‡ºï¼š1</span><br><span class=\"line\">è§£é‡Šï¼šn = 1ï¼Œå› ä¸ºæœ‰ 1 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,1] å†…ã€‚1 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n == nums.length</span><br><span class=\"line\">1 &lt;= n &lt;= 104</span><br><span class=\"line\">0 &lt;= nums[i] &lt;= n</span><br><span class=\"line\">nums ä¸­çš„æ‰€æœ‰æ•°å­—éƒ½ ç‹¬ä¸€æ— äºŒ</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¿›é˜¶\"><a class=\"markdownIt-Anchor\" href=\"#è¿›é˜¶\">#</a> è¿›é˜¶</h4>\n<p>ä½ èƒ½å¦å®ç°çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€ä»…ä½¿ç”¨é¢å¤–å¸¸æ•°ç©ºé—´çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ï¼Ÿ</p>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰268.ä¸¢å¤±çš„æ•°å­—\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvbWlzc2luZy1udW1iZXIv\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvbWlzc2luZy1udW1iZXIv\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰268.ä¸¢å¤±çš„æ•°å­—</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvc2luZ2xlLW51bWJlci8=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvc2luZ2xlLW51bWJlci8=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰287. å¯»æ‰¾é‡å¤æ•°\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZmluZC10aGUtZHVwbGljYXRlLW51bWJlci8=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZmluZC10aGUtZHVwbGljYXRlLW51bWJlci8=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰287. å¯»æ‰¾é‡å¤æ•°</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZmlyc3QtbWlzc2luZy1wb3NpdGl2ZS8=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZmlyc3QtbWlzc2luZy1wb3NpdGl2ZS8=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰765. æƒ…ä¾£ç‰µæ‰‹\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvY291cGxlcy1ob2xkaW5nLWhhbmRzLw==\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvY291cGxlcy1ob2xkaW5nLWhhbmRzLw==\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰765. æƒ…ä¾£ç‰µæ‰‹</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†æ\">#</a> åˆ†æ</h2>\n<p>ç®€å•ç±»å‹çš„é¢˜ç›®ã€‚<br>\nå…ˆæŠŠé¢˜ç›®è¯»æ¸…æ¥šï¼š<br>\nåŒºé—´ <code>[0,n]</code>  ä¸€å…±æœ‰ <code>n+1</code>  ä¸ªæ•°ï¼Œè€Œé¢˜ç›®ä¸­è¯´çš„æ˜¯  <code>[0,n]</code>  æ˜¯ <code>n</code>  ä¸ªæ•°çš„æ•°ç»„ï¼Œæ‰€ä»¥åªä¼šå°‘ <code>1</code>  ä¸ªæ•°å­—ã€‚</p>\n<h2 id=\"è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•\">#</a> è§£æ³•</h2>\n<h3 id=\"è§£æ³•ä¸€æ’åº\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸€æ’åº\">#</a> è§£æ³•ä¸€ï¼šæ’åº</h3>\n<p>å°†æ•°ç»„ <code>nums</code>  è¿›è¡Œæ’åºï¼Œæ‰¾åˆ° <code>nums[i]!=i</code>  çš„ä½ç½®ï¼Œå°±æ˜¯ç¼ºå°‘çš„é‚£ä¸ªæ•°ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">missingNumber</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = nums.length;</span><br><span class=\"line\">    Arrays.sort(nums);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nums[i] != i) <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è§£æ³•äºŒé¢å¤–æ•°ç»„\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•äºŒé¢å¤–æ•°ç»„\">#</a> è§£æ³•äºŒï¼šé¢å¤–æ•°ç»„</h3>\n<p>ç”±äº  <code>[0,n]</code>  æ˜¯æ•°å­—è¿ç»­çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„  <code>n+1</code>  é•¿åº¦çš„æ•°ç»„  <code>pos</code> ã€‚å°† <code>nums[i]</code>  ä½œä¸º <code>pos</code>  çš„ç´¢å¼•èµ‹å€¼ä¸º <code>1</code> ï¼Œä» <code>1</code>  å¼€å§‹éå† <code>pos</code>  æ•°ç»„ï¼Œ <code>pos[i]==0</code>  å³ä¸ºå°‘çš„é‚£ä¸ªæ•°å­—ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">missingNumber</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> pos[] = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[nums.length + <span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class=\"line\">        pos[nums[i]] = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; pos.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">1</span> != pos[i]) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è§£æ³•ä¸‰æ•°å­¦è®¡ç®—\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸‰æ•°å­¦è®¡ç®—\">#</a> è§£æ³•ä¸‰ï¼šæ•°å­¦è®¡ç®—</h3>\n<p>åŒºé—´ <code>[0,n]</code>  æ˜¯è¿ç»­çš„æ•°ç»„ï¼Œé‚£ä¹ˆåˆ©ç”¨ç­‰å·®æ•°åˆ—çš„æ€§è´¨å¯ä»¥ç®—å‡ºæ¥ <code>n</code>  ä¸ªæ•°çš„æ€»å’Œï¼Œå‡å» <code>nums</code>  æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œåˆ™å°±æ˜¯å°‘çš„é‚£ä¸ªæ•°ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">missingNumber</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = nums.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> cur = <span class=\"number\">0</span>, sum = n * (n + <span class=\"number\">1</span>) / <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i : nums) cur += i;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum - cur;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è§£æ³•å››äº¦æˆ–\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•å››äº¦æˆ–\">#</a> è§£æ³•å››ï¼šäº¦æˆ–</h3>\n<p>äº¦æˆ–è®¡ç®—ä½¿ç„¶ã€‚  <code>a^a=0</code> , <code>0^a=a</code> .</p>\n<p>æ‰€ä»¥å°†  <code>0...n</code>  å’Œ  <code>nums[0...n]</code>  è¿›è¡Œäº¦æˆ–è®¡ç®—ï¼Œåˆ™è®¡ç®—å‡ºæ¥çš„å€¼å°±æ˜¯ç¼ºå°‘çš„é‚£ä¸ªæ•°ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">missingNumber</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = nums.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ans = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt;= n; i++) ans ^= i;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i : nums) ans ^= i;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0042.trapping-rain-water/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0042.trapping-rain-water/",
            "title": "LC:42.æ¥é›¨æ°´",
            "date_published": "2021-11-04T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>ç»™å®šÂ  <code>n</code>  ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º  <code>1</code>  çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚</p>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1ï¼š</h3>\n<p><img data-src=\"/images/ac-code/42/demo.jpeg\" alt=\"\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šheight = [0,1,0,2,1,0,1,3,2,1,2,1]</span><br><span class=\"line\">è¾“å‡ºï¼š6</span><br><span class=\"line\">è§£é‡Šï¼šä¸Šé¢æ˜¯ç”±æ•°ç»„ [0,1,0,2,1,0,1,3,2,1,2,1] è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚ </span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹ 2ï¼š</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šheight = [4,2,0,3,2,5]</span><br><span class=\"line\">è¾“å‡ºï¼š9</span><br></pre></td></tr></table></figure>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n == height.length</span><br><span class=\"line\">1 &lt;= n &lt;= 2 * 104</span><br><span class=\"line\">0 &lt;= height[i] &lt;= 105</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰42.æ¥é›¨æ°´\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdHJhcHBpbmctcmFpbi13YXRlcg==\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdHJhcHBpbmctcmFpbi13YXRlcg==\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰42.æ¥é›¨æ°´</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰407.æ¥é›¨æ°´II\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdHJhcHBpbmctcmFpbi13YXRlci1paQ==\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdHJhcHBpbmctcmFpbi13YXRlci1paQ==\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰407.æ¥é›¨æ°´II</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h3 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h3>\n<div class=\"links\"><div class=\"item\" title=\"æ–¹å®¶å°ç™½-LeetCodeé¢˜è§£.407.æ¥é›¨æ°´II\" style=\"--block-color:#e0b971;\"><a href=\"https://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0407-trapping-rain-water-ii/\" class=\"image\" data-background-image=\"https://avatars.githubusercontent.com/u/22616214?v=4\"></a>\n          <div class=\"info\">\n          <a href=\"https://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0407-trapping-rain-water-ii/\" class=\"title\">æ–¹å®¶å°ç™½-LeetCodeé¢˜è§£.407.æ¥é›¨æ°´II</a>\n          <p class=\"desc\">æ—¥å¸¸ç§¯ç´¯çš„ä»£ç ï¼ŒçŸ¥è¯†ç‚¹, æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å­¦ä¹ ä¸å®ç°ï¼Œä»¥åŠä¾‹é¢˜åˆ†äº«</p>\n          </div></div></div>\n<h2 id=\"è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•\">#</a> è§£æ³•</h2>\n<h3 id=\"è§£æ³•ä¸€\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸€\">#</a> è§£æ³•ä¸€</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">trapRainWater</span><span class=\"params\">(<span class=\"keyword\">int</span>[][] heightMap)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (heightMap.length &lt;= <span class=\"number\">2</span> || heightMap[<span class=\"number\">0</span>].length &lt;= <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> m = heightMap.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = heightMap[<span class=\"number\">0</span>].length;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span>[][] visit = <span class=\"keyword\">new</span> <span class=\"keyword\">boolean</span>[m][n];</span><br><span class=\"line\">    PriorityQueue&lt;<span class=\"keyword\">int</span>[]&gt; pq = <span class=\"keyword\">new</span> PriorityQueue&lt;&gt;((o1, o2) -&gt; o1[<span class=\"number\">1</span>] - o2[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; m; ++i) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i == <span class=\"number\">0</span> || i == m - <span class=\"number\">1</span> || j == <span class=\"number\">0</span> || j == n - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                pq.offer(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[]&#123;i * n + j, heightMap[i][j]&#125;);</span><br><span class=\"line\">                visit[i][j] = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span>[] dirs = &#123;-<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!pq.isEmpty()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span>[] curr = pq.poll();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">0</span>; k &lt; <span class=\"number\">4</span>; ++k) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> nx = curr[<span class=\"number\">0</span>] / n + dirs[k];</span><br><span class=\"line\">            <span class=\"keyword\">int</span> ny = curr[<span class=\"number\">0</span>] % n + dirs[k + <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (nx &gt;= <span class=\"number\">0</span> &amp;&amp; nx &lt; m &amp;&amp; ny &gt;= <span class=\"number\">0</span> &amp;&amp; ny &lt; n &amp;&amp; !visit[nx][ny]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (curr[<span class=\"number\">1</span>] &gt; heightMap[nx][ny]) &#123;</span><br><span class=\"line\">                    res += curr[<span class=\"number\">1</span>] - heightMap[nx][ny];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                pq.offer(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[]&#123;nx * n + ny, Math.max(heightMap[nx][ny], curr[<span class=\"number\">1</span>])&#125;);</span><br><span class=\"line\">                visit[nx][ny] = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0407-trapping-rain-water-ii/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0407-trapping-rain-water-ii/",
            "title": "LC:407.æ¥é›¨æ°´II",
            "date_published": "2021-11-04T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>ç»™ä½ ä¸€ä¸ª  <code>m x n</code>  çš„çŸ©é˜µï¼Œå…¶ä¸­çš„å€¼å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œä»£è¡¨äºŒç»´é«˜åº¦å›¾æ¯ä¸ªå•å…ƒçš„é«˜åº¦ï¼Œè¯·è®¡ç®—å›¾ä¸­å½¢çŠ¶æœ€å¤šèƒ½æ¥å¤šå°‘ä½“ç§¯çš„é›¨æ°´ã€‚</p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1</h3>\n<p><img data-src=\"/images/ac-code/407/demo1.jpeg\" alt=\"\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥: heightMap = [[1,4,3,1,3,2],[3,2,1,3,2,4],[2,3,3,2,3,1]]</span><br><span class=\"line\">è¾“å‡º: 4</span><br><span class=\"line\">è§£é‡Š: ä¸‹é›¨åï¼Œé›¨æ°´å°†ä¼šè¢«ä¸Šå›¾è“è‰²çš„æ–¹å—ä¸­ã€‚æ€»çš„æ¥é›¨æ°´é‡ä¸º1+2+1=4ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹Â 2</h3>\n<p><img data-src=\"/images/ac-code/407/demo2.jpeg\" alt=\"\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥: heightMap = [[3,3,3,3,3],[3,2,2,2,3],[3,2,1,2,3],[3,2,2,2,3],[3,3,3,3,3]]</span><br><span class=\"line\">è¾“å‡º: 10</span><br></pre></td></tr></table></figure>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">m == heightMap.length</span><br><span class=\"line\">n == heightMap[i].length</span><br><span class=\"line\">1 &lt;= m, n &lt;= 200</span><br><span class=\"line\">0 &lt;= heightMap[i][j] &lt;= 2 * 104</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰407.æ¥é›¨æ°´II\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdHJhcHBpbmctcmFpbi13YXRlci1paQ==\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdHJhcHBpbmctcmFpbi13YXRlci1paQ==\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰407.æ¥é›¨æ°´II</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h3 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h3>\n<div class=\"links\"><div class=\"item\" title=\"æ–¹å®¶å°ç™½-LeetCodeé¢˜è§£-42.æ¥é›¨æ°´\" style=\"--block-color:#e0b971;\"><a href=\"http://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0042.trapping-rain-water/\" class=\"image\" data-background-image=\"https://avatars.githubusercontent.com/u/22616214?v=4\"></a>\n          <div class=\"info\">\n          <a href=\"http://fangjiaxiaobai.github.io/2021/11/04/BQ/LeetCode/0042.trapping-rain-water/\" class=\"title\">æ–¹å®¶å°ç™½-LeetCodeé¢˜è§£-42.æ¥é›¨æ°´</a>\n          <p class=\"desc\">æ—¥å¸¸ç§¯ç´¯çš„ä»£ç ï¼ŒçŸ¥è¯†ç‚¹, æ•°æ®ç»“æ„ä¸ç®—æ³•çš„å­¦ä¹ ä¸å®ç°ï¼Œä»¥åŠä¾‹é¢˜åˆ†äº«</p>\n          </div></div></div>\n<h2 id=\"è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•\">#</a> è§£æ³•</h2>\n<h3 id=\"è§£æ³•ä¸€\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸€\">#</a> è§£æ³•ä¸€</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">trapRainWater</span><span class=\"params\">(<span class=\"keyword\">int</span>[][] heightMap)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (heightMap.length &lt;= <span class=\"number\">2</span> || heightMap[<span class=\"number\">0</span>].length &lt;= <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> m = heightMap.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = heightMap[<span class=\"number\">0</span>].length;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span>[][] visit = <span class=\"keyword\">new</span> <span class=\"keyword\">boolean</span>[m][n];</span><br><span class=\"line\">    PriorityQueue&lt;<span class=\"keyword\">int</span>[]&gt; pq = <span class=\"keyword\">new</span> PriorityQueue&lt;&gt;((o1, o2) -&gt; o1[<span class=\"number\">1</span>] - o2[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; m; ++i) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; n; ++j) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i == <span class=\"number\">0</span> || i == m - <span class=\"number\">1</span> || j == <span class=\"number\">0</span> || j == n - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                pq.offer(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[]&#123;i * n + j, heightMap[i][j]&#125;);</span><br><span class=\"line\">                visit[i][j] = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span>[] dirs = &#123;-<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!pq.isEmpty()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span>[] curr = pq.poll();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> k = <span class=\"number\">0</span>; k &lt; <span class=\"number\">4</span>; ++k) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> nx = curr[<span class=\"number\">0</span>] / n + dirs[k];</span><br><span class=\"line\">            <span class=\"keyword\">int</span> ny = curr[<span class=\"number\">0</span>] % n + dirs[k + <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (nx &gt;= <span class=\"number\">0</span> &amp;&amp; nx &lt; m &amp;&amp; ny &gt;= <span class=\"number\">0</span> &amp;&amp; ny &lt; n &amp;&amp; !visit[nx][ny]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (curr[<span class=\"number\">1</span>] &gt; heightMap[nx][ny]) &#123;</span><br><span class=\"line\">                    res += curr[<span class=\"number\">1</span>] - heightMap[nx][ny];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                pq.offer(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[]&#123;nx * n + ny, Math.max(heightMap[nx][ny], curr[<span class=\"number\">1</span>])&#125;);</span><br><span class=\"line\">                visit[nx][ny] = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜",
                "æœ‰ç‚¹éš¾çš„ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/03/BQ/LeetCode/0367-valid-perfect-square/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/03/BQ/LeetCode/0367-valid-perfect-square/",
            "title": "LC:367.æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°",
            "date_published": "2021-11-03T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>ç»™å®šä¸€ä¸ª æ­£æ•´æ•°  <code>num</code>  ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœ  <code>num</code>  æ˜¯ä¸€ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼Œåˆ™è¿”å›  <code>true</code>  ï¼Œå¦åˆ™è¿”å›  <code>false</code>  ã€‚</p>\n<p>è¿›é˜¶ï¼šä¸è¦ ä½¿ç”¨ä»»ä½•å†…ç½®çš„åº“å‡½æ•°ï¼Œå¦‚Â   <code>sqrt</code>  ã€‚</p>\n<p></p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šnum = 16</span><br><span class=\"line\">è¾“å‡ºï¼štrue</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹ 2</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šnum = 14</span><br><span class=\"line\">è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h2>\n<p><code>1 &lt;= num &lt;= 2^31 - 1</code></p>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdmFsaWQtcGVyZmVjdC1zcXVhcmU=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvdmFsaWQtcGVyZmVjdC1zcXVhcmU=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†æ\">#</a> åˆ†æ</h2>\n<p>ç®€å•çš„é¢˜ç›®ï¼Œæ²¡ä»€ä¹ˆå¯ä»¥åˆ†æçš„ã€‚</p>\n<h2 id=\"è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•\">#</a> è§£æ³•</h2>\n<h3 id=\"è§£æ³•ä¸€è§„å¾‹\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸€è§„å¾‹\">#</a> è§£æ³•ä¸€ï¼šè§„å¾‹</h3>\n<p><code>4=1+3</code>   <code>9=1+3+5</code>   <code>16=1+3+5+7</code>  ä»¥æ­¤ç±»æ¨ï¼Œæ¨¡ä»¿å®ƒå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>while</code>  å¾ªç¯ï¼Œä¸æ–­å‡å»ä¸€ä¸ªä» <code>1</code>  å¼€å§‹ä¸æ–­å¢å¤§çš„å¥‡æ•°ï¼Œè‹¥æœ€ç»ˆå‡æˆäº† <code>0</code> ï¼Œè¯´æ˜æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Œå¦åˆ™ï¼Œä¸æ˜¯ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">isPerfectSquare</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> num1 = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(num &gt; <span class=\"number\">0</span>) </span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      num -= num1;</span><br><span class=\"line\">      num1 += <span class=\"number\">2</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> num == <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è§£æ³•äºŒ-å¹³æ–¹è®¡ç®—\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•äºŒ-å¹³æ–¹è®¡ç®—\">#</a> è§£æ³•äºŒï¼šå¹³æ–¹è®¡ç®—</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isPerfectSquare</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(num == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> maxTry = num &gt;&gt; <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> tryCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (tryCount &lt;= maxTry) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (num == tryCount * tryCount) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (num &lt; tryCount * tryCount) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        tryCount++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/02/BQ/LeetCode/0237-delete-node-in-a-linked-list/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/02/BQ/LeetCode/0237-delete-node-in-a-linked-list/",
            "title": "LC:237.åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹",
            "date_published": "2021-11-02T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>è¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äº åˆ é™¤å•é“¾è¡¨ä¸­æŸä¸ªç‰¹å®šèŠ‚ç‚¹ ã€‚åœ¨è®¾è®¡å‡½æ•°æ—¶éœ€è¦æ³¨æ„ï¼Œä½ æ— æ³•è®¿é—®é“¾è¡¨çš„å¤´èŠ‚ç‚¹Â  <code>head</code>  ï¼Œåªèƒ½ç›´æ¥è®¿é—® è¦è¢«åˆ é™¤çš„èŠ‚ç‚¹ ã€‚</p>\n<p>é¢˜ç›®æ•°æ®ä¿è¯éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ ä¸æ˜¯æœ«å°¾èŠ‚ç‚¹ ã€‚</p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1</h3>\n<p><img data-src=\"/images/ac-code/237/demo1.jpeg\" alt=\"\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šhead = [4,5,1,9], node = 5</span><br><span class=\"line\">è¾“å‡ºï¼š[4,1,9]</span><br><span class=\"line\">è§£é‡Šï¼šæŒ‡å®šé“¾è¡¨ä¸­å€¼ä¸ºÂ 5Â çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 1 -&gt; 9</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹ 2</h3>\n<p><img data-src=\"/images/ac-code/237/demo1.jpeg\" alt=\"\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šhead = [4,5,1,9], node = 1</span><br><span class=\"line\">è¾“å‡ºï¼š[4,5,9]</span><br><span class=\"line\">è§£é‡Šï¼šæŒ‡å®šé“¾è¡¨ä¸­å€¼ä¸ºÂ 1Â çš„ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 5 -&gt; 9</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-3\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-3\">#</a> ç¤ºä¾‹ 3</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šhead = [1,2,3,4], node = 3</span><br><span class=\"line\">è¾“å‡ºï¼š[1,2,4]</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-4\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-4\">#</a> ç¤ºä¾‹ 4</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šhead = [0,1], node = 0</span><br><span class=\"line\">è¾“å‡ºï¼š[1]</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-5\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-5\">#</a> ç¤ºä¾‹ 5</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šhead = [-3,5,-99], node = -3</span><br><span class=\"line\">è¾“å‡ºï¼š[5,-99]</span><br></pre></td></tr></table></figure>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤ºï¼š</h2>\n<ul>\n<li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [2, 1000]</li>\n<li>-1000 &lt;= Node.val &lt;= 1000</li>\n<li>é“¾è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„</li>\n<li>éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ node æ˜¯ é“¾è¡¨ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹ ï¼Œä¸” ä¸æ˜¯æœ«å°¾èŠ‚ç‚¹</li>\n</ul>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰237.åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZGVsZXRlLW5vZGUtaW4tYS1saW5rZWQtbGlzdC8=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZGVsZXRlLW5vZGUtaW4tYS1saW5rZWQtbGlzdC8=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰237.åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†æ\">#</a> åˆ†æ</h2>\n<p>éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šå…¥å‚ä¸­çš„ <code>Node</code>  ä¸ä¸€å®šæ˜¯å¤´èŠ‚ç‚¹ï¼</p>\n<p>æ‰€ä»¥ =&gt; å¼ å† ææˆ´ï¼Œå°±â€¦ æ€äº†æã€‚</p>\n<h2 id=\"è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•\">#</a> è§£æ³•</h2>\n<h3 id=\"è§£æ³•ä¸€\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸€\">#</a> è§£æ³•ä¸€</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteNode</span><span class=\"params\">(ListNode node)</span> </span>&#123;</span><br><span class=\"line\">    node.val = node.next.val;</span><br><span class=\"line\">    node.next = node.next.next;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/01/BQ/LeetCode/0575-distribute-candies/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/01/BQ/LeetCode/0575-distribute-candies/",
            "title": "LC:575.åˆ†ç³–æœ",
            "date_published": "2021-11-01T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p><code>Alice</code>  æœ‰  <code>n</code>  æšç³–ï¼Œå…¶ä¸­ç¬¬  <code>i</code>  æšç³–çš„ç±»å‹ä¸º  <code>candyType[i]</code>  ã€‚ <code>Alice</code>  æ³¨æ„åˆ°å¥¹çš„ä½“é‡æ­£åœ¨å¢é•¿ï¼Œæ‰€ä»¥å‰å»æ‹œè®¿äº†ä¸€ä½åŒ»ç”Ÿã€‚</p>\n<p>åŒ»ç”Ÿå»ºè®®  <code>Alice</code>  è¦å°‘æ‘„å…¥ç³–åˆ†ï¼Œåªåƒæ‰å¥¹æ‰€æœ‰ç³–çš„  <code>n / 2</code>  å³å¯ï¼ˆ <code>n</code>  æ˜¯ä¸€ä¸ªå¶æ•°ï¼‰ã€‚ <code>Alice</code>  éå¸¸å–œæ¬¢è¿™äº›ç³–ï¼Œå¥¹æƒ³è¦åœ¨éµå¾ªåŒ»ç”Ÿå»ºè®®çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½åƒåˆ°æœ€å¤šä¸åŒç§ç±»çš„ç³–ã€‚</p>\n<p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º  <code>n</code>  çš„æ•´æ•°æ•°ç»„  <code>candyType</code>  ï¼Œè¿”å›ï¼š  <code>Alice</code>  åœ¨ä»…åƒæ‰  <code>n / 2</code>  æšç³–çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åƒåˆ°ç³–çš„æœ€å¤šç§ç±»æ•°ã€‚</p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1</h3>\n<p>è¾“å…¥ï¼šcandyType = [1,1,2,2,3,3]<br>\n è¾“å‡ºï¼š3<br>\n è§£é‡Šï¼šAlice åªèƒ½åƒ 6 / 2 = 3 æšç³–ï¼Œç”±äºåªæœ‰ 3 ç§ç³–ï¼Œå¥¹å¯ä»¥æ¯ç§åƒä¸€æšã€‚</p>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹ 2</h3>\n<p>è¾“å…¥ï¼šcandyType = [1,1,2,3]<br>\n è¾“å‡ºï¼š2<br>\n è§£é‡Šï¼šAlice åªèƒ½åƒ 4 / 2 = 2 æšç³–ï¼Œä¸ç®¡å¥¹é€‰æ‹©åƒçš„ç§ç±»æ˜¯ [1,2]ã€[1,3] è¿˜æ˜¯ [2,3]ï¼Œå¥¹åªèƒ½åƒåˆ°ä¸¤ç§ä¸åŒç±»çš„ç³–ã€‚</p>\n<h3 id=\"ç¤ºä¾‹-3\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-3\">#</a> ç¤ºä¾‹ 3</h3>\n<p>è¾“å…¥ï¼šcandyType = [6,6,6,6]<br>\n è¾“å‡ºï¼š1<br>\n è§£é‡Šï¼šAlice åªèƒ½åƒ 4 / 2 = 2 æšç³–ï¼Œå°½ç®¡å¥¹èƒ½åƒ 2 æšï¼Œä½†åªèƒ½åƒåˆ° 1 ç§ç³–ã€‚</p>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h2>\n<p>n == candyType.length<br>\n2 &lt;= n &lt;= 104<br>\nn æ˜¯ä¸€ä¸ªå¶æ•°<br>\n - 105 &lt;= candyType [i] &lt;= 105</p>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰575.åˆ†ç³–æœ\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZGlzdHJpYnV0ZS1jYW5kaWVz\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvZGlzdHJpYnV0ZS1jYW5kaWVz\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰575.åˆ†ç³–æœ</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•\">#</a> è§£æ³•</h2>\n<h3 id=\"è§£æ³•ä¸€\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸€\">#</a> è§£æ³•ä¸€</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">distributeCandies</span><span class=\"params\">(<span class=\"keyword\">int</span>[] candyType)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ç³–çš„ç§ç±»</span></span><br><span class=\"line\">    Set&lt;Integer&gt; set = Arrays.stream(candyType).boxed().collect(Collectors.toSet());</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// æ¯”è¾ƒå¤§å°</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Integer.min(set.size(), candyType.length &gt;&gt; <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜",
                "ä¸åšä¹Ÿç½¢çš„ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/11/01/BQ/LeetCode/1218-longest-arithmetic-subsequence-of-given-difference/",
            "url": "https://fangjiaxiaobai.github.io/2021/11/01/BQ/LeetCode/1218-longest-arithmetic-subsequence-of-given-difference/",
            "title": "LC:1218.æœ€é•¿å®šå·®å­åºåˆ—",
            "date_published": "2021-11-01T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â  <code>arr</code> Â å’Œä¸€ä¸ªæ•´æ•°Â  <code>difference</code> ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›  <code>arr</code> Â ä¸­æœ€é•¿ç­‰å·®å­åºåˆ—çš„é•¿åº¦ï¼Œè¯¥å­åºåˆ—ä¸­ç›¸é‚»å…ƒç´ ä¹‹é—´çš„å·®ç­‰äº  <code>difference</code>  ã€‚</p>\n<p>å­åºåˆ— æ˜¯æŒ‡åœ¨ä¸æ”¹å˜å…¶ä½™å…ƒç´ é¡ºåºçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡åˆ é™¤ä¸€äº›å…ƒç´ æˆ–ä¸åˆ é™¤ä»»ä½•å…ƒç´ è€Œä»  <code>arr</code>  æ´¾ç”Ÿå‡ºæ¥çš„åºåˆ—ã€‚</p>\n<h2 id=\"ç¤ºä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h2>\n<h3 id=\"ç¤ºä¾‹-1\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-1\">#</a> ç¤ºä¾‹ 1</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šarr = [1,2,3,4], difference = 1</span><br><span class=\"line\">è¾“å‡ºï¼š4</span><br><span class=\"line\">è§£é‡Šï¼šæœ€é•¿çš„ç­‰å·®å­åºåˆ—æ˜¯ [1,2,3,4]ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-2\">#</a> ç¤ºä¾‹Â 2</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šarr = [1,3,5,7], difference = 1</span><br><span class=\"line\">è¾“å‡ºï¼š1</span><br><span class=\"line\">è§£é‡Šï¼šæœ€é•¿çš„ç­‰å·®å­åºåˆ—æ˜¯ä»»æ„å•ä¸ªå…ƒç´ ã€‚</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç¤ºä¾‹-3\"><a class=\"markdownIt-Anchor\" href=\"#ç¤ºä¾‹-3\">#</a> ç¤ºä¾‹ 3</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">è¾“å…¥ï¼šarr = [1,5,7,8,5,3,4,2,1], difference = -2</span><br><span class=\"line\">è¾“å‡ºï¼š4</span><br><span class=\"line\">è§£é‡Šï¼šæœ€é•¿çš„ç­‰å·®å­åºåˆ—æ˜¯ [7,5,3,1]ã€‚</span><br></pre></td></tr></table></figure>\n<h2 id=\"æç¤º\"><a class=\"markdownIt-Anchor\" href=\"#æç¤º\">#</a> æç¤º</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 &lt;= arr.length &lt;= 105</span><br><span class=\"line\">-104 &lt;= arr[i], difference &lt;= 104</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰1218.æœ€é•¿å®šå·®å­åºåˆ—\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvbG9uZ2VzdC1hcml0aG1ldGljLXN1YnNlcXVlbmNlLW9mLWdpdmVuLWRpZmZlcmVuY2U=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvbG9uZ2VzdC1hcml0aG1ldGljLXN1YnNlcXVlbmNlLW9mLWdpdmVuLWRpZmZlcmVuY2U=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰1218.æœ€é•¿å®šå·®å­åºåˆ—</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•\">#</a> è§£æ³•</h2>\n<h3 id=\"è§£æ³•ä¸€-åŠ¨æ€è§„åˆ’\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•ä¸€-åŠ¨æ€è§„åˆ’\">#</a> è§£æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">longestSubsequence</span><span class=\"params\">(<span class=\"keyword\">int</span>[] arr, <span class=\"keyword\">int</span> difference)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span>[] dp = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[<span class=\"number\">40001</span>];</span><br><span class=\"line\">    <span class=\"keyword\">int</span> maxLength = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> offset = <span class=\"number\">20000</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">        dp[arr[i] + offset] = Integer.max(<span class=\"number\">1</span>, dp[arr[i] + offset - difference] + <span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (maxLength &lt; dp[arr[i] + offset]) &#123;</span><br><span class=\"line\">            maxLength = dp[arr[i] + offset];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> maxLength;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"è§£æ³•äºŒæš´åŠ›è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•äºŒæš´åŠ›è§£æ³•\">#</a> è§£æ³•äºŒï¼šæš´åŠ›è§£æ³•</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åˆ¤æ–­</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (arr.length == <span class=\"number\">0</span> || arr.length == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.length;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> maxLength = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"comment\">// æœ€é•¿å­åºåˆ—çš„é•¿åº¦æ•°ç»„</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> t[] = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[arr.length];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åˆå§‹åŒ–</span></span><br><span class=\"line\">t[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// éå†æ•°ç»„arr</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class=\"line\">    t[i] = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = i - <span class=\"number\">1</span>; j &gt;= <span class=\"number\">0</span>; j--) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (arr[i] - difference == arr[j]) &#123;</span><br><span class=\"line\">            t[i] = t[j] + <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (maxLength &lt; t[i]) &#123;</span><br><span class=\"line\">                maxLength = t[i];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> maxLength;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜",
                "åŠ¨æ€è§„åˆ’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/29/machine-learn/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A002-K-%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/29/machine-learn/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A002-K-%E8%BF%91%E9%82%BB%E7%AE%97%E6%B3%95/",
            "title": "K-è¿‘é‚»ç®—æ³•(KNN)",
            "date_published": "2021-10-29T10:18:00.000Z",
            "content_html": "<p><code>k-è¿‘é‚»ç®—æ³•</code> ï¼Œè‹±æ–‡å:  <code>K Nearest Neighbor</code>  ç®—æ³•  åˆå« <code>KNNç®—æ³•</code> ï¼Œè¿™ä¸ªç®—æ³•æ˜¯æœºå™¨å­¦ä¹ é‡Œé¢ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ç®—æ³•ï¼Œ æ€»ä½“æ¥è¯´ 1 ç®—æ³•æ˜¯ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ç®—æ³•.</p>\n<h2 id=\"å®šä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#å®šä¹‰\">#</a> å®šä¹‰</h2>\n<p>å¦‚æœä¸€ä¸ªæ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„ k ä¸ªæœ€ç›¸ä¼¼ (å³ç‰¹å¾ç©ºé—´ä¸­æœ€é‚»è¿‘) çš„æ ·æœ¬ä¸­çš„å¤§å¤šæ•°å±äºæŸä¸€ä¸ªç±»åˆ«ï¼Œåˆ™è¯¥æ ·æœ¬ä¹Ÿå±äºè¿™ä¸ªç±»åˆ«ã€‚</p>\n<blockquote>\n<p><code>KNN</code>  ç®—æ³•æœ€æ—©æ˜¯ç”± <code>Cover</code>  å’Œ <code>Hart</code>  æå‡ºçš„ä¸€ç§åˆ†ç±»ç®—æ³•ã€‚åº”ç”¨åœºæ™¯æœ‰å­—ç¬¦è¯†åˆ«ã€æ–‡æœ¬åˆ†ç±»ã€å›¾åƒè¯†åˆ«ç­‰é¢†åŸŸã€‚</p>\n</blockquote>\n<h2 id=\"ç®—æ³•çš„ç†è§£\"><a class=\"markdownIt-Anchor\" href=\"#ç®—æ³•çš„ç†è§£\">#</a> ç®—æ³•çš„ç†è§£</h2>\n<p>ä¸¾ä¸€ä¸ªä¾‹å­æ¥ï¼Œæ¥åˆ†æä¸€ä¸‹  <code>KNN</code>  ç®—æ³•çš„å®ç°åŸç†</p>\n<p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰å‡ éƒ¨ç”µå½±ï¼Œå¦‚ä¸‹å›¾:</p>\n<p><img data-src=\"/images/ml/02-knn-1.png\" alt=\"\"></p>\n<p>æˆ‘ä»¬è¦ æ ¹æ® æç¬‘é•œå¤´ï¼Œæ‹¥æŠ±é•œå¤´ï¼Œæ‰“æ–—é•œå¤´çš„ä¸ªæ•° è¿™ä¸‰ä¸ªç‰¹å¾æ¥é¢„æµ‹å‡º ã€Šå”äººè¡—æ¢æ¡ˆã€‹æ‰€å±çš„ç”µå½±ç±»å‹.</p>\n<p>æˆ‘ä»¬ä½¿ç”¨  <code>KNNç®—æ³•</code>  æ€æƒ³æ¥å®ç°é¢„æµ‹ã€‚</p>\n<p>å°†æ ·æœ¬ä¸­ç‰¹å¾ä½œä¸ºåæ ‡æŠ½ï¼Œå»ºç«‹åæ ‡ç³»ã€‚ä»è€Œå»ºç«‹ç‰¹å¾ç©ºé—´ã€‚æœ¬ä¾‹ä¸­ï¼Œåˆ†åˆ«æŠŠ æç¬‘é•œå¤´ï¼Œæ‹¥æŠ±é•œå¤´ï¼Œæ‰“æ–—é•œå¤´ ä½œä¸º <code>x,y,z</code>  è½´ã€‚ç„¶åæŠŠè®¡ç®—å‡ºæ¯ä¸ªæ ·æœ¬å’Œ ã€Šå”äººè¡—æ¢æ¡ˆã€‹ çš„è·ç¦»ï¼Œé€‰æ‹©è·ç¦»æœ€è¿‘çš„å‰ k ä¸ª ( <code>KNNä¸­çš„k</code> ) æ ·æœ¬ï¼Œè¿™ <code>k</code>  ä¸ªæ ·æœ¬å¤§å¤šæ•°æ‰€å±çš„ç”µå½±ç±»åˆ«å°±æ˜¯ ã€Šå”äººè¡—æ¢æ¡ˆã€‹çš„ç”µå½±ç±»å‹ã€‚</p>\n<blockquote>\n<p>ç‰¹å¾ç©ºé—´ï¼šæ˜¯æŒ‡å·²ç‰¹å¾ä¸ºåæ ‡è½´ç®€å†çš„ä¸€ç§ç‰¹å¾çš„åæ ‡ç³»ï¼Œå¯èƒ½æ˜¯å¤šç»´çš„ã€‚</p>\n</blockquote>\n<p>é‚£ä½ å¯èƒ½å¯¹ è·ç¦» æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Œæœ‰ç‚¹ç–‘æƒ‘ã€‚è®¡ç®—è·ç¦»çš„æ–¹å¼æœ‰å¾ˆå¤šç§ã€‚<br>\nå…ˆå­¦ä¹ ä¸€ä¸‹æœ€ç®€å•çš„ æ¬§æ°è·ç¦»ã€‚(åˆä¸­éƒ½å­¦è¿‡çš„ï¼)</p>\n<p>åœ¨äºŒç»´åæ ‡ç³»ä¸­ï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸‹æ–¹å¼æ¥è®¡ç®—å‡ºä¸¤ä¸ªç‚¹çš„è·ç¦»ã€‚</p>\n<p><img data-src=\"/images/ml/02-knn-2.png\" alt=\"\"></p>\n<p>åœ¨å¤šç»´çš„ç‰¹å¾ç©ºé—´ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ ·çš„æ–¹å¼æ¥è®¡ç®—æ¬§å¼è·ç¦»ã€‚å¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-3.png\" alt=\"\"></p>\n<p>é‚£è®¡ç®—ä¸€ä¸‹æ ·æœ¬é›†ä¸­çš„æ¬§å¼è·ç¦»ï¼Œå¦‚ä¸‹å›¾:</p>\n<p><img data-src=\"/images/ml/02-knn-4.png\" alt=\"\"></p>\n<p>å¹¶è®¡ç®—å‡ºäº†æœ€è¿‘çš„ 5 ä¸ªæ ·æœ¬ä¸­æœ‰ä¸‰ä¸ªå–œå‰§ç‰‡ç±»å‹ï¼Œ2 ä¸¤ä¸ªçˆ±æƒ…ç‰‡ç±»å‹ã€‚ é‚£æ ¹æ® <code>KNN</code>  å°±æ˜¯å–œå‰§ç‰‡ç±»å‹ã€‚</p>\n<p>è¿™å°±æ˜¯ <code>KNNç®—æ³•</code> çš„æ ¸å¿ƒæ€æƒ³äº†ã€‚</p>\n<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€‰åˆ™äº† æœ€è¿‘çš„ <code>5</code>  ä¸ªæ ·æœ¬ï¼Œä¹Ÿå°±æ˜¯ k=5 çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸‰ä¸ªå–œå‰§ç‰‡ç±»å‹ï¼Œä¸¤ä¸ªçˆ±æƒ…ç‰‡ç±»å‹ã€‚è¿™ä¸ª <code>5</code>  æ˜¯å¦‚ä½•é€‰æ‹©çš„å‘¢ï¼Ÿ</p>\n<h2 id=\"kå€¼çš„é€‰æ‹©\"><a class=\"markdownIt-Anchor\" href=\"#kå€¼çš„é€‰æ‹©\">#</a> k å€¼çš„é€‰æ‹©</h2>\n<p><code>Kå€¼</code> é€‰æ‹©é—®é¢˜ï¼Œæèˆªåšå£«çš„ä¸€ä¹¦ã€Œç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€ä¸Šæ‰€è¯´ï¼š</p>\n<ol>\n<li>\n<p>é€‰æ‹©è¾ƒå°çš„ <code>K</code>  å€¼ï¼Œå°±ç›¸å½“äºç”¨è¾ƒå°çš„é¢†åŸŸä¸­çš„è®­ç»ƒå®ä¾‹è¿›è¡Œé¢„æµ‹ï¼Œâ€œå­¦ä¹ â€ è¿‘ä¼¼è¯¯å·®ä¼šå‡å°ï¼Œåªæœ‰ä¸è¾“å…¥å®ä¾‹è¾ƒè¿‘æˆ–ç›¸ä¼¼çš„è®­ç»ƒå®ä¾‹æ‰ä¼šå¯¹é¢„æµ‹ç»“æœèµ·ä½œç”¨ï¼Œä¸æ­¤åŒæ—¶å¸¦æ¥çš„é—®é¢˜æ˜¯ â€œå­¦ä¹ â€ çš„ä¼°è®¡è¯¯å·®ä¼šå¢å¤§ï¼Œæ¢å¥è¯è¯´ï¼Œ <code>Kå€¼</code> çš„å‡å°å°±æ„å‘³ç€æ•´ä½“æ¨¡å‹å˜å¾—å¤æ‚ï¼Œå®¹æ˜“å‘ç”Ÿè¿‡æ‹Ÿåˆï¼›</p>\n</li>\n<li>\n<p>é€‰æ‹©è¾ƒå¤§çš„ <code>Kå€¼</code> ï¼Œå°±ç›¸å½“äºç”¨è¾ƒå¤§é¢†åŸŸä¸­çš„è®­ç»ƒå®ä¾‹è¿›è¡Œé¢„æµ‹ï¼Œå…¶ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å­¦ä¹ çš„ä¼°è®¡è¯¯å·®ï¼Œä½†ç¼ºç‚¹æ˜¯å­¦ä¹ çš„è¿‘ä¼¼è¯¯å·®ä¼šå¢å¤§ã€‚è¿™æ—¶å€™ï¼Œä¸è¾“å…¥å®ä¾‹è¾ƒè¿œï¼ˆä¸ç›¸ä¼¼çš„ï¼‰è®­ç»ƒå®ä¾‹ä¹Ÿä¼šå¯¹é¢„æµ‹å™¨ä½œç”¨ï¼Œä½¿é¢„æµ‹å‘ç”Ÿé”™è¯¯ï¼Œä¸” K å€¼çš„å¢å¤§å°±æ„å‘³ç€æ•´ä½“çš„æ¨¡å‹å˜å¾—ç®€å•ã€‚</p>\n</li>\n<li>\n<p><code>K=N</code> ï¼ˆ <code>N</code>  ä¸ºè®­ç»ƒæ ·æœ¬ä¸ªæ•°ï¼‰ï¼Œåˆ™å®Œå…¨ä¸è¶³å–ï¼Œå› ä¸ºæ­¤æ—¶æ— è®ºè¾“å…¥å®ä¾‹æ˜¯ä»€ä¹ˆï¼Œéƒ½åªæ˜¯ç®€å•çš„é¢„æµ‹å®ƒå±äºåœ¨è®­ç»ƒå®ä¾‹ä¸­æœ€å¤šçš„ç±»ï¼Œæ¨¡å‹è¿‡äºç®€å•ï¼Œå¿½ç•¥äº†è®­ç»ƒå®ä¾‹ä¸­å¤§é‡æœ‰ç”¨ä¿¡æ¯ã€‚</p>\n</li>\n</ol>\n<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ <code>Kå€¼</code> ä¸€èˆ¬å–ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°å€¼ï¼Œä¾‹å¦‚é‡‡ç”¨äº¤å‰éªŒè¯æ³• ( <code>cross validation</code> )ï¼ˆç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠè®­ç»ƒæ•°æ®åœ¨åˆ†æˆä¸¤ç»„ï¼šè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼‰æ¥é€‰æ‹©æœ€ä¼˜çš„ K å€¼ã€‚å¯¹è¿™ä¸ªç®€å•çš„åˆ†ç±»å™¨è¿›è¡Œæ³›åŒ–ï¼Œç”¨æ ¸æ–¹æ³•æŠŠè¿™ä¸ªçº¿æ€§æ¨¡å‹æ‰©å±•åˆ°éçº¿æ€§çš„æƒ…å†µï¼Œå…·ä½“æ–¹æ³•æ˜¯æŠŠä½ç»´æ•°æ®é›†æ˜ å°„åˆ°é«˜ç»´ç‰¹å¾ç©ºé—´ã€‚</p>\n<h2 id=\"knnçš„ä¼˜åŒ–\"><a class=\"markdownIt-Anchor\" href=\"#knnçš„ä¼˜åŒ–\">#</a> KNN çš„ä¼˜åŒ–</h2>\n<p><code>KNN</code>  ç®—æ³•éœ€è¦è®¡ç®—æ‰€æœ‰çš„æ ·æœ¬æ•°æ®å’Œé¢„æµ‹æ•°æ®çš„è·ç¦»ï¼Œéœ€è¦é€‰æ‹©å‡ºè·ç¦»é¢„æµ‹æ•°æ®æœ€è¿‘çš„ k ä¸ªæ ·æœ¬æ•°æ®çš„é¢„æµ‹å½’ç±»ã€‚åœ¨åºå¤§çš„æ•°æ®é‡é¢å‰ï¼Œè®¡ç®—æ‰€æœ‰æ ·æœ¬æ•°æ®è·ç¦»ï¼Œæ˜¾ç„¶æ˜¯ä¸å¯å–çš„ã€‚ä¸ºäº†é¿å…æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—ä¸€éè·ç¦»ï¼Œ <code>KNN</code>  ç®—æ³•æä¾›äº†å¤šç§ä¼˜åŒ–æ–¹æ³•ï¼Œ æ¯”å¦‚  <code>KD-tree</code> ,  <code>ball_tree</code> ,  <code>brute</code> . è¿™å‡ ç§ä¼˜åŒ–æ–¹å¼çš„å…·ä½“å®ç°é€»è¾‘ï¼Œæˆ‘ä¼šåœ¨åé¢çš„å‡ ç¯‡æ–‡ç« ä¸­æŒ¨ä¸ªåˆ†æã€‚</p>\n<h2 id=\"è·ç¦»çš„è®¡ç®—\"><a class=\"markdownIt-Anchor\" href=\"#è·ç¦»çš„è®¡ç®—\">#</a> è·ç¦»çš„è®¡ç®—</h2>\n<p><code>KNN</code>  ç®—æ³•ï¼Œæœ€é‡è¦çš„å°±æ˜¯è·ç¦»ã€‚ é™¤äº†ä¸Šæ–‡æåˆ°çš„æ¬§å¼è·ç¦»ï¼Œè¿˜æœ‰å…¶ä»–è®¡ç®—è·ç¦»çš„æ–¹æ³•å—ï¼Ÿ</p>\n<p>æœ‰ã€‚</p>\n<p>é™¤äº†æ¬§å¼è·ç¦»ï¼Œè¿˜æœ‰ æ›¼å“ˆé¡¿è·ç¦»ï¼Œ</p>\n<h3 id=\"æ›¼å“ˆé¡¿è·ç¦»\"><a class=\"markdownIt-Anchor\" href=\"#æ›¼å“ˆé¡¿è·ç¦»\">#</a> æ›¼å“ˆé¡¿è·ç¦»</h3>\n<p>åœ¨æ›¼å“ˆé¡¿è¡—åŒºè¦ä»ä¸€ä¸ªåå­—è·¯å£å¼€è½¦åˆ°å¦ä¸€ä¸ªåå­—è·¯å£ï¼Œé©¾é©¶è·ç¦»æ˜¾ç„¶ä¸æ˜¯ä¸¤ç‚¹é—´çš„ç›´çº¿è·ç¦»ã€‚è¿™ä¸ªå®é™…é©¾é©¶è·ç¦»å°±æ˜¯ â€œæ›¼å“ˆé¡¿è·ç¦»â€ã€‚æ›¼å“ˆé¡¿è·ç¦»ä¹Ÿç§°ä¸º â€œåŸå¸‚è¡—åŒºè·ç¦»â€( <code>City Block distance</code> )ã€‚å¦‚ä¸‹å›¾:<br>\n<img data-src=\"/images/ml/02-knn-6.png\" alt=\"\"></p>\n<p>è®¡ç®—å…¬å¼è§ä¸‹å›¾:</p>\n<p><img data-src=\"/images/ml/02-knn-7.png\" alt=\"\"></p>\n<h3 id=\"åˆ‡æ¯”é›ªå¤«è·ç¦»-chebyshev-distance\"><a class=\"markdownIt-Anchor\" href=\"#åˆ‡æ¯”é›ªå¤«è·ç¦»-chebyshev-distance\">#</a> åˆ‡æ¯”é›ªå¤«è·ç¦» (Chebyshev Distance)</h3>\n<p>å›½é™…è±¡æ£‹ä¸­ï¼Œå›½ç‹å¯ä»¥ç›´è¡Œã€æ¨ªè¡Œã€æ–œè¡Œï¼Œæ‰€ä»¥å›½ç‹èµ°ä¸€æ­¥å¯ä»¥ç§»åŠ¨åˆ°ç›¸é‚» 8 ä¸ªæ–¹æ ¼ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚å›½ç‹ä»æ ¼å­ <code>(x1,y1)</code>  èµ°åˆ°æ ¼å­ <code>(x2,y2)</code>  æœ€å°‘éœ€è¦å¤šå°‘æ­¥ï¼Ÿè¿™ä¸ªè·ç¦»å°±å«åˆ‡æ¯”é›ªå¤«è·ç¦»ã€‚</p>\n<p><img data-src=\"/images/ml/02-knn-8.png\" alt=\"\"></p>\n<p>è®¡ç®—å…¬å¼è§ä¸‹å›¾:</p>\n<p><img data-src=\"/images/ml/02-knn-9.png\" alt=\"\"></p>\n<h3 id=\"é—µå¯å¤«æ–¯åŸºè·ç¦»minkowski-distance\"><a class=\"markdownIt-Anchor\" href=\"#é—µå¯å¤«æ–¯åŸºè·ç¦»minkowski-distance\">#</a> é—µå¯å¤«æ–¯åŸºè·ç¦» (Minkowski Distance)</h3>\n<p>é—µæ°è·ç¦»ä¸æ˜¯ä¸€ç§è·ç¦»ï¼Œè€Œæ˜¯ä¸€ç»„è·ç¦»çš„å®šä¹‰ï¼Œæ˜¯å¯¹å¤šä¸ªè·ç¦»åº¦é‡å…¬å¼çš„æ¦‚æ‹¬æ€§çš„è¡¨è¿°ã€‚</p>\n<p>ä¸¤ä¸ª n ç»´å˜é‡ <code>a(x11,x12,â€¦,x1n)</code>  ä¸ <code>b(x21,x22,â€¦,x2n)</code>  é—´çš„é—µå¯å¤«æ–¯åŸºè·ç¦»å®šä¹‰ä¸ºï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-10.png\" alt=\"\"></p>\n<p>å…¶ä¸­ <code>p</code>  æ˜¯ä¸€ä¸ªå˜å‚æ•°ï¼š<br>\nå½“ <code>p=1</code>  æ—¶ï¼Œå°±æ˜¯æ›¼å“ˆé¡¿è·ç¦»ï¼›<br>\nå½“ <code>p=2</code>  æ—¶ï¼Œå°±æ˜¯æ¬§æ°è·ç¦»ï¼›<br>\nå½“ <code>pâ†’âˆ</code> æ—¶ï¼Œå°±æ˜¯åˆ‡æ¯”é›ªå¤«è·ç¦»ã€‚</p>\n<p>æ ¹æ® p çš„ä¸åŒï¼Œé—µæ°è·ç¦»å¯ä»¥è¡¨ç¤ºæŸä¸€ç±» / ç§çš„è·ç¦»ã€‚</p>\n<p>å°ç»“ï¼š<br>\n1 é—µæ°è·ç¦»ï¼ŒåŒ…æ‹¬æ›¼å“ˆé¡¿è·ç¦»ã€æ¬§æ°è·ç¦»å’Œåˆ‡æ¯”é›ªå¤«è·ç¦»éƒ½å­˜åœ¨æ˜æ˜¾çš„ç¼ºç‚¹:<br>\n <code>e.g.</code>  äºŒç»´æ ·æœ¬ (èº«é«˜ <code>[å•ä½:cm]</code> , ä½“é‡ <code>[å•ä½:kg]</code> ), ç°æœ‰ä¸‰ä¸ªæ ·æœ¬ï¼š <code>a(180,50)</code> ï¼Œ <code>b(190,50)</code> ï¼Œ <code>c(180,60)</code> ã€‚<br>\n <code>a</code>  ä¸ <code>b</code>  çš„é—µæ°è·ç¦»ï¼ˆæ— è®ºæ˜¯æ›¼å“ˆé¡¿è·ç¦»ã€æ¬§æ°è·ç¦»æˆ–åˆ‡æ¯”é›ªå¤«è·ç¦»ï¼‰ç­‰äº <code>a</code>  ä¸ <code>c</code>  çš„é—µæ°è·ç¦»ã€‚ä½†å®é™…ä¸Šèº«é«˜çš„ <code>10cm</code>  å¹¶ä¸èƒ½å’Œä½“é‡çš„ <code>10kg</code>  åˆ’ç­‰å·ã€‚</p>\n<p>2 é—µæ°è·ç¦»çš„ç¼ºç‚¹ï¼š<br>\nâ€‹ (1) å°†å„ä¸ªåˆ†é‡çš„é‡çº² ( <code>scale</code> )ï¼Œä¹Ÿå°±æ˜¯ â€œå•ä½â€ ç›¸åŒçš„çœ‹å¾…äº†ï¼›<br>\nâ€‹ (2) æœªè€ƒè™‘å„ä¸ªåˆ†é‡çš„åˆ†å¸ƒï¼ˆæœŸæœ›ï¼Œæ–¹å·®ç­‰ï¼‰å¯èƒ½æ˜¯ä¸åŒçš„ã€‚</p>\n<h3 id=\"æ ‡å‡†åŒ–æ¬§æ°è·ç¦»-standardized-euclideandistance\"><a class=\"markdownIt-Anchor\" href=\"#æ ‡å‡†åŒ–æ¬§æ°è·ç¦»-standardized-euclideandistance\">#</a> æ ‡å‡†åŒ–æ¬§æ°è·ç¦» (Standardized EuclideanDistance)</h3>\n<p>æ ‡å‡†åŒ–æ¬§æ°è·ç¦»æ˜¯é’ˆå¯¹æ¬§æ°è·ç¦»çš„ç¼ºç‚¹è€Œä½œçš„ä¸€ç§æ”¹è¿›ã€‚</p>\n<p>æ€è·¯ï¼šæ—¢ç„¶æ•°æ®å„ç»´åˆ†é‡çš„åˆ†å¸ƒä¸ä¸€æ ·ï¼Œé‚£å…ˆå°†å„ä¸ªåˆ†é‡éƒ½ â€œæ ‡å‡†åŒ–â€ åˆ°å‡å€¼ã€æ–¹å·®ç›¸ç­‰ã€‚å‡è®¾æ ·æœ¬é›† X çš„å‡å€¼ ( <code>mean</code> ) ä¸º <code>m</code> ï¼Œæ ‡å‡†å·® ( <code>standard deviation</code> ) ä¸º <code>s</code> ï¼Œ <code>X</code>  çš„ â€œæ ‡å‡†åŒ–å˜é‡â€ è¡¨ç¤ºä¸ºï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-11.png\" alt=\"\"></p>\n<p>å¦‚æœå°†æ–¹å·®çš„å€’æ•°çœ‹æˆä¸€ä¸ªæƒé‡ï¼Œä¹Ÿå¯ç§°ä¹‹ä¸ºåŠ æƒæ¬§æ°è·ç¦» ( <code>Weighted Euclidean distance</code> )ã€‚</p>\n<h3 id=\"ä½™å¼¦è·ç¦»cosine-distance\"><a class=\"markdownIt-Anchor\" href=\"#ä½™å¼¦è·ç¦»cosine-distance\">#</a> ä½™å¼¦è·ç¦» (Cosine Distance)</h3>\n<p>å‡ ä½•ä¸­ï¼Œå¤¹è§’ä½™å¼¦å¯ç”¨æ¥è¡¡é‡ä¸¤ä¸ªå‘é‡æ–¹å‘çš„å·®å¼‚ï¼›æœºå™¨å­¦ä¹ ä¸­ï¼Œå€Ÿç”¨è¿™ä¸€æ¦‚å¿µæ¥è¡¡é‡æ ·æœ¬å‘é‡ä¹‹é—´çš„å·®å¼‚ã€‚</p>\n<p>äºŒç»´ç©ºé—´ä¸­å‘é‡ <code>A(x1,y1)</code>  ä¸å‘é‡ <code>B(x2,y2)</code>  çš„å¤¹è§’ä½™å¼¦å…¬å¼ï¼š<br>\n<img data-src=\"/images/ml/02-knn-12.png\" alt=\"\"></p>\n<p>ä¸¤ä¸ª <code>n</code>  ç»´æ ·æœ¬ç‚¹ <code>a(x11,x12,â€¦,x1n)</code>  å’Œ <code>b(x21,x22,â€¦,x2n)</code>  çš„å¤¹è§’ä½™å¼¦ä¸ºï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-13.png\" alt=\"\"></p>\n<p>å³:</p>\n<p><img data-src=\"/images/ml/02-knn-14.png\" alt=\"\"></p>\n<p>å¤¹è§’ä½™å¼¦å–å€¼èŒƒå›´ä¸º <code>[-1,1]</code> ã€‚ä½™å¼¦è¶Šå¤§è¡¨ç¤ºä¸¤ä¸ªå‘é‡çš„å¤¹è§’è¶Šå°ï¼Œä½™å¼¦è¶Šå°è¡¨ç¤ºä¸¤å‘é‡çš„å¤¹è§’è¶Šå¤§ã€‚å½“ä¸¤ä¸ªå‘é‡çš„æ–¹å‘é‡åˆæ—¶ä½™å¼¦å–æœ€å¤§å€¼ <code>1</code> ï¼Œå½“ä¸¤ä¸ªå‘é‡çš„æ–¹å‘å®Œå…¨ç›¸åä½™å¼¦å–æœ€å°å€¼ <code>-1</code></p>\n<h3 id=\"æ±‰æ˜è·ç¦»hamming-distance\"><a class=\"markdownIt-Anchor\" href=\"#æ±‰æ˜è·ç¦»hamming-distance\">#</a> æ±‰æ˜è·ç¦» (Hamming Distance)</h3>\n<p>ä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸² <code>s1</code>  ä¸ <code>s2</code>  çš„æ±‰æ˜è·ç¦»ä¸ºï¼šå°†å…¶ä¸­ä¸€ä¸ªå˜ä¸ºå¦å¤–ä¸€ä¸ªæ‰€éœ€è¦ä½œçš„æœ€å°å­—ç¬¦æ›¿æ¢æ¬¡æ•°ã€‚</p>\n<p>ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The Hamming distance between &quot;1011101&quot; and &quot;1001001&quot; is 2. </span><br><span class=\"line\">The Hamming distance between &quot;2143896&quot; and &quot;2233796&quot; is 3. </span><br><span class=\"line\">The Hamming distance between &quot;toned&quot; and &quot;roses&quot; is 3.</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"/images/ml/02-knn-15.png\" alt=\"\"></p>\n<p>æ±‰æ˜é‡é‡ï¼šæ˜¯å­—ç¬¦ä¸²ç›¸å¯¹äºåŒæ ·é•¿åº¦çš„é›¶å­—ç¬¦ä¸²çš„æ±‰æ˜è·ç¦»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å­—ç¬¦ä¸²ä¸­éé›¶çš„å…ƒç´ ä¸ªæ•°ï¼šå¯¹äºäºŒè¿›åˆ¶å­—ç¬¦ä¸²æ¥è¯´ï¼Œå°±æ˜¯  <code>1</code>  çš„ä¸ªæ•°ï¼Œæ‰€ä»¥  <code>11101</code>  çš„æ±‰æ˜é‡é‡æ˜¯  <code>4</code> ã€‚å› æ­¤ï¼Œå¦‚æœå‘é‡ç©ºé—´ä¸­çš„å…ƒç´  <code>a</code>  å’Œ <code>b</code>  ä¹‹é—´çš„æ±‰æ˜è·ç¦»ç­‰äºå®ƒä»¬æ±‰æ˜é‡é‡çš„å·® <code>a-b</code> ã€‚</p>\n<p>åº”ç”¨ï¼šæ±‰æ˜é‡é‡åˆ†æåœ¨åŒ…æ‹¬ä¿¡æ¯è®ºã€ç¼–ç ç†è®ºã€å¯†ç å­¦ç­‰é¢†åŸŸéƒ½æœ‰åº”ç”¨ã€‚æ¯”å¦‚åœ¨ä¿¡æ¯ç¼–ç è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å¢å¼ºå®¹é”™æ€§ï¼Œåº”ä½¿å¾—ç¼–ç é—´çš„æœ€å°æ±‰æ˜è·ç¦»å°½å¯èƒ½å¤§ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦æ¯”è¾ƒä¸¤ä¸ªä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä¸ä»…è¦è¿›è¡Œæ›¿æ¢ï¼Œè€Œä¸”è¦è¿›è¡Œæ’å…¥ä¸åˆ é™¤çš„è¿ç®—ï¼Œåœ¨è¿™ç§åœºåˆä¸‹ï¼Œé€šå¸¸ä½¿ç”¨æ›´åŠ å¤æ‚çš„ç¼–è¾‘è·ç¦»ç­‰ç®—æ³•ã€‚</p>\n<h3 id=\"æ°å¡å¾·è·ç¦»jaccard-distance\"><a class=\"markdownIt-Anchor\" href=\"#æ°å¡å¾·è·ç¦»jaccard-distance\">#</a> æ°å¡å¾·è·ç¦» (Jaccard Distance)</h3>\n<p>æ°å¡å¾·ç›¸ä¼¼ç³»æ•° ( <code>Jaccard similarity coefficient</code> )ï¼šä¸¤ä¸ªé›†åˆ <code>A</code>  å’Œ <code>B</code>  çš„äº¤é›†å…ƒç´ åœ¨ <code>A</code> ï¼Œ <code>B</code>  çš„å¹¶é›†ä¸­æ‰€å çš„æ¯”ä¾‹ï¼Œç§°ä¸ºä¸¤ä¸ªé›†åˆçš„æ°å¡å¾·ç›¸ä¼¼ç³»æ•°ï¼Œç”¨ç¬¦å· <code>J(A,B</code> ) è¡¨ç¤ºï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-16.png\" alt=\"\"></p>\n<p>æ°å¡å¾·è·ç¦» ( <code>Jaccard Distance</code> )ï¼šä¸æ°å¡å¾·ç›¸ä¼¼ç³»æ•°ç›¸åï¼Œç”¨ä¸¤ä¸ªé›†åˆä¸­ä¸åŒå…ƒç´ å æ‰€æœ‰å…ƒç´ çš„æ¯”ä¾‹æ¥è¡¡é‡ä¸¤ä¸ªé›†åˆçš„åŒºåˆ†åº¦ï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-17.png\" alt=\"\"></p>\n<h3 id=\"é©¬æ°è·ç¦»mahalanobis-distance\"><a class=\"markdownIt-Anchor\" href=\"#é©¬æ°è·ç¦»mahalanobis-distance\">#</a> é©¬æ°è·ç¦» (Mahalanobis Distance)</h3>\n<p>ä¸‹å›¾æœ‰ä¸¤ä¸ªæ­£æ€åˆ†å¸ƒå›¾ï¼Œå®ƒä»¬çš„å‡å€¼åˆ†åˆ«ä¸º <code>a</code>  å’Œ <code>b</code> ï¼Œä½†æ–¹å·®ä¸ä¸€æ ·ï¼Œåˆ™å›¾ä¸­çš„ <code>A</code>  ç‚¹ç¦»å“ªä¸ªæ€»ä½“æ›´è¿‘ï¼Ÿæˆ–è€…è¯´ <code>A</code>  æœ‰æ›´å¤§çš„æ¦‚ç‡å±äºè°ï¼Ÿæ˜¾ç„¶ï¼Œ <code>A</code>  ç¦»å·¦è¾¹çš„æ›´è¿‘ï¼Œ <code>A</code>  å±äºå·¦è¾¹æ€»ä½“çš„æ¦‚ç‡æ›´å¤§ï¼Œå°½ç®¡ <code>A</code>  ä¸ <code>a</code>  çš„æ¬§å¼è·ç¦»è¿œä¸€äº›ã€‚è¿™å°±æ˜¯é©¬æ°è·ç¦»çš„ç›´è§‚è§£é‡Šã€‚</p>\n<p><img data-src=\"/images/ml/02-knn-18.png\" alt=\"\"></p>\n<p>é©¬æ°è·ç¦»æ˜¯åŸºäºæ ·æœ¬åˆ†å¸ƒçš„ä¸€ç§è·ç¦»ã€‚</p>\n<p>é©¬æ°è·ç¦»æ˜¯ç”±å°åº¦ç»Ÿè®¡å­¦å®¶é©¬å“ˆæ‹‰è¯ºæ¯”æ–¯æå‡ºçš„ï¼Œè¡¨ç¤ºæ•°æ®çš„åæ–¹å·®è·ç¦»ã€‚å®ƒæ˜¯ä¸€ç§æœ‰æ•ˆçš„è®¡ç®—ä¸¤ä¸ªä½ç½®æ ·æœ¬é›†çš„ç›¸ä¼¼åº¦çš„æ–¹æ³•ã€‚</p>\n<p>ä¸æ¬§å¼è·ç¦»ä¸åŒçš„æ˜¯ï¼Œå®ƒè€ƒè™‘åˆ°å„ç§ç‰¹æ€§ä¹‹é—´çš„è”ç³»ï¼Œå³ç‹¬ç«‹äºæµ‹é‡å°ºåº¦ã€‚</p>\n<p>é©¬æ°è·ç¦»å®šä¹‰ï¼šè®¾æ€»ä½“ <code>G</code>  ä¸º <code>m</code>  ç»´æ€»ä½“ï¼ˆè€ƒå¯Ÿ <code>m</code>  ä¸ªæŒ‡æ ‡ï¼‰ï¼Œå‡å€¼å‘é‡ä¸º <code>Î¼=ï¼ˆÎ¼1ï¼ŒÎ¼2ï¼Œâ€¦ ...ï¼ŒÎ¼mï¼Œï¼‰</code> , åæ–¹å·®é˜µä¸º <code>âˆ‘=ï¼ˆÏƒijï¼‰</code> ,</p>\n<p>åˆ™æ ·æœ¬ <code>X=ï¼ˆX1ï¼ŒX2ï¼Œâ€¦ â€¦ï¼ŒXmï¼Œï¼‰</code> ä¸æ€»ä½“ G çš„é©¬æ°è·ç¦»å®šä¹‰ä¸ºï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-19.png\" alt=\"\"></p>\n<p>é©¬æ°è·ç¦»ä¹Ÿå¯ä»¥å®šä¹‰ä¸ºä¸¤ä¸ªæœä»åŒä¸€åˆ†å¸ƒå¹¶ä¸”å…¶åæ–¹å·®çŸ©é˜µä¸º <code>âˆ‘</code> çš„éšæœºå˜é‡çš„å·®å¼‚ç¨‹åº¦ï¼šå¦‚æœåæ–¹å·®çŸ©é˜µä¸ºå•ä½çŸ©é˜µï¼Œé©¬æ°è·ç¦»å°±ç®€åŒ–ä¸ºæ¬§å¼è·ç¦»ï¼›å¦‚æœåæ–¹å·®çŸ©é˜µä¸ºå¯¹è§’çŸ©é˜µï¼Œåˆ™å…¶ä¹Ÿå¯ç§°ä¸ºæ­£è§„åŒ–çš„æ¬§å¼è·ç¦»ã€‚</p>\n<h4 id=\"é©¬æ°è·ç¦»ç‰¹æ€§\"><a class=\"markdownIt-Anchor\" href=\"#é©¬æ°è·ç¦»ç‰¹æ€§\">#</a> é©¬æ°è·ç¦»ç‰¹æ€§ï¼š</h4>\n<p>1. é‡çº²æ— å…³ï¼Œæ’é™¤å˜é‡ä¹‹é—´çš„ç›¸å…³æ€§çš„å¹²æ‰°ï¼›</p>\n<p>2. é©¬æ°è·ç¦»çš„è®¡ç®—æ˜¯å»ºç«‹åœ¨æ€»ä½“æ ·æœ¬çš„åŸºç¡€ä¸Šçš„ï¼Œå¦‚æœæ‹¿åŒæ ·çš„ä¸¤ä¸ªæ ·æœ¬ï¼Œæ”¾å…¥ä¸¤ä¸ªä¸åŒçš„æ€»ä½“ä¸­ï¼Œæœ€åè®¡ç®—å¾—å‡ºçš„ä¸¤ä¸ªæ ·æœ¬é—´çš„é©¬æ°è·ç¦»é€šå¸¸æ˜¯ä¸ç›¸åŒçš„ï¼Œé™¤éè¿™ä¸¤ä¸ªæ€»ä½“çš„åæ–¹å·®çŸ©é˜µç¢°å·§ç›¸åŒï¼›</p>\n<p>3 . è®¡ç®—é©¬æ°è·ç¦»è¿‡ç¨‹ä¸­ï¼Œè¦æ±‚æ€»ä½“æ ·æœ¬æ•°å¤§äºæ ·æœ¬çš„ç»´æ•°ï¼Œå¦åˆ™å¾—åˆ°çš„æ€»ä½“æ ·æœ¬åæ–¹å·®çŸ©é˜µé€†çŸ©é˜µä¸å­˜åœ¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æ¬§å¼è·ç¦»è®¡ç®—å³å¯ã€‚</p>\n<p>4. è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œæ»¡è¶³äº†æ¡ä»¶æ€»ä½“æ ·æœ¬æ•°å¤§äºæ ·æœ¬çš„ç»´æ•°ï¼Œä½†æ˜¯åæ–¹å·®çŸ©é˜µçš„é€†çŸ©é˜µä»ç„¶ä¸å­˜åœ¨ï¼Œæ¯”å¦‚ä¸‰ä¸ªæ ·æœ¬ç‚¹ <code>(3,4)</code> ï¼Œ <code>(5,6)</code> ï¼Œ <code>(7,8)</code> ï¼Œè¿™ç§æƒ…å†µæ˜¯å› ä¸ºè¿™ä¸‰ä¸ªæ ·æœ¬åœ¨å…¶æ‰€å¤„çš„äºŒç»´ç©ºé—´å¹³é¢å†…å…±çº¿ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿé‡‡ç”¨æ¬§å¼è·ç¦»è®¡ç®—ã€‚</p>\n<h4 id=\"æ¬§å¼è·ç¦»é©¬æ°è·ç¦»\"><a class=\"markdownIt-Anchor\" href=\"#æ¬§å¼è·ç¦»é©¬æ°è·ç¦»\">#</a> æ¬§å¼è·ç¦» &amp; é©¬æ°è·ç¦»ï¼š</h4>\n<p><img data-src=\"/images/ml/02-knn-20.png\" alt=\"\"></p>\n<p>ä¸¾ä¾‹ï¼š</p>\n<p>å·²çŸ¥æœ‰ä¸¤ä¸ªç±» <code>G1</code>  å’Œ <code>G2</code> ï¼Œæ¯”å¦‚ <code>G1</code>  æ˜¯è®¾å¤‡ <code>A</code>  ç”Ÿäº§çš„äº§å“ï¼Œ <code>G2</code>  æ˜¯è®¾å¤‡ <code>B</code>  ç”Ÿäº§çš„åŒç±»äº§å“ã€‚è®¾å¤‡ <code>A</code>  çš„äº§å“è´¨é‡é«˜ï¼ˆå¦‚è€ƒå¯ŸæŒ‡æ ‡ä¸ºè€ç£¨åº¦ <code>X</code> ï¼‰ï¼Œå…¶å¹³å‡è€ç£¨åº¦ <code>Î¼1=80</code> ï¼Œåæ˜ è®¾å¤‡ç²¾åº¦çš„æ–¹å·® <code>Ïƒ2(1)=0.25</code> ; è®¾å¤‡ B çš„äº§å“è´¨é‡ç¨å·®ï¼Œå…¶å¹³å‡è€ç£¨æŸåº¦ <code>Î¼2=75</code> ï¼Œåæ˜ è®¾å¤‡ç²¾åº¦çš„æ–¹å·® <code>Ïƒ2(2)=4</code> .</p>\n<p>ä»Šæœ‰ä¸€äº§å“ <code>G0</code> ï¼Œæµ‹çš„è€ç£¨æŸåº¦ <code>X0=78</code> ï¼Œè¯•åˆ¤æ–­è¯¥äº§å“æ˜¯å“ªä¸€å°è®¾å¤‡ç”Ÿäº§çš„ï¼Ÿ</p>\n<p>ç›´è§‚åœ°çœ‹ï¼Œ <code>X0</code>  ä¸ <code>Î¼1</code> ï¼ˆ <code>è®¾å¤‡A</code> ï¼‰çš„ç»å¯¹è·ç¦»è¿‘äº›ï¼ŒæŒ‰è·ç¦»æœ€è¿‘çš„åŸåˆ™ï¼Œæ˜¯å¦åº”æŠŠè¯¥äº§å“åˆ¤æ–­ <code>è®¾å¤‡A</code>  ç”Ÿäº§çš„ï¼Ÿ</p>\n<p>è€ƒè™‘ä¸€ç§ç›¸å¯¹äºåˆ†æ•£æ€§çš„è·ç¦»ï¼Œè®° <code>X0</code>  ä¸ <code>G1</code> ï¼Œ <code>G2</code>  çš„ç›¸å¯¹è·ç¦»ä¸º <code>d1</code> ï¼Œ <code>d2</code> , åˆ™ï¼š</p>\n<p><img data-src=\"/images/ml/02-knn-21.png\" alt=\"\"></p>\n<p>å› ä¸º <code>d2=1.5 &lt; d1=4</code> ï¼ŒæŒ‰è¿™ç§è·ç¦»å‡†åˆ™ï¼Œåº”åˆ¤æ–­ <code>X0</code>  ä¸ºè®¾å¤‡ B ç”Ÿäº§çš„ã€‚</p>\n<p>è®¾å¤‡ <code>B</code>  ç”Ÿäº§çš„äº§å“è´¨é‡è¾ƒåˆ†æ•£ï¼Œå‡ºç° <code>X0</code>  ä¸º <code>78</code>  çš„å¯èƒ½æ€§è¾ƒå¤§ï¼›è€Œ <code>è®¾å¤‡A</code>  ç”Ÿäº§çš„äº§å“è´¨é‡è¾ƒé›†ä¸­ï¼Œå‡ºç° <code>X0</code>  ä¸º <code>78</code>  çš„å¯èƒ½æ€§è¾ƒå°ã€‚</p>\n<p>è¿™ç§ç›¸å¯¹äºåˆ†æ•£æ€§çš„è·ç¦»åˆ¤æ–­å°±æ˜¯é©¬æ°è·ç¦»ã€‚</p>\n<p><img data-src=\"/images/ml/02-knn-22.png\" alt=\"\"></p>\n<h2 id=\"æ¡ˆä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#æ¡ˆä¾‹\">#</a> æ¡ˆä¾‹</h2>\n<h3 id=\"é¢„æµ‹é¸¢å°¾èŠ±ç§ç±»\"><a class=\"markdownIt-Anchor\" href=\"#é¢„æµ‹é¸¢å°¾èŠ±ç§ç±»\">#</a> é¢„æµ‹é¸¢å°¾èŠ±ç§ç±»</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> load_iris</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.model_selection <span class=\"keyword\">import</span> train_test_split</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.preprocessing <span class=\"keyword\">import</span> StandardScaler</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.neighbors <span class=\"keyword\">import</span> KNeighborsClassifier</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">iris_demo</span>():</span></span><br><span class=\"line\">    <span class=\"comment\"># 1.å‡†å¤‡æ•°æ®</span></span><br><span class=\"line\">    iris = load_iris()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2.æ•°æ®åŸºæœ¬å¤„ç†</span></span><br><span class=\"line\">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, test_size=<span class=\"number\">0.2</span>, random_state=<span class=\"number\">22</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 3.ç‰¹å¾å·¥ç¨‹</span></span><br><span class=\"line\">    <span class=\"comment\"># 3.1 æ ‡å‡†åŒ–</span></span><br><span class=\"line\">    transfer = StandardScaler()</span><br><span class=\"line\">    x_train = transfer.fit_transform(x_train)</span><br><span class=\"line\">    x_test = transfer.transform(x_test)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 4.æœºå™¨è®­ç»ƒ(æ¨¡å‹è®­ç»ƒ)</span></span><br><span class=\"line\">    estimator = KNeighborsClassifier(n_neighbors=<span class=\"number\">3</span>)</span><br><span class=\"line\">    estimator.fit(x_train, y_train)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 5.æ¨¡å‹è¯„ä¼°</span></span><br><span class=\"line\">    <span class=\"comment\"># 5.1  æ–¹æ³•1ï¼šæ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼</span></span><br><span class=\"line\">    predict_data = estimator.predict(x_test)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;é¢„æµ‹å€¼ä¸º: \\n&quot;</span>, predict_data)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼;\\n&quot;</span>, predict_data == y_test)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 5.2  æ–¹æ³•2: ç›´æ¥è®¡ç®—æ­£ç¡®ç‡</span></span><br><span class=\"line\">    score = estimator.score(x_test, y_test)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;æ­£ç¡®ç‡:&quot;</span>, score)</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¾“å‡ºç»“æœ\"><a class=\"markdownIt-Anchor\" href=\"#è¾“å‡ºç»“æœ\">#</a> è¾“å‡ºç»“æœ</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">é¢„æµ‹å€¼ä¸º: </span><br><span class=\"line\"> [0 2 1 2 1 1 1 2 1 0 2 1 2 2 0 2 1 1 1 1 0 2 0 1 2 0 2 2 2 2]</span><br><span class=\"line\">æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼;</span><br><span class=\"line\"> [ True  True  True  True  True  True  True  True  True  True  True  True</span><br><span class=\"line\">  True  True  True  True  True  True False  True  True  True  True  True</span><br><span class=\"line\">  True  True  True  True  True  True]</span><br><span class=\"line\">æ­£ç¡®ç‡: 0.9666666666666667</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä½¿ç”¨-gscv-ä¼˜åŒ–\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨-gscv-ä¼˜åŒ–\">#</a> ä½¿ç”¨ GSCV ä¼˜åŒ–</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> load_iris</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.model_selection <span class=\"keyword\">import</span> train_test_split, GridSearchCV</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.preprocessing <span class=\"keyword\">import</span> StandardScaler</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.neighbors <span class=\"keyword\">import</span> KNeighborsClassifier</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">iris_demo</span>():</span></span><br><span class=\"line\">    <span class=\"comment\"># 1.å‡†å¤‡æ•°æ®</span></span><br><span class=\"line\">    iris = load_iris()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2.æ•°æ®åŸºæœ¬å¤„ç†</span></span><br><span class=\"line\">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=<span class=\"number\">22</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 3.ç‰¹å¾å·¥ç¨‹</span></span><br><span class=\"line\">    <span class=\"comment\"># 3.1 æ ‡å‡†åŒ–</span></span><br><span class=\"line\">    transfer = StandardScaler()</span><br><span class=\"line\">    x_train = transfer.fit_transform(x_train)</span><br><span class=\"line\">    x_test = transfer.transform(x_test)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 4.æœºå™¨è®­ç»ƒ(æ¨¡å‹è®­ç»ƒ)</span></span><br><span class=\"line\">    estimator = KNeighborsClassifier()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 4.1 å‡†å¤‡è¦è°ƒçš„è¶…å‚æ•°</span></span><br><span class=\"line\">    param_dict = &#123;<span class=\"string\">&quot;n_neighbors&quot;</span>: [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>]&#125;</span><br><span class=\"line\">    <span class=\"comment\"># 4.2 åˆ›å»º GridSearchCV,ä½¿ç”¨ç½‘æ ¼æœç´¢å’Œäº¤å‰éªŒè¯</span></span><br><span class=\"line\">    estimator = GridSearchCV(estimator, param_grid=param_dict, cv=<span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    estimator.fit(x_train, y_train)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 5.æ¨¡å‹è¯„ä¼°</span></span><br><span class=\"line\">    <span class=\"comment\"># 5.1  æ–¹æ³•1ï¼šæ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼</span></span><br><span class=\"line\">    predict_data = estimator.predict(x_test)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;é¢„æµ‹å€¼ä¸º: \\n&quot;</span>, predict_data)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼;\\n&quot;</span>, predict_data == y_test)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 5.2  æ–¹æ³•2: ç›´æ¥è®¡ç®—æ­£ç¡®ç‡</span></span><br><span class=\"line\">    score = estimator.score(x_test, y_test)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;æ­£ç¡®ç‡:&quot;</span>, score)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 6. ç›´æ¥æŸ¥çœ‹è¯„ä¼°ç»“æœå“¦</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;åœ¨äº¤å‰éªŒè¯ä¸­éªŒè¯çš„æœ€å¥½ç»“æœï¼š&quot;</span>, estimator.best_score_)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;æœ€å¥½çš„å‚æ•°æ¨¡å‹ï¼š&quot;</span>, estimator.best_estimator_)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;æ¯æ¬¡äº¤å‰éªŒè¯åçš„å‡†ç¡®ç‡ç»“æœï¼š\\n&quot;</span>, estimator.cv_results_)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    iris_demo()</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¾“å‡ºç»“æœ-2\"><a class=\"markdownIt-Anchor\" href=\"#è¾“å‡ºç»“æœ-2\">#</a> è¾“å‡ºç»“æœ</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">é¢„æµ‹å€¼ä¸º: </span><br><span class=\"line\"> [0 2 1 2 1 1 1 1 1 0 2 1 2 2 0 2 1 1 1 1 0 2 0 1 2 0 2 2 2 2 0 0 1 1 1 0 0</span><br><span class=\"line\"> 0]</span><br><span class=\"line\">æ¯”å¯¹çœŸå®å€¼å’Œé¢„æµ‹å€¼;</span><br><span class=\"line\"> [ True  True  True  True  True  True  True False  True  True  True  True</span><br><span class=\"line\">  True  True  True  True  True  True False  True  True  True  True  True</span><br><span class=\"line\">  True  True  True  True  True  True  True  True  True  True  True  True</span><br><span class=\"line\">  True  True]</span><br><span class=\"line\">æ­£ç¡®ç‡: 0.9473684210526315</span><br><span class=\"line\">åœ¨äº¤å‰éªŒè¯ä¸­éªŒè¯çš„æœ€å¥½ç»“æœï¼š 0.9732100521574205</span><br><span class=\"line\">æœ€å¥½çš„å‚æ•°æ¨¡å‹ï¼š KNeighborsClassifier()</span><br><span class=\"line\">æ¯æ¬¡äº¤å‰éªŒè¯åçš„å‡†ç¡®ç‡ç»“æœï¼š</span><br><span class=\"line\"> &#123;&#x27;mean_fit_time&#x27;: array([0.0008928 , 0.00045244, 0.00044529]), &#x27;std_fit_time&#x27;: array([5.74547103e-04, 5.05512361e-06, 2.92218150e-06]), &#x27;mean_score_time&#x27;: array([0.00226967, 0.00184425, 0.00182239]), &#x27;std_score_time&#x27;: array([6.28895378e-04, 2.09757168e-05, 1.41269575e-05]), &#x27;param_n_neighbors&#x27;: masked_array(data=[1, 3, 5],</span><br><span class=\"line\">             mask=[False, False, False],</span><br><span class=\"line\">       fill_value=&#x27;?&#x27;,</span><br><span class=\"line\">            dtype=object), &#x27;params&#x27;: [&#123;&#x27;n_neighbors&#x27;: 1&#125;, &#123;&#x27;n_neighbors&#x27;: 3&#125;, &#123;&#x27;n_neighbors&#x27;: 5&#125;], &#x27;split0_test_score&#x27;: array([0.97368421, 0.97368421, 0.97368421]), &#x27;split1_test_score&#x27;: array([0.97297297, 0.97297297, 0.97297297]), &#x27;split2_test_score&#x27;: array([0.94594595, 0.89189189, 0.97297297]), &#x27;mean_test_score&#x27;: array([0.96420104, 0.94618303, 0.97321005]), &#x27;std_test_score&#x27;: array([0.01291157, 0.03839073, 0.00033528]), &#x27;rank_test_score&#x27;: array([2, 3, 1], dtype=int32)&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"é¢„æµ‹facebookç­¾åˆ°ä½ç½®\"><a class=\"markdownIt-Anchor\" href=\"#é¢„æµ‹facebookç­¾åˆ°ä½ç½®\">#</a> é¢„æµ‹ facebook ç­¾åˆ°ä½ç½®</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.model_selection <span class=\"keyword\">import</span> train_test_split</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.preprocessing <span class=\"keyword\">import</span> StandardScaler</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.neighbors <span class=\"keyword\">import</span> KNeighborsClassifier</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.model_selection <span class=\"keyword\">import</span> GridSearchCV</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">facebook_demo</span>():</span></span><br><span class=\"line\">    <span class=\"comment\"># å‡†å¤‡æ•°æ®</span></span><br><span class=\"line\">    data = pd.read_csv(<span class=\"string\">&#x27;./train.csv&#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(data.head())</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2.æ•°æ®åŸºæœ¬å¤„ç†</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">## 2.1 å¤„ç†æ—¶é—´ç‰¹å¾</span></span><br><span class=\"line\">    time = pd.to_datetime(data[<span class=\"string\">&#x27;time&#x27;</span>], unit=<span class=\"string\">&#x27;s&#x27;</span>)</span><br><span class=\"line\">    time = pd.DatetimeIndex(time)</span><br><span class=\"line\"></span><br><span class=\"line\">    data[<span class=\"string\">&#x27;hour&#x27;</span>] = time.hour</span><br><span class=\"line\">    data[<span class=\"string\">&#x27;day&#x27;</span>] = time.day</span><br><span class=\"line\">    data[<span class=\"string\">&#x27;weekday&#x27;</span>] = time.weekday</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(data.head(<span class=\"number\">10</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2.2.å»æ‰ç­¾åˆ°å°‘çš„åœ°æ–¹</span></span><br><span class=\"line\">    place_count = data.groupby(<span class=\"string\">&quot;place_id&quot;</span>).count()</span><br><span class=\"line\">    place_count = place_count[place_count[<span class=\"string\">&quot;row_id&quot;</span>] &gt; <span class=\"number\">3</span>]</span><br><span class=\"line\">    data = data[data[<span class=\"string\">&quot;place_id&quot;</span>].isin(place_count.index)]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2.3 ç¡®å®šç‰¹å¾å’Œç›®æ ‡å€¼</span></span><br><span class=\"line\">    x = data[[<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"string\">&#x27;y&#x27;</span>, <span class=\"string\">&quot;accuracy&quot;</span>, <span class=\"string\">&quot;day&quot;</span>, <span class=\"string\">&quot;hour&quot;</span>, <span class=\"string\">&quot;weekday&quot;</span>]]</span><br><span class=\"line\">    y = data[[<span class=\"string\">&#x27;place_id&#x27;</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2.4 æ‹†åˆ†æ•°æ®é›†</span></span><br><span class=\"line\">    x_train, x_test, y_train, y_test = train_test_split(x, y, random_state=<span class=\"number\">22</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 3. ç‰¹å¾å¤„ç†</span></span><br><span class=\"line\">    <span class=\"comment\"># 3.1 æ ‡å‡†åŒ–å¤„ç†</span></span><br><span class=\"line\">    transfer = StandardScaler()</span><br><span class=\"line\">    x_train = transfer.fit_transform(x_train)</span><br><span class=\"line\">    x_test = transfer.transform(x_test)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 4.æœºå™¨å­¦ä¹ </span></span><br><span class=\"line\">    <span class=\"comment\"># 4.1 å®ä¾‹åŒ–ä¼°è®¡å™¨</span></span><br><span class=\"line\">    estimator = KNeighborsClassifier()</span><br><span class=\"line\">    param_dict = &#123;<span class=\"string\">&#x27;neighbors&#x27;</span>: [<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>]&#125;</span><br><span class=\"line\">    estimator = GridSearchCV(estimator=estimator, param_grid=param_dict)</span><br><span class=\"line\">    <span class=\"comment\"># 4.2 æ¨¡å‹è®­ç»ƒ</span></span><br><span class=\"line\">    estimator.fit(x_train, y_train)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># æ¨¡å‹è¯„ä¼°</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\næœ€åé¢„æµ‹çš„å‡†ç¡®ç‡ä¸º: &quot;</span>, estimator.score(x_test, y_test))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\nåœ¨äº¤å‰éªŒè¯ä¸­éªŒè¯çš„æœ€å¥½ç»“æœ:\\n&quot;</span>, estimator.best_score_)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\næœ€å¥½çš„å‚æ•°æ¨¡å‹:\\n&quot;</span>, estimator.best_estimator_)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\næ¯æ¬¡äº¤å‰éªŒè¯åçš„éªŒè¯é›†å‡†ç¡®ç‡ç»“æœå’Œè®­ç»ƒé›†å‡†ç¡®ç‡ç»“æœ:\\n&quot;</span>, estimator.cv_results_)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    facebook_demo()</span><br></pre></td></tr></table></figure>\n<p>æœ¬æ¡ˆä¾‹æ¥è‡ª  <code>Kaggle</code>  çš„é¢˜ç›®ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç™»å½•:<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2FnZ2xlLmNvbS9uYXZvc2h0YS9ncmlkLWtubi9zY3JpcHQ=\">https://www.kaggle.com/navoshta/grid-knn/script</span>  æŸ¥çœ‹</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/ml/qrcode.jpg\" alt=\"qrcode\"></p>\n",
            "tags": [
                "MachineLearn",
                "KNN"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/28/machine-learn/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A001-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BA%86%E8%A7%A3/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/28/machine-learn/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A001-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BA%86%E8%A7%A3/",
            "title": "æœºå™¨å­¦ä¹ -ç®€ä»‹",
            "date_published": "2021-10-28T10:18:00.000Z",
            "content_html": "<h2 id=\"æ¦‚è¿°\"><a class=\"markdownIt-Anchor\" href=\"#æ¦‚è¿°\">#</a> æ¦‚è¿°</h2>\n<h3 id=\"ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ \"><a class=\"markdownIt-Anchor\" href=\"#ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ \">#</a> ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ </h3>\n<p>ä»å†å²æ•°æ®ä¸­è‡ªåŠ¨åˆ†æè·å¾—è§„å¾‹ (æ¨¡å‹), å¹¶åˆ©ç”¨è§„å¾‹å¯¹æœªçŸ¥æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆéœ€è¦æœºå™¨å­¦ä¹ \"><a class=\"markdownIt-Anchor\" href=\"#ä¸ºä»€ä¹ˆéœ€è¦æœºå™¨å­¦ä¹ \">#</a> ä¸ºä»€ä¹ˆéœ€è¦æœºå™¨å­¦ä¹ </h3>\n<p>è§£æ”¾ç”Ÿäº§åŠ›ï¼šæ™ºèƒ½å®¢æœ<br>\nè§£å†³ä¸“ä¸šé—®é¢˜: ET åŒ»ç–—<br>\næä¾›ç¤¾ä¼šä¾¿åˆ©ï¼šæä¾›ç¤¾ä¼šä¾¿åˆ©</p>\n<h3 id=\"æœºå™¨å­¦ä¹ çš„åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#æœºå™¨å­¦ä¹ çš„åº”ç”¨åœºæ™¯\">#</a> æœºå™¨å­¦ä¹ çš„åº”ç”¨åœºæ™¯</h3>\n<p>æ–¹æ–¹é¢é¢</p>\n<h2 id=\"æœºå™¨å­¦ä¹ çš„å·¥ä½œæµç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#æœºå™¨å­¦ä¹ çš„å·¥ä½œæµç¨‹\">#</a> æœºå™¨å­¦ä¹ çš„å·¥ä½œæµç¨‹</h2>\n<p>è·å–æ•°æ® -&gt; æ•°æ®åŸºæœ¬å¤„ç† -&gt; ç‰¹å¾å·¥ç¨‹ -&gt; æœºå™¨å­¦ä¹  (æ¨¡å‹è®­ç»ƒ) -&gt; æ¨¡å‹è¯„ä¼°ã€‚</p>\n<p>è¯„ä¼°ç¬¦åˆè¦æ±‚ï¼Œåˆ™ä¸Šçº¿æœåŠ¡ã€‚å¦‚æœä¸ç¬¦åˆè¦æ±‚ï¼Œåˆ™é‡å¤ä¸Šè¿°æ­¥éª¤ã€‚</p>\n<h2 id=\"æ•°æ®é›†çš„ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®é›†çš„ç»“æ„\">#</a> æ•°æ®é›†çš„ç»“æ„</h2>\n<p>æœºå™¨å­¦ä¹ çš„æ•°æ®å¤§éƒ¨åˆ†æ•°æ®å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ã€‚æ•°æ®åº“ä¸­é—´ä»¶ (mysql,nosql) ç­‰æ€§èƒ½ç“¶é¢ˆï¼Œè¯»å–é€Ÿåº¦ï¼Œæ ¼å¼ä¸ç¬¦åˆæœºå™¨å­¦ä¹ è¦æ±‚çš„æ•°æ®æ ¼å¼ã€‚<br>\nnumpy éå¸¸å¿«ï¼Œå› ä¸ºä»€ä¹ˆï¼Ÿé‡Šæ”¾äº† GILã€‚</p>\n<p>åœ¨æ•°æ®é›†ä¸­ï¼š<br>\nä¸€è¡Œæ•°æ®æˆä¸ºä¸€ä¸ªæ ·æœ¬ã€‚<br>\nä¸€åˆ—æ•°æ®ç§°ä¸ºä¸€ä¸ªç‰¹å¾ã€‚</p>\n<h3 id=\"å¯ç”¨çš„æ•°æ®é›†\"><a class=\"markdownIt-Anchor\" href=\"#å¯ç”¨çš„æ•°æ®é›†\">#</a> å¯ç”¨çš„æ•°æ®é›†</h3>\n<p>Kaggle: å¤§æ•°æ®ç«èµ›å¹³å°ï¼Œ80 ä¸‡ç§‘å­¦å®¶ï¼ŒçœŸå®æ•°æ®ï¼Œæ•°æ®é‡å·¨å¤§ <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2FnZ2xlLmNvbS9kYXRhc2V0cw==\">https://www.kaggle.com/datasets</span></p>\n<p>UCI: æ”¶å½•äº† 360 ä¸ªæ•°æ®é›†ã€‚è¦†ç›–ç§‘å­¦ï¼Œç”Ÿæ´»ç»æµç­‰é¢†åŸŸï¼Œæ•°æ®é‡å‡ åä¸‡ <span class=\"exturl\" data-url=\"aHR0cDovL2FyY2hpdmUuaWNzLnVjaS5lZHUvbWwvaW5kZXgucGhw\">http://archive.ics.uci.edu/ml/index.php</span></p>\n<p>scikit-learn: æ•°æ®é‡å°ï¼Œæ–¹ä¾¿å­¦ä¹ ã€‚<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnL3N0YWJsZS8saHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnL3N0YWJsZS9zdGFibGUvZGF0YXNldHMvaW5kZXguaHRtbA==\">https://scikit-learn.org/stable/,https://scikit-learn.org/stable/stable/datasets/index.html</span></p>\n<h3 id=\"å¸¸ç”¨æ•°æ®é›†æ•°æ®çš„ç»“æ„ç»„æˆ\"><a class=\"markdownIt-Anchor\" href=\"#å¸¸ç”¨æ•°æ®é›†æ•°æ®çš„ç»“æ„ç»„æˆ\">#</a> å¸¸ç”¨æ•°æ®é›†æ•°æ®çš„ç»“æ„ç»„æˆ</h3>\n<ul>\n<li>ç‰¹å¾å€¼ + ç›®æ ‡å€¼ (ç›®æ ‡å€¼æ˜¯ç»ƒä¹ çš„å’Œç¦»æ•£çš„)ã€‚ç‰¹å¾ï¼Ÿæ¯”å¦‚åˆ†è¾¨ç”·å¥³ï¼Œä¸€ä¸ªäººèº«é«˜ä½“é‡çš®è‚¤é¢œè‰²ï¼Œå¤´å‘é•¿åº¦ã€‚éƒ½æ˜¯ç‰¹å¾å€¼ã€‚ç›®æ ‡å€¼ï¼šè¿™ä¸ªäººæ˜¯ç”·æ˜¯å¥³ï¼Œå°±æ˜¯ç›®æ ‡å€¼ã€‚</li>\n<li>åªæœ‰ç‰¹å¾å€¼ï¼Œæ²¡æœ‰ç›®æ ‡å€¼</li>\n</ul>\n<h3 id=\"æ•°æ®åˆ†å‰²\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®åˆ†å‰²\">#</a> æ•°æ®åˆ†å‰²</h3>\n<p>æœºå™¨å­¦ä¹ ä¸€èˆ¬çš„æ•°æ®é›†ä¼šåˆ’åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚</p>\n<ul>\n<li>è®­ç»ƒæ•°æ®ï¼šç”¨äºè®­ç»ƒï¼Œæ„å»ºæ¨¡å‹</li>\n<li>æµ‹è¯•æ•°æ®ï¼šåœ¨æ•°æ®æ£€éªŒæ—¶ä½¿ç”¨ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ˜¯å¦æœ‰æ•ˆã€</li>\n</ul>\n<p>åˆ’åˆ†æ¯”ä¾‹ï¼š</p>\n<ul>\n<li>è®­ç»ƒé›†ï¼š 79% 80% 75%</li>\n<li>æµ‹è¯•é›†ï¼š 30%ï¼Œ 20% 25%</li>\n</ul>\n<h2 id=\"æ•°æ®çš„ç‰¹å¾å·¥ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®çš„ç‰¹å¾å·¥ç¨‹\">#</a> æ•°æ®çš„ç‰¹å¾å·¥ç¨‹</h2>\n<h3 id=\"æ•°æ®ç‰¹å¾æ˜¯ä»€ä¹ˆ\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®ç‰¹å¾æ˜¯ä»€ä¹ˆ\">#</a> æ•°æ®ç‰¹å¾æ˜¯ä»€ä¹ˆ</h3>\n<p>å°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºæ›´å¥½çš„ä»£è¡¨é¢„æµ‹æ¨¡å‹çš„æ½œåœ¨é—®é¢˜çš„ç‰¹å¾çš„è¿‡ç¨‹ï¼Œä»è€Œæé«˜å¯¹æœªçŸ¥æ•°æ®çš„é¢„æµ‹å‡†ç¡®æ€§ã€‚</p>\n<p>ä½¿ç”¨ä¸“ä¸šèƒŒæ™¯çŸ¥è¯†å’ŒæŠ€å·§å¤„ç†æ•°æ®ï¼Œä½¿å¾—ç‰¹å¾èƒ½åœ¨æœºå™¨å­¦ä¹ ç®—æ³•ä¸Šå‘é€æ›´å¥½çš„ä½œç”¨çš„è¿‡ç¨‹ã€‚</p>\n<ul>\n<li>\n<p>ç‰¹å¾æå–ï¼š å°†ä»»æ„æ•°æ® (æ–‡æœ¬æˆ–è€…å›¾åƒ) è½¬æ¢ä¸ºå¯ç”¨äºæœºå™¨å­¦ä¹ çš„æ•°å­—ç‰¹å¾ã€‚</p>\n</li>\n<li>\n<p>ç‰¹å¾é¢„å¤„ç†ï¼šé€šè¿‡è½¬åŒ–å‡½æ•°å°†ç‰¹å¾æ•°æ®è½¬æ¢æˆæ›´åŠ é€‚åˆç®—æ³•æ¨¡å‹çš„ç‰¹å¾æ•°æ®è¿‡ç¨‹ã€‚</p>\n<ul>\n<li>å½’ä¸€åŒ–ï¼šä¸ºä»€ä¹ˆè¦è¿›è¡Œå½’ä¸€åŒ–ï¼Ÿç‰¹å¾çš„å•ä½æˆ–è€…å¤§å°ç›¸å·®è¾ƒå¤§ï¼Œæˆ–è€…æŸç‰¹å¾çš„æ–¹æ³•ç›¸æ¯”å…¶ä»–ç‰¹å¾è¦å¤§å‡ºå‡ ä¸ªæ•°é‡çº§ï¼Œå®¹æ˜“å½±å“ (æ”¯é…) ç›®æ ‡ç»“æœï¼Œä½¿å¾—ç®—æ³•æ— æ³•å­¦ä¹ åˆ°å…¶ä»–çš„ç‰¹å¾ã€‚\n<ul>\n<li>å½’ä¸€åŒ–çš„å®šä¹‰ï¼š é€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œå˜æ¢ï¼ŒæŠŠæ•°æ®æ˜ å°„åˆ°é»˜è®¤ <code>[0,1]</code>  ä¹‹é—´ã€‚<br>\nè®¡ç®—å…¬å¼:<br>\n<img data-src=\"./images/%E5%BD%92%E4%B8%80%E5%8C%96%E5%85%AC%E5%BC%8F.png\" alt=\"\"></li>\n</ul>\n</li>\n<li>æ ‡å‡†åŒ–ï¼šé€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡ŒæŠŠæ•°æ®å˜æ¢åˆ°å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1 çš„èŒƒå›´å†…ã€‚<br>\n<img data-src=\"./images/%E6%A0%87%E5%87%86%E5%8C%96%E5%85%AC%E5%BC%8F.png\" alt=\"\"><br>\nå¯¹äºå½’ä¸€åŒ–æ¥è¯´ï¼šå¦‚æœå‡ºç°å¼‚å¸¸ç‚¹ï¼Œå½±å“äº†æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œé‚£ä¹ˆç»“æœæ˜¾ç„¶ä¼šå‘ç”Ÿæ”¹å˜<br>\nå¯¹äºæ ‡å‡†åŒ–æ¥è¯´ï¼šå¦‚æœå‡ºç°å¼‚å¸¸ç‚¹ï¼Œç”±äºå…·æœ‰ä¸€å®šæ•°æ®é‡ï¼Œå°‘é‡çš„å¼‚å¸¸ç‚¹å¯¹äºå¹³å‡å€¼çš„å½±å“å¹¶ä¸å¤§ï¼Œä»è€Œæ–¹å·®æ”¹å˜è¾ƒå°ã€‚</li>\n</ul>\n</li>\n<li>\n<p>ç‰¹å¾é™ç»´ï¼šæŒ‡åœ¨é™å®šæ¡ä»¶ä¸‹ï¼Œé™ä½éšæœºå˜é‡ (ç‰¹å¾) ä¸ªæ•°ï¼Œå¾—åˆ°ä¸€ç»„ &quot;ä¸ç›¸å…³&quot; ä¸»å˜é‡çš„è¿‡ç¨‹ã€‚<br>\nå‡å°‘ç‰¹å¾çš„æ•°é‡ï¼ŒåŒæ—¶ä¿ç•™åŸæ¥æ•°æ®çš„å¤§éƒ¨åˆ†ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ PCA ç®—æ³•æ¥æ˜¯å®ç°ç‰¹å¾é™ç»´ã€‚</p>\n</li>\n</ul>\n<p>ä¸ºä»€ä¹ˆè¦é™ç»´å‘¢ï¼Ÿéšç€æ•°æ®ç»´åº¦ä¸æ–­é™ä½ï¼Œæ•°æ®å­˜å‚¨æ‰€éœ€çš„ç©ºé—´ä¹Ÿä¼šéšä¹‹å‡å°‘ã€‚ä½ç»´æ•°æ®æœ‰åŠ©äºå‡å°‘è®¡ç®— / è®­ç»ƒç”¨æ—¶ã€‚ä¸€äº›ç®—æ³•åœ¨é«˜ç»´åº¦æ•°æ®ä¸Šå®¹æ˜“è¡¨ç°ä¸ä½³ï¼Œé™ç»´å¯æé«˜ç®—æ³•å¯ç”¨æ€§ã€‚é™ç»´å¯ä»¥ç”¨åˆ é™¤å†—ä½™ç‰¹å¾è§£å†³å¤šé‡å…±çº¿æ€§é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªå˜é‡ï¼šâ€œä¸€æ®µæ—¶é—´å†…åœ¨è·‘æ­¥æœºä¸Šçš„è€—æ—¶â€ å’Œ â€œå¡è·¯é‡Œæ¶ˆè€—é‡â€ã€‚è¿™ä¸¤ä¸ªå˜é‡é«˜åº¦ç›¸å…³ï¼Œåœ¨è·‘æ­¥æœºä¸ŠèŠ±çš„æ—¶é—´è¶Šé•¿ï¼Œç‡ƒçƒ§çš„å¡è·¯é‡Œè‡ªç„¶å°±è¶Šå¤šã€‚å› æ­¤ï¼ŒåŒæ—¶å­˜å‚¨è¿™ä¸¤ä¸ªæ•°æ®æ„ä¹‰ä¸å¤§ï¼Œåªéœ€ä¸€ä¸ªå°±å¤Ÿäº†ã€‚é™ç»´æœ‰åŠ©äºæ•°æ®å¯è§†åŒ–ã€‚å¦‚å‰æ‰€è¿°ï¼Œå¦‚æœæ•°æ®ç»´åº¦å¾ˆé«˜ï¼Œå¯è§†åŒ–ä¼šå˜å¾—ç›¸å½“å›°éš¾ï¼Œè€Œç»˜åˆ¶äºŒç»´ä¸‰ç»´æ•°æ®çš„å›¾è¡¨éå¸¸ç®€å•ã€‚</p>\n<h3 id=\"ç‰¹å¾å·¥ç¨‹çš„æ„ä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾å·¥ç¨‹çš„æ„ä¹‰\">#</a> ç‰¹å¾å·¥ç¨‹çš„æ„ä¹‰</h3>\n<p>ç›´æ¥å½±å“é¢„æµ‹ç»“æœã€‚</p>\n<h4 id=\"ç‰¹å¾æŠ½å–å®ä¾‹æ¼”ç¤º\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾æŠ½å–å®ä¾‹æ¼”ç¤º\">#</a> ç‰¹å¾æŠ½å–å®ä¾‹æ¼”ç¤º</h4>\n<h4 id=\"ç‰¹å¾æŠ½å–api\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾æŠ½å–api\">#</a> ç‰¹å¾æŠ½å– API</h4>\n<p>å­—å…¸ç‰¹å¾æŠ½å–ç±»:   <code>sklearn.feature_extraction.DictVectorizer</code> <br>\n ä½œç”¨ï¼šå¯¹å­—å…¸è¿›è¡Œç‰¹å¾å€¼åŒ–ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DictVectorizer(sparse=<span class=\"literal\">True</span>,....)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># X: å­—å…¸æˆ–è€…åŒ…å«å­—å…¸çš„è¿­ä»£å™¨</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼: è¿”å›sparseçŸ©é˜µ</span></span><br><span class=\"line\">DictVectorizer.fit_transform(X):</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># X: arrayæ•°ç»„æˆ–è€…sparseçŸ©é˜µ</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼: è½¬æ¢ä¹‹å‰çš„æ•°æ®æ ¼å¼</span></span><br><span class=\"line\">DictVectorizer.invers_transform(X)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›ç±»åˆ«åç§°</span></span><br><span class=\"line\">DictVectorizer.get_feature_names()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŒ‰ç…§åŸå…ˆçš„æ ‡å‡†è½¬æ¢</span></span><br><span class=\"line\">DictVectorizerr.transform(X)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h5 id=\"ä½¿ç”¨æµç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨æµç¨‹\">#</a> ä½¿ç”¨æµç¨‹</h5>\n<p>1. å®ä¾‹åŒ–ç±» DictVectorizer<br>\n2. è°ƒç”¨ fit_transform æ–¹æ³•è¿›è¡Œç‰¹å¾æŠ½å–</p>\n<h4 id=\"å­—å…¸æ•°æ®æå–çš„ç°è±¡\"><a class=\"markdownIt-Anchor\" href=\"#å­—å…¸æ•°æ®æå–çš„ç°è±¡\">#</a> å­—å…¸æ•°æ®æå–çš„ç°è±¡:</h4>\n<p>æŠŠå­—å…¸ä¸­å›½çš„ä¸€äº›ç±»åˆ«æ•°æ®ï¼Œåˆ†åˆ«è¿›è¡Œè½¬æ¢ç‰¹å¾æ•°æ®ã€‚</p>\n<blockquote>\n<p>æ–‡æœ¬ç‰¹å¾æŠ½å– Count</p>\n</blockquote>\n<h4 id=\"ä½œç”¨-å¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œç‰¹å¾å€¼åŒ–\"><a class=\"markdownIt-Anchor\" href=\"#ä½œç”¨-å¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œç‰¹å¾å€¼åŒ–\">#</a> ä½œç”¨ï¼šå¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œç‰¹å¾å€¼åŒ–</h4>\n<h4 id=\"ç±»-sklearnfeature_extractiontextcountvectorizer\"><a class=\"markdownIt-Anchor\" href=\"#ç±»-sklearnfeature_extractiontextcountvectorizer\">#</a> ç±»: sklearn.feature_extraction.text.CountVectorizer</h4>\n<h4 id=\"api\"><a class=\"markdownIt-Anchor\" href=\"#api\">#</a> API</h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿”å›çš„æ˜¯è¯é¢‘çŸ©é˜µ</span></span><br><span class=\"line\">CountVectorizer()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># ç»Ÿè®¡æ‰€æœ‰æ–‡ç« ä¸­å‡ºç°çš„è¯çš„ä½ç½®æ ‡è¯†ï¼Œå¯¹åº”ç€åˆ—è¡¨ä¸­çš„å•è¯(å•ä¸ªå­—æ¯ä¸ç»Ÿè®¡,ä¸æ”¯æŒä¸­æ–‡,éœ€è¦ä½¿ç”¨jiebaåˆ†è¯)ï¼Œ</span></span><br><span class=\"line\">    <span class=\"comment\"># X æ–‡æœ¬æˆ–è€…åŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²çš„å¯è¿­ä»£å¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: è¿”å›sparseçŸ©é˜µ</span></span><br><span class=\"line\">    CountVectorizer.fit_transform(X)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># Xï¼š arrayæ•°æ®æˆ–è€…sparseçŸ©é˜µ</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼ï¼šè½¬æ¢ä¹‹å‰çš„æ•°æ®æ ¼å¼</span></span><br><span class=\"line\">    CountVetorizer.inverse_transform(X)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: å•è¯åˆ—è¡¨</span></span><br><span class=\"line\">    CountVetorizer.get_feature_names()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ–‡æœ¬ç‰¹å¾æŠ½å– tfidf</p>\n</blockquote>\n<p>ä¸»è¦æ€æƒ³æ˜¯ï¼š å¦‚æœæŸä¸ªè¯æˆ–çŸ­è¯­åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å‡ºç°çš„æ¦‚ç‡é«˜ï¼Œb å¹¶ä¸”åœ¨å…¶ä»–æ–‡ç« ä¸­å¾ˆå°‘å‡ºç°ï¼Œåˆ™è®¤ä¸ºè¯¥è¯æˆ–è€…çŸ­è¯­å…·æœ‰å¾ˆå¥½çš„ç±»åˆ«åŒºåˆ†èƒ½åŠ›ï¼Œé€‚åˆç”¨æ¥åˆ†ç±»ã€‚</p>\n<p>TF-IDF çš„ä½œç”¨ï¼š  ç”¨ä»¥è¯„ä¼°ä¸€å­—è¯å¯¹äºä¸€ä¸ªæ–‡ä»¶é›†æˆä¸€ä¸ªè¯­æ–™åº“ä¸­çš„å…¶ä¸­ä¸€ä»½æ–‡ä»¶çš„é‡è¦ç¨‹åº¦ã€‚</p>\n<p>tf (term frequency è¯çš„é¢‘ç‡)<br>\n idf (inverse document frequency é€†æ–‡æ¡£é¢‘ç‡) log (æ€»æ–‡æ¡£æ•°æ® / è¯¥è¯å‡ºç°çš„æ–‡æ¡£æ•°é‡)</p>\n<p>tf * idf è¿™ä¸ªå€¼ç§°ä¸ºé‡è¦æ€§ã€‚</p>\n<h4 id=\"ç±»-sklearnfeature_extractiontexttfidfvectorizer\"><a class=\"markdownIt-Anchor\" href=\"#ç±»-sklearnfeature_extractiontexttfidfvectorizer\">#</a> ç±»  <code>sklearn.feature_extraction.text.TfidfVectorizer </code></h4>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿”å›çš„æ˜¯è¯é¢‘çŸ©é˜µ</span></span><br><span class=\"line\">CountVectorizer(stop_worlds=N)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># ç»Ÿè®¡æ‰€æœ‰æ–‡ç« ä¸­å‡ºç°çš„è¯çš„ä½ç½®æ ‡è¯†ï¼Œå¯¹åº”ç€åˆ—è¡¨ä¸­çš„å•è¯(å•ä¸ªå­—æ¯ä¸ç»Ÿè®¡,ä¸æ”¯æŒä¸­æ–‡,éœ€è¦ä½¿ç”¨jiebaåˆ†è¯)ï¼Œ</span></span><br><span class=\"line\">    <span class=\"comment\"># X æ–‡æœ¬æˆ–è€…åŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²çš„å¯è¿­ä»£å¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: è¿”å›sparseçŸ©é˜µ</span></span><br><span class=\"line\">    CountVectorizer.fit_transform(X)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># Xï¼š arrayæ•°æ®æˆ–è€…sparseçŸ©é˜µ</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼ï¼šè½¬æ¢ä¹‹å‰çš„æ•°æ®æ ¼å¼</span></span><br><span class=\"line\">    CountVetorizer.inverse_transform(X)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: å•è¯åˆ—è¡¨</span></span><br><span class=\"line\">    CountVetorizer.get_feature_names()</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä¸ºä»€ä¹ˆéœ€è¦è¿™\"><a class=\"markdownIt-Anchor\" href=\"#ä¸ºä»€ä¹ˆéœ€è¦è¿™\">#</a> ä¸ºä»€ä¹ˆéœ€è¦è¿™</h4>\n<p>åˆ†ç±»æœºå™¨å­¦ä¹ ç®—æ³•çš„åº”ç”¨åŸºç¡€ã€‚</p>\n<h4 id=\"åº”ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#åº”ç”¨\">#</a> åº”ç”¨</h4>\n<ul>\n<li>æ–‡æœ¬åˆ†ç±»</li>\n<li>æƒ…æ„Ÿåˆ†æ</li>\n</ul>\n<h4 id=\"æ•°æ®çš„é¢„å¤„ç†\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®çš„é¢„å¤„ç†\">#</a> æ•°æ®çš„é¢„å¤„ç†</h4>\n<p>é€šè¿‡ç‰¹å®šçš„ç»Ÿè®¡æ–¹æ³• (æ•°å­¦æ–¹æ³•), å°†æ•°æ®è½¬æ¢æˆç®—æ³•è¦æ±‚çš„æ•°æ®ã€‚</p>\n<h5 id=\"æ•°æ®å¤„ç†çš„æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®å¤„ç†çš„æ–¹æ³•\">#</a> æ•°æ®å¤„ç†çš„æ–¹æ³•</h5>\n<p>API:<br>\n åœ¨ sklearn.preprocessing ä¸­ã€‚</p>\n<ul>\n<li>\n<p>æ•°å€¼å‹æ•°æ®:</p>\n<ul>\n<li>\n<p>æ ‡å‡†ç¼©æ”¾</p>\n<ul>\n<li>\n<p>å½’ä¸€åŒ–:<br>\n é€šè¿‡å¯¹åŸå§‹æ•°æ®æœºå‹äº¤æ¢æŠŠæ•°æ®æ˜ å°„åˆ° (é»˜è®¤ [0,1]) ä¹‹é—´<br>\n<img data-src=\"./images/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E5%BD%92%E4%B8%80%E5%BD%92%E4%B8%80%E5%8C%96%E5%85%AC%E5%BC%8F.png\" alt=\"æœºå™¨å­¦ä¹ _å½’ä¸€å½’ä¸€åŒ–å…¬å¼.png\"><br>\n <code> API: MinMaxScalar</code> <br>\n å®ç°å½’ä¸€åŒ–çš„æ­¥éª¤ï¼š</p>\n<ul>\n<li>å®ä¾‹åŒ– <code>MinMaxScalar</code></li>\n<li>è°ƒç”¨  <code>fit_transform</code>  è¿›è¡Œè½¬æ¢</li>\n</ul>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mm = MinMaxScalar(feature_range=(<span class=\"number\">2</span>,<span class=\"number\">3</span>))</span><br><span class=\"line\">data = mm.fit_transform([[],[],[]])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(data)</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>æ ‡å‡†åŒ–<br>\né€šè¿‡å¯¹åŸå§‹æ•°æ®è¿›è¡Œå˜æ¢æŠŠæ•°æ®å˜æ¢åˆ°å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1 çš„èŒƒå›´å†…ã€‚<br>\n<img data-src=\"./images/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%A0%87%E5%87%86%E5%8C%96%E5%85%AC%E5%BC%8F.png\" alt=\"æœºå™¨å­¦ä¹ _æ ‡å‡†åŒ–å…¬å¼\"><br>\nå¯¹äºå½’ä¸€åŒ–æ¥è®²ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸ç‚¹ï¼Œå½±å“äº†æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œé‚£ä¹ˆç»“æœæ˜¾ç„¶ä¼šå‘ç”Ÿæ”¹å˜.<br>\n å¯¹æ ‡å‡†åŒ–æ¥è®²ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ç‚¹ï¼Œç”±äºå…·æœ‰ä¸€å®šæ•°æ®é‡ï¼Œå°‘é‡çš„å¼‚å¸¸ç‚¹å¯¹å¹³å‡å€¼çš„å½±å“å¹¶ä¸å¤§ï¼Œä»è€Œæ–¹å·®æ”¹å˜è¾ƒå°ã€‚</p>\n<p><code>API: StandardScalar(....) </code> <br>\næ ‡å‡†åŒ–çš„æ­¥éª¤ï¼š</p>\n<ul>\n<li>å®ä¾‹åŒ– StandardScalar</li>\n<li>è°ƒç”¨ fit_transfrom</li>\n</ul>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#å¤„ç†ä¹‹åæ¯åˆ—æ¥è¯´æ‰€æœ‰æ•°æ®éƒ½èšé›†åœ¨å‡å€¼0é™„è¿‘æ ‡å‡†å·®å·®ä¸º1</span></span><br><span class=\"line\">StandardScalar(...)</span><br><span class=\"line\">    <span class=\"comment\"># X:numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: è½¬æ¢åçš„å½¢çŠ¶ç›¸åŒçš„array</span></span><br><span class=\"line\">    StandardScalar.fit_transfrom(X)</span><br><span class=\"line\">    <span class=\"comment\"># åŸå§‹æ•°æ®ä¸­æ¯åˆ—ç‰¹å¾çš„å¹³å‡å€¼</span></span><br><span class=\"line\">    StandardScalar.mean_</span><br><span class=\"line\">    <span class=\"comment\"># åŸå§‹æ•°æ®æ¯åˆ—ç‰¹å¾çš„æ–¹å·®</span></span><br><span class=\"line\">    StandardScalar.std_</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>ç¼ºå¤±å€¼<br>\nå¤„ç†ç¼ºå¤±å€¼çš„æ–¹æ³•:</p>\n<ul>\n<li>åˆ é™¤</li>\n<li>æ’è¡¥</li>\n</ul>\n</li>\n</ul>\n<p>æ’è¡¥ä½¿ç”¨çš„æ˜¯:  <code>Imputer</code>  æ–¹æ³•</p>\n  <figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å®Œæˆç¼ºå¤±å€¼æ’è¡¥</span></span><br><span class=\"line\">Imputer(miss_values=<span class=\"string\">&#x27;NaN&#x27;</span>,strategy=<span class=\"string\">&#x27;mean&#x27;</span>,axis=<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"comment\"># X: numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: è½¬æ¢åçš„å½¢çŠ¶ç›¸åŒçš„array</span></span><br><span class=\"line\">    Imputer.fit_transform(X)</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li>\n<p>ç±»åˆ«å‹æ•°æ®</p>\n<ul>\n<li>one-hot ç¼–ç </li>\n</ul>\n</li>\n<li>\n<p>æ—¶é—´ç±»å‹</p>\n<ul>\n<li>æ—¶é—´çš„æ‹†åˆ†</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ•°æ®çš„é™ç»´\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®çš„é™ç»´\">#</a> æ•°æ®çš„é™ç»´</h3>\n<p>é™ç»´æŒ‡çš„æ˜¯é™çš„æ˜¯ç‰¹å¾çš„ç»´åº¦ (ç‰¹å¾çš„æ•°é‡)ã€‚<br>\nä¸¤ç§æ–¹å¼ï¼šç‰¹å¾é€‰æ‹© å’Œ ä¸»æˆåˆ†åˆ†æ</p>\n<h4 id=\"ç‰¹å¾é€‰æ‹©çš„åŸå› \"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾é€‰æ‹©çš„åŸå› \">#</a> ç‰¹å¾é€‰æ‹©çš„åŸå› </h4>\n<ul>\n<li>å†—ä½™ï¼šéƒ¨åˆ†ç‰¹å¾çš„ç›¸å…³åº¦é«˜ï¼Œå®¹æ˜“æ¶ˆè€—è®¡ç®—æœºæ€§èƒ½</li>\n<li>å™ªå£°ï¼šéƒ¨åˆ†ç‰¹å¾ä¼šå¯¹ç»“æœäº§ç”Ÿå½±å“</li>\n</ul>\n<h4 id=\"ç‰¹å¾é€‰æ‹©æ˜¯ä»€ä¹ˆ\"><a class=\"markdownIt-Anchor\" href=\"#ç‰¹å¾é€‰æ‹©æ˜¯ä»€ä¹ˆ\">#</a> ç‰¹å¾é€‰æ‹©æ˜¯ä»€ä¹ˆï¼Ÿ</h4>\n<p>å°±æ˜¯å•çº¯çš„ä»æå–åˆ°çš„æ‰€æœ‰ç‰¹å¾ä¸­é€‰æ‹©éƒ¨åˆ†ç‰¹å¾ä½œä¸ºè®­ç»ƒé›†ç‰¹å¾ï¼Œç‰¹å¾åœ¨é€‰æ‹©å‰åå¯ä»¥æ”¹å˜å€¼ï¼Œä¹Ÿå¯ä»¥ä¸æ”¹å˜å€¼ã€‚ä½†æ˜¯é€‰æ‹©åçš„ç‰¹å¾ç»´æ•°è‚¯å®šæ¯”é€‰æ‹©å‰å°ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åªé€‰æ‹©äº†å…¶ä¸­ä¸€éƒ¨åˆ†ç‰¹å¾ã€‚<br>\nä¸»è¦æ–¹æ³•æœ‰:</p>\n<ul>\n<li>filter (è¿‡æ»¤å¼): varianceThreshold</li>\n<li>Embedde (åµŒå…¥å¼): æ­£åˆ™åŒ–ï¼Œå†³ç­–æ ‘</li>\n<li>Wrapper (åŒ…è£¹å¼)</li>\n<li>ç¥ç»ç½‘ç»œ</li>\n</ul>\n<p>API:  <code> sklearn.feature_selection.VarianceThreshold</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ‰€æœ‰ä½æ–¹å·®ç‰¹å¾</span></span><br><span class=\"line\">VarianceThreshold(threhold=<span class=\"number\">0.0</span>)</span><br><span class=\"line\">    <span class=\"comment\"># X: numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: è®­ç»ƒé›†å·®å¼‚åœ°åŸŸthresholdçš„ç‰¹å¾å°†è¢«åˆ é™¤</span></span><br><span class=\"line\">    <span class=\"comment\"># é»˜è®¤å€¼æ˜¯ä¿ç•™æ‰€æœ‰éé›¶æ–¹å·®ç‰¹å¾,å³åˆ é™¤æ‰€æœ‰æ ·æœ¬ä¸­å…·æœ‰ç›¸åŒå€¼çš„ç‰¹å¾</span></span><br><span class=\"line\">    Variance.fit_transform(X)</span><br></pre></td></tr></table></figure>\n<h3 id=\"pca-åˆ†æç®€åŒ–æ•°æ®é›†çš„æŠ€æœ¯\"><a class=\"markdownIt-Anchor\" href=\"#pca-åˆ†æç®€åŒ–æ•°æ®é›†çš„æŠ€æœ¯\">#</a> PCA åˆ†æç®€åŒ–æ•°æ®é›†çš„æŠ€æœ¯</h3>\n<p>ç›®çš„æ˜¯ï¼š æ•°æ®ç»´åº¦å‹ç¼©ï¼Œå°½å¯èƒ½é™ä½åŸæ•°æ®çš„ç»´åº¦ (å¤æ‚åº¦), æŸå¤±å°‘é‡ä¿¡æ¯<br>\nä½œç”¨ï¼šå¯ä»¥å‰Šå‡å›å½’åˆ†ææˆ–è€…èšç±»åˆ†æä¸­ç‰¹å¾çš„æ•°é‡ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†æ•°æ®åˆ†è§£ä¸ºè¾ƒä½ç»´æ•°çš„ç©ºé—´</span></span><br><span class=\"line\">PCA(n_components=<span class=\"literal\">None</span>)</span><br><span class=\"line\">    <span class=\"comment\"># X: numpy arrayæ ¼å¼çš„æ•°æ®[n_samples,n_features]</span></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›å€¼: è½¬åŒ–ååˆ¶å®šç»´åº¦çš„array</span></span><br><span class=\"line\">    PCA.fit_transform(X)</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœºå™¨å­¦ä¹ ç®—æ³•åŸºç¡€\"><a class=\"markdownIt-Anchor\" href=\"#æœºå™¨å­¦ä¹ ç®—æ³•åŸºç¡€\">#</a> æœºå™¨å­¦ä¹ ç®—æ³•åŸºç¡€</h2>\n<h3 id=\"ç›‘ç£å­¦ä¹ supervised-learnning\"><a class=\"markdownIt-Anchor\" href=\"#ç›‘ç£å­¦ä¹ supervised-learnning\">#</a> ç›‘ç£å­¦ä¹ ï¼šsupervised learnning</h3>\n<p>è¾“å…¥æ•°æ®ç”±è¾“å…¥ç‰¹å¾å€¼ å’Œ ç›®æ ‡å€¼ç»„æˆã€‚</p>\n<p>ç›®æ ‡å€¼è¿ç»­åˆ™æ˜¯å›å½’é—®é¢˜ï¼Œ ç›®æ ‡å€¼ç¦»æ•£åˆ™æ˜¯åˆ†ç±»é—®é¢˜ã€‚</p>\n<h3 id=\"æ— ç›‘ç£å­¦ä¹ -unsupervised-learning\"><a class=\"markdownIt-Anchor\" href=\"#æ— ç›‘ç£å­¦ä¹ -unsupervised-learning\">#</a> æ— ç›‘ç£å­¦ä¹ . unsupervised learning</h3>\n<p>è¾“å…¥æ•°æ®å¹¶æœªè¿›è¡Œæ ‡è®°ï¼Œæ²¡æœ‰ç›®æ ‡å€¼ã€‚ =&gt; èšç±» (kmeans)</p>\n<h3 id=\"åŠç›‘ç£å­¦ä¹ -semi-supervised-learning\"><a class=\"markdownIt-Anchor\" href=\"#åŠç›‘ç£å­¦ä¹ -semi-supervised-learning\">#</a> åŠç›‘ç£å­¦ä¹ ï¼š semi-supervised learning</h3>\n<p>è®­ç»ƒé›†åŒæ—¶åŒ…å«æœ‰æ ‡è®°æ ·æœ¬æ•°æ® å’Œ æœªæ ‡è®°æ ·æœ¬æ•°æ®</p>\n<h3 id=\"å¼ºåŒ–å­¦ä¹ -reinforcement-learning\"><a class=\"markdownIt-Anchor\" href=\"#å¼ºåŒ–å­¦ä¹ -reinforcement-learning\">#</a> å¼ºåŒ–å­¦ä¹ : reinforcement learning</h3>\n<p>æœ¬è´¨æ˜¯ make decisions é—®é¢˜ï¼Œå³è‡ªåŠ¨å†³ç­–é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥åšè¿ç»­å†³ç­–ã€‚</p>\n<p>æ²¡æœ‰è®­ç»ƒæ•°æ®ï¼Œå»ºç«‹æ¨¡å‹çš„æ—¶å€™äººä¸ºè®¾å®šå¥½å¯ä»¥æ“ä½œçš„è§„åˆ™ï¼Œä¸æ–­è‡ªæˆ‘å°è¯•ï¼Œè‡ªå·±å»æ¢ç´¢ã€‚</p>\n<p>å¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡å°±æ˜¯è·å–æ›´å¤šçš„ç´¯è®¡å¥–åŠ±ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­:</p>\n<p>å°å­©å­æƒ³è¦èµ°è·¯ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œä»–éœ€è¦å…ˆç«™èµ·æ¥ï¼Œç«™èµ·æ¥ä¹‹åè¿˜è¦ä¿æŒå¹³è¡¡ï¼Œæ¥ä¸‹æ¥å°±è¦å…ˆè¿ˆå‡ºä¸€æ¡è…¿ï¼Œæ˜¯å·¦è…¿è¿˜æ˜¯å³è…¿ï¼Œè¿ˆå‡ºä¸€æ­¥è¿˜è¦è¿ˆå‡ºä¸‹ä¸€æ­¥ã€‚</p>\n<p>å°å­©å­å°±æ˜¯ agentï¼Œä»–è¯•å›¾é€šè¿‡ è¡ŒåŠ¨ (å³è¡Œèµ°) æ¥æ¨¡å‹ç¯å¢ƒ (è¡Œèµ°çš„è¡¨é¢) å¹¶ä¸”ä»ä¸€ä¸ªçŠ¶æ€è½¬å˜åˆ°å¦ä¸€ä¸ªçŠ¶æ€ (å³ä»–èµ°çš„æ¯ä¸€æ­¥)ï¼Œå½“ä»–å®Œæˆäº†ä»»åŠ¡çš„å­ä»»åŠ¡ï¼ˆå³èµ°äº†å‡ æ­¥) æ—¶ï¼Œå­©å­æ”¶åˆ°å¥–åŠ±ï¼Œå¹¶ä¸”å½“ä»–ä¸èƒ½èµ°è·¯æ—¶ï¼Œå°±ä¸ä¼šç»™å¥–åŠ±ã€‚</p>\n<p>ä¸»è¦åŒ…å«å››ä¸ªå…ƒç´ : agent  è¡ŒåŠ¨ ç¯å¢ƒ  å¥–åŠ±</p>\n<p><img data-src=\"./images/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%88%86%E7%B1%BB.png\" alt=\"\"></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "MachineLearn"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/18/BQ/hdoj/HD-1005/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/18/BQ/hdoj/HD-1005/",
            "title": "1005 Number Sequence",
            "date_published": "2021-10-18T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®ä¿¡æ¯\">#</a> é¢˜ç›®ä¿¡æ¯</h2>\n<blockquote>\n<p>Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/32768 K (Java/Others)<br>\nTotal Submission(s): 257509    Accepted Submission(s): 65939</p>\n</blockquote>\n<h3 id=\"problem-description\"><a class=\"markdownIt-Anchor\" href=\"#problem-description\">#</a> Problem Description</h3>\n<p>A number sequence is defined as follows:</p>\n<p>f(1) = 1, f(2) = 1, f(n) = (A * f(n - 1) + B * f(n - 2)) mod 7.</p>\n<p>Given A, B, and n, you are to calculate the value of f(n).</p>\n<h3 id=\"input\"><a class=\"markdownIt-Anchor\" href=\"#input\">#</a> Input</h3>\n<p>The input consists of multiple test cases. Each test case contains 3 integers A, B and n on a single line (1 &lt;= A, B &lt;= 1000, 1 &lt;= n &lt;= 100,000,000). Three zeros signal the end of input and this test case is not to be processed.</p>\n<h3 id=\"output\"><a class=\"markdownIt-Anchor\" href=\"#output\">#</a> Output</h3>\n<p>For each test case, print the value of f(n) on a single line.</p>\n<h3 id=\"sample-input\"><a class=\"markdownIt-Anchor\" href=\"#sample-input\">#</a> Sample Input</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 1 3</span><br><span class=\"line\">1 2 10</span><br><span class=\"line\">0 0 0</span><br></pre></td></tr></table></figure>\n<h3 id=\"sample-output\"><a class=\"markdownIt-Anchor\" href=\"#sample-output\">#</a> Sample Output</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2</span><br><span class=\"line\">5</span><br></pre></td></tr></table></figure>\n<h2 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h2>\n<h3 id=\"cè¯­è¨€è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#cè¯­è¨€è§£æ³•\">#</a> C è¯­è¨€è§£æ³•</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> A, B, i;</span><br><span class=\"line\">    <span class=\"keyword\">long</span> <span class=\"keyword\">int</span> n;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d %d %d&quot;</span>, &amp;A, &amp;B, &amp;n) != EOF) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> a[<span class=\"number\">50</span>];</span><br><span class=\"line\">        a[<span class=\"number\">1</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        a[<span class=\"number\">2</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((A + B + n) == <span class=\"number\">0</span>)<span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (i = <span class=\"number\">3</span>; i &lt;= <span class=\"number\">48</span>; i++) &#123;</span><br><span class=\"line\">            a[i] = (A * a[i - <span class=\"number\">1</span>] + B * a[i - <span class=\"number\">2</span>]) % <span class=\"number\">7</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        n = n % <span class=\"number\">48</span>;</span><br><span class=\"line\">        a[<span class=\"number\">0</span>] = a[<span class=\"number\">48</span>];</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, a[n]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"be-careful\"><a class=\"markdownIt-Anchor\" href=\"#be-careful\">#</a> Be Careful</h2>\n<p>è¿™é“é¢˜ï¼Œéš¾é“æ‰¾è§„å¾‹ã€‚è§„å¾‹æ€ä¹ˆæ‰¾å‡ºæ¥çš„ï¼Œæ˜¯å›°éš¾çš„ã€‚</p>\n<h2 id=\"é“¾æ¥\"><a class=\"markdownIt-Anchor\" href=\"#é“¾æ¥\">#</a> é“¾æ¥</h2>\n<div class=\"links\"><div class=\"item\" title=\"æ­ç”µOj - 1005\" style=\"--block-color:#550370;\"><span class=\"exturl image\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\" data-background-image=\"https://fangjiaxiaobai.github.io/images/ac-code/acm.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\">æ­ç”µOj - 1005</span>\n          <p class=\"desc\">http://acm.hdu.edu.cn/</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1005é¢˜è§£\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDA1LTIuamF2YQ==\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDA1LTIuamF2YQ==\">ã€Cã€‘æ­ç”µOj-1005é¢˜è§£</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div></div>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "HD",
                "BQ",
                "AC"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/17/BQ/hdoj/HD-1004/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/17/BQ/hdoj/HD-1004/",
            "title": "1004 Let the Balloon Rise",
            "date_published": "2021-10-17T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®ä¿¡æ¯\">#</a> é¢˜ç›®ä¿¡æ¯</h2>\n<blockquote>\n<p>Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/32768 K (Java/Others)<br>\nTotal Submission(s): 194179    Accepted Submission(s): 78028</p>\n</blockquote>\n<h3 id=\"problem-description\"><a class=\"markdownIt-Anchor\" href=\"#problem-description\">#</a> Problem Description</h3>\n<p>Contest time again! How excited it is to see balloons floating around. But to tell you a secret, the judgesâ€™ favorite time is guessing the most popular problem. When the contest is over, they will count the balloons of each color and find the result.</p>\n<p>This year, they decide to leave this lovely job to you.</p>\n<h3 id=\"input\"><a class=\"markdownIt-Anchor\" href=\"#input\">#</a> Input</h3>\n<p>Input contains multiple test cases. Each test case starts with a number N (0 &lt; N &lt;= 1000) â€“ the total number of balloons distributed. The next N lines contain one color each. The color of a balloon is a string of up to 15 lower-case letters.</p>\n<p>A test case with N = 0 terminates the input and this test case is not to be processed.</p>\n<h3 id=\"output\"><a class=\"markdownIt-Anchor\" href=\"#output\">#</a> Output</h3>\n<p>For each case, print the color of balloon for the most popular problem on a single line. It is guaranteed that there is a unique solution for each test case.</p>\n<h3 id=\"sample-input\"><a class=\"markdownIt-Anchor\" href=\"#sample-input\">#</a> Sample Input</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">5</span><br><span class=\"line\">green</span><br><span class=\"line\">red</span><br><span class=\"line\">blue</span><br><span class=\"line\">red</span><br><span class=\"line\">red</span><br><span class=\"line\">3</span><br><span class=\"line\">pink</span><br><span class=\"line\">orange</span><br><span class=\"line\">pink</span><br><span class=\"line\">0</span><br></pre></td></tr></table></figure>\n<h3 id=\"sample-output\"><a class=\"markdownIt-Anchor\" href=\"#sample-output\">#</a> Sample Output</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">red</span><br><span class=\"line\">pink</span><br></pre></td></tr></table></figure>\n<h2 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h2>\n<h3 id=\"javaè¯­è¨€è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#javaè¯­è¨€è§£æ³•\">#</a> Java è¯­è¨€è§£æ³•</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Scanner;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Scanner sc = <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (sc.hasNext()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> i = sc.nextInt();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            HashMap&lt;String, Integer&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">            String key = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maxCount = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (i-- &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                String s = sc.nextLine();</span><br><span class=\"line\">                <span class=\"keyword\">int</span> value = map.getOrDefault(s, <span class=\"number\">0</span>) + <span class=\"number\">1</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (maxCount &lt; value) &#123;</span><br><span class=\"line\">                    maxCount = value;</span><br><span class=\"line\">                    key = s;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                map.put(s, value);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            System.out.println(key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"be-careful\"><a class=\"markdownIt-Anchor\" href=\"#be-careful\">#</a> Be Careful</h2>\n<p>to easy. nothingâ€¦   but High-level language YYDS.</p>\n<h2 id=\"é“¾æ¥\"><a class=\"markdownIt-Anchor\" href=\"#é“¾æ¥\">#</a> é“¾æ¥</h2>\n<div class=\"links\"><div class=\"item\" title=\"æ­ç”µOj - 1004\" style=\"--block-color:#550370;\"><span class=\"exturl image\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\" data-background-image=\"https://fangjiaxiaobai.github.io/images/ac-code/acm.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\">æ­ç”µOj - 1004</span>\n          <p class=\"desc\">http://acm.hdu.edu.cn/</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1004é¢˜è§£\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDA0LTIuamF2YQ==\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDA0LTIuamF2YQ==\">ã€Cã€‘æ­ç”µOj-1004é¢˜è§£</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div></div>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "HD",
                "BQ",
                "AC"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/16/BQ/hdoj/HD-1003/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/16/BQ/hdoj/HD-1003/",
            "title": "1003 Max Sum",
            "date_published": "2021-10-16T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®ä¿¡æ¯\">#</a> é¢˜ç›®ä¿¡æ¯</h2>\n<blockquote>\n<p>Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/32768 K (Java/Others)<br>\nTotal Submission(s): 377960    Accepted Submission(s): 90742</p>\n</blockquote>\n<h3 id=\"problem-description\"><a class=\"markdownIt-Anchor\" href=\"#problem-description\">#</a> Problem Description</h3>\n<p>Given a sequence a[1],a[2],a[3]â€¦a[n], your job is to calculate the max sum of a sub-sequence. For example, given (6,-1,5,4,-7), the max sum in this sequence is 6 + (-1) + 5 + 4 = 14.</p>\n<h3 id=\"input\"><a class=\"markdownIt-Anchor\" href=\"#input\">#</a> Input</h3>\n<p>The first line of the input contains an integer T(1&lt;=T&lt;=20) which means the number of test cases. Then T lines follow, each line starts with a number N(1&lt;=N&lt;=100000), then N integers followed(all the integers are between -1000 and 1000).</p>\n<h3 id=\"output\"><a class=\"markdownIt-Anchor\" href=\"#output\">#</a> Output</h3>\n<p>For each test case, you should output two lines. The first line is â€œCase #:â€, # means the number of the test case. The second line contains three integers, the Max Sum in the sequence, the start position of the sub-sequence, the end position of the sub-sequence. If there are more than one result, output the first one. Output a blank line between two cases.</p>\n<h3 id=\"sample-input\"><a class=\"markdownIt-Anchor\" href=\"#sample-input\">#</a> Sample Input</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2</span><br><span class=\"line\">5 6 -1 5 4 -7</span><br><span class=\"line\">7 0 6 -1 1 -6 7 -5</span><br></pre></td></tr></table></figure>\n<h3 id=\"sample-output\"><a class=\"markdownIt-Anchor\" href=\"#sample-output\">#</a> Sample Output</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Case 1:</span><br><span class=\"line\">14 1 4</span><br><span class=\"line\"></span><br><span class=\"line\">Case 2:</span><br><span class=\"line\">7 1 6</span><br></pre></td></tr></table></figure>\n<h2 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h2>\n<h3 id=\"cè¯­è¨€è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#cè¯­è¨€è§£æ³•\">#</a> C è¯­è¨€è§£æ³•</h3>\n<h4 id=\"åŠ¨æ€è§„åˆ’\"><a class=\"markdownIt-Anchor\" href=\"#åŠ¨æ€è§„åˆ’\">#</a> åŠ¨æ€è§„åˆ’</h4>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åŠ¨æ€è§„åˆ’ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * @return</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> caseCount;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> caseIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;caseCount);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((caseIndex) &lt; caseCount) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> num[<span class=\"number\">100001</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> sum[<span class=\"number\">100001</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;n);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;num[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span> maxSum = sum[<span class=\"number\">0</span>] = num[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">int</span> startIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> endIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> temp = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sum[i - <span class=\"number\">1</span>] &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                sum[i] = num[i];</span><br><span class=\"line\">                temp = i;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                sum[i] = num[i] + sum[i - <span class=\"number\">1</span>];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (maxSum &lt; sum[i]) &#123;</span><br><span class=\"line\">                maxSum = sum[i];</span><br><span class=\"line\">                endIndex = i;</span><br><span class=\"line\">                startIndex = temp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Case %d:\\n&quot;</span>, ++caseIndex);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>, maxSum, startIndex + <span class=\"number\">1</span>, endIndex + <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (caseIndex &lt; caseCount) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åè¿‡å¤´æ¥ï¼Œç»§ç»­çœ‹è¿™æ®µä»£ç çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å®æˆ‘ä»¬åªç”¨äº† <code>sum[i-1]</code>  è¿™ä¸€ä¸ªå€¼ï¼Œ <code>sum[i-2]....sum[0]</code>  æˆ‘ä»¬æ˜¯æ²¡æœ‰ä»€ä¹ˆç”¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå˜é‡æ‰æ›¿æ¢ <code>sum</code>  æ•°ç»„ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åŠ¨æ€è§„åˆ’ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * @return</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> caseCount;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> caseIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;caseCount);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((caseIndex) &lt; caseCount) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> a, previous = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> max = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> startIndex, endIndex;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> temp = startIndex = endIndex = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d %d&quot;</span>, &amp;n, &amp;previous);</span><br><span class=\"line\">        max = previous;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &lt;= n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;a);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (previous &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                previous = a;</span><br><span class=\"line\">                temp = i;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                previous += a;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (previous &gt; max) &#123;</span><br><span class=\"line\">                max = previous;</span><br><span class=\"line\">                endIndex = i;</span><br><span class=\"line\">                startIndex = temp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Case %d:\\n&quot;</span>, ++caseIndex);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>, max, startIndex , endIndex);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (caseIndex &lt; caseCount) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ»‘åŠ¨çª—å£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#æ»‘åŠ¨çª—å£æ³•\">#</a> æ»‘åŠ¨çª—å£æ³•</h4>\n<p>æ³¨æ„ï¼š è¿™ç§è§£æ³•æ˜¯ä¼š  <code>Time Limit Exceeded</code>  çš„ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ»‘åŠ¨çª—å£æ³•ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * @return</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> caseCount;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> caseIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;caseCount);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((caseIndex) &lt; caseCount) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> num[<span class=\"number\">100000</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;n);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; n; ++i) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;num[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> maxStartIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> width = n;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> maxSum = <span class=\"number\">-10000</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> maxWidth = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (width &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt;= n - width; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> sum = <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; width; j++) &#123;</span><br><span class=\"line\">                    sum += num[i + j];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (maxSum &lt; sum) &#123;</span><br><span class=\"line\">                    maxSum = sum;</span><br><span class=\"line\">                    maxStartIndex = i;</span><br><span class=\"line\">                    maxWidth = width;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            width--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Case %d:\\n&quot;</span>, ++caseIndex);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>, maxSum, maxStartIndex + <span class=\"number\">1</span>, maxStartIndex + maxWidth);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (caseIndex &lt; caseCount) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"be-careful\"><a class=\"markdownIt-Anchor\" href=\"#be-careful\">#</a> Be Careful</h2>\n<p>nothingâ€¦</p>\n<h2 id=\"é“¾æ¥\"><a class=\"markdownIt-Anchor\" href=\"#é“¾æ¥\">#</a> é“¾æ¥</h2>\n<div class=\"links\"><div class=\"item\" title=\"æ­ç”µOj - 1003\" style=\"--block-color:#550370;\"><span class=\"exturl image\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\" data-background-image=\"https://fangjiaxiaobai.github.io/images/ac-code/acm.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\">æ­ç”µOj - 1003</span>\n          <p class=\"desc\">http://acm.hdu.edu.cn/</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1003é¢˜è§£-æ»‘åŠ¨çª—å£(Cè¯­è¨€ç‰ˆ)\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAzLmNwcA==\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAzLmNwcA==\">ã€Cã€‘æ­ç”µOj-1003é¢˜è§£-æ»‘åŠ¨çª—å£(Cè¯­è¨€ç‰ˆ)</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1003é¢˜è§£-åŠ¨æ€è§„åˆ’(Cè¯­è¨€ç‰ˆ)\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAzLTIuY3Bw\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAzLTIuY3Bw\">ã€Cã€‘æ­ç”µOj-1003é¢˜è§£-åŠ¨æ€è§„åˆ’(Cè¯­è¨€ç‰ˆ)</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1003é¢˜è§£-åŠ¨æ€è§„åˆ’(ä¼˜åŒ–ç‰ˆæœ¬)\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAzLTMuY3Bw\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAzLTMuY3Bw\">ã€Cã€‘æ­ç”µOj-1003é¢˜è§£-åŠ¨æ€è§„åˆ’(ä¼˜åŒ–ç‰ˆæœ¬)</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div></div>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "åŠ¨æ€è§„åˆ’",
                "HD",
                "BQ",
                "AC"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/15/BQ/hdoj/HD-1002/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/15/BQ/hdoj/HD-1002/",
            "title": "1002 A + B Problem II",
            "date_published": "2021-10-15T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®ä¿¡æ¯\">#</a> é¢˜ç›®ä¿¡æ¯</h2>\n<blockquote>\n<p>Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/32768 K (Java/Others)<br>\nTotal Submission(s): 565951    Accepted Submission(s): 107979</p>\n</blockquote>\n<h3 id=\"problem-description\"><a class=\"markdownIt-Anchor\" href=\"#problem-description\">#</a> Problem Description</h3>\n<p>I have a very simple problem for you. Given two integers A and B, your job is to calculate the Sum of A + B.</p>\n<h3 id=\"input\"><a class=\"markdownIt-Anchor\" href=\"#input\">#</a> Input</h3>\n<p>The first line of the input contains an integer T(1&lt;=T&lt;=20) which means the number of test cases. Then T lines follow, each line consists of two positive integers, A and B. Notice that the integers are very large, that means you should not process them by using 32-bit integer. You may assume the length of each integer will not exceed 1000.</p>\n<h3 id=\"output\"><a class=\"markdownIt-Anchor\" href=\"#output\">#</a> Output</h3>\n<p>For each test case, you should output two lines. The first line is â€œCase #:â€, # means the number of the test case. The second line is the an equation â€œA + B = Sumâ€, Sum means the result of A + B. Note there are some spaces int the equation. Output a blank line between two test cases.</p>\n<h3 id=\"sample-input\"><a class=\"markdownIt-Anchor\" href=\"#sample-input\">#</a> Sample Input</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2</span><br><span class=\"line\">1 2</span><br><span class=\"line\">112233445566778899 998877665544332211</span><br></pre></td></tr></table></figure>\n<h3 id=\"sample-output\"><a class=\"markdownIt-Anchor\" href=\"#sample-output\">#</a> Sample Output</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Case 1:</span><br><span class=\"line\">1 + 2 = 3</span><br><span class=\"line\"></span><br><span class=\"line\">Case 2:</span><br><span class=\"line\">112233445566778899 + 998877665544332211 = 1111111111111111110</span><br></pre></td></tr></table></figure>\n<h2 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h2>\n<h3 id=\"cè¯­è¨€è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#cè¯­è¨€è§£æ³•\">#</a> C è¯­è¨€è§£æ³•</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> n, i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;n);</span><br><span class=\"line\">    <span class=\"keyword\">char</span> num1[<span class=\"number\">1001</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> num2[<span class=\"number\">1001</span>];</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; n) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> res[<span class=\"number\">1001</span>];</span><br><span class=\"line\">        <span class=\"keyword\">int</span> res_end_pos = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> temp = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> num1_end_pos = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> num2_end_pos = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%s %s&quot;</span>, num1, num2);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å°†ä¸‹æ ‡è®¡ç®—åˆ°æ•°å€¼çš„ä¸ªä½ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"string\">&#x27;\\0&#x27;</span> != num1[num1_end_pos]) &#123;</span><br><span class=\"line\">            num1_end_pos++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"string\">&#x27;\\0&#x27;</span> != num2[num2_end_pos]) &#123;</span><br><span class=\"line\">            num2_end_pos++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æŒ‰ç…§ä¸‹æ ‡ä»å¤§åˆ°å°çš„é¡ºåºï¼Œç´¯åŠ ï¼Œå¹¶è®¡ç®—æ˜¯å¦éœ€è¦è¿›ä½ã€‚</span></span><br><span class=\"line\">        res_end_pos = (num1_end_pos &gt; num2_end_pos ? num1_end_pos : num2_end_pos) + <span class=\"number\">1</span>;</span><br><span class=\"line\">        res[res_end_pos] = <span class=\"string\">&#x27;\\0&#x27;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (num1_end_pos &gt; <span class=\"number\">0</span> &amp;&amp; num2_end_pos &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            num2_end_pos--;</span><br><span class=\"line\">            num1_end_pos--;</span><br><span class=\"line\">            res_end_pos--;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">int</span> number1 = num1[num1_end_pos] - <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> number2 = num2[num2_end_pos] - <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">            temp = number1 + number2 + (temp / <span class=\"number\">10</span>);</span><br><span class=\"line\">            res[res_end_pos] = (temp % <span class=\"number\">10</span>) + <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è®¡ç®—è¿›ä½ä»¥åŠæŸä¸ªæ•°å€¼ä½æ•°ä¸ä¸€è‡´çš„æƒ…å†µ</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (res_end_pos &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            res_end_pos--;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> temp_res = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (num1_end_pos == <span class=\"number\">0</span> &amp;&amp; num2_end_pos &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                num2_end_pos--;</span><br><span class=\"line\">                temp_res = (num2[num2_end_pos] - <span class=\"string\">&#x27;0&#x27;</span>) + temp / <span class=\"number\">10</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num1_end_pos &gt; <span class=\"number\">0</span> &amp;&amp; num2_end_pos == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                num1_end_pos--;</span><br><span class=\"line\">                temp_res = (num1[num1_end_pos] - <span class=\"string\">&#x27;0&#x27;</span>) + temp / <span class=\"number\">10</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                temp_res = temp / <span class=\"number\">10</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            temp = temp_res;</span><br><span class=\"line\">            res[res_end_pos] = temp_res % <span class=\"number\">10</span> + <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i++;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¤„ç†æ²¡æœ‰è¿›ä½å¯¼è‡´çš„è¾“å‡ºé—®é¢˜(å¤šè¾“å‡ºä¸€ä¸ª0)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(res[<span class=\"number\">0</span>] == <span class=\"string\">&#x27;0&#x27;</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(res[j]!=<span class=\"string\">&#x27;\\0&#x27;</span>)&#123;</span><br><span class=\"line\">                res[j] = res[j+<span class=\"number\">1</span>];</span><br><span class=\"line\">                j++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Case %d:\\n&quot;</span>, i);</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%s + %s = %s\\n&quot;</span>, num1, num2, res);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(i &lt; n)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"be-careful\"><a class=\"markdownIt-Anchor\" href=\"#be-careful\">#</a> Be Careful</h2>\n<ul>\n<li>æ³¨æ„è¾“å‡ºç»“æœï¼š æ¯ä¸ª case ä¹‹å‰ä¼šéš”ä¸€ä¸ªç©ºè¡Œã€‚æœ€åä¸€ä¸ª case åé¢æ²¡æœ‰ç©ºè¡Œã€‚æ³¨æ„è¯»é¢˜ã€‚</li>\n</ul>\n<h3 id=\"é•¿ç‚¹å¿ƒå§\"><a class=\"markdownIt-Anchor\" href=\"#é•¿ç‚¹å¿ƒå§\">#</a> é•¿ç‚¹å¿ƒå§</h3>\n<p><span class=\"label warning\">ç†æ¸…éœ€æ±‚å•Š</span></p>\n<h2 id=\"é“¾æ¥\"><a class=\"markdownIt-Anchor\" href=\"#é“¾æ¥\">#</a> é“¾æ¥</h2>\n<div class=\"links\"><div class=\"item\" title=\"æ­ç”µOj - 1002\" style=\"--block-color:#550370;\"><span class=\"exturl image\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\" data-background-image=\"https://fangjiaxiaobai.github.io/images/ac-code/acm.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMg==\">æ­ç”µOj - 1002</span>\n          <p class=\"desc\">http://acm.hdu.edu.cn/</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1002é¢˜è§£\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAyLmNwcA==\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAyLmNwcA==\">ã€Cã€‘æ­ç”µOj-1002é¢˜è§£</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div></div>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "HD",
                "BQ",
                "AC"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/14/java%E7%B3%BB%E5%88%97/dubbo/02-Dubbo%20with%20Springboot/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/14/java%E7%B3%BB%E5%88%97/dubbo/02-Dubbo%20with%20Springboot/",
            "title": "Dubbo ä¸ Springboot é›†æˆ",
            "date_published": "2021-10-14T14:58:55.000Z",
            "content_html": "<blockquote>\n<p>æœ¬æ–‡ä½¿ç”¨æŠ€æœ¯ä»‹ç»<br>\n Dubbo 3.0.3<br>\nSpringboot 2.5.5<br>\n æ–‡ä¸­ä»£ç å·²åˆ å‡ï¼Œå…·ä½“ä»£ç ä½ç½®è§æ–‡æœ«ã€‚</p>\n</blockquote>\n<h2 id=\"æœ¬æ–‡ç›®æ ‡\"><a class=\"markdownIt-Anchor\" href=\"#æœ¬æ–‡ç›®æ ‡\">#</a> æœ¬æ–‡ç›®æ ‡</h2>\n<p>å¿«é€Ÿæ„å»º  <code>Springboot</code>  åº”ç”¨ï¼Œå¹¶ç»§æ‰¿ <code>Dubbo</code> ã€‚</p>\n<p>æä¾›ä¸€ä¸ªæœåŠ¡è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ åœ¨æµè§ˆå™¨ä¸­è¯·æ±‚æ¶ˆè´¹è€…æœåŠ¡ï¼Œ æ¶ˆè´¹è€…æœåŠ¡è°ƒç”¨ æœåŠ¡æä¾›è€…ï¼Œè¿”å› å“åº”ã€‚</p>\n<h2 id=\"åˆ›å»ºé¡¹ç›®\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºé¡¹ç›®\">#</a> åˆ›å»ºé¡¹ç›®</h2>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE1.png\" alt=\"\"></p>\n<h3 id=\"åˆ›å»ºæœåŠ¡æä¾›è€…\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæœåŠ¡æä¾›è€…\">#</a> åˆ›å»ºæœåŠ¡æä¾›è€…</h3>\n<p>åœ¨ <code>chapter02-provider</code>  è¿™ä¸ª  <code>module</code>  ä¸‹ï¼Œç¼–å†™äº†ä¸¤ä¸ª  <code>sub module</code> .  <code>chapter02-provider-api</code>  è¡¨ç¤ºå¯¹å¤–æä¾›çš„ <code>RPC</code>  æ¥å£ã€‚  <code>chapter02-provider-impl</code>  è¡¨ç¤º RPC æ¥å£çš„å®ç°ã€‚</p>\n<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE3.png\" alt=\"\"></p>\n<h4 id=\"chapter02-provider-api\"><a class=\"markdownIt-Anchor\" href=\"#chapter02-provider-api\">#</a> chapter02-provider-api</h4>\n<h5 id=\"å¼•å…¥pomæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥pomæ–‡ä»¶\">#</a> å¼•å…¥ pom æ–‡ä»¶</h5>\n<p>æœ¬æ¨¡å—ä¸‹æ— éœ€æ”¹åŠ¨ï¼Œä½¿ç”¨ <code>IDEA</code>  ç”Ÿæˆçš„å³å¯ã€‚å…·ä½“ä»£ç è§æ–‡æœ«</p>\n<h5 id=\"å®šä¹‰rpcæ¥å£\"><a class=\"markdownIt-Anchor\" href=\"#å®šä¹‰rpcæ¥å£\">#</a> å®šä¹‰ RPC æ¥å£</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æœåŠ¡è€…æä¾›çš„æ¥å£è§„èŒƒ</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 20:44</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IProviderService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ¼”ç¤ºè°ƒç”¨demo</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> name å…¥å‚ï¼Œéšå³è¿”å›</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &quot;hello, &#123;name&#125; . I am dubbo.&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·  <code>provider-api</code>  æœåŠ¡å°±é…ç½®å®Œæˆäº†ã€‚</p>\n<h4 id=\"chapter02-provider-impl\"><a class=\"markdownIt-Anchor\" href=\"#chapter02-provider-impl\">#</a> chapter02-provider-impl</h4>\n<h5 id=\"å¼•å…¥-pomæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥-pomæ–‡ä»¶\">#</a> å¼•å…¥ pom æ–‡ä»¶</h5>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- æœåŠ¡æä¾›è€…çš„RPCæ¥å£ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fxb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>chapter02-provider-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- å¼•å…¥Dubbo --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.0.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®applicationyml\"><a class=\"markdownIt-Anchor\" href=\"#é…ç½®applicationyml\">#</a> é…ç½® application.yml</h4>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dubbo:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"comment\">#application-name</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">springboot-multicast-provider</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">springboot-multicast-provider</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"comment\"># ä»¥å¹¿æ’­çš„åè®®è¿›è¡Œå‘å¸ƒ.</span></span><br><span class=\"line\">    <span class=\"attr\">address:</span> <span class=\"string\">multicast://224.5.6.7:1234</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">  <span class=\"attr\">protocol:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">dubbo</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">20880</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘\"><a class=\"markdownIt-Anchor\" href=\"#å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘\">#</a> å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘</h4>\n<p>å³ å®ç° <code>RPC</code>  æ¥å£ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * sayHello çš„å…·ä½“å®ç°</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 20:47</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@DubboService</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">IProviderService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span> <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;hello, %s.  I am dubbo.&quot;</span>, name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ·»åŠ dubboæ³¨è§£\"><a class=\"markdownIt-Anchor\" href=\"#æ·»åŠ dubboæ³¨è§£\">#</a> æ·»åŠ  Dubbo æ³¨è§£</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"comment\">// é›†æˆDubbo</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDubbo</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chapter02ProviderImplApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Chapter02ProviderImplApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬å¯åŠ¨æœåŠ¡ã€‚å¯ä»¥çœ‹åˆ°:</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE2.png\" alt=\"\"></p>\n<p>è¿™æ ·æœåŠ¡æä¾›è€…å°±å¯åŠ¨æˆåŠŸäº†ã€‚</p>\n<h3 id=\"åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…\">#</a> åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…</h3>\n<p>æ¶ˆè´¹è€…çš„ç›®å½•ç»“æ„å¦‚ä¸‹:</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE4.png\" alt=\"\"></p>\n<h4 id=\"å¼•å…¥mavenä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥mavenä¾èµ–\">#</a> å¼•å…¥ maven ä¾èµ–</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- æ”¯æŒdubbo --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.0.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- æœåŠ¡æä¾›è€…çš„RPCæ¥å£ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fxb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>chapter02-provider-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®applicationyml-2\"><a class=\"markdownIt-Anchor\" href=\"#é…ç½®applicationyml-2\">#</a> é…ç½® application.yml</h4>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dubbo:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"comment\">#application-name</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">chapter02-with-springboot-consumer</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">chapter02-with-springboot-consumer</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"attr\">address:</span> <span class=\"string\">multicast://224.5.6.7:1234</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">  <span class=\"attr\">protocol:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">dubbo</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">20880</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8081</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™controller\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–å†™controller\">#</a> ç¼–å†™ Controller</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¶ˆè´¹è€…demoï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 21:00</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConsumerService consumerService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;chapter02/sayHello/&#123;name&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">(<span class=\"meta\">@PathVariable</span> String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> consumerService.sayHello(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™serviceå±‚è°ƒç”¨æä¾›æä¾›è€…\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–å†™serviceå±‚è°ƒç”¨æä¾›æä¾›è€…\">#</a> ç¼–å†™ Service å±‚ï¼Œè°ƒç”¨æä¾›æä¾›è€…</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘å®ç°</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 21:02</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¼•ç”¨DubboæœåŠ¡ã€‚ä½¿ç”¨@DubboReferenceæ³¨è§£</span></span><br><span class=\"line\">    <span class=\"meta\">@DubboReference</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> IProviderService providerService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> providerService.sayHello(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™å¯åŠ¨ç±»\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–å†™å¯åŠ¨ç±»\">#</a> ç¼–å†™å¯åŠ¨ç±»</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDubbo</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chapter02ConsumerApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Chapter02ConsumerApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯åŠ¨åï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°:</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE5.png\" alt=\"\"></p>\n<p>è¡¨ç¤ºå¯åŠ¨æˆåŠŸ</p>\n<h4 id=\"æµ‹è¯•\"><a class=\"markdownIt-Anchor\" href=\"#æµ‹è¯•\">#</a> æµ‹è¯•</h4>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è°ƒç”¨æ¶ˆè´¹è€…çš„ sayHello æ¥å£  <code>http://localhost:8081/chapter02/sayHello/fangjiaxiaobai</code>  å°±ä¼šçœ‹åˆ°  <code>hello, fangjiaxiaobai. I am dubbo.</code></p>\n<p>è¿™æ ·ä¸€ä¸ªæœ€æœ€ç²¾ç®€çš„ <code>Dubbo</code>  é›†æˆ <code>Springboot</code>  çš„æœåŠ¡å°±éƒ¨ç½²å®Œæˆäº†ã€‚</p>\n<h3 id=\"é“¾æ¥\"><a class=\"markdownIt-Anchor\" href=\"#é“¾æ¥\">#</a> é“¾æ¥</h3>\n<div class=\"links\"><div class=\"item\" title=\"Dubboä¸Springbooté›†æˆ\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVhcm5famF2YS90cmVlL21hc3Rlci9meGJfZHViYm8vZGVtbzAyLXdpdGgtc3ByaW5nYm9vdA==\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVhcm5famF2YS90cmVlL21hc3Rlci9meGJfZHViYm8vZGVtbzAyLXdpdGgtc3ByaW5nYm9vdA==\">Dubboä¸Springbooté›†æˆ</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/learn_java.git</p>\n          </div></div></div>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/dubbo/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "Java",
                "dubbo"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/14/java%E7%B3%BB%E5%88%97/dubbo/02-dubbo-with-springboot/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/14/java%E7%B3%BB%E5%88%97/dubbo/02-dubbo-with-springboot/",
            "title": "æœ€ç®€ç‰ˆ springboot é›†æˆ dubbo",
            "date_published": "2021-10-14T14:58:55.000Z",
            "content_html": "<blockquote>\n<p>æœ¬æ–‡ä½¿ç”¨æŠ€æœ¯ä»‹ç»<br>\n <code>Dubbo 3.0.3</code> <br>\n <code>Springboot 2.5.5</code> <br>\n æ–‡ä¸­ä»£ç å·²åˆ å‡ï¼Œå…·ä½“ä»£ç ä½ç½®è§æ–‡æœ«ã€‚</p>\n</blockquote>\n<h2 id=\"æœ¬æ–‡ç›®æ ‡\"><a class=\"markdownIt-Anchor\" href=\"#æœ¬æ–‡ç›®æ ‡\">#</a> æœ¬æ–‡ç›®æ ‡</h2>\n<p>å¿«é€Ÿæ„å»º  <code>Springboot</code>  åº”ç”¨ï¼Œå¹¶é›†æˆ <code>Dubbo</code> ã€‚</p>\n<p>æä¾›ä¸€ä¸ªæœåŠ¡è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ åœ¨æµè§ˆå™¨ä¸­è¯·æ±‚æ¶ˆè´¹è€…æœåŠ¡ï¼Œ æ¶ˆè´¹è€…æœåŠ¡è°ƒç”¨ æœåŠ¡æä¾›è€…ï¼Œè¿”å› å“åº”ã€‚</p>\n<h2 id=\"åˆ›å»ºé¡¹ç›®\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºé¡¹ç›®\">#</a> åˆ›å»ºé¡¹ç›®</h2>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE1.png\" alt=\"\"></p>\n<h3 id=\"åˆ›å»ºæœåŠ¡æä¾›è€…\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæœåŠ¡æä¾›è€…\">#</a> åˆ›å»ºæœåŠ¡æä¾›è€…</h3>\n<p>åœ¨ <code>chapter02-provider</code>  è¿™ä¸ª  <code>module</code>  ä¸‹ï¼Œç¼–å†™äº†ä¸¤ä¸ª  <code>sub module</code> .  <code>chapter02-provider-api</code>  è¡¨ç¤ºå¯¹å¤–æä¾›çš„ <code>RPC</code>  æ¥å£ã€‚  <code>chapter02-provider-impl</code>  è¡¨ç¤º  <code>RPC</code>  æ¥å£çš„å®ç°ã€‚</p>\n<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE3.png\" alt=\"\"></p>\n<h4 id=\"chapter02-provider-api\"><a class=\"markdownIt-Anchor\" href=\"#chapter02-provider-api\">#</a>  <code>chapter02-provider-api</code></h4>\n<h5 id=\"å¼•å…¥pomæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥pomæ–‡ä»¶\">#</a> å¼•å…¥ <code>pom</code>  æ–‡ä»¶</h5>\n<p>æœ¬æ¨¡å—ä¸‹æ— éœ€æ”¹åŠ¨ï¼Œä½¿ç”¨ <code>IDEA</code>  ç”Ÿæˆçš„å³å¯ã€‚å…·ä½“ä»£ç è§æ–‡æœ«</p>\n<h5 id=\"å®šä¹‰rpcæ¥å£\"><a class=\"markdownIt-Anchor\" href=\"#å®šä¹‰rpcæ¥å£\">#</a> å®šä¹‰ <code>RPC</code>  æ¥å£</h5>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æœåŠ¡è€…æä¾›çš„æ¥å£è§„èŒƒ</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 20:44</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IProviderService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ¼”ç¤ºè°ƒç”¨demo</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> name å…¥å‚ï¼Œéšå³è¿”å›</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &quot;hello, &#123;name&#125; . I am dubbo.&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·  <code>provider-api</code>  æœåŠ¡å°±é…ç½®å®Œæˆäº†ã€‚</p>\n<h4 id=\"chapter02-provider-impl\"><a class=\"markdownIt-Anchor\" href=\"#chapter02-provider-impl\">#</a>  <code>chapter02-provider-impl</code></h4>\n<h5 id=\"å¼•å…¥pomæ–‡ä»¶-2\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥pomæ–‡ä»¶-2\">#</a> å¼•å…¥ <code>pom</code>  æ–‡ä»¶</h5>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- æœåŠ¡æä¾›è€…çš„RPCæ¥å£ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fxb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>chapter02-provider-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- å¼•å…¥Dubbo --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.0.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®applicationyml\"><a class=\"markdownIt-Anchor\" href=\"#é…ç½®applicationyml\">#</a> é…ç½® <code>application.yml</code></h4>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dubbo:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"comment\">#application-name</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">springboot-multicast-provider</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">springboot-multicast-provider</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"comment\"># ä»¥å¹¿æ’­çš„åè®®è¿›è¡Œå‘å¸ƒ.</span></span><br><span class=\"line\">    <span class=\"attr\">address:</span> <span class=\"string\">multicast://224.5.6.7:1234</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">  <span class=\"attr\">protocol:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">dubbo</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">20880</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8080</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘\"><a class=\"markdownIt-Anchor\" href=\"#å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘\">#</a> å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘</h4>\n<p>å³ å®ç° <code>RPC</code>  æ¥å£ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * sayHello çš„å…·ä½“å®ç°</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 20:47</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@DubboService</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">IProviderService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span> <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;hello, %s.  I am dubbo.&quot;</span>, name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ·»åŠ dubboæ³¨è§£\"><a class=\"markdownIt-Anchor\" href=\"#æ·»åŠ dubboæ³¨è§£\">#</a> æ·»åŠ  <code>Dubbo</code>  æ³¨è§£</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"comment\">// é›†æˆDubbo</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDubbo</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chapter02ProviderImplApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Chapter02ProviderImplApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬å¯åŠ¨æœåŠ¡ã€‚å¯ä»¥çœ‹åˆ°:</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE2.png\" alt=\"\"></p>\n<p>è¿™æ ·æœåŠ¡æä¾›è€…å°±å¯åŠ¨æˆåŠŸäº†ã€‚</p>\n<h3 id=\"åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…\">#</a> åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…</h3>\n<p>æ¶ˆè´¹è€…çš„ç›®å½•ç»“æ„å¦‚ä¸‹:</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE4.png\" alt=\"\"></p>\n<h4 id=\"å¼•å…¥mavenä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥mavenä¾èµ–\">#</a> å¼•å…¥ maven ä¾èµ–</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- æ”¯æŒdubbo --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.0.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- æœåŠ¡æä¾›è€…çš„RPCæ¥å£ --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fxb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>chapter02-provider-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"é…ç½®applicationyml-2\"><a class=\"markdownIt-Anchor\" href=\"#é…ç½®applicationyml-2\">#</a> é…ç½® application.yml</h4>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dubbo:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"comment\">#application-name</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">chapter02-with-springboot-consumer</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">chapter02-with-springboot-consumer</span></span><br><span class=\"line\">  <span class=\"attr\">registry:</span></span><br><span class=\"line\">    <span class=\"attr\">address:</span> <span class=\"string\">multicast://224.5.6.7:1234</span></span><br><span class=\"line\">    <span class=\"attr\">id:</span> <span class=\"string\">registry</span></span><br><span class=\"line\">  <span class=\"attr\">protocol:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">dubbo</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">20880</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8081</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™controller\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–å†™controller\">#</a> ç¼–å†™ Controller</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¶ˆè´¹è€…demoï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 21:00</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConsumerService consumerService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;chapter02/sayHello/&#123;name&#125;&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">(<span class=\"meta\">@PathVariable</span> String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> consumerService.sayHello(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™serviceå±‚è°ƒç”¨æä¾›æä¾›è€…\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–å†™serviceå±‚è°ƒç”¨æä¾›æä¾›è€…\">#</a> ç¼–å†™ <code>Service</code>  å±‚ï¼Œè°ƒç”¨æä¾›æä¾›è€…</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘å®ç°</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 21:02</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¼•ç”¨DubboæœåŠ¡ã€‚ä½¿ç”¨@DubboReferenceæ³¨è§£</span></span><br><span class=\"line\">    <span class=\"meta\">@DubboReference</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> IProviderService providerService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> providerService.sayHello(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¼–å†™å¯åŠ¨ç±»\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–å†™å¯åŠ¨ç±»\">#</a> ç¼–å†™å¯åŠ¨ç±»</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDubbo</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Chapter02ConsumerApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Chapter02ConsumerApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¯åŠ¨åï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°:</p>\n<p><img data-src=\"/images/dubbo/chapter002-%E5%9B%BE5.png\" alt=\"\"></p>\n<p>è¡¨ç¤ºå¯åŠ¨æˆåŠŸ</p>\n<h4 id=\"æµ‹è¯•\"><a class=\"markdownIt-Anchor\" href=\"#æµ‹è¯•\">#</a> æµ‹è¯•</h4>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è°ƒç”¨æ¶ˆè´¹è€…çš„ sayHello æ¥å£  <code>http://localhost:8081/chapter02/sayHello/fangjiaxiaobai</code>  å°±ä¼šçœ‹åˆ°  <code>hello, fangjiaxiaobai. I am dubbo.</code></p>\n<p>è¿™æ ·ä¸€ä¸ªæœ€æœ€ç²¾ç®€çš„ <code>Dubbo</code>  é›†æˆ <code>Springboot</code>  çš„æœåŠ¡å°±éƒ¨ç½²å®Œæˆäº†ã€‚</p>\n<h2 id=\"æ–‡æœ«ä»£ç \"><a class=\"markdownIt-Anchor\" href=\"#æ–‡æœ«ä»£ç \">#</a> æ–‡æœ«ä»£ç </h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVhcm5famF2YS90cmVlL21hc3Rlci9meGJfZHViYm8vZGVtbzAyLXdpdGgtc3ByaW5nYm9vdA==\">ä»£ç åœ°å€ -&gt;github</span></p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/dubbo/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "Java",
                "dubbo"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/14/BQ/hdoj/HD-1001/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/14/BQ/hdoj/HD-1001/",
            "title": "1001 Sum Problem",
            "date_published": "2021-10-14T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®ä¿¡æ¯\">#</a> é¢˜ç›®ä¿¡æ¯</h2>\n<blockquote>\n<p>Time Limit: 1000/500 MS (Java/Others)    Memory Limit: 65536/32768 K (Java/Others)<br>\nTotal Submission(s): 745568    Accepted Submission(s): 188863</p>\n</blockquote>\n<h3 id=\"problem-description\"><a class=\"markdownIt-Anchor\" href=\"#problem-description\">#</a> Problem Description</h3>\n<p>Hey, welcome to HDOJ(Hangzhou Dianzi University Online Judge).</p>\n<p>In this problem, your task is to calculate SUM(n) = 1 + 2 + 3 + â€¦ + n.</p>\n<h3 id=\"input\"><a class=\"markdownIt-Anchor\" href=\"#input\">#</a> Input</h3>\n<p>The input will consist of a series of integers n, one integer per line.</p>\n<h3 id=\"output\"><a class=\"markdownIt-Anchor\" href=\"#output\">#</a> Output</h3>\n<p>For each case, output SUM(n) in one line, followed by a blank line. You may assume the result will be in the range of 32-bit signed integer.</p>\n<h3 id=\"sample-input\"><a class=\"markdownIt-Anchor\" href=\"#sample-input\">#</a> Sample Input</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1</span><br><span class=\"line\">100</span><br></pre></td></tr></table></figure>\n<h3 id=\"sample-output\"><a class=\"markdownIt-Anchor\" href=\"#sample-output\">#</a> Sample Output</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1</span><br><span class=\"line\"></span><br><span class=\"line\">5050</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h2>\n<h3 id=\"cè¯­è¨€è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#cè¯­è¨€è§£æ³•\">#</a> C è¯­è¨€è§£æ³•</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> m;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (EOF != <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;m)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// it not work</span></span><br><span class=\"line\">        <span class=\"comment\">// printf(&quot;%d\\n\\n&quot;, m*(m+1)/2);</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> s = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt;= m; i++) &#123;</span><br><span class=\"line\">            s += i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n\\n&quot;</span>, s);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"be-careful\"><a class=\"markdownIt-Anchor\" href=\"#be-careful\">#</a> Be Careful</h2>\n<ul>\n<li>è¾“å‡ºç»“æœåè¦ä¸¤ä¸ªæ¢è¡Œ.</li>\n<li>è¿™é“é¢˜ä¸€å®šä¸è¦ä½¿ç”¨ç­‰å·®æ•°åˆ—æ±‚å’Œã€‚å› ä¸º <code>n*(n+1)</code>  ä¼šè¶…æ—¶  <code>int</code>  ç±»å‹æ•°å€¼èŒƒå›´ã€‚</li>\n</ul>\n<h3 id=\"é•¿ç‚¹å¿ƒå§\"><a class=\"markdownIt-Anchor\" href=\"#é•¿ç‚¹å¿ƒå§\">#</a> é•¿ç‚¹å¿ƒå§</h3>\n<p><span class=\"label warning\">é¢å‰æœ‰ä¸¤æ¡è·¯ï¼Œä¸­è§„ä¸­çŸ© and æ·å¾„ï¼Œæ˜¯é¼“åŠ±èµ°æ·å¾„çš„ã€‚ä½†æ˜¯ä¸€å®šè¦ç¡®å®šæ·å¾„çš„ç»“æœæ˜¯å’Œå¦ä¸€æ¡è·¯æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚å¦åˆ™è¿˜æ˜¯é€‰æ‹©ä¸­è§„ä¸­çŸ©çš„è·¯å§ã€‚å¦åˆ™æ˜¯ä¼šä»˜å‡ºä»£ä»·çš„ã€‚ä½ æ€ä¹ˆçŸ¥é“æ·å¾„æ˜¯ä¸æ˜¯ä¸€æ¡ä¸å½’è·¯å‘¢ï¼Ÿ</span></p>\n<h2 id=\"é“¾æ¥\"><a class=\"markdownIt-Anchor\" href=\"#é“¾æ¥\">#</a> é“¾æ¥</h2>\n<div class=\"links\"><div class=\"item\" title=\"æ­ç”µOj - 1001\" style=\"--block-color:#550370;\"><span class=\"exturl image\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMQ==\" data-background-image=\"https://fangjiaxiaobai.github.io/images/ac-code/acm.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMQ==\">æ­ç”µOj - 1001</span>\n          <p class=\"desc\">http://acm.hdu.edu.cn/</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1001é¢˜è§£\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAxLmNwcA==\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAxLmNwcA==\">ã€Cã€‘æ­ç”µOj-1001é¢˜è§£</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div></div>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "HD",
                "BQ",
                "AC"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/13/java%E7%B3%BB%E5%88%97/dubbo/01-%E6%90%AD%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%BA%AFdubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/13/java%E7%B3%BB%E5%88%97/dubbo/01-%E6%90%AD%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%BA%AFdubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8/",
            "title": "æ­å»ºç¬¬ä¸€ä¸ªçº¯dubboå¾®æœåŠ¡åº”ç”¨",
            "date_published": "2021-10-13T14:58:55.000Z",
            "content_html": "<p>æœ¬æ–‡æ—¨åœ¨å¿«é€Ÿæ­å»ºä¸€ä¸ª <b>çº¯ dubbo å¾®æœåŠ¡</b> åº”ç”¨ã€‚</p>\n<h2 id=\"åˆ›å»ºä¸€ä¸ªé¡¹ç›®\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºä¸€ä¸ªé¡¹ç›®\">#</a> åˆ›å»ºä¸€ä¸ªé¡¹ç›®</h2>\n<p><img data-src=\"/images/dubbo/chapter01-%E5%9B%BE1.png\" alt=\"\"></p>\n<ul>\n<li><code>consumer</code>  è¡¨ç¤ºä¸€ä¸ªæ¶ˆè´¹è€…ã€‚</li>\n<li><code>provider</code>  æ ‡è¯†ä¸€ä¸ªæœåŠ¡æä¾›è€…ã€‚</li>\n<li><code>provider-api</code>  è¡¨ç¤ºå¯¹å¤–æä¾›æœåŠ¡çš„ api.</li>\n</ul>\n<p>æˆ‘ä»¬ç°å®çš„å¼€å‘ä¸­ï¼Œå¾€å¾€æ˜¯ä¸€ä¸ªæœåŠ¡æ—¢å……å½“æœåŠ¡æä¾›è€…è§’è‰²ï¼Œåˆå……å½“æœåŠ¡æ¶ˆè´¹è€…çš„è§’è‰²ã€‚æ‰€ä»¥ï¼Œæ¯ä¸ªæœåŠ¡éƒ½ä¼šæœ‰ä¸€ä¸ªä¸¤ä¸ªæ¨¡å—ï¼Œ <code>1.provider</code> ï¼ŒæœåŠ¡çš„å®ç°é€»è¾‘æ¨¡å—ï¼Œ  <code>2.provider-api</code> : æœåŠ¡å¯¹å¤–æš´éœ²çš„ api æ¨¡å—ã€‚</p>\n<h2 id=\"å¼•å…¥ä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥ä¾èµ–\">#</a> å¼•å…¥ä¾èµ–</h2>\n<p>åœ¨ çˆ¶çº§ <code>pom</code>  ä¸­åŠ å…¥å¦‚ä¸‹ä¾èµ–:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo.version</span>&gt;</span>3.0.3<span class=\"tag\">&lt;/<span class=\"name\">dubbo.version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-dependencies-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ <code>dubbo3.x</code>  ç‰ˆæœ¬ã€‚åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œå¼€å‘è€…å°† <code>dubbo</code>  çš„ä¾èµ–è¿›è¡Œæ‹†åˆ†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¼•å…¥äº†  <code>dubbo</code>  å’Œ  <code>dubbo-dependencies-zookper</code>  è¿™ä¸¤ä¸ªä¾èµ–ã€‚</p>\n<h2 id=\"åˆ›å»ºæœåŠ¡æä¾›è€…\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæœåŠ¡æä¾›è€…\">#</a> åˆ›å»ºæœåŠ¡æä¾›è€…</h2>\n<p><img data-src=\"/images/dubbo/chapter01-%E5%9B%BE2.png\" alt=\"\"></p>\n<h3 id=\"è®¾ç½®apiä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#è®¾ç½®apiä¾èµ–\">#</a> è®¾ç½® api ä¾èµ–</h3>\n<p>åœ¨æœåŠ¡æä¾›è€…çš„å…·ä½“å®ç°æ¨¡å—ä¸­ ( <code>provider/pom.xml</code> )ï¼ŒåŠ å…¥ <code>api</code>  æ¨¡å—ä¾èµ–</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fxb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>provider-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å®šä¹‰-æœåŠ¡é—´çš„äº¤äº’åè®®å¥‘çº¦è§„èŒƒ\"><a class=\"markdownIt-Anchor\" href=\"#å®šä¹‰-æœåŠ¡é—´çš„äº¤äº’åè®®å¥‘çº¦è§„èŒƒ\">#</a> å®šä¹‰ æœåŠ¡é—´çš„äº¤äº’åè®® (å¥‘çº¦ / è§„èŒƒ)</h3>\n<p>å…¶å®å°±æ˜¯å®šä¹‰æœåŠ¡é—´çš„ <code>RPC</code>  æ¥å£ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å®šä¹‰rpcçš„äº¤äº’è§„èŒƒ</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 16:16</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IProviderService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * say hello</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &quot;hello dubbo&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">sayHello</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘\"><a class=\"markdownIt-Anchor\" href=\"#å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘\">#</a> å®ç°æœåŠ¡æä¾›è€…çš„ä¸šåŠ¡é€»è¾‘</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å®ç°æœåŠ¡çš„å…·ä½“é€»è¾‘</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 16:00</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">IProviderService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;hello, dubbo!&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯¹å¤–æä¾›æœåŠ¡\"><a class=\"markdownIt-Anchor\" href=\"#å¯¹å¤–æä¾›æœåŠ¡\">#</a> å¯¹å¤–æä¾›æœåŠ¡</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æœåŠ¡å¯åŠ¨</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 16:01</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String zookeeperHost = <span class=\"string\">&quot;127.0.0.1&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        ServiceConfig&lt;IProviderService&gt; service = <span class=\"keyword\">new</span> ServiceConfig&lt;&gt;();</span><br><span class=\"line\">        service.setApplication(<span class=\"keyword\">new</span> ApplicationConfig(<span class=\"string\">&quot;first-dubbo-provider&quot;</span>));</span><br><span class=\"line\">        service.setRegistry(<span class=\"keyword\">new</span> RegistryConfig(<span class=\"string\">&quot;zookeeper://&quot;</span> + zookeeperHost + <span class=\"string\">&quot;:2181&quot;</span>));</span><br><span class=\"line\">        service.setInterface(IProviderService.class);</span><br><span class=\"line\">        service.setRef(<span class=\"keyword\">new</span> ProviderServiceImpl());</span><br><span class=\"line\">        service.export();</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;dubbo service started&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>).await();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…\">#</a> åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…</h2>\n<p><img data-src=\"/images/dubbo/chapter01-%E5%9B%BE3.png\" alt=\"\"></p>\n<h3 id=\"å¼•å…¥apiä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#å¼•å…¥apiä¾èµ–\">#</a> å¼•å…¥ api ä¾èµ–</h3>\n<p>åœ¨æœåŠ¡æ¶ˆè´¹è€…çš„ <code>pom</code>  æ–‡ä»¶ä¸­ ( <code>comsumer/pom.xml</code> )ï¼Œæ·»åŠ å¦‚ä¸‹ <code>maven</code>  ä¾èµ–</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fxb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>provider-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"æ¶ˆè´¹é€»è¾‘\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹é€»è¾‘\">#</a> æ¶ˆè´¹é€»è¾‘</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æœåŠ¡æ¶ˆè´¹è€…</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021-10-13 16:20</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String zookeeperHost = <span class=\"string\">&quot;127.0.0.1&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ReferenceConfig&lt;IProviderService&gt; reference = <span class=\"keyword\">new</span> ReferenceConfig&lt;&gt;();</span><br><span class=\"line\">        reference.setApplication(<span class=\"keyword\">new</span> ApplicationConfig(<span class=\"string\">&quot;first-dubbo-consumer&quot;</span>));</span><br><span class=\"line\">        reference.setRegistry(<span class=\"keyword\">new</span> RegistryConfig(<span class=\"string\">&quot;zookeeper://&quot;</span> + zookeeperHost + <span class=\"string\">&quot;:2181&quot;</span>));</span><br><span class=\"line\">        reference.setInterface(IProviderService.class);</span><br><span class=\"line\">        IProviderService service = reference.get();</span><br><span class=\"line\">        String message = service.sayHello();</span><br><span class=\"line\">        System.out.println(message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"é™„å½•æ­å»ºzookeeperæ³¨å†Œä¸­å¿ƒ\"><a class=\"markdownIt-Anchor\" href=\"#é™„å½•æ­å»ºzookeeperæ³¨å†Œä¸­å¿ƒ\">#</a> é™„å½•ï¼šæ­å»º <code>zookeeper</code>  æ³¨å†Œä¸­å¿ƒ</h2>\n<p>ç”±äºæ˜¯å•æœºæ¼”ç¤ºï¼Œå°±ç®€å•çš„ä½¿ç”¨  <code>å•æœºzookeeper</code>  å°±å¥½äº†ï¼Œ</p>\n<p>é€šè¿‡  <code>https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz</code>  ä¸‹è½½ <code>zookeeper</code>  çš„ <code>jar</code>  åŒ…ï¼Œè§£å‹åï¼Œä½¿ç”¨  <code>zkServer.sh(Mac OS) </code> æˆ–è€…  <code>zkServer.cmd(Windowså¹³å°)</code>  å¯åŠ¨å°±å¯ä»¥äº†ã€‚é»˜è®¤ç«¯å£ä½¿ç”¨çš„æ˜¯ <code>2181</code> .</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/dubbo/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "Java",
                "dubbo"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/10/13/BQ/hdoj/HD-1000/",
            "url": "https://fangjiaxiaobai.github.io/2021/10/13/BQ/hdoj/HD-1000/",
            "title": "1000 A + B Problem",
            "date_published": "2021-10-13T10:18:18.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®ä¿¡æ¯\">#</a> é¢˜ç›®ä¿¡æ¯</h2>\n<blockquote>\n<p>Time Limit: 2000/1000 MS (Java/Others)    Memory Limit: 65536/32768 K (Java/Others)<br>\nTotal Submission(s): 1060311    Accepted Submission(s): 313490</p>\n</blockquote>\n<h3 id=\"problem-description\"><a class=\"markdownIt-Anchor\" href=\"#problem-description\">#</a> Problem Description</h3>\n<p>Calculate A + B.</p>\n<h3 id=\"input\"><a class=\"markdownIt-Anchor\" href=\"#input\">#</a> Input</h3>\n<p>Each line will contain two integers A and B. Process to end of file.</p>\n<h3 id=\"output\"><a class=\"markdownIt-Anchor\" href=\"#output\">#</a> Output</h3>\n<p>For each case, output A + B in one line.</p>\n<h3 id=\"sample-input\"><a class=\"markdownIt-Anchor\" href=\"#sample-input\">#</a> Sample Input</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"sample-output\"><a class=\"markdownIt-Anchor\" href=\"#sample-output\">#</a> Sample Output</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2</span><br></pre></td></tr></table></figure>\n<h2 id=\"é¢˜è§£\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜è§£\">#</a> é¢˜è§£</h2>\n<h3 id=\"cè¯­è¨€è§£æ³•\"><a class=\"markdownIt-Anchor\" href=\"#cè¯­è¨€è§£æ³•\">#</a> C è¯­è¨€è§£æ³•</h3>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> m, n;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (EOF != <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d %d&quot;</span>, &amp;m, &amp;n)) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, m + n);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"be-careful\"><a class=\"markdownIt-Anchor\" href=\"#be-careful\">#</a> Be Careful</h2>\n<ul>\n<li>è¾“å‡ºç»“æœåè¦æ¢è¡Œ.</li>\n<li><code>EOF != scanf(&quot;%d %d&quot;, &amp;m, &amp;n)</code>  ä¹Ÿå¯ä»¥å†™æˆ  <code>~scanf(&quot;%d %d&quot;, &amp;m, &amp;n)</code></li>\n</ul>\n<h2 id=\"é“¾æ¥\"><a class=\"markdownIt-Anchor\" href=\"#é“¾æ¥\">#</a> é“¾æ¥</h2>\n<div class=\"links\"><div class=\"item\" title=\"æ­ç”µOj - 1000\" style=\"--block-color:#550370;\"><span class=\"exturl image\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMA==\" data-background-image=\"https://fangjiaxiaobai.github.io/images/ac-code/acm.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cDovL2FjbS5oZHUuZWR1LmNuL3Nob3dwcm9ibGVtLnBocD9waWQ9MTAwMA==\">æ­ç”µOj - 1000</span>\n          <p class=\"desc\">http://acm.hdu.edu.cn/</p>\n          </div></div><div class=\"item\" title=\"ã€Cã€‘æ­ç”µOj-1000é¢˜è§£\" style=\"--block-color:#c98200;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAwLmNwcA==\" data-background-image=\"https://portrait.gitee.com/uploads/avatars/user/344/1032308_fangjiaxiaobai_1578938745.png\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvbGVldENvZGUvYmxvYi9jL3NyYy9IRC0xMDAwLmNwcA==\">ã€Cã€‘æ­ç”µOj-1000é¢˜è§£</span>\n          <p class=\"desc\">https://gitee.com/fangjiaxiaobai/leetCode.git</p>\n          </div></div></div>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "HD",
                "BQ",
                "AC"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/28/rocketMQ/2-02-RocketMQ-Arch-Message/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/28/rocketMQ/2-02-RocketMQ-Arch-Message/",
            "title": "RocketMQç³»åˆ—-æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯",
            "date_published": "2021-09-28T11:26:00.000Z",
            "content_html": "<p>ä¸Šä¸€ç¯‡æ–‡ç« <a href=\"/2021/09/28/rocketMQ/2-01-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E5%90%AF%E5%8A%A8/\"> RocketMQ æ¶æ„è®¾è®¡ä¹‹å¯åŠ¨è¿‡ç¨‹è§£æ</a> åˆ†æäº†  <code>NameServer</code> ,  <code>Broker</code> ,  <code>Producer</code> ,  <code>Consumer</code>  å››ä¸ªéƒ¨åˆ†çš„å¯åŠ¨è¿‡ç¨‹ï¼Œè¿™è¾¹æ–‡ç« æˆ‘ä»¬åˆ†æ <b>æ¶ˆæ¯çš„æ”¶å‘è¿‡ç¨‹</b>.</p>\n<h2 id=\"ç”Ÿäº§è€…å‘é€æ¶ˆæ¯è¿‡ç¨‹è§£æ\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯è¿‡ç¨‹è§£æ\">#</a> ç”Ÿäº§è€…å‘é€æ¶ˆæ¯è¿‡ç¨‹è§£æ</h2>\n<p>æˆ‘ä»¬è¿˜æ˜¯çœ‹ä¸Šç¯‡æ–‡ç« ä¸­çš„ä¾‹å­:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨GroupNameåˆå§‹åŒ–Producer</span></span><br><span class=\"line\">DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// æŒ‡å®šNameSrvçš„åœ°å€: ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡NAMESRV_ADDRæ¥æŒ‡å®šï¼Œåˆ™ä¸éœ€è¦ä¸‹é¢è¿™ä¸€è¡Œã€‚</span></span><br><span class=\"line\">producer.setNamesrvAddr(<span class=\"string\">&quot;name-server1-ip:9876;name-server2-ip:9876&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// å¯åŠ¨å®ä¾‹</span></span><br><span class=\"line\">producer.start();</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºæ¶ˆæ¯å®ä¾‹,æŒ‡å®š topic, tag, message body.</span></span><br><span class=\"line\">    Message msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span> <span class=\"comment\">/* Topic */</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;TagA&quot;</span> <span class=\"comment\">/* Tag */</span>,</span><br><span class=\"line\">        (<span class=\"string\">&quot;Hello RocketMQ !!&quot;</span>).getBytes(RemotingHelper.DEFAULT_CHARSET) <span class=\"comment\">/* Message body */</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// å‘é€æ¶ˆæ¯ç»™Broker</span></span><br><span class=\"line\">    SendResult sendResult = producer.send(msg);</span><br><span class=\"line\">    System.out.printf(<span class=\"string\">&quot;%s%n&quot;</span>, sendResult);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">    e.printStackTrace();</span><br><span class=\"line\">    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// å…³é—­ç”Ÿäº§è€…</span></span><br><span class=\"line\">producer.shutdown();</span><br></pre></td></tr></table></figure>\n<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ä¸­ï¼Œæˆ‘ä»¬æ˜¯çœ‹åˆ°äº†  <code>producer.start();</code> , ç°åœ¨æˆ‘ä»¬æ¥ç€æ¥çœ‹  <code>producer.send(msg);</code>  çš„è¿‡ç¨‹ã€‚ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæœ‰ç®€å•çš„ä»‹ç»è¿‡æ¶ˆæ¯çš„å‘é€åˆ†ä¸ºä¸‰æ­¥ï¼š</p>\n<ul>\n<li>è·å–  <code>topic</code>  çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè·¯ç”±ä¿¡æ¯ï¼Œæ˜¯å¦ä¸ºæœ‰åºé˜Ÿåˆ—ï¼Œ <code>MessageQueue</code>  åˆ—è¡¨ï¼Œæ¶ˆæ¯ä¼šå‘é€çš„é˜Ÿåˆ—çš„ç´¢å¼•ã€‚</li>\n<li>é€‰æ‹©  <code>MessageQueue</code></li>\n<li>å‘é€æ¶ˆæ¯</li>\n</ul>\n<p>å…·ä½“å®ç°çš„ä»£ç åœ¨  <code>org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl#sendDefaultImpl</code>  æ–¹æ³•ä¸­ã€‚</p>\n<p>åœ¨æ¶ˆæ¯çš„å‘é€è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šæ ¡éªŒå½“å‰ <code>Producer</code>  çš„è¿è¡ŒçŠ¶æ€ï¼Œç„¶ååˆ¤æ–­æ¶ˆæ¯çš„ <code>group</code> , <code>topic</code>  ç­‰ç­‰æ˜¯å¦ä¸ºç©ºã€‚ åˆæ³•ä¹‹åï¼Œä¼šè·å– <code>topic</code>  çš„ <code>MessageQueue</code>  åˆ—è¡¨ã€‚ä» <code>messageQueue</code>  åˆ—è¡¨ä¸­æŸ¥æ‰¾å‡ºä¸€ä¸ªå‘é€çš„ <code>messageQueue</code> . é€šè¿‡ä»€ä¹ˆçš„æœºåˆ¶é€‰å– <code>MessageQueue</code>  å‘¢ï¼Ÿè¿™é‡Œä¼šæ¶‰åŠåˆ°ä¸€ä¸ª  <code>Broker</code>  çš„å»¶è¿Ÿå®¹é”™æœºåˆ¶ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šè¯¦è§£çš„ä»‹ç»è¿™ä¸ªæœºåˆ¶ã€‚å½“æ¶ˆæ¯ç¬¬ä¸€æ¬¡è¿‡æ¥çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ <code>Random</code>  éšæœºé€‰æ‹©ä¸€ä¸ª <code>messageQueue</code> ï¼Œè¿›è¡Œå‘é€ï¼Œå¦‚æœå‘é€å¤±è´¥ï¼Œä¼šå°†è¯¥ <code>messageQueue</code>  éš”ç¦»èµ·æ¥ï¼Œé‡è¯•çš„æ—¶å€™ï¼Œä¸ä¼šç»™è¿™ä¸ª  <code>messageQueue</code>  æŠ•é€’æ¶ˆæ¯ã€‚é€‰æ‹©å‡ºæ¥äº† <code>MessageQueue</code>  ä¹‹åï¼Œè¿›è¡Œå‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯é¦–å…ˆä¼šæ ¹æ® <code>BrokerName</code>  è·å– <code>broker</code>  çš„åœ°å€ï¼Œæ‰§è¡Œå‡ ä¸ª  <code>RpcHook</code> , ç„¶åå°è£…è¯·æ±‚å¤´ï¼Œæ ¹æ®æˆ‘ä»¬å‘é€æ–¹å¼çš„ä¸åŒï¼Œä¼šé€‰æ‹©å¯¹åº”çš„è¯·æ±‚å‘½ä»¤ ( <code>Send_Message</code> , <code>Send_Reply_Message</code> , <code>Send_Reply_Message_V2</code>  ç­‰ç­‰) å‘é€ï¼Œæ¶ˆæ¯å‘é€å®Œæˆä¹‹åï¼Œä¼šæ›´æ–° <code>Producer</code>  ç«¯çš„  <code>brokerå®¹é”™è¡¨</code> ã€‚è¿™æ ·æ¶ˆæ¯å°±å‘é€å‡ºå»äº†ã€‚</p>\n<h3 id=\"å»¶è¿Ÿå®¹é”™æœºåˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#å»¶è¿Ÿå®¹é”™æœºåˆ¶\">#</a> å»¶è¿Ÿå®¹é”™æœºåˆ¶</h3>\n<p><code>RocketMQ</code>  å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œç”±äº  <code>nameServer</code>  æ£€æµ‹  <code>Broker</code>  æ˜¯å¦å­˜æ´»æ˜¯æœ‰å»¶è¿Ÿçš„ï¼Œåœ¨ é€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¹Ÿå¯èƒ½é‡åˆ°å®•æœºçš„ <code>Broker</code> , å› ç½‘ç»œé—®é¢˜å‘é€å¤±è´¥çš„ä¸æ—¶ä¼šå‘ç”Ÿï¼Œå› æ¬¡  <code>RocketMQ</code>  å®ç°è¿™ç§ é«˜å¯ç”¨çš„è®¾è®¡æ–¹æ¡ˆã€‚</p>\n<p>åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å„¿å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬ä»ä»£ç ä¸­çœ‹çœ‹ç«¯å€ªã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%99.png\" alt=\"\"></p>\n<p>æ–‡ä¸­å›¾ç‰‡æˆ‘æ ‡æ³¨äº†ä¸¤å¤„ä»£ç </p>\n<h4 id=\"é‡è¯•\"><a class=\"markdownIt-Anchor\" href=\"#é‡è¯•\">#</a> é‡è¯•</h4>\n<p>å½“æ¶ˆæ¯æ˜¯ åŒæ­¥æ–¹å¼å‘é€çš„æ—¶å€™ï¼Œæ ¹æ®é…ç½®çš„å±æ€§è¿›è¡Œé‡è¯•ï¼Œé»˜è®¤ä¸º 3 æ¬¡ã€‚ å¦‚æœæ˜¯å•å‘æ–¹å¼æˆ–è€…å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œå‘é€æ—¶ï¼Œåˆ™å°±ä¼šå‘é€ä¸€æ¬¡ï¼Œä¸ä¼šé‡è¯•ã€‚ å¯ä»¥çœ‹åˆ°ç¡®å®å¯ä»¥ä»ä¸€å®šç¨‹åº¦ä¸Šæé«˜æ¶ˆæ¯å‘é€æˆåŠŸçš„å‡ ç‡ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ˜¯ <code>broker</code>  å®•æœºï¼Œé‡è¯•åªä¼šå¢åŠ æ—¶é•¿ã€‚</p>\n<p>å…ˆä¸æ€¥ç€è§£å†³ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ¶ˆæ¯ç¬¬ä¸€æ¬¡å‘é€æ˜¯æ€æ ·çš„è¿‡ç¨‹ã€‚ å›¾ä¸­ 2 å¤„ï¼Œä¼šæ ¹æ®  <code>topicPublishInfo</code>  å–å‡ºä¸€ä¸ª <code>MessageQueue</code> ã€‚ è·Ÿè¿›ä»£ç ï¼š</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%992.png\" alt=\"\"></p>\n<p>ç„¶åæ¥ç€è¿›å…¥ä»£ç </p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%993.png\" alt=\"\"></p>\n<p>æˆ‘ä»¬å…ˆå‡è®¾  <code>sendLatencyFaultEnable = false</code> . æˆ‘ä»¬å†çœ‹ä¸€ä¸‹å…·ä½“å®ç°:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%994.png\" alt=\"\"></p>\n<p>å…¶ä¸­  <code>sendWhichQueue</code>  å­—æ®µå°±æ˜¯ä¸Šä¸€æ¬¡æ¶ˆæ¯å‘é€çš„ <code>MessageQueue List</code>  çš„ä¸‹æ ‡ã€‚</p>\n<p>æœ€åå°±æ˜¯æ ¹æ®  <code>selectOneMessage()</code>  æ–¹æ³•é€šè¿‡è½®è¯¢çš„æ–¹å¼æ¥é€‰ <code>MessageQueue</code>  äº†ã€‚ç¬¬ä¸€æ¬¡æ˜¯é€šè¿‡éšæœºçš„æ–¹å¼æ¥é€‰å‡ºç¬¬ä¸€ä¸ª  <code>MessageQueue</code>  çš„ï¼Œé‡è¯•çš„éƒ½æ˜¯ è½®è¯¢çš„å»å–äº†ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%995.png\" alt=\"\"></p>\n<p>é‚£å½“:  <code>sendLatencyFaultEnable = true</code>  çš„æ—¶å€™å‘¢ï¼Ÿ</p>\n<p><code>sendLatencyFaultEnable</code>  æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ å®ƒè¡¨ç¤ºæ˜¯å¦å¯ç”¨  <code>Broker</code>  æ•…éšœå»¶è¿Ÿæœºåˆ¶ã€‚ çœ‹ä¸‹å›¾ä¸­çš„ä»£ç ï¼Œæˆ‘ä»¬å‡è®¾ å¯ç”¨äº†  <code>Broker</code>  æ•…éšœå»¶è¿Ÿæœºåˆ¶ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%996.png\" alt=\"\"></p>\n<p>å›¾ä¸­æ ‡æ³¨çš„éƒ¨åˆ†ä¸Šé¢çš„é€»è¾‘ å’Œåˆšæ‰ é€‰æ‹© <code>MessageQueueçš„</code> æœºåˆ¶æ˜¯ä¸€æ ·çš„ã€‚ é‚£å¥¥ç§˜è‚¯å®šæ˜¯åœ¨ä¸‹é¢çš„ä»£ç ä¸­äº† (å›¾ä¸­æ¡†é€‰çš„éƒ¨åˆ†)</p>\n<p><code>latencyFaultTolerance</code>  æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ <code>latencyFaultTolerance</code>  æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´è¯‘å°±æ˜¯ï¼šå»¶è¿Ÿå®¹é”™ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å»¶è¿Ÿå®¹é”™</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> &lt;T&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">LatencyFaultTolerance</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ›´æ–°å¤±è´¥çš„Brokerã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> name                 brokerName</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> currentLatency       æœ¬æ¬¡æ¶ˆæ¯å‘é€çš„æ—¶é•¿</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> notAvailableDuration è§„é¿brokerçš„æ—¶é•¿</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">updateFaultItem</span><span class=\"params\">(<span class=\"keyword\">final</span> T name, <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> currentLatency, <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> notAvailableDuration)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ¤æ–­Brokeræ˜¯å¦å¯ä»¥ç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> name brokerçš„åç§°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isAvailable</span><span class=\"params\">(<span class=\"keyword\">final</span> T name)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä»Brokeræ•…éšœåˆ—è¡¨ä¸­ç§»é™¤</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> name</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">remove</span><span class=\"params\">(<span class=\"keyword\">final</span> T name)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å¼¹å‡ºæœ€åä¸€ä¸ª Broker</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">T <span class=\"title\">pickOneAtLeast</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹  <code>latencyFaultTolerance.isAvailable(mq.getBrokerName())</code>  çš„å®ç°</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isAvailable</span><span class=\"params\">(<span class=\"keyword\">final</span> String name)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// faultItemTable æ˜¯ä¸€ä¸ª ConcurrentHashMap</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> FaultItem faultItem = <span class=\"keyword\">this</span>.faultItemTable.get(name);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (faultItem != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­è¯¥Broker(messageQueue)æ˜¯å¦åœ¨è§„é¿æ—¶é—´å†…ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> faultItem.isAvailable();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>faultItem.isAvailable()</code>  çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isAvailable</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (System.currentTimeMillis() - startTimestamp) &gt;= <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»è¿™ä¸¤æ®µä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ¤æ–­  <code>Broker</code>  æ˜¯å¦å¯ç”¨çš„åˆ¤æ–­ä¾æ®å°±æ˜¯ï¼šå½“å‰æ—¶é—´æ˜¯å¦å¤§äº  <code>startTimeStamp</code> ã€‚  <code>startTimeStamp</code>  æ ‡è¯† è¯¥ <code>Broker</code>  å¯ä»¥å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ã€‚</p>\n<p>çœ‹åˆ°è¿™é‡Œï¼Œä¸€å¤´é›¾æ°´ã€‚  åˆ†åŒºå®¹é”™åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬è¿”å›ä¸Šä¸€å±‚ï¼Œä»æ¡†é€‰çš„ä¸‹é¢æ¥ç€çœ‹ï¼š</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%996.png\" alt=\"\"></p>\n<p>å¦‚æœè¿˜æ²¡æœ‰é€‰å‡ºä¸€ä¸ªå¯ç”¨  <code>MessageQueue</code> ï¼Œåˆ™ä¼šä¸­ æ•…éšœçš„ <code>Broker</code>  åˆ—è¡¨ä¸­é€‰å‡ºä¸€ä¸ª <code>Broker</code> ï¼Œåˆ¤æ–­è¿™ä¸ª broker æ˜¯å¦æœ‰ <code>MessageQueue</code> ï¼Œå¦‚æœæœ‰åˆ™éšæœº (è½®è¯¢) çš„é€‰ä¸€ä¸ªï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»æ•…éšœçš„ <code>Broker</code>  åˆ—è¡¨ä¸­ç§»é™¤ä¸€ä¸ªï¼Œä½¿ç”¨é»˜è®¤çš„æœºåˆ¶é€‰æ‹©ä¸€ä¸ª <code>MessageQueue</code>  æŠ•é€æ¶ˆæ¯ã€‚</p>\n<p>é€‰æ‹©å‡ºæ¥ <code>MessageQueue</code>  ä¹‹åï¼Œå°±ä¼šå‘é€æ¶ˆæ¯äº†ã€‚</p>\n<p>å‘é€å®Œæ¶ˆæ¯ è¿˜è¿›è¡Œäº†ä¸€ä¸ªæ“ä½œ</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">// æ›´æ–°topicçš„ä¸€ä¸ªMessageQueue æ˜¯å¦å¯ç”¨</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.updateFaultItem(mq.getBrokerName(), endTimestamp - beginTimestampPrev, <span class=\"keyword\">false</span>);</span><br></pre></td></tr></table></figure>\n<p>è¿™æ˜¯å¹²ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬ç›´è¯‘è¿‡æ¥ æ›´æ–°æ•…éšœ (é”™è¯¯) çš„æ¡ç›®ã€‚å»çœ‹ä¸€ä¸‹ä»£ç å®ç°:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%997.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆæ˜¯è°ƒç”¨äº†  <code>MqFaultStrategty</code>  çš„  <code>updateFaultItem()</code>  æ–¹æ³•ã€‚ è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œäº†ä¸¤ä¸ªæ–¹æ³•ï¼Œ <code>computeNotAvailableDuration</code>  è®¡ç®—ä¸å¯ç”¨çš„æ—¶é•¿ï¼Œ å’Œ   <code>latencyFaultTolerance</code>  çš„ <code>updateFaultItem</code>  æ–¹æ³•ã€‚</p>\n<p>ä¸Šå›¾ä¸­è´´å‡ºäº†  <code>computeNotAvailableDuration</code>  æ–¹æ³•çš„å®ç°ã€‚æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸¤ä¸ªæ•°ç»„  <code>latencyMax</code>  å’Œ  <code>notAvailableDuration</code>  , è¿™ä¸¤ä¸ªæ•°ç»„å°±æ˜¯å»¶è¿Ÿæœºåˆ¶çš„æ ¸å¿ƒäº†ã€‚æ•°ç»„çš„å®šä¹‰å¦‚ä¸‹:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * å»¶è¿Ÿæœºåˆ¶ - æœ¬æ¬¡æ¶ˆæ¯å‘é€æ—¶é•¿åŒºé—´ï¼Œç”¨äºæ˜ å°„è®¡ç®—å‡ºéœ€è¦è§„é¿Brokerçš„æ—¶é•¿ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">long</span>[] latencyMax = &#123;<span class=\"number\">50L</span>, <span class=\"number\">100L</span>, <span class=\"number\">550L</span>, <span class=\"number\">1000L</span>, <span class=\"number\">2000L</span>, <span class=\"number\">3000L</span>, <span class=\"number\">15000L</span>&#125;;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * å»¶è¿Ÿæœºåˆ¶ - è§„é¿Brokerçš„æ—¶é•¿</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">long</span>[] notAvailableDuration = &#123;<span class=\"number\">0L</span>, <span class=\"number\">0L</span>, <span class=\"number\">30000L</span>, <span class=\"number\">60000L</span>, <span class=\"number\">120000L</span>, <span class=\"number\">180000L</span>, <span class=\"number\">600000L</span>&#125;;</span><br></pre></td></tr></table></figure>\n<p>æ–¹æ³•ä¸­çš„å½¢å‚  <code>currentlatency</code>  ä¸ºæœ¬æ¬¡æ¶ˆæ¯å‘é€çš„å»¶è¿Ÿæ—¶é—´ã€‚</p>\n<p>è°ƒç”¨ <code>computeNotAvailableDuration</code>  æ–¹æ³•çš„å®å‚  <code>isolation</code>  è¡¨ç¤ºè¯¥ <code>Broker</code>  æ˜¯å¦éœ€è¦è§„é¿ã€‚å¦‚æœæ¶ˆæ¯å‘é€æˆåŠŸï¼Œ <code>isolation</code>  å°±æ˜¯ <code>false</code> , åä¹‹ï¼Œå°±æ˜¯ä»£è¡¨ <code>Broker</code>  éœ€è¦è¢«è§„é¿ã€‚ä»  <code>computeNotAvailableDuration</code>  æ–¹æ³•çš„å®ç°å¯ä»¥çœ‹å‡ºï¼šå…¶ä¼šæ ¹æ® æœ¬æ ¡æ¶ˆæ¯å‘é€çš„å»¶è¿Ÿæ—¶é—´ ä»  <code>latencyMax</code>  æ•°ç»„å°¾éƒ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ª æ¯”  <code>currentlatency</code>  å°çš„æ•°ç»„ä¸‹æ ‡ <code>i</code> ï¼Œæ²¡æœ‰åˆ™è¿”å› <code>0</code> ï¼Œ å°†  <code>notAvailableDuration[i]</code>  è¿›è¡Œè¿”å›ã€‚ å½“ <code>isolation=true</code>  çš„æ—¶å€™ï¼Œå°±ä¼šé»˜è®¤æœ‰ <code>10</code>  åˆ†é’Ÿçš„è§„é¿æ—¶é•¿ï¼Œåä¹‹ï¼Œè§„é¿æ—¶é•¿å°±ä¼šæ¶ˆæ¯å‘é€çš„å»¶æ—¶æ˜¯å¤šå°‘äº†ã€‚</p>\n<p>æˆ‘ä»¬æ¥ç€çœ‹  <code>latencyFaultTolerance</code>  çš„ <code>updateFaultItem</code>  æ–¹æ³•</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-%20broker%E5%AE%B9%E9%94%998.png\" alt=\"\"></p>\n<p>å›¾ä¸­å¯¹ä»£ç è¿›è¡Œæ³¨é‡Šï¼Œä¸è¿‡å¤šè§£é‡Šäº†ã€‚å…¶ä¸­  <code>FaultItem</code>  æ˜¯ å­˜å‚¨æ•…éšœ <code>broker</code>  çš„ç±»ï¼Œå¯ä»¥ç§°ä¸º å¤±è´¥æ¡ç›®ï¼Œæ¯ä¸ª <code>FaultItem</code>  å­˜å‚¨äº† <code>broker</code>  çš„åç§°ï¼Œæ¶ˆæ¯å‘é€å»¶è¿Ÿçš„æ—¶é•¿ï¼Œæ•…éšœè§„é¿ç»“æŸçš„å¼€å§‹æ—¶é—´ã€‚</p>\n<p>é‚£ä¹ˆæ›´æ–°è¿™ä¸¤ä¸ªå­—æ®µçš„å€¼æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿä¸çŸ¥ä½ æ˜¯å¦æœ‰å°è±¡ï¼Œåˆšæ‰è¯´æœ‰ä¸€å¤´é›¾æ°´çš„åœ°æ–¹ã€‚</p>\n<p>åœ¨é€‰æ‹© <code>MessageQueue</code>  çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­ <code>messageQueue</code>  æ˜¯å¦å¯ç”¨ï¼Œè°ƒç”¨äº† æ•…éšœå®¹å™¨æ¥å£çš„  <code>isAvalilable</code>  æ–¹æ³•ï¼Œæ–¹æ³•å°±æ˜¯æ ¹æ®  <code>startTimestamp</code>  æ¥è¿›è¡Œåˆ¤æ–­æ”¹é˜Ÿåˆ—æ˜¯å¦å¯ç”¨çš„ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isAvailable</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (System.currentTimeMillis() - startTimestamp) &gt;= <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚æœå½“å‰çš„ç³»ç»Ÿæ—¶é—´å¤§äºæ•…éšœè§„é¿å¼€å§‹æ—¶é—´ï¼Œè¯´æ˜ <code>broker</code>  å¯ä»¥åŠ å…¥è½®è¯¢çš„é˜Ÿä¼é‡Œã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯ ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ æ•´ä¸ªè¿‡ç¨‹äº†ã€‚</p>\n<h3 id=\"ç”Ÿäº§è€…æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…æ€»ç»“\">#</a> ç”Ÿäº§è€…æ€»ç»“</h3>\n<p>æˆ‘ä»¬çŸ¥é“äº† ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œä¸‰æ­¥å®Œæˆï¼Œ1. è·å– <code>topic</code>  çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚è·¯ç”±ä¿¡æ¯ï¼Œ <code>MessageQueue</code>  é˜Ÿåˆ—åˆ—è¡¨ç­‰ï¼Œ 2. é€‰æ‹©åˆé€‚çš„ <code>MessageQueue</code> ï¼Œæˆ‘ä»¬ä¹Ÿç€é‡ä»‹ç»äº†  <code>Broker</code>  çš„æ•…éšœå»¶è¿Ÿæœºåˆ¶ï¼Œè¿™ä¹Ÿæ˜¯ <code>RocketMQ</code>  å®ç°é«˜å¯ç”¨çš„æ–¹å¼ä¹‹ä¸€ã€‚ 3. å‘é€æ¶ˆæ¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿‡å¤šçš„ä»‹ç»ï¼Œä½¿ç”¨ <code>nettyClient</code>  å°†  <code>Message</code>  å‘é€è¿‡  <code>Broker</code>  ç«¯ã€‚</p>\n<h2 id=\"broker-å­˜å‚¨æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#broker-å­˜å‚¨æ¶ˆæ¯\">#</a> Broker å­˜å‚¨æ¶ˆæ¯</h2>\n<p>ä¸Šé¢æˆ‘ä»¬åˆ†æäº†ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ•´ä½“è¿‡ç¨‹ï¼Œå°¤å…¶ç€é‡çš„åˆ†æäº† ç”Ÿäº§è€…é€‰æ‹© <code>MessageQueue</code>  æ—¶å€™çš„å®¹é”™æœºåˆ¶ã€‚ç”Ÿäº§è€…ä¼šæŠŠæ¶ˆæ¯å‘é€ç»™ <code>Broker</code> ï¼Œè¿›è¡Œå­˜å‚¨ï¼Œå­˜å‚¨æ˜¯ä¸€ä¸ªæ€æ ·çš„æµç¨‹å‘¢ï¼Ÿ</p>\n<p>æˆ‘ç›´æ¥è¿›å…¥ä¸»é¢˜ï¼Œä»  <code>SendMessageProcessor</code>  è¯´èµ·ã€‚</p>\n<p>ä¸ºä»€ä¹ˆä¸Šæ¥å°±è¯´ è¿™ä¸ªç±»å‘¢ï¼Ÿä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº† <code>Broker</code>  çš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥çŸ¥é“çš„  <code>Broker</code>  å¯åŠ¨äº† <code>NettyServer</code>  ç­‰å¾…ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…å‘é€æ¥è¯·æ±‚ã€‚è¿™ä¸ª  <code>SendMessageProcessor</code>  å°±æ˜¯ <code>Broker</code>  æ¥å—ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„å¤„ç†å™¨ã€‚</p>\n<p>å…·ä½“çš„ä»£ç åœ¨  <code>org.apache.rocketmq.broker.BrokerController#registerProcessor</code>  ä¸­ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF1.png\" alt=\"\"></p>\n<p>æ ¹æ®ä¹‹å‰çš„å†…å®¹ï¼Œæˆ‘ä»¬å·²çŸ¥ å‘é€çš„æ¶ˆæ¯æœ‰ äº‹åŠ¡æ¶ˆæ¯ï¼Œæ‰¹é‡æ¶ˆæ¯ï¼Œå•æ¡çš„æ™®é€šæ¶ˆæ¯ä¸‰ç§ç±»å‹ï¼Œå¹¶ä¸”  <code>RocketMQ</code>  æ”¯æŒåŒæ­¥å­˜å‚¨å’Œå¼‚æ­¥å­˜å‚¨ä¸¤ç§æ–¹å¼ã€‚æ‰€ä»¥ è‚¯å®šæ˜¯ <code>Broker</code>  ç«¯æä¾›äº†è¿™å…­ç§æ¶ˆæ¯çš„å­˜å‚¨æ–¹å¼ã€‚</p>\n<p>å®é™…ä¸Šï¼Œä¹Ÿç¡®å®æ”¯æŒäº†è¿™ 6 ç§æ–¹å¼ã€‚æˆ‘ä»¬å…ˆä»  <code>SendMessageProcessor</code>  çš„ç±»ç»§æ‰¿å…³ç³»æ¥çœ‹ä¸€ä¸‹  <code>Broker</code>  æ˜¯å¦‚ä½•è¿›è¡Œæ¶ˆæ¯å­˜å‚¨ï¼Œæˆ‘ä¹Ÿä¼šæŒ‰ç…§è¿™æ ·çš„æ€è·¯æ¥è¡Œæ–‡ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF2.png\" alt=\"\"></p>\n<h3 id=\"æ¥æ”¶åŒæ­¥æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#æ¥æ”¶åŒæ­¥æ¶ˆæ¯\">#</a> æ¥æ”¶åŒæ­¥æ¶ˆæ¯</h3>\n<p>åŒæ­¥æ¶ˆæ¯å¤„ç†çš„æœ¬è´¨ä¸Šè¿˜æ˜¯å¼‚æ­¥çš„å¤„ç†æ–¹å¼ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response = asyncProcessRequest(ctx, request).get();</span><br></pre></td></tr></table></figure>\n<p>æ¥ç€å¾€ä¸‹çœ‹</p>\n<h3 id=\"å¼‚æ­¥æ¶ˆæ¯å¤„ç†\"><a class=\"markdownIt-Anchor\" href=\"#å¼‚æ­¥æ¶ˆæ¯å¤„ç†\">#</a> å¼‚æ­¥æ¶ˆæ¯å¤„ç†</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> CompletableFuture&lt;RemotingCommand&gt; <span class=\"title\">asyncProcessRequest</span><span class=\"params\">(ChannelHandlerContext ctx,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        RemotingCommand request)</span> <span class=\"keyword\">throws</span> RemotingCommandException </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> SendMessageContext mqtraceContext;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (request.getCode()) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ¶ˆè´¹è€…å‘é€å›æ¥çš„æ¶ˆæ¯(å¯èƒ½æ˜¯æ¶ˆè´¹å¤±è´¥ä¹‹åçš„?)</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> RequestCode.CONSUMER_SEND_MSG_BACK:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.asyncConsumerSendMsgBack(ctx, request);</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"comment\">// å¤„ç†ç”Ÿäº§è€…å‘é€æ¥çš„æ¶ˆæ¯</span></span><br><span class=\"line\">                SendMessageRequestHeader requestHeader = parseRequestHeader(request);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (requestHeader == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CompletableFuture.completedFuture(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                mqtraceContext = buildMsgContext(ctx, requestHeader);</span><br><span class=\"line\">                <span class=\"comment\">// æ¶ˆæ¯å‘é€å‰çš„é’©å­ã€‚åœ¨æ¶ˆæ¯å‘é€ä¹‹å‰ï¼Œæ‰§è¡Œä¸€äº›æ“ä½œã€‚</span></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.executeSendMessageHookBefore(ctx, request, mqtraceContext);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (requestHeader.isBatch()) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// å¦‚æœæ˜¯æ‰¹é‡æ¶ˆæ¯</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.asyncSendBatchMessage(ctx, request, mqtraceContext, requestHeader);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// ä¸æ˜¯æ‰¹é‡æ¶ˆæ¯</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.asyncSendMessage(ctx, request, mqtraceContext, requestHeader);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œ <code>Broker</code>  ä¸ä»…å¤„ç†æ¥è‡ª ç”Ÿäº§è€…å‘é€æ¥çš„æ¶ˆæ¯ï¼Œè¿˜éœ€è¦å¤„ç† æ¶ˆè´¹è€… æ¶ˆè´¹å¤±è´¥é‡è¯•çš„æ¶ˆæ¯ã€‚æ¶ˆè´¹è€…é‡è¯•çš„æ¶ˆæ¯è¿™éƒ¨åˆ†æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬åé¢å†åˆ†æã€‚æˆ‘ä»¬å…ˆçœ‹å¤„ç†ç”Ÿäº§è€…å‘é€æ¥çš„æ¶ˆæ¯è¿™éƒ¨åˆ†ã€‚</p>\n<p>ä»£ç ä¸­æ˜¾ç¤ºï¼Œä¼šåˆ¤æ–­æ¶ˆæ¯çš„ç±»å‹ï¼Œæ˜¯å¦æ˜¯æ‰¹é‡æ¶ˆæ¯ï¼Œåˆ†åˆ«è°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œè¿›è¡Œå­˜å‚¨ã€‚å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF3.png\" alt=\"\"></p>\n<p>ä¸Šå›¾ä¸­ä¸æ˜¯å®Œæ•´çš„ä»£ç ï¼Œæˆ‘åˆ é™¤äº†ä¸€äº›ä¸é‡è¦çš„ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸ç®¡æ˜¯æ‰¹é‡æ¶ˆæ¯è¿˜æ˜¯å•æ¡æ¶ˆæ¯ (é™¤äº‹åŠ¡æ¶ˆæ¯) éƒ½æ˜¯äº¤ç»™äº†  <code>MessageStore</code>  è¿›è¡Œå­˜å‚¨çš„ã€‚ å½“ç„¶ï¼Œäº‹åŠ¡æ¶ˆæ¯æ˜¯äº¤ç»™äº†  <code>TransactionalMessageService</code>  è¿›è¡Œå­˜å‚¨çš„ï¼Œè¿™ä¸ªå†…å®¹æˆ‘ä»¬åœ¨åˆ†æ <code>RocketMQ</code>  äº‹åŠ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šç€é‡çš„åˆ†æï¼Œæœ¬æ–‡ä¸­å°±ä¸åšåˆ†æäº†ã€‚</p>\n<p>ç»§ç»­è·Ÿè¿›ä»£ç </p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF4.png\" alt=\"\"></p>\n<p><code>MessageStore</code>  åªæ˜¯å¯¹æ¶ˆæ¯ å’Œ  <code>Broker</code>  è¿›è¡Œäº†ç®€å•çš„æ ¡éªŒï¼Œå¹¶æ²¡æœ‰çœŸæ­£çš„å»å­˜å‚¨æ¶ˆæ¯ã€‚ è€Œæ˜¯æŠŠæ¶ˆæ¯äº¤ç»™äº†  <code>commitLog</code>  è¿›è¡Œå­˜å‚¨æ¶ˆæ¯ã€‚</p>\n<p>æˆ‘ä»¬ä»¥å•æ¡æ¶ˆæ¯ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸€ä¸‹  <code>commitLog</code>  å°†æ¶ˆæ¯å­˜å‚¨åˆ°æ–‡ä»¶ä¸­çš„å…·ä½“æµç¨‹ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF5.png\" alt=\"\"></p>\n<p>å¦‚ä¸Šå›¾ä¸­ï¼Œ  <code>commitLog</code>  æ”¶åˆ°æ¶ˆæ¯ï¼Œé¦–å…ˆä¼šé€‰æ‹©ä¸€ä¸ª <code>MappedFile</code> , è¿™ä¸ª  <code>MappedFile</code>  ä»£è¡¨ ç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶åœ¨å†…å®¹ä¸­çš„æ˜ å°„ã€‚æŒ‡ä»£  <code>$HOME/store/commitlog</code>  ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ä¹Ÿä»£è¡¨äº†æ¶ˆæ¯è¦å†™å…¥çš„æ–‡ä»¶ã€‚  <code>MappedFile</code>  ä¼šæŠŠæ¶ˆæ¯å†™åˆ°ç¼“å†²åŒºä¸­ (å³å³ä¸Šå›¾)ï¼Œ æ¶ˆæ¯é¡ºåˆ©å†™å®Œä¹‹åï¼Œå°±è§¦å‘åˆ·ç›˜åŠ¨ä½œï¼Œåˆ·ç›˜æœ‰ä¸¤ç§æ–¹å¼ï¼š åŒæ­¥å†™ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ã€‚ åŒæ­¥å†™ç›˜æ˜¯æŒ‡ç­‰å¾…  <code>FlushCommitLogService</code>  æŠŠæ¶ˆæ¯çœŸæ­£å†™åˆ°ç‰©ç†ç£ç›˜ä¸Šï¼Œç„¶åå†è¿”å›ã€‚å¼‚æ­¥åˆ·ç›˜æ˜¯æŒ‡ å”¤é†’  <code>FlushCommitLogService</code>  æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¸ç­‰å¾…å…¶æ˜¯å¦çœŸæ­£æŠŠæ¶ˆæ¯å†™å…¥äº†ç‰©ç†ç£ç›˜ä¸­ã€‚ æœ€åï¼Œä¼šæŠŠæ¶ˆæ¯åŒæ­¥åˆ°å…¶ä»–çš„å‰¯æœ¬æœåŠ¡ä¸­ã€‚</p>\n<h3 id=\"å­˜å‚¨æ¶ˆæ¯æµç¨‹æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#å­˜å‚¨æ¶ˆæ¯æµç¨‹æ€»ç»“\">#</a> å­˜å‚¨æ¶ˆæ¯æµç¨‹æ€»ç»“</h3>\n<p><code>Broker</code>  æ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œä¼šç”±  <code>SendMessageProcessor</code>  è¿›è¡Œæ¥æ”¶ï¼Œç„¶åä¼šæ ¹æ®æ¶ˆæ¯çš„ç±»å‹å•æ¡æ¶ˆæ¯ï¼Œæ‰¹é‡æ¶ˆæ¯ï¼Œè¿˜æ˜¯äº‹åŠ¡æ¶ˆæ¯ï¼Œåˆ†åˆ«è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚å½“ç„¶ä¹Ÿä¼šåŒºåˆ†å¼‚æ­¥å­˜å‚¨è¿˜æ˜¯åŒæ­¥çš„å­˜å‚¨æ¶ˆæ¯ã€‚æ–¹æ³•å®ç°ä¸Šæœ¬è´¨è¿˜æ˜¯è°ƒç”¨ å¼‚æ­¥çš„æ–¹æ³•æ¥å®ç°çš„ï¼Œ <code>SendMessageProcessor</code>  ä¼šæŠŠæ¶ˆæ¯è½¬äº¤ç»™  <code>CommitLog</code>  è¿›è¡Œæ ¡éªŒï¼Œä¼šæ£€æŸ¥å½“å‰ <code>Broker</code>  å’Œå½“å‰æ¶ˆæ¯çš„çŠ¶æ€ï¼Œç„¶åäº¤ç»™ <code>MappedFile</code>  çœŸæ­£çš„å­˜å‚¨æ¶ˆæ¯ï¼Œ <code>MappedFile</code>  è¡¨ç¤ºå­˜å‚¨æ¶ˆæ¯çš„ç‰©ç†æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æ˜ å°„ï¼Œé¦–å…ˆä¼šæŠŠæ¶ˆæ¯çš„å†…å®¹å†™åˆ°ç¼“å†²åŒºä¸­ï¼Œç„¶åè°ƒç”¨åˆ·ç›˜çš„æ–¹å¼ (åŒæ­¥å†™ç›˜æˆ–è€…å¼‚æ­¥åˆ·ç›˜) å°†æ¶ˆæ¯çœŸæ­£çš„å†™åˆ°ç‰©ç†ç£ç›˜ä¸Šã€‚ç„¶åï¼Œå°†æ¶ˆæ¯åŒæ­¥ç»™å…¶ä»–å‰¯æœ¬ã€‚</p>\n<h3 id=\"å†æ¢è®¨ä¸€ç‚¹ç»†èŠ‚\"><a class=\"markdownIt-Anchor\" href=\"#å†æ¢è®¨ä¸€ç‚¹ç»†èŠ‚\">#</a> å†æ¢è®¨ä¸€ç‚¹ç»†èŠ‚</h3>\n<h4 id=\"è·å–mappedfile\"><a class=\"markdownIt-Anchor\" href=\"#è·å–mappedfile\">#</a> è·å– MappedFile</h4>\n<p>åœ¨ Broker å°†æ¶ˆæ¯å†™å…¥ MappedFile ä¹‹å‰ï¼Œå°±éœ€è¦éœ€è¦è·å–åˆ°ä¸€ä¸ª MappedFile è¿›è¡Œå†™å…¥ã€‚å¦‚ä½•è·å–çš„å‘¢ï¼Ÿ</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF6.png\" alt=\"\"></p>\n<p>åœ¨ asyncPutMessages æ–¹æ³•ä¸­ï¼Œæœ‰ä¸¤å¤„è·å– MappedFile çš„ä»£ç ã€‚</p>\n<p>ç¬¬ä¸€å¤„ä»£ç ï¼Œå€’æ˜¯æ²¡æœ‰å¤æ‚çš„é€»è¾‘</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> MappedFile <span class=\"title\">getLastMappedFile</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    MappedFile mappedFileLast = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.mappedFiles.isEmpty()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            mappedFileLast = <span class=\"keyword\">this</span>.mappedFiles.get(<span class=\"keyword\">this</span>.mappedFiles.size() - <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//continue;</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;getLastMappedFile has exception.&quot;</span>, e);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mappedFileLast;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç¬¬äºŒå¤„ä»£ç ï¼Œç¨æœ‰çŒ«è…»ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> MappedFile <span class=\"title\">getLastMappedFile</span><span class=\"params\">(<span class=\"keyword\">final</span> <span class=\"keyword\">long</span> startOffset)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getLastMappedFile(startOffset, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF7.png\" alt=\"\"></p>\n<p>åˆ›å»ºæ–‡ä»¶çš„ä»£ç å’Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»£ç æœ‰åˆ å‡ã€‚</p>\n<p>è§£é‡Šä¸€ä¸‹çŒ«è…»ï¼šåˆ›å»º  <code>MappedFile</code>  çš„æ—¶å€™ï¼Œä¸€æ¬¡ä¼šåˆ›å»ºä¸¤ä¸ª <code>MappedFile</code> , è¿™æ ·ä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥é€šè¿‡ ä¸€å¤„çš„ä»£ç è·å–åˆ°  <code>MappedFile</code> ï¼Œè€Œä¸ç”¨å†å»åˆ›å»º  <code>MappedFile</code>  äº†ã€‚ ç”±äº çœŸå®çš„åˆ›å»º <code>MappedFile</code>  æ˜¯ç”± åå°  <code>AllocateMappedFileService</code>  çº¿ç¨‹æ¥åˆ›å»ºçš„ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæµªè´¹æ—¶é—´ã€‚</p>\n<p>ä»£ç æ˜¾ç¤ºï¼Œä¼šæŠŠ  <code>AllocateRequest</code>  åˆ†åˆ«æ”¾åˆ°  <code>requestTable</code>  å’Œ  <code>requestQueue</code>  ä¸­ã€‚  <code>AllocateRequest</code>  æ˜¯ åˆ›å»º  <code>MappedFile</code>  æ–‡ä»¶è¯·æ±‚ï¼Œ  <code>requesetTable</code>  æ˜¯ä¸€ä¸ª  <code>concurrentHashMap</code>  ,  <code>key</code>  æ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œ <code>Value</code>  æ˜¯  <code>AllocateRequest</code> ã€‚ å­˜å‚¨äº† è·¯å¾„å’Œ <code>AllocateRequest</code>  çš„æ˜ å°„å…³ç³»ã€‚  <code>requestQueue</code> ï¼Œæ˜¯è¯·æ±‚çš„é˜Ÿåˆ—ï¼Œ <code>PriorityBlockingQueue</code> ï¼Œåå° <code>AllocateMappedFileService</code>  çº¿ç¨‹ä¼š <code>requestQueue</code>  å–å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œåˆ†é…çš„æ—¶å€™æœ‰ä¸¤ç§ç­–ç•¥ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ <code>Mmap</code>  çš„æ–¹å¼æ¥æ„å»º <code>MappedFile</code>  å®ä¾‹ï¼Œå¦å¤–ä¸€ç§æ˜¯ä» <code>TransientStorePool</code>  å †å¤–å†…å­˜æ± ä¸­è·å–ç›¸åº”çš„ <code>DirectByteBuffer</code>  æ¥æ„å»º <code>MappedFile</code> .</p>\n<h2 id=\"consumer-æ¶ˆè´¹æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#consumer-æ¶ˆè´¹æ¶ˆæ¯\">#</a> Consumer æ¶ˆè´¹æ¶ˆæ¯</h2>\n<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† æ¶ˆè´¹è€…æœ‰ä¸¤ç§å®ç°:  <code>DefaultLitePullConsumerImpl</code>  å’Œ  <code>DefaultMQPushConsumerImpl</code> . æˆ‘ä»¬å…ˆæš‚æ—¶æŠ›å¼€è¿™ä¸¤ç§å…·ä½“çš„å®ç°æ–¹å¼ã€‚ ä»ç¨å¾®é«˜ä¸€ç‚¹çš„è§’åº¦æ¥çœ‹ä¸€ä¸‹æ¶ˆæ¯è€…æ¶ˆè´¹æ¶ˆæ¯çš„é€»è¾‘ã€‚ä» <b>æ¶ˆè´¹è€…æ³¨å†Œ</b>, <b>è´Ÿè½½å‡è¡¡</b>ï¼Œ<b>æ‹‰å–æ¶ˆæ¯</b>ï¼Œ<b>æ¶ˆè´¹æ¶ˆæ¯</b> è¿™ä¸ªæ€è·¯æ¥è¡Œæ–‡ã€‚</p>\n<h3 id=\"æ¶ˆæ¯è€…æ³¨å†Œ\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯è€…æ³¨å†Œ\">#</a> æ¶ˆæ¯è€…æ³¨å†Œ</h3>\n<p>æ¶ˆè´¹è€…å¯åŠ¨åï¼Œæ¯éš” <code>10ms</code>  ä¼šä»  <code>NameServer</code>  æŸ¥è¯¢ä¸€æ¬¡ç”¨æˆ·è®¢é˜…çš„æ‰€æœ‰è¯é¢˜è·¯ç”±ä¿¡æ¯.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/** æ¯10msä»NameServeræ‹‰å–ä¸€ä¸‹ TopicRouteInfo*/</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.scheduledExecutorService.scheduleAtFixedRate(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            MQClientInstance.<span class=\"keyword\">this</span>.updateTopicRouteInfoFromNameServer();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;ScheduledTask updateTopicRouteInfoFromNameServer exception&quot;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;, <span class=\"number\">10</span>, <span class=\"keyword\">this</span>.clientConfig.getPollNameServerInterval(), TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure>\n<p>æ›´æ–° <code>topic</code>  è·¯ç”±ä¿¡æ¯åœ¨ä¸Šç¯‡æ–‡ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†çš„å»ä»‹ç»äº†ï¼Œåªæ˜¯ç®€å•çš„ä¸²ä¸€ä¸‹æ¶ˆæ¯è€…æ¶ˆè´¹æ¶ˆæ¯çš„æµç¨‹ã€‚</p>\n<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>æ¯ç§’å‘é€ä¸€æ¬¡å¿ƒè·³æ£€æµ‹.</li>\n<li>æ¯ 10s æŒä¹…åŒ–ä¸€æ¬¡  <code>Consumer</code>  çš„ <code>offset</code> . è¯´åˆ°è¿™ç±»ï¼Œ åœ¨å¯åŠ¨çš„æ—¶å€™ä¹Ÿä¼šåŠ è½½æŒ‡å®šç›®å½•ä¸‹çš„  <code>consumeOffset</code> .</li>\n<li>æ¯åˆ†é’Ÿ æ‰«æ  <code>consumerTable</code>  è‡ªåŠ¨è°ƒæ•´çº¿ç¨‹æ± å¤§å°</li>\n</ul>\n<h3 id=\"æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡\">#</a> æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡</h3>\n<p>åœ¨æ¶ˆè´¹è€…å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šå¯åŠ¨  <code>RebalenceService</code> . çœ‹åå­—å°±çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè´Ÿè½½å‡è¡¡æœåŠ¡ã€‚ ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿåœ¨ä»»ä½•ä¸€ä¸ªæ¶ˆè´¹è€… å¯åŠ¨ï¼Œå…³é—­ï¼Œé‡ç½®æ¶ˆè´¹åç§» çš„æ—¶å€™ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªè¿™ä¸ªæœåŠ¡çš„é‡å¹³è¡¡æ“ä½œã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æœ¬æœº å¯åŠ¨æ—¶=&gt;å…¶ä»–çš„æ¶ˆè´¹è€…ä¼šå—åˆ° consumerIdså‘ç”Ÿå˜æ›´çš„è¯·æ±‚ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">/** 5.å¯åŠ¨è´Ÿè½½å‡è¡¡æœåŠ¡ org.apache.rocketmq.client.impl.factory.MQClientInstance#start*/</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.rebalanceService.start();</span><br><span class=\"line\"><span class=\"comment\">// å…¶ä»–çš„æ¶ˆæ¯è€…å¯åŠ¨æˆ–è€…å…³é—­æ—¶,å³ consumerId å‘ç”Ÿå˜åŠ¨çš„æ—¶å€™ org.apache.rocketmq.client.impl.ClientRemotingProcessor#processRequest</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> RequestCode.NOTIFY_CONSUMER_IDS_CHANGED:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.notifyConsumerIdsChanged(ctx, request);</span><br><span class=\"line\"><span class=\"comment\">// æ§åˆ¶ç«¯ é‡ç½®æ¶ˆè´¹åç§»é‡æ—¶ org.apache.rocketmq.client.impl.ClientRemotingProcessor#processRequest</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> RequestCode.RESET_CONSUMER_CLIENT_OFFSET:</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.resetOffset(ctx, request);</span><br></pre></td></tr></table></figure>\n<p>é‡å¹³è¡¡æ“ä½œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>\n<p>æˆ‘ä»¬éƒ½çŸ¥é“ åœ¨ <code>Broker</code>  ç«¯ç®¡ç†æ¶ˆæ¯çš„æœ€å°å•ä½æ˜¯ <code>MessageQueue</code>  , è€Œä¸æ˜¯  <code>topic</code> ã€‚æ¯”å¦‚ å½“ä½ å‘é€äº†  <code>10</code>  æ¡ç›¸åŒè¯é¢˜çš„æ¶ˆæ¯ï¼Œè¿™  <code>10</code>  æ¡è¯é¢˜å¯èƒ½å­˜å‚¨åœ¨äº†ä¸åŒ  <code>Broker</code>  æœåŠ¡å™¨çš„ä¸åŒé˜Ÿåˆ—ä¸­ã€‚æ‰€ä»¥ å½“æˆ‘ä»¬è®¨è®ºæ¶ˆæ¯é˜Ÿåˆ—è´Ÿè½½å‡è¡¡çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨è®¨è®ºæœåŠ¡å™¨ç«¯çš„æ‰€æœ‰é˜Ÿåˆ—å¦‚ä½•ç»™æ‰€æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹çš„é—®é¢˜ã€‚åœ¨  <code>RocketMQ</code>  ä¸­ï¼Œå®¢æˆ·ç«¯æœ‰ä¸¤ç§æ¶ˆè´¹æ¨¡å¼ï¼Œä¸€ç§æ˜¯<b>å¹¿æ’­æ¨¡å¼</b>ï¼Œå¦å¤–ä¸€ç§æ˜¯<b>é›†ç¾¤æ¨¡å¼</b>ã€‚</p>\n<p>æˆ‘ä»¬ç°åœ¨å‡è®¾æ€»å…±æœ‰ä¸¤å°  <code>Broker</code>  æœåŠ¡å™¨ï¼Œå‡è®¾ç”¨æˆ·ä½¿ç”¨  <code>Producer</code>  å·²ç»å‘é€äº†  <code>8</code>  æ¡æ¶ˆæ¯ï¼Œè¿™  <code>8</code>  æ¡æ¶ˆæ¯ç°åœ¨å‡è¡¡çš„åˆ†å¸ƒåœ¨ä¸¤å° Broker æœåŠ¡å™¨çš„  <code>8</code>  ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªæ¶ˆæ¯ã€‚ç°åœ¨æœ‰  <code>3</code>  å°æ¶ˆè´¹è€…éƒ½è®¢é˜…äº†  <code>Test</code>  è¯é¢˜çš„æ¶ˆè´¹è€…å®ä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹åœ¨ä¸åŒæ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œä¸åŒçš„æ¶ˆè´¹è€…ä¼šæ”¶åˆ°å“ªå‡ æ¡æ¶ˆæ¯ã€‚</p>\n<h4 id=\"å¹¿æ’­æ¨¡å¼\"><a class=\"markdownIt-Anchor\" href=\"#å¹¿æ’­æ¨¡å¼\">#</a> å¹¿æ’­æ¨¡å¼</h4>\n<p>è¿™ç§æ–¹å¼ä¸‹ï¼Œæ¯å°æ¶ˆè´¹è€…éƒ½ä¼šæ”¶åˆ° <code>8</code>  æ¡æ¶ˆæ¯ã€‚æ‰€ä»¥ï¼Œåœ¨å¹¿æ’­çš„æ¨¡å¼ä¸‹ï¼Œé‡å¹³è¡¡æ“ä½œæ‰§è¡Œå¦‚ä¸‹æ‰€ç¤º:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ¶ˆè´¹è€…çš„æ¨¡å¼: å¹¿æ’­è¿˜æ˜¯é›†ç¾¤æ¨¡å¼</span></span><br><span class=\"line\"><span class=\"keyword\">switch</span> (messageModel) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¹¿æ’­æ–¹å¼ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> BROADCASTING: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// topicSubscribeInfoTable: å­˜å‚¨topic å¯¹åº”çš„ MessageQueue åˆ—è¡¨.</span></span><br><span class=\"line\">        Set&lt;MessageQueue&gt; mqSet = <span class=\"keyword\">this</span>.topicSubscribeInfoTable.get(topic);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mqSet != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ›´æ–° æ¶ˆè´¹è€…æ¶ˆè´¹è®¢é˜…è¡¨ã€‚è¿”å›æ˜¯å¦å‘ç”Ÿäº†å˜åŠ¨ã€‚</span></span><br><span class=\"line\">            <span class=\"keyword\">boolean</span> changed = <span class=\"keyword\">this</span>.updateProcessQueueTableInRebalance(topic, mqSet, isOrder);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (changed) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å¦‚æœå‘ç”Ÿäº†å˜åŠ¨ï¼Œåˆ™æ ¹æ®ä¸åŒçš„æ¶ˆè´¹æ¶ˆè´¹æ–¹å¼å¤„ç†ï¼š</span></span><br><span class=\"line\">                <span class=\"comment\">// push,åˆ™éœ€è¦é€šçŸ¥ç»™Brokerï¼Œæ›´æ–°å„ä¸ªæ¶ˆè´¹è€…çš„è®¢é˜…å…³ç³»ã€‚</span></span><br><span class=\"line\">                <span class=\"comment\">// pull,åˆ™ä¼šé€šçŸ¥æ¶ˆè´¹è€…ï¼Œæ‰§è¡Œæ¶ˆè´¹é€»è¾‘ã€‚</span></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.messageQueueChanged(topic, mqSet, mqSet);</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;messageQueueChanged &#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;&quot;</span>, consumerGroup, topic, mqSet, mqSet);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            log.warn(<span class=\"string\">&quot;doRebalance, &#123;&#125;, but the topic[&#123;&#125;] not exist.&quot;</span>, consumerGroup, topic);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> ....:</span><br><span class=\"line\">    <span class=\"comment\">// çœç•¥..</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚ä¸Šé¢ä»£ç ä¸­çš„æ³¨é‡Šï¼Œ ä¸»è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¿æ’­æ¨¡å¼ä¸‹ï¼Œ <code>messageQueue</code>  å‘ç”Ÿå˜åŠ¨ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„æ¶ˆè´¹æ–¹å¼ ( <code>pull</code> / <code>push</code> ), æ‰§è¡Œä¸åŒçš„é€»è¾‘ã€‚</p>\n<ul>\n<li><code>push</code>  æ–¹å¼ï¼šä¼šæ›´æ–°æ¶ˆæ¯æ¶ˆè´¹è®¢é˜…è¡¨çš„ç‰ˆæœ¬ï¼Œç„¶åä¼šé€šçŸ¥ <code>Broker</code> ï¼Œè§¦å‘ <code>consumerId</code>  å˜åŠ¨ã€‚</li>\n<li><code>pull</code>  æ–¹å¼ï¼šä¼šé‡æ–° <code>pull</code>  æ¶ˆæ¯ï¼Œæ‰§è¡Œ <code>pullTask</code> .</li>\n</ul>\n<h4 id=\"é›†ç¾¤æ¨¡å¼\"><a class=\"markdownIt-Anchor\" href=\"#é›†ç¾¤æ¨¡å¼\">#</a> é›†ç¾¤æ¨¡å¼</h4>\n<p>é›†ç¾¤æ¨¡å¼æ˜¯æŒ‡æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—ä¼šæŒ‰ç…§æŸç§åˆ†é…ç­–ç•¥æ¥åˆ†ç»™ä¸åŒçš„æ¶ˆè´¹è€…å®¢æˆ·ç«¯ã€‚</p>\n<p>é›†ç¾¤æ–¹å¼ï¼Œä¸å°±æ˜¯å¤šä¸ªæ¶ˆè´¹è€…ååŒçš„æ¶ˆè´¹ä¸€ä¸ª <code>topic</code>  çš„æ•°æ®å—ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªæ¶ˆè´¹è€…ååŒçš„è®¢é˜… <code>topic</code>  ä¸‹çš„å¤šä¸ªæ¶ˆæ¯é˜Ÿåˆ— ( <code>MessageQueue</code> ). é‚£å°±éœ€è¦ä¸€ç§ç­–ç•¥å»åˆ†é…å¤šä¸ª <code>MessageQueue</code>  ç»™æ¯ä¸ªæ¶ˆè´¹è€…ã€‚</p>\n<p><code>RocktMQ</code>  æä¾›äº†å…­ç§ <code>MessageQueue</code>  çš„æ¶ˆè´¹ç­–ç•¥ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å½“å‰æ¶ˆè´¹è€… éœ€è¦æ¶ˆè´¹å“ªå‡ ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„åˆ†é…ç­–ç•¥ã€‚</span></span><br><span class=\"line\">AllocateMessageQueueStrategy strategy = <span class=\"keyword\">this</span>.allocateMessageQueueStrategy;</span><br><span class=\"line\"></span><br><span class=\"line\">List&lt;MessageQueue&gt; allocateResult = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// mqAll:å½“å‰topicå’Œgroupä¸‹çš„æ¶ˆè´¹é˜Ÿåˆ—åˆ—è¡¨.   cidAll: æ‰€æœ‰æ¶ˆè´¹é˜Ÿåˆ—çš„id.</span></span><br><span class=\"line\">    <span class=\"comment\">// ä¸¤è€…ä¸€ä¸€å¯¹åº”ã€‚</span></span><br><span class=\"line\">    allocateResult = strategy.allocate(<span class=\"keyword\">this</span>.consumerGroup, <span class=\"keyword\">this</span>.mQClientFactory.getClientId(),</span><br><span class=\"line\">        mqAll, cidAll);</span><br><span class=\"line\">&#125;<span class=\"keyword\">catch</span>(Throwable e)&#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>æ ¹æ®åˆ†é…ç­–ç•¥åˆ†é…å¥½è‡ªå·±è¦è®¢é˜…çš„ <code>MessageQueue</code>  ä¹‹åï¼Œå°±ä¼š æ›´æ–°æ¶ˆè´¹è€…æ¶ˆè´¹è®¢é˜…è¡¨ã€‚ç„¶åéœ€è¦æ ¹æ®ä¸åŒçš„æ¶ˆè´¹æ–¹å¼ ( <code>pull</code> / <code>push</code> ), æ‰§è¡Œä¸åŒçš„é€»è¾‘ã€‚</p>\n<ul>\n<li><code>push</code>  æ–¹å¼ï¼šä¼šæ›´æ–°æ¶ˆæ¯æ¶ˆè´¹è®¢é˜…è¡¨çš„ç‰ˆæœ¬ï¼Œç„¶åä¼šé€šçŸ¥ <code>Broker</code> ï¼Œè§¦å‘ <code>consumerId</code>  å˜åŠ¨ã€‚</li>\n<li><code>pull</code>  æ–¹å¼ï¼šä¼šé‡æ–° <code>pull</code>  æ¶ˆæ¯ï¼Œæ‰§è¡Œ <code>pullTask</code> .</li>\n</ul>\n<p>æˆ‘ä»¬å°±ä¸€èµ·çœ‹ä¸‹  <code>AllocateMessageQueueStrategy</code>  çš„å…­ç§å®ç°ã€‚</p>\n<h5 id=\"å¹³å‡å“ˆå¸Œé˜Ÿåˆ—ç®—æ³•allocatemessagequeueaveragely\"><a class=\"markdownIt-Anchor\" href=\"#å¹³å‡å“ˆå¸Œé˜Ÿåˆ—ç®—æ³•allocatemessagequeueaveragely\">#</a> å¹³å‡å“ˆå¸Œé˜Ÿåˆ—ç®—æ³• (AllocateMessageQueueAveragely)</h5>\n<p>è¿™ç§ç­–ç•¥æ¯”è¾ƒç®€å•ã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜:</p>\n<p>å‡è®¾æœ‰ <code>5</code>  ä¸ª <code>mq</code> ,  <code>3</code>  ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€… <code>id</code>  ä¸º <code>1</code>  çš„ <code>C1</code>  ä¼šè®¢é˜… <code>mq1,mq2</code> .   <code>C2=&gt;mq3,mq4</code> .   <code>C3=&gt;mq5</code> .<br>\n å‡è®¾æœ‰ <code>5</code>  ä¸ª <code>mq</code> ,  <code>6</code>  ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆè®¢é˜…å…³ç³»åˆ™ä¸º:  <code>C1=&gt;mq1</code> , <code>C2=&gt;mq2</code> , <code>C3=&gt;mq3</code> , <code>C4=&gt;mq4</code> , <code>C5=&gt;mq5</code> , <code>C6=&gt;[]</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// cidAll: æ¶ˆè´¹è€…idåˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> index = cidAll.indexOf(currentCID);</span><br><span class=\"line\"><span class=\"comment\">// mqAll: æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">// mod: è¡¨ç¤º æœ‰å¤šä¸ªé˜Ÿåˆ—æ— æ³•å¹³å‡åˆ†é…ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> mod = mqAll.size() % cidAll.size();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 4 &lt;= 5 ? 1 : (4 &gt; 0 &amp;&amp; 1 &lt; 4 ? 4 / 5 + 1 : 4 / 5)</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> averageSize;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (mqAll.size() &lt;= cidAll.size()) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é˜Ÿåˆ—æ¯”æ¶ˆè´¹è€…å°‘ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…æœ€å¤§æ¶ˆè´¹1ä¸ªé˜Ÿåˆ—ã€‚</span></span><br><span class=\"line\">    averageSize = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mod &gt; <span class=\"number\">0</span> &amp;&amp; index &lt; mod) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ä¸èƒ½å¹³å‡åˆ†, å¹¶ä¸”æ¶ˆè´¹è€…çš„idæ¯”ä½™æ•°å°ã€‚é‚£ä¹ˆè¯¥æ¶ˆè´¹è€…è¦å¤šæ¶ˆè´¹ä¸€ä¸ªMessageQueue.</span></span><br><span class=\"line\">        averageSize = mqAll.size() / cidAll.size() + <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ­£å¥½å¹³å‡åˆ† æˆ–è€… å½“å‰æ¶ˆè´¹è€…çš„idå¤§äºmod, é‚£ä¹ˆè¯¥æ¶ˆè´¹è€…å°±å¹³å‡åˆ†.</span></span><br><span class=\"line\">        <span class=\"comment\">// ä¼šæœ‰ä¸¤ç§æƒ…å†µ: 1ã€mqæœ‰5ä¸ª,consumeræœ‰5ä¸ªï¼Œ cid=5,åˆ™æ¯ä¸ªæ¶ˆè´¹è€…éƒ½æ­£å¥½è®¢é˜…ä¸€ä¸ªmq</span></span><br><span class=\"line\">        <span class=\"comment\">// 2ã€mqæœ‰5ä¸ªï¼Œconsumeræœ‰6ä¸ª,cid=6, åˆ™è¯¥æ¶ˆè´¹è€…ä¸ä¼šè®¢é˜…mq</span></span><br><span class=\"line\">        averageSize = mqAll.size() / cidAll.size();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//        int averageSize =</span></span><br><span class=\"line\"><span class=\"comment\">//            mqAll.size() &lt;= cidAll.size() ? 1 : (mod &gt; 0 &amp;&amp; index &lt; mod ? mqAll.size() / cidAll.size()</span></span><br><span class=\"line\"><span class=\"comment\">//                + 1 : mqAll.size() / cidAll.size());</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¢é˜…mq çš„èµ·å§‹ ç´¢å¼•. æ¯”å¦‚5ä¸ªmqï¼Œ3ä¸ªconsumer, é‚£ä¹ˆ,c1=&gt;m1,m2; c2=&gt;m3,m4; c3=&gt;m5</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> startIndex = (mod &gt; <span class=\"number\">0</span> &amp;&amp; index &lt; mod) ? index * averageSize : index * averageSize + mod;</span><br><span class=\"line\"><span class=\"keyword\">int</span> range = Math.min(averageSize, mqAll.size() - startIndex);</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; range; i++) &#123;</span><br><span class=\"line\">    result.add(mqAll.get((startIndex + i) % mqAll.size()));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> result;</span><br></pre></td></tr></table></figure>\n<h5 id=\"å¾ªç¯å¹³å‡å“ˆå¸Œé˜Ÿåˆ—ç®—æ³•allocatemessagequeueaveragelybycircle\"><a class=\"markdownIt-Anchor\" href=\"#å¾ªç¯å¹³å‡å“ˆå¸Œé˜Ÿåˆ—ç®—æ³•allocatemessagequeueaveragelybycircle\">#</a> å¾ªç¯å¹³å‡å“ˆå¸Œé˜Ÿåˆ—ç®—æ³• (AllocateMessageQueueAveragelyByCircle)</h5>\n<p>è¿™ç§å®ç°é¡µæ˜¯å¾ˆç®€å•çš„å®ç°ã€‚ä¸¾ä¾‹æ¥è¯´æ˜ï¼Œä¸è¿‡å¤šä»‹ç»äº†ã€‚</p>\n<p>å‡è®¾æœ‰ <code>5</code>  ä¸ª <code>mq</code> ,  <code>3</code>  ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆè®¢é˜…å…³ç³»åˆ™ä¸º:<br>\n <code>C1=&gt;mq1,mq4</code> .<br>\n <code>C2=&gt;mq2,mq5</code> .<br>\n <code>C3=&gt;mq3</code> .</p>\n<p>å‡è®¾æœ‰ <code>5</code>  ä¸ª <code>mq</code> ,  <code>6</code>  ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆè®¢é˜…å…³ç³»åˆ™ä¸º:  <code>C1=&gt;mq1</code> , <code>C2=&gt;mq2</code> , <code>C3=&gt;mq3</code> , <code>C4=&gt;mq4</code> , <code>C5=&gt;mq5</code> , <code>C6=&gt;[]</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// index: è¡¨ç¤ºç¬¬indexä¸ªæ¶ˆè´¹è€…</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> index = cidAll.indexOf(currentCID);</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = index; i &lt; mqAll.size(); i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¾ªç¯åˆ†é…ç»™æ¶ˆè´¹è€…ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i % cidAll.size() == index) &#123;</span><br><span class=\"line\">        result.add(mqAll.get(i));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"ä¸€è‡´æ€§å“ˆå¸Œé˜Ÿåˆ—ç®—æ³•allocatemessagequeueconsistenthash\"><a class=\"markdownIt-Anchor\" href=\"#ä¸€è‡´æ€§å“ˆå¸Œé˜Ÿåˆ—ç®—æ³•allocatemessagequeueconsistenthash\">#</a> ä¸€è‡´æ€§å“ˆå¸Œé˜Ÿåˆ—ç®—æ³• (AllocateMessageQueueConsistentHash)</h5>\n<p>è¿™ä¸ªç®—æ³•å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæ¶‰åŠåˆ°äº†ä¸€ä¸ªåˆ†å¸ƒå¼ç®—æ³•ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ã€‚</p>\n<p>å…·ä½“çš„ç®—æ³•å®ç°å†…å®¹å¯ä»¥å‚è€ƒ: <a href=\"/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0/\">å“ˆå¸Œç®—æ³•</a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å“ˆå¸Œç¯çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">Collection&lt;ClientNode&gt; cidNodes = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (String cid : cidAll) &#123;</span><br><span class=\"line\">    cidNodes.add(<span class=\"keyword\">new</span> ClientNode(cid));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åˆ›å»ºä¸€è‡´æ€§å“ˆå¸Œçš„Router</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> ConsistentHashRouter&lt;ClientNode&gt; router;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (customHashFunction != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    router = <span class=\"keyword\">new</span> ConsistentHashRouter&lt;&gt;(cidNodes, virtualNodeCnt, customHashFunction);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    router = <span class=\"keyword\">new</span> ConsistentHashRouter&lt;&gt;(cidNodes, virtualNodeCnt);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å°†MQfé€šè¿‡Routeråˆ†é…ç»™æ¶ˆè´¹è€…</span></span><br><span class=\"line\">List&lt;MessageQueue&gt; results = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (MessageQueue mq : mqAll) &#123;</span><br><span class=\"line\">    ClientNode clientNode = router.routeNode(mq.toString());</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (clientNode != <span class=\"keyword\">null</span> &amp;&amp; currentCID.equals(clientNode.getKey())) &#123;</span><br><span class=\"line\">        results.add(mq);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> results;</span><br></pre></td></tr></table></figure>\n<p>è¿™ç§ç®—æ³•çš„å¥½å¤„ä¹Ÿç‰¹åˆ«æ˜æ˜¾ï¼šå½“æœ‰æ¶ˆè´¹è€…åŠ å…¥æˆ–è€…é€€å‡ºçš„æ—¶å€™ï¼Œä¸ä¼šç§»åŠ¨è·¨èŠ‚ç‚¹çš„ <code>MQ</code>  åˆ†é…æƒ…å†µã€‚</p>\n<h5 id=\"é€šè¿‡é…ç½®çš„å±æ€§åˆ†é…é˜Ÿåˆ—allocatemessagequeuebyconfig\"><a class=\"markdownIt-Anchor\" href=\"#é€šè¿‡é…ç½®çš„å±æ€§åˆ†é…é˜Ÿåˆ—allocatemessagequeuebyconfig\">#</a> é€šè¿‡é…ç½®çš„å±æ€§åˆ†é…é˜Ÿåˆ— (AllocateMessageQueueByConfig)</h5>\n<p>è¿™ç§ç®—æ³•å°±æ˜¯ æ ¹æ®é…ç½®çš„ <code>MQ</code> , è¿›è¡Œæ¶ˆè´¹ã€‚</p>\n<p>é€šè¿‡  <code>set</code>  æ–¹æ³•è®¾ç½®è¯¥æ¶ˆè´¹è€…è¦æ¶ˆè´¹çš„ <code>MQ</code> ,</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setMessageQueueList</span><span class=\"params\">(List&lt;MessageQueue&gt; messageQueueList)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.messageQueueList = messageQueueList;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åˆ†é…æ–¹æ³•åˆ™ï¼Œç›´æ¥å°†  <code>messageQueueList</code>  è¿”å›å³å¯ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> List&lt;MessageQueue&gt; <span class=\"title\">allocate</span><span class=\"params\">(String consumerGroup, String currentCID, List&lt;MessageQueue&gt; mqAll,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    List&lt;String&gt; cidAll)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.messageQueueList;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"æœºæˆ¿hashé˜Ÿåˆ—ç®—æ³•allocatemessagequeuebymachineroom\"><a class=\"markdownIt-Anchor\" href=\"#æœºæˆ¿hashé˜Ÿåˆ—ç®—æ³•allocatemessagequeuebymachineroom\">#</a> æœºæˆ¿ Hash é˜Ÿåˆ—ç®—æ³• (AllocateMessageQueueByMachineRoom)</h5>\n<p>è¿™ä¸ªç®—æ³• å’Œ å¾ªç¯å¹³å‡å“ˆå¸Œé˜Ÿåˆ—ç®—æ³• æ˜¯ä¸€æ ·çš„ã€‚åªä¸è¿‡æ˜¯æ ¹æ®  <code>brokerName</code>  è¿›è¡Œ <code>Hash</code>  è®¡ç®—çš„ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­æ¥è¯´:</p>\n<p>å‡è®¾ 5 ä¸ª <code>mq</code>  ( <code>fxb-test01@fxb.com</code> , <code>fxb-test02@fxb.com</code> , <code>fxb-test03@fxb.com</code> , <code>fxb-test04@fxb.com</code> , <code>fxb-test05@fxb.com</code> ),3 ä¸ªæ¶ˆè´¹è€…ã€‚åˆ™è®¢é˜…å…³ç³»å¦‚ä¸‹:<br>\n <code>C1=&gt;mq1,mq4</code> .<br>\n <code>C2=&gt;mq2,mq5</code> .<br>\n <code>C3=&gt;mq3</code> .</p>\n<p>ä»£ç å®ç°å¦‚ä¸‹:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;MessageQueue&gt; premqAll = <span class=\"keyword\">new</span> ArrayList&lt;MessageQueue&gt;();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (MessageQueue mq : mqAll) &#123;</span><br><span class=\"line\">    String[] temp = mq.getBrokerName().split(<span class=\"string\">&quot;@&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (temp.length == <span class=\"number\">2</span> &amp;&amp; consumeridcs.contains(temp[<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">        premqAll.add(mq);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> mod = premqAll.size() / cidAll.size();</span><br><span class=\"line\"><span class=\"keyword\">int</span> rem = premqAll.size() % cidAll.size();</span><br><span class=\"line\"><span class=\"keyword\">int</span> startIndex = mod * currentIndex;</span><br><span class=\"line\"><span class=\"keyword\">int</span> endIndex = startIndex + mod;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = startIndex; i &lt; endIndex; i++) &#123;</span><br><span class=\"line\">    result.add(premqAll.get(i));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (rem &gt; currentIndex) &#123;</span><br><span class=\"line\">    result.add(premqAll.get(currentIndex + mod * cidAll.size()));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> result;</span><br></pre></td></tr></table></figure>\n<h5 id=\"åŸºäºæœºæˆ¿è¿œè¿‘ä¼˜å…ˆallocatemachineroomnearby\"><a class=\"markdownIt-Anchor\" href=\"#åŸºäºæœºæˆ¿è¿œè¿‘ä¼˜å…ˆallocatemachineroomnearby\">#</a> åŸºäºæœºæˆ¿è¿œè¿‘ä¼˜å…ˆ (AllocateMachineRoomNearby)</h5>\n<p>è¿™ç§ç®—æ³•ä¼šæ ¹æ®æ¶ˆè´¹è€…çš„å‘½åæ¥åŒºåˆ†ã€‚æ¯”å¦‚ç›¸åŒæœºæˆ¿çš„æ¶ˆè´¹è€…æœ‰ç›¸åŒçš„å‘½åæ ¼å¼: <code>beijing-mxy-001</code> , <code>beijing-mxy-002...</code>  ï¼Œé‚£ä¹ˆè¿™ç±»çš„æ¶ˆè´¹è€…å’Œ <code>MQ</code>  ä¼šè¢«è®¤ä¸ºå±äºåŒä¸€ä¸ªæœºæˆ¿ã€‚<b>åœ¨åŒä¸€ä¸ªæœºæˆ¿å†…çš„ <code>MQ</code>  ä¼šä¼˜å…ˆè¢«æœ¬æœºæˆ¿çš„æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹</b> å¦‚æœæœ¬æœºæˆ¿å†…æ²¡æœ‰å­˜æ´»çš„æ¶ˆè´¹è€…ï¼Œé‚£è¯¥æœºæˆ¿ä¸­çš„ <code>MQ</code>  ä¼šè¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…æ‰€å…±äº«ã€‚  è‡³äºæŸä¸€ä¸ªæ¶ˆè´¹è€…ä¼šè®¢é˜…å“ªä¸ª <code>MQ</code> ï¼Œåˆ™ç”±å…·ä½“æŒ‡å®šçš„åˆ†é…ç­–ç•¥æ¥åˆ†é…ã€‚å…·ä½“å¦‚ä¸‹ä»£ç ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//  æ ¹æ®æœºæˆ¿åˆ†ç»„ broker,</span></span><br><span class=\"line\">Map&lt;String<span class=\"comment\">/*machine room */</span>, List&lt;MessageQueue&gt;&gt; mr2Mq = <span class=\"keyword\">new</span> TreeMap&lt;String, List&lt;MessageQueue&gt;&gt;();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (MessageQueue mq : mqAll) &#123;</span><br><span class=\"line\">    String brokerMachineRoom = machineRoomResolver.brokerDeployIn(mq);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtils.isNoneEmpty(brokerMachineRoom)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mr2Mq.get(brokerMachineRoom) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            mr2Mq.put(brokerMachineRoom, <span class=\"keyword\">new</span> ArrayList&lt;MessageQueue&gt;());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mr2Mq.get(brokerMachineRoom).add(mq);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Machine room is null for mq &quot;</span> + mq);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//æ ¹æ®æœºæˆ¿åˆ†ç»„consumer</span></span><br><span class=\"line\">Map&lt;String<span class=\"comment\">/*machine room */</span>, List&lt;String<span class=\"comment\">/*clientId*/</span>&gt;&gt; mr2c = <span class=\"keyword\">new</span> TreeMap&lt;String, List&lt;String&gt;&gt;();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (String cid : cidAll) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ ¹æ®cidåˆ¤æ–­å‡ºæ‰€å±çš„æœºæˆ¿==&gt; ç›¸åŒæœºæˆ¿çš„æ¶ˆè´¹éœ€è¦æœ‰ç›¸åŒçš„å‘½åæ ¼å¼.</span></span><br><span class=\"line\">    String consumerMachineRoom = machineRoomResolver.consumerDeployIn(cid);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtils.isNoneEmpty(consumerMachineRoom)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mr2c.get(consumerMachineRoom) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            mr2c.put(consumerMachineRoom, <span class=\"keyword\">new</span> ArrayList&lt;String&gt;());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mr2c.get(consumerMachineRoom).add(cid);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;Machine room is null for consumer id &quot;</span> + cid);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">List&lt;MessageQueue&gt; allocateResults = <span class=\"keyword\">new</span> ArrayList&lt;MessageQueue&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¡ç®—å½“å‰consumerå¯ä»¥æ¶ˆè´¹çš„MQ. å½“å‰æœºæˆ¿æœ‰å¤šä¸ªæ¶ˆè´¹è€…çš„æ—¶å€™ï¼Œåˆ™ä½¿ç”¨çœŸæ­£åˆ†é…ç­–ç•¥(å…¶ä»–çš„åˆ†é…ç­–ç•¥)è¿›è¡Œåˆ†é…ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// 1.allocate the mq that deploy in the same machine room with the current consumer</span></span><br><span class=\"line\">String currentMachineRoom = machineRoomResolver.consumerDeployIn(currentCID);</span><br><span class=\"line\">List&lt;MessageQueue&gt; mqInThisMachineRoom = mr2Mq.remove(currentMachineRoom);</span><br><span class=\"line\">List&lt;String&gt; consumerInThisMachineRoom = mr2c.get(currentMachineRoom);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (mqInThisMachineRoom != <span class=\"keyword\">null</span> &amp;&amp; !mqInThisMachineRoom.isEmpty()) &#123;</span><br><span class=\"line\">    allocateResults.addAll(allocateMessageQueueStrategy.allocate(consumerGroup, currentCID, mqInThisMachineRoom, consumerInThisMachineRoom));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2.allocate the rest mq to each machine room if there are no consumer alive in that machine room</span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœå½“å‰æœºæˆ¿æ²¡æœ‰å­˜æ´»çš„æ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå½“å‰æœºæˆ¿çš„MQä¼šè¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…å…±äº«ã€‚æ ¹æ®çœŸå®çš„åˆ†é…ç­–ç•¥è¿›è¡Œåˆ†é…</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (String machineRoom : mr2Mq.keySet()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!mr2c.containsKey(machineRoom)) &#123; <span class=\"comment\">// no alive consumer in the corresponding machine room, so all consumers share these queues</span></span><br><span class=\"line\">        allocateResults.addAll(allocateMessageQueueStrategy.allocate(consumerGroup, currentCID, mr2Mq.get(machineRoom), cidAll));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> allocateResults;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šå°±æ˜¯ <code>RocketMQ</code>  ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡çš„å†…å®¹äº†ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ åˆ†é…ç­–ç•¥ã€‚åªéœ€è¦å®ç°  <code>AllocateMessageQueueStrategy</code>  , åœ¨åˆ›å»ºæ¶ˆè´¹è€…å®ä¾‹çš„æ—¶å€™ä½¿ç”¨å°±å¥½äº†ã€‚</p>\n<h3 id=\"æ‹‰å–æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#æ‹‰å–æ¶ˆæ¯\">#</a> æ‹‰å–æ¶ˆæ¯</h3>\n<p>æˆ‘ä»¬çŸ¥é“çš„æ˜¯ï¼Œ RocketMQ æ”¯æŒä¸¤ç§æ¶ˆè´¹è€…ç±»å‹ï¼Œä¸€ç§æ˜¯æ¨é€æ–¹å¼çš„ï¼Œä¸€ç§æ˜¯ä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬å…ˆä»æ‹‰å–æ¶ˆæ¯è¯´èµ·ã€‚  ä½ æ‡‚çš„ï¼Œæˆ‘ä»¬æ˜¯è¦è®²çš„æ˜¯:  <code>DefaultLitePullConsumer</code> .</p>\n<h4 id=\"defaultlitepullconsumer\"><a class=\"markdownIt-Anchor\" href=\"#defaultlitepullconsumer\">#</a> DefaultLitePullConsumer</h4>\n<p><code>DefaultLitePullConsumer</code> ï¼Œä¼šä¸ºæ¯ä¸ª  <code>messageQueue</code>  åˆ›å»ºä¸€ä¸ª <code>PullTaskImpl</code> .  å®ƒä¼šå®šæ—¶çš„ä»  <code>Broker</code>  ç«¯æ‹‰å–æ¶ˆæ¯ã€‚ç„¶åå°è£…æˆ  <code>PullRequest</code> , æ”¾åˆ°  <code>consumeRequestCache</code>  è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­ï¼Œ ç„¶ å  <code>DefaultLitePullConsumer</code>  ä¼šè°ƒç”¨ <code>poll</code>  æ–¹æ³•ï¼Œè·å– List<MessageExt>, è¿™æ ·å°±ç®—æ˜¯æ¶ˆè´¹å®Œæˆäº†ã€‚</p>\n<p>æ˜¯å®¢æˆ·ç«¯ å®šæ—¶ä»»åŠ¡ä¸»åŠ¨æƒ³ <code>Broker</code>  ç«¯å‘é€è¯·æ±‚ï¼Œæ‹‰å–æ¶ˆæ¯ã€‚</p>\n<p>è€Œ æ¨çš„æ–¹å¼ï¼Œå°±ä¸æ˜¯è¿™ä¹ˆç®€å•äº†ã€‚</p>\n<h4 id=\"defaultmqpushconsumer\"><a class=\"markdownIt-Anchor\" href=\"#defaultmqpushconsumer\">#</a> DefaultMQPushConsumer</h4>\n<p>è¿™è¿˜æ˜¯è¦ä» <code>Broker</code>  ç«¯å­˜å‚¨å®Œæ¶ˆæ¯ä¹‹åè¯´èµ·ï¼ŒBroker ä¼šè¿è¡Œä¸€ä¸ª  <code>ReputMessageService</code> . è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ<br>\n å®ƒæ˜¯æ¨é€æ¶ˆæ¯çš„çº¿ç¨‹ï¼Œè´Ÿè´£å°†å†™å…¥ <code>CommitLog</code>  çš„æ¶ˆæ¯æ¨é€ç»™å¯¹åº”çš„æ¶ˆè´¹è€…ã€‚</p>\n<p>è¿™é‡Œä¼šæœ‰ä¸¤ä¸ªé—®é¢˜:</p>\n<ul>\n<li>1ã€ <code>ReputMessageService</code>  æ€ä¹ˆçŸ¥é“è¦å»æ¨é€æ¶ˆæ¯ç»™æ¶ˆè´¹è€…å‘¢</li>\n</ul>\n<p><code>ReputMessageService</code>  æ¯éš” 1 ç§’ä¼šæ£€æŸ¥ä¸€ä¸‹è¿™ä¸ª  <code>CommitLog</code>  æ˜¯å¦æœ‰æ–°çš„æ•°æ®å†™å…¥ã€‚ <code>ReputMessageService</code>  è‡ªèº«ç»´æŠ¤äº†ä¸€ä¸ªåç§»é‡  <code>reputFromOffset</code> ï¼Œç”¨ä»¥å¯¹æ¯”å’Œ  <code>CommitLog</code>  æ–‡ä»¶ä¸­çš„æ¶ˆæ¯æ€»åç§»é‡çš„å·®è·ã€‚å½“è¿™ä¸¤ä¸ªåç§»é‡ä¸åŒçš„æ—¶å€™ï¼Œå°±ä»£è¡¨æœ‰æ–°çš„æ¶ˆæ¯åˆ°æ¥äº†ã€‚</p>\n<p>å¦‚ä¸‹å›¾:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-03-RocketMQ%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B9%8B%E6%B6%88%E6%81%AF.png\" alt=\"\"></p>\n<ul>\n<li><code>ReputMessageService</code>  æ˜¯æ€æ ·æ¨é€æ¶ˆæ¯çš„</li>\n</ul>\n<p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹è§ï¼Œ  <code>ReputMessageService</code>  å°è£…äº†ä¸€ä¸ª  <code>DispatchRequest</code> ï¼Œç„¶åé€šè¿‡  <code>DefaultMessageStore.doDispatch</code>  æ–¹æ³•ï¼Œè½¬å‘äº†å‡ºå»ã€‚è™½è¯´æ˜¯è½¬å‘äº†å‡ºå»ï¼Œä½†æ˜¯å¹¶éç›´æ¥å‘é€ç»™äº†æ¶ˆè´¹è€…ã€‚</p>\n<p>è€Œæ˜¯è½¬å‘ç»™äº†  <code>CommitLogDispatcherBuildConsumeQueue</code> . å®ƒä¸»è¦æ˜¯æ ¹æ®è¿™æ¡è¯·æ±‚æŒ‰ç…§ä¸åŒçš„é˜Ÿåˆ—  <code>ID</code>  åˆ›å»ºä¸åŒçš„æ¶ˆè´¹é˜Ÿåˆ—æ–‡ä»¶ï¼Œå¹¶åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä»½æ¶ˆè´¹é˜Ÿåˆ—åˆ—è¡¨ã€‚ç„¶åå°†  <code>DispatchRequest</code>  è¯·æ±‚ä¸­è¿™æ¡æ¶ˆæ¯çš„æ¶ˆæ¯åç§»é‡ã€æ¶ˆæ¯å¤§å°ä»¥åŠæ¶ˆæ¯åœ¨å‘é€æ—¶å€™é™„å¸¦çš„æ ‡ç­¾çš„  <code>Hash</code>  å€¼å†™å…¥åˆ°ç›¸åº”çš„æ¶ˆè´¹é˜Ÿåˆ—æ–‡ä»¶ä¸­å»ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">putMessagePositionInfo</span><span class=\"params\">(DispatchRequest dispatchRequest)</span> </span>&#123;</span><br><span class=\"line\">    ConsumeQueue cq = <span class=\"keyword\">this</span>.findConsumeQueue(dispatchRequest.getTopic(), dispatchRequest.getQueueId());</span><br><span class=\"line\">    cq.putMessagePositionInfoWrapper(dispatchRequest);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åå°é€šè¿‡ <code>FlushConsumeQueueService</code>  çº¿ç¨‹æ¥å®šæ—¶çš„æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œå†™æ–‡ä»¶å’Œ  <code>Broker</code>  å†™å…¥ <code>MappedLogFile</code>  ä¸€æ ·ã€‚åªæ˜¯ä½ç½®ä¸åŒã€‚</p>\n<p>å¥½å®¶ä¼™ï¼Œåˆ°ç°åœ¨è¿˜æ²¡æœ‰ç»™æ¶ˆæ¯æ¨é€æ¶ˆæ¯ï¼Œè‡ªå·±å…ˆå­˜èµ·æ¥äº†ã€‚</p>\n<p>è€Œäº‹å®ä¸Šï¼ŒRocketMQ å¹¶æ²¡æœ‰å®ç° Broker ç«¯ å‘é€æ¶ˆæ¯ç»™ æ¶ˆè´¹è€…ã€‚ æ¨æ¨¡å‹çš„æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼ï¼Œæ˜¯é€šè¿‡æ‹‰æ¨¡å¼å®ç°çš„ã€‚</p>\n<p>è¿™é‡Œéœ€è¦åŒºåˆ† å¹¿æ’­æ¨¡å¼ å’Œ é›†ç¾¤æ¨¡å‹åˆ†å¼€æ¥è¯´äº†ã€‚</p>\n<h5 id=\"å¹¿æ’­æ¨¡å¼-2\"><a class=\"markdownIt-Anchor\" href=\"#å¹¿æ’­æ¨¡å¼-2\">#</a> å¹¿æ’­æ¨¡å¼</h5>\n<p>æ¯ä¸ªæ¶ˆè´¹é˜Ÿåˆ—çš„åç§»é‡è‚¯å®šä¸èƒ½å­˜å‚¨åœ¨  <code>Broker</code>  æœåŠ¡å™¨ç«¯ï¼Œå› ä¸ºå¤šä¸ªæ¶ˆè´¹è€…å¯¹äºåŒä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆè´¹å¯èƒ½ä¸ä¸€è‡´ï¼Œåç§»é‡ä¼šäº’ç›¸è¦†ç›–æ‰ã€‚å› æ­¤ï¼Œåœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯çš„æ¶ˆè´¹åç§»é‡æ˜¯å­˜å‚¨åœ¨æœ¬åœ°çš„ï¼Œç„¶åæ¯éš”  <code>5</code>  ç§’å°†å†…å­˜ä¸­çš„  <code>offsetTable</code>  æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚å½“é¦–æ¬¡ä»æœåŠ¡å™¨è·å–å¯æ¶ˆè´¹é˜Ÿåˆ—çš„æ—¶å€™ï¼Œåç§»é‡æ˜¯ç›´æ¥ä»æœ¬åœ°æ–‡ä»¶ä¸­è¯»å–çš„ã€‚</p>\n<h5 id=\"é›†ç¾¤æ¨¡å¼-2\"><a class=\"markdownIt-Anchor\" href=\"#é›†ç¾¤æ¨¡å¼-2\">#</a> é›†ç¾¤æ¨¡å¼</h5>\n<p>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œç”±äºæ¯ä¸ªå®¢æˆ·ç«¯æ‰€æ¶ˆè´¹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸åŒï¼Œæ‰€ä»¥æ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å·²ç»æ¶ˆè´¹åˆ°å“ªé‡Œçš„æ¶ˆè´¹åç§»é‡æ˜¯è®°å½•åœ¨  <code>Broker</code>  æœåŠ¡å™¨ç«¯çš„ã€‚</p>\n<p>æ¶ˆè´¹è€…å®¢æˆ·ç«¯åœ¨å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ª  <code>offsetTable</code>  è¡¨ï¼Œåœ¨  <code>Broker</code>  æœåŠ¡å™¨ç«¯ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªåç§»é‡è¡¨ã€‚åœ¨æ¶ˆè´¹è€…å®¢æˆ·ç«¯ï¼Œ <code>RebalanceService</code>  æœåŠ¡ä¼šå®šæ—¶åœ° (é»˜è®¤ 20 ç§’) ä»  <code>Broker</code>  æœåŠ¡å™¨è·å–å½“å‰å®¢æˆ·ç«¯æ‰€éœ€è¦æ¶ˆè´¹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä¸å½“å‰æ¶ˆè´¹è€…å®¢æˆ·ç«¯çš„æ¶ˆè´¹é˜Ÿåˆ—è¿›è¡Œå¯¹æ¯”ï¼Œçœ‹æ˜¯å¦æœ‰å˜åŒ–ã€‚å¯¹äºæ¯ä¸ªæ¶ˆè´¹é˜Ÿåˆ—ï¼Œä¼šä»  <code>Broker</code>  æœåŠ¡å™¨æŸ¥è¯¢è¿™ä¸ªé˜Ÿåˆ—å½“å‰çš„æ¶ˆè´¹åç§»é‡ã€‚ç„¶åæ ¹æ®è¿™å‡ ä¸ªæ¶ˆè´¹é˜Ÿåˆ—ï¼Œåˆ›å»ºå¯¹åº”çš„æ‹‰å–è¯·æ±‚  <code>PullRequest</code>  å‡†å¤‡ä»  <code>Broker</code>  æœåŠ¡å™¨æ‹‰å–æ¶ˆæ¯ã€‚å½“ä»  <code>Broker</code>  æœåŠ¡å™¨æ‹‰å–ä¸‹æ¥æ¶ˆæ¯ä»¥åï¼Œåªæœ‰å½“ç”¨æˆ·æˆåŠŸæ¶ˆè´¹çš„æ—¶å€™ï¼Œæ‰ä¼šæ›´æ–°æœ¬åœ°çš„åç§»é‡è¡¨ã€‚æœ¬åœ°çš„åç§»é‡è¡¨å†é€šè¿‡å®šæ—¶æœåŠ¡æ¯éš”  <code>5</code>  ç§’åŒæ­¥åˆ°  <code>Broker</code>  æœåŠ¡å™¨ç«¯ï¼Œç»´æŠ¤åœ¨  <code>Broker</code>  æœåŠ¡å™¨ç«¯çš„åç§»é‡è¡¨ä¹Ÿä¼šæ¯éš”  <code>5</code>  ç§’é’Ÿåºåˆ—åŒ–åˆ°ç£ç›˜ä¸­.</p>\n<p>é‚£ä¹ˆé‡ç‚¹æ¥äº†ï¼Œåˆ›å»ºçš„ <code>PullRequest</code>  å°±ä¼šè¢«æ”¾åˆ°  <code>pullRequestQueue</code>  ä¸­ã€‚</p>\n<h4 id=\"æ‹‰å–æ¶ˆæ¯-2\"><a class=\"markdownIt-Anchor\" href=\"#æ‹‰å–æ¶ˆæ¯-2\">#</a> æ‹‰å–æ¶ˆæ¯</h4>\n<p>åœ¨ æ¶ˆè´¹è€…å¯åŠ¨ ä¸€æ–‡ä¸­ï¼Œå¯ä»¥çŸ¥é“ æ¶ˆè´¹è€…å¯åŠ¨åï¼Œåå°ä¼šä¸€ç›´è¿è¡Œä¸€ä¸ª  <code>PullMessageService</code>  çº¿ç¨‹ã€‚å®ƒä¼šé˜»å¡çš„ä»  <code>pullRequestQueue</code>  ä¸­è·å–  <code>PullRequest</code>  å‘ <code>Broker</code>  ç«¯å‘é€è¯·æ±‚ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!<span class=\"keyword\">this</span>.isStopped()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å‡ºé˜Ÿ</span></span><br><span class=\"line\">            PullRequest pullRequest = <span class=\"keyword\">this</span>.pullRequestQueue.take();</span><br><span class=\"line\">            <span class=\"comment\">// æ‹‰å–æ¶ˆæ¯</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.pullMessage(pullRequest);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>pullRequestQueue</code>  ä¾¿æ˜¯  <code>pull Message Request Queue</code>  äº†ã€‚(æ‹‰å–æ¶ˆæ¯è¯·æ±‚çš„é˜Ÿåˆ—äº†)</p>\n<p>å½“çœŸæ­£å°è¯•æ‹‰å–æ¶ˆæ¯ä¹‹å‰ï¼Œå…¶ä¼šæ£€æŸ¥å½“å‰è¯·æ±‚çš„å†…éƒ¨ç¼“å­˜çš„æ¶ˆæ¯æ•°é‡ã€æ¶ˆæ¯å¤§å°ã€æ¶ˆæ¯é˜ˆå€¼è·¨åº¦æ˜¯å¦è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼Œåˆ™æ¨è¿Ÿ  <code>50</code>  æ¯«ç§’é‡æ–°æ‰§è¡Œè¿™ä¸ªè¯·æ±‚ï¼Œå½“æ‰§è¡Œå®Œä¸€äº›å¿…è¦çš„æ£€æŸ¥ä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šå°†ç”¨æˆ·æŒ‡å®šçš„è¿‡æ»¤ä¿¡æ¯ä»¥åŠä¸€äº›å…¶å®ƒå¿…è¦æ¶ˆè´¹å­—æ®µå°è£…åˆ°è¯·æ±‚ä¿¡æ¯ä½“ä¸­ï¼Œç„¶åæ‰å¼€å§‹ä»  <code>Broker</code>  æœåŠ¡å™¨æ‹‰å–è¿™ä¸ªè¯·æ±‚ä»å½“å‰åç§»é‡å¼€å§‹çš„æ¶ˆæ¯ï¼Œé»˜è®¤ä¸€æ¬¡æ€§æœ€å¤šæ‹‰å–  <code>32</code>  æ¡ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ä¼šå‘Šè¯‰å®¢æˆ·ç«¯è¿™ä¸ªé˜Ÿåˆ—ä¸‹æ¬¡å¼€å§‹æ‹‰å–æ—¶çš„åç§»é‡ã€‚å®¢æˆ·ç«¯æ¯æ¬¡éƒ½ä¼šæ³¨å†Œä¸€ä¸ª  <code>PullCallback</code>  å›è°ƒï¼Œç”¨ä»¥æ¥å—æœåŠ¡å™¨è¿”å›çš„å“åº”ä¿¡æ¯ï¼Œæ ¹æ®å“åº”ä¿¡æ¯çš„ä¸åŒçŠ¶æ€ä¿¡æ¯ï¼Œç„¶åä¿®æ­£è¿™ä¸ªè¯·æ±‚çš„åç§»é‡ï¼Œå¹¶è¿›è¡Œä¸‹æ¬¡è¯·æ±‚ã€‚</p>\n<p>å¯¹äº†ï¼Œéƒ½æœ‰äº›ä»€ä¹ˆæ—¶å€™ä¼šå°†  <code>PullRequest</code>  æ”¾å…¥  <code>pullRequestQueue</code>  ä¸­çš„å‘¢ï¼Ÿ</p>\n<ul>\n<li>é‡å¹³è¡¡çš„æ—¶å€™\n<ul>\n<li>æœ‰æ¶ˆè´¹è€…åŠ å…¥ï¼Œå‘ç”Ÿé‡å¹³è¡¡</li>\n<li>å®šæ—¶ä»»åŠ¡ï¼Œå‘é€é‡å¹³è¡¡ã€‚</li>\n</ul>\n</li>\n<li>æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œé‡è¯•ã€‚</li>\n<li>å¯åŠ¨çš„æ—¶å€™ã€‚</li>\n</ul>\n<p>è¿™äº›éƒ½æ˜¯ä¼šè§¦å‘æ‹‰å–æ¶ˆæ¯çš„ã€‚</p>\n<p>æœ€åï¼Œç»ˆäºåˆ°æœ€åä¸€æ­¥äº†ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚</p>\n<h4 id=\"æ¶ˆè´¹æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹æ¶ˆæ¯\">#</a> æ¶ˆè´¹æ¶ˆæ¯</h4>\n<p>å½“æŠŠæ¶ˆæ¯æ”¾åœ¨  <code>PullRequestQueue</code>  è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­ä¹‹åï¼Œåå°çº¿ç¨‹ä¼šä¸æ–­ä»è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­è·å–  <code>PullRequest</code> . å¦‚ä¸‹å›¾ä»£ç ä¸­æ‰€ç¤ºã€‚æ‹¿åˆ°äº†  <code>PullRequest</code>  åˆ™ä¼šæäº¤äº†ä¸€ä¸ª  <code>ConsumeRequest</code> . æˆ‘æƒ³è¿™åˆè¢«ä½ çŒœåˆ°äº†ã€‚å“ˆå“ˆã€‚è¿™é‡Œå°†  <code>ConsumeRequest</code>   <code>submit</code>  ç»™äº†ä¸€ä¸ªåå°çº¿ç¨‹  <code>consumeExecutor</code> ã€‚æ¥ç€å¾€ä¸‹çœ‹å§ã€‚è¯¥çº¿ç¨‹ä¼šæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF8.png\" alt=\"\"></p>\n<p>ä¾èµ–äºç”¨æˆ·æŒ‡å®šçš„æ¶ˆæ¯å›è°ƒå‡½æ•°çš„ä¸åŒï¼Œæ¶ˆæ¯çš„æ¶ˆè´¹åˆ†ä¸ºä¸¤ç§ï¼šå¹¶å‘æ¶ˆè´¹å’Œæœ‰åºæ¶ˆè´¹ã€‚</p>\n<p>å¹¶å‘æ¶ˆè´¹æ²¡æœ‰è€ƒè™‘æ¶ˆæ¯å‘é€çš„é¡ºåºï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡å™¨è·å–åˆ°æ¶ˆæ¯å°±ä¼šç›´æ¥å›è°ƒç»™ç”¨æˆ·ã€‚è€Œæœ‰åºæ¶ˆè´¹ä¼šè€ƒè™‘æ¯ä¸ªé˜Ÿåˆ—æ¶ˆæ¯å‘é€çš„é¡ºåºï¼Œæ³¨æ„æ­¤å¤„å¹¶ä¸æ˜¯æ¯ä¸ªè¯é¢˜æ¶ˆæ¯å‘é€çš„é¡ºåºï¼Œä¸€å®šè¦è®°ä½  <code>RocketMQ</code>  æ§åˆ¶æ¶ˆæ¯çš„æœ€ç»†ç²’åº¦æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚å½“æˆ‘ä»¬è®²æœ‰åºæ¶ˆè´¹çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨è¯´å¯¹äºæŸä¸ªè¯é¢˜çš„æŸä¸ªé˜Ÿåˆ—ï¼Œå‘å¾€è¿™ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯æ¥å—æ¶ˆæ¯çš„é¡ºåºä¸å‘é€çš„é¡ºåºå®Œå…¨ä¸€è‡´ã€‚</p>\n<h5 id=\"å¹¶å‘æ¶ˆè´¹\"><a class=\"markdownIt-Anchor\" href=\"#å¹¶å‘æ¶ˆè´¹\">#</a> å¹¶å‘æ¶ˆè´¹</h5>\n<p>å½“ç”¨æˆ·æ³¨å†Œæ¶ˆæ¯å›è°ƒç±»çš„æ—¶å€™ï¼Œå¦‚æœæ³¨å†Œçš„æ˜¯  <code>MessageListenerConcurrently</code>  å›è°ƒç±»ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºç”¨æˆ·ä¸å…³å¿ƒæ¶ˆæ¯çš„é¡ºåºé—®é¢˜ã€‚æˆ‘ä»¬åœ¨ä¸Šæ–‡æåˆ°è¿‡æ¯ä¸ª  <code>PullRequest</code>  éƒ½å…³è”äº†ä¸€ä¸ªå¤„ç†é˜Ÿåˆ—  <code>ProcessQueue</code> ï¼Œè€Œæ¯ä¸ªå¤„ç†é˜Ÿåˆ—åˆéƒ½å…³è”äº†ä¸€é¢—æ¶ˆæ¯æ ‘  <code>msgTreeMap</code> ã€‚å½“å®¢æˆ·ç«¯æ‹‰å–åˆ°æ–°çš„æ¶ˆæ¯ä»¥åï¼Œå…¶å…ˆå°†æ¶ˆæ¯æ”¾å…¥åˆ°è¿™ä¸ªè¯·æ±‚æ‰€å…³è”çš„å¤„ç†é˜Ÿåˆ—çš„æ¶ˆæ¯æ ‘ä¸­ï¼Œç„¶åæäº¤ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹è¯·æ±‚ï¼Œç”¨ä»¥å›è°ƒç”¨æˆ·ç«¯çš„ä»£ç æ¶ˆè´¹æ¶ˆæ¯.</p>\n<p>æäº¤ç»™  <code>consumeExecutor</code>  ä¹‹åï¼Œ  <code>ConsumeRequest</code>  å®ç°é€»è¾‘å¦‚ä¸‹:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF9.png\" alt=\"\"></p>\n<h5 id=\"æœ‰åºæ¶ˆè´¹\"><a class=\"markdownIt-Anchor\" href=\"#æœ‰åºæ¶ˆè´¹\">#</a> æœ‰åºæ¶ˆè´¹</h5>\n<p><code>RocketMQ</code>  çš„æœ‰åºæ¶ˆè´¹ä¸»è¦ä¾é ä¸¤æŠŠé”ï¼Œä¸€æŠŠæ˜¯ç»´æŠ¤åœ¨  <code>Broker</code>  ç«¯ï¼Œä¸€æŠŠç»´æŠ¤åœ¨æ¶ˆè´¹è€…å®¢æˆ·ç«¯ã€‚ <code>Broker</code>  ç«¯æœ‰ä¸€ä¸ª  <code>RebalanceLockManager</code>  æœåŠ¡ï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª  <code>mqLockTable</code>  æ¶ˆæ¯é˜Ÿåˆ—é”è¡¨:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-02-Broker%E6%B6%88%E6%81%AF10.png\" alt=\"\"></p>\n<p>åœ¨æœ‰åºæ¶ˆè´¹çš„æ—¶å€™ï¼Œ <code>Broker</code>  éœ€è¦ç¡®ä¿ä»»ä½•ä¸€ä¸ªé˜Ÿåˆ—åœ¨ä»»ä½•æ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æ¶ˆè´¹å®ƒï¼Œéƒ½åœ¨è¢«ä¸€ä¸ªå®¢æˆ·ç«¯æ‰€é”å®šã€‚å½“å®¢æˆ·ç«¯åœ¨æœ¬åœ°æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—æ„å»º  <code>PullRequest</code>  ä¹‹å‰ï¼Œä¼šä¸  <code>Broker</code>  æ²Ÿé€šå°è¯•é”å®šè¿™ä¸ªé˜Ÿåˆ—ï¼Œå¦å¤–å½“è¿›è¡Œæœ‰åºæ¶ˆè´¹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¼šå‘¨æœŸæ€§åœ° (é»˜è®¤æ˜¯  <code>20</code>  ç§’) é”å®šæ‰€æœ‰å½“å‰éœ€è¦æ¶ˆè´¹çš„æ¶ˆæ¯é˜Ÿåˆ—.</p>\n<p>ä»£ç é€»è¾‘å¦‚ä¸‹</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* é¡ºåºæ¶ˆè´¹</span></span><br><span class=\"line\"><span class=\"comment\">* æ¯ç§’ å®šæ—¶å¤šå®ä¾‹æ¶ˆè´¹çš„æ‰€æœ‰é˜Ÿåˆ—ï¼Œä¸Šé”æˆåŠŸå°† ProcessQueueçš„lockå±æ€§è®¾ç½®ä¸ºtrue</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">start</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (MessageModel.CLUSTERING.equals(ConsumeMessageOrderlyService.<span class=\"keyword\">this</span>.defaultMQPushConsumerImpl.messageModel())) &#123; <span class=\"comment\">/// åªæ”¯æŒé›†ç¾¤æ¨¡å¼</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.scheduledExecutorService.scheduleAtFixedRate(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                ConsumeMessageOrderlyService.<span class=\"keyword\">this</span>.lockMQPeriodically();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">1000</span> * <span class=\"number\">1</span>, ProcessQueue.REBALANCE_LOCK_INTERVAL, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è€Œåœ¨  <code>Broker</code>  è¿™ç«¯ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯æ‰€é”å®šçš„æ¶ˆæ¯é˜Ÿåˆ—å¯¹åº”çš„é”é¡¹  <code>LogEntry</code>  æœ‰ä¸€ä¸ªä¸Šæ¬¡é”å®šæ—¶çš„æ—¶é—´æˆ³ï¼Œå½“è¶…è¿‡é”çš„è¶…æ—¶æ—¶é—´ (é»˜è®¤æ˜¯ 60 ç§’) åï¼Œä¹Ÿä¼šåˆ¤å®šè¿™ä¸ªå®¢æˆ·ç«¯å·²ç»ä¸å†æŒæœ‰è¿™æŠŠé”ï¼Œä»¥è®©å…¶ä»–å®¢æˆ·ç«¯èƒ½å¤Ÿæœ‰åºæ¶ˆè´¹è¿™ä¸ªé˜Ÿåˆ—ã€‚</p>\n<p>åœ¨å‰é¢æˆ‘ä»¬è¯´åˆ°è¿‡  <code>RebalanceService</code>  å‡è¡¡æœåŠ¡ä¼šå®šæ—¶åœ°ä¾æ®ä¸åŒæ¶ˆè´¹è€…æ•°é‡åˆ†é…æ¶ˆè´¹é˜Ÿåˆ—ã€‚æˆ‘ä»¬å‡è®¾  <code>Consumer-1</code>  æ¶ˆè´¹è€…å®¢æˆ·ç«¯ä¸€å¼€å§‹éœ€è¦æ¶ˆè´¹  <code>3</code>  ä¸ªæ¶ˆè´¹é˜Ÿåˆ—ï¼Œè¿™ä¸ªæ—¶å€™åˆåŠ å…¥äº†  <code>Consumer-2</code>  æ¶ˆè´¹è€…å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”åˆ†é…åˆ°äº†  <code>MessageQueue-2</code>  æ¶ˆè´¹é˜Ÿåˆ—ã€‚å½“  <code>Consumer-1</code>  å†…éƒ¨çš„å‡è¡¡æœåŠ¡æ£€æµ‹åˆ°å½“å‰æ¶ˆè´¹é˜Ÿåˆ—éœ€è¦ç§»é™¤  <code>MessageQueue-2</code>  é˜Ÿåˆ—ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¼šé¦–å…ˆè§£é™¤  <code>Broker</code>  ç«¯çš„é”ï¼Œç¡®ä¿æ–°åŠ å…¥çš„  <code>Consumer-2</code>  æ¶ˆè´¹è€…å®¢æˆ·ç«¯èƒ½å¤ŸæˆåŠŸé”ä½è¿™ä¸ªé˜Ÿåˆ—ï¼Œä»¥è¿›è¡Œæœ‰åºæ¶ˆè´¹ã€‚</p>\n<p>æ¶ˆè´¹è€…å®¢æˆ·ç«¯æ¯ä¸€æ¬¡æ‹‰å–æ¶ˆæ¯è¯·æ±‚ï¼Œå¦‚æœæœ‰å‘ç°æ–°çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆéƒ½ä¼šå°†è¿™äº›æ¶ˆæ¯å°è£…ä¸º  <code>ConsumeRequest</code>  æ¥å–‚ç»™æ¶ˆè´¹çº¿ç¨‹æ± ï¼Œç­‰å¾…æ¶ˆè´¹ã€‚å¦‚æœæ¶ˆæ¯ç‰¹åˆ«å¤šï¼Œè¿™æ ·ä¸€ä¸ªé˜Ÿåˆ—å¯èƒ½æœ‰å¤šä¸ªæ¶ˆè´¹è¯·æ±‚æ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯æ¶ˆè´¹ï¼Œç”¨æˆ·å¯èƒ½ä¼šå…ˆæ¶ˆè´¹åç§»é‡å¤§çš„æ¶ˆæ¯ï¼Œåæ¶ˆè´¹åç§»é‡å°çš„æ¶ˆæ¯ã€‚æ‰€ä»¥æ¶ˆè´¹åŒä¸€é˜Ÿåˆ—çš„æ—¶å€™ï¼Œéœ€è¦ä¸€æŠŠé”ä»¥æ¶ˆè´¹è¯·æ±‚é¡ºåºåŒ–ã€‚</p>\n<p>ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumeMessageOrderlyService</span> <span class=\"keyword\">implements</span> <span class=\"title\">ConsumeMessageService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumeRequest</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ProcessQueue processQueue;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> MessageQueue messageQueue;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ConsumeRequest</span><span class=\"params\">(ProcessQueue processQueue, MessageQueue messageQueue)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.processQueue = processQueue;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.messageQueue = messageQueue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> ProcessQueue <span class=\"title\">getProcessQueue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> processQueue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> MessageQueue <span class=\"title\">getMessageQueue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> messageQueue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> Object objLock = messageQueueLock.fetchLockObject(<span class=\"keyword\">this</span>.messageQueue);</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (objLock) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (MessageModel.BROADCASTING.equals(ConsumeMessageOrderlyService.<span class=\"keyword\">this</span>.defaultMQPushConsumerImpl.messageModel())|| (<span class=\"keyword\">this</span>.processQueue.isLocked() &amp;&amp; !<span class=\"keyword\">this</span>.processQueue.isLockExpired())) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">boolean</span> continueConsume = <span class=\"keyword\">true</span>; continueConsume; ) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// æ¯æ¬¡è·å–æ¶ˆæ¯çš„æ•°é‡</span></span><br><span class=\"line\">                        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> consumeBatchSize =</span><br><span class=\"line\">                            ConsumeMessageOrderlyService.<span class=\"keyword\">this</span>.defaultMQPushConsumer.getConsumeMessageBatchMaxSize();</span><br><span class=\"line\">                        <span class=\"comment\">// æ‹¿åˆ°å¯ä»¥æ¶ˆè´¹çš„æ¶ˆæ¯åˆ—è¡¨ã€‚é»˜è®¤ä¸º 1 æ¡ã€‚</span></span><br><span class=\"line\">                        List&lt;MessageExt&gt; msgs = <span class=\"keyword\">this</span>.processQueue.takeMessages(consumeBatchSize);</span><br><span class=\"line\">                        defaultMQPushConsumerImpl.resetRetryAndNamespace(msgs, defaultMQPushConsumer.getConsumerGroup());</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (!msgs.isEmpty()) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">final</span> ConsumeOrderlyContext context = <span class=\"keyword\">new</span> ConsumeOrderlyContext(<span class=\"keyword\">this</span>.messageQueue);</span><br><span class=\"line\">                            ConsumeOrderlyStatus status = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                            ConsumeMessageContext consumeMessageContext = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                                <span class=\"comment\">// æ¶ˆè´¹è€…åŠ é”</span></span><br><span class=\"line\">                                <span class=\"keyword\">this</span>.processQueue.getConsumeLock().lock();</span><br><span class=\"line\">                                <span class=\"comment\">// å›è°ƒæ¶ˆè´¹è€…æ¶ˆæ¯</span></span><br><span class=\"line\">                                status = messageListener.consumeMessage(Collections.unmodifiableList(msgs), context);</span><br><span class=\"line\">                            &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">                            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">this</span>.processQueue.getConsumeLock().unlock();</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            continueConsume = ConsumeMessageOrderlyService.<span class=\"keyword\">this</span>.processConsumeResult(msgs, status, context, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            continueConsume = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    ConsumeMessageOrderlyService.<span class=\"keyword\">this</span>.tryLockLaterAndReconsume(<span class=\"keyword\">this</span>.messageQueue, <span class=\"keyword\">this</span>.processQueue, <span class=\"number\">100</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·æ¶ˆæ¯å°±æ¶ˆè´¹å®Œäº†ã€‚ä¸å¾—ä¸è¯´ï¼Œè¿™ä¸ªæ¶ˆè´¹çš„æ•´ä½“æ¶ˆè´¹çš„é€»è¾‘æ˜¯çœŸçš„å¤æ‚ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<p>æˆ‘ä»¬ä»ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œåˆ°  <code>Broker</code>  ç«¯å­˜å‚¨æ¶ˆæ¯ï¼Œ å†åˆ° æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚å°†æ•´ä¸ªæµç¨‹éƒ½è·‘é€šäº†ã€‚<br>\næ¯ä¸ªè¿‡ç¨‹éƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è±¡çš„é‚£æ ·ç›´æ¥å‘é€æ¶ˆæ¯ç»™ <code>Broker</code> ï¼Œ <code>Broker</code>  å°†æ¶ˆæ¯ç›´æ¥å†™å…¥ç¡¬ç›˜ï¼Œ æ¶ˆè´¹è€…ç›´æ¥å» <code>Broker</code>  ä¸­æ‹‰å–æ¶ˆæ¯ï¼Œæ‹‰å–åˆ°ä¹‹åç›´æ¥è°ƒç”¨å®¢æˆ·ç«¯è¿›è¡Œæ¶ˆè´¹ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šæ·±å…¥åˆ°  <code>RocketMQ</code>  æŸä¸ªç‰¹æ€§çš„å…·ä½“å®ç°ä¸­å»ã€‚ä¼šé€ä¸€åˆ†æ äº‹åŠ¡æ¶ˆæ¯ï¼Œå»¶æ—¶æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¯é æ€§æªæ–½ï¼Œè½½å‡è¡¡ï¼Œæ¶ˆæ¯é‡æ”¾ï¼Œæ¶ˆæ¯è¿‡æ»¤ç­‰åŠŸèƒ½çš„å®ç°ã€‚</p>\n<p>ä¸‹ä¸€ç¯‡æ–‡ç« ï¼šäº‹åŠ¡æ¶ˆæ¯ã€‚è¯·æœŸå¾…ï½</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/28/rocketMQ/2-01-RocketMQ-Arch-Start/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/28/rocketMQ/2-01-RocketMQ-Arch-Start/",
            "title": "RocketMQç³»åˆ—-æ¶æ„è®¾è®¡ä¹‹å¯åŠ¨",
            "date_published": "2021-09-28T02:26:00.000Z",
            "content_html": "<p>ä¹‹å‰æˆ‘ä»¬å·²ç»å­¦ä¹ äº† <code>RocketMQ</code>  æ˜¯ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆçš„ã€‚è¿™ç¯‡æ–‡ç« æ›´åŠ æ·±å…¥çš„æ¥çœ‹çœ‹è¿™ä¸ªå››ä¸ªéƒ¨åˆ†ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-01-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E5%9B%BE.png\" alt=\"\"></p>\n<h2 id=\"nameserver\"><a class=\"markdownIt-Anchor\" href=\"#nameserver\">#</a>  <code>NameServer</code></h2>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹  <code>NameServer</code>  çš„ç›¸å…³å†…å®¹ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“  <code>NameServer</code>  æ˜¯  <code>RocketMQ</code>  çš„æ³¨å†Œä¸­å¿ƒã€‚é‚£å®ƒè‚¯å®šä¼šæœ‰ æœåŠ¡å‘ç°ï¼Œæ£€æŸ¥æ£€æŸ¥ï¼Œè·¯ç”±ç­‰ç­‰åŠŸèƒ½ï¼Œ æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªæ€è·¯å»çœ‹çœ‹  <code>NameServer</code>  æ˜¯å¦‚ä½•å¯åŠ¨çš„ã€‚</p>\n<h3 id=\"namesrv-çš„å¯åŠ¨è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#namesrv-çš„å¯åŠ¨è¿‡ç¨‹\">#</a>  <code>NameSrv</code>  çš„å¯åŠ¨è¿‡ç¨‹</h3>\n<p>æˆ‘ä»¬åœ¨éƒ¨ç½²  <code>RocketMQ</code>  çš„æ—¶å€™ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨äº† <code>RocketMQ</code>  çš„ <code>NameServer</code> .</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup sh mqnamesrv &amp;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ¡å‘½ä»¤å…¶å®æ‰§è¡Œçš„æ˜¯ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh <span class=\"variable\">$&#123;ROCKETMQ_HOME&#125;</span>/bin/runserver.sh org.apache.rocketmq.namesrv.NamesrvStartup <span class=\"variable\">$@</span></span><br></pre></td></tr></table></figure>\n<p>ä¹Ÿå°±è¯´ï¼Œè¿™æ¡å‘½ä»¤æ‰§è¡Œè¿è¡Œçš„  <code>NamesrvStartup</code>  ç±»ã€‚</p>\n<p><code>NameSrv</code>  çš„å¯åŠ¨å…¶å®å°±ä¸¤æ­¥ï¼š</p>\n<ul>\n<li>å°è£…é…ç½®å‚æ•°ï¼š æ ¹æ®å‘½ä»¤è¡Œå‚æ•°å°è£…  <code>NameSrvConfig</code>  é…ç½®ã€‚ å¯ä»¥æ‰§è¡Œé…ç½®æ–‡ä»¶ï¼Œä¼šè§£æé…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³é…ç½®ã€‚</li>\n<li>åˆå§‹åŒ–å¹¶å¯åŠ¨  <code>NamesrvController</code> .\n<ul>\n<li>åˆå§‹åŒ–:\n<ul>\n<li>å¯¹  <code>NameSrvController</code>  è¿›è¡Œé…ç½®ï¼Œ</li>\n<li>åˆ›å»ºè¿œç¨‹  <code>netty Server</code> ,</li>\n<li>æ³¨å†Œ  <code>DefaultRequestProcessor</code>  ï¼Œå¤„ç†å„ç§è¿æ¥è¯·æ±‚ï¼Œ</li>\n<li>åˆ›å»ºäº†ä¸¤ä¸ªå®šæ—¶ä»»åŠ¡ï¼šæ¯  <code>10s</code>  æ‰«æä¸€æ¬¡  <code>Broker</code>  åˆ—è¡¨ï¼Œç§»é™¤ä¸å­˜æ´»çš„  <code>Broker</code>  ã€‚æ¯ <code>10s</code>  æ‰“å°ä¸€æ¬¡é…ç½®å±æ€§ã€‚</li>\n<li>åˆ›å»ºé…ç½®æ–‡ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–ã€‚</li>\n</ul>\n</li>\n<li>å¯åŠ¨ï¼š\n<ul>\n<li>å¯åŠ¨  <code>netty Server</code>  : å®é™…ä¸Šå¯åŠ¨ä¸€ä¸ª Netty æœåŠ¡ã€‚</li>\n<li>å¯åŠ¨æ–‡ä»¶ç›‘å¬å™¨ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œ <code>Broker</code>  çš„å¥åº·æ£€æµ‹æ˜¯é€šè¿‡å®šæ—¶ä»»åŠ¡æ¥å®ç°çš„ã€‚é‚£è·¯ç”±åŠŸèƒ½æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>\n<p>è¿™å°±è¦çœ‹ åœ¨  <code>NameServer</code>  ä¸­æœ€é‡è¦çš„ä¸€ä¸ªç±»äº†ï¼š  <code>DefaultRequetProcessor</code>  .  <code>DefaultRequestProcessor</code>  å°è£…äº†å„ç§è¿æ¥è¯·æ±‚çš„å¤„ç†ã€‚æ¯”å¦‚ <code>Broker</code>  çš„æ³¨å†Œï¼Œæ ¹æ® <code>Topic</code>  è·å–è·¯ç”±ä¿¡æ¯ç­‰ç­‰ã€‚å…·ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç :</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> RemotingCommand <span class=\"title\">processRequest</span><span class=\"params\">(ChannelHandlerContext ctx,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">        RemotingCommand request)</span> <span class=\"keyword\">throws</span> RemotingCommandException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ctx != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;receive request, &#123;&#125; &#123;&#125; &#123;&#125;&quot;</span>,</span><br><span class=\"line\">                request.getCode(),</span><br><span class=\"line\">                RemotingHelper.parseChannelRemoteAddr(ctx.channel()),</span><br><span class=\"line\">                request);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (request.getCode()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.PUT_KV_CONFIG:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.putKVConfig(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_KV_CONFIG:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getKVConfig(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.DELETE_KV_CONFIG:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.deleteKVConfig(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.QUERY_DATA_VERSION:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> queryBrokerTopicConfig(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.REGISTER_BROKER:</span><br><span class=\"line\">            Version brokerVersion = MQVersion.value2Version(request.getVersion());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (brokerVersion.ordinal() &gt;= MQVersion.Version.V3_0_11.ordinal()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.registerBrokerWithFilterServer(ctx, request);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.registerBroker(ctx, request);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.UNREGISTER_BROKER:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.unregisterBroker(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_ROUTEINFO_BY_TOPIC:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getRouteInfoByTopic(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_BROKER_CLUSTER_INFO:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getBrokerClusterInfo(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.WIPE_WRITE_PERM_OF_BROKER:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.wipeWritePermOfBroker(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_ALL_TOPIC_LIST_FROM_NAMESERVER:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> getAllTopicListFromNameserver(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.DELETE_TOPIC_IN_NAMESRV:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> deleteTopicInNamesrv(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_KVLIST_BY_NAMESPACE:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getKVListByNamespace(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_TOPICS_BY_CLUSTER:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getTopicsByCluster(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_SYSTEM_TOPIC_LIST_FROM_NS:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getSystemTopicListFromNs(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_UNIT_TOPIC_LIST:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getUnitTopicList(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_HAS_UNIT_SUB_TOPIC_LIST:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getHasUnitSubTopicList(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_HAS_UNIT_SUB_UNUNIT_TOPIC_LIST:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getHasUnitSubUnUnitTopicList(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.UPDATE_NAMESRV_CONFIG:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.updateConfig(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> RequestCode.GET_NAMESRV_CONFIG:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getConfig(ctx, request);</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ®µä»£ç é‡Œå®ç°äº†æ‰€æœ‰çš„ <code>Broker</code> ï¼Œ <code>Producer</code> ï¼Œ <code>Customer</code>  å’Œ <code>NameServer</code>  äº¤äº’çš„å¤„ç†é€»è¾‘ï¼ŒåŒ…æ‹¬è·¯ç”±åŠŸèƒ½ç­‰ç­‰ã€‚</p>\n<h3 id=\"nameserverçš„å…³é—­\"><a class=\"markdownIt-Anchor\" href=\"#nameserverçš„å…³é—­\">#</a>  <code>NameServer</code>  çš„å…³é—­</h3>\n<p><code>NameServer</code>  çš„å…³é—­å°±éå¸¸ç®€å•äº†.</p>\n<p><code>NameSrvStartUp</code>  åœ¨  <code>initialize</code>  å’Œ  <code>start</code>  ä¹‹é—´ï¼ŒåŠ å…¥äº† ä¸€ä¸ª å…³é—­äº‹ä»¶çš„ç›‘å¬å™¨.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ·»åŠ å…³é—­çš„å›è°ƒã€‚</span></span><br><span class=\"line\">Runtime.getRuntime().addShutdownHook(<span class=\"keyword\">new</span> ShutdownHookThread(log, <span class=\"keyword\">new</span> Callable&lt;Void&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Void <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        controller.shutdown();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure>\n<p>å†…éƒ¨æ˜¯ä½¿ç”¨  <code>NameSrvController</code>  çš„ <code>shutdown</code>  æ–¹æ³•ã€‚<br>\nä¸»è¦è¿›è¡Œï¼š</p>\n<ul>\n<li>å…³é—­ <code>Netty</code>  æœåŠ¡</li>\n<li>å…³é—­çº¿ç¨‹æ± </li>\n<li>å…³é—­ <code>scheduledExecutorService</code></li>\n<li>å…³é—­æ–‡ä»¶ç›‘å¬å™¨</li>\n</ul>\n<h2 id=\"broker\"><a class=\"markdownIt-Anchor\" href=\"#broker\">#</a> Broker</h2>\n<ul>\n<li><code>Broker</code>  çš„å¯åŠ¨è¿‡ç¨‹</li>\n<li><code>Broker</code>  æ€ä¹ˆæ ·è¿›è¡Œæ¶ˆæ¯å­˜å‚¨çš„</li>\n<li><code>Broker</code>  çš„å†…éƒ¨è¿è¡ŒåŸç†æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</li>\n<li>å…³é—­æµç¨‹</li>\n</ul>\n<p>åœ¨  <code>RocketMQ</code>  çš„  <code>Broker</code>  è¿™ä¸ªå¯åŠ¨ç¯èŠ‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰¾åˆ° <a href=\"https://gitee.com/fangjiaxiaobai/source_code_read/blob/master/rocketmq/broker/src/main/java/org/apache/rocketmq/broker/BrokerStartup.java\"> <code>BrokerStartUp.java</code> </a> è¿™ä¸ªç±»ã€‚</p>\n<h3 id=\"brokerçš„å¯åŠ¨è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#brokerçš„å¯åŠ¨è¿‡ç¨‹\">#</a> Broker çš„å¯åŠ¨è¿‡ç¨‹</h3>\n<p><code>Broker</code>  çš„å¯åŠ¨æœ¬è´¨ä¸Šæ˜¯å¯åŠ¨äº† ä¸€ä¸ª <code>Netty</code>  æœåŠ¡ç«¯å’Œä¸€ä¸ª <code>Netty</code>  å®¢æˆ·ç«¯ã€‚ ä½¿ç”¨ <code>Netty</code>  å®¢æˆ·ç«¯å®Œæˆå‘ <code>NameSrv</code>  çš„æ³¨å†Œï¼Œå¿ƒè·³æ£€æµ‹ï¼Œç­‰æ•°æ®äº¤äº’ã€‚ ä½¿ç”¨ <code>Netty</code>  æœåŠ¡ç«¯å¤„ç†  <code>Producer</code>  å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶å°†æ¶ˆæ¯æŒ‰ç…§ä¸åŒçš„æ¶ˆæ¯ç±»å‹å­˜å‚¨ä¸‹æ¥ã€‚</p>\n<p>é¦–å…ˆ  <code>Broker</code>  ä¾ç„¶è¿˜æ˜¯ä¼šåŠ è½½  <code>Broker</code>  çš„ç›¸å…³é…ç½®ï¼ŒåŒ…æ‹¬ï¼ša. å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„å‚æ•°ï¼Œæ¯”å¦‚ <code>mqbroker</code> ,-c ç­‰ï¼Œ b. <code>-c</code>  æŒ‡å®šçš„æ–‡ä»¶ä¸­çš„ <code>Broker</code>  å±æ€§ã€‚ç„¶åæ ¹æ®åŠ è½½çš„ <code>NettyServerConfig</code>  (å¯åŠ¨çš„ <code>Netty</code>  æœåŠ¡ç«¯çš„é…ç½®), <code>NettyClientConfig</code>  (å¯åŠ¨çš„ <code>Netty</code>  å®¢æˆ·ç«¯çš„é…ç½®),  <code>BrokerConfig</code> ( <code>Broker</code>  çš„é…ç½®),  <code>messageStoreConfig</code>  (å­˜å‚¨æ¶ˆæ¯çš„é…ç½®) åˆ›å»º  <code>BrokerController</code> .  ä¹‹ååŠæ—¶åˆå§‹åŒ– <code>BrokerController</code> ï¼Œæ³¨å†Œ <code>Shutdown</code>  å›è°ƒã€‚æœ€åå¯åŠ¨ <code>BrokerController</code> ã€‚   <code>shutdown</code>  å›è°ƒå…¶å®æ²¡æœ‰ä»€ä¹ˆå¯è¯´çš„ã€‚æˆ‘ä»¬å†ç®€å•çš„çœ‹çœ‹åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>\n<h4 id=\"åˆå§‹åŒ–è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#åˆå§‹åŒ–è¿‡ç¨‹\">#</a> åˆå§‹åŒ–è¿‡ç¨‹</h4>\n<p>åˆå§‹åŒ–è¿‡ç¨‹æ˜¯ä¸€ä¸ª  <code>&quot;æ¼«é•¿&quot;</code>  çš„è¿‡ç¨‹ã€‚ä¸€å¼€å§‹æ˜¯åœ¨å»åŠ è½½ä¸€äº›æ•°æ®ï¼Œåˆå§‹åŒ–ä¼šå»åŠ è½½ åˆ›å»ºçš„ <code>topic</code>  æ•°æ®ï¼Œæ¶ˆæ¯çš„æ¶ˆè´¹åç§»é‡ï¼Œå¹¿æ’­ç»„ï¼Œæ¶ˆè´¹è¿‡æ»¤æ•°æ®ç­‰çš„æ•°æ®ï¼Œç„¶ååˆ›å»º  <code>MessageStore</code>  å¯¹è±¡ï¼Œä½œç”¨æ˜¯å­˜å‚¨æ¶ˆæ¯ã€‚æ³¨æ„è¿™ä¸ª  <code>MessageStore</code>  æ˜¯æ”¯æŒæ’ä»¶çš„å½¢å¼æ‰©å±•çš„ã€‚ å¦‚æœæ•°æ®åŠ è½½æˆåŠŸä¹‹åï¼Œå°±ä¼šå¯åŠ¨  <code>netty</code>  æœåŠ¡ç«¯ã€‚ ä»£ç ä¸­ å¯åŠ¨äº†ä¸¤ä¸ª netty æœåŠ¡ç«¯:  <code>remotingServer</code>  å’Œ  <code>fastRemotingServer</code> ã€‚ç„¶åå°±æ˜¯åˆå§‹åŒ–äº†ä¸€äº›çº¿ç¨‹æ±  ç”¨äºæ³¨å†Œ <code>Processor</code> ã€‚ åœ¨æ³¨å†Œ  <code>Processor</code>  çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°  <code>fastRemotingServer</code>  å’Œ  <code>remotingServer</code>  é™¤äº†ç«¯å£ä¸ä¸€æ ·ä¹‹å¤–ï¼Œ  <code>fastRemotingServer</code>  æ²¡æœ‰ æ³¨å†Œ  <code>PullMessageProcessor</code>  . ä¹Ÿå°±æ˜¯è¯´  <code>fastRemotingServer</code>  ä¸æ”¯æŒ  <code>pullMessage</code>  è¯·æ±‚ã€‚ç„¶å  <code>BrokerController</code>  åˆ›å»ºå¾ˆå¤šçš„å®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼šå®šæ—¶è®°å½•æ¯å¤©çš„æ¶ˆæ¯æ•°æ®ï¼Œå®šæ—¶æŒä¹…åŒ–æ¶ˆè´¹è€…æ¶ˆæ¯ã€‚å®šæ—¶æŒä¹…åŒ– æ¶ˆè´¹è€…è¿‡æ»¤æ—¶çš„æ•°æ®æƒ…å†µ ç­‰ã€‚å†å°±æ˜¯ æ›´æ–° <code>Broker</code>  çš„ <code>NameServer</code>  åœ°å€ã€‚ æœ€ååˆå§‹åŒ–äº‹åŠ¡ï¼Œåˆå§‹åŒ–æƒé™ï¼Œåˆå§‹åŒ– <code>RPC</code>  é’©å­ã€‚</p>\n<h4 id=\"å¯åŠ¨è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨è¿‡ç¨‹\">#</a> å¯åŠ¨è¿‡ç¨‹</h4>\n<p>åœ¨å®Œäº†åˆè¯†è¯ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¯åŠ¨äº†ã€‚å’Œ <code>NameServer</code>  ä¸€æ ·çš„æµç¨‹ï¼Œå…ˆåˆå§‹åŒ–ï¼Œåœ¨ <code>start</code> . å¯åŠ¨è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥:</p>\n<ul>\n<li>å¯åŠ¨  <code>messageStore</code></li>\n<li>å¯åŠ¨  <code>remotingServer</code></li>\n<li>å¯åŠ¨  <code>fastRemotingServer</code></li>\n<li>å¯åŠ¨æ–‡ä»¶ç›‘å¬å™¨</li>\n<li>å¯åŠ¨  <code>BrokerOutAPI</code>  , å‘  <code>NameServer</code>  æœåŠ¡ç«¯å‘é€ç›¸å…³è¯·æ±‚çš„è¿æ¥ä¸æ–­å¼€ç­‰ï¼Œå®šæ—¶æ‰«æ <code>ResponseTable</code>  å¹¶è§¦å‘å›è°ƒã€‚</li>\n<li>å¯åŠ¨ <code>PullRequestHoldService</code> : å­˜å‚¨  <code>pull Message</code>  çš„è¯·æ±‚ï¼Œå¹¶è§¦å‘æ‰§è¡Œ <code>pull Message</code> .</li>\n<li>å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶æ‰«æä¸å­˜æ´»çš„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯è¿‡æ»¤æœåŠ¡ (é <code>tag</code>  è¿‡æ»¤)ã€‚</li>\n<li>å¯åŠ¨æ¶ˆæ¯è¿‡æ»¤æœåŠ¡ã€‚ æ¶ˆæ¯è¿‡æ»¤æœåŠ¡å¹¶éæ˜¯åŸºäº <code>tag</code>  çš„æ¶ˆæ¯çš„è¿‡æ»¤ï¼Œè€Œæ˜¯åœ¨ <code>Broker</code>  ç«¯æä¾›äº†ä¸€ç§æ›´åŠ ç»†ç²’åº¦çš„æ¶ˆæ¯è¿‡æ»¤æ§åˆ¶ã€‚</li>\n<li><code>Broker</code>  çš„å®¹ç¾å¤„ç†</li>\n<li>å®šæ—¶ä»»åŠ¡ï¼šæ³¨å†Œ  <code>Broker</code>  åˆ°  <code>NameServer</code></li>\n<li>å¯åŠ¨ <code>broker</code>  ç»Ÿè®¡ï¼Œæ— åŠ¨ä½œ</li>\n<li>æ¸…ç†è¿‡æœŸè¯·æ±‚ã€‚</li>\n</ul>\n<h4 id=\"å…³é—­è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#å…³é—­è¿‡ç¨‹\">#</a> å…³é—­è¿‡ç¨‹</h4>\n<p>è¿™ä¸ªå…³é—­æµç¨‹è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œå°±æ˜¯æŠŠä¸Šé¢å¯åŠ¨çš„è¿‡ç¨‹æŒ¨ä¸ªå…³é—­å°±å¥½äº†ã€‚å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒ  <code>org.apache.rocketmq.broker.BrokerController#shutdown()</code>  æˆ‘ä»¬åé¢ä¹Ÿä¼šåˆ†æè¿™éƒ¨åˆ†çš„ä»£ç ã€‚ é™¤äº†å…³é—­ä¸Šé¢å¯åŠ¨çš„æœåŠ¡ä¹‹å¤–ï¼Œåœ¨å…³é—­çš„æ—¶å€™ï¼Œéœ€è¦å°†æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ã€‚ æ¯”å¦‚  <code>ConsumerOffset</code> ,  <code>ConsumerFilter</code> , è¿™ä¹Ÿæ˜¯å½“æœåŠ¡å†æ¬¡å¯åŠ¨æ—¶ä¿è¯æ¶ˆæ¯èƒ½å¤Ÿæ­£å¸¸è¢«æ¶ˆè´¹çš„ä¿éšœã€‚</p>\n<h2 id=\"producer\"><a class=\"markdownIt-Anchor\" href=\"#producer\">#</a> Producer</h2>\n<p>æ¶ˆæ¯å‘å¸ƒçš„è§’è‰²ï¼Œæ”¯æŒåˆ†å¸ƒå¼é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚ <code>Producer</code>  é€šè¿‡ MQ çš„è´Ÿè½½å‡è¡¡æ¨¡å—é€‰æ‹©ç›¸åº”çš„ <code>Broker</code>  é›†ç¾¤é˜Ÿåˆ—è¿›è¡Œæ¶ˆæ¯æŠ•é€’ï¼ŒæŠ•é€’çš„è¿‡ç¨‹æ”¯æŒå¿«é€Ÿå¤±è´¥å¹¶ä¸”ä½å»¶è¿Ÿã€‚</p>\n<blockquote>\n<p>æˆ‘ä»¬ä»æœ€ç®€å•çš„ä¸€ä¸ªç¤ºä¾‹æ¥çœ‹ï¼Œç”Ÿäº§è€…çš„å¯åŠ¨æµç¨‹</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨GroupNameåˆå§‹åŒ–Producer</span></span><br><span class=\"line\">DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// æŒ‡å®šNameSrvçš„åœ°å€: ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡NAMESRV_ADDRæ¥æŒ‡å®šï¼Œåˆ™ä¸éœ€è¦ä¸‹é¢è¿™ä¸€è¡Œã€‚</span></span><br><span class=\"line\">producer.setNamesrvAddr(<span class=\"string\">&quot;name-server1-ip:9876;name-server2-ip:9876&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// å¯åŠ¨å®ä¾‹</span></span><br><span class=\"line\">producer.start();</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ›å»ºæ¶ˆæ¯å®ä¾‹,æŒ‡å®š topic, tag, message body.</span></span><br><span class=\"line\">    Message msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span> <span class=\"comment\">/* Topic */</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;TagA&quot;</span> <span class=\"comment\">/* Tag */</span>,</span><br><span class=\"line\">        (<span class=\"string\">&quot;Hello RocketMQ !!&quot;</span>).getBytes(RemotingHelper.DEFAULT_CHARSET) <span class=\"comment\">/* Message body */</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"comment\">// å‘é€æ¶ˆæ¯ç»™Broker</span></span><br><span class=\"line\">    SendResult sendResult = producer.send(msg);</span><br><span class=\"line\">    System.out.printf(<span class=\"string\">&quot;%s%n&quot;</span>, sendResult);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">    e.printStackTrace();</span><br><span class=\"line\">    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// å…³é—­ç”Ÿäº§è€…</span></span><br><span class=\"line\">producer.shutdown();</span><br></pre></td></tr></table></figure>\n<p>å…³äº ç”Ÿäº§è€…è§’è‰²ï¼Œæˆ‘ä»¬åº”è¯¥äº†è§£ä»€ä¹ˆï¼Ÿæˆ–è€…è¯´ï¼Œçœ‹åˆ°ä¸Šé¢çš„ä»£ç ï¼Œä½ æƒ³æ›´æ·±å…¥çš„çŸ¥é“äº›ä»€ä¹ˆå—ï¼Ÿ(æˆ‘å¬åˆ°äº†ä½ è¯´ï¼Œä¸æƒ³â€¦)</p>\n<ul>\n<li>ç”Ÿäº§è€…æ˜¯å¦‚ä½•å¯åŠ¨ï¼Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ç”Ÿäº§è€…éƒ½åšäº†å“ªäº›äº‹æƒ…ï¼Ÿ</li>\n<li>ç”Ÿäº§è€…æ˜¯å¦‚ä½•å’Œ <code>Namesrv</code>  è¿›è¡Œäº¤äº’çš„ï¼Ÿäº¤äº’æ˜¯ä»€ä¹ˆä¿¡æ¯ï¼Ÿç”Ÿäº§è€…æ˜¯å¦‚ä½•å’Œ <code>NameSrv</code>  è¿›è¡Œå¥åº·æ£€æŸ¥çš„ï¼Ÿ</li>\n<li>ç”Ÿäº§è€…æ˜¯æ€ä¹ˆæ ·å‘é€æ¶ˆæ¯çš„ï¼Ÿå‘é€æ¶ˆæ¯çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</li>\n<li>ç”Ÿäº§è€…çš„å…³é—­æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</li>\n</ul>\n<h3 id=\"ç”Ÿäº§è€…å¯åŠ¨æµç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…å¯åŠ¨æµç¨‹\">#</a> ç”Ÿäº§è€…å¯åŠ¨æµç¨‹</h3>\n<h4 id=\"å°è£…ç”Ÿäº§è€…çš„å±æ€§\"><a class=\"markdownIt-Anchor\" href=\"#å°è£…ç”Ÿäº§è€…çš„å±æ€§\">#</a> å°è£…ç”Ÿäº§è€…çš„å±æ€§</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡  <code>DefaultMQProducer</code>  ç±»åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…å¯¹è±¡ã€‚ è¿™ä¸ªç±»æˆ‘ä»¬æ‰“ç®—å‘é€æ¶ˆæ¯çš„ç¨‹åºå…¥å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™ä¸ªç±»çš„å®ä¾‹æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„ï¼šåœ¨é…ç½®å¹¶å¯åŠ¨è¿›ç¨‹åï¼Œè¯¥ç±»å¯ä»¥è¢«è§†ä¸ºçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚</p>\n<p><code>DefaultMQProducer</code>  æä¾›äº† <code>5</code>  ä¸ªæ„é€ å‚æ•° ( <code>4.9.1</code>  ç‰ˆæœ¬ï¼Œå¹¶éåœ¨ä¸€ä¸ªæ„é€ æ–¹å¼ä¸­)ã€‚</p>\n<ul>\n<li><code>String namespace</code> : ç”Ÿäº§è€…å®ä¾‹çš„å‘½åç©ºé—´ã€‚å¯ä»¥ç†è§£ä¸º MQ ç”Ÿäº§è€…çš„åç§°ã€‚</li>\n<li><code>String producerGroup</code> : ç”Ÿäº§è€…ç»„ã€‚ ç”Ÿäº§è€…ç»„åœ¨æ¦‚å¿µä¸Šèšåˆäº†å®Œå…¨ç›¸åŒè§’è‰²çš„ç”Ÿäº§è€…å®ä¾‹ã€‚ è¿™å¯¹äº‹åŠ¡æ¶ˆæ¯éå¸¸é‡è¦ã€‚å¯¹éäº‹åŠ¡æ€§æ¶ˆæ¯å°±æ²¡æœ‰å¤ªå¤§å…³ç³»äº†ã€‚(=&gt; å°ç™½è¯´ï¼šä¸€ç±»ç”Ÿäº§è€…ã€‚)</li>\n<li><code>RPCHook rpcHook</code> : æ¯ä¸ªè¿œç¨‹å‘½ä»¤æ‰§è¡Œè¦æ‰§è¡Œçš„ RPC å›è°ƒã€‚RPCHook æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæä¾›äº†ä¸¤ä¸ªæ–¹æ³• doBeforeRequest å’Œ doAfterResponseï¼Œè¡¨ç¤ºåœ¨æ‰§è¡Œè¯·æ±‚ä¹‹å‰å’Œæ¥æ”¶è¿”å›ä¹‹ååˆ†åˆ«æ‰§è¡Œç›¸å…³é€»è¾‘ï¼›</li>\n<li><code>boolean enableMsgTrace</code> : æ˜¯å¦å¼€å¯æ¶ˆæ¯è¿½è¸ª</li>\n<li><code>String customizedTraceTopic</code> : æ¶ˆæ¯è¿½è¸ªæ—¥å¿—ä½¿ç”¨çš„é˜Ÿåˆ—åå­—</li>\n<li><code>String nameSrvAddr</code> : è¿™ä¸ªå­—æ®µæ²¡æœ‰åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ set æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿå˜é‡çš„å½¢å¼è¿›è¡Œè®¾ç½®ã€‚</li>\n</ul>\n<p>ç”Ÿäº§è€…åœ¨è®¾ç½®å®Œå¯¹åº”çš„å‚æ•°ä¹‹åï¼Œå°±ä¼šè°ƒç”¨ <code>Start()</code>  æ–¹æ³•ã€‚  <code>start</code>  æ–¹æ³•ä¼šè®¾ç½® <code>group</code> , ç„¶åè°ƒç”¨åœ¨ æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–çš„  <code>defaultMQProducerImpl</code>  å®ä¾‹ã€‚</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-01-DefaultProducerImpl%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81.png\" alt=\"\"></p>\n<p>å¦‚ä¸Šå›¾</p>\n<ul>\n<li>ç”Ÿäº§è€…é¦–å…ˆä¼šæ£€æŸ¥  <code>producerGroup</code>  çš„åˆæ³•æ€§ã€‚</li>\n<li>ç„¶åè®¾ç½® <code>ProducerGroup</code></li>\n<li>åˆ›å»º  <code>MQClientFactory</code> . å°† <code>producer</code>  æ³¨å†Œåˆ° <code>MQClientInstance</code>  ä¸­ï¼Œ</li>\n<li>åˆå§‹åŒ– <code>topicPushlishInfo</code> .  <code>topicPushlishInfo</code>  ä¸»è¦ç”¨äºå­˜æ”¾æ¶ˆæ¯çš„è·¯ç”±ä¿¡æ¯ã€‚</li>\n<li>ç„¶åé€šè¿‡  <code>mQClientFactory.start()</code>  å®Œæˆå¯åŠ¨ï¼Œè¿™ä¸€æ­¥éª¤å¾ˆé‡è¦ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹é‡Œé¢çš„å…·ä½“å®ç°.<br>\n<img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-01-MQInstance%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81.png\" alt=\"\">\n<ul>\n<li>1. é¦–å…ˆä¼šè®¾ç½®  <code>NameServerAddr</code> ã€‚å‰é¢æœ‰è¯´è¿‡å¯ä»¥é€šè¿‡  <code>DefaultProducer</code>  çš„ <code>setNameSrvAddr</code>  æ–¹æ³•æ‰‹åŠ¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿå˜é‡çš„æ–¹å¼è¿›è¡Œè®¾ç½® <code>NameServer</code>  çš„åœ°å€ï¼š <code>System.setProperty(&quot;rocketmq.namesrv.domain&quot;, &quot;localhost&quot;);</code></li>\n<li>2. å¼€å¯å®šæ—¶ä»»åŠ¡ï¼šæ€»å…±å¯åŠ¨äº† <code>5</code>  ä¸ªå®šæ—¶å™¨ä»»åŠ¡ï¼Œåˆ†åˆ«æ˜¯ï¼šå®šæ—¶æ›´æ–° <code>NameServerAddr</code>  ä¿¡æ¯ï¼Œå®šæ—¶æ›´æ–° <code>topic</code>  çš„è·¯ç”±ä¿¡æ¯ï¼Œå®šæ—¶æ¸…ç†ä¸‹çº¿çš„ <code>broker</code> ï¼Œå®šæ—¶æŒä¹…åŒ– <code>Consumer</code>  çš„ <code>Offset</code>  ä¿¡æ¯ï¼Œå®šæ—¶è°ƒæ•´çº¿ç¨‹æ± ï¼›</li>\n<li>3. <code>pullMessageService</code>  å’Œ <code>rebalanceService</code>  è¢«ç”¨åœ¨æ¶ˆè´¹ç«¯çš„ä¸¤ä¸ªæœåŠ¡ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼šä» <code>broker</code>  æ‹‰å–æ¶ˆæ¯çš„æœåŠ¡å’Œå‡è¡¡æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œè´Ÿè´£åˆ†é…æ¶ˆè´¹è€…å¯æ¶ˆè´¹çš„æ¶ˆæ¯é˜Ÿåˆ—</li>\n</ul>\n</li>\n<li>åŒæ­¥çš„å‘é€å¿ƒè·³ç»™æ‰€æœ‰çš„ <code>Broker</code> .</li>\n<li>å¼€å¯å®šæ—¶ä»»åŠ¡ï¼šå®šæ—¶æ‰«æè¿‡æœŸçš„è¯·æ±‚ã€‚</li>\n</ul>\n<h3 id=\"ç”Ÿäº§è€…å‘é€æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯\">#</a> ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</h3>\n<p>ç”Ÿäº§è€…å¯åŠ¨å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹:<br>\n å‘é€æ¶ˆæ¯çš„é€»è¾‘ä¸»è¦æ˜¯åœ¨  <code>sendDefaultImpl</code>  æ–¹æ³•ä¸­ã€‚ä¸»è¦é€»è¾‘åˆ†æˆä¸‰æ­¥ï¼š1. è·å–é˜Ÿåˆ—çš„è·¯ç”±ä¿¡æ¯ï¼Œ2. è·å–  <code>MessageQueue</code> , 3. å‘é€æ¶ˆæ¯ã€‚</p>\n<h4 id=\"è·å–é˜Ÿåˆ—è·¯ç”±ä¿¡æ¯\"><a class=\"markdownIt-Anchor\" href=\"#è·å–é˜Ÿåˆ—è·¯ç”±ä¿¡æ¯\">#</a> è·å–é˜Ÿåˆ—è·¯ç”±ä¿¡æ¯</h4>\n<p>åœ¨ å¯åŠ¨ç”Ÿäº§è€…æµç¨‹ä¸­ï¼Œå·²ç»å°† <code>topic</code>  çš„è·¯ç”±ä¿¡æ¯å­˜å‚¨åˆ°äº†  <code>topicPushlishInfo</code>  ä¸­ï¼Œå¹¶ä»¥  <code>producerGroup</code>  ä¸º  <code>key</code> ,  <code>topicPushlishInfo</code>  ä¸º Value ï¼Œå­˜å‚¨åˆ°  <code>topicPublishInfoTable</code>  è¿™ä¸ª <code>Map</code>  ä¸­ã€‚</p>\n<p>è·å–è·¯ç”±ä¿¡æ¯åˆ™æ˜¯é€šè¿‡  <code>mQClientFactory.updateTopicRouteInfoFromNameServer(topic, true, this.defaultMQProducer)</code>  è·å–çš„ã€‚æ­¤æ–¹æ³•æ ¹æ® <code>topic</code>  è·å–è·¯ç”±ä¿¡æ¯ï¼Œå…·ä½“è¿æ¥å“ªå° <code>nameServer</code> ï¼Œä¼šä»åˆ—è¡¨ä¸­é¡ºåºçš„é€‰æ‹© <code>nameServer</code> ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼›</p>\n<h4 id=\"è·å–messagequeue\"><a class=\"markdownIt-Anchor\" href=\"#è·å–messagequeue\">#</a> è·å– <code>MessageQueue</code></h4>\n<p>è·å–  <code>MessageQueue</code>  åˆ™æ˜¯é€šè¿‡  <code>this.mqFaultStrategy.selectOneMessageQueue(tpInfo, lastBrokerName)</code>  æ¥å®ç°çš„ã€‚  <code>MQFaultStrategy</code>  è¿™ä¸ªç±»å®ç°äº†é€‰æ‹©  <code>MessageQueue</code>  çš„ç­–ç•¥ã€‚ä¸»è¦æœ‰å››ç§ç­–ç•¥:</p>\n<ul>\n<li><code>latencyFaultTolerance</code> ï¼šå»¶è¿Ÿå®¹é”™å¯¹è±¡ï¼Œç»´æŠ¤ <code>brokers</code>  çš„å»¶è¿Ÿä¿¡æ¯ï¼›</li>\n<li><code>sendLatencyFaultEnable</code> ï¼šå»¶è¿Ÿå®¹é”™å¼€å…³ï¼Œé»˜è®¤ä¸å¼€å¯ï¼›</li>\n<li><code>latencyMax</code> ï¼šå»¶è¿Ÿçº§åˆ«æ•°ç»„ï¼›</li>\n<li><code>notAvailableDuration</code>  ï¼šæ ¹æ®å»¶è¿Ÿçº§åˆ«ï¼Œå¯¹åº” <code>broker</code>  ä¸å¯ç”¨çš„æ—¶é•¿ï¼›</li>\n</ul>\n<p>è·å– <code>MessageQueue</code>  ä¹‹åéœ€è¦åˆ¤å®šå…¶å¯¹åº”çš„ <code>Broker</code>  æ˜¯å¦å¯ç”¨ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦å’Œå½“å‰æŒ‡å®šçš„ <code>brokerName</code>  è¿›è¡ŒåŒ¹é…ï¼›å¦‚æœæ²¡æœ‰è·å–åˆ°å°±é€‰æ‹©ä¸€ä¸ªå»¶è¿Ÿç›¸å¯¹å°çš„ï¼Œ <code>pickOneAtLeast</code>  ä¼šåšæ’åºå¤„ç†ï¼›å¦‚æœéƒ½ä¸è¡Œå°±ç›´æ¥è·å–ä¸€ä¸ª <code>MessageQueue</code> ï¼Œä¸ç®¡å…¶ä»–æ¡ä»¶äº†</p>\n<h4 id=\"å‘é€æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#å‘é€æ¶ˆæ¯\">#</a> å‘é€æ¶ˆæ¯</h4>\n<p>é¦–å…ˆéœ€è¦è·å–æŒ‡å®š <code>broker</code>  çš„åœ°å€ï¼Œè¿™è¦æ‰èƒ½åˆ›å»º <code>channel</code>  ä¸ <code>broker</code>  è¿æ¥ï¼›ç„¶åå°±æ˜¯ä¸€äº› <code>hook</code>  å¤„ç†ï¼›æ¥ä¸‹æ¥å°±æ˜¯å‡†å¤‡å‘é€çš„æ¶ˆæ¯å¤´ <code>SendMessageRequestHeader</code> ï¼Œæœ€åæ ¹æ®ä¸åŒçš„å‘é€ç­–ç•¥æ‰§è¡Œå‘é€æ¶ˆæ¯ã€‚</p>\n<p>ä¹‹å‰çš„æ–‡ç« ä¸­è¯´è¿‡ï¼Œ <code>RocketMQ</code>  å‘é€æ¶ˆæ¯æœ‰ä¸‰ç§æ–¹å¼ï¼šåŒæ­¥ï¼Œå¼‚æ­¥å’Œå•å‘ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ<a href=\"./1-04-01.%E5%9F%BA%E6%9C%AC%E6%A0%B7%E4%BE%8B.md\">è¿™ç¯‡æ–‡ç« </a>ã€‚åœ¨ <code>RocketMQ</code>  çš„ç”Ÿäº§è€…ç«¯å¯ä»¥å‘é€å¤šç§ç±»å‹çš„æ¶ˆæ¯åŒ…æ‹¬ï¼šå»¶è¿Ÿæ¶ˆæ¯ï¼Œé¡ºåºæ¶ˆæ¯ä»¥åŠäº‹åŠ¡æ¶ˆæ¯ï¼Œ å„ç§æ¶ˆæ¯çš„å‘é€è¿‡ç¨‹æˆ‘ä¼šåœ¨åé¢é€šè¿‡æºç ä»”ç»†å’Œå¤§å®¶ä¸€èµ·å­¦ä¹ ï½ã€‚</p>\n<h3 id=\"ç”Ÿäº§è€…å…³é—­æµç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…å…³é—­æµç¨‹\">#</a> ç”Ÿäº§è€…å…³é—­æµç¨‹</h3>\n<p>ç”Ÿäº§è€…çš„å…³é—­ä¸»è¦æœ‰å››æ­¥</p>\n<ul>\n<li>å–æ¶ˆç”Ÿäº§è€…çš„æ³¨å†Œ.</li>\n<li>å…³é—­ <code>MqClient</code> =&gt; ä¸»è¦æ˜¯å…³é—­ç”Ÿäº§è€…ï¼Œå…³é—­æ‹‰å–æ¶ˆæ¯æœåŠ¡ï¼Œå…³é—­å®šæ—¶ä»»åŠ¡æœåŠ¡ï¼Œå…³é—­è¿œç¨‹ clientï¼Œå…³é—­è´Ÿè½½å‡è¡¡æœåŠ¡è¿™ 5 ç§æœåŠ¡ã€‚</li>\n<li>å…³é—­ <code>Producer</code>  çš„å®šæ—¶ä»»åŠ¡</li>\n<li>ä¿®æ”¹çŠ¶æ€ã€‚</li>\n</ul>\n<p>è¿™æ ·å°±å®Œæˆäº†ç”Ÿäº§è€…çš„å…³é—­æµç¨‹ã€‚</p>\n<h3 id=\"ç”Ÿäº§è€…æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…æ€»ç»“\">#</a> ç”Ÿäº§è€…æ€»ç»“</h3>\n<p>ç”Ÿäº§è€…é¦–å…ˆéœ€è¦è®¾ç½® <code>namesrv</code> ï¼Œæˆ–è€…æŒ‡å®šå…¶ä»–æ–¹å¼æ›´æ–° <code>namesrv</code> ï¼›ç„¶åä» <code>namesrv</code>  è·å– <code>topic</code>  çš„è·¯ç”±ä¿¡æ¯ï¼Œè·¯ç”±ä¿¡æ¯åŒ…æ‹¬ <code>broker</code>  ä»¥åŠ <code>Message Queue</code>  ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶å°†è·¯ç”±ä¿¡æ¯ä¿å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ï¼›æœ€åä» <code>Message Queue</code>  åˆ—è¡¨ä¸­é€‰æ‹©åˆé€‚çš„ <code>Queue</code>  å‘é€æ¶ˆæ¯ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼›</p>\n<h2 id=\"consumer\"><a class=\"markdownIt-Anchor\" href=\"#consumer\">#</a> Consumer</h2>\n<p>ç°åœ¨æˆ‘ä»¬è¿˜å‰©ä¸‹ æ¶ˆè´¹è€… çš„å¯åŠ¨æµç¨‹äº†ã€‚ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´èµ·:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-01-%E6%B6%88%E8%B4%B9%E8%80%85%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81.png\" alt=\"\"></p>\n<p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ä½¿ç”¨ MQ çš„æ¶ˆè´¹è€…ä¸»è¦åˆ†æˆä¸‰éƒ¨åˆ†ï¼š 1. åˆ›å»ºæ¶ˆè´¹è€…å¯¹è±¡ï¼Œ2. é…ç½®æ¶ˆè´¹çš„å±æ€§ nameServer, æ¶ˆè´¹èµ·ç‚¹ï¼Œè®¢é˜…ä¸»é¢˜ï¼Œå›è°ƒäº‹ä»¶ç­‰ã€‚3. å¯åŠ¨æ¶ˆè´¹è€…ã€‚</p>\n<h3 id=\"consumerçš„å¯åŠ¨è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#consumerçš„å¯åŠ¨è¿‡ç¨‹\">#</a> Consumer çš„å¯åŠ¨è¿‡ç¨‹</h3>\n<p>æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œ å¯åŠ¨ <code>MQ</code>  æ¶ˆè´¹è€…ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸»è¦è®²è¿°ç¬¬ä¸€éƒ¨åˆ†å’Œç¬¬ä¸‰éƒ¨åˆ†ï¼šåˆ›å»º <code>Consumer</code>  å¯¹è±¡ï¼Œå¯åŠ¨ã€‚</p>\n<h4 id=\"åˆ›å»º-consumer-å¯¹è±¡\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-consumer-å¯¹è±¡\">#</a> åˆ›å»º Consumer å¯¹è±¡</h4>\n<p><code>RocketMQ</code>  æ”¯æŒä¸¤ç§æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼ï¼Œ <code>pull</code>  æ¨¡å¼ å’Œ  <code>push</code>  æ¨¡å¼ã€‚  <code>pull</code>  æ¨¡å¼æ˜¯æ¶ˆè´¹è€…ä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ï¼Œ <code>push</code>  æ¨¡å¼æ˜¯  <code>broker</code>  ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™æ¶ˆæ¯è€…ç«¯ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œ <code>push</code>  æ¨¡å¼æ˜¯ä¸ç®¡æ¶ˆè´¹è€…ç«¯æ­»æ´»çš„ï¼Œåªè¦æœ‰æ¶ˆæ¯å°±ä¼šæ¨ç»™æ¶ˆè´¹è€…ç«¯ï¼Œä¸ç®¡æ¶ˆè´¹è€…æ˜¯å¦èƒ½æ¶ˆè´¹å®Œã€‚è€Œ <code>pull</code>  æ¨¡å¼æ˜¯ä¸ç®¡ <code>Broker</code>  ç«¯çš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ã€‚</p>\n<p><code>RocketMQ</code>  åˆ†åˆ«æä¾›äº† <code>pull</code>  æ¨¡å¼ å’Œ  <code>push</code>  æ¨¡å¼çš„æ¶ˆè´¹è€…çš„æ”¯æŒã€‚ç±»ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-01-Consuomer%E7%B1%BB%E7%BB%93%E6%9E%84%E5%9B%BE.png\" alt=\"\"></p>\n<p>å›¾ä¸­  <code>push</code>  æ¨¡å¼ï¼Œæä¾›äº†  <code>MQPushConsumer</code> ( <code>DefaultMQPushConsumer</code> ) ç±»æ¥å®ç°ã€‚  <code>pull</code>  æ¨¡å¼æä¾›  <code>MQPullConsumer</code> ( <code>DefaultMQPullConsumer</code> ) ç±»æ¥å®ç°ã€‚ä½†æ˜¯è¿™ä¸ªå·²ç»æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶åœ¨ <code>2022</code>  å¹´ä¼šç§»é™¤ï¼Œæä¾›äº†  <code>LitePullConsumer</code> ( <code>DefaultLitePullConsumer</code> ) æ¥å®ç° <code>Pull</code>  æ¨¡å¼ã€‚</p>\n<h5 id=\"åˆ›å»º-defaultmqpushconsumer-å¯¹è±¡\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-defaultmqpushconsumer-å¯¹è±¡\">#</a> åˆ›å»º DefaultMQPushConsumer å¯¹è±¡</h5>\n<p><code>DefaultMQPullConsumer</code>  å¯¹è±¡çš„æ„é€ å‚æ•°</p>\n<ul>\n<li><code>consumerGroup</code> : æ¶ˆè´¹è€…ç»„</li>\n<li><code>namespace</code> : ç”Ÿäº§è€…çš„  <code>Namespace</code></li>\n<li><code>allocateMessageQueueStrategy</code> : æ¶ˆæ¯é˜Ÿåˆ—åˆ†é…ç®—æ³•</li>\n<li><code>rpcHook</code> :  <code>rpc</code>  çš„é’©å­ï¼Œç”¨åœ¨è¿œç¨‹è°ƒç”¨ä¹‹å‰æ‰§è¡Œ</li>\n<li><code>enableMsgTrace</code> : æ˜¯å¦è·Ÿè¸ªæ¶ˆæ¯è½¨è¿¹</li>\n<li><code>customizedTraceTopic</code> : è·Ÿè¸ªæ¶ˆæ¯è½¨è¿¹ä½¿ç”¨ <code>topic</code></li>\n</ul>\n<p>åœ¨  <code>DefaultMQPushConsumer</code>  çš„æ„é€ æ–¹æ³•ä¸­ä¼šåˆ›å»º  <code>DefaultMQPushConsumerImpl</code>  å¯¹è±¡ï¼Œæˆ‘ä»¬åé¢æ‰€è¯´çš„å¯åŠ¨è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯  <code>DefaultMQPushConsumerImpl</code>  çš„å¯åŠ¨è¿‡ç¨‹ï¼Œå³  <code>DefaultMQPushConsumerImpl.start()</code> .</p>\n<h5 id=\"åˆ›å»º-defaultlitepullconsumer-å¯¹è±¡\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»º-defaultlitepullconsumer-å¯¹è±¡\">#</a> åˆ›å»º  <code>DefaultLitePullConsumer</code>  å¯¹è±¡</h5>\n<p><code>DefaultLitePullConsumer</code>  å¯¹è±¡çš„å‚æ•°:</p>\n<ul>\n<li><code>namespace</code> : ç”Ÿäº§è€…çš„å‘½åç©ºé—´</li>\n<li><code>consumerGroup</code> :  æ¶ˆè´¹è€…ç»„</li>\n<li><code>rpcHook</code> : RPC çš„å›è°ƒé’©å­</li>\n</ul>\n<p>åœ¨  <code>DefaultLitePullConsumer</code>  çš„æ„é€ æ–¹æ³•ä¸­ä¼šåˆ›å»º  <code>defaultLitePullConsumerImpl</code>  å¯¹è±¡ã€‚è€Œåé¢çš„å¯åŠ¨è¿‡ç¨‹ï¼Œå³æ˜¯  <code>DefaultLitePullConsumerImpl</code>  çš„å¯åŠ¨è¿‡ç¨‹ã€‚å³  <code>DefaultLitePullConsumerImpl.start()</code> .</p>\n<h4 id=\"å¯åŠ¨\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨\">#</a> å¯åŠ¨</h4>\n<p>è¿™é‡Œæˆ‘å†æŠŠä½¿ç”¨ DefaultMQPushConsumer æ¶ˆè´¹æ¶ˆæ¯çš„æ¡ˆä¾‹ ç²˜è´´åˆ°è¿™é‡Œ</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-01-%E6%B6%88%E8%B4%B9%E8%80%85%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81.png\" alt=\"\"></p>\n<p>æˆ‘ä»¬ä¸»è¦çœ‹  <code>consumer.start()</code>  å†…éƒ¨çš„å…·ä½“å®ç°ã€‚</p>\n<h5 id=\"pushæ¨¡å¼-defaultmqpushconsumerimplstart\"><a class=\"markdownIt-Anchor\" href=\"#pushæ¨¡å¼-defaultmqpushconsumerimplstart\">#</a> push æ¨¡å¼: DefaultMQPushConsumerImpl.start ()</h5>\n<ul>\n<li>æ£€æŸ¥å¿…è¦çš„å‚æ•° <code>consumerGroup</code> , æ¶ˆè´¹æ¨¡å¼ï¼Œæ¶ˆè´¹èµ·ç‚¹ï¼Œè´Ÿè½½ç­–ç•¥ç­‰ã€‚</li>\n<li>æ‹·è´è®¢é˜…å…³ç³»ï¼Œç»‘å®šåˆ°é‡è¯• <code>topic</code> , ä»¥é˜²æ­¢æ¶ˆè´¹è€…  <code>ack</code>  å¤±è´¥ã€‚</li>\n<li>åˆ›å»º <code>MQClientInstance</code>  å®ä¾‹ã€‚è¿™é‡Œæ˜¯ä¸€ç§å•ä¾‹æ¨¡å¼ã€‚</li>\n<li>é…ç½®æ¶ˆè´¹è€…å†å¹³è¡¡çš„æ¶ˆè´¹è€…ç»„ï¼Œæ¶ˆæ¯æ¨¡å¼ï¼Œæ¶ˆæ¯çš„åˆ†é…ç­–ç•¥ï¼Œ  <code>MQClientInstance</code>  å®ä¾‹ã€‚</li>\n<li>å®ä¾‹åŒ–æ¶ˆæ¯æ‹‰å–çš„åŒ…è£…ç±» å¹¶æ³¨å†Œæ¶ˆæ¯è¿‡æ»¤çš„é’©å­</li>\n<li>åŠ è½½æ¶ˆæ¯çš„æ¶ˆè´¹åç§»é‡ã€‚ å¦‚æœæ˜¯å¹¿æ’­æ¶ˆæ¯ä»æœ¬åœ°è·å–åç§»æ•°æ®ï¼Œå¦‚æœæ˜¯é›†ç¾¤æ¶ˆæ¯çš„è¯ï¼Œåˆ™ä»è¿œç¨‹è·å–åç§»æ•°æ®</li>\n<li>å¯åŠ¨æ¶ˆæ¯æ¶ˆè´¹æœåŠ¡ã€‚è¿™é‡Œåªæ˜¯å¯åŠ¨æ¶ˆè´¹æœåŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰å¯åŠ¨å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>\n<li>ç»‘å®šæ¶ˆè´¹è€…  <code>group</code>  å’Œ æ¶ˆè´¹è€…</li>\n<li>å¯åŠ¨  <code>MQ Client Instance</code> . è¿™é‡Œï¼Œåœ¨ç”Ÿäº§è€…ä¸­ä¹Ÿè°ƒç”¨äº†  <code>mQClientFactory.start()</code> ; æ–¹æ³•ã€‚æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆæ¶ˆè´¹è€…ä¼šå¯åŠ¨æ¶ˆæ¯æ¨é€æœåŠ¡å‘¢ï¼Ÿå› ä¸ºåœ¨ <code>push</code>  æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è¶…æ—¶çš„æ¶ˆæ¯ä¼šé‡æ–°å‘é€ç»™ <code>Broker</code> ã€‚æ‰€ä»¥æ˜¯ä¼šä½¿ç”¨æ¶ˆæ¯æ¨é€æœåŠ¡çš„.</li>\n<li>ä» <code>NameServer</code>  æ‹‰å– <code>topic</code>  çš„è®¢é˜…ä¿¡æ¯</li>\n<li>å‘ <code>Broker</code>  æ ¡éªŒå®¢æˆ·ç«¯</li>\n<li>å‘æ‰€æœ‰çš„ <code>Broker</code>  çš„ <code>master</code>  èŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…ï¼Œå¹¶ä¸Šä¼  <code>FilterClass</code>  æºæ–‡ä»¶ç»™ <code>FilterServer</code></li>\n<li>ç«‹å³æ¶ˆè´¹æ¶ˆæ¯ï¼š å°†å½“å‰ <code>consumer</code>  è´Ÿè½½å¾—åˆ°çš„ <code>MessageQueue</code>  å…¨éƒ¨æ·»åŠ åˆ° <code>PullMessageService.pullRequestQueue</code>  (é˜»å¡é˜Ÿåˆ—) ç„¶å <code>PullMessageService</code>  æœåŠ¡ä¼šå¼€å§‹æ‹‰å–æ¶ˆæ¯ã€‚æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>\n</ul>\n<h5 id=\"pullæ¨¡å¼-defaultlitepullconsumerimplstart\"><a class=\"markdownIt-Anchor\" href=\"#pullæ¨¡å¼-defaultlitepullconsumerimplstart\">#</a>  <code>pull</code>  æ¨¡å¼:  <code>DefaultLitePullConsumerImpl.start()</code></h5>\n<p>å…ˆçœ‹ä¸‹  <code>DefaultLitePullConsumer</code>  çš„ä¸€ä¸ªç®€å•ä½¿ç”¨:</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/2-01-DefaultLitePullConsumer%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81.png\" alt=\"\"></p>\n<p><code>DefaultLitePullConsumer</code>  çš„å®ç°ä»£ç è¦æ¯”   <code>DefaultMQPushConsumer</code>  çš„ä»£ç  è§„æ•´å¾ˆå¤šã€‚åœ¨  <code>start()</code>  æ–¹æ³•ä¸­å®šä¹‰äº†å¾ˆå¤šçš„å­æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚</p>\n<ul>\n<li>æ£€æŸ¥å±æ€§é…ç½®æ˜¯å¦åˆæ³•ã€‚</li>\n<li>åˆå§‹åŒ–  <code>MqClientInstance</code> .\n<ul>\n<li>åˆ›å»º  <code>MQClientInstance</code>  å®ä¾‹</li>\n<li>æ³¨å†Œ  <code>consumerGroup</code>  å’Œ å½“å‰æ¶ˆè´¹è€…çš„å…³ç³»</li>\n</ul>\n</li>\n<li>åˆå§‹åŒ– æ¶ˆæ¯æ¶ˆè´¹çš„ å†å¹³è¡¡ æœåŠ¡ã€‚</li>\n<li>é…ç½®æ¶ˆè´¹è€…å†å¹³è¡¡çš„æ¶ˆè´¹è€…ç»„ï¼Œæ¶ˆæ¯æ¨¡å¼ï¼Œæ¶ˆæ¯çš„åˆ†é…ç­–ç•¥ï¼Œ  <code>MQClientInstance</code>  å®ä¾‹ã€‚</li>\n<li>å®ä¾‹åŒ–æ¶ˆæ¯æ‹‰å–çš„åŒ…è£…ç±» å¹¶æ³¨å†Œæ¶ˆæ¯è¿‡æ»¤çš„é’©å­</li>\n<li>åŠ è½½æ¶ˆæ¯çš„æ¶ˆè´¹åç§»é‡ã€‚ å¦‚æœæ˜¯å¹¿æ’­æ¶ˆæ¯ä»æœ¬åœ°è·å–åç§»æ•°æ®ï¼Œå¦‚æœæ˜¯é›†ç¾¤æ¶ˆæ¯çš„è¯ï¼Œåˆ™ä»è¿œç¨‹è·å–åç§»æ•°æ®</li>\n<li>å¯åŠ¨  <code>MqClientInstance</code>  å®ä¾‹\n<ul>\n<li>è®¾ç½®  <code>NameServer</code>  çš„åœ°å€</li>\n<li>å¯åŠ¨  <code>remoteClient</code> . åº•å±‚ä½¿ç”¨çš„é€šè®¯æ¡†æ¶æ˜¯ <code>Netty</code> ï¼Œæä¾›äº†å®ç°ç±» <code>NettyRemotingClient</code></li>\n<li>å¼€å¯å®šæ—¶ä»»åŠ¡</li>\n<li>å¯åŠ¨æ‹‰å–æ¶ˆæ¯çš„æœåŠ¡</li>\n<li>å¯åŠ¨è´Ÿè½½å‡è¡¡æœåŠ¡</li>\n<li>å¯åŠ¨æ¨é€æ¶ˆæ¯çš„æœåŠ¡</li>\n<li>ä¿®æ”¹æœåŠ¡çš„çŠ¶æ€ä¸ºå¯åŠ¨æˆåŠŸ</li>\n</ul>\n</li>\n<li>å¯åŠ¨åæ“ä½œ\n<ul>\n<li>å¦‚æœæ˜¯å¹¿æ’­çš„æ¨¡å¼ï¼šæ›´æ–° <code>topic</code>  çš„è®¢é˜…å…³ç³»</li>\n<li>æ›´æ–°æ¶ˆæ¯æ‹‰å–ä»»åŠ¡</li>\n<li>æ‹‰å– <code>Topic</code>  çš„ <code>messageQueue</code> .</li>\n<li>æ£€æŸ¥  <code>Broker Client</code></li>\n</ul>\n</li>\n</ul>\n<h5 id=\"pull-æ¨¡å¼-å’Œ-push-æ¨¡å¼çš„å¯¹æ¯”\"><a class=\"markdownIt-Anchor\" href=\"#pull-æ¨¡å¼-å’Œ-push-æ¨¡å¼çš„å¯¹æ¯”\">#</a> Pull æ¨¡å¼ å’Œ push æ¨¡å¼çš„å¯¹æ¯”</h5>\n<p>ç°åœ¨å»è°ˆ push å’Œ pull ä¸¤ç§æ¨¡å¼çš„å¯¹æ¯”ï¼Œè¿˜ä¸ºæ—¶å°šæ—©ï¼Œæˆ‘å°±å…ˆä»å¯åŠ¨ä¸Šæ¥çœ‹ä¸‹ï¼Œä¸¤ç§æ–¹å¼å¯åŠ¨çš„ä¸åŒç‚¹:</p>\n<ul>\n<li><code>pull</code>  æ¨¡å¼æ²¡æœ‰æ‹·è´è®¢é˜…å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´  <code>pull</code>  æ¨¡å¼ä¸‹ï¼Œ <code>RocketMQ</code>  æ˜¯æ²¡æœ‰æä¾›é‡æŠ•æœºåˆ¶çš„ã€‚</li>\n<li><code>pull</code>  æ¨¡å¼æ²¡æœ‰å’Œ  <code>Broker</code>  ä¿æŒå¿ƒè·³åŒ…ã€‚ å¦‚æœæ¶ˆè´¹è€…è¿‡å¤šçš„æ—¶å€™ï¼Œpush æ¨¡å¼å¿…ç„¶ä¼šå¯¹ Broker é€ æˆæ¯”è¾ƒå•Šçš„å‹åŠ›ã€‚</li>\n</ul>\n<h3 id=\"æ¶ˆè´¹è€…æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹è€…æ€»ç»“\">#</a> æ¶ˆè´¹è€…æ€»ç»“</h3>\n<p><code>RocketMQ</code>  å¯¹  <code>pull</code>  å’Œ  <code>push</code>  ä¸¤ç§æ¶ˆæ¯çš„æ¶ˆè´¹æ¨¡å¼æä¾›äº†æ”¯æŒã€‚ <code>pull</code>  æ¨¡å¼ï¼Œå¯¹åº”çš„å®ç°æ˜¯  <code>DefaultMqLitePullConsumer</code> ã€‚  <code>push</code>  æ¨¡å¼å¯¹åº”çš„å®ç°æ˜¯  <code>DefaultMqPushConsumer</code> . ä»…ä»…å¯¹å¯åŠ¨è¿‡ç¨‹ï¼Œä¸¤è€…çš„å¯åŠ¨è¿‡ç¨‹ç¨æœ‰ä¸åŒã€‚ <code>Push</code>  æ¨¡å¼ä¸‹ï¼Œ <code>RocketMQ</code>  å°è£…äº† æ¶ˆæ¯æ¶ˆè´¹çš„é‡æŠ•æœºåˆ¶ï¼Œ <code>pull</code>  æ¨¡å¼åˆ™æ²¡æœ‰ï¼Œä¸€åˆ‡éƒ½éœ€è¦æ¶ˆè´¹è€…è‡ªå·±å»å®ç°ã€‚  <code>push</code>  æ¨¡å¼ä¼šæŠŠ æ ¹æ®  <code>MessageQueue</code>  çš„åˆ†é…ç­–ç•¥ï¼Œå°† <code>MessageQueue</code>  æ‹‰å–åˆ°æœ¬åœ°ï¼Œå­˜å‚¨åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡å›è°ƒæ¶ˆè´¹è€…æ³¨å†Œç›‘å¬å™¨è¿›è¡Œæ¶ˆè´¹ã€‚  <code>pull</code>  æ¨¡å¼åˆ™é€šè¿‡åœ¨æ¶ˆè´¹é€»è¾‘ä¸­å®šæ—¶çš„è½®è¯¢è·å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚  ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä¼šä»”ç»†çš„åˆ†ææ¶ˆæ¯æ¶ˆè´¹çš„è¿‡ç¨‹ã€‚</p>\n<p>ä¸ç®¡æ˜¯ <code>Pull</code>  æ¨¡å¼ï¼Œè¿˜æ˜¯ <code>push</code>  æ¨¡å¼ï¼Œåœ¨å¯åŠ¨è¿‡ç¨‹éƒ½æ˜¯ åˆ›å»º  <code>MqClientInstance</code>  å®ä¾‹ï¼Œå¹¶å¯åŠ¨ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-06.%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-06.%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/",
            "title": "RocketMQæ ·ä¾‹:äº‹åŠ¡æ¶ˆæ¯",
            "date_published": "2021-09-23T09:50:00.000Z",
            "content_html": "<p>äº‹åŠ¡æ¶ˆæ¯å…±æœ‰ä¸‰ç§çŠ¶æ€ï¼Œæäº¤çŠ¶æ€ã€å›æ»šçŠ¶æ€ã€ä¸­é—´çŠ¶æ€ï¼š</p>\n<p><code>TransactionStatus.CommitTransaction</code> : æäº¤äº‹åŠ¡ï¼Œå®ƒå…è®¸æ¶ˆè´¹è€…æ¶ˆè´¹æ­¤æ¶ˆæ¯ã€‚<br>\n <code>TransactionStatus.RollbackTransaction</code> : å›æ»šäº‹åŠ¡ï¼Œå®ƒä»£è¡¨è¯¥æ¶ˆæ¯å°†è¢«åˆ é™¤ï¼Œä¸å…è®¸è¢«æ¶ˆè´¹ã€‚<br>\n <code>TransactionStatus.Unknown</code> : ä¸­é—´çŠ¶æ€ï¼Œå®ƒä»£è¡¨éœ€è¦æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ¥ç¡®å®šçŠ¶æ€ã€‚</p>\n<h2 id=\"å‘é€äº‹åŠ¡æ¶ˆæ¯æ ·ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#å‘é€äº‹åŠ¡æ¶ˆæ¯æ ·ä¾‹\">#</a> å‘é€äº‹åŠ¡æ¶ˆæ¯æ ·ä¾‹</h2>\n<h3 id=\"åˆ›å»ºäº‹åŠ¡æ€§ç”Ÿäº§è€…\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºäº‹åŠ¡æ€§ç”Ÿäº§è€…\">#</a> åˆ›å»ºäº‹åŠ¡æ€§ç”Ÿäº§è€…</h3>\n<p>ä½¿ç”¨  <code>TransactionMQProducer</code>  ç±»åˆ›å»ºç”Ÿäº§è€…ï¼Œå¹¶æŒ‡å®šå”¯ä¸€çš„  <code>ProducerGroup</code> ï¼Œå°±å¯ä»¥è®¾ç½®è‡ªå®šä¹‰çº¿ç¨‹æ± æ¥å¤„ç†è¿™äº›æ£€æŸ¥è¯·æ±‚ã€‚æ‰§è¡Œæœ¬åœ°äº‹åŠ¡åã€éœ€è¦æ ¹æ®æ‰§è¡Œç»“æœå¯¹æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå›å¤ã€‚å›ä¼ çš„äº‹åŠ¡çŠ¶æ€åœ¨è¯·å‚è€ƒå‰ä¸€èŠ‚ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.ConsumeConcurrentlyContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.ConsumeConcurrentlyStatus;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.MessageListenerConcurrently;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.MessageExt;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TransactionProducer</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> MQClientException, InterruptedException </span>&#123;</span><br><span class=\"line\">       TransactionListener transactionListener = <span class=\"keyword\">new</span> TransactionListenerImpl();</span><br><span class=\"line\">       TransactionMQProducer producer = <span class=\"keyword\">new</span> TransactionMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\">       ExecutorService executorService = <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">2</span>, <span class=\"number\">5</span>, <span class=\"number\">100</span>, TimeUnit.SECONDS, <span class=\"keyword\">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class=\"number\">2000</span>), <span class=\"keyword\">new</span> ThreadFactory() &#123;</span><br><span class=\"line\">           <span class=\"meta\">@Override</span></span><br><span class=\"line\">           <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</span><br><span class=\"line\">               Thread thread = <span class=\"keyword\">new</span> Thread(r);</span><br><span class=\"line\">               thread.setName(<span class=\"string\">&quot;client-transaction-msg-check-thread&quot;</span>);</span><br><span class=\"line\">               <span class=\"keyword\">return</span> thread;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">       producer.setExecutorService(executorService);</span><br><span class=\"line\">       producer.setTransactionListener(transactionListener);</span><br><span class=\"line\">       producer.start();</span><br><span class=\"line\">       String[] tags = <span class=\"keyword\">new</span> String[] &#123;<span class=\"string\">&quot;TagA&quot;</span>, <span class=\"string\">&quot;TagB&quot;</span>, <span class=\"string\">&quot;TagC&quot;</span>, <span class=\"string\">&quot;TagD&quot;</span>, <span class=\"string\">&quot;TagE&quot;</span>&#125;;</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">               Message msg =</span><br><span class=\"line\">                   <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest1234&quot;</span>, tags[i % tags.length], <span class=\"string\">&quot;KEY&quot;</span> + i,</span><br><span class=\"line\">                       (<span class=\"string\">&quot;Hello RocketMQ &quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET));</span><br><span class=\"line\">               SendResult sendResult = producer.sendMessageInTransaction(msg, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">               System.out.printf(<span class=\"string\">&quot;%s%n&quot;</span>, sendResult);</span><br><span class=\"line\">               Thread.sleep(<span class=\"number\">10</span>);</span><br><span class=\"line\">           &#125; <span class=\"keyword\">catch</span> (MQClientException | UnsupportedEncodingException e) &#123;</span><br><span class=\"line\">               e.printStackTrace();</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100000</span>; i++) &#123;</span><br><span class=\"line\">           Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       producer.shutdown();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2ã€å®ç°äº‹åŠ¡çš„ç›‘å¬æ¥å£<br>\nå½“å‘é€åŠæ¶ˆæ¯æˆåŠŸæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨  <code>executeLocalTransaction</code>  æ–¹æ³•æ¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚å®ƒè¿”å›å‰ä¸€èŠ‚ä¸­æåˆ°çš„ä¸‰ä¸ªäº‹åŠ¡çŠ¶æ€ä¹‹ä¸€ã€‚ <code>checkLocalTransaction</code>  æ–¹æ³•ç”¨äºæ£€æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€ï¼Œå¹¶å›åº”æ¶ˆæ¯é˜Ÿåˆ—çš„æ£€æŸ¥è¯·æ±‚ã€‚å®ƒä¹Ÿæ˜¯è¿”å›å‰ä¸€èŠ‚ä¸­æåˆ°çš„ä¸‰ä¸ªäº‹åŠ¡çŠ¶æ€ä¹‹ä¸€ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TransactionListenerImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">TransactionListener</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> AtomicInteger transactionIndex = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"keyword\">private</span> ConcurrentHashMap&lt;String, Integer&gt; localTrans = <span class=\"keyword\">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class=\"line\">  <span class=\"meta\">@Override</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> LocalTransactionState <span class=\"title\">executeLocalTransaction</span><span class=\"params\">(Message msg, Object arg)</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">int</span> value = transactionIndex.getAndIncrement();</span><br><span class=\"line\">      <span class=\"keyword\">int</span> status = value % <span class=\"number\">3</span>;</span><br><span class=\"line\">      localTrans.put(msg.getTransactionId(), status);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> LocalTransactionState.UNKNOW;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@Override</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> LocalTransactionState <span class=\"title\">checkLocalTransaction</span><span class=\"params\">(MessageExt msg)</span> </span>&#123;</span><br><span class=\"line\">      Integer status = localTrans.get(msg.getTransactionId());</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != status) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">switch</span> (status) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">                  <span class=\"keyword\">return</span> LocalTransactionState.UNKNOW;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                  <span class=\"keyword\">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class=\"line\">              <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                  <span class=\"keyword\">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"äº‹åŠ¡æ¶ˆæ¯ä½¿ç”¨ä¸Šçš„é™åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#äº‹åŠ¡æ¶ˆæ¯ä½¿ç”¨ä¸Šçš„é™åˆ¶\">#</a> äº‹åŠ¡æ¶ˆæ¯ä½¿ç”¨ä¸Šçš„é™åˆ¶</h3>\n<ul>\n<li>äº‹åŠ¡æ¶ˆæ¯ä¸æ”¯æŒå»¶æ—¶æ¶ˆæ¯å’Œæ‰¹é‡æ¶ˆæ¯ã€‚</li>\n</ul>\n<p>ä¸ºäº†é¿å…å•ä¸ªæ¶ˆæ¯è¢«æ£€æŸ¥å¤ªå¤šæ¬¡è€Œå¯¼è‡´åŠé˜Ÿåˆ—æ¶ˆæ¯ç´¯ç§¯ï¼Œæˆ‘ä»¬é»˜è®¤å°†å•ä¸ªæ¶ˆæ¯çš„æ£€æŸ¥æ¬¡æ•°é™åˆ¶ä¸º  <code>15</code>  æ¬¡ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥é€šè¿‡  <code>Broker</code>  é…ç½®æ–‡ä»¶çš„  <code>transactionCheckMax</code>  å‚æ•°æ¥ä¿®æ”¹æ­¤é™åˆ¶ã€‚å¦‚æœå·²ç»æ£€æŸ¥æŸæ¡æ¶ˆæ¯è¶…è¿‡  <code>N</code>  æ¬¡çš„è¯ï¼ˆ  <code>N = transactionCheckMax</code>  ï¼‰ åˆ™  <code>Broker</code>  å°†ä¸¢å¼ƒæ­¤æ¶ˆæ¯ï¼Œå¹¶åœ¨é»˜è®¤æƒ…å†µä¸‹åŒæ—¶æ‰“å°é”™è¯¯æ—¥å¿—ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡é‡å†™  <code>AbstractTransactionalMessageCheckListener</code>  ç±»æ¥ä¿®æ”¹è¿™ä¸ªè¡Œä¸ºã€‚</p>\n<p>äº‹åŠ¡æ¶ˆæ¯å°†åœ¨  <code>Broker</code>  é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°  <code>transactionTimeout</code>  è¿™æ ·çš„ç‰¹å®šæ—¶é—´é•¿åº¦ä¹‹åè¢«æ£€æŸ¥ã€‚å½“å‘é€äº‹åŠ¡æ¶ˆæ¯æ—¶ï¼Œç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡è®¾ç½®ç”¨æˆ·å±æ€§  <code>CHECK_IMMUNITY_TIME_IN_SECONDS</code>  æ¥æ”¹å˜è¿™ä¸ªé™åˆ¶ï¼Œè¯¥å‚æ•°ä¼˜å…ˆäº  <code>transactionTimeout</code>  å‚æ•°ã€‚</p>\n<ul>\n<li>äº‹åŠ¡æ€§æ¶ˆæ¯å¯èƒ½ä¸æ­¢ä¸€æ¬¡è¢«æ£€æŸ¥æˆ–æ¶ˆè´¹ã€‚</li>\n</ul>\n<p>æäº¤ç»™ç”¨æˆ·çš„ç›®æ ‡ä¸»é¢˜æ¶ˆæ¯å¯èƒ½ä¼šå¤±è´¥ï¼Œç›®å‰è¿™ä¾æ—¥å¿—çš„è®°å½•è€Œå®šã€‚å®ƒçš„é«˜å¯ç”¨æ€§é€šè¿‡  <code>RocketMQ</code>  æœ¬èº«çš„é«˜å¯ç”¨æ€§æœºåˆ¶æ¥ä¿è¯ï¼Œå¦‚æœå¸Œæœ›ç¡®ä¿äº‹åŠ¡æ¶ˆæ¯ä¸ä¸¢å¤±ã€å¹¶ä¸”äº‹åŠ¡å®Œæ•´æ€§å¾—åˆ°ä¿è¯ï¼Œå»ºè®®ä½¿ç”¨åŒæ­¥çš„åŒé‡å†™å…¥æœºåˆ¶ã€‚<br>\näº‹åŠ¡æ¶ˆæ¯çš„ç”Ÿäº§è€…  <code>ID</code>  ä¸èƒ½ä¸å…¶ä»–ç±»å‹æ¶ˆæ¯çš„ç”Ÿäº§è€…  <code>ID</code>  å…±äº«ã€‚ä¸å…¶ä»–ç±»å‹çš„æ¶ˆæ¯ä¸åŒï¼Œäº‹åŠ¡æ¶ˆæ¯å…è®¸åå‘æŸ¥è¯¢ã€ <code>MQ</code>  æœåŠ¡å™¨èƒ½é€šè¿‡å®ƒä»¬çš„ç”Ÿäº§è€…  <code>ID</code>  æŸ¥è¯¢åˆ°æ¶ˆè´¹è€…ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-05.%E8%BF%87%E6%BB%A4%E6%B6%88%E6%81%AF/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-05.%E8%BF%87%E6%BB%A4%E6%B6%88%E6%81%AF/",
            "title": "RocketMQæ ·ä¾‹:è¿‡æ»¤æ¶ˆæ¯",
            "date_published": "2021-09-23T09:30:00.000Z",
            "content_html": "<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ <code>TAG</code>  æ˜¯ä¸€ä¸ªç®€å•è€Œæœ‰ç”¨çš„è®¾è®¡ï¼Œå…¶å¯ä»¥æ¥é€‰æ‹©æ‚¨æƒ³è¦çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DefaultMQPushConsumer consumer = <span class=\"keyword\">new</span> DefaultMQPushConsumer(<span class=\"string\">&quot;CID_EXAMPLE&quot;</span>);</span><br><span class=\"line\">consumer.subscribe(<span class=\"string\">&quot;TOPIC&quot;</span>, <span class=\"string\">&quot;TAGA || TAGB || TAGC&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>æ¶ˆè´¹è€…å°†æ¥æ”¶åŒ…å« <code>TAGA</code>  æˆ– <code>TAGB</code>  æˆ– <code>TAGC</code>  çš„æ¶ˆæ¯ã€‚ä½†æ˜¯é™åˆ¶æ˜¯ä¸€ä¸ªæ¶ˆæ¯åªèƒ½æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œè¿™å¯¹äºå¤æ‚çš„åœºæ™¯å¯èƒ½ä¸èµ·ä½œç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>SQL</code>  è¡¨è¾¾å¼ç­›é€‰æ¶ˆæ¯ã€‚SQL ç‰¹æ€§å¯ä»¥é€šè¿‡å‘é€æ¶ˆæ¯æ—¶çš„å±æ€§æ¥è¿›è¡Œè®¡ç®—ã€‚åœ¨ <code>RocketMQ</code>  å®šä¹‰çš„è¯­æ³•ä¸‹ï¼Œå¯ä»¥å®ç°ä¸€äº›ç®€å•çš„é€»è¾‘ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">------------</span><br><span class=\"line\">| message  |</span><br><span class=\"line\">|----------|  a &gt; 5 AND b = &#x27;abc&#x27;</span><br><span class=\"line\">| a = 10   |  --------------------&gt; Gotten</span><br><span class=\"line\">| b = &#x27;abc&#x27;|</span><br><span class=\"line\">| c = true |</span><br><span class=\"line\">------------</span><br><span class=\"line\">------------</span><br><span class=\"line\">| message  |</span><br><span class=\"line\">|----------|   a &gt; 5 AND b = &#x27;abc&#x27;</span><br><span class=\"line\">| a = 1    |  --------------------&gt; Missed</span><br><span class=\"line\">| b = &#x27;abc&#x27;|</span><br><span class=\"line\">| c = true |</span><br><span class=\"line\">------------</span><br></pre></td></tr></table></figure>\n<h2 id=\"åŸºæœ¬è¯­æ³•\"><a class=\"markdownIt-Anchor\" href=\"#åŸºæœ¬è¯­æ³•\">#</a> åŸºæœ¬è¯­æ³•</h2>\n<p><code>RocketMQ</code>  åªå®šä¹‰äº†ä¸€äº›åŸºæœ¬è¯­æ³•æ¥æ”¯æŒè¿™ä¸ªç‰¹æ€§ã€‚ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•å®ƒã€‚</p>\n<ul>\n<li>æ•°å€¼æ¯”è¾ƒï¼Œæ¯”å¦‚ï¼š <code>&gt;</code> ï¼Œ <code>&gt;=</code> ï¼Œ <code>&lt;</code> ï¼Œ <code>&lt;=</code> ï¼Œ <code>BETWEEN</code> ï¼Œ <code>=</code> ï¼›</li>\n<li>å­—ç¬¦æ¯”è¾ƒï¼Œæ¯”å¦‚ï¼š <code>=</code> ï¼Œ <code>&lt;&gt;</code> ï¼Œ <code>IN</code> ï¼›</li>\n<li><code>IS NULL </code> æˆ–è€…  <code>IS NOT NUL</code> Lï¼›</li>\n<li>é€»è¾‘ç¬¦å·  <code>AND</code> ï¼Œ <code>OR</code> ï¼Œ <code>NOT</code> ï¼›</li>\n<li>å¸¸é‡æ”¯æŒç±»å‹ä¸ºï¼š</li>\n<li>æ•°å€¼ï¼Œæ¯”å¦‚ï¼š <code>123</code> ï¼Œ <code>3.1415</code> ï¼›</li>\n<li>å­—ç¬¦ï¼Œæ¯”å¦‚ï¼š <code>'abc'</code> ï¼Œå¿…é¡»ç”¨å•å¼•å·åŒ…è£¹èµ·æ¥ï¼›</li>\n<li><code>NULL</code> ï¼Œç‰¹æ®Šçš„å¸¸é‡</li>\n<li>å¸ƒå°”å€¼ï¼Œ <code>TRUE</code>  æˆ–  <code>FALSE</code></li>\n<li>åªæœ‰ä½¿ç”¨ <code>push</code>  æ¨¡å¼çš„æ¶ˆè´¹è€…æ‰èƒ½ç”¨ä½¿ç”¨ <code>SQL92</code>  æ ‡å‡†çš„ <code>sql</code>  è¯­å¥ï¼Œæ¥å£å¦‚ä¸‹ï¼š <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">subscribe</span><span class=\"params\">(finalString topic, <span class=\"keyword\">final</span> MessageSelector messageSelector)</span></span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"ä½¿ç”¨æ ·ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨æ ·ä¾‹\">#</a> ä½¿ç”¨æ ·ä¾‹</h2>\n<h3 id=\"ç”Ÿäº§è€…æ ·ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…æ ·ä¾‹\">#</a> ç”Ÿäº§è€…æ ·ä¾‹</h3>\n<p>å‘é€æ¶ˆæ¯æ—¶ï¼Œä½ èƒ½é€šè¿‡ <code>putUserProperty</code>  æ¥è®¾ç½®æ¶ˆæ¯çš„å±æ€§</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\">producer.start();</span><br><span class=\"line\">Message msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span>,</span><br><span class=\"line\">   tag,</span><br><span class=\"line\">   (<span class=\"string\">&quot;Hello RocketMQ &quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET)</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"comment\">// è®¾ç½®ä¸€äº›å±æ€§</span></span><br><span class=\"line\">msg.putUserProperty(<span class=\"string\">&quot;a&quot;</span>, String.valueOf(i));</span><br><span class=\"line\">SendResult sendResult = producer.send(msg);</span><br><span class=\"line\"></span><br><span class=\"line\">producer.shutdown();</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ¶ˆè´¹è€…æ ·ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹è€…æ ·ä¾‹\">#</a> æ¶ˆè´¹è€…æ ·ä¾‹</h3>\n<p>ç”¨ <code>MessageSelector.bySql</code>  æ¥ä½¿ç”¨ <code>sql</code>  ç­›é€‰æ¶ˆæ¯</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DefaultMQPushConsumer consumer = <span class=\"keyword\">new</span> DefaultMQPushConsumer(<span class=\"string\">&quot;please_rename_unique_group_name_4&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// åªæœ‰è®¢é˜…çš„æ¶ˆæ¯æœ‰è¿™ä¸ªå±æ€§a, a &gt;=0 and a &lt;= 3</span></span><br><span class=\"line\">consumer.subscribe(<span class=\"string\">&quot;TopicTest&quot;</span>, MessageSelector.bySql(<span class=\"string\">&quot;a between 0 and 3&quot;</span>);</span><br><span class=\"line\">consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</span><br><span class=\"line\">   <span class=\"meta\">@Override</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">consumer.start();</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-04.%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-04.%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF/",
            "title": "RocketMQæ ·ä¾‹:æ‰¹é‡æ¶ˆæ¯",
            "date_published": "2021-09-23T09:19:00.000Z",
            "content_html": "<h2 id=\"æ‰¹é‡æ¶ˆæ¯æ ·ä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#æ‰¹é‡æ¶ˆæ¯æ ·ä¾‹\">#</a> æ‰¹é‡æ¶ˆæ¯æ ·ä¾‹</h2>\n<p>æ‰¹é‡å‘é€æ¶ˆæ¯èƒ½æ˜¾è‘—æé«˜ä¼ é€’å°æ¶ˆæ¯çš„æ€§èƒ½ã€‚é™åˆ¶æ˜¯è¿™äº›æ‰¹é‡æ¶ˆæ¯åº”è¯¥æœ‰ç›¸åŒçš„ <code>topic</code> ï¼Œç›¸åŒçš„ <code>waitStoreMsgOK</code> ï¼Œè€Œä¸”ä¸èƒ½æ˜¯å»¶æ—¶æ¶ˆæ¯ã€‚æ­¤å¤–ï¼Œè¿™ä¸€æ‰¹æ¶ˆæ¯çš„æ€»å¤§å°ä¸åº”è¶…è¿‡ <code>4MB</code> ã€‚</p>\n<h2 id=\"å‘é€æ‰¹é‡æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#å‘é€æ‰¹é‡æ¶ˆæ¯\">#</a> å‘é€æ‰¹é‡æ¶ˆæ¯</h2>\n<p>å¦‚æœæ‚¨æ¯æ¬¡åªå‘é€ä¸è¶…è¿‡ <code>4MB</code>  çš„æ¶ˆæ¯ï¼Œåˆ™å¾ˆå®¹æ˜“ä½¿ç”¨æ‰¹å¤„ç†ï¼Œæ ·ä¾‹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String topic = <span class=\"string\">&quot;BatchTest&quot;</span>;</span><br><span class=\"line\">List&lt;Message&gt; messages = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">messages.add(<span class=\"keyword\">new</span> Message(topic, <span class=\"string\">&quot;TagA&quot;</span>, <span class=\"string\">&quot;OrderID001&quot;</span>, <span class=\"string\">&quot;Hello world 0&quot;</span>.getBytes()));</span><br><span class=\"line\">messages.add(<span class=\"keyword\">new</span> Message(topic, <span class=\"string\">&quot;TagA&quot;</span>, <span class=\"string\">&quot;OrderID002&quot;</span>, <span class=\"string\">&quot;Hello world 1&quot;</span>.getBytes()));</span><br><span class=\"line\">messages.add(<span class=\"keyword\">new</span> Message(topic, <span class=\"string\">&quot;TagA&quot;</span>, <span class=\"string\">&quot;OrderID003&quot;</span>, <span class=\"string\">&quot;Hello world 2&quot;</span>.getBytes()));</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">   producer.send(messages);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">   e.printStackTrace();</span><br><span class=\"line\">   <span class=\"comment\">//å¤„ç†error</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²\">#</a> æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²</h2>\n<p>å¤æ‚åº¦åªæœ‰å½“ä½ å‘é€å¤§æ‰¹é‡æ—¶æ‰ä¼šå¢é•¿ï¼Œä½ å¯èƒ½ä¸ç¡®å®šå®ƒæ˜¯å¦è¶…è¿‡äº†å¤§å°é™åˆ¶ï¼ˆ <code>4MB</code> ï¼‰ã€‚è¿™æ—¶å€™ä½ æœ€å¥½æŠŠä½ çš„æ¶ˆæ¯åˆ—è¡¨åˆ†å‰²ä¸€ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ListSplitter</span> <span class=\"keyword\">implements</span> <span class=\"title\">Iterator</span>&lt;<span class=\"title\">List</span>&lt;<span class=\"title\">Message</span>&gt;&gt; </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> SIZE_LIMIT = <span class=\"number\">1024</span> * <span class=\"number\">1024</span> * <span class=\"number\">4</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;Message&gt; messages;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> currIndex;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ListSplitter</span><span class=\"params\">(List&lt;Message&gt; messages)</span> </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">this</span>.messages = messages;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">hasNext</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> currIndex &lt; messages.size(); </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span> <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Message&gt; <span class=\"title\">next</span><span class=\"params\">()</span> </span>&#123; </span><br><span class=\"line\">        <span class=\"keyword\">int</span> startIndex = getStartIndex();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> nextIndex = startIndex;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> totalSize = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (; nextIndex &lt; messages.size(); nextIndex++) &#123;</span><br><span class=\"line\">            Message message = messages.get(nextIndex); </span><br><span class=\"line\">            <span class=\"keyword\">int</span> tmpSize = calcMessageSize(message);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tmpSize + totalSize &gt; SIZE_LIMIT) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>; </span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                totalSize += tmpSize; </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        List&lt;Message&gt; subList = messages.subList(startIndex, nextIndex); </span><br><span class=\"line\">        currIndex = nextIndex;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> subList;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">getStartIndex</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Message currMessage = messages.get(currIndex); </span><br><span class=\"line\">        <span class=\"keyword\">int</span> tmpSize = calcMessageSize(currMessage); </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(tmpSize &gt; SIZE_LIMIT) &#123;</span><br><span class=\"line\">            currIndex += <span class=\"number\">1</span>;</span><br><span class=\"line\">            Message message = messages.get(curIndex); </span><br><span class=\"line\">            tmpSize = calcMessageSize(message);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> currIndex; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">calcMessageSize</span><span class=\"params\">(Message message)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> tmpSize = message.getTopic().length() + message.getBody().length(); </span><br><span class=\"line\">        Map&lt;String, String&gt; properties = message.getProperties();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;String, String&gt; entry : properties.entrySet()) &#123;</span><br><span class=\"line\">            tmpSize += entry.getKey().length() + entry.getValue().length(); </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        tmpSize = tmpSize + <span class=\"number\">20</span>; <span class=\"comment\">// å¢åŠ â½‡æ—¥å¿—çš„å¼€é”€20å­—èŠ‚</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> tmpSize; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//æŠŠå¤§çš„æ¶ˆæ¯åˆ†è£‚æˆè‹¥å¹²ä¸ªå°çš„æ¶ˆæ¯</span></span><br><span class=\"line\">ListSplitter splitter = <span class=\"keyword\">new</span> ListSplitter(messages);</span><br><span class=\"line\"><span class=\"keyword\">while</span> (splitter.hasNext()) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      List&lt;Message&gt;  listItem = splitter.next();</span><br><span class=\"line\">      producer.send(listItem);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">      e.printStackTrace();</span><br><span class=\"line\">      <span class=\"comment\">//å¤„ç†error</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-03.%E5%BB%B6%E6%97%B6%E6%B6%88%E6%81%AF/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/23/rocketMQ/1-04-03.%E5%BB%B6%E6%97%B6%E6%B6%88%E6%81%AF/",
            "title": "RocketMQæ ·ä¾‹:å»¶æ—¶æ¶ˆæ¯",
            "date_published": "2021-09-23T09:17:00.000Z",
            "content_html": "<h2 id=\"å¯åŠ¨æ¶ˆè´¹è€…ç­‰å¾…ä¼ å…¥è®¢é˜…æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨æ¶ˆè´¹è€…ç­‰å¾…ä¼ å…¥è®¢é˜…æ¶ˆæ¯\">#</a> å¯åŠ¨æ¶ˆè´¹è€…ç­‰å¾…ä¼ å…¥è®¢é˜…æ¶ˆæ¯</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.ConsumeConcurrentlyContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.ConsumeConcurrentlyStatus;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.MessageListenerConcurrently;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.MessageExt;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScheduledMessageConsumer</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// å®ä¾‹åŒ–æ¶ˆè´¹è€…</span></span><br><span class=\"line\">      DefaultMQPushConsumer consumer = <span class=\"keyword\">new</span> DefaultMQPushConsumer(<span class=\"string\">&quot;ExampleConsumer&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// è®¢é˜…Topics</span></span><br><span class=\"line\">      consumer.subscribe(<span class=\"string\">&quot;TestTopic&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// æ³¨å†Œæ¶ˆæ¯ç›‘å¬è€…</span></span><br><span class=\"line\">      consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</span><br><span class=\"line\">          <span class=\"meta\">@Override</span></span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; messages, ConsumeConcurrentlyContext context)</span> </span>&#123;</span><br><span class=\"line\">              <span class=\"keyword\">for</span> (MessageExt message : messages) &#123;</span><br><span class=\"line\">                  <span class=\"comment\">// Print approximate delay time period</span></span><br><span class=\"line\">                  System.out.println(<span class=\"string\">&quot;Receive message[msgId=&quot;</span> + message.getMsgId() + <span class=\"string\">&quot;] &quot;</span> + (System.currentTimeMillis() - message.getBornTimestamp()) + <span class=\"string\">&quot;ms later&quot;</span>);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      <span class=\"comment\">// å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class=\"line\">      consumer.start();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"å‘é€å»¶æ—¶æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#å‘é€å»¶æ—¶æ¶ˆæ¯\">#</a> å‘é€å»¶æ—¶æ¶ˆæ¯</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.producer.DefaultMQProducer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.Message;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScheduledMessageProducer</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// å®ä¾‹åŒ–ä¸€ä¸ªç”Ÿäº§è€…æ¥äº§ç”Ÿå»¶æ—¶æ¶ˆæ¯</span></span><br><span class=\"line\">      DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;ExampleProducerGroup&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">// å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class=\"line\">      producer.start();</span><br><span class=\"line\">      <span class=\"keyword\">int</span> totalMessagesToSend = <span class=\"number\">100</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; totalMessagesToSend; i++) &#123;</span><br><span class=\"line\">          Message message = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TestTopic&quot;</span>, (<span class=\"string\">&quot;Hello scheduled message &quot;</span> + i).getBytes());</span><br><span class=\"line\">          <span class=\"comment\">// è®¾ç½®å»¶æ—¶ç­‰çº§3,è¿™ä¸ªæ¶ˆæ¯å°†åœ¨10sä¹‹åå‘é€(ç°åœ¨åªæ”¯æŒå›ºå®šçš„å‡ ä¸ªæ—¶é—´,è¯¦çœ‹delayTimeLevel)</span></span><br><span class=\"line\">          message.setDelayTimeLevel(<span class=\"number\">3</span>);</span><br><span class=\"line\">          <span class=\"comment\">// å‘é€æ¶ˆæ¯</span></span><br><span class=\"line\">          producer.send(message);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">       <span class=\"comment\">// å…³é—­ç”Ÿäº§è€…</span></span><br><span class=\"line\">      producer.shutdown();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"éªŒè¯\"><a class=\"markdownIt-Anchor\" href=\"#éªŒè¯\">#</a> éªŒè¯</h2>\n<p>æ‚¨å°†ä¼šçœ‹åˆ°æ¶ˆæ¯çš„æ¶ˆè´¹æ¯”å­˜å‚¨æ—¶é—´æ™š <code>10</code>  ç§’ã€‚</p>\n<h2 id=\"å»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#å»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨åœºæ™¯\">#</a> å»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨åœºæ™¯</h2>\n<p>æ¯”å¦‚ç”µå•†é‡Œï¼Œæäº¤äº†ä¸€ä¸ªè®¢å•å°±å¯ä»¥å‘é€ä¸€ä¸ªå»¶æ—¶æ¶ˆæ¯ï¼Œ <code>1h</code>  åå»æ£€æŸ¥è¿™ä¸ªè®¢å•çš„çŠ¶æ€ï¼Œå¦‚æœè¿˜æ˜¯æœªä»˜æ¬¾å°±å–æ¶ˆè®¢å•é‡Šæ”¾åº“å­˜ã€‚</p>\n<h2 id=\"å»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨é™åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#å»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨é™åˆ¶\">#</a> å»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨é™åˆ¶</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// org/apache/rocketmq/store/config/MessageStoreConfig.java</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> String messageDelayLevel = <span class=\"string\">&quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;</span>;</span><br></pre></td></tr></table></figure>\n<p>ç°åœ¨ <code>RocketMq</code>  å¹¶ä¸æ”¯æŒä»»æ„æ—¶é—´çš„å»¶æ—¶ï¼Œéœ€è¦è®¾ç½®å‡ ä¸ªå›ºå®šçš„å»¶æ—¶ç­‰çº§ï¼Œä» <code>1s</code>  åˆ° <code>2h</code>  åˆ†åˆ«å¯¹åº”ç€ç­‰çº§ 1 åˆ° 18 æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ä¼šè¿›å…¥å»¶æ—¶æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯å‘é€æ—¶é—´ä¸è®¾ç½®çš„å»¶æ—¶ç­‰çº§å’Œé‡è¯•æ¬¡æ•°æœ‰å…³ï¼Œè¯¦è§ä»£ç  <code>SendMessageProcessor.java</code></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/06/rocketMQ/1-04-02.%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/06/rocketMQ/1-04-02.%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF/",
            "title": "RocketMQæ ·ä¾‹:å…¨å±€é¡ºåºæ¶ˆæ¯",
            "date_published": "2021-09-06T09:17:00.000Z",
            "content_html": "<p>æ¶ˆæ¯æœ‰åºæŒ‡çš„æ˜¯å¯ä»¥æŒ‰ç…§æ¶ˆæ¯çš„å‘é€é¡ºåºæ¥æ¶ˆè´¹ ( <code>FIFO</code> )ã€‚ <code>RocketMQ</code>  å¯ä»¥ä¸¥æ ¼çš„ä¿è¯æ¶ˆæ¯æœ‰åºï¼Œå¯ä»¥åˆ†ä¸ºåˆ†åŒºæœ‰åºæˆ–è€…å…¨å±€æœ‰åºã€‚</p>\n<p>é¡ºåºæ¶ˆè´¹çš„åŸç†è§£æï¼šåœ¨é»˜è®¤çš„æƒ…å†µä¸‹æ¶ˆæ¯å‘é€ä¼šé‡‡å– <code>Round Robin</code>  è½®è¯¢æ–¹å¼æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„ <code>queue</code>  (åˆ†åŒºé˜Ÿåˆ—)ï¼›è€Œæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ä»å¤šä¸ª <code>queue</code>  ä¸Šæ‹‰å–æ¶ˆæ¯ï¼Œè¿™ç§æƒ…å†µå‘é€å’Œæ¶ˆè´¹æ˜¯ä¸èƒ½ä¿è¯é¡ºåºã€‚ä½†æ˜¯å¦‚æœæ§åˆ¶å‘é€çš„é¡ºåºæ¶ˆæ¯åªä¾æ¬¡å‘é€åˆ°åŒä¸€ä¸ª <code>queue</code>  ä¸­ï¼Œæ¶ˆè´¹çš„æ—¶å€™åªä»è¿™ä¸ª <code>queue</code>  ä¸Šä¾æ¬¡æ‹‰å–ï¼Œåˆ™å°±ä¿è¯äº†é¡ºåºã€‚å½“å‘é€å’Œæ¶ˆè´¹å‚ä¸çš„ <code>queue</code>  åªæœ‰ä¸€ä¸ªï¼Œåˆ™æ˜¯å…¨å±€æœ‰åºï¼›å¦‚æœå¤šä¸ª <code>queue</code>  å‚ä¸ï¼Œåˆ™ä¸ºåˆ†åŒºæœ‰åºï¼Œå³ç›¸å¯¹æ¯ä¸ª <code>queue</code> ï¼Œæ¶ˆæ¯éƒ½æ˜¯æœ‰åºçš„ã€‚</p>\n<p>ä¸‹é¢ç”¨è®¢å•è¿›è¡Œåˆ†åŒºæœ‰åºçš„ç¤ºä¾‹ã€‚ä¸€ä¸ªè®¢å•çš„é¡ºåºæµç¨‹æ˜¯ï¼šåˆ›å»ºã€ä»˜æ¬¾ã€æ¨é€ã€å®Œæˆã€‚è®¢å•å·ç›¸åŒçš„æ¶ˆæ¯ä¼šè¢«å…ˆåå‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹æ—¶ï¼ŒåŒä¸€ä¸ª <code>OrderId</code>  è·å–åˆ°çš„è‚¯å®šæ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚</p>\n<p>2.1 é¡ºåºæ¶ˆæ¯ç”Ÿäº§</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.apache.rocketmq.example.order2;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.producer.DefaultMQProducer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.producer.MessageQueueSelector;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.producer.SendResult;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.MessageQueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* Producerï¼Œå‘é€é¡ºåºæ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Producer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">       DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">       producer.setNamesrvAddr(<span class=\"string\">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">       producer.start();</span><br><span class=\"line\"></span><br><span class=\"line\">       String[] tags = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;TagA&quot;</span>, <span class=\"string\">&quot;TagC&quot;</span>, <span class=\"string\">&quot;TagD&quot;</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// è®¢å•åˆ—è¡¨</span></span><br><span class=\"line\">       List&lt;OrderStep&gt; orderList = <span class=\"keyword\">new</span> Producer().buildOrders();</span><br><span class=\"line\"></span><br><span class=\"line\">       Date date = <span class=\"keyword\">new</span> Date();</span><br><span class=\"line\">       SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class=\"line\">       String dateStr = sdf.format(date);</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">           <span class=\"comment\">// åŠ ä¸ªæ—¶é—´å‰ç¼€</span></span><br><span class=\"line\">           String body = dateStr + <span class=\"string\">&quot; Hello RocketMQ &quot;</span> + orderList.get(i);</span><br><span class=\"line\">           Message msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span>, tags[i % tags.length], <span class=\"string\">&quot;KEY&quot;</span> + i, body.getBytes());</span><br><span class=\"line\"></span><br><span class=\"line\">           SendResult sendResult = producer.send(msg, <span class=\"keyword\">new</span> MessageQueueSelector() &#123;</span><br><span class=\"line\">               <span class=\"meta\">@Override</span></span><br><span class=\"line\">               <span class=\"function\"><span class=\"keyword\">public</span> MessageQueue <span class=\"title\">select</span><span class=\"params\">(List&lt;MessageQueue&gt; mqs, Message msg, Object arg)</span> </span>&#123;</span><br><span class=\"line\">                   Long id = (Long) arg;  <span class=\"comment\">//æ ¹æ®è®¢å•idé€‰æ‹©å‘é€queue</span></span><br><span class=\"line\">                   <span class=\"keyword\">long</span> index = id % mqs.size();</span><br><span class=\"line\">                   <span class=\"keyword\">return</span> mqs.get((<span class=\"keyword\">int</span>) index);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;, orderList.get(i).getOrderId());<span class=\"comment\">//è®¢å•id</span></span><br><span class=\"line\"></span><br><span class=\"line\">           System.out.println(String.format(<span class=\"string\">&quot;SendResult status:%s, queueId:%d, body:%s&quot;</span>,</span><br><span class=\"line\">               sendResult.getSendStatus(),</span><br><span class=\"line\">               sendResult.getMessageQueue().getQueueId(),</span><br><span class=\"line\">               body));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       producer.shutdown();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * è®¢å•çš„æ­¥éª¤</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderStep</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> orderId;</span><br><span class=\"line\">       <span class=\"keyword\">private</span> String desc;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getOrderId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> orderId;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setOrderId</span><span class=\"params\">(<span class=\"keyword\">long</span> orderId)</span> </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">this</span>.orderId = orderId;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getDesc</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> desc;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setDesc</span><span class=\"params\">(String desc)</span> </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">this</span>.desc = desc;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Override</span></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"string\">&quot;OrderStep&#123;&quot;</span> +</span><br><span class=\"line\">               <span class=\"string\">&quot;orderId=&quot;</span> + orderId +</span><br><span class=\"line\">               <span class=\"string\">&quot;, desc=&#x27;&quot;</span> + desc + <span class=\"string\">&#x27;\\&#x27;&#x27;</span> +</span><br><span class=\"line\">               <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * ç”Ÿæˆæ¨¡æ‹Ÿè®¢å•æ•°æ®</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">private</span> List&lt;OrderStep&gt; <span class=\"title\">buildOrders</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">       List&lt;OrderStep&gt; orderList = <span class=\"keyword\">new</span> ArrayList&lt;OrderStep&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">       OrderStep orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103111039L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;åˆ›å»º&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103111065L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;åˆ›å»º&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103111039L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;ä»˜æ¬¾&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103117235L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;åˆ›å»º&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103111065L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;ä»˜æ¬¾&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103117235L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;ä»˜æ¬¾&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103111065L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;å®Œæˆ&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103111039L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;æ¨é€&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103117235L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;å®Œæˆ&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       orderDemo = <span class=\"keyword\">new</span> OrderStep();</span><br><span class=\"line\">       orderDemo.setOrderId(<span class=\"number\">15103111039L</span>);</span><br><span class=\"line\">       orderDemo.setDesc(<span class=\"string\">&quot;å®Œæˆ&quot;</span>);</span><br><span class=\"line\">       orderList.add(orderDemo);</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">return</span> orderList;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2.2 é¡ºåºæ¶ˆè´¹æ¶ˆæ¯</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.apache.rocketmq.example.order2;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.ConsumeOrderlyContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.ConsumeOrderlyStatus;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.listener.MessageListenerOrderly;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.consumer.ConsumeFromWhere;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.MessageExt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* é¡ºåºæ¶ˆæ¯æ¶ˆè´¹ï¼Œå¸¦äº‹åŠ¡æ–¹å¼ï¼ˆåº”ç”¨å¯æ§åˆ¶Offsetä»€ä¹ˆæ—¶å€™æäº¤ï¼‰</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsumerInOrder</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">       DefaultMQPushConsumer consumer = <span class=\"keyword\">new</span> DefaultMQPushConsumer(<span class=\"string\">&quot;please_rename_unique_group_name_3&quot;</span>);</span><br><span class=\"line\">       consumer.setNamesrvAddr(<span class=\"string\">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * è®¾ç½®Consumerç¬¬ä¸€æ¬¡å¯åŠ¨æ˜¯ä»é˜Ÿåˆ—å¤´éƒ¨å¼€å§‹æ¶ˆè´¹è¿˜æ˜¯é˜Ÿåˆ—å°¾éƒ¨å¼€å§‹æ¶ˆè´¹&lt;br&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        * å¦‚æœéç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šæ¬¡æ¶ˆè´¹çš„ä½ç½®ç»§ç»­æ¶ˆè´¹</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">       consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);</span><br><span class=\"line\"></span><br><span class=\"line\">       consumer.subscribe(<span class=\"string\">&quot;TopicTest&quot;</span>, <span class=\"string\">&quot;TagA || TagC || TagD&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">       consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerOrderly() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">           Random random = <span class=\"keyword\">new</span> Random();</span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"meta\">@Override</span></span><br><span class=\"line\">           <span class=\"function\"><span class=\"keyword\">public</span> ConsumeOrderlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs, ConsumeOrderlyContext context)</span> </span>&#123;</span><br><span class=\"line\">               context.setAutoCommit(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">               <span class=\"keyword\">for</span> (MessageExt msg : msgs) &#123;</span><br><span class=\"line\">                   <span class=\"comment\">// å¯ä»¥çœ‹åˆ°æ¯ä¸ªqueueæœ‰å”¯ä¸€çš„consumeçº¿ç¨‹æ¥æ¶ˆè´¹, è®¢å•å¯¹æ¯ä¸ªqueue(åˆ†åŒº)æœ‰åº</span></span><br><span class=\"line\">                   System.out.println(<span class=\"string\">&quot;consumeThread=&quot;</span> + Thread.currentThread().getName() + <span class=\"string\">&quot;queueId=&quot;</span> + msg.getQueueId() + <span class=\"string\">&quot;, content:&quot;</span> + <span class=\"keyword\">new</span> String(msg.getBody()));</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">               <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                   <span class=\"comment\">//æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘å¤„ç†ä¸­...</span></span><br><span class=\"line\">                   TimeUnit.SECONDS.sleep(random.nextInt(<span class=\"number\">10</span>));</span><br><span class=\"line\">               &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                   e.printStackTrace();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">return</span> ConsumeOrderlyStatus.SUCCESS;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">       consumer.start();</span><br><span class=\"line\"></span><br><span class=\"line\">       System.out.println(<span class=\"string\">&quot;Consumer Started.&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/04/rocketMQ/1-04-01.%E5%9F%BA%E6%9C%AC%E6%A0%B7%E4%BE%8B/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/04/rocketMQ/1-04-01.%E5%9F%BA%E6%9C%AC%E6%A0%B7%E4%BE%8B/",
            "title": "RocketMQæ ·ä¾‹:åŸºæœ¬çš„æ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹",
            "date_published": "2021-09-04T09:17:00.000Z",
            "content_html": "<p>é¦–å…ˆæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸ªç®€å•çš„æ¶ˆè´¹ç”Ÿäº§å’Œæ¶ˆè´¹çš„ <code>demo</code> .</p>\n<h2 id=\"ç”Ÿäº§æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§æ¶ˆæ¯\">#</a> ç”Ÿäº§æ¶ˆæ¯</h2>\n<p><code>RocketMQ</code> ï¼Œ ç»™æˆ‘ä»¬æä¾›äº†ä¸‰ç§ç®€å•çš„æ¶ˆæ¯ç”Ÿäº§æ–¹å¼ï¼Œ <code>1.åŒæ­¥å‘é€</code> ï¼Œ  <code>2.å¼‚æ­¥å‘é€</code> ï¼Œ  <code>3.ç›´æ¥å‘é€ï¼Œä¸å…³å¿ƒå‘é€ç»“æœ</code> ã€‚</p>\n<p>è¿™ä¸‰ç§æ–¹å¼ï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ç§ä¸åŒçš„åº”ç”¨åœºæ™¯</p>\n<h3 id=\"åŒæ­¥å‘é€\"><a class=\"markdownIt-Anchor\" href=\"#åŒæ­¥å‘é€\">#</a> åŒæ­¥å‘é€</h3>\n<p>è¿™ç§å¯é æ€§åŒæ­¥åœ°å‘é€æ–¹å¼ä½¿ç”¨çš„æ¯”è¾ƒå¹¿æ³›ï¼Œæ¯”å¦‚ï¼šé‡è¦çš„æ¶ˆæ¯é€šçŸ¥ï¼ŒçŸ­ä¿¡é€šçŸ¥ã€‚è¿™ç§å‘é€æ–¹å¼ï¼Œåœ¨å‘é€æˆåŠŸä¹‹åï¼Œæ‰ä¼šè¿”å›ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æŠ›å‡ºå¼‚å¸¸ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SyncProducer</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    \t<span class=\"comment\">// å®ä¾‹åŒ–æ¶ˆæ¯ç”Ÿäº§è€…Producer</span></span><br><span class=\"line\">        DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// è®¾ç½®NameServerçš„åœ°å€</span></span><br><span class=\"line\">    \tproducer.setNamesrvAddr(<span class=\"string\">&quot;192.168.1.65:9876&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// å¯åŠ¨Producerå®ä¾‹</span></span><br><span class=\"line\">        producer.start();</span><br><span class=\"line\">    \t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">    \t    <span class=\"comment\">// åˆ›å»ºæ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šTopicï¼ŒTagå’Œæ¶ˆæ¯ä½“</span></span><br><span class=\"line\">    \t    Message msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span> <span class=\"comment\">/* Topic */</span>,</span><br><span class=\"line\">        \t<span class=\"string\">&quot;TagA&quot;</span> <span class=\"comment\">/* Tag */</span>,</span><br><span class=\"line\">        \t(<span class=\"string\">&quot;Hello RocketMQ &quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET) <span class=\"comment\">/* Message body */</span></span><br><span class=\"line\">        \t);</span><br><span class=\"line\">        \t<span class=\"comment\">// å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªBroker</span></span><br><span class=\"line\">            SendResult sendResult = producer.send(msg);</span><br><span class=\"line\">            <span class=\"comment\">// é€šè¿‡sendResultè¿”å›æ¶ˆæ¯æ˜¯å¦æˆåŠŸé€è¾¾</span></span><br><span class=\"line\">            System.out.printf(<span class=\"string\">&quot;%s%n&quot;</span>, sendResult);</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    \t<span class=\"comment\">// å¦‚æœä¸å†å‘é€æ¶ˆæ¯ï¼Œå…³é—­Producerå®ä¾‹ã€‚</span></span><br><span class=\"line\">    \tproducer.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¼‚æ­¥å‘é€\"><a class=\"markdownIt-Anchor\" href=\"#å¼‚æ­¥å‘é€\">#</a> å¼‚æ­¥å‘é€</h3>\n<p>å¼‚æ­¥æ¶ˆæ¯é€šå¸¸ç”¨åœ¨å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ï¼Œå³å‘é€ç«¯ä¸èƒ½å®¹å¿é•¿æ—¶é—´åœ°ç­‰å¾… <code>Broker</code>  çš„å“åº”ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AsyncProducer</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    \t<span class=\"comment\">// å®ä¾‹åŒ–æ¶ˆæ¯ç”Ÿäº§è€…Producer</span></span><br><span class=\"line\">        DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// è®¾ç½®NameServerçš„åœ°å€</span></span><br><span class=\"line\">        producer.setNamesrvAddr(<span class=\"string\">&quot;192.168.1.65:9876&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// å¯åŠ¨Producerå®ä¾‹</span></span><br><span class=\"line\">        producer.start();</span><br><span class=\"line\">        producer.setRetryTimesWhenSendAsyncFailed(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> messageCount = <span class=\"number\">100</span>;</span><br><span class=\"line\">        <span class=\"comment\">// æ ¹æ®æ¶ˆæ¯æ•°é‡å®ä¾‹åŒ–å€’è®¡æ—¶è®¡ç®—å™¨</span></span><br><span class=\"line\">\t<span class=\"keyword\">final</span> CountDownLatch2 countDownLatch = <span class=\"keyword\">new</span> CountDownLatch2(messageCount);</span><br><span class=\"line\">    \t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; messageCount; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> index = i;</span><br><span class=\"line\">            \t<span class=\"comment\">// åˆ›å»ºæ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šTopicï¼ŒTagå’Œæ¶ˆæ¯ä½“</span></span><br><span class=\"line\">                Message msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;TagA&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;OrderID188&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Hello world&quot;</span>.getBytes(RemotingHelper.DEFAULT_CHARSET));</span><br><span class=\"line\">                <span class=\"comment\">// SendCallbackæ¥æ”¶å¼‚æ­¥è¿”å›ç»“æœçš„å›è°ƒ</span></span><br><span class=\"line\">                producer.send(msg, <span class=\"keyword\">new</span> SendCallback() &#123;</span><br><span class=\"line\">                    <span class=\"meta\">@Override</span></span><br><span class=\"line\">                    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onSuccess</span><span class=\"params\">(SendResult sendResult)</span> </span>&#123;</span><br><span class=\"line\">                        System.out.printf(<span class=\"string\">&quot;%-10d OK %s %n&quot;</span>, index,</span><br><span class=\"line\">                            sendResult.getMsgId());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"meta\">@Override</span></span><br><span class=\"line\">                    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onException</span><span class=\"params\">(Throwable e)</span> </span>&#123;</span><br><span class=\"line\">      \t              System.out.printf(<span class=\"string\">&quot;%-10d Exception %s %n&quot;</span>, index, e);</span><br><span class=\"line\">      \t              e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">            \t&#125;);</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// ç­‰å¾…5s</span></span><br><span class=\"line\">\tcountDownLatch.await(<span class=\"number\">5</span>, TimeUnit.SECONDS);</span><br><span class=\"line\">    \t<span class=\"comment\">// å¦‚æœä¸å†å‘é€æ¶ˆæ¯ï¼Œå…³é—­Producerå®ä¾‹ã€‚</span></span><br><span class=\"line\">    \tproducer.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å•å‘å‘é€æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#å•å‘å‘é€æ¶ˆæ¯\">#</a> å•å‘å‘é€æ¶ˆæ¯</h3>\n<p>è¿™ç§æ–¹å¼ä¸»è¦ç”¨åœ¨ä¸ç‰¹åˆ«å…³å¿ƒå‘é€ç»“æœçš„åœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—å‘é€ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OnewayProducer</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception</span>&#123;</span><br><span class=\"line\">    \t<span class=\"comment\">// å®ä¾‹åŒ–æ¶ˆæ¯ç”Ÿäº§è€…Producer</span></span><br><span class=\"line\">        DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// è®¾ç½®NameServerçš„åœ°å€</span></span><br><span class=\"line\">        producer.setNamesrvAddr(<span class=\"string\">&quot;192.168.1.65:9876&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// å¯åŠ¨Producerå®ä¾‹</span></span><br><span class=\"line\">        producer.start();</span><br><span class=\"line\">    \t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">        \t<span class=\"comment\">// åˆ›å»ºæ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šTopicï¼ŒTagå’Œæ¶ˆæ¯ä½“</span></span><br><span class=\"line\">        \tMessage msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span> <span class=\"comment\">/* Topic */</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;TagA&quot;</span> <span class=\"comment\">/* Tag */</span>,</span><br><span class=\"line\">                (<span class=\"string\">&quot;Hello RocketMQ &quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET) <span class=\"comment\">/* Message body */</span></span><br><span class=\"line\">        \t);</span><br><span class=\"line\">        \t<span class=\"comment\">// å‘é€å•å‘æ¶ˆæ¯ï¼Œæ²¡æœ‰ä»»ä½•è¿”å›ç»“æœ</span></span><br><span class=\"line\">        \tproducer.sendOneway(msg);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    \t<span class=\"comment\">// å¦‚æœä¸å†å‘é€æ¶ˆæ¯ï¼Œå…³é—­Producerå®ä¾‹ã€‚</span></span><br><span class=\"line\">    \tproducer.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¶ˆæ¯æ¶ˆè´¹\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯æ¶ˆè´¹\">#</a> æ¶ˆæ¯æ¶ˆè´¹</h2>\n<h3 id=\"push-æ¨¡å¼-æ¶ˆè´¹\"><a class=\"markdownIt-Anchor\" href=\"#push-æ¨¡å¼-æ¶ˆè´¹\">#</a> Push æ¨¡å¼ æ¶ˆè´¹</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Consumer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, MQClientException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"comment\">// å®ä¾‹åŒ–æ¶ˆè´¹è€…</span></span><br><span class=\"line\">        DefaultMQPushConsumer consumer = <span class=\"keyword\">new</span> DefaultMQPushConsumer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"comment\">// è®¾ç½®NameServerçš„åœ°å€</span></span><br><span class=\"line\">        consumer.setNamesrvAddr(<span class=\"string\">&quot;192.168.1.65:9876&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"comment\">// è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªTopicï¼Œä»¥åŠTagæ¥è¿‡æ»¤éœ€è¦æ¶ˆè´¹çš„æ¶ˆæ¯</span></span><br><span class=\"line\">        consumer.subscribe(<span class=\"string\">&quot;TopicTest&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// æ³¨å†Œå›è°ƒå®ç°ç±»æ¥å¤„ç†ä»brokeræ‹‰å–å›æ¥çš„æ¶ˆæ¯</span></span><br><span class=\"line\">        consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> </span>&#123;</span><br><span class=\"line\">                System.out.printf(<span class=\"string\">&quot;%s Receive New Messages: %s %n&quot;</span>, Thread.currentThread().getName(), msgs);</span><br><span class=\"line\">                <span class=\"comment\">// æ ‡è®°è¯¥æ¶ˆæ¯å·²ç»è¢«æˆåŠŸæ¶ˆè´¹</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">// å¯åŠ¨æ¶ˆè´¹è€…å®ä¾‹</span></span><br><span class=\"line\">        consumer.start();</span><br><span class=\"line\">        System.out.printf(<span class=\"string\">&quot;Consumer Started.%n&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"pull-æ¨¡å¼æ¶ˆè´¹-assign\"><a class=\"markdownIt-Anchor\" href=\"#pull-æ¨¡å¼æ¶ˆè´¹-assign\">#</a> Pull æ¨¡å¼æ¶ˆè´¹ - Assign</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.DefaultLitePullConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.MessageExt;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.MessageQueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LitePullConsumerAssign</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">boolean</span> running = <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// åˆ›å»º LitePullConsumer å®ä¾‹</span></span><br><span class=\"line\">        DefaultLitePullConsumer litePullConsumer = <span class=\"keyword\">new</span> DefaultLitePullConsumer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// ä¸è‡ªåŠ¨æäº¤ æ¶ˆæ¯æ¶ˆè´¹çš„åç§»é‡</span></span><br><span class=\"line\">        litePullConsumer.setAutoCommit(<span class=\"keyword\">false</span>);</span><br><span class=\"line\">        <span class=\"comment\">// å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class=\"line\">        litePullConsumer.start();</span><br><span class=\"line\">        <span class=\"comment\">// æ‹‰å–topicTestçš„MessageQueueåˆ—è¡¨</span></span><br><span class=\"line\">        Collection&lt;MessageQueue&gt; mqSet = litePullConsumer.fetchMessageQueues(<span class=\"string\">&quot;TopicTest&quot;</span>);</span><br><span class=\"line\">        List&lt;MessageQueue&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(mqSet);</span><br><span class=\"line\">        List&lt;MessageQueue&gt; assignList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; list.size() / <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">            assignList.add(list.get(i));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// æœ¬æ¶ˆè´¹åˆ†é…çš„ MessageQueue åˆ—è¡¨ã€‚æœ¬æ¶ˆè´¹è€…åªä¼šæ¶ˆè´¹assignListä¸­çš„æ¶ˆæ¯</span></span><br><span class=\"line\">        litePullConsumer.assign(assignList);</span><br><span class=\"line\">        <span class=\"comment\">// æ”¹å˜ä¸‹ä¸€æ¬¡æ‹‰å–æ—¶ï¼Œæ¶ˆæ¯çš„åç§»é‡ã€‚</span></span><br><span class=\"line\">        litePullConsumer.seek(assignList.get(<span class=\"number\">0</span>), <span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (running) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// æ¶ˆæ¯æ‹‰å– APIï¼Œé»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 5sã€‚</span></span><br><span class=\"line\">                List&lt;MessageExt&gt; messageExts = litePullConsumer.poll();</span><br><span class=\"line\">                System.out.printf(<span class=\"string\">&quot;%s %n&quot;</span>, messageExts);</span><br><span class=\"line\">                <span class=\"comment\">// æäº¤åç§»é‡</span></span><br><span class=\"line\">                litePullConsumer.commitSync();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            litePullConsumer.shutdown();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"pull-æ¨¡å¼æ¶ˆè´¹-subcribe\"><a class=\"markdownIt-Anchor\" href=\"#pull-æ¨¡å¼æ¶ˆè´¹-subcribe\">#</a> Pull æ¨¡å¼æ¶ˆè´¹ - SUBCRIBE</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.consumer.DefaultLitePullConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.consumer.ConsumeFromWhere;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.common.message.MessageExt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LitePullConsumerSubscribe</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">boolean</span> running = <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        DefaultLitePullConsumer litePullConsumer = <span class=\"keyword\">new</span> DefaultLitePullConsumer(<span class=\"string\">&quot;lite_pull_consumer_test&quot;</span>);</span><br><span class=\"line\">        litePullConsumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET);</span><br><span class=\"line\">        litePullConsumer.subscribe(<span class=\"string\">&quot;TopicTest&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">        litePullConsumer.start();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (running) &#123;</span><br><span class=\"line\">                List&lt;MessageExt&gt; messageExts = litePullConsumer.poll();</span><br><span class=\"line\">                System.out.printf(<span class=\"string\">&quot;%s%n&quot;</span>, messageExts);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            litePullConsumer.shutdown();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"https://fangjiaxiaobai.github.io/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/04/rocketMQ/1-04-00.RocketMQ%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/04/rocketMQ/1-04-00.RocketMQ%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/",
            "title": "RocketMQç³»åˆ—-åœ¨Javaåº”ç”¨ä¸­çš„ä½¿ç”¨",
            "date_published": "2021-09-04T09:14:00.000Z",
            "content_html": "<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æˆåŠŸåœ°æ­å»ºäº†å‡ ç§ RocketMQ çš„éƒ¨ç½²æ–¹å¼ã€‚<br>\nè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ RocketMQ æ‰€æ”¯æŒçš„æ¶ˆæ¯ç±»å‹åœ¨ Java åº”ç”¨ä¸­çš„ä½¿ç”¨ã€‚</p>\n<h2 id=\"åŠ å…¥ä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#åŠ å…¥ä¾èµ–\">#</a> åŠ å…¥ä¾èµ–</h2>\n<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡ RocketMQ è¿›è¡Œæ”¶å‘æ¶ˆæ¯äº†ã€‚è¿™ä¸€ç¯‡å‘¢ï¼Œæˆ‘ä»å¤´å¼€å§‹æ¥å­¦ä¹ ä½¿ç”¨ RocketMQ.</p>\n<p>é¦–å…ˆï¼Œå¼•å…¥ Maven ä¾èµ–ï¼Œ</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.rocketmq<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>rocketmq-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>å¦‚æœä½ ä½¿ç”¨ <code>gradle</code> ï¼Œ åˆ™ä½¿ç”¨  <code>compile 'org.apache.rocketmq:rocketmq-client:4.9.1'</code>  å³å¯ã€‚</p>\n<h2 id=\"æ¶ˆæ¯ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯ç±»å‹\">#</a> æ¶ˆæ¯ç±»å‹</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> <a href=\"./1-04-01.%E5%9F%BA%E6%9C%AC%E6%A0%B7%E4%BE%8B.md\">åŸºæœ¬æ ·ä¾‹ - åŸºæœ¬çš„æ¶ˆæ¯æ”¶å‘æ¡ˆä¾‹</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> <a href=\"./1-04-02.%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF.md\">é¡ºåºæ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> <a href=\"./1-04-03.%E5%BB%B6%E6%97%B6%E6%B6%88%E6%81%AF.md\">å»¶æ—¶æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" checked=\"true\" disabled=\"true\"><label for=\"cbx_3\"> <a href=\"./1-04-04.%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF.md\">æ‰¹é‡æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> <a href=\"./1-04-05.%E8%BF%87%E6%BB%A4%E6%B6%88%E6%81%AF.md\">è¿‡æ»¤æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\"><label for=\"cbx_5\"> <a href=\"./1-04-06.%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF.md\">äº‹åŠ¡æ¶ˆæ¯</a></label></li>\n</ul>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"./images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/03/rocketMQ/1-03-RocketMQ%E6%90%AD%E5%BB%BA/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/03/rocketMQ/1-03-RocketMQ%E6%90%AD%E5%BB%BA/",
            "title": "RocketMQç³»åˆ—-æ­å»ºRocketMQé›†ç¾¤",
            "date_published": "2021-09-03T09:17:00.000Z",
            "content_html": "<h1 id=\"æ­å»ºrocketmqé›†ç¾¤\"><a class=\"markdownIt-Anchor\" href=\"#æ­å»ºrocketmqé›†ç¾¤\">#</a> æ­å»º RocketMQ é›†ç¾¤</h1>\n<p>æ ¹æ®ä¹‹å‰çš„äº†è§£ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº† RocketMQ å¯ä»¥å•æœºéƒ¨ç½²ï¼Œæ”¯æŒé›†ç¾¤éƒ¨ç½²ã€‚</p>\n<p>RocketMQ æ”¯æŒä»¥ä¸‹é›†ä¸­éƒ¨ç½²æ–¹å¼  <code>1.å•Masteræ¨¡å¼éƒ¨ç½²</code> ï¼Œ <code>2.å¤šMasteræ¨¡å¼éƒ¨ç½²</code> ï¼Œ <code>3.å¤šMasterå¤šSlaveræ¨¡å¼éƒ¨ç½²</code></p>\n<h2 id=\"å•masteræ¨¡å¼\"><a class=\"markdownIt-Anchor\" href=\"#å•masteræ¨¡å¼\">#</a> å• Master æ¨¡å¼</h2>\n<p>è¿™ç§æ–¹å¼é£é™©è¾ƒå¤§ï¼Œä¸€æ—¦ Broker é‡å¯æˆ–è€…å®•æœºæ—¶ï¼Œä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ã€‚ä¸å»ºè®®çº¿ä¸Šç¯å¢ƒä½¿ç”¨ï¼Œå¯ä»¥ç”¨äºæœ¬åœ°æµ‹è¯•ã€‚</p>\n<h3 id=\"å¯åŠ¨-nameserver\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨-nameserver\">#</a> å¯åŠ¨ NameServer</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### é¦–å…ˆå¯åŠ¨Name Server</span></span><br><span class=\"line\">$ nohup sh mqnamesrv &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">$ tail -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class=\"line\">The Name Server boot success...</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯åŠ¨-broker\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨-broker\">#</a> å¯åŠ¨ Broker</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### å¯åŠ¨Broker</span></span><br><span class=\"line\">$ nohup sh bin/mqbroker -n localhost:9876 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œä¾‹å¦‚Brokerçš„IPä¸ºï¼š192.168.1.2ï¼Œä¸”åç§°ä¸ºbroker-a</span></span><br><span class=\"line\">$ tail -f ~/logs/rocketmqlogs/broker.log </span><br><span class=\"line\">The broker[broker-a, 192.169.1.2:10911] boot success...</span><br></pre></td></tr></table></figure>\n<h3 id=\"éªŒè¯\"><a class=\"markdownIt-Anchor\" href=\"#éªŒè¯\">#</a> éªŒè¯</h3>\n<p>æˆ‘ä»¬ä½¿ç”¨ Java ç¨‹åºæ¥ç®€å•çš„éªŒè¯ä¸‹æ¶ˆæ¯çš„å‘é€å’Œæ¶ˆè´¹ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡å»ä½¿ç”¨ RocketMQ.</p>\n<h4 id=\"åŠ å…¥mavenä¾èµ–\"><a class=\"markdownIt-Anchor\" href=\"#åŠ å…¥mavenä¾èµ–\">#</a> åŠ å…¥ maven ä¾èµ–</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.rocketmq<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>rocketmq-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"ç”Ÿäº§æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§æ¶ˆæ¯\">#</a> ç”Ÿäº§æ¶ˆæ¯</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Producer</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    \t<span class=\"comment\">// å®ä¾‹åŒ–æ¶ˆæ¯ç”Ÿäº§è€…Producer</span></span><br><span class=\"line\">        DefaultMQProducer producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// è®¾ç½®NameServerçš„åœ°å€</span></span><br><span class=\"line\">    \tproducer.setNamesrvAddr(<span class=\"string\">&quot;localhost:9876&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// å¯åŠ¨Producerå®ä¾‹</span></span><br><span class=\"line\">        producer.start();</span><br><span class=\"line\">    \t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">    \t    <span class=\"comment\">// åˆ›å»ºæ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šTopicï¼ŒTagå’Œæ¶ˆæ¯ä½“</span></span><br><span class=\"line\">    \t    Message msg = <span class=\"keyword\">new</span> Message(<span class=\"string\">&quot;TopicTest&quot;</span> <span class=\"comment\">/* Topic */</span>,</span><br><span class=\"line\">        \t<span class=\"string\">&quot;TagA&quot;</span> <span class=\"comment\">/* Tag */</span>,</span><br><span class=\"line\">        \t(<span class=\"string\">&quot;Hello RocketMQ &quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET) <span class=\"comment\">/* Message body */</span></span><br><span class=\"line\">        \t);</span><br><span class=\"line\">        \t<span class=\"comment\">// å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªBroker</span></span><br><span class=\"line\">            SendResult sendResult = producer.send(msg);</span><br><span class=\"line\">            <span class=\"comment\">// é€šè¿‡sendResultè¿”å›æ¶ˆæ¯æ˜¯å¦æˆåŠŸé€è¾¾</span></span><br><span class=\"line\">            System.out.printf(<span class=\"string\">&quot;%s%n&quot;</span>, sendResult);</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    \t<span class=\"comment\">// å¦‚æœä¸å†å‘é€æ¶ˆæ¯ï¼Œå…³é—­Producerå®ä¾‹ã€‚</span></span><br><span class=\"line\">    \tproducer.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ¶ˆè´¹æ¶ˆæ¯\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹æ¶ˆæ¯\">#</a> æ¶ˆè´¹æ¶ˆæ¯</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Consumer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException, MQClientException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"comment\">// å®ä¾‹åŒ–æ¶ˆè´¹è€…</span></span><br><span class=\"line\">        DefaultMQPushConsumer consumer = <span class=\"keyword\">new</span> DefaultMQPushConsumer(<span class=\"string\">&quot;please_rename_unique_group_name&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"comment\">// è®¾ç½®NameServerçš„åœ°å€</span></span><br><span class=\"line\">        consumer.setNamesrvAddr(<span class=\"string\">&quot;localhost:9876&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"comment\">// è®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªTopicï¼Œä»¥åŠTagæ¥è¿‡æ»¤éœ€è¦æ¶ˆè´¹çš„æ¶ˆæ¯</span></span><br><span class=\"line\">        consumer.subscribe(<span class=\"string\">&quot;TopicTest&quot;</span>, <span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">    \t<span class=\"comment\">// æ³¨å†Œå›è°ƒå®ç°ç±»æ¥å¤„ç†ä»brokeræ‹‰å–å›æ¥çš„æ¶ˆæ¯</span></span><br><span class=\"line\">        consumer.registerMessageListener(<span class=\"keyword\">new</span> MessageListenerConcurrently() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> ConsumeConcurrentlyStatus <span class=\"title\">consumeMessage</span><span class=\"params\">(List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> </span>&#123;</span><br><span class=\"line\">                System.out.printf(<span class=\"string\">&quot;%s Receive New Messages: %s %n&quot;</span>, Thread.currentThread().getName(), msgs);</span><br><span class=\"line\">                <span class=\"comment\">// æ ‡è®°è¯¥æ¶ˆæ¯å·²ç»è¢«æˆåŠŸæ¶ˆè´¹</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">// å¯åŠ¨æ¶ˆè´¹è€…å®ä¾‹</span></span><br><span class=\"line\">        consumer.start();</span><br><span class=\"line\">        System.out.printf(<span class=\"string\">&quot;Consumer Started.%n&quot;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>é‡åˆ°çš„é—®é¢˜:</p>\n</blockquote>\n<p>æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼Œä½ è¿è¡ŒæˆåŠŸäº†å—ï¼Ÿï¼Ÿï¼Ÿ</p>\n<p>æˆ‘åæ­£æ˜¯æ²¡æœ‰æˆåŠŸçš„ç”Ÿäº§æ¶ˆæ¯ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzEuTm8=\">1.No</span> route info of this topic, TopicTest</p>\n</blockquote>\n<p>åŸå› æ˜¯ï¼šæˆ‘ä»¬åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰åˆ›å»º  <code>TopicTest</code>  è¿™ä¸ª Topic.</p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exception <span class=\"keyword\">in</span> thread &quot;main&quot; org.apache.rocketmq.client.exception.MQClientException: No route info of this topic, TopicTest</span><br><span class=\"line\">See http://rocketmq.apache.org/docs/faq/ <span class=\"keyword\">for</span> further details.</span><br><span class=\"line\">\t<span class=\"built_in\">at</span> org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.sendDefaultImpl(DefaultMQProducerImpl.java:<span class=\"number\">610</span>)</span><br><span class=\"line\">\t<span class=\"built_in\">at</span> org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:<span class=\"number\">1223</span>)</span><br><span class=\"line\">\t<span class=\"built_in\">at</span> org.apache.rocketmq.client.impl.producer.DefaultMQProducerImpl.send(DefaultMQProducerImpl.java:<span class=\"number\">1173</span>)</span><br><span class=\"line\">\t<span class=\"built_in\">at</span> org.apache.rocketmq.client.producer.DefaultMQProducer.send(DefaultMQProducer.java:<span class=\"number\">214</span>)</span><br><span class=\"line\">\t<span class=\"built_in\">at</span> com.fxb.learn_rocketmq.Producer.main(Producer.java:<span class=\"number\">23</span>)</span><br></pre></td></tr></table></figure>\n<p>è¿™ç§é—®é¢˜çš„åŸå› ä¸¤ç§ã€‚ 1. ç½‘ç»œä¸é€šï¼Œè¿æ¥ä¸åˆ°ç«¯å£ã€‚  2. æ²¡æœ‰åˆ›å»ºè¿™ä¸ª Topic.<br>\n çœŸä¸å·§ï¼Œæˆ‘å…¨é‡åˆ°äº†ã€‚</p>\n<p>ç¬¬ä¸€ç§å‘¢ï¼Œä½¿ç”¨ telnet å‘½ä»¤ï¼Œå¦‚æœé€šäº†å°±è§£å†³äº†ã€‚<br>\nç¬¬äºŒç§ï¼Œä½¿ç”¨  <code>sh mqadmin updateTopic -n localhost:9876 -b 192.168.1.63:10911 -t TopicTest</code>  -n è¡¨ç¤º NameSerer çš„åœ°å€ï¼Œ-b è¡¨ç¤º Broker çš„åœ°å€ï¼Œ-t<br>\n åé¢çš„å°±æ˜¯ topicName äº†ã€‚</p>\n<blockquote>\n<p>2.Broker å¯åŠ¨å¤±è´¥ï¼Œæç¤º ç©ºé—´ä¸è¶³ã€‚</p>\n</blockquote>\n<p>åŸå› æ˜¯ï¼šåœ¨ <span class=\"exturl\" data-url=\"aHR0cDovL3J1blNlcnZlci5zaA==\">runServer.sh</span> å’Œ <span class=\"exturl\" data-url=\"aHR0cDovL3J1bmJyb2tlci5zaA==\">runbroker.sh</span> è„šæœ¬ä¸­é…ç½®äº†å¯åŠ¨çš„å†…å­˜å¤§å°ï¼Œ NameServer å¯åŠ¨çš„å †å†…å­˜æ˜¯ 4G, è€Œ broker å¯åŠ¨çš„æ˜¯ 8g æ‰€ä»¥ï¼Œå›æŠ¥é”™å›  ç©ºé—´ä¸è¶³ï¼Œå¯åŠ¨å¤±è´¥ã€‚</p>\n<blockquote>\n<p>3. è¿è¡Œ mqadmin å‘½ä»¤æ˜¯æŠ¥é”™</p>\n</blockquote>\n<p>æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯å› ä¸º å®¿ä¸»æœºå®‰è£…çš„æ˜¯ openJDK, å¯¼è‡´ è„šæœ¬æ²¡æœ‰åŠ è½½åˆ°å¯¹åº”çš„ ext åŒ…ï¼Œæ‰€ä»¥åœ¨ <span class=\"exturl\" data-url=\"aHR0cDovL3Rvb2xzLnNo\">tools.sh</span> ä¸­åŠ å…¥ ext / åŒ…çš„è·¯å¾„å°±å¯ä»¥äº†ã€‚ ext/ å°±æ˜¯ jre ä¸‹çš„ ext åŒ…ã€‚</p>\n<p>å¦‚ä¸‹å›¾.<br>\n<img data-src=\"/images/rocketmq/1-03%E5%8D%95master%E9%83%A8%E7%BD%B2mqadmin%E5%91%BD%E4%BB%A4%E6%8A%A5%E9%94%99.png\" alt=\"\"></p>\n<h3 id=\"rocketè¿è¡Œç¨‹åº\"><a class=\"markdownIt-Anchor\" href=\"#rocketè¿è¡Œç¨‹åº\">#</a> Rocket è¿è¡Œç¨‹åº</h3>\n<p>æˆ‘ä»¬å…ˆä¸æ€¥ç€å»å­¦ä¹ å…¶ä»–çš„éƒ¨ç½²æ–¹å¼ï¼Œæˆ‘ä»¬ç°åœ¨å»çœ‹ä¸‹ Rocket è¿è¡Œç¨‹åºçš„ç›®å½•æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ç›®çš„æ˜¯äº†è§£ RocketMQ æ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„ã€‚è¿™æ ·é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é¡ºè—¤æ‘¸ç“œå»æ’æŸ¥é—®é¢˜æ˜¯å‡ºåœ¨ä»€ä¹ˆåœ°æ–¹ã€‚</p>\n<p><img data-src=\"/images/rocketmq/1-03-RocketMQ%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%9B%AE%E5%BD%95.png\" alt=\"\"></p>\n<ul>\n<li>benchmark åŒ…ï¼šæä¾›äº† Rocket ç”¨äºåŸºå‡†æµ‹è¯•çš„å·¥å…·ã€‚<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL3Byb2R1Y2VyLnNo\">producer.sh</span> ï¼šæµ‹è¯•æ™®é€š MQ ç”Ÿäº§è€…çš„æ€§èƒ½ã€‚<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL2NvbnN1bWVyLnNo\">consumer.sh</span> ï¼šæµ‹è¯• MQ æ¶ˆè´¹è€…çš„æ€§èƒ½ã€‚<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL3Rwcm9kdWNlci5zaA==\">tproducer.sh</span> ï¼šæµ‹è¯•äº‹åŠ¡ MQ ç”Ÿäº§è€…çš„æ€§èƒ½ã€‚<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL2JhdGNocHJvZHVjZXIuc2g=\">batchproducer.sh</span>: æµ‹è¯•æ‰¹é‡ç”Ÿäº§è€…çš„æ€§èƒ½ã€‚</li>\n<li>bin: æä¾›äº† å¯åŠ¨å…³é—­ NameServer, å¯åŠ¨å…³é—­ Brokerï¼Œç®¡ç† MQ çš„å·¥å…·ã€‚\n<ul>\n<li>mqnamesrvï¼š å¯åŠ¨ NameServer çš„è„šæœ¬</li>\n<li>mqbroker: å¯åŠ¨ Broker çš„è„šæœ¬</li>\n<li>mqadmin: ç®¡ç† RocketMQ çš„è„šæœ¬</li>\n<li>mqshutdown: å…³é—­ MQ çš„è„šæœ¬</li>\n</ul>\n</li>\n<li>conf: å¯¹ RocketMQ è¿›è¡Œé…ç½®çš„æ–‡ä»¶ç›®å½•ã€‚\n<ul>\n<li>broker.confï¼š broker çš„é…ç½®</li>\n<li>logback-*.xml: logback æ—¥å¿—çš„é…ç½®ï¼Œæ¯”å¦‚ Brokerï¼ŒnameServer,tools çš„æ—¥å¿—é…ç½®</li>\n<li>plain_acl.ymlï¼š æƒé™ç®¡ç†çš„æ–‡ä»¶</li>\n<li>tools.yml: è„šæœ¬å·¥å…·çš„é…ç½®</li>\n<li>dledger: å®¹ç¾ç›¸å…³çš„é…ç½®</li>\n</ul>\n</li>\n<li>lib: è¿™é‡Œå­˜æ”¾çš„å°±æ˜¯ç¼–è¯‘ä¹‹åçš„ class æ–‡ä»¶ã€‚</li>\n</ul>\n<p>å¦‚æœåœ¨å¯åŠ¨æˆ–è€…ä½¿ç”¨å…¶ä»–çš„å‘½ä»¤é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥åˆ°å¯¹åº”çš„ç›®å½•ä¸­ï¼Œæ‰¾åˆ°æ–‡ä»¶ï¼Œç„¶åçœ‹ä¸‹ä»£ç è¿›è¡Œå¤„ç†ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬æ¥ç€å»çœ‹å…¶ä»–çš„éƒ¨ç½²æ–¹å¼ã€‚</p>\n<h2 id=\"å¤šmasteræ¨¡å¼\"><a class=\"markdownIt-Anchor\" href=\"#å¤šmasteræ¨¡å¼\">#</a> å¤š Master æ¨¡å¼</h2>\n<p>ä¸€ä¸ªé›†ç¾¤æ—  Slaveï¼Œå…¨æ˜¯ Masterï¼Œä¾‹å¦‚ 2 ä¸ª Master æˆ–è€… 3 ä¸ª Masterï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>\n<p>ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œå•ä¸ª Master å®•æœºæˆ–é‡å¯ç»´æŠ¤å¯¹åº”ç”¨æ— å½±å“ï¼Œåœ¨ç£ç›˜é…ç½®ä¸º RAID10 æ—¶ï¼Œå³ä½¿æœºå™¨å®•æœºä¸å¯æ¢å¤æƒ…å†µä¸‹ï¼Œç”±äº RAID10 ç£ç›˜éå¸¸å¯é ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢ï¼ˆå¼‚æ­¥åˆ·ç›˜ä¸¢å¤±å°‘é‡æ¶ˆæ¯ï¼ŒåŒæ­¥åˆ·ç›˜ä¸€æ¡ä¸ä¸¢ï¼‰ï¼Œæ€§èƒ½æœ€é«˜ï¼›</p>\n</li>\n<li>\n<p>ç¼ºç‚¹ï¼šå•å°æœºå™¨å®•æœºæœŸé—´ï¼Œè¿™å°æœºå™¨ä¸Šæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯åœ¨æœºå™¨æ¢å¤ä¹‹å‰ä¸å¯è®¢é˜…ï¼Œæ¶ˆæ¯å®æ—¶æ€§ä¼šå—åˆ°å½±å“ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¯åŠ¨nameserver\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨nameserver\">#</a> å¯åŠ¨ NameServer</h3>\n<p><b>NameServer éœ€è¦å…ˆäº Broker å¯åŠ¨ï¼Œä¸”å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œå»ºè®®ä¸€èˆ¬è§„æ¨¡çš„é›†ç¾¤å¯åŠ¨ 3 ä¸ª NameServer</b>ï¼Œå„èŠ‚ç‚¹çš„å¯åŠ¨å‘½ä»¤ç›¸åŒï¼Œå¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### é¦–å…ˆå¯åŠ¨Name Server</span></span><br><span class=\"line\">$ nohup sh mqnamesrv &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">$ tail -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class=\"line\">The Name Server boot success...</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯åŠ¨brokeré›†ç¾¤\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨brokeré›†ç¾¤\">#</a> å¯åŠ¨ Broker é›†ç¾¤</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-noslave/broker-a.properties &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-noslave/broker-b.properties &amp;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>å¦‚ä¸Šå¯åŠ¨å‘½ä»¤æ˜¯åœ¨å•ä¸ª NameServer æƒ…å†µä¸‹ä½¿ç”¨çš„ã€‚å¯¹äºå¤šä¸ª NameServer çš„é›†ç¾¤ï¼ŒBroker å¯åŠ¨å‘½ä»¤ä¸­ <code>-n</code>  åé¢çš„åœ°å€åˆ—è¡¨ç”¨åˆ†å·éš”å¼€å³å¯ï¼Œä¾‹å¦‚  <code>192.168.1.1:9876;192.161.2:9876</code> ã€‚</p>\n<h2 id=\"13-å¤šmasterå¤šslaveæ¨¡å¼-å¼‚æ­¥å¤åˆ¶\"><a class=\"markdownIt-Anchor\" href=\"#13-å¤šmasterå¤šslaveæ¨¡å¼-å¼‚æ­¥å¤åˆ¶\">#</a> 1.3 å¤š Master å¤š Slave æ¨¡å¼ - å¼‚æ­¥å¤åˆ¶</h2>\n<p>æ¯ä¸ª Master é…ç½®ä¸€ä¸ª Slaveï¼Œæœ‰å¤šå¯¹ Master-Slaveï¼ŒHA é‡‡ç”¨å¼‚æ­¥å¤åˆ¶æ–¹å¼ï¼Œä¸»å¤‡æœ‰çŸ­æš‚æ¶ˆæ¯å»¶è¿Ÿï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>\n<p>ä¼˜ç‚¹ï¼šå³ä½¿ç£ç›˜æŸåï¼Œæ¶ˆæ¯ä¸¢å¤±çš„éå¸¸å°‘ï¼Œä¸”æ¶ˆæ¯å®æ—¶æ€§ä¸ä¼šå—å½±å“ï¼ŒåŒæ—¶ Master å®•æœºåï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥ä» Slave æ¶ˆè´¹ï¼Œè€Œä¸”æ­¤è¿‡ç¨‹å¯¹åº”ç”¨é€æ˜ï¼Œä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œæ€§èƒ½åŒå¤š Master æ¨¡å¼å‡ ä¹ä¸€æ ·ï¼›</p>\n</li>\n<li>\n<p>ç¼ºç‚¹ï¼šMaster å®•æœºï¼Œç£ç›˜æŸåæƒ…å†µä¸‹ä¼šä¸¢å¤±å°‘é‡æ¶ˆæ¯ã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¯åŠ¨nameserver-2\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨nameserver-2\">#</a> å¯åŠ¨ NameServer</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### é¦–å…ˆå¯åŠ¨Name Server</span></span><br><span class=\"line\">$ nohup sh mqnamesrv &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">$ tail -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class=\"line\">The Name Server boot success...</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯åŠ¨brokeré›†ç¾¤-2\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨brokeré›†ç¾¤-2\">#</a> å¯åŠ¨ Broker é›†ç¾¤</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-async/broker-a.properties &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-async/broker-b.properties &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªSlaveï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-async/broker-a-s.properties &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Dï¼Œå¯åŠ¨ç¬¬äºŒä¸ªSlaveï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-async/broker-b-s.properties &amp;</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¤šmasterå¤šslaveæ¨¡å¼-åŒæ­¥åŒå†™\"><a class=\"markdownIt-Anchor\" href=\"#å¤šmasterå¤šslaveæ¨¡å¼-åŒæ­¥åŒå†™\">#</a> å¤š Master å¤š Slave æ¨¡å¼ - åŒæ­¥åŒå†™</h3>\n<p>æ¯ä¸ª Master é…ç½®ä¸€ä¸ª Slaveï¼Œæœ‰å¤šå¯¹ Master-Slaveï¼ŒHA é‡‡ç”¨åŒæ­¥åŒå†™æ–¹å¼ï¼Œå³åªæœ‰ä¸»å¤‡éƒ½å†™æˆåŠŸï¼Œæ‰å‘åº”ç”¨è¿”å›æˆåŠŸï¼Œè¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>\n<p>ä¼˜ç‚¹ï¼šæ•°æ®ä¸æœåŠ¡éƒ½æ— å•ç‚¹æ•…éšœï¼ŒMaster å®•æœºæƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ— å»¶è¿Ÿï¼ŒæœåŠ¡å¯ç”¨æ€§ä¸æ•°æ®å¯ç”¨æ€§éƒ½éå¸¸é«˜ï¼›</p>\n</li>\n<li>\n<p>ç¼ºç‚¹ï¼šæ€§èƒ½æ¯”å¼‚æ­¥å¤åˆ¶æ¨¡å¼ç•¥ä½ï¼ˆå¤§çº¦ä½ 10% å·¦å³ï¼‰ï¼Œå‘é€å•ä¸ªæ¶ˆæ¯çš„ RT ä¼šç•¥é«˜ï¼Œä¸”ç›®å‰ç‰ˆæœ¬åœ¨ä¸»èŠ‚ç‚¹å®•æœºåï¼Œå¤‡æœºä¸èƒ½è‡ªåŠ¨åˆ‡æ¢ä¸ºä¸»æœºã€‚</p>\n</li>\n</ul>\n<h3 id=\"å¯åŠ¨nameserver-3\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨nameserver-3\">#</a> å¯åŠ¨ NameServer</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### é¦–å…ˆå¯åŠ¨Name Server</span></span><br><span class=\"line\">$ nohup sh mqnamesrv &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### éªŒè¯Name Server æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class=\"line\">$ tail -f ~/logs/rocketmqlogs/namesrv.log</span><br><span class=\"line\">The Name Server boot success...</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯åŠ¨brokeré›†ç¾¤-3\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨brokeré›†ç¾¤-3\">#</a> å¯åŠ¨ Broker é›†ç¾¤</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Aï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-sync/broker-a.properties &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Bï¼Œå¯åŠ¨ç¬¬äºŒä¸ªMasterï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-sync/broker-b.properties &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Cï¼Œå¯åŠ¨ç¬¬ä¸€ä¸ªSlaveï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-sync/broker-a-s.properties &amp;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">### åœ¨æœºå™¨Dï¼Œå¯åŠ¨ç¬¬äºŒä¸ªSlaveï¼Œä¾‹å¦‚NameServerçš„IPä¸ºï¼š192.168.1.1</span></span><br><span class=\"line\">$ nohup sh mqbroker -n 192.168.1.1:9876 -c <span class=\"variable\">$ROCKETMQ_HOME</span>/conf/2m-2s-sync/broker-b-s.properties &amp;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Š Broker ä¸ Slave é…å¯¹æ˜¯é€šè¿‡æŒ‡å®šç›¸åŒçš„ BrokerName å‚æ•°æ¥é…å¯¹ï¼ŒMaster çš„ BrokerId å¿…é¡»æ˜¯ 0ï¼ŒSlave çš„ BrokerId å¿…é¡»æ˜¯å¤§äº 0 çš„æ•°ã€‚å¦å¤–ä¸€ä¸ª Master ä¸‹é¢å¯ä»¥æŒ‚è½½å¤šä¸ª Slaveï¼ŒåŒä¸€ Master ä¸‹çš„å¤šä¸ª Slave é€šè¿‡æŒ‡å®šä¸åŒçš„ BrokerId æ¥åŒºåˆ†ã€‚$ROCKETMQ_HOME æŒ‡çš„ RocketMQ å®‰è£…ç›®å½•ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±è®¾ç½®æ­¤ç¯å¢ƒå˜é‡ã€‚</p>\n<h1 id=\"mqadminç®¡ç†å·¥å…·\"><a class=\"markdownIt-Anchor\" href=\"#mqadminç®¡ç†å·¥å…·\">#</a> mqadmin ç®¡ç†å·¥å…·</h1>\n<p>å…³äº mqadmin å‘½ä»¤çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡  <code>sh mqadmin</code>  å‘½ä»¤æ¥æŸ¥çœ‹å‘½ä»¤çš„é€‰é¡¹ï¼Œç”¨çš„å¤šè‡ªç„¶å°±è®°ä½äº†ï¼Œåé¢æˆ‘ä»¬ä¹Ÿä¸ä¼šé€šè¿‡è¿™ç§æ–¹å¼æ¥ç®¡ç† RocketMQ é›†ç¾¤ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šéå¸¸é¢‘ç¹çš„ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ã€‚</p>\n<blockquote>\n<p>æ³¨æ„ï¼š</p>\n<ol>\n<li>æ‰§è¡Œå‘½ä»¤æ–¹æ³•ï¼š <code>./mqadmin &#123;command&#125; &#123;args&#125;</code></li>\n<li>å‡ ä¹æ‰€æœ‰å‘½ä»¤éƒ½éœ€è¦é…ç½® - n è¡¨ç¤º NameServer åœ°å€ï¼Œæ ¼å¼ä¸º ip:port</li>\n<li>å‡ ä¹æ‰€æœ‰å‘½ä»¤éƒ½å¯ä»¥é€šè¿‡ - h è·å–å¸®åŠ©</li>\n<li>å¦‚æœæ—¢æœ‰ Broker åœ°å€ï¼ˆ-bï¼‰é…ç½®é¡¹åˆæœ‰ clusterNameï¼ˆ-cï¼‰é…ç½®é¡¹ï¼Œåˆ™ä¼˜å…ˆä»¥ Broker åœ°å€æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœä¸é…ç½® Broker åœ°å€ï¼Œåˆ™å¯¹é›†ç¾¤ä¸­æ‰€æœ‰ä¸»æœºæ‰§è¡Œå‘½ä»¤ï¼Œåªæ”¯æŒä¸€ä¸ª Broker åœ°å€ã€‚-b æ ¼å¼ä¸º ip:portï¼Œport é»˜è®¤æ˜¯ 10911</li>\n<li>åœ¨ tools ä¸‹å¯ä»¥çœ‹åˆ°å¾ˆå¤šå‘½ä»¤ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰å‘½ä»¤éƒ½èƒ½ä½¿ç”¨ï¼Œåªæœ‰åœ¨ MQAdminStartup ä¸­åˆå§‹åŒ–çš„å‘½ä»¤æ‰èƒ½ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¿®æ”¹è¿™ä¸ªç±»ï¼Œå¢åŠ æˆ–è‡ªå®šä¹‰å‘½ä»¤</li>\n<li>ç”±äºç‰ˆæœ¬æ›´æ–°é—®é¢˜ï¼Œå°‘éƒ¨åˆ†å‘½ä»¤å¯èƒ½æœªåŠæ—¶æ›´æ–°ï¼Œé‡åˆ°é”™è¯¯è¯·ç›´æ¥é˜…è¯»ç›¸å…³å‘½ä»¤æºç </li>\n</ol>\n</blockquote>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/02/rocketMQ/1-02-RocketMQ%E6%A6%82%E5%BF%B5/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/02/rocketMQ/1-02-RocketMQ%E6%A6%82%E5%BF%B5/",
            "title": "RocketMQç³»åˆ—-RocketMQæ¦‚å¿µ",
            "date_published": "2021-09-02T09:17:00.000Z",
            "content_html": "<h2 id=\"rocketmqæ¦‚å¿µ\"><a class=\"markdownIt-Anchor\" href=\"#rocketmqæ¦‚å¿µ\">#</a> RocketMQ æ¦‚å¿µ</h2>\n<p>æˆ‘åœ¨å­¦ä¹  <code>RocketMQ</code>  çš„æ—¶å€™ï¼Œçœ‹åˆ°æ–‡æ¡£ä¸­ä»‹ç»äº†å¾ˆå¤šçš„æ¦‚å¿µã€‚æˆ‘éå¸¸åæ„Ÿï¼Œä½†æ˜¯åˆæ²¡æœ‰åŠæ³•ï¼Œæ²¡æœ‰è¿™äº›æ¦‚å¿µï¼Œå°±æ²¡åŠæ³•æ›´å¥½çš„å»å­¦ä¹ åé¢çš„å†…å®¹ï¼Œå½“åé¢ä½¿ç”¨å¾ˆå¤šåè¯æ¥æ¢³ç†å®ç°åŸç†çš„æ—¶å€™ï¼Œå°±ä¼šä¸€å¤´é›¾æ°´ã€‚</p>\n<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº† <code>RocketMQ</code>  ç”±å››éƒ¨åˆ†æ„æˆã€‚</p>\n<h3 id=\"æ¶ˆæ¯æ¨¡å‹\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯æ¨¡å‹\">#</a> æ¶ˆæ¯æ¨¡å‹</h3>\n<p><code>Producer</code>  è´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ï¼Œ <code>Consumer</code>  è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼Œ <code>Broker</code>  è´Ÿè´£å­˜å‚¨æ¶ˆæ¯ï¼Œ <code>NameServer</code>  è´Ÿè´£å¯¹ <code>Producer</code>  å’Œ  <code>Customer</code>  çš„æœåŠ¡å‘ç°ï¼Œè¿˜æœ‰è·¯ç”±è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚ <code>Broker</code>  åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­å¯¹åº”ä¸€å°æœåŠ¡å™¨ï¼Œæ¯ä¸ª  <code>Broker</code>  å¯ä»¥å­˜å‚¨å¤šä¸ª <code>Topic</code>  çš„æ¶ˆæ¯ï¼Œæ¯ä¸ª <code>Topic</code>  çš„æ¶ˆæ¯ä¹Ÿå¯ä»¥åˆ†ç‰‡å­˜å‚¨äºä¸åŒçš„  <code>Broker</code> ã€‚ <code>Message Queue</code>  ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ç‰©ç†åœ°å€ï¼Œæ¯ä¸ª <code>Topic</code>  ä¸­çš„æ¶ˆæ¯åœ°å€å­˜å‚¨äºå¤šä¸ª  <code>Message Queue</code>  ä¸­ã€‚ <code>ConsumerGroup</code>  ç”±å¤šä¸ª <code>Consumer</code>  å®ä¾‹æ„æˆã€‚</p>\n<h3 id=\"æ¶ˆæ¯ç”Ÿäº§è€…producer\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯ç”Ÿäº§è€…producer\">#</a> æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆProducerï¼‰</h3>\n<p>è´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ï¼Œä¸€èˆ¬ç”±ä¸šåŠ¡ç³»ç»Ÿè´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ã€‚ä¸€ä¸ªæ¶ˆæ¯ç”Ÿäº§è€…ä¼šæŠŠä¸šåŠ¡åº”ç”¨ç³»ç»Ÿé‡Œäº§ç”Ÿçš„æ¶ˆæ¯å‘é€åˆ° <code>broker</code>  æœåŠ¡å™¨ã€‚ <code>RocketMQ</code>  æä¾›å¤šç§å‘é€æ–¹å¼ï¼ŒåŒæ­¥å‘é€ã€å¼‚æ­¥å‘é€ã€é¡ºåºå‘é€ã€å•å‘å‘é€ã€‚åŒæ­¥å’Œå¼‚æ­¥æ–¹å¼å‡éœ€è¦ <code>Broker</code>  è¿”å›ç¡®è®¤ä¿¡æ¯ï¼Œå•å‘å‘é€ä¸éœ€è¦ã€‚</p>\n<h3 id=\"æ¶ˆæ¯æ¶ˆè´¹è€…consumer\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯æ¶ˆè´¹è€…consumer\">#</a> æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆ <code>Consumer</code> ï¼‰</h3>\n<p>è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¸€èˆ¬æ˜¯åå°ç³»ç»Ÿè´Ÿè´£å¼‚æ­¥æ¶ˆè´¹ã€‚ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ä¼šä» <code>Broker</code>  æœåŠ¡å™¨æ‹‰å–æ¶ˆæ¯ã€å¹¶å°†å…¶æä¾›ç»™åº”ç”¨ç¨‹åºã€‚ä»ç”¨æˆ·åº”ç”¨çš„è§’åº¦è€Œè¨€æä¾›äº†ä¸¤ç§æ¶ˆè´¹å½¢å¼ï¼šæ‹‰å–å¼æ¶ˆè´¹ ( <code>pull</code> )ã€æ¨åŠ¨å¼æ¶ˆè´¹ ( <code>push</code> )ã€‚</p>\n<h3 id=\"ç”Ÿäº§è€…ç»„producer-group\"><a class=\"markdownIt-Anchor\" href=\"#ç”Ÿäº§è€…ç»„producer-group\">#</a> ç”Ÿäº§è€…ç»„ï¼ˆ <code>Producer Group</code> ï¼‰</h3>\n<p>åŒä¸€ç±» <code>Producer</code>  çš„é›†åˆï¼Œè¿™ç±» <code>Producer</code>  å‘é€åŒä¸€ç±»æ¶ˆæ¯ä¸”å‘é€é€»è¾‘ä¸€è‡´ã€‚å¦‚æœå‘é€çš„æ˜¯äº‹åŠ¡æ¶ˆæ¯ä¸”åŸå§‹ç”Ÿäº§è€…åœ¨å‘é€ä¹‹åå´©æºƒï¼Œåˆ™ <code>Broker</code>  æœåŠ¡å™¨ä¼šè”ç³»åŒä¸€ç”Ÿäº§è€…ç»„çš„å…¶ä»–ç”Ÿäº§è€…å®ä¾‹ä»¥æäº¤æˆ–å›æº¯æ¶ˆè´¹ã€‚</p>\n<h3 id=\"æ¶ˆè´¹è€…ç»„consumer-group\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆè´¹è€…ç»„consumer-group\">#</a> æ¶ˆè´¹è€…ç»„ï¼ˆ <code>Consumer Group</code> ï¼‰</h3>\n<p>åŒä¸€ç±» <code>Consumer</code>  çš„é›†åˆï¼Œè¿™ç±» <code>Consumer</code>  é€šå¸¸æ¶ˆè´¹åŒä¸€ç±»æ¶ˆæ¯ä¸”æ¶ˆè´¹é€»è¾‘ä¸€è‡´ã€‚æ¶ˆè´¹è€…ç»„ä½¿å¾—åœ¨æ¶ˆæ¯æ¶ˆè´¹æ–¹é¢ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œå®¹é”™çš„ç›®æ ‡å˜å¾—éå¸¸å®¹æ˜“ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å®ä¾‹å¿…é¡»è®¢é˜…å®Œå…¨ç›¸åŒçš„ <code>Topic</code> ã€‚ <code>RocketMQ </code> æ”¯æŒä¸¤ç§æ¶ˆæ¯æ¨¡å¼ï¼šé›†ç¾¤æ¶ˆè´¹ï¼ˆ <code>Clustering</code> ï¼‰å’Œå¹¿æ’­æ¶ˆè´¹ï¼ˆ <code>Broadcasting</code> ï¼‰ã€‚</p>\n<h3 id=\"æ‹‰å–å¼æ¶ˆè´¹pull-consumer\"><a class=\"markdownIt-Anchor\" href=\"#æ‹‰å–å¼æ¶ˆè´¹pull-consumer\">#</a> æ‹‰å–å¼æ¶ˆè´¹ï¼ˆ <code>Pull Consumer</code> ï¼‰</h3>\n<p><code>Consumer</code>  æ¶ˆè´¹çš„ä¸€ç§ç±»å‹ï¼Œåº”ç”¨é€šå¸¸ä¸»åŠ¨è°ƒç”¨ <code>Consumer</code>  çš„æ‹‰æ¶ˆæ¯æ–¹æ³•ä» <code>Broker</code>  æœåŠ¡å™¨æ‹‰æ¶ˆæ¯ã€ä¸»åŠ¨æƒç”±åº”ç”¨æ§åˆ¶ã€‚ä¸€æ—¦è·å–äº†æ‰¹é‡æ¶ˆæ¯ï¼Œåº”ç”¨å°±ä¼šå¯åŠ¨æ¶ˆè´¹è¿‡ç¨‹ã€‚</p>\n<h3 id=\"æ¨åŠ¨å¼æ¶ˆè´¹push-consumer\"><a class=\"markdownIt-Anchor\" href=\"#æ¨åŠ¨å¼æ¶ˆè´¹push-consumer\">#</a> æ¨åŠ¨å¼æ¶ˆè´¹ï¼ˆ <code>Push Consumer</code> ï¼‰</h3>\n<p><code>Consumer</code>  æ¶ˆè´¹çš„ä¸€ç§ç±»å‹ï¼Œè¯¥æ¨¡å¼ä¸‹ <code>Broker</code>  æ”¶åˆ°æ•°æ®åä¼šä¸»åŠ¨æ¨é€ç»™æ¶ˆè´¹ç«¯ï¼Œè¯¥æ¶ˆè´¹æ¨¡å¼ä¸€èˆ¬å®æ—¶æ€§è¾ƒé«˜ã€‚</p>\n<h3 id=\"ä¸»é¢˜topic\"><a class=\"markdownIt-Anchor\" href=\"#ä¸»é¢˜topic\">#</a> ä¸»é¢˜ï¼ˆ <code>Topic</code> ï¼‰</h3>\n<p>è¡¨ç¤ºä¸€ç±»æ¶ˆæ¯çš„é›†åˆï¼Œæ¯ä¸ªä¸»é¢˜åŒ…å«è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯åªèƒ½å±äºä¸€ä¸ªä¸»é¢˜ï¼Œæ˜¯ <code>RocketMQ</code>  è¿›è¡Œæ¶ˆæ¯è®¢é˜…çš„åŸºæœ¬å•ä½ã€‚</p>\n<h3 id=\"ä»£ç†æœåŠ¡å™¨broker-server\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç†æœåŠ¡å™¨broker-server\">#</a> ä»£ç†æœåŠ¡å™¨ï¼ˆ <code>Broker Server</code> ï¼‰</h3>\n<p>æ¶ˆæ¯ä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€è½¬å‘æ¶ˆæ¯ã€‚ä»£ç†æœåŠ¡å™¨åœ¨ <code>RocketMQ</code>  ç³»ç»Ÿä¸­è´Ÿè´£æ¥æ”¶ä»ç”Ÿäº§è€…å‘é€æ¥çš„æ¶ˆæ¯å¹¶å­˜å‚¨ã€åŒæ—¶ä¸ºæ¶ˆè´¹è€…çš„æ‹‰å–è¯·æ±‚ä½œå‡†å¤‡ã€‚ä»£ç†æœåŠ¡å™¨ä¹Ÿå­˜å‚¨æ¶ˆæ¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬æ¶ˆè´¹è€…ç»„ã€æ¶ˆè´¹è¿›åº¦åç§»å’Œä¸»é¢˜å’Œé˜Ÿåˆ—æ¶ˆæ¯ç­‰ã€‚</p>\n<h3 id=\"nameserver\"><a class=\"markdownIt-Anchor\" href=\"#nameserver\">#</a>  <code>NameServer</code></h3>\n<p><code>NameServer</code>  å……å½“è·¯ç”±æ¶ˆæ¯çš„æä¾›è€…ã€‚ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…èƒ½å¤Ÿé€šè¿‡åå­—æœåŠ¡æŸ¥æ‰¾å„ä¸»é¢˜ç›¸åº”çš„ <code>Broker IP</code>  åˆ—è¡¨ã€‚å¤šä¸ª <code>Nameserver</code>  å®ä¾‹ç»„æˆé›†ç¾¤ï¼Œä½†ç›¸äº’ç‹¬ç«‹ï¼Œæ²¡æœ‰ä¿¡æ¯äº¤æ¢ã€‚</p>\n<h3 id=\"é›†ç¾¤æ¶ˆè´¹clustering\"><a class=\"markdownIt-Anchor\" href=\"#é›†ç¾¤æ¶ˆè´¹clustering\">#</a> é›†ç¾¤æ¶ˆè´¹ï¼ˆ <code>Clustering</code> ï¼‰</h3>\n<p>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ <code>Consumer Group</code>  çš„æ¯ä¸ª <code>Consumer</code>  å®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆæ¯ã€‚</p>\n<h3 id=\"å¹¿æ’­æ¶ˆè´¹broadcasting\"><a class=\"markdownIt-Anchor\" href=\"#å¹¿æ’­æ¶ˆè´¹broadcasting\">#</a> å¹¿æ’­æ¶ˆè´¹ï¼ˆ <code>Broadcasting</code> ï¼‰</h3>\n<p>å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ <code>Consumer Group</code>  çš„æ¯ä¸ª <code>Consumer</code>  å®ä¾‹éƒ½æ¥æ”¶å…¨é‡çš„æ¶ˆæ¯ã€‚</p>\n<h3 id=\"æ™®é€šé¡ºåºæ¶ˆæ¯normal-ordered-message\"><a class=\"markdownIt-Anchor\" href=\"#æ™®é€šé¡ºåºæ¶ˆæ¯normal-ordered-message\">#</a> æ™®é€šé¡ºåºæ¶ˆæ¯ï¼ˆ <code>Normal Ordered Message</code> ï¼‰</h3>\n<p>æ™®é€šé¡ºåºæ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…é€šè¿‡åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ  <code>Topic</code>  åˆ†åŒºï¼Œç§°ä½œ M <code>essage Queue</code> ï¼‰ æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯æœ‰é¡ºåºçš„ï¼Œä¸åŒæ¶ˆæ¯é˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯åˆ™å¯èƒ½æ˜¯æ— é¡ºåºçš„ã€‚</p>\n<h3 id=\"ä¸¥æ ¼é¡ºåºæ¶ˆæ¯strictly-ordered-message\"><a class=\"markdownIt-Anchor\" href=\"#ä¸¥æ ¼é¡ºåºæ¶ˆæ¯strictly-ordered-message\">#</a> ä¸¥æ ¼é¡ºåºæ¶ˆæ¯ï¼ˆ <code>Strictly Ordered Message</code> ï¼‰</h3>\n<p>ä¸¥æ ¼é¡ºåºæ¶ˆæ¯æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°çš„æ‰€æœ‰æ¶ˆæ¯å‡æ˜¯æœ‰é¡ºåºçš„ã€‚</p>\n<h3 id=\"æ¶ˆæ¯message\"><a class=\"markdownIt-Anchor\" href=\"#æ¶ˆæ¯message\">#</a> æ¶ˆæ¯ï¼ˆ <code>Message</code> ï¼‰</h3>\n<p>æ¶ˆæ¯ç³»ç»Ÿæ‰€ä¼ è¾“ä¿¡æ¯çš„ç‰©ç†è½½ä½“ï¼Œç”Ÿäº§å’Œæ¶ˆè´¹æ•°æ®çš„æœ€å°å•ä½ï¼Œæ¯æ¡æ¶ˆæ¯å¿…é¡»å±äºä¸€ä¸ªä¸»é¢˜ã€‚ <code>RocketMQ</code>  ä¸­æ¯ä¸ªæ¶ˆæ¯æ‹¥æœ‰å”¯ä¸€çš„ <code>Message ID</code> ï¼Œä¸”å¯ä»¥æºå¸¦å…·æœ‰ä¸šåŠ¡æ ‡è¯†çš„ <code>Key</code> ã€‚ç³»ç»Ÿæä¾›äº†é€šè¿‡ <code>Message ID</code>  å’Œ <code>Key</code>  æŸ¥è¯¢æ¶ˆæ¯çš„åŠŸèƒ½ã€‚</p>\n<h3 id=\"æ ‡ç­¾tag\"><a class=\"markdownIt-Anchor\" href=\"#æ ‡ç­¾tag\">#</a> æ ‡ç­¾ï¼ˆ <code>Tag</code> ï¼‰</h3>\n<p>ä¸ºæ¶ˆæ¯è®¾ç½®çš„æ ‡å¿—ï¼Œç”¨äºåŒä¸€ä¸»é¢˜ä¸‹åŒºåˆ†ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚æ¥è‡ªåŒä¸€ä¸šåŠ¡å•å…ƒçš„æ¶ˆæ¯ï¼Œå¯ä»¥æ ¹æ®ä¸åŒä¸šåŠ¡ç›®çš„åœ¨åŒä¸€ä¸»é¢˜ä¸‹è®¾ç½®ä¸åŒæ ‡ç­¾ã€‚æ ‡ç­¾èƒ½å¤Ÿæœ‰æ•ˆåœ°ä¿æŒä»£ç çš„æ¸…æ™°åº¦å’Œè¿è´¯æ€§ï¼Œå¹¶ä¼˜åŒ– <code>RocketMQ</code>  æä¾›çš„æŸ¥è¯¢ç³»ç»Ÿã€‚æ¶ˆè´¹è€…å¯ä»¥æ ¹æ® <code>Tag</code>  å®ç°å¯¹ä¸åŒå­ä¸»é¢˜çš„ä¸åŒæ¶ˆè´¹é€»è¾‘ï¼Œå®ç°æ›´å¥½çš„æ‰©å±•æ€§ã€‚</p>\n<p>è¿™æ˜¯ä¸€ç¯‡æä¸ºæ¯ç‡¥çš„æ–‡ç« ã€‚ä»ä¸‹ç¯‡æ–‡ç« å¼€å§‹ï¼Œæˆ‘ä»¬å¼€å§‹å¯¹ <code>RocketMQ</code>  è¿›è¡Œå®è·µã€‚ä»é›¶æ­å»º <code>RocketMQ</code>  é›†ç¾¤.</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/rocketMQ/1-01-RocketMQ%E7%AE%80%E4%BB%8B/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/rocketMQ/1-01-RocketMQ%E7%AE%80%E4%BB%8B/",
            "title": "Rocketç³»åˆ—-å…¥é—¨",
            "date_published": "2021-09-01T09:17:00.000Z",
            "content_html": "<h1 id=\"rocketmq-ä»‹ç»\"><a class=\"markdownIt-Anchor\" href=\"#rocketmq-ä»‹ç»\">#</a> RocketMQ ä»‹ç»</h1>\n<p>æˆªæ­¢  <code>2021</code>  å¹´ <code>9</code>  æœˆ <code>1</code>  æ—¥ï¼Œ  <code>RocketMQ</code>  æœ€æ–°ç‰ˆæœ¬æ˜¯  <code>4.9.1</code> ã€‚</p>\n<p>æœ€æ–° <code>Star</code>  æ•°ä¸º <code>1.5w</code> .  <code>fork</code>  æ•°é‡æ˜¯ <code>8.4k</code> .</p>\n<p><img data-src=\"/images/rocketmq/RocketMQ-title-pic.png\" alt=\"\"></p>\n<h2 id=\"å‘å±•å†ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#å‘å±•å†ç¨‹\">#</a> å‘å±•å†ç¨‹</h2>\n<p><code>RocketMQ</code>  çš„å‘å±•å†ç¨‹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ <code>2001</code>  å¹´å¼€å§‹ <code>RocketMQ</code>  çš„å‰èº« <code>Notify</code> ï¼Œåœ¨ <code>2016</code>  å¹´é˜¿é‡Œå°† <code>RocketMQ</code>  æèµ ç»™ <code>Apache</code>  åŸºé‡‘ä¼šä¸­è¿›è¡Œå­µåŒ–ã€‚</p>\n<h3 id=\"åœ¨é˜¿é‡Œ\"><a class=\"markdownIt-Anchor\" href=\"#åœ¨é˜¿é‡Œ\">#</a> åœ¨é˜¿é‡Œ</h3>\n<p>é˜¿é‡Œå·´å·´æ¶ˆæ¯ä¸­é—´ä»¶èµ·æºäº <code>2001</code>  å¹´çš„äº”å½©çŸ³é¡¹ç›®ï¼Œ <code>Notify</code>  åœ¨è¿™æœŸé—´åº”è¿è€Œç”Ÿï¼Œç”¨äºäº¤æ˜“æ ¸å¿ƒæ¶ˆæ¯çš„æµè½¬ã€‚</p>\n<p>è‡³ <code>2010</code>  å¹´ï¼Œ <code>B2B</code>  å¼€å§‹å¤§è§„æ¨¡ä½¿ç”¨ <code>ActiveMQ</code>  ä½œä¸ºæ¶ˆæ¯å†…æ ¸ï¼Œéšç€é˜¿é‡Œä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼Œæ€¥éœ€ä¸€æ¬¾æ”¯æŒé¡ºåºæ¶ˆæ¯ï¼Œæ‹¥æœ‰æµ·é‡æ¶ˆæ¯å †ç§¯èƒ½åŠ›çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œ <code>MetaQ 1.0</code>  åœ¨ <code>2011</code>  å¹´è¯ç”Ÿã€‚</p>\n<p>åˆ° <code>2012</code>  å¹´ï¼Œ <code>MetaQ</code>  å·²ç»å‘å±•åˆ°äº† <code>MetaQ 3.0</code> ï¼Œå¹¶æŠ½è±¡å‡ºäº†é€šç”¨çš„æ¶ˆæ¯å¼•æ“ <code>RocketMQ</code> ã€‚éšåï¼Œå°† <code>RocketMQ</code>  è¿›è¡Œäº†å¼€æºï¼Œé˜¿é‡Œçš„æ¶ˆæ¯ä¸­é—´ä»¶æ­£å¼èµ°å…¥äº†å…¬ä¼—çš„è§†é‡ã€‚</p>\n<p>åˆ° <code>2015</code>  å¹´ï¼Œ <code>RocketMQ</code>  å·²ç»ç»å†äº†å¤šå¹´åŒåä¸€çš„æ´—ç¤¼ï¼Œåœ¨å¯ç”¨æ€§ã€å¯é æ€§ä»¥åŠç¨³å®šæ€§ç­‰æ–¹é¢éƒ½æœ‰å‡ºè‰²çš„è¡¨ç°ã€‚ä¸æ­¤åŒæ—¶ï¼Œäº‘è®¡ç®—å¤§è¡Œå…¶é“ï¼Œé˜¿é‡Œæ¶ˆæ¯ä¸­é—´ä»¶åŸºäº <code>RocketMQ</code>  æ¨å‡ºäº† <code>Aliware MQ 1.0</code> ï¼Œå¼€å§‹ä¸ºé˜¿é‡Œäº‘ä¸Šæˆåƒä¸Šä¸‡å®¶ä¼ä¸šæä¾›æ¶ˆæ¯æœåŠ¡ã€‚</p>\n<p>åˆ°ä»Šå¹´ï¼Œ <code>MetaQ</code>  åœ¨ <code>2016</code>  å¹´åŒåä¸€æ‰¿è½½äº†ä¸‡äº¿çº§æ¶ˆæ¯çš„æµè½¬ï¼Œè·¨è¶Šäº†ä¸€ä¸ªæ–°çš„é‡Œç¨‹ç¢‘ï¼ŒåŒæ—¶ <code>RocketMQ</code>  è¿›å…¥ <code>Apache</code>  å­µåŒ–ã€‚</p>\n<h3 id=\"apache\"><a class=\"markdownIt-Anchor\" href=\"#apache\">#</a> Apache</h3>\n<ul>\n<li><code>2017</code>  å¹´ <code>2</code>  æœˆ <code>7</code>  æ—¥  <code>4.0.0</code>  ç‰ˆæœ¬ï¼Œæˆä¸º <code>Apache</code>  é¡¹ç›®ä¹‹åçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚å±äº <code>Apache</code>  çš„å­µåŒ–é¡¹ç›®ã€‚</li>\n<li><code>2017</code>  å¹´ <code>6</code>  æœˆ <code>8</code>  æ—¥  <code>4.1.0</code>  ç‰ˆæœ¬ï¼Œ</li>\n<li><code>2017</code>  å¹´ <code>12</code>  æœˆ <code>13</code>  æ—¥  <code>4.2.0</code></li>\n<li><code>2018</code>  å¹´ <code>7</code>  æœˆ <code>26</code>  æ—¥  <code>4.3.0</code></li>\n<li><code>2019</code>  å¹´ <code>1</code>  æœˆ <code>17</code>  æ—¥  <code>4.4.0</code>  ç‰ˆæœ¬</li>\n<li><code>2019</code>  å¹´ <code>5</code>  æœˆ <code>21</code>  æ—¥  <code>4.5.1</code>  ç‰ˆæœ¬</li>\n<li><code>2019</code>  å¹´ <code>11</code>  æœˆ <code>19</code>  æ—¥  <code>4.6.0</code>  ç‰ˆæœ¬</li>\n<li><code>2020</code>  å¹´ <code>3</code>  æœˆ <code>5</code>  æ—¥  <code>4.7.0</code>  ç‰ˆæœ¬</li>\n<li><code>2020</code>  å¹´ <code>12</code>  æœˆ <code>9</code>  æ—¥  <code>4.8.0</code>  ç‰ˆæœ¬</li>\n<li><code>2021</code>  å¹´ <code>6</code>  æœˆ <code>17</code>  æ—¥  <code>4.9.0</code>  ç‰ˆæœ¬</li>\n<li><code>2021</code>  å¹´ <code>8</code>  æœˆ <code>27</code>  æ—¥   <code>4.9.1</code>  ç‰ˆæœ¬</li>\n</ul>\n<p>æˆªæ­¢ç›®å‰ï¼Œ <code>RocketMQ</code>  å…ˆåç»å†äº† <code>20</code>  å¹´çš„å‘å±•ï¼Œæ‰¿è½½è¿™æ·˜å®åŒåä¸€ä¸‡äº¿çº§æ¶ˆæ¯çš„å¤„ç†ã€‚</p>\n<h2 id=\"rocketç‰¹æ€§\"><a class=\"markdownIt-Anchor\" href=\"#rocketç‰¹æ€§\">#</a> Rocket ç‰¹æ€§</h2>\n<p><code>RocketMQ</code>  å…·æœ‰ä¸‹é¢çš„åŠŸèƒ½ç‰¹æ€§:</p>\n<ul>\n<li>è®¢é˜…å‘å¸ƒï¼šè¿™ä¸ªæ˜¯æ¶ˆæ¯é˜Ÿé‡Œäº§å“çš„åŸºç¡€åŠŸèƒ½ã€‚</li>\n<li>æ”¯æŒäº‹åŠ¡å‹æ¶ˆæ¯ï¼šæŒ‡åº”ç”¨æœ¬åœ°äº‹åŠ¡å’Œå‘é€æ¶ˆæ¯æ“ä½œå¯ä»¥è¢«å®šä¹‰åˆ°å…¨å±€äº‹åŠ¡ä¸­ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</li>\n<li>æ”¯æŒå»¶æ—¶æ¶ˆæ¯ï¼šæŒ‡æ¶ˆæ¯å‘é€åˆ° <code>broker</code>  åï¼Œä¸ä¼šç«‹å³è¢«æ¶ˆè´¹ï¼Œç­‰å¾…ç‰¹å®šæ—¶é—´æŠ•é€’ç»™çœŸæ­£çš„ <code>topic</code></li>\n<li>æ”¯æŒæ¶ˆæ¯é‡è¯•:  <code>Consumer</code>  æ¶ˆè´¹æ¶ˆæ¯å¤±è´¥åï¼Œè¦æä¾›ä¸€ç§é‡è¯•æœºåˆ¶ï¼Œä»¤æ¶ˆæ¯å†æ¶ˆè´¹ä¸€æ¬¡</li>\n<li>æ”¯æŒæ¶ˆæ¯è¿‡æ»¤:  <code>RocketMQ</code>  çš„æ¶ˆè´¹è€…å¯ä»¥æ ¹æ® <code>Tag</code>  è¿›è¡Œæ¶ˆæ¯è¿‡æ»¤ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰å±æ€§è¿‡æ»¤ã€‚</li>\n<li>æ”¯æŒæ¶ˆæ¯é‡æ”¾ï¼šç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼ŒåŒæ­¥æ¶ˆæ¯å¤±è´¥ä¼šé‡æŠ•ï¼Œå¼‚æ­¥æ¶ˆæ¯æœ‰é‡è¯•ï¼Œ <code>oneway</code>  æ²¡æœ‰ä»»ä½•ä¿è¯ã€‚</li>\n<li>æ”¯æŒæµé‡æ§åˆ¶ï¼š åˆ†ä¸ºç”Ÿäº§è€…æµæ§å’Œæ¶ˆè´¹è€…æµæ§ã€‚ç”Ÿäº§è€…æµæ§å› ä¸º <code>broker</code>  å¤„ç†èƒ½åŠ›è¾¾åˆ°ç“¶é¢ˆï¼›æ¶ˆè´¹è€…æµæ§ï¼Œå› ä¸ºæ¶ˆè´¹èƒ½åŠ›è¾¾åˆ°ç“¶é¢ˆã€‚</li>\n<li>æ”¯æŒæ­»ä¿¡é˜Ÿåˆ—ï¼šæ­»ä¿¡é˜Ÿåˆ—ç”¨äºå¤„ç†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯.</li>\n</ul>\n<p>åœ¨åé¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šç€é‡çš„å­¦ä¹ è¿™å‡ ç§ç‰¹æ€§ã€‚</p>\n<h2 id=\"rocketmqçš„ç»„æˆéƒ¨åˆ†\"><a class=\"markdownIt-Anchor\" href=\"#rocketmqçš„ç»„æˆéƒ¨åˆ†\">#</a> RocketMQ çš„ç»„æˆéƒ¨åˆ†</h2>\n<p><code>Apache RocketMQ</code>  æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯å’Œæµåª’ä½“å¹³å°ï¼Œå…·æœ‰ä½å»¶è¿Ÿã€é«˜æ€§èƒ½å’Œå¯é æ€§ã€ä¸‡äº¿çº§å®¹é‡å’Œçµæ´»çš„å¯ä¼¸ç¼©æ€§ã€‚å®ƒç”±å››éƒ¨åˆ†ç»„æˆ:  <code>NameServer</code> ã€ <code>Broker</code> ã€ <code>Producer</code>  å’Œ <code>Consumer</code> ã€‚å®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯å¯ä»¥é›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼Œéƒ½å¯ä»¥æ°´å¹³åœ°æ‰©å±•ï¼Œè€Œä¸éœ€è¦å•ä¸ªæ•…éšœç‚¹ã€‚å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"/images/rocketmq/1-01-rmq-basic-arc.png\" alt=\"\"></p>\n<h3 id=\"nameserver-cluster\"><a class=\"markdownIt-Anchor\" href=\"#nameserver-cluster\">#</a> NameServer cluster</h3>\n<p><code>NameServer</code>  æä¾›è½»é‡çº§æœåŠ¡å‘ç°åŠŸèƒ½å’Œæ¶ˆæ¯è·¯ç”±åŠŸèƒ½ã€‚ æ¯ä¸ª  <code>Name Server</code>  è®°å½•å®Œæ•´çš„è·¯ç”±ä¿¡æ¯â€‹â€‹ï¼Œæä¾›ç›¸åº”çš„è¯»å†™æœåŠ¡ï¼Œå¹¶æ”¯æŒå¿«é€Ÿå­˜å‚¨æ‰©å±•ã€‚</p>\n<h3 id=\"broker-cluster\"><a class=\"markdownIt-Anchor\" href=\"#broker-cluster\">#</a> Broker Cluster</h3>\n<p><code>Broker</code>  é€šè¿‡æä¾›è½»é‡çº§çš„ <code>TOPIC</code>  å’Œ <code>QUEUE</code>  æœºåˆ¶æ¥å¤„ç†æ¶ˆæ¯å­˜å‚¨ã€‚å®ƒä»¬æ”¯æŒ <code>Push</code>  å’Œ <code>Pull</code>  æ¨¡å‹ï¼ŒåŒ…å«å®¹é”™æœºåˆ¶ ( <code>2</code>  ä¸ªæˆ– <code>3</code>  ä¸ªå‰¯æœ¬)ï¼Œå¹¶æä¾›å¼ºå¤§çš„å³°å€¼å¡«å……å’Œä»¥åŸå§‹æ—¶é—´é¡ºåºç§¯ç´¯æ•°åƒäº¿æ¡æ¶ˆæ¯çš„èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œ <code>broker</code>  è¿˜æä¾›äº†ç¾éš¾æ¢å¤ã€ä¸°å¯Œçš„æŒ‡æ ‡ç»Ÿè®¡ä¿¡æ¯å’Œè­¦æŠ¥æœºåˆ¶ï¼Œè¿™äº›éƒ½æ˜¯ä¼ ç»Ÿæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿæ‰€ç¼ºä¹çš„ã€‚</p>\n<h3 id=\"producer-cluster\"><a class=\"markdownIt-Anchor\" href=\"#producer-cluster\">#</a> Producer Cluster</h3>\n<p>ç”Ÿäº§è€…æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚åˆ†å¸ƒå¼ç”Ÿäº§è€…é€šè¿‡å¤šç§è´Ÿè½½å¹³è¡¡æ¨¡å¼å‘ <code>Broker</code>  é›†ç¾¤å‘é€æ¶ˆæ¯ã€‚å‘é€è¿›ç¨‹æ”¯æŒå¿«é€Ÿæ•…éšœå’Œä½å»¶è¿Ÿã€‚</p>\n<h3 id=\"consumer-cluster\"><a class=\"markdownIt-Anchor\" href=\"#consumer-cluster\">#</a> Consumer Cluster</h3>\n<p>æ¶ˆè´¹è€…ä¹Ÿæ”¯æŒ <code>Push</code>  å’Œ <code>Pull</code>  æ¨¡å‹ä¸­çš„åˆ†å¸ƒå¼éƒ¨ç½²ã€‚å®ƒè¿˜æ”¯æŒé›†ç¾¤æ¶ˆè´¹å’Œæ¶ˆæ¯å¹¿æ’­ã€‚å®ƒæä¾›äº†å®æ—¶æ¶ˆæ¯è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°ç”¨æˆ·çš„éœ€æ±‚ã€‚</p>\n<p>ä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä¸€ä¸‹ å…³äº <code>RocketMQ</code>  çš„ç›¸å…³æ¦‚å¿µã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/rocketMQ/README/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/rocketMQ/README/",
            "title": "RocketMQç³»åˆ—-å¼€ç¯‡",
            "date_published": "2021-09-01T09:16:00.000Z",
            "content_html": "<h2 id=\"å¼€ç¯‡\"><a class=\"markdownIt-Anchor\" href=\"#å¼€ç¯‡\">#</a> å¼€ç¯‡</h2>\n<p>å†™è¿™ç¯‡æ–‡ç« çš„æ—¶é—´æ˜¯ <code>2021</code>  å¹´ <code>9</code>  æœˆ <code>1</code>  æ—¥ï¼Œä¸çŸ¥é“æ˜¯å¦æœ‰å‹‡æ°”å†™å®Œå…¨éƒ¨ç³»åˆ—ä¹‹åå†å‘å¸ƒç»™å¤§å®¶ï¼Œè¿™åªèƒ½ç®—æ˜¯è‡ªå·±å­¦ä¹  <code>RocketMQ</code>  çš„ç¬”è®°å§ã€‚å¸Œæœ›åœ¨ 2021 å¹´çš„å¹´åº•èƒ½å¤Ÿå°†æ•´ä¸ªç³»åˆ—å®Œæ•´çš„å‘å¸ƒåˆ°æ–¹å®¶å°ç™½å…¬ä¼—å·å’Œ <a href=\"https://fangjiaxiaobai.github.io/\">fangjiaxiaobai.github.io</a> åšå®¢ä¸­ã€‚æƒ³å†™çš„æ–‡ç« ä¹Ÿè¿˜æœ‰å¾ˆå¤šï¼ŒåŒæ—¶åœ¨å†™çš„æœ‰ ã€ŠJava çš„ Stream å¹¶è¡Œæµè®¾è®¡ã€‹ å’Œ  ã€ŠèŠèŠé¢è¯•é‚£ç‚¹äº‹ã€‹ã€‚</p>\n<p>2021 å¹´å›½å®¶å‘å¸ƒäº†å¾ˆå¤šæ”¿ç­–ï¼Œå°¤å…¶æ˜¯äº’è”ç½‘è¡Œä¸šï¼Œç‰¹åˆ«æ˜¯ åœ¨çº¿æ•™è‚²ï¼Œæˆ‘å‰äº›æ—¥å­é‡Œä¹Ÿæ˜¯ä¸€ååœ¨çº¿æ•™è‚²ä»ä¸šè€…ã€‚</p>\n<p>è€Œå†™è¿™ä¸ªç³»åˆ—çš„æœ€æ ¹æœ¬çš„åŸå› ï¼Œä¹Ÿæ˜¯å› ä¸ºè¢«äººå¸¸é—®çš„å°±æ˜¯  <code>RocketMQ</code>  çš„åº•å±‚åŸç†ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œæˆ‘å¹¶ç­”ä¸ä¸Šæ¥ã€‚æ‰€ä»¥ï¼Œæ¬ è‡ªå·±çš„å€ºï¼Œæ€»æ˜¯éœ€è¦è¿˜çš„ã€‚</p>\n<p>è¶ç€ç©ºæ¡£æœŸï¼Œæ‰€ä»¥ä»é›¶åˆ°ä¸€çš„å»èŠèŠè¿™ <code>RocketMQ</code> .</p>\n<p>ç›¸ä¿¡å¾ˆå¤šåŒå­¦éƒ½æ˜¯æˆ–å¤šæˆ–å°‘çš„ä½¿ç”¨è¿‡ <code>RocketMQ</code> , è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»é›¶åˆ°ä¸€çš„å»å­¦ä¹ ã€‚ç¬¬ä¸€ç¯‡ï¼Œç¬¬äºŒç¯‡éƒ½æ˜¯æ¯”è¾ƒæ¯ç‡¥çš„å†…å®¹ï¼Œæœ¬ç€ç†è®ºå…ˆè¡Œçš„åŸåˆ™ï¼Œæˆ‘ä»¬ä¼šå»äº†è§£  <code>RoctMQ</code>  çš„å‘å±•å†ç¨‹ï¼Œå’Œ  <code>RocketMQ</code>  ä¸­ä½¿ç”¨çš„æ¦‚å¿µã€‚ ç¬¬ä¸‰ç¯‡æˆ‘ä»¬å°±ä¼š è‡ªå·±æ­å»º <code>RocketMQ</code>  é›†ç¾¤ï¼Œä¸ºæˆ‘ä»¬åé¢çš„æ¡ˆä¾‹å’ŒåŸç†å­¦ä¹ è¿ˆå‡ºå…·æœ‰é‡Œç¨‹ç¢‘æ„ä¹‰çš„ä¸€æ­¥ã€‚</p>\n<h2 id=\"ç›®å½•\"><a class=\"markdownIt-Anchor\" href=\"#ç›®å½•\">#</a> ç›®å½•</h2>\n<h3 id=\"å…¥é—¨\"><a class=\"markdownIt-Anchor\" href=\"#å…¥é—¨\">#</a> å…¥é—¨</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> <a href=\"/2021/09/01/rocketMQ/1-01-RocketMQ%E7%AE%80%E4%BB%8B/\">Rocket ç³»åˆ— - å…¥é—¨</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> <a href=\"/2021/09/02/rocketMQ/1-02-RocketMQ%E6%A6%82%E5%BF%B5/\">æ¦‚å¿µ</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> <a href=\"/2021/09/03/rocketMQ/1-03-RocketMQ%E6%90%AD%E5%BB%BA/\">å®‰è£…</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" checked=\"true\" disabled=\"true\"><label for=\"cbx_3\"> <a href=\"/2021/09/04/rocketMQ/1-04-00.RocketMQ%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/\">ä½¿ç”¨</a></label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> <a href=\"/2021/09/04/rocketMQ/1-04-01.%E5%9F%BA%E6%9C%AC%E6%A0%B7%E4%BE%8B/\">åŸºæœ¬æ ·ä¾‹</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\"><label for=\"cbx_5\"> <a href=\"/2021/09/06/rocketMQ/1-04-02.%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF/\">é¡ºåºæ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" checked=\"true\" disabled=\"true\"><label for=\"cbx_6\"> <a href=\"/2021/09/23/rocketMQ/1-04-03.%E5%BB%B6%E6%97%B6%E6%B6%88%E6%81%AF/\">å»¶æ—¶æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" checked=\"true\" disabled=\"true\"><label for=\"cbx_7\"> <a href=\"/2021/09/23/rocketMQ/1-04-04.%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF/\">æ‰¹é‡æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" checked=\"true\" disabled=\"true\"><label for=\"cbx_8\"> <a href=\"/2021/09/23/rocketMQ/1-04-05.%E8%BF%87%E6%BB%A4%E6%B6%88%E6%81%AF/\">è¿‡æ»¤æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_9\" checked=\"true\" disabled=\"true\"><label for=\"cbx_9\"> <a href=\"/2021/09/23/rocketMQ/1-04-06.%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/\">äº‹åŠ¡æ¶ˆæ¯</a></label></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"è¿›é˜¶æ¶æ„è®¾è®¡\"><a class=\"markdownIt-Anchor\" href=\"#è¿›é˜¶æ¶æ„è®¾è®¡\">#</a> è¿›é˜¶ (æ¶æ„è®¾è®¡)</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_10\" checked=\"true\" disabled=\"true\"><label for=\"cbx_10\"> <a href=\"/2021/09/28/rocketMQ/2-01-RocketMQ-Arch-Start/\">æ¶æ„è®¾è®¡ä¹‹å¯åŠ¨è¿‡ç¨‹è¯¦è§£</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_11\" checked=\"true\" disabled=\"true\"><label for=\"cbx_11\"> <a href=\"/2021/09/28/rocketMQ/2-02-RocketMQ-Arch-Message/\">æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯çš„æ”¶å‘è¿‡ç¨‹è¯¦è§£</a></label></li>\n</ul>\n<h3 id=\"é«˜æ‰‹ç»†èŠ‚è®¾è®¡-è§£è¯»æºç \"><a class=\"markdownIt-Anchor\" href=\"#é«˜æ‰‹ç»†èŠ‚è®¾è®¡-è§£è¯»æºç \">#</a> é«˜æ‰‹ (ç»†èŠ‚è®¾è®¡ï¼Œè§£è¯»æºç )</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_12\" checked=\"true\" disabled=\"true\"><label for=\"cbx_12\"> <a href=\"/2022/01/02/rocketMQ/3-01-RocketMQ-Transaction-msg/\">äº‹åŠ¡æ¶ˆæ¯å®ç°åŸç†</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_13\" disabled=\"true\"><label for=\"cbx_13\"> å»¶æ—¶æ¶ˆæ¯å®ç°åŸç†</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_14\" checked=\"true\" disabled=\"true\"><label for=\"cbx_14\"> <a href=\"/2022/05/16/rocketMQ/3-02-reliabllity-msg/\">æ¶ˆæ¯å¯é æ€§å®ç°åŸç†</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_15\" disabled=\"true\"><label for=\"cbx_15\"> æ¶ˆæ¯å¯é æ€§å®ç°åŸç†</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_16\" disabled=\"true\"><label for=\"cbx_16\"> è´Ÿè½½å‡è¡¡åŸç†</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_17\" disabled=\"true\"><label for=\"cbx_17\"> æ¶ˆæ¯è¿‡æ»¤åŸç†</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_18\" disabled=\"true\"><label for=\"cbx_18\"> æ¶ˆæ¯é‡æ”¾åŸç†</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_19\" disabled=\"true\"><label for=\"cbx_19\"> å»¶æ—¶æ¶ˆæ¯å®ç°åŸç†</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_20\" disabled=\"true\"><label for=\"cbx_20\"> æ¶ˆè´¹è€…çš„ <code>Rebalance</code>  æœºåˆ¶</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_21\" checked=\"true\" disabled=\"true\"><label for=\"cbx_21\"> <a href=\"/2022/07/09/rocketMQ/3-08-save-msg-detail/\">æ¶ˆæ¯åˆ·ç›˜è¿‡ç¨‹è¯¦è§£</a></label></li>\n</ul>\n<h3 id=\"å®—å¸ˆ\"><a class=\"markdownIt-Anchor\" href=\"#å®—å¸ˆ\">#</a> å®—å¸ˆ</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_22\" disabled=\"true\"><label for=\"cbx_22\"> å®¹ç¾</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_23\" disabled=\"true\"><label for=\"cbx_23\"> è¿ç»´å·¥å…· <code>mqadmin</code>  çš„ä½¿ç”¨</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_24\" disabled=\"true\"><label for=\"cbx_24\"> æœ€ä½³å®è·µï¼ˆ <code>Best Practice</code> ï¼‰</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_25\" disabled=\"true\"><label for=\"cbx_25\"> å¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±ä¿è¯æ¶ˆæ¯çš„å¯é æ€§</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_26\" disabled=\"true\"><label for=\"cbx_26\"> å¦‚ä½•é¿å…æ¶ˆæ¯é‡å¤æ¶ˆè´¹</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_27\" disabled=\"true\"><label for=\"cbx_27\"> å¦‚ä½•å®ç°äº‹åŠ¡æ¶ˆæ¯ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</label></li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/rocketmq/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "RocketMQ",
                "æ¶ˆæ¯é˜Ÿåˆ—"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/",
            "title": "å†’æ³¡æ’åº",
            "date_published": "2021-09-01T04:47:55.000Z",
            "content_html": "<h2 id=\"åŸºæœ¬æ€æƒ³\"><a class=\"markdownIt-Anchor\" href=\"#åŸºæœ¬æ€æƒ³\">#</a> åŸºæœ¬æ€æƒ³</h2>\n<p>æ¯æ¬¡éƒ½æ“ä½œä¸¤ä¸ªç›¸é‚»çš„æ•°æ®ã€‚æ¯æ¬¡å†’æ³¡æ“ä½œéƒ½å¯¹ç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¤§å°å…³ç³»è¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œå°±è¿›è¡Œäº’æ¢ã€‚æ¯æ¬¡å†’æ³¡éƒ½ä¼šå†’å‡ºä¸€ä¸ªæœ€å° / å¤§å€¼ï¼Œå¹¶ç§»åŠ¨åˆ°å®ƒåº”è¯¥åœ¨çš„ä½ç½®ã€‚é‡å¤ n æ¬¡ï¼Œå°±å®Œæˆäº†å¯¹ n ä¸ªæ•°æ®çš„æ’åºå·¥ä½œ.</p>\n<h2 id=\"æ’åºé€»è¾‘å›¾\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºé€»è¾‘å›¾\">#</a> æ’åºé€»è¾‘å›¾</h2>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E6%8E%92%E5%BA%8F01-%E5%86%92%E6%B3%A1%E6%B3%95%E6%8E%92%E5%BA%8F01.png\" alt=\"ç®—æ³•01-æ’åº01-å†’æ³¡æ³•æ’åº01\"></p>\n<p>è¿™é‡Œåœ¨è¯¦ç»†çš„å†™ä¸€ä¸‹ç¬¬ä¸€æ¬¡æ’åºçš„è¿‡ç¨‹ï¼š</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E6%8E%92%E5%BA%8F01-%E5%86%92%E6%B3%A1%E6%B3%95%E6%8E%92%E5%BA%8F02.png\" alt=\"ç®—æ³•01-æ’åº01-å†’æ³¡æ³•æ’åº02.png\"></p>\n<p>æŒ‰ç…§ä»¥ä¸Šé€»è¾‘çš„ä»£ç å®ç°</p>\n<h2 id=\"ç®—æ³•å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#ç®—æ³•å®ç°\">#</a> ç®—æ³•å®ç°</h2>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> *<span class=\"title\">bubble_sort</span><span class=\"params\">(<span class=\"keyword\">int</span> *a, <span class=\"keyword\">int</span> length)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &lt; length-i; j++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (a[j - <span class=\"number\">1</span>] &gt; a[j]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> temp = a[j - <span class=\"number\">1</span>];</span><br><span class=\"line\">                a[j - <span class=\"number\">1</span>] = a[j];</span><br><span class=\"line\">                a[j] = temp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// print(a, length);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™ç§å®ç°ï¼Œåœ¨è¿™ç§æƒ…æ™¯ä¸‹ï¼Œå°±ä¼šæµªè´¹æ—¶é—´ã€‚</p>\n<p>å¦‚æœåŸå§‹æ•°ç»„ä¸º:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[5,0,1,2,3,4]</span><br></pre></td></tr></table></figure>\n<p>æ’åºè¿‡ç¨‹å¦‚ä¸‹:</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E6%8E%92%E5%BA%8F01-%E5%86%92%E6%B3%A1%E6%B3%95%E6%8E%92%E5%BA%8F03.png\" alt=\"ç®—æ³•01-æ’åº01-å†’æ³¡æ³•æ’åº03.png\"></p>\n<p>å¯ä»¥å‘ç°ï¼Œåœ¨å®Œæˆç¬¬ä¸€è¶Ÿæ’åºçš„æ—¶å€™ï¼Œå®é™…ä¸Šå·²ç»æ˜¯æ­£ç¡®çš„æ’åºç»“æœäº†ã€‚æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>* <span class=\"title\">bubble_sort</span><span class=\"params\">(<span class=\"keyword\">int</span> *a, <span class=\"keyword\">int</span> length)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> flag = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">1</span>; j &lt; length - i; j++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (a[j - <span class=\"number\">1</span>] &gt; a[j]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> temp = a[j - <span class=\"number\">1</span>];</span><br><span class=\"line\">                a[j - <span class=\"number\">1</span>] = a[j];</span><br><span class=\"line\">                a[j] = temp;</span><br><span class=\"line\">                flag = <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!flag) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//print(a, length);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡º:</p>\n<ul>\n<li>å†’æ³¡æ’åºæ˜¯åŸºäºæ¯”è¾ƒï¼Œäº¤æ¢çš„æ’åºç®—æ³•ã€‚</li>\n<li>å†’æ³¡æ’åºä½¿ç”¨çš„ç©ºé—´å¤æ‚åº¦ä¸º<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>, æ˜¯ä¸€ä¸ªåŸåœ°æ’åºç®—æ³•ã€‚</li>\n<li>ä»¥ä¸Šä»£ç å®ç°çš„å†’æ³¡ç®—æ³•æ˜¯ç¨³å®šçš„æ’åºç®—æ³•.  <code>if(a[i]&lt;=a[j])</code>  å°±æ˜¯ä¸€ä¸ªä¸ç¨³å®šçš„æ’åºç®—æ³•äº†.</li>\n<li>å†’æ³¡ç®—æ³•æœ€å¥½æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>, æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>. é‚£å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿ</li>\n</ul>\n<h2 id=\"è®¡ç®—å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦\"><a class=\"markdownIt-Anchor\" href=\"#è®¡ç®—å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦\">#</a> è®¡ç®—å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦</h2>\n<p>è¿™é‡Œï¼Œæˆ‘ä»¬å¼•å…¥ä¸‰ä¸ªæ¦‚å¿µ</p>\n<ul>\n<li>æœ‰åºå…ƒç´ å¯¹ï¼šå¦‚æœ  <code>i&lt;j</code>  , å¹¶ä¸”  <code>a[i]&lt;a[j]</code> , é‚£ä¹ˆè¿™ä¸ªä¸€å¯¹å„¿æ•°å°±æ˜¯æœ‰åºçš„ã€‚</li>\n<li>é€†åºå…ƒç´ å¯¹ï¼šå¦‚æœ  <code>i&lt;j</code>  , å¹¶ä¸”  <code>a[i]&gt;a[j]</code> , é‚£ä¹ˆè¿™ä¸ªä¸€å¯¹å„¿æ•°å°±æ˜¯é€†åºçš„ã€‚</li>\n<li>æœ‰åºåº¦ï¼šæ•°ç»„ä¸­å…·æœ‰æœ‰åºå…³ç³»çš„å…ƒç´ å¯¹çš„ä¸ªæ•°.</li>\n<li>æ»¡æœ‰åºåº¦ï¼šå®Œå…¨æœ‰åºçš„æ•°åˆ—ã€‚</li>\n</ul>\n<p>å…¶ä¸­  <code>æ»¡æœ‰åºåº¦</code>  =  <code>æœ‰åºåº¦</code>  +  <code>é€†åºåº¦</code> ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­:</p>\n<p><strong> <code>[4,5,6,3,2,1]</code> </strong></p>\n<p>æœ‰åºåº¦ä¸º 3, ä¹Ÿç§°ä¸º <em>åŸå§‹æœ‰åºåº¦</em>, åˆ†åˆ«ä¸º:  <code>(4,5)</code>   <code>(4,6)</code>   <code>(5,6)</code></p>\n<p>æ»¡æœ‰åºåº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>n</mi><mo>âˆ—</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><mn>2</mn></mfrac><mo>=</mo><mn>15</mn></mrow><annotation encoding=\"application/x-tex\">\\frac {n*(n-1)}{2}=15</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">âˆ—</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">âˆ’</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">5</span></span></span></span></p>\n<p>å†’æ³¡æ’åºä¸­åŒ…å«ä¸¤ä¸ªæ“ä½œåŸå­ï¼Œæ¯”è¾ƒå’Œäº¤æ¢ã€‚æ²¡äº¤æ¢ä¸€æ¬¡ï¼Œæœ‰åºåº¦å°±ä¼šåŠ  1. æ‰€ä»¥ï¼Œäº¤æ¢æ¬¡æ•°ï¼Œå°±æ˜¯é€†æœ‰åºåº¦ã€‚ é‚£ä¹ˆï¼Œ <code>é€†æœ‰åºåº¦ = æ»¡æœ‰åºåº¦ - åˆå§‹æœ‰åºåº¦</code> ã€‚ä¹Ÿå°±æ˜¯: 15 - 3 = 12. éœ€è¦è¿›è¡Œ 12 æ¬¡æ“ä½œã€‚</p>\n<p>å¹³å‡æƒ…å†µä¸‹ï¼Œè¦è¿›è¡Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>n</mi><mo>âˆ—</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><mn>4</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac {n*(n-1)}{4}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">4</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">âˆ—</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mbin mtight\">âˆ’</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> æ¬¡æ“ä½œã€‚æ¯”è¾ƒæ“ä½œè‚¯å®šè¦æ¯”äº¤æ¢æ“ä½œå¤šï¼Œè€Œæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>, æ‰€ä»¥å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "æ’åº",
                "å†’æ³¡æ’åº",
                "äº¤æ¢æ’åº"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%A1%B6%E6%8E%92%E5%BA%8F/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%A1%B6%E6%8E%92%E5%BA%8F/",
            "title": "æ¡¶æ’åº",
            "date_published": "2021-09-01T04:42:55.000Z",
            "content_html": "<h2 id=\"æ’åºæ€æƒ³\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºæ€æƒ³\">#</a> æ’åºæ€æƒ³</h2>\n<p>æŠŠå°†è¦æ’åºçš„æ•°æ®åˆ†åˆ°å‡ ä¸ªæœ‰åºçš„æ¡¶é‡Œï¼Œæ¯ä¸ªåŒç†çš„æ•°æ®å†å•ç‹¬è¿›è¡Œæ’åºï¼Œæ¡¶å†…æ‹å®Œåºä¹‹åï¼Œå†æŠŠæ¯ä¸ªæ¡¶é‡Œçš„æ•°æ®æŒ‰ç…§é¡ºåºä¾æ¬¡å–å‡ºï¼Œç»„æˆçš„åºåˆ—å°±æ˜¯æœ‰åºçš„äº†.</p>\n<h2 id=\"æ’åºå®ç°é€»è¾‘\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºå®ç°é€»è¾‘\">#</a> æ’åºå®ç°é€»è¾‘</h2>\n<p><span class=\"label danger\">ğŸ’”å†…å®¹å¤ªé¥¿äº†ï¼Œç¦»å®¶å‡ºèµ°äº†â€¦</span></p>\n<h2 id=\"æ¡¶æ’åºç®—æ³•å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#æ¡¶æ’åºç®—æ³•å®ç°\">#</a> æ¡¶æ’åºç®—æ³•å®ç°</h2>\n<p><span class=\"label danger\">ğŸ’”å†…å®¹å¤ªé¥¿äº†ï¼Œç¦»å®¶å‡ºèµ°äº†â€¦</span></p>\n<h2 id=\"ç®—æ³•è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#ç®—æ³•è¯„ä¼°\">#</a> ç®—æ³•è¯„ä¼°</h2>\n<ul>\n<li>æ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>æ¡¶æ’åºä¸æ˜¯ç¨³å®šçš„æ’åºç®—æ³•</li>\n</ul>\n<h2 id=\"æ—¶é—´å¤æ‚åº¦åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#æ—¶é—´å¤æ‚åº¦åˆ†æ\">#</a> æ—¶é—´å¤æ‚åº¦åˆ†æ</h2>\n<p>å¦‚æœè¦æ’åºçš„æ•°æ®æœ‰ n ä¸ªï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬å‡åŒ€çš„åˆ†åˆ° m ä¸ªæ¡¶å†…ï¼Œæ¯ä¸ªæ¡¶é‡Œå°±æœ‰ k=n/m ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªæ¡¶å†…éƒ¨ä½¿ç”¨å¿«é€Ÿæ’åºï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>k</mi><mo>âˆ—</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(k*logk)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span>ã€‚ m ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mo>âˆ—</mo><mi>k</mi><mo>âˆ—</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(m*k*logk)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span>. å› ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">k = n / m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">m</span></span></span></span>, æ‰€ä»¥æ•´ä¸ªæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>âˆ—</mo><mi>l</mi><mi>o</mi><mi>g</mi><mfrac><mi>n</mi><mi>m</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">O(n*log{\\frac{n}{m}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.040392em;vertical-align:-0.345em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.695392em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>). å½“æ¡¶çš„ä¸ªæ•° m æ¥è¿‘æ•°æ®ä¸ªæ•° n æ—¶ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mfrac><mi>n</mi><mi>m</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">log\\frac{n}{m}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.040392em;vertical-align:-0.345em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.695392em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> å°±æ˜¯ä¸€ä¸ªéå¸¸å°çš„å¸¸é‡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ¡¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ¥è¿‘ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></p>\n<p>æ¡¶æ’åºçš„å¯¹æ’åºæ•°æ®çš„è¦æ±‚éå¸¸è‹›åˆ»ã€‚</p>\n<ul>\n<li>è¦æ’åºçš„æ•°æ®è¦å¾ˆå®¹æ˜“å°±èƒ½åˆ’åˆ†ä¸º m ä¸ªæ¡¶ï¼Œå¹¶ä¸” æ¡¶ä¸æ¡¶ ä¹‹é—´è¦æœ‰ç€å¤©ç„¶çš„å¤§å°é¡ºåº.</li>\n<li>æ•°æ®è¦åœ¨å„ä¸ªåŒä¹‹é—´çš„åˆ†å¸ƒæ—¶æ¯”è¾ƒå‡åŒ€çš„ã€‚ å¦‚æœç»è¿‡æ¡¶çš„åˆ’åˆ†ä¹‹åï¼Œæœ‰äº›æ¡¶é‡Œçš„æ•°æ®éå¸¸å¤šï¼Œæœ‰äº›éå¸¸å°‘ï¼Œå¾ˆä¸å‡åŒ€ï¼Œé‚£æ¡¶å†…æ•°æ®æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±ä¸æ˜¯ä¸€ä¸ªå¸¸é‡çº§äº†ã€‚åœ¨æç«¯çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½è¢«åˆ’åˆ†åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œé‚£å°±é€€åŒ–ä¸º<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(logn)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> çš„æ’åºç®—æ³•äº†.</li>\n</ul>\n<p>æ¡¶æ’åºæ¯”è¾ƒé€‚åˆæ°¸è½½å¤–éƒ¨æ’åºä¸­ã€‚æ‰€è°“çš„å¤–éƒ¨æ’åºå°±æ˜¯æ•°æ®å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜ä¸­ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå†…å­˜æœ‰é™ï¼Œ æ— æ³•æŠŠæ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ä¸‹é¢è¯´ä¸€ä¸ªä¾‹å­</p>\n<h2 id=\"æ¡¶æ’åºçš„åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#æ¡¶æ’åºçš„åº”ç”¨åœºæ™¯\">#</a> æ¡¶æ’åºçš„åº”ç”¨åœºæ™¯</h2>\n<p>å‡å¦‚æˆ‘ä»¬æœ‰ 10GB çš„è®¢å•æ•°æ®ï¼Œæˆ‘ä»¬å¸Œæœ› æŒ‰ç…§è®¢å•çš„é‡‘é¢è¿›è¡Œæ’åºï¼Œå¯æ˜¯å†…å­˜æœ‰é™ï¼Œåªæœ‰å‡ ç™¾ MB, æ€ä¹ˆè¿›è¡Œæ’åºå‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å¯ä»¥å…ˆæ‰«æä¸€éæ–‡ä»¶ï¼Œçœ‹è®¢å•é‡‘é¢æ‰€åœ¨çš„æ•°æ®èŒƒå›´ã€‚ å‡è®¾æ‰«æå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬æœ€å°çš„é‡‘é¢æ˜¯ 1 å…ƒï¼Œæœ€å¤§çš„æ—¶ 10 ä¸‡å…ƒï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸º 100 ä¸ªæ¡¶ï¼Œç¬¬ä¸€ä¸ªå­˜ 1-1000 å…ƒï¼Œç¬¬äºŒä¸ªå­˜ 1000-2000ï¼Œå¹¶ä¸”ï¼Œæ¯ä¸ªæ¡¶è¦æŒ‰ç…§é‡‘é¢å¤§å°å‘½å (00,01,02â€¦)ï¼Œä¾æ¬¡å¯¹æ¯ä¸ªæ¡¶ï¼Œè¿›è¡Œæ’åºå°±å¥½äº†.</p>\n<p>å¦‚æœï¼Œè¿™ä¸ª 10GB çš„æ•°æ®æ˜¯åˆ†å¸ƒä¸å‡åŒ€çš„ï¼Œå°±ä¼šé€ æˆæŸäº›æ–‡ä»¶ç‰¹å¤§ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å¯¹å¤§çš„æ–‡ä»¶è¿›è¡Œæ‹†åˆ†ã€‚ç»§ç»­è®²è¿™ä¸ªåŒºé—´çš„æ–‡ä»¶æ‹†æˆ 100 ä¸ªï¼Œå¦‚æœè¿˜ä¸èƒ½ï¼Œå†è¿›è¡Œæ‹†åˆ†ã€‚çŸ¥é“è¿™ä¸ªæ–‡ä»¶éƒ½å¯ä»¥è¯»å…¥å†…å­˜ä¸ºæ­¢ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "æ’åº",
                "æ¡¶æ’åº",
                "çº¿æ€§æ€æƒ³æ’åº"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/",
            "title": "å¿«é€Ÿæ’åº",
            "date_published": "2021-09-01T04:39:55.000Z",
            "content_html": "<h2 id=\"å¿«é€Ÿæ’åºæ€æƒ³\"><a class=\"markdownIt-Anchor\" href=\"#å¿«é€Ÿæ’åºæ€æƒ³\">#</a> å¿«é€Ÿæ’åºæ€æƒ³</h2>\n<p>å¿«é€Ÿæ’åºçš„æ ¸å¿ƒæ€æƒ³ä¹Ÿæ˜¯ åˆ†æ²»æ€æƒ³ã€‚</p>\n<p>å¿«é€Ÿæ’åºä¸»è¦è¦ä»¥å¾…æ’æ•°ç»„ä¸­çš„æŸä¸ªæ•°å­—ä¸ºåŸºå‡†ã€‚å°†æ•´ä¸ªæ•°ç»„ä¸­çš„æ•°æ®åˆ†ä¸ºå°äºåŸºå‡†çš„ä¸€ç»„å’Œå¤§äºç­‰äºåŸºäºçš„ä¸€ç»„.(æˆ–è€…æ˜¯å°äºç­‰äºåŸºå‡†çš„ä¸€ç»„å’Œå¤§äºåŸºäºçš„ä¸€ç»„), åˆ†åˆ«å¯¹æ¯ç»„è¿›è¡Œæ‹†åˆ†ï¼Œç›´åˆ°æ¯ç»„ä¸­åªæœ‰ä¸€ä¸ªæ•°æ®ã€‚</p>\n<p>é€’æ¨å…¬å¼å¦‚ä¸‹:</p>\n<p>å‡è®¾ <code>low</code>  ä¸ºå¾…æ’æ•°ç»„ä¸­çš„èµ·å§‹ç´¢å¼•. <code>high</code>  ä¸ºå¾…æ’æ•°ç»„ä¸­çš„ç»ˆæ­¢ç´¢å¼•.  <code>std</code>  ä¸ºåŸºå‡†çš„ç´¢å¼•.</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>q</mi><mi>u</mi><mi>i</mi><mi>c</mi><mi>k</mi><mi>S</mi><mi>o</mi><mi>r</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi>l</mi><mi>o</mi><mi>w</mi><mo separator=\"true\">,</mo><mi>h</mi><mi>i</mi><mi>g</mi><mi>h</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>q</mi><mi>u</mi><mi>i</mi><mi>c</mi><mi>k</mi><mi>S</mi><mi>o</mi><mi>r</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi>l</mi><mi>o</mi><mi>w</mi><mo separator=\"true\">,</mo><mi>s</mi><mi>t</mi><mi>d</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>q</mi><mi>u</mi><mi>i</mi><mi>c</mi><mi>k</mi><mi>S</mi><mi>o</mi><mi>r</mi><mi>t</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi>t</mi><mi>d</mi><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>h</mi><mi>i</mi><mi>g</mi><mi>h</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">quickSort(low,high) = quickSort(low,std-1)+quickSort(std+1,high)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">h</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">h</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>ç»ˆæ­¢æ¡ä»¶ä¸º:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>l</mi><mi>o</mi><mi>w</mi><mo>&gt;</mo><mo>=</mo><mi>h</mi><mi>i</mi><mi>g</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">low&gt;=high\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.73354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">h</span></span></span></span></span></p>\n<h2 id=\"æ’åºè¿‡ç¨‹å›¾\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºè¿‡ç¨‹å›¾\">#</a> æ’åºè¿‡ç¨‹å›¾</h2>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E6%8E%92%E5%BA%8F04-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F01.png\" alt=\"ç®—æ³•01-æ’åº04-å¿«é€Ÿæ’åº01.png\"></p>\n<p>ç®€å•è§£é‡Šä¸‹:</p>\n<p>æˆ‘ä»¬é¦–å…ˆé€‰å®šåŸºå‡†ï¼Œå‡è®¾ä»¥æœ¬æ¬¡é€’å½’çš„ç¬¬ä¸€ä¸ªæ•°ä¸ºåŸºå‡†ï¼Œè¿›è¡Œæ’åº.<br>\n å¦‚å›¾ï¼šç¬¬ä¸€æ¬¡é€’å½’çš„åŸºå‡†ä¸º 5, æˆ‘æŠŠå¤§äº 5 çš„æ•°ï¼Œæ”¾åœ¨å³ä¾§ï¼Œå°äº 5 çš„æ•°æ”¾åœ¨å·¦ä¾§ï¼Œ(ä¾‹å­ä¸­æ²¡æœ‰å¤§çº¦ 5 çš„æ•°)ï¼Œç¬¬äºŒæ¬¡ä»¥ 0 ä¸ºåŸºå‡†ï¼ŒæŠŠå¤§äº 0 çš„æ•°ï¼Œæ”¾åœ¨å³ä¾§ï¼Œå°äº 0 çš„æ•°ï¼Œæ”¾åœ¨å·¦ä¾§ã€‚é‡å¤è¿™æ ·çš„é€»è¾‘ï¼Œç›´åˆ°æœ€åä¸€æ¬¡é€’å½’ã€‚</p>\n<h2 id=\"æ’åºä»£ç å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºä»£ç å®ç°\">#</a> æ’åºä»£ç å®ç°</h2>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">quick_sort</span><span class=\"params\">(<span class=\"keyword\">int</span> *a, <span class=\"keyword\">int</span> low, <span class=\"keyword\">int</span> high)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (low &gt;= high) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = low;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> j = high;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> <span class=\"built_in\">std</span> = a[low];</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt; j) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i&lt;j&amp;&amp;a[j] &gt;= <span class=\"built_in\">std</span>) &#123;</span><br><span class=\"line\">            j--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a[j] &lt; <span class=\"built_in\">std</span>) &#123;</span><br><span class=\"line\">            a[i++] = a[j];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i&lt;j&amp;&amp;a[i] &lt;= <span class=\"built_in\">std</span>) &#123;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a[i] &gt; <span class=\"built_in\">std</span>) &#123;</span><br><span class=\"line\">            a[j--] = a[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    a[i] = <span class=\"built_in\">std</span>;</span><br><span class=\"line\">    quick_sort(a, low, i - <span class=\"number\">1</span>);</span><br><span class=\"line\">    quick_sort(a, i + <span class=\"number\">1</span>, high);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"å¿«é€Ÿæ’åºçš„ä¼˜åŒ–\"><a class=\"markdownIt-Anchor\" href=\"#å¿«é€Ÿæ’åºçš„ä¼˜åŒ–\">#</a> å¿«é€Ÿæ’åºçš„ä¼˜åŒ–</h2>\n<p>ä¹‹å‰è¯´ï¼Œ å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦é€€åŒ–åˆ° <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> çš„ä¸»è¦åŸå› æ˜¯ï¼šåˆ†åŒºç‚¹é€‰çš„ä¸å¤Ÿåˆç†.</p>\n<p>æœ€ç†æƒ³çš„åˆ†åŒºç‚¹æ˜¯ï¼šè¢«åˆ†åŒºç‚¹åˆ†å¼€çš„ä¸¤ä¸ªåˆ†åŒºä¸­ï¼Œæ•°æ®çš„æ•°é‡å·®ä¸å¤š.</p>\n<p>ä¸ºäº†æé«˜æ’åºç®—æ³•çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿè¦å°½å¯èƒ½çš„è®©æ¯æ¬¡åˆ†åŒºéƒ½æ¯”è¾ƒå‡åŒ€.</p>\n<p>æ¯”è¾ƒå¸¸ç”¨ï¼Œæ¯”è¾ƒç®€å•çš„é€‰æ‹©åˆ†åŒºç‚¹çš„æ–¹æ³•æœ‰:</p>\n<ul>\n<li>ä¸‰æ•°å–ä¸­æ³•</li>\n</ul>\n<p>æˆ‘ä»¬ä»æŸä¸ªåŒºé—´çš„é¦–ï¼Œå°¾ï¼Œä¸­é—´ï¼Œ åˆ†åˆ«å–å‡ºä¸€ä¸ªæ•°ï¼Œç„¶åå¯¹æ¯”å¤§å°ï¼Œå–è¿™ä¸‰ä¸ªæ•°æ®çš„ä¸­é—´å€¼ä½œä¸ºåˆ†åŒºç‚¹ã€‚ ä¹Ÿå¯ä»¥å¤šå–å‡ ä¸ªåŒºé—´ï¼Œå–å‡ºä¸­é—´å€¼ï¼Œç„¶ååœ¨è¿™äº›ä¸­é—´å€¼ï¼Œå–å‡ºä¸­é—´å€¼ã€‚æ¯”å¦‚ä¸‰æ•°å–ä¸­ï¼Œäº”æ•°å–ä¸­ï¼Œåæ•°å–ä¸­ç­‰ç­‰ã€‚</p>\n<ul>\n<li>éšæœºæ³•</li>\n</ul>\n<p>æ¯æ¬¡éƒ½ä»æ’åºçš„åŒºé—´ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸ºåˆ†åŒºç‚¹ã€‚</p>\n<p>è¿™ç§æ–¹å¼ï¼Œå¹¶ä¸èƒ½ä¿è¯æ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰çš„æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä»æ¦‚ç‡çš„è§’åº¦æ¥çœ‹ï¼Œä¹Ÿä¸å¤§å¯èƒ½å‡ºç°æ¯æ¬¡åˆ†åŒºç‚¹éƒ½é€‰çš„å¾ˆå·®çš„æƒ…å†µã€‚æ‰€ä»¥æ—¶é—´å¤æ‚åº¦é€€åŒ–ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> çš„æƒ…å†µï¼Œå¯èƒ½æ€§ä¹Ÿä¸å¤§ã€‚</p>\n<h2 id=\"å¿«æ’ç®—æ³•è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#å¿«æ’ç®—æ³•è¯„ä¼°\">#</a> å¿«æ’ç®—æ³•è¯„ä¼°</h2>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ä¸º æœ€å¥½æƒ…å†µä¸‹ä¸º<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(nlogn)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>, æœ€åæƒ…å†µä¸‹ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>, å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸º:</li>\n<li>ç©ºé—´å¤æ‚åº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>, æ˜¯ä¸€ç§åŸåœ°æ’åºç®—æ³•</li>\n<li>æ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•.</li>\n</ul>\n<p>æ³¨æ„ï¼šå¿«æ’ç®—æ³•è™½ç„¶åœ¨æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> , ä½†æ˜¯åœ¨å¹³å‡æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(nlogn)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>ï¼Œä¸å°½å¦‚æ­¤ï¼Œå¿«æ’çš„æ—¶é—´å¤æ‚åº¦é€€åŒ–åˆ° <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> çš„æ¦‚ç‡éå¸¸å°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åˆç†é€‰æ‹©åŸºå‡†çš„æ–¹å¼æ¥é¿å…è¿™æ€»æƒ…å†µ.</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "æ’åº",
                "å¿«é€Ÿæ’åº",
                "åˆ†æ”¯æ€æƒ³æ’åº"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0/",
            "title": "ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„å®ç°",
            "date_published": "2021-09-01T04:36:55.000Z",
            "content_html": "<p>ä¸Šä¸€ç¯‡ä»‹ç»äº† å“ˆå¸Œç®—æ³•å’Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åŸç†ï¼Œæˆ‘ä»¬çŸ¥é“å“ˆå¸Œç®—æ³•åœ¨åˆ†å¸ƒå¼åœºæ™¯åº”ç”¨ä¸­å­˜åœ¨ç€å®šä½é—®é¢˜ã€‚æ‰€æœ‰æœ‰ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ã€‚<br>\nä»Šå¤©æˆ‘ä»¬å°±åŠ¨æ‰‹å®ç°ä»¥ä¸‹å“ˆå¸Œç®—æ³•ã€‚</p>\n<p>å¯é€‰æ€§ å›é¡¾ä¸€ä¸‹ <b><a href=\"/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/\">å“ˆå¸Œç®—æ³•å’Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</a></b></p>\n<h1 id=\"è¯´æ˜\"><a class=\"markdownIt-Anchor\" href=\"#è¯´æ˜\">#</a> è¯´æ˜</h1>\n<p>ä»¥ä¸‹å¤šæ¬¡å‡ºç°æœåŠ¡ç«¯èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯èŠ‚ç‚¹è¿™ä¸¤ä¸ªåå­—ï¼Œå«ä¹‰å¦‚ä¸‹ï¼š</p>\n<p>æœåŠ¡ç«¯èŠ‚ç‚¹ï¼š åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„ä¾‹å­ï¼ŒæœåŠ¡ç«¯èŠ‚ç‚¹å°±æ˜¯å¤šä¸ª Redis æœºå™¨ã€‚</p>\n<p>å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼š å°±æ˜¯è¦ç¼“å­˜çš„æ•°æ®ï¼Œè¿™é‡Œä½¿ç”¨è¿™ä¸¤ä¸ªåè¯æ¥ä»£è¡¨ä¸åŒçš„ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p>\n<h1 id=\"å®ç°åŠŸèƒ½\"><a class=\"markdownIt-Anchor\" href=\"#å®ç°åŠŸèƒ½\">#</a> å®ç°åŠŸèƒ½</h1>\n<p>ä»¥ä¸Šç¯‡ä¸­æåŠçš„åˆ†å¸ƒå¼ç¼“å­˜çš„ä¾‹å­ä¸ºèƒŒæ™¯å®ç°ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œä¸»è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼š</p>\n<ul>\n<li>\n<p>æ–°å¢æœåŠ¡èŠ‚ç‚¹</p>\n<p>åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç¯ï¼Œç„¶åå¯ä»¥å­˜æ”¾æœåŠ¡ç«¯èŠ‚ç‚¹ä¿¡æ¯ã€‚åç»­æ–°å¢èŠ‚ç‚¹ä¹Ÿèƒ½æ­£å¸¸å­˜å‚¨ã€‚</p>\n</li>\n<li>\n<p>æ ¹æ®å®¢æˆ·ç«¯èŠ‚ç‚¹æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡èŠ‚ç‚¹</p>\n<p>ä¼ å…¥å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® client çš„ä¿¡æ¯æˆ–è€…å…¶ä»–çš„ä¿¡æ¯è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œç„¶åç¡®å®šå­˜å‚¨çš„æœåŠ¡ç«¯èŠ‚ç‚¹ã€‚</p>\n</li>\n<li>\n<p>å®ç°æ ¹æ®æœåŠ¡ç«¯èŠ‚ç‚¹è¿›è¡Œåˆ é™¤</p>\n<p>æ¨¡æ‹Ÿå®ç°éƒ¨åˆ†æœåŠ¡ç«¯ä¸å¯ç”¨ã€‚å³ä¾‹å­ä¸­çš„ç¼“å­˜èŠ‚ç‚¹æŒ‚æ‰ã€‚</p>\n</li>\n</ul>\n<h1 id=\"å®ç°æ–¹æ¡ˆ\"><a class=\"markdownIt-Anchor\" href=\"#å®ç°æ–¹æ¡ˆ\">#</a> å®ç°æ–¹æ¡ˆ</h1>\n<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£è§„èŒƒï¼Œè§„å®šå¥½è¦å®ç°çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼Œä¿å­˜æœåŠ¡ç«¯èŠ‚ç‚¹ä¿¡æ¯ï¼Œå³æ–°å¢æ“ä½œï¼Œæ ¹æ®å®¢æˆ·ç«¯èŠ‚ç‚¹æ‰¾åˆ°æœåŠ¡èŠ‚ç‚¹çš„åŠŸèƒ½ï¼Œå³æŸ¥è¯¢æ“ä½œã€‚</p>\n<h2 id=\"æ’åºlistçš„å®ç°æ–¹å¼\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºlistçš„å®ç°æ–¹å¼\">#</a> æ’åº + List çš„å®ç°æ–¹å¼</h2>\n<p>ä¸»è¦æ€è·¯å¦‚ä¸‹ï¼š å°†æ‰€æœ‰çš„èŠ‚ç‚¹ä¿å­˜åˆ°ä¸€ä¸ª List ä¸­ã€‚ç„¶åå¯¹ List è¿›è¡Œ<b>æ’åº</b>ï¼Œå½“è·å–æœåŠ¡ç«¯èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåªéœ€è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª å“ˆå¸Œå€¼æ¯”ä»–å¤§çš„æœåŠ¡ç«¯èŠ‚ç‚¹çš„å°±å¯ä»¥äº†ã€‚</p>\n<p>ä¸è€ƒè™‘æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼š æœ€ä¼˜æ—¶é—´å¤æ‚åº¦ï¼šO (1)ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ç›®æ ‡èŠ‚ç‚¹ã€‚æœ€åæƒ…å†µä¸‹ï¼šO (n+1), æ‹›äº†ä¸€åœˆéƒ½æ²¡æœ‰æ‰¾åˆ°ã€‚æ‰€ä»¥å¹³å‡çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O (N)ã€‚<br>\né‚£æ’åºçš„æ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿæœ€å¿«çš„å°±æ˜¯ O (NlogN);</p>\n<p>ç»¼åˆä¸‹æ¥ï¼Œè¿™ç§å®ç°æ–¹æ¡ˆçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ï¼š O (NlogN)ã€‚</p>\n<p>ä¸»è¦å®ç°ä»£ç å¦‚ä¸‹ (æ–‡æœ«å®Œæ•´ä»£ç ï¼Œæ³¨é‡Šé¢‡å¤š)ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SortListConsistentHash</span> <span class=\"keyword\">implements</span> <span class=\"title\">ConsistentHash</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * hashç¯å®¹å™¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;NodeBucket&gt; hashCircle = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å“ˆå¸Œç®—æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     * é»˜è®¤ä½¿ç”¨ &#123;<span class=\"doctag\">@link</span> ConsistentHash#hash &#125;ç®—æ³•å®ç°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> HashHandle&lt;Node&gt; hashHandle;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SortListConsistentHash</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = <span class=\"keyword\">this</span>::hash;</span><br><span class=\"line\">        virtualNumber = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SortListConsistentHash</span><span class=\"params\">(HashHandle&lt;Node&gt; hashHandle)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = hashHandle;</span><br><span class=\"line\">        virtualNumber = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SortListConsistentHash</span><span class=\"params\">(HashHandle&lt;Node&gt; hashHandle, Integer virtualNumber)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = hashHandle;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.virtualNumber = virtualNumber;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SortListConsistentHash</span><span class=\"params\">(Integer virtualNumber)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = <span class=\"keyword\">this</span>::hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.virtualNumber = virtualNumber;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è™šæ‹ŸèŠ‚ç‚¹çš„æ•°ç›®,é»˜è®¤ä¸º1</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Integer virtualNumber;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ–°å¢æœåŠ¡èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value æœåŠ¡èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(ServerNode value)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (hashCircle == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            hashCircle = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; virtualNumber; i++) &#123;</span><br><span class=\"line\">            value.setVirtualNodeId(i);</span><br><span class=\"line\">            hashCircle.add(DefaultNodeBucket.of(value, (node) -&gt; hashHandle.hash(value)));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ’åº</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sort</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        hashCircle.sort(Comparator.comparingInt(NodeBucket::getHash));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰¾ä¸åˆ°ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> clientNode æ ¹æ® å®¢æˆ·ç«¯èŠ‚ç‚¹çš„Hashå€¼è·å–åˆ°ç›®æ ‡æœåŠ¡ç«¯èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ServerNode <span class=\"title\">getFirstNode</span><span class=\"params\">(ClientNode clientNode)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Integer hash = hash(clientNode);</span><br><span class=\"line\"></span><br><span class=\"line\">        Optional&lt;NodeBucket&gt; first = hashCircle.stream().filter(item -&gt; item.getHash() &gt; hash).findFirst();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> first.map(NodeBucket::getNode).orElse(hashCircle.get(<span class=\"number\">0</span>).getNode());</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è·å–æ‰€æœ‰æœåŠ¡èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> æ‰€æœ‰æœåŠ¡ç«¯èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ServerNode&gt; <span class=\"title\">getAllServerNodes</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.hashCircle.stream().map(NodeBucket::getNode).collect(Collectors.toList());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å“ˆå¸Œç®—æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> node èŠ‚ç‚¹çš„ä¿¡æ¯,å¯èƒ½æ˜¯å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯èƒ½æ˜¯æœåŠ¡ç«¯</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> å“ˆå¸Œå€¼</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">hash</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> ServerNode) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defaultStringHash(node.getIdentifier() + <span class=\"string\">&quot;#&quot;</span> + ((ServerNode) node).getVirtualNodeId());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defaultStringHash(node.getIdentifier());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> ServerNode) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hashCircle.remove(DefaultNodeBucket.of((ServerNode) node, hashHandle));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"çº¿æ€§è¡¨éå†çš„å®ç°æ–¹å¼\"><a class=\"markdownIt-Anchor\" href=\"#çº¿æ€§è¡¨éå†çš„å®ç°æ–¹å¼\">#</a> çº¿æ€§è¡¨éå†çš„å®ç°æ–¹å¼</h2>\n<p>é¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯çº¿æ€§è¡¨éå†çš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰æŒ‡å®šè¯´ä½¿ç”¨çš„æ•°ç»„è¿˜æ˜¯é“¾è¡¨ï¼Œæ ¹æ®å…·ä½“åœºæ™¯æ¥é€‰æ‹©å§ï¼Œå®ç°æ–¹å¼ç•¥æœ‰ä¸åŒã€‚æˆ‘ç”¨æ•°ç»„çš„å½¢å¼æ¥å®ç°ã€‚</p>\n<p>ä¸Šä¸€ç§å®ç°æ–¹å¼ï¼Œä½¿ç”¨äº†æ’åºå¯¼è‡´äº†æ—¶é—´å¤æ‚åº¦ä¸º O (NlogN)ã€‚é‚£ä¹ˆæˆ‘ä¸ç”¨æ’åºè¡Œä¸è¡Œï¼Ÿ</p>\n<p>å¯ä»¥çš„ï¼æˆ‘ä»¬é¦–å…ˆå°†æœåŠ¡ç«¯èŠ‚ç‚¹ä¿å­˜åˆ°æ•°ç»„ä¸­ï¼Œç„¶åæ ¹æ®å®¢æˆ·ç«¯å“ˆå¸Œå€¼å’ŒæœåŠ¡ç«¯èŠ‚ç‚¹å“ˆå¸Œå€¼çš„å·®ï¼Œæ‰¾å‡ºæœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚æ¯æ¬¡éå†å®ç°çš„è¯ï¼Œéå†ä¸€æ¬¡å°±å¯ä»¥äº†ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (N).</p>\n<p>ä¸»è¦å®ç°é€»è¾‘ä»£ç å¦‚ä¸‹ï¼ˆæ–‡æœ«æœ‰å®Œæ•´å®ç°ä»£ç ï¼Œæ³¨é‡Šé¢‡å¤šï¼‰ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TraverseArrayConsistentHash</span> <span class=\"keyword\">implements</span> <span class=\"title\">ConsistentHash</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä½¿ç”¨æ•°ç»„å®ç°çš„å“ˆå¸Œç¯</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NodeBucket[] hashCircle = <span class=\"keyword\">new</span> NodeBucket[]&#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> HashHandle&lt;Node&gt; hashHandle;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> defaultSize = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MaxSize = Integer.MAX_VALUE;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> length = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è™šæ‹ŸèŠ‚ç‚¹çš„æ•°ç›®,é»˜è®¤ä¸º1</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Integer virtualNumber;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TraverseArrayConsistentHash</span><span class=\"params\">(Integer initialCapacity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (initialCapacity &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.size = initialCapacity;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hashCircle = <span class=\"keyword\">new</span> NodeBucket[initialCapacity];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;initialCapacity must &gt; 0 &quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = <span class=\"keyword\">this</span>::hash;</span><br><span class=\"line\">        virtualNumber = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TraverseArrayConsistentHash</span><span class=\"params\">(Integer initialCapacity, Integer virtualNumber)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (initialCapacity &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.size = initialCapacity;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hashCircle = <span class=\"keyword\">new</span> NodeBucket[initialCapacity];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;initialCapacity must &gt; 0 &quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = <span class=\"keyword\">this</span>::hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.virtualNumber = virtualNumber;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TraverseArrayConsistentHash</span><span class=\"params\">(Integer initialCapacity, Integer virtualNumber, HashHandle&lt;Node&gt; hashHandle)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (initialCapacity &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.size = initialCapacity;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hashCircle = <span class=\"keyword\">new</span> NodeBucket[initialCapacity];</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">&quot;initialCapacity must &gt; 0 &quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.virtualNumber = virtualNumber;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = hashHandle;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">TraverseArrayConsistentHash</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = <span class=\"keyword\">this</span>::hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.virtualNumber = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(ServerNode serverNode)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ£€æŸ¥å¤§å°æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class=\"line\">        checkSize();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; virtualNumber; i++) &#123;</span><br><span class=\"line\">            serverNode.setVirtualNodeId(i);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hashCircle[length++] = DefaultNodeBucket.of(serverNode, hashHandle);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ£€æŸ¥æ•°ç»„å¤§å°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">checkSize</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.size = defaultSize;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hashCircle = <span class=\"keyword\">new</span> NodeBucket[size];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt;= MaxSize) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (length + <span class=\"number\">1</span> &gt; size) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.size = size &lt;&lt; <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hashCircle = Arrays.copyOf(<span class=\"keyword\">this</span>.hashCircle, size, NodeBucket[].class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">hash</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> ServerNode) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defaultStringHash(node.getIdentifier() + <span class=\"string\">&quot;#&quot;</span> + ((ServerNode) node).getVirtualNodeId());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defaultStringHash(node.getIdentifier());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> index = <span class=\"number\">0</span>; index &lt; size; index++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node.equals(hashCircle[index].getNode())) &#123;</span><br><span class=\"line\">                fastRemove(index);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">fastRemove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> numMoved = size - index - <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (numMoved &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            System.arraycopy(hashCircle, index+<span class=\"number\">1</span>, hashCircle, index,</span><br><span class=\"line\">                    numMoved);</span><br><span class=\"line\">        hashCircle[--size] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ServerNode <span class=\"title\">getFirstNode</span><span class=\"params\">(ClientNode clientNode)</span> </span>&#123;</span><br><span class=\"line\">        Integer hash = <span class=\"keyword\">this</span>.hashHandle.hash(clientNode);</span><br><span class=\"line\">        ServerNode findNode = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> min = Integer.MAX_VALUE;</span><br><span class=\"line\">        <span class=\"comment\">// æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æœåŠ¡ç«¯èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">            NodeBucket nodeBucket = <span class=\"keyword\">this</span>.hashCircle[i];</span><br><span class=\"line\">            <span class=\"keyword\">int</span> difference;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((difference = Math.abs(nodeBucket.getHash() - hash)) &lt; min) &#123;</span><br><span class=\"line\">                min = difference;</span><br><span class=\"line\">                findNode = nodeBucket.getNode();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> findNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ServerNode&gt; <span class=\"title\">getAllServerNodes</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Stream.of(<span class=\"keyword\">this</span>.hashCircle).map(NodeBucket::getNode).collect(Collectors.toList());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"sortedmapå®ç°æ–¹æ¡ˆ\"><a class=\"markdownIt-Anchor\" href=\"#sortedmapå®ç°æ–¹æ¡ˆ\">#</a> SortedMap å®ç°æ–¹æ¡ˆ</h2>\n<p>ä¸Šé¢ä¸¤ç§çš„å®ç°æ–¹æ¡ˆï¼Œå¹¶éæ˜¯æœ€ä¼˜çš„ã€‚æ ¹æœ¬åŸå› å°±æ˜¯<b>æ•°æ®ç»“æ„</b>çš„é™åˆ¶ã€‚ çº¿æ€§è¡¨å†³å®šäº†è¿™ä¸€åˆ‡ã€‚æˆ‘ä»¬è€ƒè™‘æ¢ä¸€ç§æ•°æ®ç»“æ„å‘¢ï¼Ÿ</p>\n<p>è€ƒè™‘ä¸‹ä½¿ç”¨<b>æ ‘</b>å½¢ç»“æ„</p>\n<p>æœ€å¿«çš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œå°±æ˜¯äºŒå‰å¹³è¡¡æ ‘äº†ã€‚äºŒå‰å¹³è¡¡æ ‘æœ‰ä¸¤ç§ AVL æ ‘å’Œçº¢é»‘æ ‘ã€‚</p>\n<p>æˆ‘ä»¬ä½¿ç”¨çº¢é»‘æ ‘ï¼Œå› ä¸ºçº¢é»‘æ ‘çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å­˜å‚¨<b>æœ‰åºçš„æ•°æ®</b>ï¼Œå¹¶ä¸”æŸ¥è¯¢åœ°æ•ˆç‡æ˜¯ O (logN)ã€‚</p>\n<p>è€ƒè™‘åˆ°æ‰‹å†™å®ç°ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œç€å®æœ‰ç‚¹å¤æ‚ï¼Œè¿™ç§æˆ‘ä»¬ä½¿ç”¨ JDK ä¸­çš„ TreeMap æ¥å®ç°ã€‚</p>\n<p>å°†æ‰€æœ‰çš„æœåŠ¡èŠ‚ç‚¹æ”¾åˆ° TreeMap ä¸­ï¼Œè¿™ç§ç»“æ„å¤©ç„¶æ”¯æŒæ’åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸»è¦çš„å®ç°æ‰¾åˆ°æœåŠ¡èŠ‚ç‚¹çš„è¿™ä¸ªè¿‡ç¨‹å°±å¥½äº†ã€‚</p>\n<p>é¦–å…ˆè®¡ç®—å‡ºå®¢æˆ·ç«¯çš„å“ˆå¸Œå€¼ï¼ŒæŸ¥è¯¢å‡ºå¤§äºè¯¥å“ˆå¸Œå€¼çš„æœåŠ¡èŠ‚ç‚¹çš„å­åºåˆ—ï¼Œå¦‚æœå­åºåˆ—ä¸ºç©ºè¿”å›åŸæ¥å“ˆå¸Œç¯çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦åˆ™ï¼Œè¿”å›å­åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ å³å¯ã€‚</p>\n<p>ä¸»è¦å®ç°ä»£ç å¦‚ä¸‹ (æ–‡æœ«æœ‰å®Œæ•´ä»£ç ï¼Œæ³¨é‡ŠçœŸçš„å¤šï¼)</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SortedMapConsistentHash</span> <span class=\"keyword\">implements</span> <span class=\"title\">ConsistentHash</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> SortedMap&lt;Integer, ServerNode&gt; hashCircle = <span class=\"keyword\">new</span> TreeMap&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> HashHandle&lt;Node&gt; hashHandle;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è™šæ‹ŸèŠ‚ç‚¹çš„æ•°ç›®,é»˜è®¤ä¸º1</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Integer virtualNumber;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SortedMapConsistentHash</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        virtualNumber = <span class=\"number\">1</span>;</span><br><span class=\"line\">        hashHandle = <span class=\"keyword\">this</span>::hash;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SortedMapConsistentHash</span><span class=\"params\">(<span class=\"keyword\">int</span> virtualNumber, HashHandle&lt;Node&gt; hashHandle)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.virtualNumber = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = hashHandle;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SortedMapConsistentHash</span><span class=\"params\">(<span class=\"keyword\">int</span> virtualNumber)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.virtualNumber = virtualNumber;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashHandle = <span class=\"keyword\">this</span>::hash;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(ServerNode serverNode)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// å®ç°è™šæ‹ŸèŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; virtualNumber; i++) &#123;</span><br><span class=\"line\">            serverNode.setVirtualNodeId(i);</span><br><span class=\"line\">            hashCircle.put(<span class=\"keyword\">this</span>.hashHandle.hash(serverNode), serverNode);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">hash</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> ServerNode) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defaultStringHash(node.getIdentifier() + <span class=\"string\">&quot;#&quot;</span> + ((ServerNode) node).getVirtualNodeId());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> defaultStringHash(node.getIdentifier());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">(Node node)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hashCircle.remove(hashHandle.hash(node));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ServerNode <span class=\"title\">getFirstNode</span><span class=\"params\">(ClientNode clientNode)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> hash = hash(clientNode);</span><br><span class=\"line\">        <span class=\"comment\">// è·å–å¤§äºå®¢æˆ·ç«¯å“ˆå¸Œå€¼çš„å­åºåˆ—</span></span><br><span class=\"line\">        SortedMap&lt;Integer, ServerNode&gt; subMap = hashCircle.tailMap(hash);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (subMap.isEmpty()) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å­åºåˆ—ä¸ºç©ºï¼Œè·å–å“ˆå¸Œç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">            Integer key = hashCircle.firstKey();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> hashCircle.get(key);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å­åºåˆ—ä¸ä¸ºç©ºï¼Œè·å–å­åºåˆ—çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">            Integer key = subMap.firstKey();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> subMap.get(key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;ServerNode&gt; <span class=\"title\">getAllServerNodes</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"keyword\">this</span>.hashCircle.values());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ServerNode <span class=\"title\">process</span><span class=\"params\">(ClientNode clientNode)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> getFirstNode(clientNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">````</span><br><span class=\"line\">æœ€åï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹,ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ç»“æœ:</span><br><span class=\"line\"></span><br><span class=\"line\">```java</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConsistentHashDemo</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        testSortListConsistentHash();</span><br><span class=\"line\">        testSortedMapConsistentHash();</span><br><span class=\"line\">        testTraverseArrayConsistentHash();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æµ‹è¯•ï¼Œä½¿ç”¨éå†çš„æ–¹å¼æ¥å®ç°ä¸€è‡´æ€§hashç®—æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">testTraverseArrayConsistentHash</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ConsistentHash sortedMapConsistentHash = <span class=\"keyword\">new</span> TraverseArrayConsistentHash();</span><br><span class=\"line\">        testConsistentHashCommonPart(sortedMapConsistentHash);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æµ‹è¯•ï¼Œä½¿ç”¨SortMapå®ç°çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">testSortedMapConsistentHash</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ConsistentHash sortedMapConsistentHash = <span class=\"keyword\">new</span> SortedMapConsistentHash(<span class=\"number\">3</span>);</span><br><span class=\"line\">        testConsistentHashCommonPart(sortedMapConsistentHash);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æµ‹è¯•ï¼Œä½¿ç”¨æ•°ç»„å’Œæ’åºæ–¹å¼å®ç°çš„ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">testSortListConsistentHash</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        SortListConsistentHash sortListConsistentHashMap = <span class=\"keyword\">new</span> SortListConsistentHash();</span><br><span class=\"line\">        testConsistentHashCommonPart(sortListConsistentHashMap);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æµ‹è¯• consistentHash ç®—æ³•ï¼Œå…¬å…±ä»£ç éƒ¨åˆ†</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> consistentHash ä¸€è‡´æ€§å“ˆå¸Œå®ä¾‹</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">testConsistentHashCommonPart</span><span class=\"params\">(ConsistentHash consistentHash)</span> </span>&#123;</span><br><span class=\"line\">        Stream.of(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ServerNode(<span class=\"string\">&quot;192.168.0.1&quot;</span>, UUID.randomUUID().toString(), <span class=\"string\">&quot;domain1.com&quot;</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ServerNode(<span class=\"string\">&quot;192.168.0.2&quot;</span>, UUID.randomUUID().toString(), <span class=\"string\">&quot;domain2.com&quot;</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ServerNode(<span class=\"string\">&quot;192.168.0.3&quot;</span>, UUID.randomUUID().toString(), <span class=\"string\">&quot;domain3.com&quot;</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ServerNode(<span class=\"string\">&quot;192.168.0.4&quot;</span>, UUID.randomUUID().toString(), <span class=\"string\">&quot;domain4.com&quot;</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ServerNode(<span class=\"string\">&quot;192.168.0.5&quot;</span>, UUID.randomUUID().toString(), <span class=\"string\">&quot;domain5.com&quot;</span>),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> ServerNode(<span class=\"string\">&quot;192.168.0.6&quot;</span>, UUID.randomUUID().toString(), <span class=\"string\">&quot;domain6.com&quot;</span>)</span><br><span class=\"line\">        ).forEach(consistentHash::add);</span><br><span class=\"line\">        String s1 = UUID.randomUUID().toString();</span><br><span class=\"line\">        ServerNode serverNode1 = consistentHash.process(<span class=\"keyword\">new</span> ClientNode(s1));</span><br><span class=\"line\">        out.println(serverNode1);</span><br><span class=\"line\">        ServerNode serverNode1_1 = consistentHash.process(<span class=\"keyword\">new</span> ClientNode(s1));</span><br><span class=\"line\">        out.println(serverNode1_1);</span><br><span class=\"line\">        ServerNode serverNode1_2 = consistentHash.process(<span class=\"keyword\">new</span> ClientNode(UUID.randomUUID().toString()));</span><br><span class=\"line\">        out.println(serverNode1_2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨æµ‹è¯•å®Œæˆä¹‹åï¼Œæˆ‘è¿˜å¯¹å„ç§æ–¹æ¡ˆå°±è¿›è¡Œäº†æ€§èƒ½ç›¸å…³çš„ç®€å•æµ‹è¯•ï¼Œç¡¬ä»¶: windows 8 æ ¸ 16G,i7.<br>\n æµ‹è¯•ä»£ç å°±ä¸è´´å‡ºæ¥äº†ï¼ŒæŸ¥çœ‹åŸæ–‡å»çœ‹å§ã€‚</p>\n<p>æ€»ç»“å¦‚ä¸‹ï¼š</p>\n<p>åœ¨èŠ‚ç‚¹æ•° å°äº 10000 çš„åœºæ™¯ä¸‹ï¼š æ•°ç»„éå† &gt; SortedMap &gt; æ’åºã€‚ å³ï¼šæ–¹æ¡ˆ 2 &gt; æ–¹æ¡ˆ 3 &gt; æ–¹æ¡ˆ 1ã€‚<br>\nåœ¨æœåŠ¡ç«¯èŠ‚ç‚¹æ•° å¤§äº 10000 çš„åœºæ™¯ä¸‹ï¼š SortedMap &gt; æ•°ç»„å˜é‡ &gt; æ’åºã€‚å³ï¼š æ–¹æ¡ˆ 3 &gt; æ–¹æ¡ˆ 2 &gt; æ–¹æ¡ˆ 1.</p>\n<h1 id=\"é™„å½•\"><a class=\"markdownIt-Anchor\" href=\"#é™„å½•\">#</a> é™„å½•</h1>\n<div class=\"links\"><div class=\"item\" title=\"fangxiaobai\" style=\"--block-color:#e0b971;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZhbmdqaWF4aWFvYmFpL2NvZGVfcmVwby90cmVlL21hc3Rlci8wM18lRTUlODglODYlRTUlQjglODMlRTUlQkMlOEYlRTclOUIlQjglRTUlODUlQjMvJUU0JUI4JTgwJUU4JTg3JUI0JUU2JTgwJUE3JUU1JTkzJTg4JUU1JUI4JThDJUU3JUFFJTk3JUU2JUIzJTk1L2NvbnNpc3RlbnRfaGFzaC9zcmM=\" data-background-image=\"https://avatars.githubusercontent.com/u/22616214?v=4\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZhbmdqaWF4aWFvYmFpL2NvZGVfcmVwby90cmVlL21hc3Rlci8wM18lRTUlODglODYlRTUlQjglODMlRTUlQkMlOEYlRTclOUIlQjglRTUlODUlQjMvJUU0JUI4JTgwJUU4JTg3JUI0JUU2JTgwJUE3JUU1JTkzJTg4JUU1JUI4JThDJUU3JUFFJTk3JUU2JUIzJTk1L2NvbnNpc3RlbnRfaGFzaC9zcmM=\">ä»£ç ä»“åº“ - ä¸€è‡´æ€§Hashç®—æ³•çš„å®ç°</span>\n          <p class=\"desc\">æ¬¢è¿star!! æœŸå¾…ä½ çš„åŠ å…¥~</p>\n          </div></div></div>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "å“ˆå¸Œç®—æ³•"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/",
            "title": "å½’å¹¶æ’åº",
            "date_published": "2021-09-01T04:33:55.000Z",
            "content_html": "<p>å°†æ•°ç»„ä»ä¸­é—´åˆ†æˆå‰åä¸¤éƒ¨åˆ†ï¼Œç„¶åå¯¹å‰åä¸¤éƒ¨åˆ†åˆ†åˆ«è¿›è¡Œæ’åºï¼Œå†å°†æ’å¥½åºçš„ä¸¤éƒ¨åˆ†åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿™æ ·æ•´ä¸ªæ•°ç»„å°±æ˜¯æœ‰åºçš„äº†ã€‚</p>\n<p>å½’å¹¶ä½“ç°çš„æ€æƒ³å°±æ˜¯ <strong>åˆ†æ²»æ€æƒ³</strong> åˆ†è€Œæ²»ä¹‹ï¼Œå°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£æˆå°çš„é—®é¢˜æ¥è§£å†³ã€‚å°é—®é¢˜è§£å†³äº†ï¼Œå¤§é—®é¢˜ä¹Ÿå°±è§£å†³äº†.</p>\n<p>è¿™ç§åˆ†æ²»çš„ç®—æ³•ï¼Œä¸€èˆ¬éƒ½æ˜¯é€’å½’çš„æ–¹å¼æ¥æ±‚è§£ã€‚æˆ‘ä»¬ä¹Ÿå°è¯•ç€å†™ä¸€ä¸ªé€’å½’æ–¹å¼çš„å½’å¹¶æ’åºã€‚</p>\n<p>å†™é€’å½’çš„ç¨‹åºï¼Œæœ€é‡è¦çš„å°±æ˜¯å†™ <strong>é€’æ¨è¡¨è¾¾å¼</strong>å’Œ<strong>æŸ¥æ‰¾ä¸´ç•Œæ¡ä»¶</strong></p>\n<p>æ ¹æ®å½’å¹¶æ’åºçš„æ€æƒ³æˆ‘ä»¬å¯å†™å‡ºè¿™æ ·çš„é€’æ¨å…¬å¼:</p>\n<p>å‡è®¾:  <code>low</code>  ä¸ºå¾…æ’åºæ•°ç»„çš„æœ€å°çš„ç´¢å¼•.  <code>high</code>  ä¸ºå¾…æ’åºæ•°ç»„çš„æœ€å¤§ç´¢å¼•.  <code>mid</code>  ä¸º  <code>(high+low)/2</code> <br>\n é‚£ä¹ˆ:  <code>merge_sort(low,high) = merge(merge_sort(low,mid),merge_sort(mid+1,high))</code></p>\n<p>å¯¹æŸä¸ªæ•°ç»„ ä»ä¸‹æ ‡  <code>low</code>  åˆ°  <code>high</code>  çš„æ’åºï¼Œè½¬æ¢æˆäº†å­é—®é¢˜ ä» <code>low</code>  åˆ°  <code>mid</code>  çš„æ’åº å’Œ ä» <code>mid+1</code>  åˆ° <code>high</code>  çš„æ’åºã€‚å½“è¿™ä¸¤ä¸ªå­é—®é¢˜æ’å¥½åºä¹‹åï¼Œå†å°†ä¸¤ä¸ªæœ‰åºçš„å­æ•°ç»„åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿™æ ·ä¸‹æ ‡ä»  <code>low</code>  åˆ°  <code>high</code>  ä¹‹é—´çš„æ•°æ®ä¹Ÿå°±éƒ½æ˜¯æ’å¥½åºçš„äº†ã€‚</p>\n<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šç»ˆæ­¢æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿç»ˆæ­¢æ¡ä»¶å°±æ˜¯ å­é—®é¢˜ä¸­çš„  <code>low &gt;= high</code> , è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»ˆæ­¢é€’å½’äº†ã€‚</p>\n<h5 id=\"å½’å¹¶æ’åºé€»è¾‘å›¾\"><a class=\"markdownIt-Anchor\" href=\"#å½’å¹¶æ’åºé€»è¾‘å›¾\">#</a> å½’å¹¶æ’åºé€»è¾‘å›¾</h5>\n<p>æ¥ä¸€å¼ å½’å¹¶æ’åºè¿‡ç¨‹çš„ç¤ºæ„å›¾å§</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E6%8E%92%E5%BA%8F03-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F01.png\" alt=\"ç®—æ³•01-æ’åº03-å½’å¹¶æ’åº01\"></p>\n<h5 id=\"å½’å¹¶æ’åºç®—æ³•å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#å½’å¹¶æ’åºç®—æ³•å®ç°\">#</a> å½’å¹¶æ’åºç®—æ³•å®ç°</h5>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">merge</span><span class=\"params\">(<span class=\"keyword\">int</span> *a, <span class=\"keyword\">int</span> low, <span class=\"keyword\">int</span> high, <span class=\"keyword\">int</span> mid)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> temp_arr_length = high - low + <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> t[temp_arr_length];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> j = mid + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = low;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> m = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­å¤§å°</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (; i &lt;= mid &amp;&amp; j &lt;= high;) &#123;</span><br><span class=\"line\">        t[m++] = a[i] &lt; a[j] ? a[i++] : a[j++];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­åˆ†ç»„æ•°é‡ä¸ç›¸ç­‰æ—¶çš„æƒ…å†µ</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (j &lt;= high) &#123;</span><br><span class=\"line\">        t[m++] = a[j++];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­åˆ†ç»„æ•°é‡ä¸ç›¸ç­‰æ—¶çš„æƒ…å†µ   </span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (i &lt;= mid) &#123;</span><br><span class=\"line\">        t[m++] = a[i++];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å°†ä¸­é—´è¡¨çš„æ•°æ®èµ‹å€¼ç»™åŸå§‹çš„æ•°ç»„</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; m; i++) &#123;</span><br><span class=\"line\">        a[low + i] = t[i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">merge_sort</span><span class=\"params\">(<span class=\"keyword\">int</span> *a, <span class=\"keyword\">int</span> low, <span class=\"keyword\">int</span> high)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (low &gt;= high) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> mid = (low + high) &gt;&gt; <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">// å½’</span></span><br><span class=\"line\">    merge_sort(a, low, mid);</span><br><span class=\"line\">    merge_sort(a, mid + <span class=\"number\">1</span>, high);</span><br><span class=\"line\">    <span class=\"comment\">// å¹¶</span></span><br><span class=\"line\">    merge(a, low, high, mid);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"å½’å¹¶æ’åºæ€§èƒ½è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#å½’å¹¶æ’åºæ€§èƒ½è¯„ä¼°\">#</a> å½’å¹¶æ’åºæ€§èƒ½è¯„ä¼°</h5>\n<ul>\n<li>å½’å¹¶æ’åºæ˜¯ä¸€ä¸ªç¨³å®šçš„æ’åºç®—æ³•</li>\n<li>å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(nlogn)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>å½’å¹¶æ’åºçš„ç©ºé—´å¤æ‚åº¦ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></li>\n</ul>\n<h5 id=\"å½’å¹¶æ’åºæ—¶é—´å¤æ‚åº¦çš„æ¨ç®—\"><a class=\"markdownIt-Anchor\" href=\"#å½’å¹¶æ’åºæ—¶é—´å¤æ‚åº¦çš„æ¨ç®—\">#</a> å½’å¹¶æ’åºæ—¶é—´å¤æ‚åº¦çš„æ¨ç®—</h5>\n<p>å½’å¹¶æ’åºè¿™ç§å®ç°æ–¹å¼çš„æ—¶é—´å¤æ‚åº¦çš„æ¨ç®—ï¼Œä¹Ÿå°±æ˜¯å¯¹é€’å½’çš„æ—¶é—´å¤æ‚åº¦çš„æ¨ç®—ã€‚</p>\n<p><strong>ä¸ä»…é€’å½’æ±‚è§£çš„é—®é¢˜å¯ä»¥å†™æˆé€’æ¨å…¬å¼ï¼Œé€’å½’ä»£ç çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿå¯ä»¥å†™æˆé€’æ¨å…¬å¼</strong></p>\n<p>é€’å½’çš„ä¸»è¦ç‰¹å¾å°±æ˜¯:<br>\n ä¸€ä¸ªé—®é¢˜ a, å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªå­é—®é¢˜ b,c, é‚£ä¹ˆæ±‚è§£ a é—®é¢˜å°±è½¬æ¢æˆäº†æ±‚è§£å­é—®é¢˜ b,cã€‚b å’Œ c è§£å†³ä¹‹åï¼Œæˆ‘ä»¬å°±æŠŠ b,c çš„ç»“æœåˆå¹¶æˆ a çš„ç»“æœ.</p>\n<p>é‚£ æˆ‘ä»¬å‡è®¾ æ±‚è§£ a é—®é¢˜çš„æ—¶é—´æ˜¯ T (a), æ±‚è§£é—®é¢˜ b,c çš„æ—¶é—´ä¸º T (b),TÂ©, é‚£ä¹ˆæˆ‘å°±å¯ä»¥å¾—åˆ°è¿™æ ·çš„é€’æ¨å…¬å¼:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>b</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>c</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">T(a) = T(b) + T(c) + K\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span></span></p>\n<p>å…¶ä¸­ï¼Œ <code>K</code>  æ˜¯è§£å†³å®Œå­é—®é¢˜ <code>b</code> , <code>c</code>  ä¹‹åï¼Œåˆå¹¶ä¸º a é—®é¢˜æ‰€éœ€è¦çš„æ—¶é—´ã€‚ å¯¹äºå½’å¹¶æ’åºæ¥è®²ï¼Œ <code>K</code>  å°±æ˜¯  <code>merge</code>  æ‰€éœ€è¦çš„æ—¶é—´äº†.</p>\n<h5 id=\"é‚£æˆ‘ä»¬æ¥è¯¦ç»†çš„åˆ†æä¸‹å½’å¹¶æ’åºæ—¶é—´å¤æ‚åº¦\"><a class=\"markdownIt-Anchor\" href=\"#é‚£æˆ‘ä»¬æ¥è¯¦ç»†çš„åˆ†æä¸‹å½’å¹¶æ’åºæ—¶é—´å¤æ‚åº¦\">#</a> é‚£æˆ‘ä»¬æ¥è¯¦ç»†çš„åˆ†æä¸‹å½’å¹¶æ’åºæ—¶é—´å¤æ‚åº¦:</h5>\n<p>å‡è®¾:<br>\n å¯¹ n ä¸ªå…ƒç´ ï¼Œè¿›è¡Œå½’å¹¶æ’åºçš„æ—¶é—´ä¸º <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">T(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span><br>\n é‚£ä¹ˆ:<br>\n åˆ†è§£æˆä¸¤ä¸ªå­æ•°ç»„æ’åºçš„æ—¶é—´éƒ½æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">T(n/2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span><br>\n merge å‡½æ•°åˆå¹¶ä¸¤ä¸ªæœ‰åºå­æ•°ç»„çš„æ—¶é—´å¤æ‚åº¦æ˜¯<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></p>\n<p>å¥—ç”¨å‰é¢çš„å…¬å¼:</p>\n<p>å½“ <code>n=1</code>  æ—¶: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">T(n) = C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span>, å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´.<br>\n å½“ <code>n&gt;1</code>  æ—¶: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">T(n)=2*T(n/2)+n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>2</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>2</mn><mo>âˆ—</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>4</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi><mo>=</mo><mn>4</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>4</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mn>2</mn><mo>âˆ—</mo><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>4</mn><mo>âˆ—</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>8</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>4</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi><mo>=</mo><mn>8</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>8</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mn>3</mn><mo>âˆ—</mo><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mn>8</mn><mo>âˆ—</mo><mo stretchy=\"false\">(</mo><mn>2</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>16</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>8</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>n</mi><mo>=</mo><mn>16</mn><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi mathvariant=\"normal\">/</mi><mn>16</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>4</mn><mo>âˆ—</mo><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msup><mn>2</mn><mi>k</mi></msup><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mfrac><mi>n</mi><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo stretchy=\"false\">)</mo><mo>+</mo><mi>k</mi><mo>âˆ—</mo><mi>n</mi><mo separator=\"true\">;</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\nT(n) &amp;= 2*T(n/2)+n\\\\\n    &amp;= 2 * (2 * T(n/4) + n/2) + n = 4 * T(n/4) + 2 * n \\\\\n    &amp;= 4 * (2 * T(n/8) + n/4) + n = 8 * T(n/8) + 3 * n \\\\\n    &amp;= 8 * (2 * T(n/16) + n/8) + n = 16 * T(n/16) = 4 * n \\\\\n    &amp;= ....\\\\\n    &amp;= 2^k * T(\\frac{n}{2^k}) + k * n;\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:9.593560000000004em;vertical-align:-4.546780000000002em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.046780000000001em;\"><span style=\"top:-7.314340000000001em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span><span style=\"top:-5.8143400000000005em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span><span style=\"top:-4.31434em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span><span style=\"top:-2.8143399999999996em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.3143399999999996em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span><span style=\"top:0.4532200000000014em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.546780000000002em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:5.046780000000001em;\"><span style=\"top:-7.314340000000001em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-5.8143400000000005em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">4</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">2</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">4</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-4.31434em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">8</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">4</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">8</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">8</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-2.8143399999999996em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">8</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">1</span><span class=\"mord\">6</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">8</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">1</span><span class=\"mord\">6</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">/</span><span class=\"mord\">1</span><span class=\"mord\">6</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-1.3143399999999996em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span></span></span><span style=\"top:0.4532200000000014em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8991079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.10756em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7751079999999999em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">;</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:4.546780000000002em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>å…¶ä¸­ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> å°±æ˜¯åˆ†è£‚çš„æ¬¡æ•°ã€‚æ‹†åˆ†å­é—®é¢˜çš„æ¬¡æ•°.</p>\n<p>å½“ n=1, åˆ™ k=0. , å³ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mfrac><mi>n</mi><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">T(1) = T(\\frac{n}{2^k})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1074199999999998em;vertical-align:-0.3574199999999999em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.695392em;\"><span style=\"top:-2.64258em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7820285714285713em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3574199999999999em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span></span></span></span>, ==&gt; <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mi>n</mi><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\frac{n}{2^k}=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0528119999999999em;vertical-align:-0.3574199999999999em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.695392em;\"><span style=\"top:-2.64258em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7820285714285713em;\"><span style=\"top:-2.786em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3574199999999999em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>, é‚£ä¹ˆ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">k=log_2n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">n</span></span></span></span></p>\n<p>å°† <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> ä»£å…¥å…¬å¼</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.24999999999999992em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><msup><mn>2</mn><mi>k</mi></msup><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mfrac><mi>n</mi><msup><mn>2</mn><mi>k</mi></msup></mfrac><mo stretchy=\"false\">)</mo><mo>+</mo><mi>k</mi><mo>âˆ—</mo><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><msup><mn>2</mn><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi></mrow></msup><mo>âˆ—</mo><mi>T</mi><mo stretchy=\"false\">(</mo><mfrac><mi>n</mi><msup><mn>2</mn><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi></mrow></msup></mfrac><mo stretchy=\"false\">)</mo><mo>+</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi><mo>âˆ—</mo><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>C</mi><mo separator=\"true\">â‹…</mo><mi>n</mi><mo>+</mo><mi>n</mi><mo separator=\"true\">â‹…</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{aligned}\n&amp; 2^k * T(\\frac{n}{2^k}) + k * n \\\\\n&amp;= 2^{log_2n} * T(\\frac{n}{2^{log_2n}}) + log_2n * n \\\\\n&amp;= CÂ·n + nÂ·log_2n\n\\end{aligned}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:5.68712em;vertical-align:-2.5935599999999996em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.09356em;\"><span style=\"top:-5.09356em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span><span style=\"top:-3.0000000000000004em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.1740000000000008em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.5935599999999996em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.09356em;\"><span style=\"top:-5.09356em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8991079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.10756em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7751079999999999em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.0000000000000004em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8991079999999999em;\"><span style=\"top:-3.1130000000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.10756em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7751079999999999em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ—</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-1.1740000000000008em;\"><span class=\"pstrut\" style=\"height:3.1075600000000003em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.5935599999999996em;\"><span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>ä½¿ç”¨å¤§<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi></mrow><annotation encoding=\"application/x-tex\">O</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span></span></span></span> è¡¨ç¤ºæ³•: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(nlogn)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>.</p>\n<p>å½’å¹¶æ’åºçš„æ‰§è¡Œæ•ˆç‡å’Œè¦æ’åºçš„åŸå§‹æ•°æ®çš„æœ‰åºç¨‹åº¦æ— å…³ï¼Œæ‰€ä»¥ä¸ç®¡æœ€å¥½æƒ…å†µå’Œæœ€åæƒ…å†µä¸‹éƒ½æ˜¯ï¼Œ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(nlogn)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span>.</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "æ’åº",
                "å†’æ³¡æ’åº",
                "åˆ†æ²»æ€æƒ³æ’åº"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/",
            "title": "é€‰æ‹©æ’åº",
            "date_published": "2021-09-01T04:33:55.000Z",
            "content_html": "<h2 id=\"åŸºæœ¬æ€æƒ³\"><a class=\"markdownIt-Anchor\" href=\"#åŸºæœ¬æ€æƒ³\">#</a> åŸºæœ¬æ€æƒ³</h2>\n<p>ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºåŸºå‡†ï¼Œä¸åé¢çš„å…ƒç´ è¿›è¡Œå¯¹æ¯”ã€‚é€‰æ‹©æœ€å€¼ (æœ€å¤§å€¼ / æœ€å°å€¼) ä¸å½“å‰ä½ç½®è¿›è¡Œäº¤æ¢ã€‚å¯¹æ¯ä¸ªå…ƒç´ éƒ½ä¸ºåŸºå‡†æ¯”è¾ƒï¼Œè¿™å°±æ˜¯æ’åºè¿‡ç¨‹äº†.</p>\n<h2 id=\"å®ç°è¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#å®ç°è¿‡ç¨‹\">#</a> å®ç°è¿‡ç¨‹</h2>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E6%8E%92%E5%BA%8F01-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F01.png\" alt=\"ç®—æ³•01-æ’åº01-é€‰æ‹©æ’åº01.png\"></p>\n<h2 id=\"ä»£ç å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç å®ç°\">#</a> ä»£ç å®ç°</h2>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> *<span class=\"title\">select_sort</span><span class=\"params\">(<span class=\"keyword\">int</span> *a, <span class=\"keyword\">int</span> length)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> min_value_index = i;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = i + <span class=\"number\">1</span>; j &lt; length; j++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// select the min value index and record it</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (a[min_value_index] &gt; a[j]) &#123;</span><br><span class=\"line\">                min_value_index = j;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (min_value_index != i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> temp = a[min_value_index];</span><br><span class=\"line\">            a[min_value_index] = a[i];</span><br><span class=\"line\">            a[i] = temp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">       <span class=\"comment\">// print(a, length);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ’åºç®—æ³•çš„è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºç®—æ³•çš„è¯„ä¼°\">#</a> æ’åºç®—æ³•çš„è¯„ä¼°</h2>\n<ul>\n<li>åŸºäºæ¯”è¾ƒï¼Œäº¤æ¢çš„æ’åºç®—æ³•.</li>\n<li>ç©ºé—´å¤æ‚åº¦ä¸º<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>, æ˜¯ä¸€ç§åŸåœ°æ’åºç®—æ³•.</li>\n<li>æœ€å¥½æƒ…å†µï¼Œæœ€åæƒ…å†µï¼Œå¹³å‡æƒ…å†µï¼Œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>.</li>\n<li><strong>æ˜¯ä¸æ˜¯</strong>ç¨³å®šçš„æ’åºç®—æ³•ï¼Ÿ<br>\n ä¸»è¦å–å†³äº:   <code>if (a[min_value_index] &gt; a[j]) &#123;min_value_index = j;&#125;</code> <br>\n å¦‚æœæ˜¯   <code>a[min_value_index] &gt;= a[j]</code>  å°±æ˜¯ä¸ç¨³å®šçš„æ’åºç®—æ³•.</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "æ’åº",
                "äº¤æ¢æ’åº",
                "é€‰æ‹©æ’åº"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/",
            "title": "æ’åºç®—æ³•",
            "date_published": "2021-09-01T04:33:55.000Z",
            "content_html": "<h2 id=\"æ’åºç®—æ³•å¼€ç¯‡\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºç®—æ³•å¼€ç¯‡\">#</a> æ’åºç®—æ³•å¼€ç¯‡</h2>\n<p>æ’åºç®—æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å¸¸è§çš„ å†’æ³¡æ’åºï¼Œæ’å…¥æ’åºï¼Œé€‰æ‹©æ’åºï¼Œå½’å¹¶æ’åºï¼Œå¿«é€Ÿæ’åºï¼Œè®¡æ•°æ’åºï¼ŒåŸºæ•°æ’åºï¼Œæ¡¶æ’åºï¼Œè¿˜æœ‰ä¸å¸¸è§çš„çŒ´å­æ’åºï¼Œç¡çœ æ’åºï¼Œé¢æ¡æ’åºç­‰ã€‚</p>\n<p>å…¶ä¸­ï¼Œå†’æ³¡æ’åºï¼Œæ’å…¥æ’åºï¼Œé€‰æ‹©æ’åº çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></p>\n<p>å¿«æ’ï¼Œå½’å¹¶æ’åº çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(nlogn)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></p>\n<p>æ¡¶æ’åºï¼Œè®¡æ•°æ’åºï¼ŒåŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></p>\n<h2 id=\"æ’åºç®—æ³•å¥½åçš„è¯„ä¼°\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºç®—æ³•å¥½åçš„è¯„ä¼°\">#</a> æ’åºç®—æ³•å¥½åçš„è¯„ä¼°</h2>\n<ul>\n<li>\n<p>æœ€å¥½æƒ…å†µï¼Œæœ€åæƒ…å†µï¼Œå¹³å‡æƒ…å†µçš„æ—¶é—´å¤æ‚åº¦<br>\næˆ‘ä»¬è¦çŸ¥é“æ’åºç®—æ³•åœ¨ä¸åŒæ•°æ®ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚</p>\n</li>\n<li>\n<p>æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ï¼Œå¸¸æ•°ï¼Œä½é˜¶<br>\næ—¶é—´å¤æ‚åº¦ååº”çš„æ˜¯æ•°æ®è§„æ¨¡ n å¾ˆå¤§çš„æ—¶å€™çš„ä¸€ä¸ªå¢é•¿è¶‹åŠ¿ï¼Œæ‰€ä»¥å®ƒè¡¨ç¤ºçš„æ—¶å€™ï¼Œä¼šå¿½ç•¥ç³»æ•°ï¼Œå¸¸æ•°ï¼Œä½é˜¶ã€‚ä½†æ˜¯æˆ‘æ’åºçš„æ—¶å€™ï¼Œæ¶‰åŠåˆ°çš„æ•°æ®æ˜¯å¾ˆå°è§„æ¨¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸‹ç³»æ•°ï¼Œå¸¸æ•°ï¼Œä½é˜¶ã€‚</p>\n</li>\n<li>\n<p>æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ (ç§»åŠ¨) æ¬¡æ•°<br>\nåœ¨åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ€å¤šçš„ä¼šæ¶‰åŠä¸¤ç§æ“ä½œï¼Œå…ƒç´ æ¯”è¾ƒå¤§å°å’Œå…ƒç´ äº¤æ¢æˆ–ç§»åŠ¨.</p>\n</li>\n<li>\n<p>å†…å­˜æ¶ˆè€—<br>\nå³ç©ºé—´å¤æ‚åº¦ã€‚</p>\n</li>\n<li>\n<p>æ’åºç®—æ³•çš„ç¨³å®šæ€§<br>\nç¨³å®šæ€§æ˜¯æŒ‡ï¼šå¦‚æœå¾…æ’åºçš„åºåˆ—ä¸­å­˜åœ¨å€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œç»è¿‡æ’åºä¹‹åï¼Œç›¸ç­‰å…ƒç´ ä¹‹é—´åŸæœ‰çš„å…ˆåé¡ºåºä¸å˜ã€‚<br>\nè¿™æ ·çš„æ’åºç®—æ³•æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p>\n<p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œå¯¹ä¸€äº›å­¦ç”Ÿçš„æˆç»©è¿›è¡Œæ’åºã€‚æŒ‰ç…§æ€»æˆç»©ä»å¤§åˆ°å°çš„é¡ºåºè¿›è¡Œæ’åˆ—ã€‚æ€»æˆç»©ç›¸ç­‰çš„æŒ‰ç…§æ•°å­¦æˆç»©ä»å¤§åˆ°å°çš„é¡ºåºè¿›è¡Œæ’åˆ—ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç¨³å®šçš„æ’åºç®—æ³•ã€‚å…ˆæŒ‰ç…§æ•°å­¦æˆç»©ä»å¤§åˆ°å°çš„é¡ºåºè¿›è¡Œæ’åˆ—ï¼Œè¿™æ ·ä¿è¯äº†æ•°å­¦æˆç»©æ˜¯æœ‰åºçš„ï¼Œç„¶åæˆ‘ä»¬å†å¯¹æ€»æˆç»©è¿›è¡Œæ’åºï¼Œè¿™æ ·å°±æ»¡è¶³äº†æ•´ä½“éœ€æ±‚äº†.</p>\n</li>\n</ul>\n<h2 id=\"æ’åºç®—æ³•å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#æ’åºç®—æ³•å®ç°\">#</a> æ’åºç®—æ³•å®ç°</h2>\n<h3 id=\"äº¤æ¢æ€æƒ³æ’åº\"><a class=\"markdownIt-Anchor\" href=\"#äº¤æ¢æ€æƒ³æ’åº\">#</a> äº¤æ¢æ€æƒ³æ’åº</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/\">å†’æ³¡æ’åº</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/\">é€‰æ‹©æ’åº</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" disabled=\"true\"><label for=\"cbx_2\"> æ’å…¥æ’åº</label></li>\n</ul>\n<h3 id=\"åˆ†æ²»æ€æƒ³æ’åº\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†æ²»æ€æƒ³æ’åº\">#</a> åˆ†æ²»æ€æƒ³æ’åº</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" checked=\"true\" disabled=\"true\"><label for=\"cbx_3\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/\">å½’å¹¶æ’åº</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/\">å¿«é€Ÿæ’åº</a></label></li>\n</ul>\n<h3 id=\"çº¿æ€§æ’åº\"><a class=\"markdownIt-Anchor\" href=\"#çº¿æ€§æ’åº\">#</a> çº¿æ€§æ’åº</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" disabled=\"true\"><label for=\"cbx_5\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%A1%B6%E6%8E%92%E5%BA%8F/\">æ¡¶æ’åº (Bubble Sort)</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" disabled=\"true\"><label for=\"cbx_6\"> è®¡æ•°æ’åº (Counting Sort)</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" disabled=\"true\"><label for=\"cbx_7\"> åŸºæ•°æ’åº (Radix Sort)</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" disabled=\"true\"><label for=\"cbx_8\"> å †æ’åº</label></li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "æ’åº"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/recursion/%E7%AE%97%E6%B3%9501-%E9%80%92%E5%BD%92/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/recursion/%E7%AE%97%E6%B3%9501-%E9%80%92%E5%BD%92/",
            "title": "é€’å½’",
            "date_published": "2021-09-01T04:33:55.000Z",
            "content_html": "<p>æ•°æ®ç»“æ„ä¸ç®—æ³• è¿™ä¸€ä¸ªæ¨¡å— æœ‰ä¸¤ä¸ªæœ€éš¾çš„çŸ¥è¯†ç‚¹ï¼Œä¸€ä¸ªå°±æ˜¯ é€’å½’ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ åŠ¨æ€è§„åˆ’</p>\n<p>æˆ‘ä»¬ä»Šå¤©æ¥å­¦ä¹ ä¸‹é€’å½’è¿™ç§å®ç°æ–¹å¼ã€‚</p>\n<p>ä¸ªäººè®¤ä¸ºï¼Œé€’å½’ä¸æ˜¯ä¸€ç§ç®—æ³•ï¼Œå°±æ˜¯ä¸€ç§è¯­æ³•ã€‚æ‰€ä»¥æˆ‘å°±ç§°å®ƒä¸ºä¸€ç±»é—®é¢˜çš„è§£å†³æ–¹æ³•.</p>\n<h2 id=\"ä½•ä¸ºé€’å½’\"><a class=\"markdownIt-Anchor\" href=\"#ä½•ä¸ºé€’å½’\">#</a> ä½•ä¸ºé€’å½’ï¼Ÿ</h2>\n<p>é€’å½’ï¼Œå»çš„è¿‡ç¨‹å«é€’ï¼Œå›æ¥çš„è¿‡ç¨‹å«å½’ã€‚å‡¡æ˜¯é€’å½’ç±»çš„é—®é¢˜ï¼Œéƒ½èƒ½æ€»ç»“å‡ºä¸€ä¸ªé€’å½’å…¬å¼.<br>\n æ¯”å¦‚: <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">f(n+1) = f(n) + 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>, æˆ‘ä»¬ç”¨ä»£ç å®ç°å°±æ˜¯:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">f</span><span class=\"params\">(n)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n==<span class=\"number\">1</span>?<span class=\"number\">1</span>:f(n-<span class=\"number\">1</span>)+<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ¤æ–­æ˜¯å¦å¯ç”¨é€’å½’\"><a class=\"markdownIt-Anchor\" href=\"#åˆ¤æ–­æ˜¯å¦å¯ç”¨é€’å½’\">#</a> åˆ¤æ–­æ˜¯å¦å¯ç”¨é€’å½’</h2>\n<p>è¦æƒ³ä½¿ç”¨é€’å½’æ¥è§£å†³é—®é¢˜ï¼Œè¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶:</p>\n<ul>\n<li>ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªé—®é¢˜çš„è§£ã€‚</li>\n<li>è¿™ä¸ªé—®é¢˜å’Œåˆ†è§£ä¹‹åçš„é—®é¢˜ï¼Œé™¤äº†æ ‘æ®è§„æ¨¡ä¸ä¸€æ ·ï¼Œæ±‚è§£æ€è·¯ä¸€æ¨¡ä¸€æ ·.</li>\n<li>å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶ã€‚æ¯”å¦‚ä¸Šä¾‹å­ä¸­çš„<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">f(n)=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></li>\n</ul>\n<h2 id=\"å¦‚ä½•ç¼–å†™é€’å½’\"><a class=\"markdownIt-Anchor\" href=\"#å¦‚ä½•ç¼–å†™é€’å½’\">#</a> å¦‚ä½•ç¼–å†™é€’å½’</h2>\n<h3 id=\"æ‰¾å‡ºé€’æ¨å…¬å¼\"><a class=\"markdownIt-Anchor\" href=\"#æ‰¾å‡ºé€’æ¨å…¬å¼\">#</a> æ‰¾å‡ºé€’æ¨å…¬å¼ï¼</h3>\n<p>é€’å½’å†™æ³•çš„è¯ï¼Œæœ€é‡è¦çš„å°±æ˜¯å†™å‡ºé€’æ¨å…¬å¼ï¼Œå…¶æ¬¡å°±æ˜¯ï¼Œæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶.</p>\n<p>ä¸¾ä¸ªä¾‹å­:</p>\n<p>äººæ°‘å¸çš„ç»„åˆæ–¹å¼.</p>\n<p>å‡è®¾æˆ‘æœ‰äººæ°‘å¸ 100 å…ƒï¼Œ50 å…ƒï¼Œ20 å…ƒï¼Œ10 å…ƒï¼Œ5 å…ƒï¼Œ1 å…ƒçš„å¸ç§è‹¥å¹²å¼ ï¼Œæˆ‘æƒ³ç”¨è¿™äº›èŠ±æ‰ 70 å…ƒï¼Œæˆ‘å¯ä»¥æ€ä¹ˆèŠ±ï¼Ÿ</p>\n<p>è¿™ä¸ªé—®é¢˜å°±å¯ä»¥è½¬æ¢æˆäº†ï¼Œ70 å…ƒæœ‰å¤šå°‘ä¸­ç»„åˆæ–¹å¼ (A) -&gt; 69 å…ƒæœ‰å¤šå°‘ä¸­ç»„åˆæ–¹å¼ (B) + 65 å…ƒæœ‰å‡ ç§ç»„åˆæ–¹å¼ Â© + 60 å…ƒæœ‰å‡ ç§ç»„åˆæ–¹å¼ (D) + 50 å…ƒæœ‰å‡ ç§ç»„åˆæ–¹å¼ (E) + 20 å…ƒæœ‰å‡ ç§ç»„åˆæ–¹å¼ (F)ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ªé—®é¢˜ A åˆ†è§£æˆäº†è‹¥å¹²å­é—®é¢˜ B,C,D,E,F. æˆ‘ä»¬è§£å†³äº†å­é—®é¢˜ B,C,D,E,Fã€‚ é‚£ä¹ˆå¯¹åº”çš„ A é—®é¢˜ï¼Œä¹Ÿå°±è§£å†³äº†ã€‚è€Œä¸”ï¼Œåœ¨è¿™é—®é¢˜é‡Œï¼Œæˆ‘ä»¬åªè¦å…³å¿ƒ A ä¸å…¶å­é—®é¢˜çš„å…³ç³»å³å¯ï¼Œä¸ç”¨å…³ç³»å…¶ä»–çš„å­é—®é¢˜ä¸å­é—®é¢˜çš„å…³ç³»ã€‚å±è”½æ‰é€’å½’ç»†èŠ‚ã€‚</p>\n<h2 id=\"é€’å½’å®ç°æ–¹æ¡ˆçš„æ³¨æ„ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#é€’å½’å®ç°æ–¹æ¡ˆçš„æ³¨æ„ç‚¹\">#</a> é€’å½’å®ç°æ–¹æ¡ˆçš„æ³¨æ„ç‚¹</h2>\n<ul>\n<li>å¦‚æœé€’å½’æ·±åº¦æ¯”è¾ƒå¤§çš„è¯ï¼Œå°±ä¼šå‡ºç°å †æ ˆæº¢å‡ºçš„å¼‚å¸¸ã€‚</li>\n<li>é€’å½’çš„æ—¶å€™ï¼Œè¦é¿å…é‡å¤è®¡ç®—.<br>\n è¿™ä¸ªçš„è¯ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå°±ä¼šå¾ˆæ¸…æ™°äº†ã€‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„è®¡ç®—.</li>\n</ul>\n<p>æ–æ³¢é‚£å¥‘æ•°åˆ—å°±æ˜¯ å½“å‰é¡¹ç­‰äºå‰ä¸¤é¡¹ä¹‹å’Œ.</p>\n<p>ä»¥ fib (6) ä¸ºä¾‹ï¼Œå³æ±‚ç¬¬ 6 ä¸ªæ•°çš„æ•°å€¼ã€‚</p>\n<p>å¦‚ä¸‹å›¾:</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9201-fib.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’01-fib.png\"></p>\n<p>æˆ‘ä»¬ä¼šå‘ç°: fib (4),fib (3),fib (2) éƒ½æ˜¯é‡å¤è®¡ç®—çš„ã€‚</p>\n<p>å…·ä½“çš„è§£å†³æ–¹å¼å‘¢ï¼Œåœ¨ ç®—æ³•ã€åŠ¨æ€è§„åˆ’ã€‘æ–‡ç« é‡Œï¼Œä¹Ÿæœ‰è¯´è¿‡ã€‚</p>\n<p>åŠ å…¥ä¸€ä¸ªæ•°æ®ï¼Œæ¥è®°å½•å°±è¡Œäº†.<br>\n<img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9201-fib02.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’01-fib02.png\"> å…¶ä¸­è™šçº¿è¾¹æ¡†çš„å°±ä¸ç”¨å†è®¡ç®—äº†ã€‚</p>\n<ul>\n<li>ä¸€å®šè¦æ˜ç¡®ç»ˆæ­¢æ¡ä»¶ã€‚ä¸ç„¶å°±æ˜¯æ­»å¾ªç¯ï¼</li>\n</ul>\n<p>å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯é€’å½’çš„ä»‹ç»ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "é€’å½’"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/",
            "title": "å“ˆå¸Œç®—æ³•",
            "date_published": "2021-09-01T04:17:55.000Z",
            "content_html": "<h2 id=\"å“ˆå¸Œç®—æ³•\"><a class=\"markdownIt-Anchor\" href=\"#å“ˆå¸Œç®—æ³•\">#</a> å“ˆå¸Œç®—æ³•</h2>\n<p>å“ˆå¸Œç®—æ³•ï¼Œåˆç§°ä¸ºï¼šæ•£åˆ—å‡½æ•°ï¼Œæ•£åˆ—ç®—æ³•ã€‚</p>\n<p>å“ˆå¸Œç®—æ³•æ˜¯æŒ‡å°†ä»»æ„é•¿åº¦çš„äºŒè¿›åˆ¶å€¼ä¸²æ˜ å°„ä¸ºå›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶ä¸²çš„è¿™ä¸€è§„åˆ™ã€‚</p>\n<p>ä¸¾ä¸ªä¾‹å­:  <code>Jdk</code>  çš„ <code>HashMap</code>  ä¸­ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">hash</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (key == <span class=\"keyword\">null</span>) ? <span class=\"number\">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>çœ‹ä¼¼å®ç°éå¸¸ç®€å•ï¼Œä½†æ˜¯è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„å“ˆå¸Œç®—æ³•å´ä¸æ˜¯ç®€å•çš„äº‹æƒ…ã€‚ä¼˜ç§€çš„ Hash ç®—æ³•æœ‰ä»€ä¹ˆè¦æ±‚ï¼Ÿ</p>\n<ul>\n<li>ä» Hash å€¼ä¸èƒ½åå‘æ¨å¯¼å‡ºåŸå§‹æ•°æ®ï¼Œæ‰€ä»¥å“ˆå¸Œç®—æ³•ä¹Ÿå«å•å‘å“ˆå¸Œç®—æ³•ã€‚</li>\n<li>å¯¹è¾“å…¥æ•°æ®æ•æ„Ÿï¼Œä¿®æ”¹äº†åŸå§‹æ•°æ®ä¸­çš„ä¸€ä¸ª bitï¼Œæœ€åå¾—åˆ°çš„å“ˆå¸Œå€¼ä¹Ÿå¤§ä¸ç›¸åŒã€‚</li>\n<li>å“ˆå¸Œå†²çª (ä¹Ÿå«å“ˆå¸Œç¢°æ’) çš„æ¦‚ç‡è¦å¾ˆå°ï¼Œå¯¹äºä¸åŒçš„åŸå§‹æ•°æ®ï¼Œå“ˆå¸Œå€¼ç›¸åŒçš„æ¦‚ç‡éå¸¸å°ã€‚</li>\n<li>å“ˆå¸Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¦å°½é‡é«˜æ•ˆï¼Œé’ˆå¯¹è¾ƒé•¿çš„æ–‡æœ¬ï¼Œä¹Ÿèƒ½å¿«é€Ÿåœ°è®¡ç®—å‡ºå“ˆå¸Œå€¼ã€‚</li>\n</ul>\n<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªå“ˆå¸Œç®—æ³•çš„ä¾‹å­: MD5 () å‡½æ•°ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MD5Demo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class=\"line\">        System.out.println(md5(<span class=\"string\">&quot;123456789&quot;</span>)); <span class=\"comment\">// 25f9e794323b453885f5181f1b624d0b</span></span><br><span class=\"line\">        System.out.println(md5(<span class=\"string\">&quot;123456788&quot;</span>)); <span class=\"comment\">// f5f091a697cd91c4170cda38e81f4b1a</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String <span class=\"title\">md5</span><span class=\"params\">(String input)</span> <span class=\"keyword\">throws</span> NoSuchAlgorithmException </span>&#123;</span><br><span class=\"line\">        MessageDigest md5 = MessageDigest.getInstance(<span class=\"string\">&quot;MD5&quot;</span>);</span><br><span class=\"line\">        md5.update(input.getBytes());</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] digest = md5.digest();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> BigInteger(<span class=\"number\">1</span>, digest).toString(<span class=\"number\">16</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>é¦–å…ˆä»å“ˆå¸Œåçš„ä¸²åæ¨å‡ºåŸå§‹å­—ç¬¦ä¸²æ˜¯éå¸¸å›°éš¾çš„ã€‚åœ¨ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ä»…ä»…æ˜¯å°† 9 æ”¹æˆäº† 8ï¼Œä½†æ˜¯ Hash åçš„å€¼æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚<br>\nå¯¹äºä»»ä½•ä¸€ç§å“ˆå¸Œç®—æ³•æˆ‘ä»¬éƒ½åªèƒ½å°½é‡çš„å‡å°‘å…¶å†²çªçš„æ¦‚ç‡ï¼Œç†è®ºä¸Šæ˜¯ä¸å¯èƒ½åšåˆ°å®Œå…¨ä¸å†²çªçš„ã€‚åœ¨ç»„åˆæ•°å­¦ä¸­æœ‰ä¸€ä¸ªè‘—åçš„ç†è®ºå°±æ˜¯ï¼š<span class=\"label success\">æŠ½å±‰åŸç†ï¼Œä¹Ÿå«é¸½å·¢åŸç†ã€‚å¦‚æœæœ‰ 10 ä¸ªé¸½å·¢ï¼Œä½†æ˜¯æœ‰ 11 åªé¸½å­ï¼Œé‚£ä¹ˆè‚¯å®šä¼šæœ‰ä¸€ä¸ªé¸½å·¢ä¸­çš„é¸½å­æ•°é‡å¤šäºä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯è‚¯å®šä¼šæœ‰ä¸€ä¸ªé¸½å·¢é‡Œæœ‰ä¸¤åªé¸½å­</span>ã€‚åŒç†è€Œè¨€ï¼Œä¸ç®¡æˆ‘ä»¬å¯¹ä»€ä¹ˆæ ·çš„æ•°æ®è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—å‡ºçš„å“ˆå¸Œå€¼çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯è¦å“ˆå¸Œè¿ç®—çš„åŸå§‹æ•°æ®ç¡®å®æ— ç©·æ— å°½çš„ã€‚ä»¥ MD5 ç®—æ³•ä¸ºä¾‹ã€‚æˆ‘ä»¬ç”Ÿæˆäº† 32 ä½çš„ 16 è¿›åˆ¶æ•°çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”Ÿæˆä¸²çš„å¯èƒ½æ€§ä¸º 16^32 ç§ã€‚å¦‚æœæˆ‘ä»¬æ˜¯ç¬¬ 16^32 + 1 ä¸ªæ•°æ®è¿›è¡Œå“ˆå¸Œè¿ç®—è‚¯å®šå°±ä¼šäº§ç”Ÿ å“ˆå¸Œå†²çªã€‚</p>\n<p>ä½†æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥è½»æ˜“çš„å¾—å‡ºè¿™æ ·ä¸€ä¸ªç»“è®º:</p>\n<p><b>å“ˆå¸Œå€¼è¶Šé•¿çš„å“ˆå¸Œç®—æ³•ï¼Œæ•£åˆ—å†²çªçš„æ¦‚ç‡è¶Šä½</b></p>\n<p>é‚£ä¹ˆå“ˆå¸Œç®—æ³•ï¼Œä¸»è¦åº”ç”¨åœ¨å“ªäº›æ–¹é¢å‘¢ï¼Ÿ</p>\n<h2 id=\"å“ˆå¸Œç®—æ³•çš„åº”ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#å“ˆå¸Œç®—æ³•çš„åº”ç”¨\">#</a> å“ˆå¸Œç®—æ³•çš„åº”ç”¨</h2>\n<h3 id=\"å®‰å…¨åŠ å¯†\"><a class=\"markdownIt-Anchor\" href=\"#å®‰å…¨åŠ å¯†\">#</a> å®‰å…¨åŠ å¯†</h3>\n<p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº† MD5 ç®—æ³•ï¼Œè¿™ä¸ªæ˜¯è€ç”Ÿå¸¸è°ˆçš„åŠ å¯†ç®—æ³•äº†ï¼Œæ®è¯´å·²ç»è¢«ç ´è§£äº†ã€‚</p>\n<ul>\n<li>MD5 ç®—æ³• : message digest Algorithm MD5 æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€‚</li>\n<li>SHA ç®—æ³• : Secure Hash Algorithm å®‰å…¨æ•£åˆ—ç®—æ³•</li>\n<li>DES ç®—æ³• : data Encryption Standard æ•°æ®åŠ å¯†æ ‡å‡†</li>\n<li>AES ç®—æ³• : Advanced Encryption Standard é«˜çº§åŠ å¯†æ ‡å‡†ã€‚</li>\n</ul>\n<p>å¯¹ç”¨äºåŠ å¯†çš„å“ˆå¸Œç®—æ³•ï¼Œæœ‰ä¸¤ä¸ªç‰¹åˆ«é‡è¦çš„è¦æ±‚: 1. å¾ˆéš¾é€šè¿‡ Hash å€¼æ¨å¯¼å‡ºåŸå§‹çš„å­—ç¬¦ä¸²ã€‚2. æ•£åˆ—å†²çªçš„æ¦‚ç‡è¦å¾ˆå°ã€‚</p>\n<h3 id=\"å”¯ä¸€æ ‡è¯†\"><a class=\"markdownIt-Anchor\" href=\"#å”¯ä¸€æ ‡è¯†\">#</a> å”¯ä¸€æ ‡è¯†</h3>\n<ul>\n<li>md5: ä¾‹å¦‚ï¼šæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªå›¾ç‰‡çš„å”¯ä¸€æ ‡è¯†ï¼Œå›¾ç‰‡çš„è·¯å¾„éƒ½å­˜å‚¨åˆ°æ•£åˆ—è¡¨ä¸­ï¼Œè¦æŸ¥çœ‹ä»€ä¹ˆå›¾ç‰‡çš„æ—¶å€™å¯ä»¥æ ¹æ®å”¯ä¸€æ ‡è¯†å»æŸ¥åˆ°å¯¹åº”çš„å›¾ç‰‡ã€‚</li>\n</ul>\n<h3 id=\"æ•°æ®æ ¡éªŒ\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®æ ¡éªŒ\">#</a> æ•°æ®æ ¡éªŒ</h3>\n<ul>\n<li>æˆ‘ä»¬å¸¸è¯´çš„ï¼Œæ£€éªŒä¸€ä¸ªæ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œè¦æ£€éªŒä¸‹ md5 å€¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ¯”ï¼Œæ¥æ ¡éªŒæ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚</li>\n</ul>\n<h3 id=\"æ•£åˆ—å‡½æ•°\"><a class=\"markdownIt-Anchor\" href=\"#æ•£åˆ—å‡½æ•°\">#</a> æ•£åˆ—å‡½æ•°</h3>\n<ul>\n<li>Java ä¸­ HashMap ç­‰ç”¨æ¥è®¡ç®—å“ˆå¸Œå€¼ã€‚å¯¹æ•£åˆ—çš„å¹³å‡æ€§å’Œå“ˆå¸Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¦æ±‚è¾ƒé«˜ã€‚</li>\n</ul>\n<h3 id=\"è´Ÿè½½å‡è¡¡\"><a class=\"markdownIt-Anchor\" href=\"#è´Ÿè½½å‡è¡¡\">#</a> è´Ÿè½½å‡è¡¡</h3>\n<ul>\n<li>è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è½®è¯¢ç®—æ³•ï¼Œéšæœºç®—æ³•ï¼ŒåŠ æƒè½®è¯¢ç®—æ³•ã€‚</li>\n</ul>\n<h3 id=\"æ•°æ®åˆ†ç‰‡\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®åˆ†ç‰‡\">#</a> æ•°æ®åˆ†ç‰‡</h3>\n<ul>\n<li>å…¸å‹çš„æ•°æ®åº“çš„åˆ†åº“åˆ†è¡¨ç­‰æµ·é‡æ•°æ®çš„æŸ¥è¯¢åœºæ™¯</li>\n</ul>\n<h3 id=\"åˆ†å¸ƒå¼å­˜å‚¨\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†å¸ƒå¼å­˜å‚¨\">#</a> åˆ†å¸ƒå¼å­˜å‚¨</h3>\n<ul>\n<li>è¿™ç§çš„å°±æ˜¯å¯¹æµ·é‡æ•°æ®çš„å­˜å‚¨åœºæ™¯ã€‚æ¯”å¦‚åˆ†å¸ƒå¼ç¼“å­˜ (Redis)ï¼Œå¦‚ä½•åˆ¤æ–­è¯¥æ¡æ•°æ®åˆ†é…åœ¨å“ªå° Redis ä¸­ã€‚</li>\n</ul>\n<p><b>å“ˆå¸Œç®—æ³•çš„å‡ ç§ä½¿ç”¨åœºæ™¯ï¼Œä»‹ç»å®Œæ¯•ï¼Œæˆ‘ä»¬é‡æ–°æ¥çœ‹çœ‹è¿™ç§ Hash ç®—æ³•åœ¨åº”ç”¨ä¸­æœ‰ä»€ä¹ˆç¼ºé™·</b></p>\n<h2 id=\"ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•\"><a class=\"markdownIt-Anchor\" href=\"#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•\">#</a> ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</h2>\n<p>åœ¨è´Ÿè½½å‡è¡¡ï¼Œæ•°æ®åˆ†ç‰‡ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ä¸‰ç§åœºæ™¯ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œé€šè¿‡åˆ†å¸ƒå¼é›†ç¾¤çš„æ–¹å¼æ¥å¯¹æµ·é‡æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p>\n<p>è¿™æ—¶ï¼Œå‡è®¾åœ¨é›†ç¾¤ä¸­çªç„¶ä¸€å°æœºå™¨å®•æœºï¼Œè¢«è¿«ä¸‹çº¿ã€‚è¿™æ—¶ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>\n<p>æˆ‘å†æ¥è¯¦ç»†çš„æè¿°ä¸‹è¿™ä¸ªåœºæ™¯ã€‚</p>\n<p>ä»¥åˆ†å¸ƒå¼ç¼“å­˜ä¸ºä¾‹ï¼š</p>\n<p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨ Redis é›†ç¾¤åšå›¾ç‰‡èµ„æºçš„ç¼“å­˜ï¼ŒRedis çš„ key æ˜¯å›¾ç‰‡çš„åç§°ï¼Œvalue æ˜¯å¯¹åº”æœåŠ¡å™¨çš„è·¯å¾„ã€‚å¦‚æœæ•°æ®æ˜¯ 1000wï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨ 5 å°æœåŠ¡å™¨è¿›è¡Œç¼“å­˜ï¼Œæ¯å°æœåŠ¡å™¨å¤§äº 200w æ•°æ®ï¼Œå¹¶ä¸”æ˜¯éƒ½æ˜¯ä¸»ä»çš„æ¶æ„ã€‚<br>\nå¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E4%B8%80%E8%87%B4%E6%80%A7Hash1.png\" alt=\"\"></p>\n<p>å¾ˆç®€å•çš„å­˜å‚¨æ–¹å¼ï¼š æˆ‘ä»¬å¯¹æ²¡ä»–å›¾ç‰‡çš„åç§°è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¹¶å¯¹å¾—å‡ºçš„å“ˆå¸Œå€¼å’Œ 5 è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œå¾—åˆ°è¿™ä¸ªå›¾ç‰‡èµ„æºæ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œå»è·å–æ•°æ®ã€‚<br>\næ¯”å¦‚ï¼š hash (2020053000001.png) % 5 = 3ï¼Œè¡¨ç¤ºä½äºç¬¬ 4 å°æœåŠ¡å™¨ä¸Šã€‚</p>\n<p><b>å¾ˆä¸å¹¸ï¼ï¼ï¼ï¼Œçªç„¶æœ‰å°æœºå™¨å®•æœºäº†ï¼Œå¹¶ä¸”è¿™å°æœºå™¨è¢«è¸¢ä¸‹çº¿äº†ï¼Œé›†ç¾¤ä¸­æœºå™¨ç”± 5 å° å˜æˆäº† 4 å° (å‡)</b></p>\n<p>é‚£ä¹ˆè¿™æ—¶ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ æˆ‘ä»¬ä¼šå‘ç°æ‰€æœ‰çš„å›¾ç‰‡èµ„æºéƒ½æ— æ³•å‘½ä¸­ç¼“å­˜èµ„æºäº†ã€‚è¿™æ—¶å°±å‡ºç°æ‰€è°“çš„ â€œç¼“å­˜é›ªå´©â€ã€‚</p>\n<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæœ¬æ¥ hash (2020053000001.png) % 5 = 3ï¼Œç”±äºé›†ç¾¤ä¸­åªæœ‰ 4 å°æœºå™¨äº†ï¼Œé‚£ä¹ˆ hash (2020053000001.png) % 4 = 3 å°±ä¸€å®šä¸ä¼šæ˜¯ 3 äº†å§ï¼</p>\n<p>è¿™æ—¶å€™ä½ å°±è¯´äº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯¹ 5 å–æ¨¡ä¸å°±è¡Œäº†ï¼Ÿè¿™æ ·è‡³å°‘å…¶ä»– 4 å°ç¼“å­˜æœåŠ¡å™¨è¿˜å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ã€‚ä½†æ˜¯è¿™æ ·æ‰€æœ‰å‘½ä¸­å®•æœºæœåŠ¡å™¨çš„ç¼“å­˜éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ï¼Œè¿™æ ·è¿˜æ˜¯æœ‰å¯èƒ½ç›´æ¥å¯¼è‡´æ•°æ®åº“å®•æœºçš„ï¼</p>\n<p>æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>\n<p><b>ä¸€æ³¢ä¸å¹³ï¼Œä¸€æ³¢åˆèµ·ï¼éšç€è®¿é—®é‡çš„å¢å¤§ï¼Œç¼“å­˜æœåŠ¡å™¨ä¸å ªé‡è´Ÿï¼ç¼“å­˜æœåŠ¡å™¨è¦ä» 5 å°å¢åŠ åˆ° 8 å°ï¼(å¢)</b></p>\n<p>åŒæ ·çš„é—®é¢˜ï¼š hash (2020053000001.png) % 5 = 3 ï¼Œä½†æ˜¯ hash (2020053000001.png) % 8 = ?? , æœ‰ä¸€æ¬¡ â€œé›ªå´©ï¼â€</p>\n<p>æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>\n<p><b>ç¬¬ä¸‰æ³¢ï¼ç»è¿‡é•¿æ—¶é—´çš„ç›‘æ§ï¼Œå‘ç°ç¼“å­˜æœåŠ¡å™¨çš„å‹åŠ›ä¸»è¦é›†ä¸­åœ¨æ™šä¸Šçš„ 7:00 - 10:00 ä¹‹é—´ï¼Œå…¶ä»–æ—¶é—´æ®µçš„å‹åŠ›å°±å¾ˆå°ï¼(å‡)</b></p>\n<p>è¦æ±‚å®ç°å¯ä»¥åŠ¨æ€çš„æ‰©å¼ å’Œç¼©å°é›†ç¾¤çš„æ•°é‡ã€‚</p>\n<p>æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>\n<p><b>é‡è¦å˜‰å®¾ï¼š ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</b></p>\n<p>ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å‘¢ï¼Ÿ</p>\n<p>åˆšæ‰åœ¨ç¬¬ä¸€æ³¢çš„æ—¶å€™ï¼Œè¯´è¿‡æˆ‘ä»¬å¯ä»¥å¯¹ 5 å–æ¨¡å•Šã€‚è¿™ä¸ªæ€è·¯æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸èƒ½æ ¹æ®é›†ç¾¤ä¸­æœåŠ¡å™¨æ•°é‡æ¥è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œè€Œæ˜¯è¦å¯¹ä¸€ä¸ªå›ºå®šå¤§çš„æ•°æ¥å–æ¨¡è¿ç®—ï¼ˆ2^32=4294947297ï¼ˆæœ€å¤§çš„éç¬¦å·æ•´å½¢æ•°ï¼‰ï¼‰ã€‚ é‚£å“ˆå¸Œå€¼å¯¹åº”çš„ä½ç½®ä¸Šæ²¡æœ‰æœºå™¨æ€ä¹ˆåŠï¼Ÿæˆ‘æ¥è§£é‡Šä¸‹ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„æ•´ä½“é€»è¾‘ï¼š</p>\n<p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ã€‚è€Œä¸”è¿™ä¸ªå“ˆå¸Œå€¼ç©ºé—´çš„å¤§å°ä¸º  <code>[0, 2^32-1]</code> , å¦‚ä¸‹å›¾ã€‚</p>\n<p>ä» 0 å¼€å§‹ï¼Œé¡ºæ—¶é’ˆè®¡æ•°ï¼Œç›´åˆ° 2^32-1, è¿™ 2^32 ä¸ªç‚¹ç»„æˆçš„åœ†ç¯ç§°ä¸º Hash ç¯ã€‚</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E4%B8%80%E8%87%B4%E6%80%A7Hash2.png\" alt=\"å“ˆå¸Œå›¾\"></p>\n<p>è¿˜æ˜¯ä»¥ä¸Šé¢çš„åœºæ™¯ï¼Œ 5 å°æœåŠ¡å™¨éšæœºåˆ†å¸ƒåœ¨ç¯ä¸Šï¼Œå¦‚ä¸‹å›¾ï¼Œ</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E4%B8%80%E8%87%B4%E6%80%A7Hash3.png\" alt=\"å“ˆå¸Œå›¾\"></p>\n<p>å¸¸é‡ MAX_VALUE = 2 ^ 32;</p>\n<ul>\n<li>å‡è®¾å›¾ç‰‡èµ„æº: hash (20200530004562.png) = 4ï¼›å¦‚æœç¬¬ 4 ä¸ªä½ç½®ä¸Šæ­£å¥½æœ‰ä¸€å°æœåŠ¡å™¨ï¼Œå°±ç›´æ¥å°†è¿™ä¸ªæ¡æ•°æ®ç¼“å­˜åˆ°è¯¥å°æœåŠ¡å™¨ä¸Šã€‚</li>\n<li>å‡è®¾å›¾ç‰‡èµ„æºï¼šhash (20200530015456.png) = 46581ï¼›åœ¨ç¬¬ 46581 ä¸Šå¹¶æ²¡æœ‰æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä»¥é¡ºæ—¶é’ˆçš„æ–¹å‘ï¼Œè¿›è¡Œéå†ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨ 58941ï¼Œç¼“å­˜åˆ°è¯¥å°æœåŠ¡å™¨ 58941 ä¸Šã€‚</li>\n</ul>\n<p>å¦‚ä¸‹å›¾:</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E4%B8%80%E8%87%B4%E6%80%A7Hash4.png\" alt=\"å“ˆå¸Œå›¾\"></p>\n<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹æˆ‘ä»¬çš„ä¸‰æ³¢:</p>\n<ul>\n<li><b>çªç„¶æœ‰ä¸€å°æœºå™¨å®•æœºï¼</b></li>\n</ul>\n<p>å‡è®¾ 65594 è¿™å°æœºå™¨å®•æœºï¼Œé‚£ä¹ˆå°±æ— æ³•æŸ¥è¯¢ç¼“å­˜åœ¨ 65594 è¿™å°æœºå™¨ä¸Šçš„æ•°æ®ï¼Œç¨‹åºä¼šé¡ºæ—¶é’ˆæ–¹å‘è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ° 73214 è¿™å°æœºå™¨ï¼Œè·å–ç¼“å­˜ä¸ºç©ºï¼ŒæŸ¥è¯¢æ•°æ®åº“åå°†æ•°æ®ç¼“å­˜åˆ° 73214 è¿™å°æœºå™¨ä¸Šã€‚</p>\n<ul>\n<li><b>æ–°å¢æœºå™¨åˆ°é›†ç¾¤ä¸­</b></li>\n</ul>\n<p>å‡è®¾ åœ¨é›†ç¾¤èŠ‚ç‚¹å· 73214 å’Œ 138956 ä¹‹é—´æ’å…¥ä¸€å°æœºå™¨ 100354 ã€‚é‚£ä¹ˆåŸæ¥ hash åœ¨ (73214,100354] ä¹‹å‰çš„æ•°æ®ï¼Œå°±ä¸ä¼šç¼“å­˜åˆ° 138956 èŠ‚ç‚¹äº†ï¼Œ</p>\n<ul>\n<li><b>åŠ¨æ€</b></li>\n</ul>\n<p>åœ¨æ–°å¢å’Œåˆ é™¤å®Œæˆä¹‹åï¼ŒåŠ¨æ€ï¼Œç†è®ºä¸Šä¹Ÿæ˜¯ OK çš„ã€‚å…·ä½“å®ç°çš„è¯ï¼Œå°±æ˜¯ç›‘æ§è®¿é—®æµé‡ï¼Œæ ¹æ®æµé‡é˜ˆå€¼è®¾ç½®åŠ¨æ€çš„æ‰©å±•å’Œ â€œè¸¢ä¸‹çº¿æœºå™¨â€(å°†æœºå™¨ç»™å…¶ä»–ä¸šåŠ¡ç”¨)ã€‚</p>\n<h3 id=\"ä¸€è‡´æ€§å“ˆå¸Œç¼ºç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#ä¸€è‡´æ€§å“ˆå¸Œç¼ºç‚¹\">#</a> ä¸€è‡´æ€§å“ˆå¸Œç¼ºç‚¹</h3>\n<h4 id=\"æ•°æ®å€¾æ–œ\"><a class=\"markdownIt-Anchor\" href=\"#æ•°æ®å€¾æ–œ\">#</a> æ•°æ®å€¾æ–œ</h4>\n<p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå½“åœ¨æœåŠ¡å™¨èŠ‚ç‚¹æ•°é‡å¤ªå°‘çš„æ—¶å€™ï¼Œå®¹æ˜“å‡ºç°åˆ†é…ä¸å‡è€Œå¯¼è‡´æ•°æ®å€¾æ–œã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œå¦‚ä¸‹å›¾åˆ†å¸ƒ:</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E4%B8%80%E8%87%B4%E6%80%A7Hash5.png\" alt=\"å“ˆå¸Œå›¾\"></p>\n<p>å‡è®¾å¤§é‡æ•°æ®å“ˆå¸Œåçš„å€¼åœ¨ [C,MaxValue] ä¹‹é—´ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ•°æ®éƒ½ä¼šæ•£åˆ—åˆ°ç¬¬ 1 ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>\n<p>è¿™ç§é—®é¢˜ï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>\n<p><b>è™šæ‹ŸèŠ‚ç‚¹</b></p>\n<p>å‡è®¾æˆ‘ä»¬æœ‰ 5 å°æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œé˜²æ­¢å„èŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€å°æœåŠ¡å…¶è¿›è¡Œå¤šæ¬¡å“ˆå¸Œè¿ç®—ï¼Œä»è€Œè™šæ‹Ÿå‡ºä¸ªèŠ‚ç‚¹ã€‚</p>\n<p>å‡è®¾æˆ‘ä»¬åŸæ¥å¯¹æœåŠ¡å™¨ 1 çš„ IP (192.168.0.1) è¿›è¡Œå“ˆå¸Œï¼Œæˆ‘ä»¬ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹çš„æ–¹å¼è¿›è¡Œå“ˆå¸Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ï¼ˆ192.168.0.1#1ï¼‰ï¼Œï¼ˆ192.168.0.1#2ï¼‰ï¼Œï¼ˆ192.168.0.1#3ï¼‰ï¼Œï¼ˆ192.168.0.1#4ï¼‰ã€‚è¿™æ · 5 å°æœºå™¨ï¼Œå°±å¯ä»¥æœ‰ 20 ä¸ªèŠ‚ç‚¹ã€‚ä»è€ŒåŠ å¤§äº†å“ˆå¸Œååˆ†å¸ƒçš„éšæœºæ€§ã€‚è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚å®é™…åº”ç”¨ä¸­ï¼Œè‡³å°‘è¦å¤§äº 32 ã€‚</p>\n<p>å¥½äº†ï¼Œå…³äºä¸€è‡´æ€§å“ˆå¸Œçš„ç›¸å…³å†…å®¹ï¼Œæœ¬ç¯‡æ–‡ç« å°±ä»‹ç»åˆ°è¿™é‡Œã€‚</p>\n<p><b>ä¸‹ä¸€ç¯‡æ–‡ç« ã€Šä¸€è‡´æ€§ Hash ç®—æ³•çš„å®ç°ã€‹è¯·æœŸå¾… </b></p>\n<p>å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿ä½ ç§ä¿¡æˆ‘ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµå“‡ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "å“ˆå¸Œç®—æ³•"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/dynamicPlan/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/",
            "url": "https://fangjiaxiaobai.github.io/2021/09/01/dataStructuresAndAlgorithms/dynamicPlan/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/",
            "title": "åŠ¨æ€è§„åˆ’",
            "date_published": "2021-09-01T04:13:55.000Z",
            "content_html": "<p>ğŸ‘‰ <span class=\"label success\">åŠ¨æ€è§„åˆ’å…¶å®å°±æ˜¯åŠ¨æ€é€’æ¨</span>ğŸ‘ˆ</p>\n<h2 id=\"è¦ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#è¦ç‚¹\">#</a> è¦ç‚¹</h2>\n<ul>\n<li>é€’å½’ + è®°å¿†åŒ– -&gt; é€’æ¨ (è‡ªä¸‹è€Œä¸Šçš„é€’æ¨)</li>\n<li>çŠ¶æ€çš„å®šä¹‰ï¼Œopt [n],dp [n],fib [n]</li>\n<li>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ (dp æ–¹ç¨‹)ï¼Œ opt [n]=best_of (opt [n-1],opt [n-2])</li>\n<li>æœ€ä¼˜å­ç»“æ„</li>\n</ul>\n<h2 id=\"ä¾‹å­\"><a class=\"markdownIt-Anchor\" href=\"#ä¾‹å­\">#</a> ä¾‹å­</h2>\n<h3 id=\"æ–æ³¢é‚£å¥‘æ•°åˆ—\"><a class=\"markdownIt-Anchor\" href=\"#æ–æ³¢é‚£å¥‘æ•°åˆ—\">#</a> æ–æ³¢é‚£å¥‘æ•°åˆ—</h3>\n<p>æˆ‘ä»¬å…ˆä½¿ç”¨é€’å½’çš„æ–¹å¼ï¼Œæˆ‘ä»¬å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ—.</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">fib1</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">fib2</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;fib1(6)=%d\\n&quot;</span>, fib1(<span class=\"number\">6</span>));</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;fib2(6)=%d\\n&quot;</span>, fib2(<span class=\"number\">6</span>));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ–æ³¢é‚£å¥‘æ•°åˆ—å®ç°æ–¹æ¡ˆä¸€</span></span><br><span class=\"line\"><span class=\"comment\"> * @param n ç¬¬nä¸ªæ•°</span></span><br><span class=\"line\"><span class=\"comment\"> * @return nä¸ªæ•°çš„å€¼</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">fib1</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (n == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fib1(n - <span class=\"number\">1</span>) + fib1(n - <span class=\"number\">2</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ–æ³¢é‚£å¥‘æ•°åˆ—å®ç°æ–¹æ¡ˆäºŒ</span></span><br><span class=\"line\"><span class=\"comment\"> * @param n ç¬¬nä¸ªæ•°</span></span><br><span class=\"line\"><span class=\"comment\"> * @return nä¸ªæ•°çš„å€¼</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">fib2</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fib1(n - <span class=\"number\">1</span>) + fib1(n - <span class=\"number\">2</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/// return n&lt;=1?1:fib1(n - 1) + fib1(n - 2);</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚ä¸‹å›¾:</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9201-fib.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’01-fib.png\"><br>\n æ­¤æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸º O (2^n). å¦‚ä¸Šå›¾ï¼Œæœ€åçš„ç»“æœæ˜¯æ¯ä¸ªèŠ‚ç‚¹æ˜¯ç´¯åŠ èµ·æ¥ï¼Œé‚£ä¹ˆæœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹å‘¢ï¼Ÿ2^n ä¸ªèŠ‚ç‚¹ã€‚<br>\næ ¹æ®è¿™å¼ å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¸ªåˆ« &quot;èŠ‚ç‚¹&quot; å‡ºç°äº†é‡å¤çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ç”¨åˆ°äº†è®°å¿†åŒ–çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">fib3</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;fib3(6)=%d\\n&quot;</span>, fib3(<span class=\"number\">6</span>));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ–æ³¢é‚£å¥‘æ•°åˆ—å®ç°æ–¹æ¡ˆä¸‰</span></span><br><span class=\"line\"><span class=\"comment\"> * @param n  ç¬¬nä¸ªæ•°</span></span><br><span class=\"line\"><span class=\"comment\"> * @return nä¸ªæ•°çš„å€¼</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> mem[<span class=\"number\">100</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">fib3</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (n == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!mem[n]) &#123;</span><br><span class=\"line\">        mem[n] = fib1(n - <span class=\"number\">1</span>) + fib1(n - <span class=\"number\">2</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mem[n];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·æˆ‘ä»¬å°±çœå»äº†ä¸ªåˆ«èŠ‚ç‚¹çš„è®¡ç®—è¿‡ç¨‹äº†ã€‚å¦‚ä¸‹å›¾<br>\n<img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9201-fib02.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’01-fib02.png\"> å…¶ä¸­è™šçº¿è¾¹æ¡†çš„å°±ä¸ç”¨å†è®¡ç®—äº†ã€‚</p>\n<p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬æŠŠæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº† O (n).</p>\n<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fib(n) = fib(n-1) + fib(n-2);</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ (dp æ–¹ç¨‹)ã€‚<br>\næ¯”è¾ƒçš„ç®€å•çš„ fibï¼Œä¸€èˆ¬æˆ‘ä»¬å°±æˆä¸ºè¿™ä¸ªä¸ºé€’æ¨å…¬å¼ã€‚</p>\n<h3 id=\"è®¡ç®—è·¯çº¿\"><a class=\"markdownIt-Anchor\" href=\"#è®¡ç®—è·¯çº¿\">#</a> è®¡ç®—è·¯çº¿</h3>\n<h4 id=\"ä¾‹é¢˜æè¿°\"><a class=\"markdownIt-Anchor\" href=\"#ä¾‹é¢˜æè¿°\">#</a> ä¾‹é¢˜æè¿°</h4>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9202-%E8%AE%A1%E7%AE%97%E8%B7%AF%E5%BE%84.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’02-è®¡ç®—è·¯å¾„.png\"></p>\n<p>åªèƒ½æ¨ªç€èµ°æˆ–è€…ç«–ç€èµ°ï¼Œå‡è®¾æœ‰ä¸€ä¸ªäººæ€» start å¤„ï¼Œèµ°åˆ° end å¤„ï¼Œä¸€å…±æœ‰å¤šå°‘æ¡è·¯çº¿ï¼Ÿ</p>\n<h4 id=\"åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†æ\">#</a> åˆ†æ</h4>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9202-%E8%AE%A1%E7%AE%97%E8%B7%AF%E5%BE%8402.png\" alt=\"ç®—æ³•02-åŠ¨æ€è§„åˆ’03-è®¡ç®—è·¯å¾„02.png\"></p>\n<p>ä» start åˆ° end çš„æ‰€æœ‰è·¯çº¿ï¼Œç­‰äº B åˆ° end è·¯çº¿åŠ ä¸Š A åˆ° end çš„è·¯çº¿ã€‚å› ä¸º start è¦åˆ° endï¼Œè¦ä¹ˆåˆ° A, ä» A èµ°åˆ° end, è¦ä¹ˆåˆ° Bï¼Œä» B èµ°åˆ° endã€‚é‚£ä¹ˆåŒç† B åˆ° end å°±ç­‰äº C åˆ° end çš„è·¯çº¿åˆ° E åˆ° end çš„è·¯çº¿ã€‚D åˆ° end ç­‰äº C åˆ° end çš„è·¯çº¿åŠ ä¸Š D åˆ° end çš„è·¯çº¿.<br>\n è¿™æ˜¯æˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹çš„æ¨å¯¼å…¬å¼ï¼š</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>B</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">path(start,end)=path(A,end) + path(B,end)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>åŒç†:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>A</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>D</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo><mspace linebreak=\"newline\"></mspace><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>B</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>E</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mo stretchy=\"false\">(</mo><mi>C</mi><mo separator=\"true\">,</mo><mi>e</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">path(A,end)=path(D,end) + path(C,end) \\\\ path(B,end) = path(E,end) + path(C,end)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>ä¸€ç›´åˆ°æœ€ä¸‹é¢çš„ä¸€è¡Œï¼Œæœ€ä¸‹é¢çš„è¿™ä¸€è¡Œçš„æ¯ä¸ªç‚¹åˆ° end çš„è·¯çº¿åªæœ‰ä¸€æ¡ï¼Œæ‰€ä»¥æ¯ä¸ªéƒ½æ˜¯ 1, åŒæ ·çš„æœ€å³ä¾§çš„ä¸€åˆ—ï¼Œæ¯ä¸ªéƒ½æ˜¯ 1. å¦‚ä¸‹å›¾.<br>\n<img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9202-%E8%AE%A1%E7%AE%97%E8%B7%AF%E5%BE%8403.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’02-è®¡ç®—è·¯å¾„03.png\"><br>\n ç»è¿‡ä¸Šé¢çš„åˆ†æï¼ŒF åˆ° end æœ‰å‡ æ¡è·¯çº¿å‘¢ï¼Ÿä¸¤æ¡ã€‚ç”±äº G å³ä¾§æ˜¯é»‘è‰²çš„ä¸èƒ½é€šè¿‡ï¼Œæ‰€ä»¥ G åªæœ‰ 1 æ¡ï¼ŒH å°±æœ‰ 2 æ¡ï¼Œå°±æœ‰ 3 æ¡ï¼ŒK æœ‰ 3 æ¡ï¼ŒL æœ‰ 1 æ¡ã€‚æ‰€ä»¥æœ‰äº†ä¸‹é¢çš„è¿™å¼ å›¾ï¼Œå›¾ä¸­çš„æ•°å­—å°±æ˜¯è·¯çº¿æ•°.<br>\n<img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9202-%E8%AE%A1%E7%AE%97%E8%B7%AF%E5%BE%8404.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’02-è®¡ç®—è·¯å¾„04.png\"></p>\n<p>æ ¹æ®ä»¥ä¸Šçš„æ¨è®ºæˆ‘ä»¬å°è¯•å†™å‡ºè¿™æ ·çš„ä»£ç :</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">countPaths</span><span class=\"params\">(<span class=\"keyword\">int</span>[][] grid,<span class=\"keyword\">int</span> row,<span class=\"keyword\">int</span> col)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!validSquare(grid,row,col))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(isEnd(grid,row,col))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> countPaths(grid,row+<span class=\"number\">1</span>,col) + countPaths(grid,row,col+<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘æ ¹æ®æ¨è®ºå¯ä»¥å¾—å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> a[i,j] == <span class=\"string\">&#x27;ç™½è‰²&#x27;</span>:</span><br><span class=\"line\">   opt[i,j] = opt[i+<span class=\"number\">1</span>,j] + opt[i,j+<span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">   opt[i,j] = <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"ç¨‹åºå®ç°\"><a class=\"markdownIt-Anchor\" href=\"#ç¨‹åºå®ç°\">#</a> ç¨‹åºå®ç°</h4>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">uniquePaths</span><span class=\"params\">(<span class=\"keyword\">int</span> m, <span class=\"keyword\">int</span> n)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> paths[m+<span class=\"number\">1</span>][n+<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=m;i&gt;<span class=\"number\">0</span>;i--)&#123;</span><br><span class=\"line\">        paths[i][n] = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> j =n; j&gt;<span class=\"number\">0</span>;j--)&#123;</span><br><span class=\"line\">        paths[m][j] = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = m<span class=\"number\">-1</span>; i &gt; <span class=\"number\">0</span>; i--)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = n - <span class=\"number\">1</span>; j &gt; <span class=\"number\">0</span> ; j--)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            paths[i][j] = paths[i+<span class=\"number\">1</span>][j] + paths[i][j+<span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> paths[<span class=\"number\">1</span>][<span class=\"number\">1</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"dp-vs-å›æº¯-vs-è´ªå¿ƒ\"><a class=\"markdownIt-Anchor\" href=\"#dp-vs-å›æº¯-vs-è´ªå¿ƒ\">#</a> DP vs å›æº¯ vs è´ªå¿ƒ</h2>\n<ul>\n<li>å›æº¯ (é€’å½’) - é‡å¤è®¡ç®—</li>\n<li>è´ªå¿ƒ - æ°¸è¿œå±€éƒ¨æœ€ä¼˜</li>\n<li>DP - è®°å½•å±€éƒ¨æœ€ä¼˜å­ç»“æ„ / å¤šç§è®°å½•å€¼ã€‚(é›†ä¸¤è€…ä¹‹å¤§æˆ)</li>\n</ul>\n<p>ä¸‰è€…å¹¶æ²¡æœ‰æ˜æ˜¾çš„ç•Œé™ã€‚è´ªå¿ƒä¸æ˜¯å±€éƒ¨æœ€ä¼˜çš„æ—¶å€™ï¼Œå›æº¯é¿å…äº†é‡å¤è®¡ç®—ä¹‹åï¼Œå°±æ˜¯äº†åŠ¨æ€è§„åˆ’äº†ã€‚</p>\n<h2 id=\"ä¾‹é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#ä¾‹é¢˜\">#</a> ä¾‹é¢˜</h2>\n<h3 id=\"çˆ¬æ¥¼æ¢¯\"><a class=\"markdownIt-Anchor\" href=\"#çˆ¬æ¥¼æ¢¯\">#</a> çˆ¬æ¥¼æ¢¯</h3>\n<h4 id=\"é¢˜ç›®æè¿°\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®æè¿°\">#</a> é¢˜ç›®æè¿°</h4>\n<p>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚<br>\næ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ<br>\næ³¨æ„ï¼šç»™å®š n æ˜¯ä¸€ä¸ªæ­£æ•´æ•°</p>\n<h4 id=\"è§£æ\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ\">#</a> è§£æ</h4>\n<p>å¦‚ä¸‹é¢çš„å›¾:</p>\n<p><img data-src=\"/images/dataStructuresAndAlgorithms/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%9203-%E7%88%AC%E6%A5%BC%E6%A2%AF01.png\" alt=\"ç®—æ³•01-åŠ¨æ€è§„åˆ’03-çˆ¬æ¥¼æ¢¯01.png\"></p>\n<p>å› ä¸ºæˆ‘ä»¬åªæœ‰ä¸¤ç§èµ°æ³•ï¼Œè¦ä¹ˆè·¨ä¸€ä¸ªå°é˜¶ï¼Œè¦ä¹ˆè·¨ä¸¤ä¸ªå°é˜¶ã€‚é‚£ä¹ˆå¦‚å›¾ä¸­æˆ‘ä»¬çˆ¬åˆ°ç¬¬ 10 å±‚å°é˜¶çš„èµ°æ³•å°±ç­‰äºç¬¬ 9 (10-1) å±‚å°é˜¶çš„èµ°æ³•å’Œç¬¬ 8 (10-2) å±‚å°é˜¶çš„èµ°æ³•çš„å’Œã€‚å³ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mn>10</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mn>9</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mn>8</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">stairs(10)=stairs(9)+stairs(8)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord\">9</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord\">8</span><span class=\"mclose\">)</span></span></span></span>, é‚£ä¹ˆæˆ‘ä»¬çˆ¬ç¬¬ä¸€å±‚å°é˜¶æ˜¯ 1 ç§èµ°æ³•ï¼Œç¬¬äºŒå±‚å°é˜¶å°±æ˜¯ 2 ç§èµ°æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºæˆ‘ä»¬çš„é€’æ¨å…¬å¼ï¼š</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>r</mi><mi>s</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo>âˆ’</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">stairs(n) = stairs(n-1) + stairs(n-2)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">s</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œè¿™å°±æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚</p>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç®—æ³•",
                "åŠ¨æ€è§„åˆ’",
                "æ•°æ®ç»“æ„ä¸ç®—æ³•"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/04.ES%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/04.ES%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/",
            "title": "Elastic SearchåŸºæœ¬æ¦‚å¿µ",
            "date_published": "2021-08-31T08:28:55.000Z",
            "content_html": "<h1 id=\"æ–‡æ¡£\"><a class=\"markdownIt-Anchor\" href=\"#æ–‡æ¡£\">#</a> æ–‡æ¡£</h1>\n<p><code>es</code>  æ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œæ–‡æ¡£æ˜¯ <code>es</code>  ä¸­å¯æœç´¢çš„æœ€å°å•ä½ï¼Œ <code>es</code>  çš„æ–‡æ¡£ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µç»„æˆï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•ï¼Œä½† <code>es</code>  çš„æ–‡æ¡£æ˜¯ä»¥ <code>JSON</code>  è¿›è¡Œåºåˆ—åŒ–å¹¶ä¿å­˜çš„ï¼Œæ¯ä¸ª <code>JSON</code>  å¯¹è±¡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µç»„æˆï¼Œå­—æ®µç±»å‹å¯ä»¥æ˜¯å¸ƒå°”ï¼Œæ•°å€¼ï¼Œå­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶ã€æ—¥æœŸç­‰æ•°æ®ç±»å‹ã€‚<br>\n <code>es</code>  æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰å”¯ä¸€çš„ <code>id</code> , è¿™ä¸ª <code>id</code>  å¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®šï¼Œä¹Ÿå¯ä»¥ç”± <code>es</code>  è‡ªåŠ¨ç”Ÿæˆã€‚</p>\n<p><code>es</code>  æ¯ä¸€ä¸ªæ–‡æ¡£ï¼Œé™¤äº†ä¿å­˜æˆ‘ä»¬å†™å…¥è¿›è¡Œçš„æ–‡æ¡£åŸå§‹æ•°æ®å¤–ï¼Œä¹Ÿæœ‰æ–‡æ¡£è‡ªå·±çš„å…ƒæ•°æ®ï¼Œè¿™äº›å…ƒæ•°æ®ï¼Œç”¨äºæ ‡è¯†æ–‡æ¡£çš„ç›¸å…³ä¿¡æ¯ã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">&quot;_index&quot;</span> : <span class=\"string\">&quot;fxb_test&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_type&quot;</span> : <span class=\"string\">&quot;_doc&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_id&quot;</span> : <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_version&quot;</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_seq_no&quot;</span> : <span class=\"number\">0</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_primary_term&quot;</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;found&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_source&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;username&quot;</span> : <span class=\"string\">&quot;fxb&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»ä¸Šé¢çš„æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹æ–‡æ¡£çš„å…ƒæ•°æ®å­—æ®µå¦‚ä¸‹ï¼š</p>\n<p><code>_index</code> ï¼šæ–‡æ¡£æ‰€åœ¨ç´¢å¼•åç§°<br>\n <code>_source</code> ï¼šåŸå§‹ <code>json</code>  æ•°æ®<br>\n <code>_type</code> ï¼šæ–‡æ¡£æ‰€å±ç±»å‹ï¼Œ <code>es7.0</code>  ä»¥ååªæœ‰ä¸º  <code>_doc</code> <br>\n <code>_version</code> ï¼šæ–‡æ¡£ç‰ˆæœ¬ï¼Œå¦‚æœå¯¹æ–‡æ¡£è¿›è¡Œä¿®æ”¹ï¼Œåˆ™è¯¥å­—æ®µä¼šå¢åŠ <br>\n <code>_score</code> ï¼šç›¸å…³æ€§æ‰“åˆ†<br>\n <code>id</code> ï¼šæ–‡æ¡£å”¯ä¸€ id</p>\n<h1 id=\"ç´¢å¼•\"><a class=\"markdownIt-Anchor\" href=\"#ç´¢å¼•\">#</a> ç´¢å¼•</h1>\n<p><code>es</code>  ç´¢å¼•ï¼Œæ˜¯ <code>es</code>  ç»„ç»‡æ–‡æ¡£çš„æ–¹å¼ï¼Œæ˜¯æ‹¥æœ‰ç›¸ç»“æ„æ–‡æ¡£çš„é›†åˆï¼Œå¯ä»¥æŠŠ <code>es</code>  çš„ç´¢å¼•ç±»æ¯”ä¸ºå…³ç³»å‹æ•°æ®åº“çš„ä¸€å¼ æ•°æ®è¡¨ã€‚<br>\nç´¢å¼•æ˜¯ <code>ES</code>  ä¸­éå¸¸é‡è¦çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚åé¢æˆ‘ä»¬ä¼šç€é‡çš„å­¦ä¹ å…¶åŸç†ã€‚</p>\n<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¯ä»¥åœ¨ kibana ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºç´¢å¼•</span></span><br><span class=\"line\">PUT /fxb_test</span><br></pre></td></tr></table></figure>\n<p>å³ä¾§å°±ä¼šè¾“å‡ºï¼š</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">&quot;acknowledged&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;shards_acknowledged&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;index&quot;</span> : <span class=\"string\">&quot;fxb_test&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚å›¾:</p>\n<p><img data-src=\"/images/es-series/create-index.png\" alt=\"\"></p>\n<h2 id=\"mapping\"><a class=\"markdownIt-Anchor\" href=\"#mapping\">#</a> Mapping</h2>\n<p><code>Mapping</code>  æ˜¯å¯¹ ç´¢å¼•çš„å®šä¹‰ã€‚ ç±»ä¼¼çš„ <code>MySQL</code>  ä¸­è¡¨ç»“æ„å®šä¹‰ï¼Œ ES ä¸­æ”¯æŒæ‰‹åŠ¨å®šä¹‰ <code>Mapping</code>  ï¼Œ åŠ¨æ€æ˜ å°„è¿™ä¸¤ç§æ–¹å¼ã€‚</p>\n<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¸Šé¢åˆ›å»ºçš„  <code>fxb_test</code>  ç´¢å¼•ï¼Œå°±å¯ä»¥ä½¿ç”¨åŠ¨æ€æ˜ å°„æ–¹å¼ç”Ÿæˆçš„ Mappingã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ·»åŠ ä¸€ä¸ªæ–‡æ¡£åˆ° fxb_test ç´¢å¼•ä¸­</span></span><br><span class=\"line\">POST /fxb_test/_create/1</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;username&quot;</span>:<span class=\"string\">&quot;é»„å²›ä¸»&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;age&quot;</span>:57,</span><br><span class=\"line\">  <span class=\"string\">&quot;sex&quot;</span>: <span class=\"string\">&quot;ç”·&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¾“å‡ºç»“æœï¼š</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">&quot;_index&quot;</span> : <span class=\"string\">&quot;fxb_test&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_type&quot;</span> : <span class=\"string\">&quot;_doc&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_id&quot;</span> : <span class=\"string\">&quot;1&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_version&quot;</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;result&quot;</span> : <span class=\"string\">&quot;created&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_shards&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;total&quot;</span> : <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;successful&quot;</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;failed&quot;</span> : <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_seq_no&quot;</span> : <span class=\"number\">0</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;_primary_term&quot;</span> : <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>ç„¶åï¼Œæˆ‘ä»¬çœ‹ä¸‹è‡ªåŠ¨æ˜ å°„å‡ºæ¥çš„ Mapping</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç´¢å¼•çš„Mapping</span></span><br><span class=\"line\">GET /fxb_test</span><br></pre></td></tr></table></figure>\n<p>è¾“å‡ºç»“æœ:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">&quot;fxb_test&quot;</span> : &#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;mappings&quot;</span> : &#123;</span><br><span class=\"line\">      <span class=\"attr\">&quot;properties&quot;</span> : &#123;</span><br><span class=\"line\">        <span class=\"attr\">&quot;age&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"attr\">&quot;type&quot;</span> : <span class=\"string\">&quot;long&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">&quot;sex&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"attr\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">&quot;fields&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"attr\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span>,</span><br><span class=\"line\">              <span class=\"attr\">&quot;ignore_above&quot;</span> : <span class=\"number\">256</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">&quot;username&quot;</span> : &#123;</span><br><span class=\"line\">          <span class=\"attr\">&quot;type&quot;</span> : <span class=\"string\">&quot;text&quot;</span>,</span><br><span class=\"line\">          <span class=\"attr\">&quot;fields&quot;</span> : &#123;</span><br><span class=\"line\">            <span class=\"attr\">&quot;keyword&quot;</span> : &#123;</span><br><span class=\"line\">              <span class=\"attr\">&quot;type&quot;</span> : <span class=\"string\">&quot;keyword&quot;</span>,</span><br><span class=\"line\">              <span class=\"attr\">&quot;ignore_above&quot;</span> : <span class=\"number\">256</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œå°±å…ˆç®€å•äº†è§£ä¸€ä¸‹ï¼Œç›¸å…³çš„å‘½ä»¤ã€‚ è‡³äºä¸Šé¢æ¯ä¸ªå­—æ®µçš„å«ä¹‰ä»¥åŠä½œç”¨ï¼Œæˆ‘ä»¬åé¢è¯¦ç»†ä»‹ç»ã€‚</p>\n<h1 id=\"é›†ç¾¤\"><a class=\"markdownIt-Anchor\" href=\"#é›†ç¾¤\">#</a> é›†ç¾¤</h1>\n<p>ES çš„é›†ç¾¤æ­å»ºå¾ˆç®€å•ï¼Œä¸éœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹åè°ƒç®¡ç†ç»„ä»¶ï¼Œè‡ªèº«å†…éƒ¨å°±å®ç°äº†é›†ç¾¤çš„ç®¡ç†åŠŸèƒ½ã€‚ <code>ES</code>  é›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ª <code>Elasticsearch</code>  èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹é…ç½®ç›¸åŒçš„  <code>cluster.name</code>  å³å¯åŠ å…¥é›†ç¾¤ï¼Œé»˜è®¤å€¼ä¸º â€œ <code>elasticsearch</code> â€ã€‚ç¡®ä¿ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨ä¸åŒçš„é›†ç¾¤åç§°ï¼Œå¦åˆ™æœ€ç»ˆä¼šå¯¼è‡´èŠ‚ç‚¹åŠ å…¥é”™è¯¯çš„é›†ç¾¤ã€‚</p>\n<p>ä¸€ä¸ª <code>Elasticsearch</code>  æœåŠ¡å¯åŠ¨å®ä¾‹å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆ <code>Node</code> ï¼‰ã€‚èŠ‚ç‚¹é€šè¿‡  <code>node.name</code>  æ¥è®¾ç½®èŠ‚ç‚¹åç§°ï¼Œå¦‚æœä¸è®¾ç½®åˆ™åœ¨å¯åŠ¨æ—¶ç»™èŠ‚ç‚¹åˆ†é…ä¸€ä¸ªéšæœºé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ä½œä¸ºåç§°ã€‚</p>\n<h1 id=\"åˆ†ç‰‡\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†ç‰‡\">#</a> åˆ†ç‰‡</h1>\n<p><code>ES</code>  æ”¯æŒ <code>PB</code>  çº§å…¨æ–‡æœç´¢ï¼Œå½“ç´¢å¼•ä¸Šçš„æ•°æ®é‡å¤ªå¤§çš„æ—¶å€™ï¼Œ <code>ES</code>  é€šè¿‡æ°´å¹³æ‹†åˆ†çš„æ–¹å¼å°†ä¸€ä¸ªç´¢å¼•ä¸Šçš„æ•°æ®æ‹†åˆ†å‡ºæ¥åˆ†é…åˆ°ä¸åŒçš„æ•°æ®å—ä¸Šï¼Œæ‹†åˆ†å‡ºæ¥çš„æ•°æ®åº“å—ç§°ä¹‹ä¸ºä¸€ä¸ªåˆ†ç‰‡ã€‚</p>\n<p>è¿™ç±»ä¼¼äº <code>MySQL</code>  çš„åˆ†åº“åˆ†è¡¨ï¼Œåªä¸è¿‡ <code>MySQL</code>  åˆ†åº“åˆ†è¡¨éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹ç»„ä»¶è€Œ ES å†…éƒ¨è‡ªèº«å®ç°äº†æ­¤åŠŸèƒ½ã€‚</p>\n<p>åœ¨ä¸€ä¸ªå¤šåˆ†ç‰‡çš„ç´¢å¼•ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œé€šè¿‡è·¯ç”±æ¥ç¡®å®šå…·ä½“å†™å…¥å“ªä¸€ä¸ªåˆ†ç‰‡ä¸­ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™éœ€è¦æŒ‡å®šåˆ†ç‰‡çš„æ•°é‡ï¼Œå¹¶ä¸”åˆ†ç‰‡çš„æ•°é‡ä¸€æ—¦ç¡®å®šå°±ä¸èƒ½ä¿®æ”¹ã€‚</p>\n<p>åˆ†ç‰‡çš„æ•°é‡å’Œä¸‹é¢ä»‹ç»çš„å‰¯æœ¬æ•°é‡éƒ½æ˜¯å¯ä»¥é€šè¿‡åˆ›å»ºç´¢å¼•æ—¶çš„ <code>settings</code>  æ¥é…ç½®ï¼Œ <code>ES</code>  é»˜è®¤ä¸ºä¸€ä¸ªç´¢å¼•åˆ›å»º <code>1</code>  ä¸ªä¸»åˆ†ç‰‡ ( <code>ES 7.x</code> ), å¹¶åˆ†åˆ«ä¸ºæ¯ä¸ªåˆ†ç‰‡åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ã€‚</p>\n<p><code>ES</code>  é€šè¿‡åˆ†ç‰‡çš„åŠŸèƒ½ä½¿å¾—ç´¢å¼•åœ¨è§„æ¨¡ä¸Šå’Œæ€§èƒ½ä¸Šéƒ½å¾—åˆ°æå‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½æ˜¯ <code>Lucene</code>  ä¸­çš„ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œæ¯ä¸ªåˆ†ç‰‡å¿…é¡»æœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡å’Œé›¶åˆ°å¤šä¸ªå‰¯æœ¬ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»º2ä¸ªå‰¯æœ¬ï¼Œ5ä¸ªåˆ†ç‰‡çš„ç´¢å¼•</span></span><br><span class=\"line\">PUT /fxb_test2</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;settings&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;number_of_replicas&quot;</span>: 2,</span><br><span class=\"line\">    <span class=\"string\">&quot;number_of_shards&quot;</span>: 5</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿”å›ç»“æœ:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">&quot;acknowledged&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;shards_acknowledged&quot;</span> : <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">&quot;index&quot;</span> : <span class=\"string\">&quot;fxb_test2&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"å‰¯æœ¬\"><a class=\"markdownIt-Anchor\" href=\"#å‰¯æœ¬\">#</a> å‰¯æœ¬</h1>\n<p>å‰¯æœ¬å°±æ˜¯å¯¹åˆ†ç‰‡çš„ <code>Copy</code> ï¼Œæ¯ä¸ªä¸»åˆ†ç‰‡éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œå½“ä¸»åˆ†ç‰‡å¼‚å¸¸æ—¶ï¼Œå‰¯æœ¬å¯ä»¥æä¾›æ•°æ®çš„æŸ¥è¯¢ç­‰æ“ä½œã€‚ä¸»åˆ†ç‰‡å’Œå¯¹åº”çš„å‰¯æœ¬åˆ†ç‰‡æ˜¯ä¸ä¼šåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ï¼Œæ‰€ä»¥å‰¯æœ¬åˆ†ç‰‡æ•°çš„æœ€å¤§å€¼æ˜¯  <code>n-1</code> ï¼ˆå…¶ä¸­ n ä¸ºèŠ‚ç‚¹æ•°ï¼‰ã€‚</p>\n<p>å¯¹æ–‡æ¡£çš„æ–°å»ºã€ç´¢å¼•å’Œåˆ é™¤è¯·æ±‚éƒ½æ˜¯å†™æ“ä½œï¼Œå¿…é¡»åœ¨ä¸»åˆ†ç‰‡ä¸Šé¢å®Œæˆä¹‹åæ‰èƒ½è¢«å¤åˆ¶åˆ°ç›¸å…³çš„å‰¯æœ¬åˆ†ç‰‡ï¼Œ <code>ES</code>  ä¸ºäº†æé«˜å†™å…¥çš„èƒ½åŠ›è¿™ä¸ªè¿‡ç¨‹æ˜¯å¹¶å‘å†™çš„ï¼ŒåŒæ—¶ä¸ºäº†è§£å†³å¹¶å‘å†™çš„è¿‡ç¨‹ä¸­æ•°æ®å†²çªçš„é—®é¢˜ï¼Œ <code>ES</code>  é€šè¿‡ä¹è§‚é”çš„æ–¹å¼æ§åˆ¶ï¼Œæ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ª  <code>_version</code>  ï¼ˆç‰ˆæœ¬ï¼‰å·ï¼Œå½“æ–‡æ¡£è¢«ä¿®æ”¹æ—¶ç‰ˆæœ¬å·é€’å¢ã€‚ä¸€æ—¦æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æŠ¥å‘Šå†™æˆåŠŸæ‰ä¼šå‘åè°ƒèŠ‚ç‚¹æŠ¥å‘ŠæˆåŠŸï¼Œåè°ƒèŠ‚ç‚¹å‘å®¢æˆ·ç«¯æŠ¥å‘ŠæˆåŠŸã€‚</p>\n<p>å…³äºï¼Œ <code>ES</code>  çš„åŸºæœ¬æ¦‚å¿µï¼Œå°±ä»‹ç»åˆ°è¿™é‡Œã€‚<br>\nä¸‹ä¸€ç¯‡: ã€Š <code>ES</code>  ç´¢å¼•ç®¡ç†ã€‹</p>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Elastic Search",
                "æœç´¢"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/03.ES%E9%85%8D%E7%BD%AE/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/03.ES%E9%85%8D%E7%BD%AE/",
            "title": "Elastic Searché…ç½®",
            "date_published": "2021-08-31T07:28:55.000Z",
            "content_html": "<h1 id=\"elastic-searché…ç½®\"><a class=\"markdownIt-Anchor\" href=\"#elastic-searché…ç½®\">#</a> Elastic Search é…ç½®</h1>\n<p><code>ES</code>  æä¾›äº†å¾ˆå¤šé»˜è®¤çš„å‚æ•°è®¾ç½®ï¼Œä½¿æˆ‘ä»¬ä¸ç”¨æ·»åŠ ä»»ä½•å‚æ•°å°±å¯ä»¥æˆåŠŸçš„å¯åŠ¨ <code>ES</code> ã€‚ ä½œä¸ºä¸€ä¸ªè®¤çœŸçš„å­¦ä¹ è€…ã€‚æˆ‘ä»¬è¿˜æ˜¯æ¥ä¸€èµ·çœ‹çœ‹ å¦‚ä½•æ›´å¥½çš„è‡ªå®šä¹‰  <code>ES</code>  é…ç½®ã€‚ è¯¦ç»†çš„é…ç½®å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS9jdXJyZW50L3NldHRpbmdzLmh0bWw=\">https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html</span>.</p>\n<p><code>ES</code>  çš„å±æ€§ï¼Œåˆ†ä¸º é™æ€å±æ€§ å’Œ åŠ¨æ€å±æ€§ã€‚<br>\næ‰€æœ‰çš„é™æ€å±æ€§ï¼Œéƒ½å¿…é¡»é‡å¯åæ‰èƒ½ç”Ÿæ•ˆã€‚<br>\nå¯¹äºåŠ¨æ€å±æ€§å¯ä»¥é€šè¿‡è°ƒç”¨</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST _nodes/reload_secure_settings</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;secure_settings_password&quot;</span>: <span class=\"string\">&quot;s3cr3t&quot;</span> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>â€s3cr3tâ€œ</code> , æ˜¯ <code>ES-keystore</code>  ç”Ÿæˆçš„ç§˜é’¥ã€‚è°ƒç”¨æ—¶éœ€è¦æ›¿æ¢ä¸ºè‡ªå·±è®¾ç½®çš„ç§˜é’¥.</p>\n<p>æ”¯æŒçƒ­åŠ è½½çš„å±æ€§æœ‰:  <code> Azure repository plugin</code> , <code> EC2 discovery plugin</code> , <code>GCS repository plugin</code> , <code>S3 repository plugin</code> ,  <code>Monitoring settings</code> , <code>Watcher settings</code> ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥åœ¨  <code>https://www.elastic.co/guide/en/elasticsearch/reference/current/secure-settings.html</code>  æŸ¥è¯¢ã€‚</p>\n<p>åœ¨ ES çš„å®‰è£…ç›®å½•ï¼Œå¾ˆæ˜æ˜¾çš„æœ‰ä¸€ä¸ª  <code>config</code>  ç›®å½•ã€‚è¿›å…¥ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°</p>\n<p><img data-src=\"./images/es-series/ES-config%E7%9B%AE%E5%BD%95.png\" alt=\"\"></p>\n<ul>\n<li><code>elasticsearch.keystore</code> :  <code>Elasticsearch</code>  æä¾›äº†å¯†é’¥åº“å’Œ <code>elasticsearch-keystore</code>  ç”¨äºç®¡ç†å¯†é’¥åº“è®¾ç½®çš„å·¥å…·ã€‚</li>\n</ul>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸‹å’Œé…ç½®ç›¸å…³çš„ä¸‰ä¸ªæ–‡ä»¶</p>\n<ul>\n<li><code>elasticsearch.yml</code> :</li>\n<li><code>jvm.options</code> :</li>\n<li><code>log4j2.properties</code> :</li>\n</ul>\n<p>å’Œæƒé™ç›¸å…³çš„ã€‚</p>\n<ul>\n<li><code>role_mapping.yml</code></li>\n<li><code>roles.yml</code></li>\n<li><code>users</code></li>\n<li><code>users_roles</code></li>\n</ul>\n<p>è¿™é‡Œæˆ‘ä»¬å…ˆä¸æ·±å…¥äº†è§£ã€‚</p>\n<h1 id=\"elasticsearch-è®¾ç½®ä»‹ç»\"><a class=\"markdownIt-Anchor\" href=\"#elasticsearch-è®¾ç½®ä»‹ç»\">#</a> elasticsearch è®¾ç½®ä»‹ç»</h1>\n<p>æœ‰äº›è®¾ç½®æ˜¯éå¸¸æ•æ„Ÿçš„ï¼Œä»…ä¾é æ–‡ä»¶ç³»ç»Ÿæƒé™æ¥ä¿æŠ¤å®ƒä»¬çš„å€¼æ˜¯ä¸å¤Ÿçš„ã€‚å¯¹äºè¿™ä¸ªç”¨ä¾‹ï¼Œ <code>Elasticsearch</code>  æä¾›äº†ä¸€ä¸ªå¯†é’¥å­˜å‚¨åº“å’Œ <code>Elasticsearch-keystore</code>  å·¥å…·æ¥ç®¡ç†å¯†é’¥å­˜å‚¨åº“ä¸­çš„è®¾ç½®ã€‚è®¾è®¡ä»…ä»å¯†é’¥åº“ä¸­è¯»å–æŸäº›è®¾ç½®ã€‚ ä½†æ˜¯ï¼Œå¯†é’¥åº“æ²¡æœ‰éªŒè¯æ¥é˜»æ­¢ä¸æ”¯æŒçš„è®¾ç½®ã€‚ å°†ä¸æ”¯æŒçš„è®¾ç½®æ·»åŠ åˆ°å¯†é’¥åº“ä¸­ä¼šå¯¼è‡´ <code>Elasticsearch</code>  æ— æ³•å¯åŠ¨ã€‚</p>\n<p><b>å¯¹å¯†é’¥åº“çš„æ‰€æœ‰ä¿®æ”¹ä»…åœ¨é‡æ–°å¯åŠ¨ <code>Elasticsearch</code>  ä¹‹åç”Ÿæ•ˆã€‚</b><br>\nè¿™äº›è®¾ç½®ä¸  <code>elasticsearch.yml</code>  é…ç½®æ–‡ä»¶ä¸­çš„å¸¸è§„è®¾ç½®ä¸€æ ·ï¼Œéœ€è¦åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸ŠæŒ‡å®šã€‚ å½“å‰ï¼Œæ‰€æœ‰å®‰å…¨è®¾ç½®éƒ½æ˜¯ç‰¹å®šäºèŠ‚ç‚¹çš„è®¾ç½®ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¿…é¡»å…·æœ‰ç›¸åŒçš„å€¼ã€‚</p>\n<h2 id=\"elasticserche-keystore-ä½¿ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#elasticserche-keystore-ä½¿ç”¨\">#</a> elasticserche-keystore ä½¿ç”¨</h2>\n<p>æ¥çœ‹ä¸€ä¸‹  <code>elasticsearch-keystore</code>  å‘½ä»¤</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bin/elasticsearch-keystore</span><br><span class=\"line\">* [add &lt;settings&gt;] [-f] [--stdin] :æ·»åŠ ä¸€ä¸ªStringçš„é…ç½®åˆ°keystoreä¸­</span><br><span class=\"line\">* [add-file (&lt;setting&gt; &lt;path&gt;)+] : æ·»åŠ ä¸€ä¸ªæ–‡ä»¶é…ç½®åˆ°keystoreä¸­</span><br><span class=\"line\">* [create] [-p]: åˆ›å»ºä¸€ä¸ªæ–°çš„Es keyStore</span><br><span class=\"line\">* [list] : å±•ç¤ºkeystoreçš„é¡¹</span><br><span class=\"line\">* [passwd] : ä¿®æ”¹ keystoreçš„å¯†ç </span><br><span class=\"line\">* [remove &lt;setting&gt;] : ç§»é™¤æŸäº›é…ç½®</span><br><span class=\"line\">* [upgrade] : å‡çº§å¯†é’¥åº“çš„å†…éƒ¨æ ¼å¼ã€‚</span><br><span class=\"line\">* [has-passwd] - éªŒè¯æ˜¯å¦æœ‰keystoreå¹¶ä¸”æœ‰å¯†ç ä¿æŠ¤</span><br></pre></td></tr></table></figure>\n<p>ç®€å•ä½¿ç”¨:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºä¸€ä¸ªkeystore</span></span><br><span class=\"line\">&gt; ./elasticsearch-keystore create -p</span><br><span class=\"line\"><span class=\"comment\">## //è¾“å…¥å¯†ç </span></span><br><span class=\"line\">Enter new password <span class=\"keyword\">for</span> the elasticsearch keystore (empty <span class=\"keyword\">for</span> no password):</span><br><span class=\"line\"><span class=\"comment\">## // ç¡®è®¤å¯†ç </span></span><br><span class=\"line\">Enter same password again:</span><br><span class=\"line\"><span class=\"comment\">## // å·²ç»æœ‰keystoreæ–‡ä»¶äº†ï¼Œæ˜¯å¦è¦è¦†ç›–</span></span><br><span class=\"line\">An elasticsearch keystore already exists. Overwrite? [y/N]y</span><br><span class=\"line\">Created elasticsearch keystore <span class=\"keyword\">in</span> /Users/bjhl/fxb_applicaton/fxb_program/elasticsearch-7.10.1/config/elasticsearch.keystore</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ç§˜é’¥åº“</span></span><br><span class=\"line\">&gt; ./elasticsearch-keystore list</span><br><span class=\"line\"><span class=\"comment\">## // è¾“å…¥å¯†ç </span></span><br><span class=\"line\">Enter password <span class=\"keyword\">for</span> the elasticsearch keystore :</span><br><span class=\"line\">keystore.seed <span class=\"comment\"># ç§˜é’¥åº“</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ è®¾ç½®åˆ°ç§˜é’¥åº“ä¸­</span></span><br><span class=\"line\">&gt; ./elasticsearch-keystore add settings.name</span><br><span class=\"line\"><span class=\"comment\">## // è¾“å…¥å¯†ç </span></span><br><span class=\"line\">Enter password <span class=\"keyword\">for</span> the elasticsearch keystore :</span><br><span class=\"line\"><span class=\"comment\">## è¾“å…¥æ·»åŠ çš„è®¾ç½®çš„value</span></span><br><span class=\"line\">Enter value <span class=\"keyword\">for</span> settings.name:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ·»åŠ æ–‡ä»¶åˆ°ç§˜é’¥åº“</span></span><br><span class=\"line\">&gt; ./elasticsearch-keystore add-file file.name xxx.xx</span><br><span class=\"line\">Enter password <span class=\"keyword\">for</span> the elasticsearch keystore :</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤é…ç½®</span></span><br><span class=\"line\">&gt; ./elasticsearch-keystore remove settings.name</span><br><span class=\"line\">Enter password <span class=\"keyword\">for</span> the elasticsearch keystore :</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ›´æ–°keystore</span></span><br><span class=\"line\">&gt; ./elasticsearch-keystore upgrade</span><br><span class=\"line\">Enter password <span class=\"keyword\">for</span> the elasticsearch keystore :</span><br></pre></td></tr></table></figure>\n<h2 id=\"elasticsearchyml\"><a class=\"markdownIt-Anchor\" href=\"#elasticsearchyml\">#</a>  <code>elasticsearch.yml</code></h2>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - é›†ç¾¤ç›¸å…³é…ç½® -</span></span><br><span class=\"line\"><span class=\"comment\"># é›†ç¾¤çš„åç§°</span></span><br><span class=\"line\"><span class=\"attr\">cluster.name:</span> <span class=\"string\">my-application</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´å¤šå…³äºé›†ç¾¤çš„é…ç½®ï¼Œå‚è€ƒï¼šhttps://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cluster.html</span></span><br><span class=\"line\"><span class=\"comment\"># è·¨é›†ç¾¤é…ç½®:å‚è€ƒ:https://www.elastic.co/guide/en/elasticsearch/reference/current/ccr-settings.html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># èŠ‚ç‚¹çš„åç§°</span></span><br><span class=\"line\"><span class=\"attr\">node.name:</span> <span class=\"string\">fxb-cluster-node-1</span></span><br><span class=\"line\"><span class=\"comment\"># å¯ä»¥ä¸ºé›†ç¾¤æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„å±æ€§é…ç½®</span></span><br><span class=\"line\"><span class=\"attr\">node.attr.zhName:</span> <span class=\"string\">æ–¹å°ç™½</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´å¤šèŠ‚ç‚¹ç›¸å…³çš„é…ç½®,å‚è€ƒ</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - è·¯å¾„ç›¸å…³é…ç½® -</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šå­˜å‚¨æ•°æ®çš„ä½ç½®,å¤šä¸ªè·¯å¾„çš„è¯ï¼Œä½¿ç”¨`,`åˆ†å‰² (separate multiple locations by comma)</span></span><br><span class=\"line\"><span class=\"attr\">path.data:</span> <span class=\"string\">/path/to/data</span></span><br><span class=\"line\"><span class=\"comment\"># æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ°å€</span></span><br><span class=\"line\"><span class=\"attr\">path.logs:</span> <span class=\"string\">/path/to/logs</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - å†…å­˜ç›¸å…³ -</span></span><br><span class=\"line\"><span class=\"comment\"># Lock the memory on startup:</span></span><br><span class=\"line\"><span class=\"attr\">bootstrap.memory_lock:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># ç¡®ä¿å°†å †å¤§å°è®¾ç½®ä¸ºç³»ç»Ÿä¸Šå¯ç”¨å†…å­˜çš„ä¸€åŠå·¦å³ï¼Œå¹¶ç¡®ä¿è¿›ç¨‹çš„æ‰€æœ‰è€…å¯ä»¥ä½¿ç”¨æ­¤é™åˆ¶ã€‚ç³»ç»Ÿäº¤æ¢å†…å­˜æ—¶ï¼ŒElasticsearchçš„æ€§èƒ½è¾ƒå·®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># ---------------------------------- Network -----------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"># Set the bind address to a specific IP (IPv4 or IPv6):</span></span><br><span class=\"line\"><span class=\"attr\">network.host:</span> <span class=\"number\">192.168</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨ç«¯å£</span></span><br><span class=\"line\"><span class=\"attr\">http.port:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´å¤šå¯ä»¥å‚è€ƒ: https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --------------------------------- Discovery ----------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"># æä¾›ç¾¤é›†ä¸­ç¬¦åˆä¸»æœºèµ„æ ¼çš„èŠ‚ç‚¹çš„åœ°å€åˆ—è¡¨ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span></span><br><span class=\"line\"><span class=\"attr\">discovery.seed_hosts:</span> [<span class=\"string\">&quot;host1&quot;</span>, <span class=\"string\">&quot;host2&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®åˆå§‹çš„ç¬¦åˆä¸»æœºèµ„æ ¼çš„èŠ‚ç‚¹é›†,ã€é™æ€å±æ€§ã€‘</span></span><br><span class=\"line\"><span class=\"attr\">cluster.initial_master_nodes:</span> [<span class=\"string\">&quot;node-1&quot;</span>, <span class=\"string\">&quot;node-2&quot;</span>]</span><br><span class=\"line\"><span class=\"comment\"># æ›´å¤šå…³äºå‘ç°ç›¸å…³çš„é…ç½®,å‚è€ƒ:https://www.elastic.co/guide/en/elasticsearch/reference/current/ccr-settings.html</span></span><br><span class=\"line\"><span class=\"comment\"># ---------------------------------- Gateway -----------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"># Block initial recovery after a full cluster restart until N nodes are started:</span></span><br><span class=\"line\"><span class=\"attr\">gateway.recover_after_nodes:</span> <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># æ›´å¤šå†…å®¹ï¼Œå‚è€ƒhttps://www.elastic.co/guide/en/elasticsearch/reference/current/modules-gateway.html</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># ---------------------------------- Various -----------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"># Require explicit names when deleting indices:</span></span><br><span class=\"line\"><span class=\"attr\">action.destructive_requires_name:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"jvm-å‚æ•°-jvmoptions\"><a class=\"markdownIt-Anchor\" href=\"#jvm-å‚æ•°-jvmoptions\">#</a> JVM å‚æ•° =&gt; jvm.options</h2>\n<p><code>jvm.options</code>  åŒ…å«ä½¿ç”¨ç‰¹æ®Šè¯­æ³•çš„ä»¥è¡Œåˆ†éš”çš„ <code>JVM</code>  å‚æ•°åˆ—è¡¨ï¼š</p>\n<ul>\n<li><code>#</code>  è¡¨ç¤ºæ³¨é‡Š</li>\n<li>ä»¥ <code>-</code>  å¼€å¤´çš„è¡Œè¢«è§†ä¸ºç‹¬ç«‹äº <code>JVM</code>  ç‰ˆæœ¬è€Œåº”ç”¨çš„ JVM é€‰é¡¹</li>\n<li>ä»¥ <code>&lt;æ•°å­—&gt;:-</code>  å¼€å¤´çš„è¡Œè¢«è§†ä¸º <code>JVM</code>  é€‰é¡¹ï¼Œåªæœ‰å½“ <code>JVM</code>  çš„ç‰ˆæœ¬ä¸è¯¥æ•°å­—åŒ¹é…æ—¶æ‰é€‚ç”¨ï¼Œæ¯”å¦‚: <code>8:-Xmx2g</code></li>\n<li>ä»¥  <code>&lt;æ•°å­—&gt;-ï¼š</code> å¼€å¤´ çš„è¡Œè¢«è§†ä¸º <code>JVM</code>  é€‰é¡¹ï¼Œä»…åœ¨ <code>JVM</code>  ç‰ˆæœ¬å¤§äºæˆ–ç­‰äºè¯¥æ•°å­—æ—¶æ‰é€‚ç”¨ã€‚æ¯”å¦‚: <code>8-:-Xmx2g</code></li>\n<li>ä»¥ <code>&lt;æ•°å­—&gt;-&lt;æ•°å­—&gt;ï¼š</code> å¼€å¤´çš„è¡Œè¢«è§†ä¸ºä»…åœ¨ <code>JVM</code>  ç‰ˆæœ¬è½åœ¨ä¸¤ä¸ªæ•°å­—èŒƒå›´å†…æ—¶æ‰é€‚ç”¨çš„ <code>JVM</code>  é€‰é¡¹ã€‚æ¯”å¦‚ï¼š <code>8-9:-Xmx2g</code></li>\n</ul>\n<p>Elasticsearch é»˜è®¤é…ç½® JVM ä½¿ç”¨æœ€å°å’Œæœ€å¤§å¤§å°ä¸º 1 GB çš„å †ã€‚</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## JVM configuration</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################################################</span></span><br><span class=\"line\"><span class=\"comment\">## IMPORTANT: JVM heap size</span></span><br><span class=\"line\"><span class=\"comment\">################################################################</span></span><br><span class=\"line\"><span class=\"comment\">## å‚è€ƒ https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html#heap-size-settings</span></span><br><span class=\"line\"><span class=\"comment\"># Xms represents the initial size of total heap space</span></span><br><span class=\"line\"><span class=\"comment\"># Xmx represents the maximum size of total heap space</span></span><br><span class=\"line\"><span class=\"string\">-Xms1g</span></span><br><span class=\"line\"><span class=\"string\">-Xmx1g</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################################################</span></span><br><span class=\"line\"><span class=\"comment\">## Expert settings: é«˜çº§è®¾ç½®</span></span><br><span class=\"line\"><span class=\"comment\">################################################################</span></span><br><span class=\"line\"><span class=\"comment\">## ä¸ç†è§£ä¸‹é¢çš„å±æ€§ï¼Œä¸å»ºè®®ä¿®æ”¹</span></span><br><span class=\"line\"><span class=\"comment\">################################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## GC configuration</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"number\">-13</span><span class=\"string\">:-XX:+UseConcMarkSweepGC</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"number\">-13</span><span class=\"string\">:-XX:CMSInitiatingOccupancyFraction=75</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"number\">-13</span><span class=\"string\">:-XX:+UseCMSInitiatingOccupancyOnly</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## G1GC Configuration</span></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> G1 GC is only supported on JDK version 10 or later</span></span><br><span class=\"line\"><span class=\"comment\"># to use G1GC, uncomment the next two lines and update the version on the</span></span><br><span class=\"line\"><span class=\"comment\"># following three lines to your version of the JDK</span></span><br><span class=\"line\"><span class=\"comment\"># 10-13:-XX:-UseConcMarkSweepGC</span></span><br><span class=\"line\"><span class=\"comment\"># 10-13:-XX:-UseCMSInitiatingOccupancyOnly</span></span><br><span class=\"line\"><span class=\"number\">14</span><span class=\"string\">-:-XX:+UseG1GC</span></span><br><span class=\"line\"><span class=\"number\">14</span><span class=\"string\">-:-XX:G1ReservePercent=25</span></span><br><span class=\"line\"><span class=\"number\">14</span><span class=\"string\">-:-XX:InitiatingHeapOccupancyPercent=30</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## JVM temporary directory</span></span><br><span class=\"line\"><span class=\"string\">-Djava.io.tmpdir=$&#123;ES_TMPDIR&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## heap dumps</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># generate a heap dump when an allocation from the Java heap fails</span></span><br><span class=\"line\"><span class=\"comment\"># heap dumps are created in the working directory of the JVM</span></span><br><span class=\"line\"><span class=\"string\">-XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># specify an alternative path for heap dumps; ensure the directory exists and</span></span><br><span class=\"line\"><span class=\"comment\"># has sufficient space</span></span><br><span class=\"line\"><span class=\"string\">-XX:HeapDumpPath=data</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># specify an alternative path for JVM fatal error logs</span></span><br><span class=\"line\"><span class=\"string\">-XX:ErrorFile=logs/hs_err_pid%p.log</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## JDK 8 GC logging</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-XX:+PrintGCDetails</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-XX:+PrintGCDateStamps</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-XX:+PrintTenuringDistribution</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-XX:+PrintGCApplicationStoppedTime</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-Xloggc:logs/gc.log</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-XX:+UseGCLogFileRotation</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-XX:NumberOfGCLogFiles=32</span></span><br><span class=\"line\"><span class=\"number\">8</span><span class=\"string\">:-XX:GCLogFileSize=64m</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># JDK 9+ GC logging</span></span><br><span class=\"line\"><span class=\"number\">9</span><span class=\"string\">-:-Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"æ—¥å¿—å‚æ•°\"><a class=\"markdownIt-Anchor\" href=\"#æ—¥å¿—å‚æ•°\">#</a> æ—¥å¿—å‚æ•°</h1>\n<p>å¯ä»¥çœ‹åˆ°  <code>ElasticSearch</code>  ä½¿ç”¨ <code>log4j2</code>  æ—¥å¿—ï¼Œå…³äºæ­¤æ—¥å¿—çš„é…ç½®ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>\n<h1 id=\"ç³»ç»Ÿé…ç½®\"><a class=\"markdownIt-Anchor\" href=\"#ç³»ç»Ÿé…ç½®\">#</a> ç³»ç»Ÿé…ç½®</h1>\n<p>é™¤äº†å¯¹  <code>ES</code>  çš„é…ç½®ä¹‹å¤–ï¼Œå¦‚æœæƒ³è¦æ›´å¥½çš„æå‡ ES æ€§èƒ½ï¼Œè¿˜éœ€å¯¹  <code>ES</code>  æ‰€ä¾èµ–çš„å®¿ä¸»æœºè¿›è¡Œä¸€äº›å±æ€§é…ç½®ã€‚<br>\næ¯”å¦‚ï¼šæ¯”å¦‚ç¦æ­¢ <code>swap</code>  ç­‰ã€‚æ›´å¤šå†…å®¹ï¼Œå‚è€ƒ:<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS9jdXJyZW50L3N5c3RlbS1jb25maWcuaHRtbA==\">https://www.elastic.co/guide/en/elasticsearch/reference/current/system-config.html</span>.</p>\n<h1 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h1>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Elastic Search",
                "æœç´¢"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/02.ES%E5%AE%89%E8%A3%85/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/02.ES%E5%AE%89%E8%A3%85/",
            "title": "ESæ ˆå®‰è£…",
            "date_published": "2021-08-31T07:20:55.000Z",
            "content_html": "<h2 id=\"å®‰è£…-elasticsearch-7101\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…-elasticsearch-7101\">#</a> å®‰è£… ElasticSearch 7.10.1</h2>\n<h3 id=\"ä¸‹è½½å®‰è£…åŒ…\"><a class=\"markdownIt-Anchor\" href=\"#ä¸‹è½½å®‰è£…åŒ…\">#</a> ä¸‹è½½å®‰è£…åŒ…</h3>\n<p>æˆ‘ä»¬åœ¨ <code>es</code>  çš„<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS83LjEwL2dldHRpbmctc3RhcnRlZC1pbnN0YWxsLmh0bWw=\">å®˜ç½‘</span>ä¸Šå¯ä»¥æ‰¾åˆ° ES è½¯ä»¶çš„ä¸‹è½½åœ°å€ï¼Œæˆ‘æ”¾åˆ°ä¸‹é¢:</p>\n<p><code>LINUX</code> : <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcnRpZmFjdHMuZWxhc3RpYy5jby9kb3dubG9hZHMvZWxhc3RpY3NlYXJjaC9lbGFzdGljc2VhcmNoLTcuMTAuMS1saW51eC14ODZfNjQudGFyLmd6\">elasticsearch-7.10.1-linux-x86_64.tar.gz</span><br>\n <code>MACOS</code> : <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcnRpZmFjdHMuZWxhc3RpYy5jby9kb3dubG9hZHMvZWxhc3RpY3NlYXJjaC9lbGFzdGljc2VhcmNoLTcuMTAuMS1kYXJ3aW4teDg2XzY0LnRhci5neg==\">elasticsearch-7.10.1-darwin-x86_64.tar.gz</span><br>\n <code>Windows</code> : <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcnRpZmFjdHMuZWxhc3RpYy5jby9kb3dubG9hZHMvZWxhc3RpY3NlYXJjaC9lbGFzdGljc2VhcmNoLTcuMTAuMS13aW5kb3dzLXg4Nl82NC56aXA=\">elasticsearch-7.10.1-windows-x86_64.zip</span></p>\n<p><code>ps</code> : æˆ‘è¯•äº†ä¸‹å¥½åƒéœ€è¦ ç§‘å­¦ä¸Šç½‘ ã€‚ ä½ å¯ä»¥å¯ä»¥é€šè¿‡å…¬ä¼—å·ä¸­ å›å¤  <code>es-ç³»ç»Ÿåç§°</code>  å°±å¯ä»¥è·å–åˆ°å¯¹åº”çš„ä¸‹è½½è¿æ¥äº†ã€‚ä¸‹æ‹‰åˆ°åº•å“¦ï½</p>\n<h3 id=\"è§£å‹å®‰è£…åŒ…\"><a class=\"markdownIt-Anchor\" href=\"#è§£å‹å®‰è£…åŒ…\">#</a> è§£å‹å®‰è£…åŒ…</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># Linux:</span></span></span><br><span class=\"line\">tar -xvf elasticsearch-7.10.1-linux-x86_64.tar.gz</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># macOS:</span></span></span><br><span class=\"line\">tar -xvf elasticsearch-7.10.1-darwin-x86_64.tar.gz</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># Windows PowerShell:</span></span></span><br><span class=\"line\">Expand-Archive elasticsearch-7.10.1-windows-x86_64.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯åŠ¨-elasticsearch\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨-elasticsearch\">#</a> å¯åŠ¨  <code>ElasticSearch</code></h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Linux and macOS:</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> elasticsearch-7.10.1/bin</span><br><span class=\"line\">./elasticsearch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## Windows:</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> elasticsearch-7.10.1\\bin</span><br><span class=\"line\">.\\elasticsearch.bat</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·å°±å¯åŠ¨äº†å•å®ä¾‹çš„ <code>ElasticSearch</code>  äº†ã€‚é»˜è®¤ç«¯å£æ˜¯ 9200ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè®¿é—® :  <code>http://localhost:9200</code>  æŸ¥çœ‹  <code>ES</code>  æƒ…å†µã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">name: <span class=\"string\">&quot;bjhldeMacBook-Pro.local&quot;</span>,</span><br><span class=\"line\">cluster_name: <span class=\"string\">&quot;elasticsearch&quot;</span>,</span><br><span class=\"line\">cluster_uuid: <span class=\"string\">&quot;nAay2-T3STS8BVc3-OkOaw&quot;</span>,</span><br><span class=\"line\">version: &#123;</span><br><span class=\"line\">number: <span class=\"string\">&quot;7.10.1&quot;</span>,</span><br><span class=\"line\">build_flavor: <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">build_type: <span class=\"string\">&quot;tar&quot;</span>,</span><br><span class=\"line\">build_hash: <span class=\"string\">&quot;1c34507e66d7db1211f66f3513706fdf548736aa&quot;</span>,</span><br><span class=\"line\">build_date: <span class=\"string\">&quot;2020-12-05T01:00:33.671820Z&quot;</span>,</span><br><span class=\"line\">build_snapshot: <span class=\"literal\">false</span>,</span><br><span class=\"line\">lucene_version: <span class=\"string\">&quot;8.7.0&quot;</span>,</span><br><span class=\"line\">minimum_wire_compatibility_version: <span class=\"string\">&quot;6.8.0&quot;</span>,</span><br><span class=\"line\">minimum_index_compatibility_version: <span class=\"string\">&quot;6.0.0-beta1&quot;</span></span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">tagline: <span class=\"string\">&quot;You Know, for Search&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¹Ÿå¯ä»¥é€šè¿‡  <code>http://localhost:9200/_cat/health?v</code>  æŸ¥çœ‹é›†ç¾¤è¿è¡Œæƒ…å†µã€‚</p>\n<p>å¦‚æœæƒ³å¯åŠ¨å¤šä¸ª <code>ElasticSearch</code>  å®ä¾‹ï¼Œæ­å»ºèµ· ES é›†ç¾¤ï¼Œå°±éœ€è¦æ¯ä¸ªå®ä¾‹æŒ‡å®šå•ç‹¬çš„æ•°æ®æ–‡ä»¶åœ°å€å’Œæ—¥å¿—æ–‡ä»¶åœ°å€ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Linux and macOS:</span></span><br><span class=\"line\">./elasticsearch -Epath.data=data2 -Epath.logs=log2</span><br><span class=\"line\">./elasticsearch -Epath.data=data3 -Epath.logs=log3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## Windows:</span></span><br><span class=\"line\">.\\elasticsearch.bat -E path.data=data2 -E path.logs=log2</span><br><span class=\"line\">.\\elasticsearch.bat -E path.data=data3 -E path.logs=log3</span><br></pre></td></tr></table></figure>\n<h2 id=\"å®‰è£…-kibana\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…-kibana\">#</a> å®‰è£…  <code>Kibana</code></h2>\n<p><code>Kibana</code>  æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æå’Œå¯è§†åŒ–å¹³å°ã€‚ä½¿ç”¨ <code>Kibana</code>  æ¥æ¢ç´¢ä½ çš„ <code>Elasticsearch</code>  æ•°æ®ï¼Œç„¶åå»ºç«‹æ¼‚äº®çš„å¯è§†åŒ–å’Œä»ªè¡¨æ¿ã€‚<br>\n <code>Kibana</code>  å…·æœ‰ç®¡ç†å¼¹æ€§æ ˆçš„ UIã€‚ç®¡ç†æ‚¨çš„å®‰å…¨è®¾ç½®ï¼Œåˆ†é…ç”¨æˆ·è§’è‰²ï¼Œæ‹æ‘„å¿«ç…§ï¼Œå·èµ·æ‚¨çš„æ•°æ®ï¼Œä»¥åŠæ›´å¤šï¼Œéƒ½ä»ä¸€ä¸ª <code>Kibana UI</code>  çš„ä¾¿åˆ©ã€‚<br>\n <code>Elastic</code>  æ ˆè§£å†³æ–¹æ¡ˆçš„é›†ä¸­å¼ä¸­å¿ƒã€‚ä»æ—¥å¿—åˆ†æåˆ°æ–‡æ¡£å‘ç°.</p>\n<h3 id=\"mac-or-linux\"><a class=\"markdownIt-Anchor\" href=\"#mac-or-linux\">#</a>  <code>Mac or linux</code></h3>\n<h4 id=\"ä¸‹è½½-kibana-å®‰è£…åŒ…\"><a class=\"markdownIt-Anchor\" href=\"#ä¸‹è½½-kibana-å®‰è£…åŒ…\">#</a> ä¸‹è½½  <code>kibana</code>  å®‰è£…åŒ…</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https://artifacts.elastic.co/downloads/kibana/kibana-7.10.1-darwin-x86_64.tar.gz</span><br><span class=\"line\">curl https://artifacts.elastic.co/downloads/kibana/kibana-7.10.1-darwin-x86_64.tar.gz.sha512 | shasum -a 512 -c - </span><br><span class=\"line\">tar -xzf kibana-7.10.1-darwin-x86_64.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> kibana-7.10.1-darwin-x86_64/ </span><br></pre></td></tr></table></figure>\n<h4 id=\"å¯åŠ¨-kibana\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨-kibana\">#</a> å¯åŠ¨  <code>kibana</code></h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/kibana</span><br></pre></td></tr></table></figure>\n<h3 id=\"windows\"><a class=\"markdownIt-Anchor\" href=\"#windows\">#</a>  <code>Windows</code></h3>\n<h4 id=\"ä¸‹è½½\"><a class=\"markdownIt-Anchor\" href=\"#ä¸‹è½½\">#</a> ä¸‹è½½</h4>\n<p>ç‚¹å‡»é“¾æ¥ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcnRpZmFjdHMuZWxhc3RpYy5jby9kb3dubG9hZHMva2liYW5hL2tpYmFuYS03LjEwLjEtd2luZG93cy14ODZfNjQuemlw\">https://artifacts.elastic.co/downloads/kibana/kibana-7.10.1-windows-x86_64.zip</span>  ä¸‹è½½ kibana åï¼Œè§£å‹æ–‡ä»¶ã€‚</p>\n<h4 id=\"å¯åŠ¨\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨\">#</a> å¯åŠ¨</h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.\\bin\\kibana.bat</span><br></pre></td></tr></table></figure>\n<h3 id=\"éªŒè¯\"><a class=\"markdownIt-Anchor\" href=\"#éªŒè¯\">#</a> éªŒè¯</h3>\n<p>è®¿é—®  <code>localhost:5601</code>  é¡µé¢ï¼Œå°±å¯ä»¥è®¿é—® kibana çš„é¡µé¢äº†.</p>\n<p><img data-src=\"/images/es-series/WX20210108-190528.png\" alt=\"WX20210108-190528.png\"></p>\n<p>æˆ‘ä»¬æ¥ä¸‹æ¥çš„å­¦ä¹ ï¼Œä¸»è¦æ˜¯ä¾èµ– kibana çš„ devTool åŠŸèƒ½ã€‚å› ä¸º devTools ç»™æˆ‘ä»¬æä¾›å»ºéå¸¸æ–¹ä¾¿çš„ Rest API è°ƒç”¨æ–¹å¼ã€‚</p>\n<p><img data-src=\"/images/es-series/kibana-devTool.png\" alt=\"kibana-devTool\"></p>\n<h2 id=\"å®‰è£…-logstash\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…-logstash\">#</a> å®‰è£…  <code>logstash</code></h2>\n<p><code>Logstash</code>  æ˜¯ä¸€ä¸ªå…·æœ‰å®æ—¶ç®¡é“åŠŸèƒ½çš„å¼€æºæ•°æ®æ”¶é›†å¼•æ“ã€‚ <code>Logstash</code>  å¯ä»¥åŠ¨æ€åœ°ç»Ÿä¸€æ¥è‡ªä¸åŒæ•°æ®æºçš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®è§„èŒƒåŒ–åˆ°æ‚¨é€‰æ‹©çš„ç›®çš„åœ°ã€‚ä¸ºå„ç§é«˜çº§ä¸‹æ¸¸åˆ†æå’Œå¯è§†åŒ–ç”¨ä¾‹æ¸…ç†å’Œæ°‘ä¸»åŒ–æ‰€æœ‰æ•°æ®ã€‚è™½ç„¶ <code>Logstash</code>  æœ€åˆæ¨åŠ¨äº†æ—¥å¿—æ”¶é›†æ–¹é¢çš„åˆ›æ–°ï¼Œä½†å®ƒçš„åŠŸèƒ½è¿œè¿œè¶…å‡ºäº†è¿™ä¸ªç”¨ä¾‹ã€‚ä»»ä½•ç±»å‹çš„äº‹ä»¶éƒ½å¯ä»¥é€šè¿‡å¤§é‡çš„è¾“å…¥ã€è¿‡æ»¤å’Œè¾“å‡ºæ’ä»¶æ¥ä¸°å¯Œå’Œè½¬æ¢ï¼Œå¹¶ä¸”ä½¿ç”¨è®¸å¤šæœ¬åœ°ç¼–è§£ç å™¨è¿›ä¸€æ­¥ç®€åŒ–äº†å¸æ”¶è¿‡ç¨‹ã€‚</p>\n<h3 id=\"ä¸‹è½½-2\"><a class=\"markdownIt-Anchor\" href=\"#ä¸‹è½½-2\">#</a> ä¸‹è½½</h3>\n<p>å¯ä»¥åœ¨  <code>https://www.elastic.co/cn/downloads/logstash</code>  é¡µé¢ä¸Šä¸‹è½½æ‰€éœ€çš„ å®‰è£…åŒ…ã€‚è¿›è¡Œè§£å‹ã€‚</p>\n<p>åé¢æˆ‘ä»¬ä¼šä¸“é—¨ä»‹ç» logStash çš„ä½¿ç”¨ã€‚ è¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚</p>\n<p>è‡³æ­¤ï¼Œæˆ‘ä»¬äº†è§£äº†è‘—åçš„  <code>ELK</code>  æ—¥å¿—æ”¶é›†å¤„ç†å¥—è£…ã€‚</p>\n<h2 id=\"beats\"><a class=\"markdownIt-Anchor\" href=\"#beats\">#</a> Beats</h2>\n<p><code>Beats</code>  æ˜¯æ‚¨ä½œä¸ºä»£ç†å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šçš„å¼€æºæ•°æ®å‘é€è€…ï¼Œç”¨äºå°†è¿è¥æ•°æ®å‘é€åˆ° <code>Elasticsearch</code> ã€‚å…¶æä¾›äº†æ•°æ®å®¡æ ¸ï¼Œæ—¥å¿—æ–‡ä»¶ï¼Œäº‘æ•°æ®ï¼Œå¯ç”¨æ€§ï¼Œç³»ç»Ÿæ—¥å¿—ï¼ŒæŒ‡æ ‡ï¼Œç½‘ç»œæµé‡ï¼Œ <code>Windows</code>  äº‹ä»¶è®°å½•ç­‰åŠŸèƒ½ã€‚ <code>Beats</code>  å¯ä»¥å°†æ•°æ®ç›´æ¥å‘é€åˆ° <code>Elasticsearch</code>  æˆ–é€šè¿‡ <code>Logstash</code>  å‘é€ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„è¿›ä¸€æ­¥å¤„ç†å’Œå¢å¼ºæ•°æ®ï¼Œç„¶åå†åœ¨ <code>Kibana</code>  ä¸­è¿›è¡Œå¯è§†åŒ–ã€‚<br>\n <code>beats</code>  ä¸ºä¸åŒçš„åŠŸèƒ½ï¼Œæä¾›äº†ä¸åŒçš„ç»„ä»¶ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œå®‰è£…ç‰¹å®šçš„äº§å“ï¼Œè¿™é‡Œä¸å¤šä»‹ç»ã€‚</p>\n<h2 id=\"å…¶ä»–\"><a class=\"markdownIt-Anchor\" href=\"#å…¶ä»–\">#</a> å…¶ä»–</h2>\n<p>é™¤äº†  <code>ElasticSearch</code> ,  <code>logStash</code> ,  <code>kibana</code> ,  <code>Beats</code>  ä¹‹å¤–ï¼Œ <code>Elastic</code>  è¿˜æä¾›äº†å…¶ä»–çš„äº§å“ï¼Œæ¯”å¦‚ï¼š <code>APM Server</code> ,  <code>ElasticSearch Hoop</code> ã€‚ å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£è¿›è¡Œå­¦ä¹ ã€‚</p>\n<p>åœ¨åé¢çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘ä»¬å¸¸ç”¨åˆ°çš„æ˜¯  <code>ElasticSearch</code>  å’Œ  <code>Kibana</code>  . æ‰€ä»¥å°†è¿™ä¸¤ä¸ªè½¯ä»¶å®‰è£…å¥½å°±å¯ä»¥å•¦ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Elastic Search",
                "æœç´¢"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/01.ES%E7%AE%80%E4%BB%8B/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/01.ES%E7%AE%80%E4%BB%8B/",
            "title": "Elastic Searchç®€ä»‹",
            "date_published": "2021-08-31T06:28:55.000Z",
            "content_html": "<h1 id=\"elasticsearchç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#elasticsearchç®€ä»‹\">#</a> Elasticsearch ç®€ä»‹</h1>\n<p><code>Elasticsearch</code>  æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼  <code>RESTful</code>  <b>æœç´¢</b>å’Œ<b>åˆ†æ</b>å¼•æ“ï¼Œèƒ½å¤Ÿè§£å†³è¶Šæ¥è¶Šå¤šä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚<br>\n <code>Elasticsearch</code>  æ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„å¼€æºåˆ†å¸ƒå¼å…¨æ–‡æœ¬æœç´¢å’Œåˆ†æå¼•æ“ã€‚ å®ƒä½¿æ‚¨å¯ä»¥å¿«é€Ÿï¼Œè¿‘ä¹å®æ—¶åœ°å­˜å‚¨ï¼Œæœç´¢å’Œåˆ†æå¤§é‡æ•°æ®ã€‚ å®ƒé€šå¸¸ç”¨ä½œæ”¯æŒå…·æœ‰å¤æ‚æœç´¢åŠŸèƒ½å’Œè¦æ±‚çš„åº”ç”¨ç¨‹åºçš„åŸºç¡€å¼•æ“ / æŠ€æœ¯ã€‚æä¾›äº†ä¸°å¯Œçš„  <code>RESTful</code>  API.</p>\n<p>è¿™é‡Œ ç‰¹åˆ«è®°ä½ <b>æœç´¢</b>  å’Œ <b>åˆ†æ</b> è¿™ä¸¤ä¸ªè¯ï¼Œåé¢æˆ‘ä»¬èŠ±å¤§é‡ç¯‡å¹…å»å­¦ä¹   <code>ES</code>  çš„è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œä½“éªŒ  <code>ES</code>  çš„å¼ºå¤§ä¹‹å¤„ã€‚</p>\n<h1 id=\"eså‘å±•å†å²\"><a class=\"markdownIt-Anchor\" href=\"#eså‘å±•å†å²\">#</a> ES å‘å±•å†å²</h1>\n<h2 id=\"2010å¹´2æœˆ-ç¬¬ä¸€æ¬¡å‘å¸ƒ\"><a class=\"markdownIt-Anchor\" href=\"#2010å¹´2æœˆ-ç¬¬ä¸€æ¬¡å‘å¸ƒ\">#</a> 2010 å¹´ 2 æœˆ ç¬¬ä¸€æ¬¡å‘å¸ƒ</h2>\n<h2 id=\"2014å¹´1æœˆ-å‘å¸ƒäº†10ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#2014å¹´1æœˆ-å‘å¸ƒäº†10ç‰ˆæœ¬\">#</a> 2014 å¹´ 1 æœˆ å‘å¸ƒäº† 1.0 ç‰ˆæœ¬</h2>\n<h2 id=\"2015å¹´10æœˆå‘å¸ƒ20ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#2015å¹´10æœˆå‘å¸ƒ20ç‰ˆæœ¬\">#</a> 2015 å¹´ 10 æœˆï¼Œå‘å¸ƒ 2.0 ç‰ˆæœ¬</h2>\n<h2 id=\"2016å¹´10æœˆå‘å¸ƒ50ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#2016å¹´10æœˆå‘å¸ƒ50ç‰ˆæœ¬\">#</a> 2016 å¹´ 10 æœˆï¼Œå‘å¸ƒ 5.0 ç‰ˆæœ¬</h2>\n<ul>\n<li>æ”¯æŒ lucene 6.x. æ€§èƒ½æå‡ã€‚é»˜è®¤æ‰“åˆ†æœºåˆ¶ä» TF-IDF æ”¹ä¸º BM25</li>\n<li>æ”¯æŒ Ingest èŠ‚ç‚¹ / Painless Scripting / Completion Suggested æ”¯æŒ / åŸç”Ÿçš„ Java Rest å®¢æˆ·ç«¯</li>\n<li>Type æ ‡è®°ä¸º deprecated , æ”¯æŒ keyword çš„ç±»å‹</li>\n<li>æ€§èƒ½ä¼˜åŒ–\n<ul>\n<li>å†…éƒ¨å¼•æ“ç§»é™¤äº†é¿å…åŒä¸€æ–‡æ¡£å¹¶å‘æ›´æ–°çš„ç«äº‰é”ï¼Œå¸¦æ¥äº† 15%-20% çš„æ€§èƒ½æå‡</li>\n<li>Instant Aggregation ï¼Œæ”¯æŒåˆ†ç‰‡ä¸Šèšåˆçš„ç¼“å­˜</li>\n<li>æ–°å¢äº† Profile API</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2017å¹´10æœˆ-å‘å¸ƒ60ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#2017å¹´10æœˆ-å‘å¸ƒ60ç‰ˆæœ¬\">#</a> 2017 å¹´ 10 æœˆï¼Œ å‘å¸ƒ 6.0 ç‰ˆæœ¬</h2>\n<ul>\n<li>æ”¯æŒ Lucence 7.x ç‰ˆæœ¬</li>\n<li>æ–°å¢åŠŸèƒ½ï¼šè·¨é›†ç¾¤å¤åˆ¶ï¼Œç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒSQL çš„æ”¯æŒ</li>\n<li>æ›´å‹å¥½çš„å‡çº§å’Œæ•°æ®è¿ç§»ï¼šåœ¨ä¸»è¦ç‰ˆæœ¬ä¹‹é—´çš„è¿ç§»æ›´ä¸ºç®€åŒ–ï¼Œä½“éªŒå‡çº§ã€‚ å…¨æ–°çš„åŸºäºæ“ä½œçš„æ•°æ®å¤åˆ¶æ¡†æ¶ï¼Œå¯ä»¥åŠ å¿«æ•°æ®æ¢å¤ã€‚</li>\n<li>æ€§èƒ½ä¼˜åŒ–ï¼šæœ‰æ•ˆå­˜å‚¨ç¨€ç–å­—æ®µçš„æ–°æ–¹æ³•ï¼Œé™ä½äº†å­˜å‚¨æˆæœ¬ã€‚ åœ¨ç´¢å¼•æ—¶è¿›è¡Œæ’åºï¼Œå¯ä»¥åŠ å¿«æ’åºçš„æŸ¥è¯¢æ€§èƒ½ã€‚</li>\n</ul>\n<h2 id=\"2019å¹´4æœˆå‘å¸ƒ70ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#2019å¹´4æœˆå‘å¸ƒ70ç‰ˆæœ¬\">#</a> 2019 å¹´ 4 æœˆï¼Œå‘å¸ƒ 7.0 ç‰ˆæœ¬</h2>\n<ul>\n<li>æ”¯æŒ  <code>Lucene 8.0</code>  ç‰ˆæœ¬</li>\n<li>é‡å¤§æ”¹è¿› - æ­£å¼åºŸé™¤å•ä¸ªç´¢å¼•ä¸‹å¤šä¸ª Type çš„æ”¯æŒ</li>\n<li><code>7.1</code>  å¼€å§‹ï¼Œ <code>Security</code>  åŠŸèƒ½å…è´¹ä½¿ç”¨</li>\n<li><code>ECK</code>  - æ”¯æŒ <code>Elasticsearch operator on kubernetes</code></li>\n<li>æ–°åŠŸèƒ½:  <code>New Cluster Coordination</code> ,  <code>Feature-Complete High Level Rest Client</code> ,  <code>Script Score Query</code></li>\n<li>æ€§èƒ½ä¼˜åŒ–ï¼šé»˜è®¤çš„ <code>Primary Shard</code>  æ•°ä» <code>5</code>  æ”¹ä¸º <code>1</code> ï¼Œé¿å… <code>Over Sharding</code> . æ€§èƒ½ä¼˜åŒ–ï¼Œæ›´å¿«çš„ <code>Top K</code></li>\n</ul>\n<h2 id=\"2020å¹´12æœˆ-å‘å¸ƒäº†710ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#2020å¹´12æœˆ-å‘å¸ƒäº†710ç‰ˆæœ¬\">#</a> 2020 å¹´ 12 æœˆ å‘å¸ƒäº† 7.10 ç‰ˆæœ¬</h2>\n<ol>\n<li><code>ES</code>  çš„ç´¢å¼•é€Ÿåº¦æå‡äº† <code>20%</code> ã€‚</li>\n<li>æˆ‘ä»¬é‡æ–°å¼•å…¥äº†æ—¶é—´ç‚¹ ( <code>pit</code> )ï¼Œè¿™æ˜¯ä¸€ç§ä¿å­˜æœç´¢ç´¢å¼•çŠ¶æ€çš„è½»é‡çº§æ–¹æ³•ã€‚å‡¹å‘é€šè¿‡ä½¿ ui æ›´å…·ååº”æ€§æ¥æ”¹å–„æœ€ç»ˆç”¨æˆ·ä½“éªŒã€‚</li>\n<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿å¤§å¤šæ•° EQL è¿ç®—ç¬¦å’Œå‡½æ•°åŒºåˆ†å¤§å°å†™ã€‚ æˆ‘ä»¬è¿˜æ·»åŠ äº†ï¼šï¼Œä¸€ä¸ªæ–°çš„ä¸åŒºåˆ†å¤§å°å†™çš„ <code>equal</code>  è¿ç®—ç¬¦ã€‚ ä¸“ä¸ºå®‰å…¨ç”¨ä¾‹è€Œè®¾è®¡</li>\n<li><code>REST API</code>  å¯¹ç³»ç»Ÿç´¢å¼•çš„è®¿é—®å·²å¼ƒç”¨</li>\n<li>ç³»ç»Ÿç´¢å¼•çš„æ–°çº¿ç¨‹æ± ã€‚æ·»åŠ äº†ä¸¤ä¸ªæ–°çš„çº¿ç¨‹æ± ï¼š <code>system_readå’Œsystem_write</code> ã€‚ è¿™äº›çº¿ç¨‹æ± å¯ç¡®ä¿å¯¹ <code>Elastic Stack</code>  è‡³å…³é‡è¦çš„ç³»ç»Ÿç´¢å¼•ï¼ˆä¾‹å¦‚å®‰å…¨æ€§æˆ– Kibana æ‰€ä½¿ç”¨çš„ç³»ç»Ÿç´¢å¼•ï¼‰åœ¨é›†ç¾¤æ‰¿å—æ²‰é‡çš„æŸ¥è¯¢æˆ–ç´¢å¼•è´Ÿè½½æ—¶ä¿æŒå“åº”èƒ½åŠ›ã€‚ <code>system_read</code>  æ˜¯å›ºå®šçº¿ç¨‹æ± ï¼Œç”¨äºç®¡ç†é’ˆå¯¹ç³»ç»Ÿç´¢å¼•çš„è¯»å–æ“ä½œçš„èµ„æºã€‚ åŒæ ·ï¼Œ <code>system_write</code>  æ˜¯ä¸€ä¸ªå›ºå®šçº¿ç¨‹æ± ï¼Œç”¨äºç®¡ç†ç”¨äºé’ˆå¯¹ç³»ç»Ÿç´¢å¼•çš„å†™æ“ä½œçš„èµ„æºã€‚ ä¸¤è€…çš„æœ€å¤§çº¿ç¨‹æ•°ç­‰äºå¯ç”¨å¤„ç†å™¨çš„ 5 æˆ–ä¸€åŠï¼Œä»¥è¾ƒå°è€…ä¸ºå‡†ã€‚</li>\n</ol>\n<h1 id=\"esçš„ç”Ÿæ€åœˆ\"><a class=\"markdownIt-Anchor\" href=\"#esçš„ç”Ÿæ€åœˆ\">#</a> ES çš„ç”Ÿæ€åœˆ</h1>\n<h2 id=\"elastic-search\"><a class=\"markdownIt-Anchor\" href=\"#elastic-search\">#</a> elastic search</h2>\n<p><code>Elasticsearch</code>  æ˜¯ <code>Elastic Stack</code>  æ ¸å¿ƒçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚  <code>Logstash</code>  å’Œ   æœ‰åŠ©äºæ”¶é›†ï¼Œèšåˆå’Œä¸°å¯Œæ‚¨çš„æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨ <code>Elasticsearch</code>  ä¸­ã€‚ ä½¿ç”¨  ï¼Œæ‚¨å¯ä»¥äº¤äº’å¼åœ°æ¢ç´¢ï¼Œå¯è§†åŒ–å’Œå…±äº«å¯¹æ•°æ®çš„è§è§£ï¼Œå¹¶ç®¡ç†å’Œç›‘è§†å †æ ˆã€‚  <code>Elasticsearch</code>  æ˜¯å‘ç”Ÿç´¢å¼•ï¼Œæœç´¢å’Œåˆ†æ é­”åŠ›çš„åœ°æ–¹ã€‚</p>\n<p><code>Elasticsearch</code>  ä¸ºæ‰€æœ‰ç±»å‹çš„æ•°æ®æä¾›è¿‘ä¹å®æ—¶çš„æœç´¢å’Œåˆ†æã€‚ æ— è®ºæ‚¨æ˜¯ç»“æ„åŒ–æ–‡æœ¬è¿˜æ˜¯éç»“æ„åŒ–æ–‡æœ¬ï¼Œæ•°å­—æ•°æ®æˆ–åœ°ç†ç©ºé—´æ•°æ®ï¼Œ <code>Elasticsearch</code>  éƒ½èƒ½ä»¥æ”¯æŒå¿«é€Ÿæœç´¢çš„æ–¹å¼æœ‰æ•ˆåœ°å¯¹å…¶è¿›è¡Œå­˜å‚¨å’Œç´¢å¼•ã€‚ æ‚¨ä¸ä»…å¯ä»¥è¿›è¡Œç®€å•çš„æ•°æ®æ£€ç´¢ï¼Œè¿˜å¯ä»¥èšåˆä¿¡æ¯æ¥å‘ç°æ•°æ®ä¸­çš„è¶‹åŠ¿å’Œæ¨¡å¼ã€‚ éšç€æ•°æ®å’ŒæŸ¥è¯¢é‡çš„å¢é•¿ï¼Œ <code>Elasticsearch</code>  çš„åˆ†å¸ƒå¼ç‰¹æ€§ä½¿æ‚¨çš„éƒ¨ç½²å¯ä»¥éšä¹‹æ— ç¼åœ°å¢é•¿ã€‚</p>\n<h2 id=\"kibana\"><a class=\"markdownIt-Anchor\" href=\"#kibana\">#</a> kibana</h2>\n<p><code>Kibana</code>  æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æå’Œå¯è§†åŒ–å¹³å°ã€‚ä½¿ç”¨ <code>Kibana</code>  æ¥æ¢ç´¢ä½ çš„ <code>Elasticsearch</code>  æ•°æ®ï¼Œç„¶åå»ºç«‹æ¼‚äº®çš„å¯è§†åŒ–å’Œä»ªè¡¨æ¿ã€‚<br>\n <code>Kibana</code>  å…·æœ‰ç®¡ç†å¼¹æ€§æ ˆçš„ UIã€‚ç®¡ç†æ‚¨çš„å®‰å…¨è®¾ç½®ï¼Œåˆ†é…ç”¨æˆ·è§’è‰²ï¼Œæ‹æ‘„å¿«ç…§ï¼Œå·èµ·æ‚¨çš„æ•°æ®ï¼Œä»¥åŠæ›´å¤šï¼Œéƒ½ä»ä¸€ä¸ª <code>Kibana UI</code>  çš„ä¾¿åˆ©ã€‚<br>\n <code>Elastic</code>  æ ˆè§£å†³æ–¹æ¡ˆçš„é›†ä¸­å¼ä¸­å¿ƒã€‚ä»æ—¥å¿—åˆ†æåˆ°æ–‡æ¡£å‘ç°.</p>\n<h2 id=\"beats\"><a class=\"markdownIt-Anchor\" href=\"#beats\">#</a> beats</h2>\n<p><code>Beats</code>  æ˜¯æ‚¨ä½œä¸ºä»£ç†å®‰è£…åœ¨æœåŠ¡å™¨ä¸Šçš„å¼€æºæ•°æ®å‘é€è€…ï¼Œç”¨äºå°†è¿è¥æ•°æ®å‘é€åˆ° <code>Elasticsearch</code> ã€‚å…¶æä¾›äº†æ•°æ®å®¡æ ¸ï¼Œæ—¥å¿—æ–‡ä»¶ï¼Œäº‘æ•°æ®ï¼Œå¯ç”¨æ€§ï¼Œç³»ç»Ÿæ—¥å¿—ï¼ŒæŒ‡æ ‡ï¼Œç½‘ç»œæµé‡ï¼Œ <code>Windows</code>  äº‹ä»¶è®°å½•ç­‰åŠŸèƒ½ã€‚ <code>Beats</code>  å¯ä»¥å°†æ•°æ®ç›´æ¥å‘é€åˆ° <code>Elasticsearch</code>  æˆ–é€šè¿‡ <code>Logstash</code>  å‘é€ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„è¿›ä¸€æ­¥å¤„ç†å’Œå¢å¼ºæ•°æ®ï¼Œç„¶åå†åœ¨ Kibana ä¸­è¿›è¡Œå¯è§†åŒ–ã€‚<br>\n <code>beats</code>  ä¸ºä¸åŒçš„åŠŸèƒ½ï¼Œæä¾›äº†ä¸åŒçš„ç»„ä»¶ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œå®‰è£…ç‰¹å®šçš„äº§å“.</p>\n<h2 id=\"logstash\"><a class=\"markdownIt-Anchor\" href=\"#logstash\">#</a> logstash</h2>\n<p><code>Logstash</code>  æ˜¯ä¸€ä¸ªå…·æœ‰å®æ—¶ç®¡é“åŠŸèƒ½çš„å¼€æºæ•°æ®æ”¶é›†å¼•æ“ã€‚ <code>Logstash</code>  å¯ä»¥åŠ¨æ€åœ°ç»Ÿä¸€æ¥è‡ªä¸åŒæ•°æ®æºçš„æ•°æ®ï¼Œå¹¶å°†æ•°æ®è§„èŒƒåŒ–åˆ°æ‚¨é€‰æ‹©çš„ç›®çš„åœ°ã€‚ä¸ºå„ç§é«˜çº§ä¸‹æ¸¸åˆ†æå’Œå¯è§†åŒ–ç”¨ä¾‹æ¸…ç†å’Œæ°‘ä¸»åŒ–æ‰€æœ‰æ•°æ®ã€‚è™½ç„¶ <code>Logstash</code>  æœ€åˆæ¨åŠ¨äº†æ—¥å¿—æ”¶é›†æ–¹é¢çš„åˆ›æ–°ï¼Œä½†å®ƒçš„åŠŸèƒ½è¿œè¿œè¶…å‡ºäº†è¿™ä¸ªç”¨ä¾‹ã€‚ä»»ä½•ç±»å‹çš„äº‹ä»¶éƒ½å¯ä»¥é€šè¿‡å¤§é‡çš„è¾“å…¥ã€è¿‡æ»¤å’Œè¾“å‡ºæ’ä»¶æ¥ä¸°å¯Œå’Œè½¬æ¢ï¼Œå¹¶ä¸”ä½¿ç”¨è®¸å¤šæœ¬åœ°ç¼–è§£ç å™¨è¿›ä¸€æ­¥ç®€åŒ–äº†å¸æ”¶è¿‡ç¨‹ã€‚</p>\n<h2 id=\"x-pack\"><a class=\"markdownIt-Anchor\" href=\"#x-pack\">#</a> x-pack</h2>\n<p><code>x-pack</code>  æ˜¯ <code>elasticsearch</code>  çš„ä¸€ä¸ªæ‰©å±•åŒ…ï¼Œå°†å®‰å…¨ï¼Œè­¦å‘Šï¼Œç›‘è§†ï¼Œå›¾å½¢å’ŒæŠ¥å‘ŠåŠŸèƒ½æ†ç»‘åœ¨ä¸€ä¸ªæ˜“äºå®‰è£…çš„è½¯ä»¶åŒ…ä¸­ï¼Œå¯ä»¥è½»æ¾çš„å¯ç”¨æˆ–è€…å…³é—­ä¸€äº›åŠŸèƒ½</p>\n<h1 id=\"esçš„åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#esçš„åº”ç”¨åœºæ™¯\">#</a> ES çš„åº”ç”¨åœºæ™¯</h1>\n<ul>\n<li>å°†æœç´¢æ¡†æ·»åŠ åˆ°åº”ç”¨æˆ–ç½‘ç«™</li>\n<li>å­˜å‚¨å’Œåˆ†ææ—¥å¿—ï¼ŒæŒ‡æ ‡å’Œå®‰å…¨äº‹ä»¶æ•°æ®</li>\n<li>ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥å®æ—¶è‡ªåŠ¨å»ºæ¨¡æ•°æ®è¡Œä¸º</li>\n<li>ä½¿ç”¨ <code>Elasticsearch</code>  ä½œä¸ºå­˜å‚¨å¼•æ“è‡ªåŠ¨åŒ–ä¸šåŠ¡å·¥ä½œæµç¨‹</li>\n<li>ä½¿ç”¨ <code>Elasticsearch</code>  ä½œä¸ºåœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆ <code>GIS</code> ï¼‰ç®¡ç†ï¼Œé›†æˆå’Œåˆ†æç©ºé—´ä¿¡æ¯</li>\n<li>ä½¿ç”¨ <code>Elasticsearch</code>  ä½œä¸ºç”Ÿç‰©ä¿¡æ¯å­¦ç ”ç©¶å·¥å…·æ¥å­˜å‚¨å’Œå¤„ç†é—ä¼ æ•°æ®<br>\nâ€¦</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Elastic Search",
                "æœç´¢"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/README/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/31/es-series/README/",
            "title": "Elastic Search ç›®å½•",
            "date_published": "2021-08-31T06:20:55.000Z",
            "content_html": "<h2 id=\"æœç´¢ä¹‹esç³»åˆ—\"><a class=\"markdownIt-Anchor\" href=\"#æœç´¢ä¹‹esç³»åˆ—\">#</a> æœç´¢ä¹‹ ES ç³»åˆ—</h2>\n<p>æœ¬ç³»åˆ—åŸºäºç‰ˆæœ¬ 7.10</p>\n<h2 id=\"ç›®å½•\"><a class=\"markdownIt-Anchor\" href=\"#ç›®å½•\">#</a> ç›®å½•</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> <a href=\"/2021/08/31/es-series/01.ES%E7%AE%80%E4%BB%8B/\">ES ç®€ä»‹</a></label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> ES å‘å±•å†å²</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> ES çš„ç”Ÿæ€åœˆ</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" checked=\"true\" disabled=\"true\"><label for=\"cbx_3\"> ES çš„åº”ç”¨åœºæ™¯</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> ä½¿ç”¨æ¶æ„</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\"><label for=\"cbx_5\"> <a href=\"/2021/08/31/es-series/02.ES%E5%AE%89%E8%A3%85/\">ES æ ˆå®‰è£…</a></label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" checked=\"true\" disabled=\"true\"><label for=\"cbx_6\"> ElasticSearch å®‰è£…</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" checked=\"true\" disabled=\"true\"><label for=\"cbx_7\"> ä¸‹è½½</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" checked=\"true\" disabled=\"true\"><label for=\"cbx_8\"> æ–‡ä»¶ç›®å½•ç»“æ„ï¼ŒJVM é…ç½®ï¼Œ</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_9\" checked=\"true\" disabled=\"true\"><label for=\"cbx_9\"> å¤šå®ä¾‹è¿è¡Œ</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_10\" checked=\"true\" disabled=\"true\"><label for=\"cbx_10\"> å¸¸ç”¨å‘½ä»¤</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_11\" checked=\"true\" disabled=\"true\"><label for=\"cbx_11\"> kibana å®‰è£…</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_12\" checked=\"true\" disabled=\"true\"><label for=\"cbx_12\"> å®‰è£…</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_13\" checked=\"true\" disabled=\"true\"><label for=\"cbx_13\"> é¡µé¢æµè§ˆ devTool</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_14\" checked=\"true\" disabled=\"true\"><label for=\"cbx_14\"> logstash å®‰è£…</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_15\" checked=\"true\" disabled=\"true\"><label for=\"cbx_15\"> <a href=\"/2021/08/31/es-series/03.ES%E9%85%8D%E7%BD%AE/\">ElasticSearch é…ç½®</a></label></li>\n</ul>\n<h3 id=\"å…¥é—¨\"><a class=\"markdownIt-Anchor\" href=\"#å…¥é—¨\">#</a> å…¥é—¨</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_16\" checked=\"true\" disabled=\"true\"><label for=\"cbx_16\"> <a href=\"/2021/08/31/es-series/04.ES%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/\">åŸºæœ¬æ¦‚å¿µ</a></label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_17\" checked=\"true\" disabled=\"true\"><label for=\"cbx_17\"> æ–‡æ¡£</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_18\" checked=\"true\" disabled=\"true\"><label for=\"cbx_18\"> å…ƒæ•°æ® (mapping)</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_19\" checked=\"true\" disabled=\"true\"><label for=\"cbx_19\"> ç´¢å¼•</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_20\" checked=\"true\" disabled=\"true\"><label for=\"cbx_20\"> æ¦‚å¿µ</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_21\" checked=\"true\" disabled=\"true\"><label for=\"cbx_21\"> è¯­æ„</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_22\" checked=\"true\" disabled=\"true\"><label for=\"cbx_22\"> <del>Type</del></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_23\" disabled=\"true\"><label for=\"cbx_23\"> èŠ‚ç‚¹</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_24\" disabled=\"true\"><label for=\"cbx_24\"> master èŠ‚ç‚¹</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_25\" disabled=\"true\"><label for=\"cbx_25\"> data èŠ‚ç‚¹</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_26\" disabled=\"true\"><label for=\"cbx_26\"> ingist èŠ‚ç‚¹</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_27\" disabled=\"true\"><label for=\"cbx_27\"> coordinating èŠ‚ç‚¹</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_28\" disabled=\"true\"><label for=\"cbx_28\"> å…¶ä»–ç±»å‹èŠ‚ç‚¹: hot&amp;warm èŠ‚ç‚¹ï¼ŒMachine Learning Node , Tribe èŠ‚ç‚¹ (æœªæ¥ç‰ˆæœ¬ä¼šè¢«ç§»é™¤)</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_29\" checked=\"true\" disabled=\"true\"><label for=\"cbx_29\"> åˆ†ç‰‡</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_30\" checked=\"true\" disabled=\"true\"><label for=\"cbx_30\"> é›†ç¾¤</label></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"è¿›é˜¶\"><a class=\"markdownIt-Anchor\" href=\"#è¿›é˜¶\">#</a> è¿›é˜¶</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_31\" disabled=\"true\"><label for=\"cbx_31\"> ç´¢å¼•</label></p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_32\" disabled=\"true\"><label for=\"cbx_32\"> å¸¸ç”¨ api (ç´¢å¼•ç®¡ç†)</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_33\" disabled=\"true\"><label for=\"cbx_33\"> åŸºæœ¬åŸç†</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_34\" disabled=\"true\"><label for=\"cbx_34\"> æ–‡æ¡£</label></p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_35\" disabled=\"true\"><label for=\"cbx_35\"> æ–‡æ¡£ç®¡ç†</label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_36\" disabled=\"true\"><label for=\"cbx_36\"> ç®€å• CURD</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_37\" disabled=\"true\"><label for=\"cbx_37\"> bulk api</label></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>åˆ†è¯å™¨</p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_38\" disabled=\"true\"><label for=\"cbx_38\"> åˆ†è¯å™¨ç±»å‹</label></li>\n</ul>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_39\" disabled=\"true\"><label for=\"cbx_39\"> å…¶ä»– api</label></p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_40\" disabled=\"true\"><label for=\"cbx_40\"> æŸ¥çœ‹é›†ç¾¤ï¼Œåˆ†ç‰‡ï¼Œç´¢å¼•</label></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"é«˜æ‰‹\"><a class=\"markdownIt-Anchor\" href=\"#é«˜æ‰‹\">#</a> é«˜æ‰‹</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_41\" disabled=\"true\"><label for=\"cbx_41\"> èšåˆåˆ†ææœç´¢</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_42\" disabled=\"true\"><label for=\"cbx_42\"> cat API</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_43\" disabled=\"true\"><label for=\"cbx_43\"> cluster API</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_44\" disabled=\"true\"><label for=\"cbx_44\"> ccr API</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_45\" disabled=\"true\"><label for=\"cbx_45\"> data Stream API</label></li>\n</ul>\n<h3 id=\"å®—å¸ˆ\"><a class=\"markdownIt-Anchor\" href=\"#å®—å¸ˆ\">#</a> å®—å¸ˆ</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_46\" disabled=\"true\"><label for=\"cbx_46\"> è¡¥è´§ä¸­â€¦</label></li>\n</ul>\n<h3 id=\"è¿ç»´\"><a class=\"markdownIt-Anchor\" href=\"#è¿ç»´\">#</a> è¿ç»´</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_47\" disabled=\"true\"><label for=\"cbx_47\"> è¡¥è´§ä¸­â€¦</label></li>\n</ul>\n",
            "tags": [
                "Elastic Search",
                "æœç´¢"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/29/BQ/LeetCode/0002-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/29/BQ/LeetCode/0002-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/",
            "title": "LC:åè½¬é“¾è¡¨I",
            "date_published": "2021-08-29T09:25:55.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<p>ç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹  <code>head</code>  ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚</p>\n<blockquote>\n<p>ç¤ºä¾‹ä¸€</p>\n</blockquote>\n<p><img data-src=\"/images/ac-code/reverseLinkedList1/reverseLinkedListCase1.jpeg\" alt=\"\"></p>\n<p>è¾“å…¥ï¼šhead = [1,2,3,4,5]<br>\n è¾“å‡ºï¼š[5,4,3,2,1]</p>\n<blockquote>\n<p>ç¤ºä¾‹äºŒ</p>\n</blockquote>\n<p><img data-src=\"/images/ac-code/reverseLinkedList1/reverseLinkedListCase2.jpeg\" alt=\"\"></p>\n<p>è¾“å…¥ï¼šhead = [1,2]<br>\n è¾“å‡ºï¼š[2,1]</p>\n<blockquote>\n<p>ç¤ºä¾‹ä¸‰</p>\n</blockquote>\n<p>è¾“å…¥ï¼šhead = []<br>\n è¾“å‡ºï¼š[]</p>\n<p>æç¤ºï¼š</p>\n<p>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [0, 5000]<br>\n-5000 &lt;= Node.val &lt;= 5000</p>\n<p>è¿›é˜¶ï¼šé“¾è¡¨å¯ä»¥é€‰ç”¨è¿­ä»£æˆ–é€’å½’æ–¹å¼å®Œæˆåè½¬ã€‚ä½ èƒ½å¦ç”¨ä¸¤ç§æ–¹æ³•è§£å†³è¿™é“é¢˜ï¼Ÿ</p>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰206.åè½¬é“¾è¡¨\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1saW5rZWQtbGlzdA==\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1saW5rZWQtbGlzdA==\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰206.åè½¬é“¾è¡¨</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†æ\">#</a> åˆ†æ</h2>\n<p>è¿™æ˜¯ä¸€é“éå¸¸ç®€å•çš„é¢˜ç›®ã€‚ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å‡ºç°<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTglQkUlQkUlRTUlODUlOEIlRTYlOTUlODglRTUlQkElOTQvNTYzOTE3OA==\">è¾¾å…‹æ•ˆåº”</span>çš„ä¸€é“é¢˜ç›®ã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåº”ä¸ºè¿™é“é¢˜å¤ªç®€å•äº†å•Šã€‚ <b>æ€è·¯</b> å¤ªç®€å•äº†å•Šã€‚ ä½†æ˜¯çœŸæ­£å»å†™çš„è¯ï¼Œå¯ä¸è§å¾—çœŸæœ‰é‚£ä¹ˆç®€å•ã€‚</p>\n<p>ç®€å•çš„é¢˜ç›®ï¼Œæˆ‘ä»¬è¿˜æ˜¯ ä»¥å›¾çš„å½¢å¼æ¥å±•ç¤ºã€‚</p>\n<h3 id=\"æ€è·¯ä¸€-è¿­ä»£é“¾è¡¨-åˆ›å»ºæ–°èŠ‚ç‚¹é‡ç»„æˆæ–°é“¾è¡¨\"><a class=\"markdownIt-Anchor\" href=\"#æ€è·¯ä¸€-è¿­ä»£é“¾è¡¨-åˆ›å»ºæ–°èŠ‚ç‚¹é‡ç»„æˆæ–°é“¾è¡¨\">#</a> æ€è·¯ä¸€ï¼šè¿­ä»£é“¾è¡¨ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œé‡ç»„æˆæ–°é“¾è¡¨</h3>\n<h4 id=\"æ€è·¯è§£æ\"><a class=\"markdownIt-Anchor\" href=\"#æ€è·¯è§£æ\">#</a> æ€è·¯è§£æ</h4>\n<p><img data-src=\"/images/ac-code/reverseLinkedList1/solution1.png\" alt=\"ä¸€å›¾èƒœåƒè¨€\"></p>\n<p>æ ¸å¿ƒæ€è·¯å¦‚æ ‡é¢˜ã€‚ é¦–å…ˆå°†éå†çš„åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹å€¼å¤åˆ¶åˆ°æ–°å»ºçš„èŠ‚ç‚¹ä¸­ (a æ­¥éª¤), èŠ‚ç‚¹ next æŒ‡é’ˆæŒ‡å‘æ˜¯ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ²¡æœ‰åˆ™ä¸º null (b æ­¥éª¤). éå†é“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚</p>\n<p>è¿™æ ·å…¶å®ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚ä¹Ÿå°±è¯´ä¼šåŒæ—¶å­˜åœ¨ä¸¤æ¡é“¾è¡¨ã€‚</p>\n<p><span class=\"label success\">âœŠæ—¶é—´å¤æ‚åº¦ä¸º O (n)ï¼Œ ç©ºé—´å¤æ‚åº¦ä¸º O (n)</span></p>\n<h4 id=\"ä»£ç å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç å®ç°\">#</a> ä»£ç å®ç°</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ListNode <span class=\"title\">reverseList</span><span class=\"params\">(ListNode head)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// éç©ºåˆ¤æ–­</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == head || <span class=\"keyword\">null</span> == head.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> head;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// éå†æ—§é“¾è¡¨,æ–°å»ºèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‹¼æ¥æˆæ–°é“¾è¡¨ã€‚</span></span><br><span class=\"line\">        ListNode pre = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">null</span> != head) &#123;</span><br><span class=\"line\">            ListNode curr = <span class=\"keyword\">new</span> ListNode(head.val);</span><br><span class=\"line\">            curr.next = pre;</span><br><span class=\"line\">            pre = curr;</span><br><span class=\"line\">            head = head.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pre;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ€è·¯äºŒ-è¿­ä»£å˜æ›´é“¾è¡¨çš„æŒ‡é’ˆæŒ‡å‘\"><a class=\"markdownIt-Anchor\" href=\"#æ€è·¯äºŒ-è¿­ä»£å˜æ›´é“¾è¡¨çš„æŒ‡é’ˆæŒ‡å‘\">#</a> æ€è·¯äºŒï¼šè¿­ä»£å˜æ›´é“¾è¡¨çš„æŒ‡é’ˆæŒ‡å‘</h3>\n<h4 id=\"æ€è·¯è§£æ-2\"><a class=\"markdownIt-Anchor\" href=\"#æ€è·¯è§£æ-2\">#</a> æ€è·¯è§£æ</h4>\n<p>è¿™ç§æ€è·¯ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½†æ˜¯ä¸€å®šè¦æƒ³å¥½å–½ä¹‹åï¼Œå†çœ‹å¼€å§‹ç¼–ç ï¼Œè¦ä¸ç„¶å¾ˆå®¹æ˜“æ€ç»ªé”™ä¹±ã€‚</p>\n<p>å›¾è§£:</p>\n<p><img data-src=\"/images/ac-code/reverseLinkedList1/solution2.png\" alt=\"ä¸€å›¾èƒœåƒè¨€\"></p>\n<p>è¿™ç§è§£æ³•éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼Œ pre ä»£è¡¨å…¶å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ cur ä»£è¡¨åä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿›è¡Œéå†ï¼Œä»è€Œå®ç° æŒ‡é’ˆæŒ‡å‘çš„å˜æ›´ã€‚ å½“ç„¶ï¼Œè¿˜éœ€è¦ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹å»å¸®å¿™ pre å’Œ cur æŒ‡é’ˆï¼Œå‘åç§»åŠ¨ã€‚</p>\n<p><span class=\"label success\">âœŠæ—¶é—´å¤æ‚åº¦æ˜¯ O (n); ç©ºé—´å¤æ‚åº¦æ˜¯ O (3);</span></p>\n<h4 id=\"ä»£ç å®ç°-2\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç å®ç°-2\">#</a> ä»£ç å®ç°</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution2</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ListNode <span class=\"title\">reverseList</span><span class=\"params\">(ListNode head)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// éç©ºåˆ¤æ–­</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == head || <span class=\"keyword\">null</span> == head.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> head;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ListNode pre = head, cur = head.next;</span><br><span class=\"line\">        <span class=\"comment\">// !!æ³¨æ„:æ–­å¼€å¤´èŠ‚ç‚¹çš„nextæŒ‡é’ˆï¼Œé¿å…äº§ç”Ÿç¯å‹é“¾è¡¨ã€‚</span></span><br><span class=\"line\">        pre.next = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"keyword\">null</span> != cur) &#123;</span><br><span class=\"line\">            ListNode tempNode = cur.next;</span><br><span class=\"line\">            cur.next = pre;</span><br><span class=\"line\">            pre = cur;</span><br><span class=\"line\">            cur = tempNode;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pre;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ€è·¯ä¸‰-é€’å½’æ–¹å¼-å˜æ›´æŒ‡é’ˆ\"><a class=\"markdownIt-Anchor\" href=\"#æ€è·¯ä¸‰-é€’å½’æ–¹å¼-å˜æ›´æŒ‡é’ˆ\">#</a> æ€è·¯ä¸‰ï¼šé€’å½’æ–¹å¼ï¼Œ å˜æ›´æŒ‡é’ˆ</h3>\n<h4 id=\"æ€è·¯è§£æ-3\"><a class=\"markdownIt-Anchor\" href=\"#æ€è·¯è§£æ-3\">#</a> æ€è·¯è§£æ</h4>\n<p>è¿™æ€è·¯ä¸‰ï¼Œå…¶å®æ˜¯æ€è·¯äºŒçš„ä¸åŒå†™æ³•ã€‚ è¿™ç§å®ç°æ–¹æ³•é¦–å…ˆå°±éœ€è¦å°† é“¾è¡¨ â€œé€’â€ åˆ°åº•ï¼Œç„¶ååœ¨å½’çš„æ—¶å€™ï¼ŒæŠŠ èŠ‚ç‚¹é“¾æ¥åˆ°ä¸€èµ·ã€‚å¦‚ä¸‹å›¾</p>\n<p><img data-src=\"/images/ac-code/reverseLinkedList1/solution3.png\" alt=\"ä¸€å›¾èƒœåƒè¨€\"></p>\n<p>è¿™æ ·è¯´èµ·æ¥ï¼Œé€’å½’è¿™ç§æ–¹å¼æ¥è§£å†³åè½¬ç±»çš„é—®é¢˜å¥½åƒä¼šæœ‰ä¸€ç§ä¸ç”Ÿä¿±æ¥çš„ä¼˜åŠ¿ã€‚  <code>é¦–å…ˆé€’è¿›å»ï¼Œç„¶åå½’å‡ºæ¥</code> ã€‚</p>\n<h4 id=\"ä»£ç å®ç°-3\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç å®ç°-3\">#</a> ä»£ç å®ç°</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution3</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ListNode <span class=\"title\">reverseList</span><span class=\"params\">(ListNode head)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// éç©ºåˆ¤æ–­</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == head || <span class=\"keyword\">null</span> == head.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> head;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// é€’å½’å…¥å£</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> reverse(head, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ListNode <span class=\"title\">reverse</span><span class=\"params\">(ListNode currNode, ListNode preNode)</span> </span>&#123;</span><br><span class=\"line\">        ListNode headNode = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == currNode) &#123;</span><br><span class=\"line\">            headNode = preNode;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            headNode = reverse(currNode.next, currNode);</span><br><span class=\"line\">            currNode.next = preNode;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> headNode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ€è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#æ€è€ƒ\">#</a> æ€è€ƒ</h2>\n<p>è¿™ä¸€é“é¢˜è€ƒçš„æ˜¯ç®€å•çš„é€»è¾‘é—®é¢˜ï¼Œå®å±ç®€å•è‡³æçš„é¢˜ç›®ã€‚è¦æ³¨æ„ é™·å…¥ â€œè¾¾å…‹æ•ˆåº”â€ã€‚</p>\n<p>å‹¿ä»¥é¢˜å°è€Œä¸åšã€‚</p>\n<p>ä½¿ç”¨å¤´é€’å½’æ¥åšåè½¬ç±»ä¼¼çš„é¢˜ç›®ï¼Œå¥½åƒæ˜¯ä¸€ç§å¤©ç„¶æ”¯æŒçš„ç‰¹æ€§ã€‚ä½†æ˜¯åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸å»ºè®®è¿‡å¤šçš„ä½¿ç”¨é€’å½’çš„æ–¹å¼ï¼Œä¸€æ–¹é¢ä¸å…·å¤‡å¯è¯»æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œé€’å½’æ–¹å¼å¯¹æ€§èƒ½ä¸å¤ªä¼˜åŒ–ï¼Œè¿˜æœ‰é‡è¦çš„æ˜¯è¦è€ƒè™‘æ ˆæº¢å‡ºçš„é£é™©ã€‚</p>\n<h2 id=\"ç›¸å…³é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#ç›¸å…³é¢˜ç›®\">#</a> ç›¸å…³é¢˜ç›®</h2>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰189.åè½¬æ•°ç»„\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcm90YXRlLWFycmF5\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcm90YXRlLWFycmF5\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰189.åè½¬æ•°ç»„</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰92.åè½¬é“¾è¡¨II\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1saW5rZWQtbGlzdC1paS8=\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1saW5rZWQtbGlzdC1paS8=\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰92.åè½¬é“¾è¡¨II</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰7.æ•´æ•°åè½¬\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1pbnRlZ2VyLw==\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1pbnRlZ2VyLw==\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰7.æ•´æ•°åè½¬</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰344.åè½¬å­—ç¬¦ä¸²\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1zdHJpbmcv\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcmV2ZXJzZS1zdHJpbmcv\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰344.åè½¬å­—ç¬¦ä¸²</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "æ•°æ®ç»“æ„",
                "leetCode",
                "é“¾è¡¨",
                "é¢ç»ä¹‹ç®—æ³•é¢˜"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/23/java%E7%B3%BB%E5%88%97/JDK/stream/Stream-basic/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/23/java%E7%B3%BB%E5%88%97/JDK/stream/Stream-basic/",
            "title": "JDKçš„Streamä¹‹ç³»åˆ—ä¸€ åˆçª¥æµåŸç†",
            "date_published": "2021-08-23T15:13:55.000Z",
            "content_html": "<p>å­¦ä¸œè¥¿çš„æ—¶å€™æœ€å¥½æ˜¯ç†è®ºå…ˆè¡Œï¼Œä¸ºä»€ä¹ˆï¼Ÿæ²¡æœ‰ç†è®ºï¼Œæƒ³å½“ç„¶çš„å»å¹²ï¼Œå¹²å¥½äº†æ˜¯ ççŒ«ç¢°ä¸Šæ­»è€—å­ï¼Œå¹²ä¸å¥½å°±çå¹²ï¼Œæµªè´¹æ—¶é—´ï¼Œåªä¼šå¼„å¾—èº«å¿ƒä¿±ç–²ã€‚<br>\nå¯æ˜¯åœ¨çœŸæ­£çš„å·¥ä½œä¸­ï¼Œå¾ˆå°‘å·¥ä½œä¼šå…è®¸ä½ å…ˆå¼„æ¸…åŸç†å†å»å®æ“ã€‚ä½†æ˜¯ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ¬ ä¸‹çš„å€ºç»ˆç©¶æ˜¯éœ€è¦è¿˜çš„ã€‚</p>\n<p>ä»Šå¤©å’±ä»¬çš„ä¸»é¢˜æ˜¯  <code>stream</code> . å’±ä»¬å°±ä» <code>Stream</code>  çš„ &quot;é“ï¼Œæœ¯ï¼Œæ³•ï¼Œå™¨&quot; å››ä¸ªé˜¶æ®µæ¥èŠå¥½å¥½çš„èŠèŠè¿™ä¸ª  <code>Stream</code> .</p>\n<h2 id=\"ä»¥å™¨å§‹ä»ä½¿ç”¨å¼€å§‹\"><a class=\"markdownIt-Anchor\" href=\"#ä»¥å™¨å§‹ä»ä½¿ç”¨å¼€å§‹\">#</a> ä»¥ &quot;å™¨&quot; å§‹ï¼šä»ä½¿ç”¨å¼€å§‹</h2>\n<blockquote>\n<p>ä½ å¹³æ—¶æ˜¯æ€ä¹ˆä½¿ç”¨  <code>Stream</code>  çš„ï¼Ÿ</p>\n</blockquote>\n<p>æ¯”å¦‚æˆ‘ä¼šä½¿ç”¨ <code>Stream</code>  åˆ›å»ºä¸€ä¸ªæµã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Stream&lt;Integer&gt; integerStream = Stream.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">// do somethings ..</span></span><br></pre></td></tr></table></figure>\n<p>æˆ–è€…æŠŠä¸€ç§é›†åˆç±»å‹è½¬æˆ <code>stream</code> ï¼Œç„¶ååšä¸€äº›èšåˆæ“ä½œ</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;Integer&gt; collect = list.stream()</span><br><span class=\"line\">        .map(item -&gt; item + <span class=\"number\">5</span>)</span><br><span class=\"line\">        .filter(item -&gt; item &gt; <span class=\"number\">10</span>)</span><br><span class=\"line\">        .sorted()</span><br><span class=\"line\">        .limit(<span class=\"number\">10</span>)</span><br><span class=\"line\">        .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>\n<p>é‚£åœ¨ <code>jdk1.7</code>  åŠä»¥å‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// éå†listï¼Œæ‰€æœ‰å…ƒç´ +5</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class=\"line\">    Integer integer = list.get(i);</span><br><span class=\"line\">    integer += <span class=\"number\">5</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ­£åºæ’åº</span></span><br><span class=\"line\">sort(list);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// åˆ›å»ºæ–°List.å­˜å‚¨10ä¸ªå…ƒç´ </span></span><br><span class=\"line\">List&lt;Integer&gt; newList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\"><span class=\"keyword\">if</span> (list.size() &gt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">    System.arraycopy(list, list.size() - <span class=\"number\">11</span>, newList, <span class=\"number\">0</span>, <span class=\"number\">10</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    System.arraycopy(list, <span class=\"number\">0</span>, newList, <span class=\"number\">0</span>, list.size());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ ¹æ®ä¸Šé¢çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬å¾ˆæ˜æ˜¾çš„å°±èƒ½å¯¹æ¯”å‡ºæ¥ï¼š<br>\n <code>stream</code>  çš„ç¼–ç æ–¹å¼ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ï¼Œå¯è¯»æ€§ä¹Ÿæ¯”è¾ƒå¼ºã€‚è€Œä¸” <code>Stream</code>  æä¾›äº†é›†åˆçš„å¸¸ç”¨æ“ä½œï¼Œæ¯”å¦‚ <code>sort</code> , <code>è¿‡æ»¤</code> ï¼Œ <code>å»é‡</code> ï¼Œ <code>è®¡æ•°</code> ï¼Œ <code>limit</code> , <code>skip</code>  ç­‰ç­‰ï¼Œç›´æ¥å¯ä»¥ç”¨ï¼Œå¯ä»¥å¤§å¤§çš„æé«˜å¼€å‘æ•ˆç‡ã€‚</p>\n<p>é‚£  <code>Stream</code>  ä¸ºæˆ‘ä»¬æä¾›äº†å¤šå°‘åŠŸèƒ½å‘¢ï¼Ÿ</p>\n<p>ä»å…¨å±€æ¥çœ‹ï¼Œæ‰€æœ‰å’Œ  <code>stream</code>  ç›¸å…³çš„ç±»ï¼Œéƒ½åœ¨  <code>java.lang.stream</code>  è¿™åŒ…ä¸‹ã€‚</p>\n<p>è¿™ä¸ªåŒ…ä¸‹æœ‰å¾ˆå¤šçš„ç±»ã€‚æ€»ä½“æ¥è¯´ï¼Œ</p>\n<p>æµå¤„ç†ç›¸å…³çš„æ“ä½œåˆ†ä¸ºä¸¤ç±»:</p>\n<ul>\n<li>ä¸­é—´æ“ä½œ ( <code>Intermediate Operations</code> )\n<ul>\n<li>æ— çŠ¶æ€çš„ä¸­é—´æ“ä½œ ( <code>Stateless</code> ): ä½¿ç”¨  <code>StatelessOp</code>  è¡¨ç¤ºã€‚æ¯ä¸ªæ“ä½œéƒ½æ˜¯äº’ä¸å½±å“ï¼Œä¸ä¾èµ–çš„ã€‚è¿™ç±»çš„æ“ä½œæœ‰:  <code>filter()</code> ã€ <code>flatMap()</code> ã€ <code>flatMapToDouble()</code> ã€ <code>flatMapToInt()</code> ã€ <code>flatMapToLong()</code> ã€ <code>map()</code> ã€ <code>mapToDouble()</code> ã€ <code>mapToInt()</code> ã€ <code>mapToLong()</code> ã€ <code>peek()</code> ã€ <code>unordered()</code>  ç­‰</li>\n<li>æœ‰çŠ¶æ€æ“ä½œï¼ˆ <code>Stateful</code> ï¼‰ï¼šä½¿ç”¨  <code>StatefulOp</code>  è¡¨ç¤ºã€‚å¤„ç†æ—¶ä¼šè®°å½•çŠ¶æ€ï¼Œæ¯”å¦‚å¤„ç†äº†å‡ ä¸ªã€‚åé¢å…ƒç´ çš„å¤„ç†ä¼šä¾èµ–å‰é¢è®°å½•çš„çŠ¶æ€ï¼Œæˆ–è€…æ‹¿åˆ°æ‰€æœ‰å…ƒç´ æ‰èƒ½ç»§ç»­ä¸‹å»ã€‚å¦‚ <code>distinct()</code> ã€ <code>sorted()</code> ã€ <code>sorted(comparator)</code> ã€ <code>limit()</code> ã€ <code>skip()</code>  ç­‰</li>\n</ul>\n</li>\n<li>ç»ˆæ­¢æ“ä½œ ( <code>Terminal Operations</code> )ï¼šä½¿ç”¨  <code>TerminalOp</code>  è¡¨ç¤ºã€‚\n<ul>\n<li>éçŸ­è·¯æ“ä½œï¼šå¤„ç†å®Œæ‰€æœ‰æ•°æ®æ‰èƒ½å¾—åˆ°ç»“æœã€‚å¦‚ <code>collect()</code> ã€ <code>count()</code> ã€ <code>forEach()</code> ã€ <code>forEachOrdered()</code> ã€ <code>max()</code> ã€ <code>min()</code> ã€ <code>reduce()</code> ã€ <code>toArray()</code>  ç­‰ã€‚</li>\n<li>çŸ­è·¯ï¼ˆ <code>short-circuiting</code> ï¼‰æ“ä½œï¼šæ‹¿åˆ°ç¬¦åˆé¢„æœŸçš„ç»“æœå°±ä¼šåœä¸‹æ¥ï¼Œä¸ä¸€å®šä¼šå¤„ç†å®Œæ‰€æœ‰æ•°æ®ã€‚å¦‚ <code>anyMatch()</code> ã€ <code>allMatch()</code> ã€ <code>noneMatch()</code> ã€ <code>findFirst()</code> ã€ <code>findAny()</code>  ç­‰ã€‚</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨æ·±å…¥æ¢è®¨ <code>stream</code>  ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‚¨å¤‡äº›çŸ¥è¯†ç‚¹ã€‚</p>\n<ul>\n<li>\n<p>å‡½æ•°å¼æ¥å£  <code>FunctionInterface</code></p>\n<p><code>JDK</code>  æä¾›äº†å¾ˆå¤šçš„å‡½æ•°å¼æ¥å£ï¼ŒåŒ…è·¯å¾„æ˜¯ï¼š <code>java.util.function</code> . å‡½æ•°å¼æ¥å£çš„ä½œç”¨æ˜¯ Java8 å¯¹ä¸€ç±»ç‰¹å®šç±»å‹æ¥å£çš„ç§°å‘¼ã€‚è¿™ç±»æ¥å£åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨  <code>@FunctionInterface</code>  æ³¨è§£è¿›è¡Œæ³¨æ˜ã€‚åœ¨ <code>Java Lambda</code>  çš„å®ç°ä¸­ï¼Œ å¼€å‘ç»„ä¸æƒ³å†ä¸º <code>Lambda</code>  è¡¨è¾¾å¼å•ç‹¬å®šä¹‰ä¸€ç§ç‰¹æ®Šçš„ <code>Structural</code>  å‡½æ•°ç±»å‹ï¼Œç§°ä¹‹ä¸ºç®­å¤´ç±»å‹ï¼ˆ <code>arrow type</code> ï¼‰ï¼Œ ä¾ç„¶æƒ³é‡‡ç”¨ Java æ—¢æœ‰çš„ç±»å‹ç³»ç»Ÿ ( <code>class</code> ,  <code>interface</code> ,  <code>method</code>  ç­‰)ï¼Œ åŸå› æ˜¯å¢åŠ ä¸€ä¸ªç»“æ„åŒ–çš„å‡½æ•°ç±»å‹ä¼šå¢åŠ å‡½æ•°ç±»å‹çš„å¤æ‚æ€§ï¼Œç ´åæ—¢æœ‰çš„ <code>Java</code>  ç±»å‹ï¼Œå¹¶å¯¹æˆåƒä¸Šä¸‡çš„ <code>Java</code>  ç±»åº“é€ æˆä¸¥é‡çš„å½±å“ã€‚ æƒè¡¡åˆ©å¼Šï¼Œ å› æ­¤æœ€ç»ˆè¿˜æ˜¯åˆ©ç”¨ <code>SAM</code>  æ¥å£ ( <code>Single Abstract Method</code> ) ä½œä¸º  <code>Lambda</code>  è¡¨è¾¾å¼çš„ç›®æ ‡ç±»å‹ã€‚</p>\n<p>å‡½æ•°å¼æ¥å£å…¶å®åœ¨ <code>Jdk8</code>  ä¹‹å‰å°±å·²å­˜åœ¨äº†ï¼Œæ¯”å¦‚ <code>java.lang.Runnable</code> , <code>java.util.concurrent.Callable</code> , <code>java.util.Comparator</code>  ç­‰ç­‰ã€‚åªæ˜¯æ²¡æœ‰ä½¿ç”¨  <code>@FunctionInterface</code>  æ³¨è§£è€Œå·²ã€‚åœ¨ <code>JDK1.8</code>  ä¹‹ååŠ ä¸Šäº†è¿™ä¸ªæ³¨è§£ï¼Œå¹¶ä¸”åœ¨ <code>java.util.function</code>  åŒ…ä¸‹æ–°å¢å¾ˆå¤šä¸ªå‡½æ•°å¼æ¥å£ã€‚ å…¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„åªæœ‰å…­ä¸ª:</p>\n<ul>\n<li><code>Predicate</code> : ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ª <code>bool</code>  ç»“æœï¼Œ æ–¹æ³•ä¸º <code>boolean test(T t)</code></li>\n<li><code>Consumer</code> : ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œæ— è¿”å›å€¼ï¼Œçº¯æ¶ˆè´¹ã€‚ æ–¹æ³•ä¸º <code>void accept(T t)</code></li>\n<li><code>Function&lt;T,R&gt;</code> : ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼Œæ–¹æ³•ä¸º <code>R apply(T t)</code></li>\n<li><code>Supplier</code> : æ— å‚æ•°ä¼ å…¥ï¼Œè¿”å›ä¸€ä¸ªç»“æœï¼Œæ–¹æ³•ä¸º <code>T get()</code></li>\n<li><code>UnaryOperator</code> : ä¸€å…ƒæ“ä½œç¬¦ï¼Œ ç»§æ‰¿ <code>Function&lt;T,T&gt;</code> , ä¼ å…¥å‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒã€‚</li>\n<li><code>BinaryOperator</code> : äºŒå…ƒæ“ä½œç¬¦ï¼Œ ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°çš„ç±»å‹å’Œè¿”å›ç±»å‹ç›¸åŒï¼Œ ç»§æ‰¿ <code>BiFunction&lt;T,T,T&gt;</code></li>\n</ul>\n</li>\n</ul>\n<p>ä¸ºä»€ä¹ˆè¦äº†è§£è¿™ä¸ª å‡½æ•°å¼æ¥å£å‘¢ï¼Ÿ</p>\n<p>å› ä¸º åœ¨ <code>Stream</code>  çš„æ–¹æ³•ä¸­ï¼Œå¤§éƒ¨åˆ†çš„å‚æ•°éƒ½æ˜¯ä½¿ç”¨ å‡½æ•°å¼æ¥å£ æ¥å—å‚æ•°çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¦æ¢ç©¶å…¶å®ç°åŸç†å’Œè®¾è®¡åŸåˆ™çš„è¯ï¼Œè¿™ä¸ªæ˜¯å¿…é¡»è¦çŸ¥é“çš„ã€‚</p>\n<blockquote>\n<p>æ³¨æ„:<br>\n <code>lambda</code>  è¡¨è¾¾å¼ï¼Œæ˜¯ä¸€ç§è¯­æ³•çš„è¡¨ç°å½¢å¼ï¼Œä½¿ä»£ç è¡¨ç°æ›´åŠ æ•´æ´  <code>lambda</code>  å’Œ  <code>stream</code>  æ˜¯ä¸¤ä¸ªä¸ç›¸å…³çš„æ¦‚å¿µã€‚</p>\n</blockquote>\n<h2 id=\"æŸ¥æœ¯ç†-æŸ¥çœ‹æºç æ˜æ™°åŸºæœ¬çš„ç±»ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#æŸ¥æœ¯ç†-æŸ¥çœ‹æºç æ˜æ™°åŸºæœ¬çš„ç±»ç»“æ„\">#</a> æŸ¥ &quot;æœ¯&quot; ç†: (æŸ¥çœ‹æºç ï¼Œæ˜æ™°åŸºæœ¬çš„ç±»ç»“æ„)</h2>\n<p>å…ˆæ¥çœ‹ä¸‹ å’Œ  <code>Stream</code>  ç›´æ¥ç›¸å…³çš„ç±»ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/Stream%E7%B1%BB%E5%9B%BE%E8%B0%B1.png\" alt=\"\"></p>\n<p><code>Stream</code>  æ¥å£ç»§æ‰¿äº† <code>BaseStream</code>  æ¥å£.</p>\n<p><span class=\"label success\">âœ”ï¸ BaseStream æ¥å£è¡¨ç¤ºæµçš„åŸºæœ¬æ¥å£ï¼Œè€Œæµæ˜¯æ”¯æŒé¡ºåºå’Œå¹¶è¡Œèšåˆæ“ä½œçš„å…ƒç´ åºåˆ—ã€‚</span><br>\n <code>Stream</code>  æ¥å£æœ‰å¾ˆå¤šå®ç°ç±»ã€‚å…¶ä¸»è¦çš„ä¸€ä¸ªå®ç°ç±»æ˜¯  <code>ReferencePipeline</code>  ç±»ã€‚é™¤æ­¤ä¹‹å¤– <code>ReferencePipeline</code>  ç±»è¿˜ç»§æ‰¿äº† <code>AbstractPipeline</code>  æŠ½è±¡ç±». <span class=\"label success\">âœ”ï¸ AbstractPipeline è¡¨ç¤º â€œç®¡é“â€ ç±»çš„æŠ½è±¡åŸºç±»ï¼Œå®ƒä»¬æ˜¯ Stream æ¥å£åŠå…¶åŸå§‹ç‰¹åŒ–çš„æ ¸å¿ƒå®ç°ã€‚</span>å†çœ‹ <code>AbstractPipeline</code>  ç±»çš„çˆ¶ç±» <code>PipelineHelper</code> ,<span class=\"label success\">âœ”ï¸ AbstractPipeline çš„ä½œç”¨æ˜¯ï¼šç”¨äºæ‰§è¡Œæµç®¡é“çš„è¾…åŠ©ç±»ï¼Œå°†æœ‰å…³æµç®¡é“çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆè¾“å‡ºå½¢çŠ¶ã€ä¸­é—´æ“ä½œã€æµæ ‡å¿—ã€å¹¶è¡Œåº¦ç­‰ï¼‰é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚</span></p>\n<p><code>ReferencePipeline</code>  ç±»æœ‰ä¸‰ä¸ªå­ç±»:  <code>StatefulOp</code>  è¡¨ç¤ºæœ‰çŠ¶æ€çš„æ“ä½œï¼Œ <code>StatelessOp</code>  è¡¨ç¤ºæ— çŠ¶æ€çš„æ“ä½œï¼Œ  <code>Head</code>  è¡¨ç¤º  <code>ReferencePipeline</code>  çš„èµ·å§‹é˜¶æ®µã€‚ å½“ç„¶äº†ï¼Œè¿™ä¸‰ä¸ªå­ç±»ä¹Ÿæ˜¯ æµã€‚</p>\n<h3 id=\"ä»åˆ›å»ºæµå¼€å§‹\"><a class=\"markdownIt-Anchor\" href=\"#ä»åˆ›å»ºæµå¼€å§‹\">#</a> ä»åˆ›å»ºæµå¼€å§‹</h3>\n<p>ä¸ç®¡æ˜¯ä½¿ç”¨  <code>Stream.of(T t)</code>  è¿˜æ˜¯  <code>Collection.stream()</code> ï¼Œè¿˜æ˜¯ <code>Arrays.stream()</code> , åº•å±‚çš„å®ç°éƒ½æ˜¯é€šè¿‡  <code>StreamSupport.stream()</code>  æ¥å®ç°çš„ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/Stream.of%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0.png\" alt=\"\"></p>\n<p><span class=\"label success\">âœ”ï¸ StreamSupport ç±»çš„ä½œç”¨æ˜¯ï¼šç”¨äºåˆ›å»ºå’Œæ“ä½œæµçš„åº•å±‚å®ç”¨æ–¹æ³•ã€‚</span></p>\n<p><img data-src=\"/images/java/jdk/stream/StreamSupport.stream%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ° ç›´æ¥è¿”å›çš„æ˜¯  <code>ReferencePipeline.Head</code>  å¯¹è±¡ã€‚ é¦–å…ˆ  <code>Head</code>  æ˜¯ä¸€ç§ <code>Stream</code>  çš„å®ç°ã€‚ æ¥ç€å»çœ‹  <code>Head</code>  çš„æ„é€ æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å…¶å®è°ƒç”¨çš„æ˜¯ï¼š <code>AbstractPipeline</code>  çš„æ„é€ æ–¹æ³•.</p>\n<h3 id=\"æµçš„ä¸­é—´æ“ä½œ\"><a class=\"markdownIt-Anchor\" href=\"#æµçš„ä¸­é—´æ“ä½œ\">#</a> æµçš„ä¸­é—´æ“ä½œ</h3>\n<p>æ–‡ä¸­å·²ç»è°ˆåŠäº† ä¸­é—´æ“ä½œåˆ†ä¸ºæœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œå’Œæ— çŠ¶æ€çš„ä¸­é—´æ“ä½œã€‚é‚£æˆ‘ä»¬ä»¥ä¸€ä¸ªæ¡ˆä¾‹æ¥è¯´æ˜æ“ä½œä¸æ“ä½œä¹‹é—´æ‰§è¡Œçš„ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;Integer&gt; numbers = Stream.of(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\">          .map(item -&gt; item + <span class=\"number\">5</span>)</span><br><span class=\"line\">          .sorted((n1, n2) -&gt; n2 - n1)</span><br><span class=\"line\">          .limit(<span class=\"number\">3</span>)</span><br><span class=\"line\">          .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>\n<p><code>Stream.of()</code>  æ–¹æ³•ä¸Šæ–‡å·²ç»ç®€å•çš„è¯´æ˜äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹  <code>map()</code>  æ–¹æ³•ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/Stream.map%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œ <code>map()</code>  è¿”å›äº†ä¸€ä¸ª <code>StatelessOp</code>  å¯¹è±¡ï¼Œå¹¶ä¸”é‡å†™äº† <code>AbstractPipeline</code>  çš„ <code>opWrapSink</code>  æ–¹æ³•ã€‚ ä¹‹å‰ä¹Ÿè¯´è¿‡ï¼šå®ƒè¡¨ç¤ºæµçš„æ— çŠ¶æ€ä¸­é—´é˜¶æ®µçš„åŸºç±»ã€‚ è¿˜æœ‰ä¸€ä¸ª <code>Sink</code>  ç±»å‹.  <code>Sink</code>  ç±»è¡¨ç¤º  <code>Consumer</code>  æ¥å£çš„æ‰©å±•ï¼Œç”¨äºåœ¨æµç®¡é“çš„å„ä¸ªé˜¶æ®µä¼ é€’å€¼ï¼Œä»¥åŠç®¡ç†å¤§å°ä¿¡æ¯ã€æ§åˆ¶æµç­‰çš„é™„åŠ æ–¹æ³•ã€‚</p>\n<p>æˆ‘ä»¬å†ä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚é¦–å…ˆè¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•çš„è®¡ç®—ï¼Œåªæ˜¯å°†  <code>item -&gt; item + 5</code>  è¿™ä¸ªæ“ä½œè¿›è¡Œä¸‰å±‚çš„å°è£…ï¼Œ 1. å°† <code>map</code>  æ–¹æ³•çš„è¿”å›å€¼é‡æ–°å°è£…æˆäº†æµå¯¹è±¡ï¼Œ2. æŠŠæˆ‘ä»¬çš„ <code>item -&gt; item + 5</code>  è¿™ä¸ªæ“ä½œå°è£…æˆäº†  <code>StatelessOp</code> ï¼Œ å¹¶é‡å†™äº† <code>opWrapSink</code>  è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶åœ¨ç»ˆæ­¢æ“ä½œæ—¶è¿›è¡Œè°ƒç”¨ã€‚ 3. ä½¿ç”¨ <code>sink</code> ( <code>Sink.ChainedReference)</code>  å°†ç®¡é“çš„å„ä¸ªé˜¶æ®µè¿æ¥èµ·æ¥ã€‚å³èµ‹å€¼ <code>downStream</code> . ä½¿ç”¨ <code>downstream</code>  è¿™ä¸ª <code>Consumer</code>  å®Œæˆ <code>accept</code>  è°ƒç”¨ã€‚</p>\n<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹:  <code>StatelessOp</code>  ç±»çš„æ„é€ æ–¹æ³•çš„å®ä½“å‚ä¼ è¾“äº†ä¸€ä¸ª  <code>this</code>  å­—æ®µã€‚ä»”ç»†ç¿»çœ‹æºç å°±ä¼šè¿”ç°å®ƒä¸€ç›´è°ƒç”¨åˆ°  <code>AbstractPipeline</code>  çš„æ„é€ æ–¹æ³•ä¸­ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/AbstractPipeline.png\" alt=\"\"></p>\n<p>å¯ä»¥çœ‹åˆ°  <code>AbstractPipeline</code>  ä¸­æœ‰ä¸¤ä¸ªå­—æ®µ  <code>nextStage</code>  å’Œ  <code>previousStage</code>  å­—æ®µï¼Œåˆ†åˆ«è¡¨ç¤ºçš„æ˜¯ä¸Šä¸€é˜¶æ®µå’Œä¸‹ä¸€é˜¶æ®µã€‚å…¶ä¸­  <code>nextStage</code>  æ˜¯ å½“å‰é˜¶æ®µã€‚  <code>previousStage</code>  åˆ™åº”è¯¥ å½“å‰é˜¶æ®µçš„ä¸Šä¸€ä¸ªé˜¶æ®µï¼Œå…¶å®å°±æ˜¯è°ƒç”¨å½“å‰æ–¹æ³•çš„å¯¹è±¡ã€‚</p>\n<p>ä¸çŸ¥é“ä½ æ˜¯å¦å‘ç° é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œ <code>stream</code>  ç»„æˆäº†ä¸€ä¸ª æµå„ä¸ªé˜¶æ®µçš„åŒå‘é“¾è¡¨ã€‚èŠ‚ç‚¹å°±æ˜¯æµæ“ä½œçš„å„ä¸ªé˜¶æ®µã€‚</p>\n<p>ps: è¿™æ ·ä¸€æ¬¡æµæ“ä½œä¼šåˆ›å»ºä¸¤ä¸ªé“¾è¡¨:  <code>Stream</code>  é˜¶æ®µçš„åŒå‘é“¾è¡¨ï¼Œå’Œ åœ¨ç»ˆæ­¢æ“ä½œæ—¶ï¼Œæ ¹æ®åŒå‘é“¾è¡¨ç”Ÿæˆçš„  <code>Sink</code>  é“¾è¡¨ã€‚</p>\n<p>å†æ¬¡è¯´æ˜ï¼šåˆ°ç›®å‰ä¸ºæ­¢ï¼Œ <code>map()</code>  æ–¹æ³•é‡Œåªæ˜¯è¿›è¡Œäº†å°è£…ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•è®¡ç®—ï¼</p>\n<p>æ¥ç€æ¥çœ‹  <code>sorted()</code>  æ–¹æ³•ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/stream.sorted%E6%96%B9%E6%B3%95.png\" alt=\"\"></p>\n<p><code>sorted</code>  æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡è°ƒç”¨ <code>SortedOps</code>  ç±»çš„ <code>makeRef</code>  æ–¹æ³•ï¼Œåˆ›å»ºäº† <code>OfRef</code>  å¯¹è±¡ã€‚  <code>OfRef</code>  ç±»çš„ä½œç”¨æ˜¯ï¼šç”¨äºå¯¹æµè¿›è¡Œæ’åºçš„ä¸“ç”¨å­ç±»å‹ã€‚  <code>OfRef</code>  ç±»ç»§æ‰¿äº†  <code>ReferencePipeline.StatefulOp</code>  ï¼Œæ‰€ä»¥ <code>OfRef</code>  æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€æ“ä½œã€‚é‚£è‡ªç„¶å®ƒä¹Ÿä¼šæœ‰  <code>opWrapSink</code>  æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒä¹Ÿä¼šè¿”å›ä¸€ä¸ª Sink å¯¹è±¡ï¼Œåªæ˜¯è¿™ä¸ª <code>Sink</code>  å¯¹è±¡çš„å®ç°ç±»ä¸ä¸€æ ·çš„ã€‚</p>\n<blockquote>\n<p>è¯´æ˜ï¼šåˆ°ç›®å‰ä¸ºæ­¢ï¼Œ <code>sorted()</code>  æ–¹æ³•é‡Œåªæ˜¯è¿›è¡Œäº†å°è£…ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•è®¡ç®—ï¼</p>\n</blockquote>\n<p>åŒç†å»çœ‹ <code>limit</code>  æ–¹æ³•ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/Stream.limit%E6%96%B9%E6%B3%95.png\" alt=\"\"></p>\n<p>è¿™ä¸ªæ–¹æ³•çš„å†…éƒ¨æ˜¯ç›´æ¥åˆ›å»ºäº†ä¸€ä¸ª  <code>ReferencePipeline.StatefulOp</code>  å¯¹è±¡ï¼Œä¹Ÿæ˜¯é‡å†™äº†å…¶ä¸­çš„æ–¹æ³•:  <code>opWrapSink</code> .</p>\n<p>ä¸çŸ¥é“ä½ æ˜¯å¦æœ‰å¥½å¥‡ï¼Œæˆ‘ä¸ºä»€ä¹ˆæ¯æ¬¡éƒ½ä¼šæåˆ°  <code>opWrapSink</code>  è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªæ–¹æ³•éå¸¸çš„é‡è¦ï¼å…¶é‡è¦æ€§æˆ‘ä»¬åœ¨ <a href=\"#%E6%8E%A2%E2%80%9D%E6%B3%95%E2%80%9C%E6%8B%A9\">æ¢â€ æ³• â€œæ‹©</a> è¿™éƒ¨åˆ†ä¼šå®Œæ•´çš„è¯´æ˜ã€‚</p>\n<blockquote>\n<p>å†ä¸‰è¯´æ˜ï¼šåˆ°ç›®å‰ä¸ºæ­¢ï¼Œ <code>limit()</code>  æ–¹æ³•é‡Œåªæ˜¯è¿›è¡Œäº†å°è£…ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•è®¡ç®—ï¼</p>\n</blockquote>\n<p>ä¹¦è¡Œè‡³æ­¤ï¼Œæ¡ˆä¾‹ä¸­çš„ä¸­é—´æ“ä½œéƒ½å·²ç»ç®€å•çš„åˆ†æå®Œæˆäº†ã€‚æˆ‘ä»¬å°±çŸ¥é“è¿™é‡Œ  <code>jdk</code>  ä¸ºäº†å®Œæˆ æµæ“ä½œä¸ºæ¯ä¸ªä¸­é—´æ“ä½œéƒ½å°è£…äº†å¾ˆå¤šçš„å¯¹è±¡ï¼Œè€Œè¿™äº›å¯¹è±¡åªæ˜¯æ•£åˆ—åœ¨äº†å†…å­˜ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œå°±è¦çœ‹  <code>jdk</code>  æ˜¯å¦‚ä½•æŠŠä»–ä»¬ç»„è£…åˆ°ä¸€èµ·çš„ã€‚</p>\n<h3 id=\"ç»ˆæ­¢æ“ä½œ\"><a class=\"markdownIt-Anchor\" href=\"#ç»ˆæ­¢æ“ä½œ\">#</a> ç»ˆæ­¢æ“ä½œ</h3>\n<p>ä»¥ <code>Collect</code>  æ–¹æ³•ä¸ºä¾‹ï¼Œå»æ¢ç©¶ä¸€ä¸‹ç»ˆæ­¢æ“ä½œçš„æµç¨‹ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/Stream.collect%E6%96%B9%E6%B3%95.png\" alt=\"\"><br>\nå¯ä»¥çœ‹åˆ°åœ¨ <code>collect</code>  æ–¹æ³•ä¸­ï¼Œåˆ†ä¸ºå¹¶è¡Œæ‰§è¡Œæ–¹å¼å’Œä¸²è¡Œæ‰§è¡Œæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹ä¸²è¡Œæ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»º  <code>ReduceOps</code>  ç»ˆæ­¢æ“ä½œå¯¹è±¡ã€‚<br>\n<img data-src=\"/images/java/jdk/stream/AbstractPipeline.evaluate%E6%96%B9%E6%B3%95.png\" alt=\"\"></p>\n<p>å°† ç»ˆæ­¢æ“ä½œ ä¼ é€’ç»™ evaluate æ–¹æ³•ï¼Œç„¶åè°ƒç”¨ç»ˆæ­¢æ“ä½œçš„ evaluate æ–¹æ³•ï¼Œå½“ç„¶è¿™ä¸ªæ–¹æ³•ä¹Ÿåˆ†æˆäº†ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œä¸¤ç§ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/ReduceOps.evaluateSequential%E6%96%B9%E6%B3%95.png\" alt=\"\"></p>\n<p><code>helper</code>  å…¶å®æ˜¯  <code>limit(3)</code>  ä¸­é—´æ“ä½œè¿”å›çš„å¯¹è±¡ã€‚è¿™å…¶å®ä¸­é—´æ“ä½œçš„æœ€åä¸€ä¸ª <code>Stage</code>  (é˜¶æ®µ)ã€‚è¿”å›çš„å¯¹è±¡æ˜¯ <code>AbstractPipeline</code>  å’Œ  <code>Stream</code>  çš„å­ç±»å®ä¾‹ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/AbstractPipeline.wrapAndCopyInfo%E6%96%B9%E6%B3%95.png\" alt=\"\"></p>\n<p>è¿™é‡ŒåŒ…å«ä¸¤ä¸ªæ–¹æ³•:  <code>wrapSink()</code>  å’Œ  <code>copyInfo()</code> .</p>\n<p>è¿™æ˜¯ä¸¤ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•.  <code>wrapSink()</code>  æ˜¯å°†ä¸­é—´çš„æ“ä½œç»„æˆ  <code>SinkChain</code>  ã€‚  <code>copyInfo()</code>  è¿™æ˜¯æ‰§è¡ŒçœŸæ­£çš„è®¡ç®—é€»è¾‘ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/AbstractPipeline.wrapSink%E6%96%B9%E6%B3%95.png\" alt=\"\"></p>\n<p>æ–¹æ³•ä¸­çš„å½¢å‚  <code>sink</code>  å°±æ˜¯æœ€åçš„é˜¶æ®µçš„ç»ˆæ­¢æ“ä½œã€‚æ–¹æ³•é€šè¿‡å¾ªç¯å°†  <code>sink</code>  åˆ†è£…åˆ° <code>Sink</code>  ä¸­ã€‚  <code>Sink</code>  æ¥å£ çš„ä¸€ä¸ªå®ç°ç±»æ˜¯  <code>ChainedReference</code>  ï¼Œ ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ª  <code>downStream</code>  å­—æ®µã€‚ ä¼šå°† <code>sink = p.opWrapSink(p.previousStage.combinedFlags, sink);</code>   ä¸­çš„  <code>sink</code>  èµ‹å€¼ç»™  <code>downStream</code> . è¿™æ ·å°±å½¢æˆäº† <b>å¥—å¨ƒ</b>ã€‚ æœ€åè¿”å›ä¸€ä¸ª  <code>wrapSink</code>  , å³æ•´ä¸ªæµæ“ä½œä¸­æ‰€æœ‰çš„æ“ä½œçš„ å°è£… <code>Sink</code> .</p>\n<p><img data-src=\"/images/java/jdk/stream/AbstractPipeline.copyInfo%E6%96%B9%E6%B3%95.png\" alt=\"\"></p>\n<p>å›¾ä¸­æ‰€ç¤ºçš„å³ä¸ºä¸Šé¢æåŠçš„ å°è£… <code>Sink</code> . å¯ä¸­æ–­å’Œä¸å¯ä¸­æ–­çš„åŒºåˆ«æ˜¯ï¼šå¯ä¸­æ–­å¦‚æœè·å–å€¼ï¼Œå°±ä¸å¿…å†å–æ‰€æœ‰çš„ç»“æœäº†ã€‚åä¹‹ï¼Œå°±éœ€è¦è®¡ç®—å‡ºæ‰€æœ‰é˜¶æ®µçš„ç»“æœã€‚</p>\n<p>éå¯ä¸­æ–­çš„ç»ˆæ­¢æ“ä½œæ—¶ï¼Œä¼šæ‰§è¡Œ  <code>begin()</code> , <code>forEachRemaining()</code> , <code>end()</code> , ä¸‰ä¸ªæ–¹æ³•ã€‚  è¿™ä¸ªä¸‰ä¸ªæ–¹æ³•å¯¹åº”çš„æ˜¯ï¼š <code>Sink</code>  æ¥å£ä¸­æä¾›çš„ä¸‰ä¸ªæ–¹æ³•ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ¯ä¸ªSinkå¼€å§‹ä¹‹å‰è°ƒç”¨è¯¥æ–¹æ³•ï¼Œé€šçŸ¥sinkåšå¥½å‡†å¤‡</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">begin</span><span class=\"params\">(<span class=\"keyword\">long</span> size)</span> </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"comment\">// éå†å…ƒç´ æ—¶ä½¿ç”¨ï¼Œæ¥å—ä¸€ä¸ªå¾…å¤„ç†å…ƒç´ ï¼Œå¹¶å¯¹å…ƒç´ è¿›è¡Œå¤„ç†ã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">accept</span><span class=\"params\">(Double i)</span></span>;</span><br><span class=\"line\"><span class=\"comment\">// é€šçŸ¥sinkæ²¡æœ‰å…ƒç´ è¿›è¡Œå¤„ç†äº†ã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">end</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>å…¶ä¸­ï¼Œ</p>\n<ul>\n<li><code>begin()</code>  æ–¹æ³•ï¼Œä¼šè°ƒç”¨æ¯ä¸ª <code>Sink</code>  å­ç±»çš„ <code>begin</code>  æ–¹æ³•ã€‚</li>\n<li><code>forEachRemaining()</code>  æ–¹æ³•å¯¹åº”çš„æ‰§è¡Œå†…å®¹å¦‚ä¸‹å›¾:<br>\n<img data-src=\"/images/java/jdk/stream/forEachRemaining%E6%96%B9%E6%B3%95.png\" alt=\"\"></li>\n<li><code>end()</code>  æ–¹æ³•ï¼Œä¼šè°ƒç”¨æ¯ä¸ª <code>Sink</code>  å­—æ®µçš„ <code>end</code>  æ–¹æ³•ã€‚</li>\n</ul>\n<p>ä¹¦è¡Œè‡³æ­¤ã€‚æˆ–è®¸ä½ ä¼šå¯¹  <code>forEachRemaining</code>  æ–¹æ³•æ„Ÿåˆ°å¥½å¥‡ã€‚åé¢æˆ‘ä¼šå†™ä¸€ç¯‡æ–‡ç« æ¥ä¸“é—¨åˆ†äº«: ã€Š <code>Stream</code>  çš„é«˜çº§è¿­ä»£å™¨ã€‹, å¸Œæœ›ä½ èƒ½ç»§ç»­å…³æ³¨æ”¯æŒæˆ‘ï½</p>\n<h2 id=\"æ¢æ³•æ‹©\"><a class=\"markdownIt-Anchor\" href=\"#æ¢æ³•æ‹©\">#</a> æ¢â€ æ³• â€œæ‹©</h2>\n<p>æˆ‘ä»¬ä»ä¸€ä¸ªæ¡ˆä¾‹å‡ºå‘ï¼Œåœ¨ç»†èŠ‚ä¹‹å¤„åˆ†æäº†ä¸€ä¸ª <code>Stream</code>  çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä»å…¨å±€æ¥çœ‹ä¸€ä¸‹  <code>Stream</code>  çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·å­çš„.</p>\n<p>ä¸Šæ–‡ä¸­æˆ‘ä»¬çŸ¥é“äº†  <code>Stream</code>  çš„ æ‰€æœ‰è®¡ç®—éƒ½æ˜¯åœ¨ ç»ˆæ­¢æ“ä½œæ—¶ è§¦å‘çš„ã€‚ æ‰€æœ‰çš„ä¸­é—´æ“ä½œéƒ½æ˜¯å°è£…äº†ä¸€äº›å¯¹è±¡ã€‚æˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥æè¿°ä¸‹ <code>Stream</code>  çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>\n<p><img data-src=\"/images/java/jdk/stream/Stream%E9%80%BB%E8%BE%91%E6%B5%81%E7%A8%8B%E5%9B%BE.png\" alt=\"\"></p>\n<ul>\n<li><code>stream</code>  å°†åˆ›å»ºçš„æµåšä¸ºç¬¬ä¸€ä¸ª  <code>Stage</code>  , ç”¨æ¥ä»£è¡¨æµçš„å¼€å§‹ï¼Œ æ¯ä¸ª <code>Stage</code>  éƒ½æ˜¯ <code>AbstractPipeline</code>  çš„å­ç±»ã€‚ ç¬¬ä¸€ä¸ª <code>Stage</code>  æ˜¯ <code>AbstractPipeline.Head</code>  å¯¹è±¡ã€‚</li>\n<li>ç„¶åå°†ä¸­é—´æ“ä½œå°è£…æˆåé¢çš„ n ä¸ª  <code>stage</code> . å¹¶ç»„æˆ åŒå‘é“¾è¡¨çš„å½¢å¼ï¼Œå¹¶ä¸”å­˜å‚¨äº† <code>stage0</code> . æ¯ä¸ª <code>Stage</code>  éƒ½æ˜¯ <code>StatelessOp</code>  æˆ–è€…  <code>statefulOp</code> .</li>\n<li>ç»ˆæ­¢æ“ä½œé€šè¿‡ <code>wrapSink()</code>  æ–¹æ³• ä¼šè§¦å‘å°† æ¯ä¸ªé˜¶æ®µçš„æ“ä½œå°è£…æˆ  <code>Sink</code> . å¹¶ä¸” <code>sink</code>  éƒ½ä¼šåšä¸ºå‚æ•°ä¼ é€’åˆ°ä¸Šä¸€ä¸ªé˜¶æ®µçš„ <code>opWrapSink()</code>  æ–¹æ³•ä¸­ï¼Œä»è€Œç»„æˆä¸€ä¸ª  <code>sink</code>  é“¾è¡¨ã€‚</li>\n<li>ç„¶åï¼Œé€šè¿‡  <code>copyInfo()</code>  æ–¹æ³•å°†ï¼Œäº¤äº <code>Spilterator</code>  è¿›è¡Œè¿­ä»£ã€‚è®¡ç®—çš„ç»“æœå¯ä»¥åˆ†ä¸ºå››ç§\n<ul>\n<li>è¿”å› <code>boolean</code>  ç±»å‹çš„ç»“æœï¼šæ¯”å¦‚ <code>anyMatch()</code>   <code>allMatch()</code>   <code>noneMatch()</code>  æ–¹æ³•ã€‚</li>\n<li>è¿”å› <code>Optional</code>  ç±»å‹çš„ç»“æœï¼š æ¯”å¦‚ <code>findFirst()</code>   <code>findAny()</code>  æ–¹æ³•</li>\n<li>è¿˜æœ‰å½’çº¦æ“ä½œ:\t <code>reduce()</code>   <code>collect()</code></li>\n<li>è¿”å›æ•°ç»„çš„ï¼š <code>toArray()</code> <br>\n å¯¹äºè¡¨ä¸­è¿”å› <code>boolean</code>  æˆ–è€… <code>Optional</code>  çš„æ“ä½œï¼ˆ <code>Optional</code>  æ˜¯å­˜æ”¾ ä¸€ä¸ª å€¼çš„å®¹å™¨ï¼‰çš„æ“ä½œï¼Œç”±äºå€¼è¿”å›ä¸€ä¸ªå€¼ï¼Œåªéœ€è¦åœ¨å¯¹åº”çš„ <code>Sink</code>  ä¸­è®°å½•è¿™ä¸ªå€¼ï¼Œç­‰åˆ°æ‰§è¡Œç»“æŸæ—¶è¿”å›å°±å¯ä»¥äº†ã€‚<br>\nå¯¹äºå½’çº¦æ“ä½œï¼Œæœ€ç»ˆç»“æœæ”¾åœ¨ç”¨æˆ·è°ƒç”¨æ—¶æŒ‡å®šçš„å®¹å™¨ä¸­ï¼ˆå®¹å™¨ç±»å‹é€šè¿‡æ”¶é›†å™¨æŒ‡å®šï¼‰ã€‚ <code>collect()</code> ,  <code>reduce()</code> ,  <code>max()</code> ,  <code>min()</code>  éƒ½æ˜¯å½’çº¦æ“ä½œï¼Œè™½ç„¶ <code>max()</code>  å’Œ <code>min()</code>  ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ª <code>Optional</code> ï¼Œä½†äº‹å®ä¸Šåº•å±‚æ˜¯é€šè¿‡è°ƒç”¨ <code>reduce()</code>  æ–¹æ³•å®ç°çš„ã€‚<br>\nå¯¹äºè¿”å›æ˜¯æ•°ç»„çš„æƒ…å†µï¼Œæ¯«æ— ç–‘é—®çš„ç»“æœä¼šæ”¾åœ¨æ•°ç»„å½“ä¸­ã€‚è¿™ä¹ˆè¯´å½“ç„¶æ˜¯å¯¹çš„ï¼Œä½†åœ¨æœ€ç»ˆè¿”å›æ•°ç»„ä¹‹å‰ï¼Œç»“æœå…¶å®æ˜¯å­˜å‚¨åœ¨ä¸€ç§å«åš <code>Node</code>  çš„æ•°æ®ç»“æ„ä¸­çš„ã€‚ <code>Node</code>  æ˜¯ä¸€ç§å¤šå‰æ ‘ç»“æ„ï¼Œå…ƒç´ å­˜å‚¨åœ¨æ ‘çš„å¶å­å½“ä¸­ï¼Œå¹¶ä¸”ä¸€ä¸ªå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾å¤šä¸ªå…ƒç´ ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å¹¶è¡Œæ‰§è¡Œæ–¹ä¾¿ã€‚å…³äº  <code>Stream</code>  çš„å¹¶è¡Œè®¡ç®—ï¼Œæˆ‘åé¢ä¼šç»§ç»­åˆ†äº«ã€‚</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ˜é“ä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#æ˜é“ä¹‰\">#</a> æ˜ &quot;é“&quot; ä¹‰</h2>\n<p><code>JDK</code>  æä¾›çš„  <code>Stream</code>  å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹:</p>\n<ul>\n<li>æ— å­˜å‚¨ã€‚ <code>stream</code>  ä¸æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒåªæ˜¯æŸç§æ•°æ®æºçš„ä¸€ä¸ªè§†å›¾ï¼Œæ•°æ®æºå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ <code>Java</code>  å®¹å™¨æˆ– <code>I/O channel</code>  ç­‰ã€‚</li>\n<li>ä¸ºå‡½æ•°å¼ç¼–ç¨‹è€Œç”Ÿã€‚å¯¹ <code>stream</code>  çš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šä¿®æ”¹èƒŒåçš„æ•°æ®æºï¼Œæ¯”å¦‚å¯¹ <code>stream</code>  æ‰§è¡Œè¿‡æ»¤æ“ä½œå¹¶ä¸ä¼šåˆ é™¤è¢«è¿‡æ»¤çš„å…ƒç´ ï¼Œè€Œæ˜¯ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒ…å«è¢«è¿‡æ»¤å…ƒç´ çš„æ–° <code>stream</code> ã€‚</li>\n<li>æƒ°å¼æ‰§è¡Œã€‚ <code>stream</code>  ä¸Šçš„æ“ä½œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæœ‰ç­‰åˆ°ç”¨æˆ·çœŸæ­£éœ€è¦ç»“æœçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚</li>\n<li>å¯æ¶ˆè´¹æ€§ã€‚ <code>stream</code>  åªèƒ½è¢« â€œæ¶ˆè´¹â€ ä¸€æ¬¡ï¼Œä¸€æ—¦éå†è¿‡å°±ä¼šå¤±æ•ˆï¼Œå°±åƒå®¹å™¨çš„è¿­ä»£å™¨é‚£æ ·ï¼Œæƒ³è¦å†æ¬¡éå†å¿…é¡»é‡æ–°ç”Ÿæˆã€‚</li>\n</ul>\n<blockquote>\n<p>åœ¨è¿™ä¸€è¶´ï¼Œæˆ‘å°±å›´ç»•ä¸¤ä¸ªç‚¹æ¥ç®€å•çš„èŠèŠã€‚</p>\n</blockquote>\n<ul>\n<li><code>JDK8</code>  ä¸ºä»€ä¹ˆè¦åŠ å…¥  <code>Stream</code> .</li>\n</ul>\n<p>é™¤äº†ä¸Šé¢å››ä¸ªç‰¹ç‚¹ä¹‹å¤–ï¼Œ <code>Java8</code>  ä¸­çš„ <code>Stream</code>  æ˜¯å¯¹é›†åˆå¯¹è±¡çš„å¢å¼ºï¼Œå½“ç„¶ä¸ä»…ä»…æ˜¯é›†åˆå¯¹è±¡ã€‚ <code>Stream</code>  ä¸ºå¼€å‘è€…æä¾›äº†ç®€æ´çš„ç¼–ç æ–¹å¼å’Œç¼–ç é£æ ¼ï¼Œæå¤§çš„æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚</p>\n<p>å¦å¤–ä¸€ä¸ªæ›´é‡è¦çš„ç‚¹åœ¨äº  <code>Stream</code>  ä¸ºæˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« è¦åˆ†äº«çš„ <b> <code>Stream</code>  å¹¶è¡Œè®¡ç®—æµ</b> æä¾›äº†å®ç°ï¼Œè¯·æœŸå¾…ã€‚</p>\n<ul>\n<li><code>Stream</code>  ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ</li>\n</ul>\n<p>æˆ‘è¿™é‡Œç»™ä¸€ä»½æˆ‘çš„å›ç­”ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿç•™ç»™çœ‹æ–‡ç« çš„ä½ ï¼Œä¹Ÿå¸Œæœ›èƒ½çœ‹åˆ°ä½ çš„å›ç­”ã€‚</p>\n<p>æ ¹æ®ä¸Šæ–‡æ‰€è¯´çš„å†…å®¹ï¼Œ <code>Stream</code>  ä½“ç³»æ˜¯ä¸€ç»„æ¥å£å®¶æ—ï¼Œ <code>AbstractPipeline </code> æ˜¯æ¥å£çš„å®ç°ï¼Œ <code>PipelineHelper</code>  æ˜¯ç®¡é“çš„è¾…åŠ©ç±»ï¼Œ <code>StreamSupport</code>  æ˜¯æµçš„åº•å±‚å·¥å…·ç±»</p>\n<p><code>Stream</code>  ä½¿ç”¨ <code>stage</code>  æ¥æŠ½è±¡æµæ°´çº¿ä¸Šçš„æ¯ä¸ªæ“ä½œï¼Œå…¶å®æ¯ä¸ª <code>stage</code>  å°±æ˜¯ä¸€ä¸ª <code>stream</code>  å­ç±»çš„å®ä¾‹ï¼Œ ä¹Ÿå°±æ˜¯ <code>AbstractPipeline</code>  å‡ ä¸ªå­ç±»çš„å†…éƒ¨å­ç±»å³ <code>Head</code>   <code>StatelessOp</code>   <code>statefulOp</code> ;</p>\n<p><code>StreamSupport</code>  ç”¨äºåˆ›å»ºç”Ÿæˆ <code>Stream</code>  å¯¹åº”çš„æ˜¯ <code>Head</code>  ç±»ï¼Œå…¶ä»–çš„ä¸­é—´æ“ä½œåˆ†ä¸ºæœ‰çŠ¶æ€å’Œæ— çŠ¶æ€çš„ï¼Œä¸­é—´æ“ä½œé€šè¿‡æ–¹æ³•æ¯”å¦‚  <code>filter</code>   <code>map</code>  ç­‰è¿”å›çš„æ˜¯ <code>StatelessOp</code>  æˆ–è€…  <code>statefulOp</code> .  å¤šä¸ª <code>stage</code>  ç»„åˆç§°ä¸ºåŒå‘é“¾è¡¨çš„å½¢å¼ ä»è€Œæˆäº†æ•´ä¸ªæµæ°´çº¿</p>\n<p>æœ‰äº†æµæ°´çº¿ï¼Œç›¸é‚»ä¸¤ä¸ªæ“ä½œé˜¶æ®µä¹‹é—´å¦‚ä½•åè°ƒè¿ç®—ï¼Ÿ</p>\n<p>äºæ˜¯åˆæœ‰äº† <code>Sink</code>  çš„æ¦‚å¿µï¼Œåˆæ¥åè°ƒç›¸é‚»çš„ <code>stage</code>  ä¹‹é—´è®¡ç®—è¿è¡Œ</p>\n<p>ä»–çš„æ¨¡å¼æ˜¯ <code>begin</code>    <code>accept</code>   <code>end</code>  è¿˜æœ‰çŸ­è·¯æ ‡è®°</p>\n<p>ä»–çš„ <code>accept</code>  å°±æ˜¯å°è£…äº†å›è°ƒæ–¹æ³•ï¼Œæ‰€ä»¥è¯´æ¯ä¸ªæ“ä½œ <code>stage</code> ,  <code>StatelessOp</code>   æˆ–è€…  <code>statefulOp</code>  ä¸­åˆå°è£…äº† <code>Sink</code> . é€šè¿‡ <code>AbstractPipeline</code>  æä¾›çš„ <code>opWrapSink</code>  æ–¹æ³•å¯ä»¥è·å–è¿™ä¸ª <code>Sink</code></p>\n<p>è°ƒç”¨è¿™ä¸ª <code>sink</code>  çš„ <code>accept</code>  æ–¹æ³•å°±å¯ä»¥è°ƒç”¨å½“å‰æ“ä½œçš„æ–¹æ³•</p>\n<p>é‚£ä¹ˆå¦‚ä½•ä¸²è”èµ·æ¥å‘¢ï¼Ÿ</p>\n<p>å…³é”®ç‚¹åœ¨äº <code>opWrapSink</code>  æ–¹æ³•ï¼Œä»–æ¥æ”¶ä¸€ä¸ª <code>Sink</code>  ä½œä¸ºå‚æ•°ï¼Œåœ¨è°ƒç”¨ <code>accept</code>  æ–¹æ³•ä¸­ã€‚å¯ä»¥è°ƒç”¨è¿™ä¸ªå…¥å‚ <code>Sink</code>  çš„ <code>accept</code>  æ–¹æ³•</p>\n<p>è¿™æ ·å­ä»å½“å‰å°±èƒ½è°ƒç”¨ä¸‹ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰äº†æ¨åŠ¨çš„åŠ¨ä½œã€‚é‚£ä¹ˆåªéœ€è¦æ‰¾åˆ°å¼€å§‹ï¼Œæ¯ä¸ªå¤„ç†äº†ä¹‹åéƒ½æ¨åŠ¨ä¸‹ä¸€ä¸ªï¼Œå°±é¡ºåºå®Œæˆäº†æ‰€æ¬²çš„æ“ä½œäº†ã€‚</p>\n<h2 id=\"ç»“è¯­\"><a class=\"markdownIt-Anchor\" href=\"#ç»“è¯­\">#</a> ç»“è¯­</h2>\n<p>é€šè¿‡çœ‹  <code>Stream</code>  ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼Œå‘ç°ä¸€ç¯‡æ–‡ç« æ˜¯æ²¡æ³•è®²æ¸…æ¥šçš„ã€‚</p>\n<p>è¿™ä¸€æ¬¡ï¼Œæˆ‘åˆæœä¸å…¶ç„¶çš„ç•™ä¸‹äº†ä¸¤ç¯‡æ–‡ç« </p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" disabled=\"true\"><label for=\"cbx_0\">  <code>Stream</code>  å¹¶è¡Œè®¡ç®—æµ</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" disabled=\"true\"><label for=\"cbx_1\">  <code>Stream</code>  çš„é«˜çº§è¿­ä»£å™¨</label></li>\n</ul>\n<p>è¯·ç»™æˆ‘è®°ä»£åŠï½</p>\n<p>åœ¨åˆ†äº« <code>å¹¶è¡Œè®¡ç®—æµ</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»¥  <code>JDK1.7</code>  ä¸­çš„  <code>forkJoin</code>  æ¡†æ¶ä¸ºå‰æï¼Œæ¥åˆ†æ  <code>Stream</code>  çš„  <code>parallelStream</code> .</p>\n<p>åœ¨åˆ†äº« <code>è¿­ä»£å™¨</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåˆ†æä¸€ä¸‹ <code>JDK</code>  ä¸­æä¾›çš„ æ™®é€šè¿­ä»£å™¨ï¼Œæ¯”å¦‚  <code>ForEach</code> ,  <code>iterator</code> , ä»¥åŠ <code>Stream</code>  çš„é«˜çº§è¿­ä»£å™¨  <code>spliterator</code> . ä¹Ÿä¼šç”±æµ…å…¥æ·±çš„åˆ†æä¸€ä¸‹ï¼Œå„ç§è¿­ä»£å™¨çš„ä¼˜ç¼ºç‚¹ã€‚ ä¹Ÿä¼šè‡ªå®šä¹‰å®ç°ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p>\n<p>æ•¬è¯·æœŸå¾…ï¼Œé˜²æ­¢èµ°ä¸¢è§æ–‡æœ«ã€‚å…³æ³¨æˆ‘ï¼ŒæœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±.</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/java/jdk/stream/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "JDK",
                "Java",
                "Stream"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/19/java%E7%B3%BB%E5%88%97/JVM/OOM/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/19/java%E7%B3%BB%E5%88%97/JVM/OOM/",
            "title": "JVMä¹‹ä½ æ²¡è§è¿‡çš„OOM",
            "date_published": "2021-08-19T09:13:55.000Z",
            "content_html": "<p>ä¸€æ–‡ææ‡‚å†…å­˜æº¢å‡ºï¼Œä¿å†…å­˜å¹³å®‰ï¼Œé˜²æ­¢ä½ è¢«ç¥­å¤©:[æ‰‹åŠ¨æ»‘ç¨½]:</p>\n<h2 id=\"é‡Šä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#é‡Šä¹‰\">#</a> é‡Šä¹‰</h2>\n<p><code>OOM</code>  çš„å«ä¹‰ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ<br>\n æ˜¯ JVM ç‹¬æœ‰çš„å—ï¼Ÿ  <code>linux</code>  æ˜¯å¦ä¹Ÿä¼šå­˜åœ¨ï¼Œé‚£åˆæ˜¯æ€ä¹ˆè‚¥äº‹ï¼Ÿ</p>\n<p><code>OOM</code>  :  <code>Out Of Memory</code>  .Â  å†…å­˜æº¢å‡ºã€‚å†…å­˜æº¢å‡ºæ¥äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œå°±ä¼šå‘ç”Ÿè¿™ä¸ªé—®é¢˜äº†ã€‚</p>\n<h3 id=\"å†…å­˜åˆæ˜¯ä»€ä¹ˆå‘¢\"><a class=\"markdownIt-Anchor\" href=\"#å†…å­˜åˆæ˜¯ä»€ä¹ˆå‘¢\">#</a> å†…å­˜åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h3>\n<p>1ã€ å†…å­˜ æ˜¯è®¡ç®—æœºçš„é‡è¦éƒ¨ä»¶ä¹‹ä¸€ã€‚å®ƒç”¨äºæš‚æ—¶å­˜æ”¾ CPU ä¸­çš„è¿ç®—æ•°æ®ï¼Œä¸ç¡¬ç›˜ç­‰å¤–éƒ¨å­˜å‚¨äº¤æ¢æ•°æ®ã€‚æ˜¯å¤–å­˜ä¸ <code>CPU</code>  è¿›è¡Œæ²Ÿé€šçš„æ¡¥æ¢ã€‚</p>\n<p>2ã€ <code>Java</code>  å†…å­˜ã€‚è¯´åˆ°è¿™é‡Œæˆ‘ä»¬å°±ä¸å¾—è¯´ä¸€ä¸‹ java çš„å†…å­˜æ¨¡å‹ (JMM) äº†ã€‚å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"/images/java/jvm/JMM.png\" alt=\"JMM\"></p>\n<p>å°±è¿™ä¸ªä¸€ä¸ªå›¾å°±å¾ˆä¸ä¸‹å‡ åä¸ªé¢è¯•è€ƒç‚¹ï¼šæ¯”å¦‚ <code>votitle</code>  å…³é”®å­—ï¼Œå†…å­˜æ …æ ï¼ŒæŒ‡ä»¤é‡æ’ï¼Œ5 é¡¹ <code>Happen-Before</code>  åŸåˆ™ï¼Œå†…å­˜åŸå­æ“ä½œï¼Œæ•°æ® <code>IO</code>  æ“ä½œç­‰ç­‰ã€‚</p>\n<p>é—²è¯å°‘æ‰¯ï¼ŒæŠ›ä¸ªé—®é¢˜ï¼Œ <code>OOM</code>  å‘ç”ŸåŒºåŸŸä¼šä¸Šå›¾ä¸­é‚£ä¸ªéƒ¨åˆ†å‘ç”Ÿå‘¢ï¼Ÿ</p>\n<h2 id=\"å‰è¨€\"><a class=\"markdownIt-Anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h2>\n<p><code>java</code>  è¿è¡Œæ—¶å†…å­˜åŒºåŸŸ  <code>JAVA RUNTIME MEMEORY AREA</code> , æ³¨æ„åŒºåˆ† <code>JMM</code> .</p>\n<p>å¤§å®¶éƒ½çŸ¥é“çš„ï¼Œ <code>java</code>  è¿è¡Œæ—¶å†…å­˜åŒºåŸŸï¼Œåˆ†ä¸ºç¨‹åºè®¡æ•°å™¨ (PC å¯„å­˜å™¨)ï¼Œjava è™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œå †ï¼Œæ–¹æ³•åŒºï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå †å¤–å†…å­˜ (ç›´æ¥å†…å­˜)</p>\n<p>1ã€ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œæ˜¯å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„é‚£æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚è‹¥å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶ç¨‹åºè®¡æ•°å™¨ä¸º <code>Undefined</code> ã€‚</p>\n<p>2ã€ <code>Java</code>  è™šæ‹Ÿæœºæ ˆæ˜¯æè¿°  <code>Java</code>  æ–¹æ³•è¿è¡Œè¿‡ç¨‹çš„å†…å­˜æ¨¡å‹ã€‚ <code>Java</code>  è™šæ‹Ÿæœºæ ˆä¼šä¸ºæ¯ä¸€ä¸ªå³å°†è¿è¡Œçš„  <code>Java</code>  æ–¹æ³•åˆ›å»ºä¸€å—å«åš â€œæ ˆå¸§â€ çš„åŒºåŸŸï¼Œç”¨äºå­˜æ”¾è¯¥æ–¹æ³•è¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šå±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æ¥ï¼Œæ–¹æ³•å‡ºå£ä¿¡æ¯ç­‰ï¼Œæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹å³ä¸ºæ ˆå¸§å‹æ ˆå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p>\n<p>3ã€æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸º  <code>JVM</code>  è¿è¡Œ  <code>Native</code>  æ–¹æ³•å‡†å¤‡çš„ç©ºé—´ï¼Œç”±äºå¾ˆå¤š  <code>Native</code>  æ–¹æ³•éƒ½æ˜¯ç”¨  <code>C</code>  è¯­è¨€å®ç°çš„ï¼Œæ‰€ä»¥å®ƒé€šå¸¸åˆå«  <code>C</code>  æ ˆã€‚å®ƒä¸  <code>Java</code>  è™šæ‹Ÿæœºæ ˆå®ç°çš„åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡æœ¬åœ°æ–¹æ³•æ ˆæ˜¯æè¿°æœ¬åœ°æ–¹æ³•è¿è¡Œè¿‡ç¨‹çš„å†…å­˜æ¨¡å‹ã€‚</p>\n<p>4ã€å †æ˜¯ç”¨æ¥å­˜æ”¾å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †ä¸­ã€‚è¿™ä¸€åŒºåŸŸæ˜¯çº¿ç¨‹å…±äº«ï¼Œæ•´ä¸ª  <code>Java</code>  è™šæ‹Ÿæœºåªæœ‰ä¸€ä¸ªå †ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½è®¿é—®åŒä¸€ä¸ªå †ã€‚å †åˆå¯åˆ’åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œå¹´è½»ä»£å†…å­˜åˆå¯ä»¥åˆ†ä¸º <code>Eden</code> ,  <code>from Surivor</code> , <code>to Surivor</code> , å¹¶ä¸”é»˜è®¤ä»¥ 8:1:1 çš„æ¯”ä¾‹è¿›è¡Œåˆ†é…ã€‚</p>\n<p>5ã€æ–¹æ³•åŒºï¼š <code>Java</code>  è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰æ–¹æ³•åŒºæ˜¯å †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ã€‚æ–¹æ³•åŒºå­˜æ”¾ä»¥ä¸‹ä¿¡æ¯ï¼šå·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¸¸äº®ï¼Œé™æ€å˜é‡ï¼Œå³æ—¶ç¼–è¯‘ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚çº¿ç¨‹å…±äº«çš„åŒºåŸŸã€‚ä¸ºäº†ä¸å †åŒºåˆ†ï¼Œæ–¹æ³•è¿˜æœ‰ä¸€ä¸ªåˆ«åï¼š <code>Non-Heap</code>  (éå †)ã€‚</p>\n<p>5.1 ã€è¿è¡Œæ—¶å¸¸é‡æ± ï¼šå­˜æ”¾å¸¸é‡çš„åŒºåŸŸã€‚ åœ¨è¿è¡ŒæœŸé—´ï¼Œå¯ä»¥å‘å¸¸é‡æ± ä¸­æ·»åŠ æ–°çš„å˜é‡ï¼Œå¦‚  <code>String</code>  ç±»çš„ <code>intern()</code>  æ–¹æ³•ã€‚</p>\n<p>6ã€å †å¤–å†…å­˜æ˜¯ <code>java</code>  è™šæ‹Ÿæœºä¹‹å¤–çš„å†…å®¹ï¼Œä½†ä¹Ÿå¯èƒ½è¢« <code>java</code>  ä½¿ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¹Ÿä¼šå› å†…å­˜ä¸è¶³è€ŒæŠ›å‡º  <code>OutOfMemoryError</code> ã€</p>\n<p>çŸ¥é“äº† <code>Java</code>  è¿è¡Œå†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆå¯èƒ½å‘ç”Ÿ  <code>OOM</code>  çš„åŒºåŸŸæœ‰å“ªäº›å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬éƒ½çŸ¥é“ <code>OOM</code>  åªçš„æ˜¯å†…å­˜æº¢å‡ºï¼Œæ‰€ä»¥ å †ï¼Œéå †å³æ–¹æ³•åŒºï¼Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œä»¥åŠå †å¤–å†…å­˜ éƒ½æ˜¯ä¼šå‘ç”Ÿ  <code>OOM</code>  çš„ã€‚</p>\n<p>é‚£ <code>java</code>  è™šæ‹Ÿæœºæ ˆå‘¢ï¼Ÿä¸ä¼šå‘ç”Ÿå†…å®¹æº¢å‡ºå—ï¼ŸÂ  Â ä¼šï¼ä½†æ˜¯ æ ˆå‘ç”Ÿå†…å®¹æº¢å‡ºçš„æ—¶å€™ï¼ŒæŠ¥çš„é”™è¯¯æ˜¯Â  <code>StackOverflowError</code> .</p>\n<p>é‚£ç¨‹åºè®¡æ•°å™¨å‘¢ï¼ŸÂ  ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯ä¸ä¼šå‘é€å†…å®¹æº¢å‡ºçš„ã€‚ å› ä¸º å­˜å‚¨çš„æ˜¯ï¼šå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„é‚£æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€å•Šã€‚</p>\n<p>å¦‚ä¸‹å›¾ï¼š</p>\n<p><img data-src=\"/images/java/jvm/OOM%E5%8C%BA%E5%9F%9F%E5%9B%BE.png\" alt=\"OOMåŒºåŸŸå›¾\"></p>\n<p>åœ¨ä¸Šå›¾ä¸­è¿˜æŒ‡å®šäº†å„åŒºåŸŸå¤§å°çš„å‚æ•°é…ç½®ï¼š</p>\n<ul>\n<li>\n<p><code>-Xms</code>  è®¾ç½®å †çš„æœ€å°ç©ºé—´å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>-Xmx</code>  è®¾ç½®å †çš„æœ€å¤§ç©ºé—´å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>-XX:NewSize</code>  è®¾ç½®æ–°ç”Ÿä»£æœ€å°ç©ºé—´å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>-XX:MaxNewSize</code>  è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§ç©ºé—´å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>-XX:PermSize</code>  è®¾ç½®æ°¸ä¹…ä»£æœ€å°ç©ºé—´å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>-XX:MaxPermSize</code>  è®¾ç½®æ°¸ä¹…ä»£æœ€å¤§ç©ºé—´å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>-Xss</code>  è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚</p>\n</li>\n</ul>\n<p>æ²¡æœ‰ç›´æ¥è®¾ç½®è€å¹´ä»£çš„å‚æ•°ï¼Œä½†æ˜¯å¯ä»¥è®¾ç½®å †ç©ºé—´å¤§å°å’Œæ–°ç”Ÿä»£ç©ºé—´å¤§å°ä¸¤ä¸ªå‚æ•°æ¥é—´æ¥æ§åˆ¶ã€‚Â  <code>è€å¹´ä»£ç©ºé—´å¤§å°=å †ç©ºé—´å¤§å°-å¹´è½»ä»£å¤§ç©ºé—´å¤§å°</code></p>\n<h2 id=\"åœºæ™¯åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åœºæ™¯åˆ†æ\">#</a> åœºæ™¯åˆ†æ</h2>\n<p>æˆ‘ä»¬æŒ¨ä¸ªåˆ†æä¸‹å‘ç”Ÿ <code>OOM</code>  çš„ 9 ç§åœºæ™¯</p>\n<p>ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿ <code>OOM</code> Â å‘¢ï¼ŸÂ  å½“å†…å­˜ä¸¥é‡ä¸å¤Ÿç”¨çš„æ—¶å€™å°±ä¼šå‘ç”ŸÂ Â  <code>java.lang.OutOfMemoryError</code>  ã€‚</p>\n<p>æˆ‘ä»¬æ¥çœ‹ä¸‹æ¯ä¸ªåŒºåŸŸéƒ½æœ‰å¯èƒ½å‡ºç°å†…å­˜æº¢å‡ºé—®é¢˜.</p>\n<h3 id=\"javaheap-space\"><a class=\"markdownIt-Anchor\" href=\"#javaheap-space\">#</a>  <code>JavaHeap space</code></h3>\n<p>å½“å †å†…å­˜ï¼ˆ <code>Heap Space</code> ï¼‰æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ï¼Œå°±ä¼šæŠ›å‡º  <code>java.lang.OutOfMemoryError:Javaheap space</code>  é”™è¯¯ã€‚</p>\n<p><code>Javaheap space</code>  é”™è¯¯äº§ç”Ÿçš„å¸¸è§åŸå› å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>\n<p>1. è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¤§æ•°ç»„ã€‚<br>\n2. è¶…å‡ºé¢„æœŸçš„è®¿é—®é‡ / æ•°æ®é‡ï¼Œé€šå¸¸æ˜¯ä¸Šæ¸¸ç³»ç»Ÿè¯·æ±‚æµé‡é£™å‡ï¼Œå¸¸è§äºå„ç±»ä¿ƒé”€ / ç§’æ€æ´»åŠ¨ï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡æµé‡æŒ‡æ ‡æ’æŸ¥æ˜¯å¦æœ‰å°–çŠ¶å³°å€¼ã€‚<br>\n3. è¿‡åº¦ä½¿ç”¨ç»ˆç»“å™¨ï¼ˆ <code>Finalizer</code> ï¼‰ï¼Œè¯¥å¯¹è±¡æ²¡æœ‰ç«‹å³è¢«  <code>GC</code> ã€‚<br>\n4. å†…å­˜æ³„æ¼ï¼ˆ <code>Memory Leak</code> ï¼‰ï¼Œå¤§é‡å¯¹è±¡å¼•ç”¨æ²¡æœ‰é‡Šæ”¾ï¼Œ <code>JVM</code>  æ— æ³•å¯¹å…¶è‡ªåŠ¨å›æ”¶ï¼Œå¸¸è§äºä½¿ç”¨äº†  <code>File</code>  ç­‰èµ„æºæ²¡æœ‰å›æ”¶ã€‚</p>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ\">#</a> è§£å†³æ–¹æ¡ˆ</h4>\n<p>é’ˆå¯¹å¤§éƒ¨åˆ†æƒ…å†µï¼Œé€šå¸¸åªéœ€è¦é€šè¿‡  <code>-Xmx</code>  å‚æ•°è°ƒé«˜  <code>JVM</code>  å †å†…å­˜ç©ºé—´å³å¯ã€‚å¦‚æœä»ç„¶æ²¡æœ‰è§£å†³ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æƒ…å†µåšè¿›ä¸€æ­¥å¤„ç†ï¼š</p>\n<p>1ã€å¦‚æœæ˜¯è¶…å¤§å¯¹è±¡ï¼Œå¯ä»¥æ£€æŸ¥å…¶åˆç†æ€§ï¼Œæ¯”å¦‚æ˜¯å¦ä¸€æ¬¡æ€§æŸ¥è¯¢äº†æ•°æ®åº“å…¨éƒ¨ç»“æœï¼Œè€Œæ²¡æœ‰åšç»“æœæ•°é™åˆ¶ã€‚<br>\n2ã€å¦‚æœæ˜¯ä¸šåŠ¡å³°å€¼å‹åŠ›ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ æœºå™¨èµ„æºï¼Œæˆ–è€…åšé™æµé™çº§ã€‚<br>\n3ã€å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œéœ€è¦æ‰¾åˆ°æŒæœ‰çš„å¯¹è±¡ï¼Œä¿®æ”¹ä»£ç è®¾è®¡ï¼Œæ¯”å¦‚å…³é—­æ²¡æœ‰é‡Šæ”¾çš„è¿æ¥ã€‚</p>\n<h4 id=\"ä»£ç æ¡ˆä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç æ¡ˆä¾‹\">#</a> ä»£ç æ¡ˆä¾‹</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤ºå¤§å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"comment\"> * -Xms128M -Xmx128M</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">bigObject</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 21 å¯ä»¥ï¼Œ22å°±ä¼šOOM</span></span><br><span class=\"line\">    <span class=\"comment\">// 4* 1024 * 1024 = 4M * 32 = 128M</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span>[] integers = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[<span class=\"number\">1024</span>*<span class=\"number\">1024</span>*<span class=\"number\">32</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ¥é”™å†…å®¹<br>\n<img data-src=\"/images/java/jvm/heapSpaceError.png\" alt=\"\"></p>\n<h3 id=\"gc-overhead-limit-exceeded\"><a class=\"markdownIt-Anchor\" href=\"#gc-overhead-limit-exceeded\">#</a>  <code>GC overhead limit exceeded</code></h3>\n<p>å½“  <code>Java</code>  è¿›ç¨‹èŠ±è´¹  <code>98%</code>  ä»¥ä¸Šçš„æ—¶é—´æ‰§è¡Œ  <code>GC</code> ï¼Œä½†åªæ¢å¤äº†ä¸åˆ°  <code>2%</code>  çš„å†…å­˜ï¼Œä¸”è¯¥åŠ¨ä½œè¿ç»­é‡å¤äº†  <code>5</code>  æ¬¡ï¼Œå°±ä¼šæŠ›å‡º  <code>java.lang.OutOfMemoryError:GC overhead limit exceeded</code>  é”™è¯¯ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åº”ç”¨ç¨‹åºå·²ç»åŸºæœ¬è€—å°½äº†æ‰€æœ‰å¯ç”¨å†…å­˜ï¼Œ  <code>GC</code>  ä¹Ÿæ— æ³•å›æ”¶ã€‚</p>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ-2\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ-2\">#</a> è§£å†³æ–¹æ¡ˆ</h4>\n<p>åŒÂ  <code>JavaHeap space</code>  éƒ¨åˆ†çš„å¼‚å¸¸è§£å†³æ–¹æ¡ˆã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤º é¢‘ç¹GC</span></span><br><span class=\"line\"><span class=\"comment\"> * -Xms128M -Xmx128M</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">overHead</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Map map = <span class=\"keyword\">new</span> HashMap();</span><br><span class=\"line\">    Random r = <span class=\"keyword\">new</span> Random();</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">        map.put(r.nextInt(), <span class=\"string\">&quot;value&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ¥é”™å†…å®¹:<br>\n<img data-src=\"/images/java/jvm/gcOverHead.png\" alt=\"\"></p>\n<h3 id=\"permgen-spacejdk8-å·²åºŸå¼ƒ-see-å…ƒç©ºé—´\"><a class=\"markdownIt-Anchor\" href=\"#permgen-spacejdk8-å·²åºŸå¼ƒ-see-å…ƒç©ºé—´\">#</a>  <code>Permgen space</code> ( <code>JDK8</code>  å·²åºŸå¼ƒï¼Œ <code>see</code>  å…ƒç©ºé—´ã€‚)</h3>\n<div class=\"note info\">\n<p>ä¸ºä»€ä¹ˆä¼šåºŸå¼ƒ æ°¸ä¹…ä»£ï¼ŸÂ  Â   <code>see</code> ï¼šÂ <span class=\"exturl\" data-url=\"aHR0cDovL29wZW5qZGsuamF2YS5uZXQvamVwcy8xMjI=\">http://openjdk.java.net/jeps/122</span></p>\n</div>\n<p>è¯¥é”™è¯¯è¡¨ç¤ºæ°¸ä¹…ä»£ï¼ˆ <code>Permanent Generation</code> ï¼‰å·²ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„  <code>class</code>  æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚</p>\n<p>æ°¸ä¹…ä»£å­˜å‚¨å¯¹è±¡ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</p>\n<p>åŠ è½½ / ç¼“å­˜åˆ°å†…å­˜ä¸­çš„  <code>class</code>  å®šä¹‰ï¼ŒåŒ…æ‹¬ç±»çš„åç§°ï¼Œå­—æ®µï¼Œæ–¹æ³•å’Œå­—èŠ‚ç ï¼›<br>\nå¸¸é‡æ± ï¼›<br>\nå¯¹è±¡æ•°ç»„ / ç±»å‹æ•°ç»„æ‰€å…³è”çš„  <code>class</code> ï¼›<br>\n <code>JIT</code>  ç¼–è¯‘å™¨ä¼˜åŒ–åçš„  <code>class</code>  ä¿¡æ¯ã€‚<br>\n <code>PermGen</code>  çš„ä½¿ç”¨é‡ä¸åŠ è½½åˆ°å†…å­˜çš„  <code>class</code>  çš„æ•°é‡ / å¤§å°æ­£ç›¸å…³ã€‚</p>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ-3\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ-3\">#</a> è§£å†³æ–¹æ¡ˆ</h4>\n<p>æ ¹æ®  <code>Permgen space</code>  æŠ¥é”™çš„æ—¶æœºï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<ul>\n<li>ç¨‹åºå¯åŠ¨æŠ¥é”™ï¼Œä¿®æ”¹  <code>-XX:MaxPermSize</code>  å¯åŠ¨å‚æ•°ï¼Œè°ƒå¤§æ°¸ä¹…ä»£ç©ºé—´ã€‚</li>\n<li>åº”ç”¨é‡æ–°éƒ¨ç½²æ—¶æŠ¥é”™ï¼Œå¾ˆå¯èƒ½æ˜¯æ²¡æœ‰åº”ç”¨æ²¡æœ‰é‡å¯ï¼Œå¯¼è‡´åŠ è½½äº†å¤šä»½  <code>class</code>  ä¿¡æ¯ï¼Œåªéœ€é‡å¯ JVM å³å¯è§£å†³ã€‚</li>\n<li>è¿è¡Œæ—¶æŠ¥é”™ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šåŠ¨æ€åˆ›å»ºå¤§é‡  <code>class</code> ï¼Œè€Œè¿™äº›  <code>class</code>  çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­æš‚ï¼Œä½†æ˜¯ JVM é»˜è®¤ä¸ä¼šå¸è½½  <code>class</code> ï¼Œå¯ä»¥è®¾ç½®  <code>-XX:+CMSClassUnloadingEnabled</code>  å’Œ  <code>-XX:+UseConcMarkSweepGC</code>  è¿™ä¸¤ä¸ªå‚æ•°å…è®¸  <code>JVM</code>  å¸è½½  <code>class</code> ã€‚</li>\n<li>å¦‚æœä¸Šè¿°æ–¹æ³•æ— æ³•è§£å†³ï¼Œå¯ä»¥é€šè¿‡  <code>jmap</code>  å‘½ä»¤  <code>dump</code>  å†…å­˜å¯¹è±¡  <code>jmap-dump:format=b,file=dump.hprof</code>  ï¼Œç„¶ååˆ©ç”¨  <code>Eclipse MAT https://www.eclipse.org/mat</code>  åŠŸèƒ½é€ä¸€åˆ†æå¼€é”€æœ€å¤§çš„  <code>classloader</code>  å’Œé‡å¤  <code>class</code> ã€‚</li>\n</ul>\n<h3 id=\"metaspace\"><a class=\"markdownIt-Anchor\" href=\"#metaspace\">#</a>  <code>Metaspace</code></h3>\n<p><code>JDK 1.8</code>  ä½¿ç”¨  <code>Metaspace</code>  æ›¿æ¢äº†æ°¸ä¹…ä»£ï¼ˆ <code>Permanent Generation</code> ï¼‰</p>\n<p>è¯¥é”™è¯¯è¡¨ç¤º  <code>Metaspace</code>  å·²è¢«ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„  <code>class</code>  æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚</p>\n<p>æ­¤ç±»é—®é¢˜çš„åŸå› ä¸è§£å†³æ–¹æ³•è·Ÿ  <code>PermGenspace</code>  éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å‚è€ƒä¸Šæ–‡ã€‚</p>\n<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è°ƒæ•´  <code>Metaspace</code>  ç©ºé—´å¤§å°çš„å¯åŠ¨å‚æ•°ä¸º  <code>-XX:MaxMetaspaceSize</code> ã€‚</p>\n<h4 id=\"ä»£ç æ¡ˆä¾‹-2\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç æ¡ˆä¾‹-2\">#</a> ä»£ç æ¡ˆä¾‹</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤º  å…ƒæ•°æ®åŒº</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * åœ¨ `for` å¾ªç¯ä¸­, åŠ¨æ€ç”Ÿæˆå¾ˆå¤šclass, æœ€ç»ˆå°†è¿™äº›classåŠ è½½åˆ° Metaspace ä¸­</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * æ³¨æ„é…ç½®: -XX:MaxMetaspaceSize=64m</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">metaSpace</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; ; i++) &#123;</span><br><span class=\"line\">        Class c = cp.makeClass(<span class=\"string\">&quot;eu.plumbr.demo.Generated&quot;</span> + i).toClass();</span><br><span class=\"line\">        System.out.println(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ¥é”™å†…å®¹:</p>\n<p><img data-src=\"/images/java/jvm/metaSpace.png\" alt=\"\"></p>\n<h3 id=\"unable-to-create-new-native-thread\"><a class=\"markdownIt-Anchor\" href=\"#unable-to-create-new-native-thread\">#</a>  <code>Unable to create new native thread</code></h3>\n<p>æ¯ä¸ª  <code>Java</code>  çº¿ç¨‹éƒ½éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œå½“  <code>JVM</code>  å‘åº•å±‚æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„  <code>native</code>  çº¿ç¨‹æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…å°±ä¼šæŠ¥æ­¤ç±»é”™è¯¯ã€‚</p>\n<h4 id=\"åŸå› åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åŸå› åˆ†æ\">#</a> åŸå› åˆ†æ</h4>\n<p><code>JVM</code>  å‘  <code>OS</code>  è¯·æ±‚åˆ›å»º  <code>native</code>  çº¿ç¨‹å¤±è´¥ï¼Œå°±ä¼šæŠ›å‡º  <code>Unable to create new native thread</code> ï¼Œå¸¸è§çš„åŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</p>\n<p>çº¿ç¨‹æ•°è¶…è¿‡æ“ä½œç³»ç»Ÿæœ€å¤§çº¿ç¨‹æ•°  <code>ulimit</code>  é™åˆ¶ï¼›<br>\nçº¿ç¨‹æ•°è¶…è¿‡  <code>kernel.pid_max</code> ï¼ˆåªèƒ½é‡å¯ï¼‰ï¼›<br>\n <code>native</code>  å†…å­˜ä¸è¶³ï¼›</p>\n<p>è¯¥é—®é¢˜å‘ç”Ÿçš„å¸¸è§è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥ï¼š</p>\n<p><code>JVM</code>  å†…éƒ¨çš„åº”ç”¨ç¨‹åºè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„  <code>Java</code>  çº¿ç¨‹ï¼›<br>\n <code>JVM native</code>  æ–¹æ³•ä»£ç†äº†è¯¥æ¬¡è¯·æ±‚ï¼Œå¹¶å‘æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ª  <code>native</code>  çº¿ç¨‹ï¼›<br>\næ“ä½œç³»ç»Ÿå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„  <code>native</code>  çº¿ç¨‹ï¼Œå¹¶ä¸ºå…¶åˆ†é…å†…å­˜ï¼›<br>\nå¦‚æœæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜å·²è€—å°½ï¼Œæˆ–æ˜¯å—åˆ° 32 ä½è¿›ç¨‹çš„åœ°å€ç©ºé—´é™åˆ¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæ‹’ç»æœ¬æ¬¡  <code>native</code>  å†…å­˜åˆ†é…ï¼›<br>\n <code>JVM</code>  å°†æŠ›å‡º  <code>java.lang.OutOfMemoryError:Unableto createnewnativethread</code>  é”™è¯¯ã€‚</p>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ-4\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ-4\">#</a> è§£å†³æ–¹æ¡ˆ</h4>\n<ul>\n<li>å‡çº§é…ç½®ï¼Œä¸ºæœºå™¨æä¾›æ›´å¤šçš„å†…å­˜ï¼›</li>\n<li>é™ä½  <code>Java Heap Space</code>  å¤§å°ï¼›</li>\n<li>ä¿®å¤åº”ç”¨ç¨‹åºçš„çº¿ç¨‹æ³„æ¼é—®é¢˜ï¼›</li>\n<li>é™åˆ¶çº¿ç¨‹æ± å¤§å°ï¼›</li>\n<li>ä½¿ç”¨  <code>-Xss</code>  å‚æ•°å‡å°‘çº¿ç¨‹æ ˆçš„å¤§å°ï¼›</li>\n<li>è°ƒé«˜  <code>OS</code>  å±‚é¢çš„çº¿ç¨‹æœ€å¤§æ•°ï¼šæ‰§è¡Œ  <code>ulimit -a</code>  æŸ¥çœ‹æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ï¼Œä½¿ç”¨  <code>ulimit -u xxx</code>  è°ƒæ•´æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ã€‚</li>\n</ul>\n<h4 id=\"ä»£ç æ¡ˆä¾‹-3\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç æ¡ˆä¾‹-3\">#</a> ä»£ç æ¡ˆä¾‹</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤º: Unable to create new native thread</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">nativeThread</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">10000000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ¥é”™å†…å®¹:</p>\n<p><img data-src=\"/images/java/jvm/unableCreateNative.png\" alt=\"\"></p>\n<h3 id=\"out-of-swap-space\"><a class=\"markdownIt-Anchor\" href=\"#out-of-swap-space\">#</a>  <code>Out of swap space</code></h3>\n<p>è¯¥é”™è¯¯è¡¨ç¤ºæ‰€æœ‰å¯ç”¨çš„è™šæ‹Ÿå†…å­˜å·²è¢«è€—å°½ã€‚è™šæ‹Ÿå†…å­˜ï¼ˆ <code>Virtual Memory</code> ï¼‰ç”±ç‰©ç†å†…å­˜ï¼ˆ <code>Physical Memory</code> ï¼‰å’Œäº¤æ¢ç©ºé—´ï¼ˆ <code>Swap Space</code> ï¼‰ä¸¤éƒ¨åˆ†ç»„æˆã€‚å½“è¿è¡Œæ—¶ç¨‹åºè¯·æ±‚çš„è™šæ‹Ÿå†…å­˜æº¢å‡ºæ—¶å°±ä¼šæŠ¥  <code>Outof swap space</code>  é”™è¯¯ã€‚</p>\n<p>è¿™ä¸ªé”™è¯¯é€šå¸¸æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„åŸå› ã€‚</p>\n<h4 id=\"åŸå› åˆ†æ-2\"><a class=\"markdownIt-Anchor\" href=\"#åŸå› åˆ†æ-2\">#</a> åŸå› åˆ†æ</h4>\n<p>è¯¥é”™è¯¯å‡ºç°çš„å¸¸è§åŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</p>\n<ul>\n<li>\n<ol>\n<li>åœ°å€ç©ºé—´ä¸è¶³ï¼›</li>\n</ol>\n</li>\n<li>2. ç‰©ç†å†…å­˜å·²è€—å…‰ï¼›</li>\n<li>3. åº”ç”¨ç¨‹åºçš„æœ¬åœ°å†…å­˜æ³„æ¼ï¼ˆ <code>native leak</code> ï¼‰ï¼Œä¾‹å¦‚ä¸æ–­ç”³è¯·æœ¬åœ°å†…å­˜ï¼Œå´ä¸é‡Šæ”¾ã€‚</li>\n<li>4. æ‰§è¡Œ  <code>jmap-histo:live</code>  å‘½ä»¤ï¼Œå¼ºåˆ¶æ‰§è¡Œ  <code>Full GC</code> ï¼›å¦‚æœå‡ æ¬¡æ‰§è¡Œåå†…å­˜æ˜æ˜¾ä¸‹é™ï¼Œåˆ™åŸºæœ¬ç¡®è®¤ä¸º  <code>Direct ByteBuffer</code>  é—®é¢˜ã€‚</li>\n</ul>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ-5\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ-5\">#</a> è§£å†³æ–¹æ¡ˆ</h4>\n<p>æ ¹æ®é”™è¯¯åŸå› å¯ä»¥é‡‡å–å¦‚ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>\n<ol>\n<li>å‡çº§åœ°å€ç©ºé—´ä¸º  <code>64 bit</code> ï¼›</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>ä½¿ç”¨  <code>Arthas</code>  æ£€æŸ¥æ˜¯å¦ä¸º  <code>Inflater/Deflater</code>  è§£å‹ç¼©é—®é¢˜ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ˜¾å¼è°ƒç”¨  <code>end</code>  æ–¹æ³•ã€‚</li>\n</ol>\n</li>\n<li>\n<ol start=\"3\">\n<li><code>Direct ByteBuffer</code>  é—®é¢˜å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°  <code>-XX:MaxDirectMemorySize</code>  è°ƒä½é˜ˆå€¼ã€‚</li>\n</ol>\n</li>\n<li>\n<ol start=\"4\">\n<li>å‡çº§æœåŠ¡å™¨é…ç½® / éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨ã€‚</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"kill-process-or-sacrifice-child\"><a class=\"markdownIt-Anchor\" href=\"#kill-process-or-sacrifice-child\">#</a>  <code>Kill process or sacrifice child</code></h3>\n<p>æœ‰ä¸€ç§å†…æ ¸ä½œä¸šï¼ˆ <code>Kernel Job</code> ï¼‰åä¸º  <code>Out of Memory Killer</code> ï¼Œå®ƒä¼šåœ¨å¯ç”¨å†…å­˜æä½çš„æƒ…å†µä¸‹ â€œæ€æ­»â€ï¼ˆ <code>kill</code> ï¼‰æŸäº›è¿›ç¨‹ã€‚ <code>OOM Killer</code>  ä¼šå¯¹æ‰€æœ‰è¿›ç¨‹è¿›è¡Œæ‰“åˆ†ï¼Œç„¶åå°†è¯„åˆ†è¾ƒä½çš„è¿›ç¨‹ â€œæ€æ­»â€ï¼Œå…·ä½“çš„è¯„åˆ†è§„åˆ™å¯ä»¥å‚è€ƒ  <code>Surviving the Linux OOM Killer</code> ã€‚</p>\n<p>ä¸åŒäºå…¶ä»–çš„  <code>OOM</code>  é”™è¯¯ï¼Œ  <code>Killprocessorsacrifice child</code>  é”™è¯¯ä¸æ˜¯ç”±  <code>JVM</code>  å±‚é¢è§¦å‘çš„ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿå±‚é¢è§¦å‘çš„ã€‚</p>\n<h4 id=\"åŸå› åˆ†æ-3\"><a class=\"markdownIt-Anchor\" href=\"#åŸå› åˆ†æ-3\">#</a> åŸå› åˆ†æ</h4>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>Linux</code>  å†…æ ¸å…è®¸è¿›ç¨‹ç”³è¯·çš„å†…å­˜æ€»é‡å¤§äºç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œé€šè¿‡è¿™ç§ â€œé”™å³°å¤ç”¨â€ çš„æ–¹å¼å¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚</p>\n<p>ç„¶è€Œï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šæ— å¯é¿å…åœ°å¸¦æ¥ä¸€å®šçš„ â€œè¶…å–â€ é£é™©ã€‚ä¾‹å¦‚æŸäº›è¿›ç¨‹æŒç»­å ç”¨ç³»ç»Ÿå†…å­˜ï¼Œç„¶åå¯¼è‡´å…¶ä»–è¿›ç¨‹æ²¡æœ‰å¯ç”¨å†…å­˜ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ¿€æ´»  <code>OOM Killer</code> ï¼Œå¯»æ‰¾è¯„åˆ†ä½çš„è¿›ç¨‹ï¼Œå¹¶å°†å…¶ â€œæ€æ­»â€ï¼Œé‡Šæ”¾å†…å­˜èµ„æºã€‚</p>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ-6\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ-6\">#</a> è§£å†³æ–¹æ¡ˆ</h4>\n<ul>\n<li>å‡çº§æœåŠ¡å™¨é…ç½® / éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨ã€‚</li>\n<li><code>OOM Killer</code>  è°ƒä¼˜ã€‚</li>\n</ul>\n<h4 id=\"ä»£ç æ¡ˆä¾‹-4\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç æ¡ˆä¾‹-4\">#</a> ä»£ç æ¡ˆä¾‹</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤º:Kill process or sacrifice child</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">error</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    java.util.List&lt;<span class=\"keyword\">int</span>[]&gt; l = <span class=\"keyword\">new</span> java.util.ArrayList();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">10000</span>; i &lt; <span class=\"number\">100000</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            l.add(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[<span class=\"number\">100000000</span>]);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</span><br><span class=\"line\">            t.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ¥é”™å†…å®¹<br>\n<img data-src=\"/images/java/jvm/killprocess.png\" alt=\"\"></p>\n<h3 id=\"requested-array-size-exceeds-vm-limit\"><a class=\"markdownIt-Anchor\" href=\"#requested-array-size-exceeds-vm-limit\">#</a>  <code>Requested array size exceeds VM limit</code></h3>\n<p>JVM é™åˆ¶äº†æ•°ç»„çš„æœ€å¤§é•¿åº¦ï¼Œè¯¥é”™è¯¯è¡¨ç¤ºç¨‹åºè¯·æ±‚åˆ›å»ºçš„æ•°ç»„è¶…è¿‡æœ€å¤§é•¿åº¦é™åˆ¶ã€‚</p>\n<p>JVM åœ¨ä¸ºæ•°ç»„åˆ†é…å†…å­˜å‰ï¼Œä¼šæ£€æŸ¥è¦åˆ†é…çš„æ•°æ®ç»“æ„åœ¨ç³»ç»Ÿä¸­æ˜¯å¦å¯å¯»å€ï¼Œé€šå¸¸ä¸º  <code>Integer.MAX_VALUE-2</code> ã€‚</p>\n<p>æ­¤ç±»é—®é¢˜æ¯”è¾ƒç½•è§ï¼Œé€šå¸¸éœ€è¦æ£€æŸ¥ä»£ç ï¼Œç¡®è®¤ä¸šåŠ¡æ˜¯å¦éœ€è¦åˆ›å»ºå¦‚æ­¤å¤§çš„æ•°ç»„ï¼Œæ˜¯å¦å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªå—ï¼Œåˆ†æ‰¹æ‰§è¡Œã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">error</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">3</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span>[] arr = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[Integer.MAX_VALUE-i];</span><br><span class=\"line\">            System.out.format(<span class=\"string\">&quot;Successfully initialized an array with %,d elements.\\n&quot;</span>, Integer.MAX_VALUE-i);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</span><br><span class=\"line\">            t.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ¥é”™å†…å®¹</p>\n<p><img data-src=\"/images/java/jvm/requestArraySize.png\" alt=\"\"></p>\n<h3 id=\"direct-buffer-memory\"><a class=\"markdownIt-Anchor\" href=\"#direct-buffer-memory\">#</a>  <code>Direct buffer memory</code></h3>\n<p><code>java</code>  å…è®¸åº”ç”¨ç¨‹åºé€šè¿‡  <code>Direct ByteBuffer</code>  ç›´æ¥è®¿é—®å †å¤–å†…å­˜ï¼Œè®¸å¤šé«˜æ€§èƒ½ç¨‹åºé€šè¿‡  <code>Direct ByteBuffer</code>  ç»“åˆå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆ <code>Memory Mapped File</code> ï¼‰å®ç°é«˜é€Ÿ  <code>IO</code> ã€‚</p>\n<h4 id=\"åŸå› åˆ†æ-4\"><a class=\"markdownIt-Anchor\" href=\"#åŸå› åˆ†æ-4\">#</a> åŸå› åˆ†æ</h4>\n<p><code>Direct ByteBuffer</code>  çš„é»˜è®¤å¤§å°ä¸º  <code>64 MB</code> ï¼Œä¸€æ—¦ä½¿ç”¨è¶…å‡ºé™åˆ¶ï¼Œå°±ä¼šæŠ›å‡º  <code>Directbuffer memory</code>  é”™è¯¯ã€‚</p>\n<h4 id=\"è§£å†³æ–¹æ¡ˆ-7\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ-7\">#</a> è§£å†³æ–¹æ¡ˆ</h4>\n<ul>\n<li><code>Java</code>  åªèƒ½é€šè¿‡  <code>ByteBuffer</code> . <code>allocateDirect</code>  æ–¹æ³•ä½¿ç”¨  <code>Direct ByteBuffer</code> ï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡  <code>Arthas</code>  ç­‰åœ¨çº¿è¯Šæ–­å·¥å…·æ‹¦æˆªè¯¥æ–¹æ³•è¿›è¡Œæ’æŸ¥ã€‚</li>\n<li>æ£€æŸ¥æ˜¯å¦ç›´æ¥æˆ–é—´æ¥ä½¿ç”¨äº†  <code>NIO</code> ï¼Œå¦‚  <code>netty</code> ï¼Œ <code>jetty</code>  ç­‰ã€‚</li>\n<li>é€šè¿‡å¯åŠ¨å‚æ•°  <code>-XX:MaxDirectMemorySize</code>  è°ƒæ•´  <code>Direct ByteBuffer</code>  çš„ä¸Šé™å€¼ã€‚</li>\n<li>æ£€æŸ¥  <code>JVM</code>  å‚æ•°æ˜¯å¦æœ‰  <code>-XX:+DisableExplicitGC</code>  é€‰é¡¹ï¼Œå¦‚æœæœ‰å°±å»æ‰ï¼Œå› ä¸ºè¯¥å‚æ•°ä¼šä½¿  <code>System.gc()</code>  å¤±æ•ˆã€‚</li>\n<li>æ£€æŸ¥å †å¤–å†…å­˜ä½¿ç”¨ä»£ç ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼›æˆ–è€…é€šè¿‡åå°„è°ƒç”¨  <code>sun.misc.Cleaner</code>  çš„  <code>clean()</code>  æ–¹æ³•æ¥ä¸»åŠ¨é‡Šæ”¾è¢«  <code>Direct ByteBuffer</code>  æŒæœ‰çš„å†…å­˜ç©ºé—´ã€‚</li>\n<li>å†…å­˜å®¹é‡ç¡®å®ä¸è¶³ï¼Œå‡çº§é…ç½®ã€‚</li>\n</ul>\n<h4 id=\"ä»£ç æ¡ˆä¾‹-5\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç æ¡ˆä¾‹-5\">#</a> ä»£ç æ¡ˆä¾‹</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤ºå¯¹å¤–å†…å­˜æº¢å‡º</span></span><br><span class=\"line\"><span class=\"comment\"> * -Xms10m -Xmx10m -XX:+PrintGCDetails -XX:MaxDirectMemorySize=5m</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">error</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;maxDirectMemory : &quot;</span> + (sun.misc.VM.maxDirectMemory() / (<span class=\"keyword\">double</span>) (<span class=\"number\">1024</span> * <span class=\"number\">1024</span>)) + <span class=\"string\">&quot;MB&quot;</span>);</span><br><span class=\"line\">    ByteBuffer byteBuffer = ByteBuffer.allocateDirect(<span class=\"number\">6</span> * <span class=\"number\">1024</span> * <span class=\"number\">1024</span>);</span><br><span class=\"line\">    System.out.println(byteBuffer);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æŠ¥é”™å†…å®¹<br>\n<img data-src=\"/images/java/jvm/directBuffer.png\" alt=\"\"></p>\n<h2 id=\"æ’æŸ¥æ€è·¯\"><a class=\"markdownIt-Anchor\" href=\"#æ’æŸ¥æ€è·¯\">#</a> æ’æŸ¥æ€è·¯</h2>\n<p>åˆ†äº«é‡åˆ° <code>OOM</code>  ç±»é—®é¢˜å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜ï¼Œå…·ä½“å“ªè¡Œä»£ç å‘ç”Ÿäº†é—®é¢˜</p>\n<p>ä»€ä¹ˆè¡¨ç°ä¼šå‘ç”Ÿ <code>OOM</code>  å‘¢ï¼Ÿ</p>\n<p>æœ€ç›´æ¥çš„ï½ï¼Œæœ‰æŠ¥é”™ï¼Œ <code>outOfMemoryError</code> ã€‚ å°±æ˜¯å‘ç”Ÿäº†ã€‚<br>\næœ‰é¢‘ç¹ <code>GC</code>  çš„äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œä¹Ÿè¦æ³¨æ„ä¸‹ï¼Œå¯èƒ½æ˜¯åœ¨  <code>OOM</code>  çš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢ã€‚ æ¯”å¦‚  <code>FullGC</code> ï¼Œ  <code>Young GC</code> , ç­‰ã€‚<br>\n <code>CPU</code>  å ç”¨ç‡è¾ƒé«˜ã€‚<br>\nå…ˆè¯´ä¸€ä¸ªæ€è·¯å“ˆï½</p>\n<h3 id=\"æ­¢æŸ\"><a class=\"markdownIt-Anchor\" href=\"#æ­¢æŸ\">#</a> æ­¢æŸã€‚</h3>\n<p>å¦‚æœä½ åœ¨çº¿ä¸Šé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œ è¯·ï¼ŒåŠ¡å¿…ï¼ å…ˆå°†æœåŠ¡é‡å¯ï¼ç«‹åˆ»ï¼Œé©¬ä¸Šã€‚ åŠæ—¶æ­¢æŸã€‚  <code>ps</code> : å¯ä»¥ç•™ä¸€å°æœºå™¨åšæ¡ˆå‘ç°åœºï¼Œè®°å¾—ä¸‹æ‰è¯¥æœºå™¨ï¼Œä¸å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>\n<h3 id=\"é—®é¢˜æ’æŸ¥\"><a class=\"markdownIt-Anchor\" href=\"#é—®é¢˜æ’æŸ¥\">#</a> é—®é¢˜æ’æŸ¥</h3>\n<p>æ³¨æ„è§‚å¯Ÿçº¿ä¸ŠæœåŠ¡æƒ…å†µï¼Œå¦‚æœå†æ¬¡å‡ºç° <code>OOM</code> , å½±å“ä¸šåŠ¡ï¼Œå†é—®é¢˜æ²¡æœ‰è§£å†³å®Œæˆä¹‹å‰ï¼Œè¿˜æ˜¯é‡‡ç”¨é‡å¯çš„æ–¹å¼è§£å†³ã€‚<br>\nå¯ä»¥é€šè¿‡  <code>glowroot</code>  ç­‰å¯è§†åŒ–çš„ç›‘æ§å·¥å…·ï¼Œè§‚å¯Ÿã€‚<br>\nä¹Ÿå¯ä»¥é€šè¿‡åœ¨æœºå™¨ä¸Š ä½¿ç”¨Â   <code>jstat -gc pid</code>  æ¥æŸ¥çœ‹ <code>GC</code>  æƒ…å†µã€‚<br>\nåˆ†æé€ æˆ <code>OOM</code>  çš„é—®é¢˜ã€‚(å…·ä½“å¦‚ä½•æ’æŸ¥ï¼Œå¯å‚è€ƒæ¡ˆä¾‹æ¨¡å—)</p>\n<p>æŸ¥åˆ°å¯¹åº” <code>JVM</code>  è¿›ç¨‹ =&gt;Â  æ’æŸ¥åˆ°å ç”¨å†…å­˜æ‰“çš„ <code>jvm</code>  çº¿ç¨‹ =&gt; æŸ¥çœ‹å¯¹åº”çº¿ç¨‹æ ˆä¿¡æ¯ =&gt; ä½¿ç”¨ <code>Jmap</code>  æ¥ç”Ÿæˆçº¿ç¨‹å †æ ˆä¿¡æ¯æ–‡ä»¶ =&gt; åˆ†æå¤§å¯¹è±¡ <code>or</code>  å ç”¨å†…å­˜å¤§çš„åŸå›  =&gt;Â  åŸºæœ¬ä¸Šæ”¹ä»£ç æˆ–è€… <code>jvm</code>  é…ç½®ã€‚</p>\n<p>å…¶ä»–æ’æŸ¥é—®é¢˜æ€è·¯å’Œè¿™ä¸ªä¹Ÿæ˜¯å¤§å·®ä¸å·®ï¼Œä½¿ç”¨çš„å‘½ä»¤ä¸åŒè€Œå·²ã€‚</p>\n<h3 id=\"æ¡ˆä¾‹\"><a class=\"markdownIt-Anchor\" href=\"#æ¡ˆä¾‹\">#</a> æ¡ˆä¾‹</h3>\n<details class=\"warning\"><summary>ä¸¾ä¸ªæ —å­ğŸŒ°å§</summary><div>\n<p>æ¯”è¾ƒå¸¸è§çš„åº”è¯¥æ˜¯ï¼š  <code>java.lang. outOfMemoryError: Java heap Space</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤ºOOM æ’æŸ¥è¿‡ç¨‹</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">heapSpaceError</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> Thread(() -&gt; bigObject());</span><br><span class=\"line\">    thread.start();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ¼”ç¤ºå¤§å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"comment\"> * -Xms128M -Xmx128M</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">bigObject</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 21 å¯ä»¥ï¼Œ22å°±ä¼šOOM</span></span><br><span class=\"line\">    <span class=\"comment\">// 4* 1024 * 1024 = 4M * 32 = 128M</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span>[] integers = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[<span class=\"number\">1024</span> * <span class=\"number\">1024</span> * <span class=\"number\">22</span>];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œåå‘ç°æ§åˆ¶å°æ‰“å°å‡ºäº† <code>OOM</code>  :  <code>java heap space</code> .Â  å¥½å§ï¼Œå°±è£…ä½œçœ‹ä¸è§å§</p>\n<p>1ã€ä½¿ç”¨  <code>jps</code>  å‘½ä»¤è·å–åˆ°  <code>jvm</code>  è¿›ç¨‹å·</p>\n<p><img data-src=\"/images/java/jvm/oom%E6%A1%88%E4%BE%8Bjps.png\" alt=\"\"></p>\n<p>2ã€ä½¿ç”¨  <code>jmap</code>  å‘½ä»¤ <code>dump</code>  å‡º å †æ ˆä¿¡æ¯ã€‚<br>\n<img data-src=\"/images/java/jvm/jdump.png\" alt=\"\"></p>\n<p>3ã€ä½¿ç”¨  <code>mat</code>  å·¥å…·ï¼Œåˆ†æ <code>dump</code>  æ–‡ä»¶å†…å®¹ã€‚Â  (ä¸‹è½½åœ°å€:  <code>https://www.eclipse.org/mat/downloads.php</code> Â  Â ä¸‹è½½æ˜¯çœŸç‰¹ğŸ´çš„æ…¢å•Šï¼Œ<span class=\"label success\">â¤ï¸ä¸€èˆ¬äººæˆ‘ä¸å‘Šè¯‰ä»–ï¼šå…¬ä¼—å·å›å¤ <code>MAT</code>  å°±èƒ½ç›´æ¥è·å–</span>)</p>\n<blockquote>\n<p>å¦‚æœä¸‹è½½ä¹‹åæ— æ³•å¯åŠ¨çš„è¯ï¼Œæç¤º æ— æ³•åˆ›å»ºè™šæ‹Ÿæœºã€‚éœ€è¦ç®€å•é…ç½®ä¸‹ï¼š<br>\n <code>-vm /Library/Java/JavaVirtualMachines/jdk1.8.0_251.jdk/Contents/Home/bin</code></p>\n</blockquote>\n<p>3.1ã€ä¸‹è½½ä¸‹ <code>dump</code>  æ–‡ä»¶ï¼Œä½¿ç”¨æœ¬åœ°åˆ†æ <code>mat</code>  å·¥å…·è¿›è¡Œåˆ†æã€‚</p>\n<p>å¯åŠ¨ <code>mat</code> .<br>\n<img data-src=\"/images/java/jvm/mat.png\" alt=\"\"></p>\n<p><code>Open aÂ  heap Dump</code>  ä¹‹åï¼Œå°±å¯ä»¥æ„‰å¿«çš„åˆ†æäº†ã€‚</p>\n<p>å…·ä½“åˆ†ææ–¹æ³•è¯·è‡ªè¡Œç™¾åº¦å§ã€‚</p>\n<p>3.2ã€å¦‚æœ <code>dump</code>  æ–‡ä»¶è¾ƒå°ï¼Œä¹Ÿå¯ä»¥ <code>java</code>  è‡ªå¸¦çš„å·¥å…· jhat å‘½ä»¤è¿›è¡Œåˆ†æã€‚<br>\n<img data-src=\"/images/java/jvm/jmap.png\" alt=\"\"></p>\n<p>ç„¶åè®¿é—®æœ¬æœºçš„  <code>7000</code>  ç«¯å£ï¼Œå°±å¯ä»¥åˆ°çœ‹åˆ°åˆ†æçš„å†…å®¹äº†ã€‚<br>\n<img data-src=\"/images/java/jvm/image2021-4-15_19-8-56.png\" alt=\"\"><br>\nè¿›å…¥ä¹‹åï¼Œå°±å¯ä»¥çœ‹åˆ°å †å†…å­˜å ç”¨æƒ…å†µçš„æŸ±çŠ¶å›¾äº†ã€‚<br>\n<img data-src=\"/images/java/jvm/heapHistogram.png\" alt=\"\"><br>\nå‘ç°æœ‰  <code>Class[I</code>  å ç”¨æœ€å¤šï¼ŒÂ  Â   <code>Class[I</code>  è¡¨ç¤ºçš„æ˜¯  <code>int</code>  æ•°ç»„ã€‚ é‚£æˆ‘ä»¬å°±æŸ¥ä¸‹ä»£ç é‡Œç”¨åˆ° <code>Class[I</code>  ä¸­çš„åœ°æ–¹ï¼Œ</p>\n<p>å“‡ï¼Œæœç„¶æ˜¯åœ¨  <code>new</code>  äº†ä¸€ä¸ªå¤§çš„æ•°æ®ï¼Œæ’‘çˆ†äº†å†…å­˜ã€‚</p>\n<p>è¡¥å……ä¸‹ï¼š</p>\n<p>å…ˆæŸ¥çœ‹ jvm è¿›ç¨‹å·Â <br>\n <code>Â jpsÂ </code>  Â æ³¨æ„ï¼šåªèƒ½æŸ¥çœ‹å±äºå½“å‰ç”¨æˆ· <code>java</code>  è¿›ç¨‹<br>\nÂ  <code>ps -ef| grep java</code>  æ‰¾åˆ°å¯¹åº”æœåŠ¡çš„è¿›ç¨‹ç¼–å·<br>\n <code>ps -ef| grep æœåŠ¡å</code></p>\n<p>å¦‚ä¸‹å›¾:<br>\n<img data-src=\"/images/java/jvm/%E8%A1%A5%E5%85%85.png\" alt=\"\"><br>\nÂ éœ€è¦æ³¨æ„ä¸‹:</p>\n<p>1) æŸ¥çœ‹å½“å‰åº”ç”¨è¿è¡Œæƒ…å†µä¿¡æ¯ï¼ŒæŸ¥çœ‹æ˜¯å¦é…ç½®äº† <code>gc logï¼š-Xloggc:/apps/srv/instance/damai.gaotu100.com/logs/damai.gaotu100.com-gc.log</code> Â  , å¯ä»¥ä» <code>gc</code>  æ—¥å¿—ä¸­æŸ¥åˆ°å¾ˆå¤šä¿¡æ¯ã€‚</p>\n<p>2ï¼‰æŸ¥çœ‹æ˜¯å¦æœ‰ <code>oom</code>  è‡ªåŠ¨æ‰“å°äºŒè¿›åˆ¶ <code>dump</code>  æ–‡ä»¶ï¼šÂ  <code>-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/apps/srv/instance/damai.gaotu100.com/logs/heapdump.hprof</code> Â  ã€‚</p>\n<blockquote>\n<p>å¦‚æœæ²¡æœ‰é…ç½®ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è‡ªè¡Œæ‰“å°:Â Â  <code>jmap -dump:format=b,file=/apps/srv/instance/test-kefu-web.baijiahulian.com/logs/22316.1.hprof pid</code></p>\n</blockquote>\n<p>è¿™é‡Œæ¨èä¸‹ï¼Œé˜¿é‡Œå¼€æºçš„ jvm æ’æŸ¥å·¥å…·Â  arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰Â  <code>https://arthas.aliyun.com/doc/</code> ã€‚æ–‡æ¡£å¾ˆå…¨ï¼Œéœ€è¦çš„è‡ªè¡Œé˜…è¯»å§ï½ï½</p>\n</div></details>\n<h2 id=\"è§£å†³æ–¹æ¡ˆ-8\"><a class=\"markdownIt-Anchor\" href=\"#è§£å†³æ–¹æ¡ˆ-8\">#</a> è§£å†³æ–¹æ¡ˆ</h2>\n<p>åˆ†äº«é‡åˆ° <code>OOM</code>  é—®é¢˜æ—¶æ€æ ·è§£å†³ï¼Ÿ</p>\n<blockquote>\n<p>é•¿å…„äºç—…è§†ç¥ï¼Œæœªæœ‰å½¢è€Œé™¤ä¹‹ï¼Œæ•…åä¸å‡ºäºå®¶ã€‚ä¸­å…„æ²»ç—…ï¼Œå…¶åœ¨æ¯«æ¯›ï¼Œæ•…åä¸å‡ºäºé—¾ã€‚è‹¥æ‰é¹Šè€…ï¼Œé•µè¡€è„‰ï¼ŒæŠ•æ¯’è¯ï¼Œå‰¯è‚Œè‚¤ï¼Œé—²è€Œåå‡ºé—»äºè¯¸ä¾¯ã€‚ æ‰€ä»¥æ‰æœ‰å‡¡æ­¤è€…ä¸ç—…ç—…ï¼Œæ²»ä¹‹æ— åï¼Œä½¿ä¹‹æ— å½¢ï¼Œè‡³åŠŸä¹‹æˆï¼Œå…¶ä¸‹è°“ä¹‹è‡ªç„¶ã€‚<br>\nè¿™å¥è¯ï¼Œç”¨åœ¨æˆ‘ä»¬è¿™é‡Œå°±æ˜¯Â  ç³»ç»Ÿçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œä¸å‡ºç°ä»»ä½• <code>OOM</code> , å…¶ è°“ä¹‹è‡ªç„¶ã€‚</p>\n</blockquote>\n<p>æ ¹æ®ä¸Šè¿°çš„æ’æŸ¥è¿‡ç¨‹ï¼Œæ‰¾åˆ°äº†é—®é¢˜æ ¹æºä¹‹åï¼Œé‚£å°±<br>\n 1. æ”¹ä»£ç <br>\n 2. è°ƒæ•´å†…å­˜é…ç½®</p>\n<p>å¤§åˆ€é˜”æ–§çš„å¹²å§ï¼</p>\n<div class=\"note success no-icon\">\n<p>å¤§å®¶æœ‰ä»€ä¹ˆå»ºè®®å‘¢ï¼Ÿ</p>\n</div>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<p>æˆ‘ä»¬çœ‹å¾… <code>OOM</code>  åº”è¯¥ä»å…¨é¢æ¥çœ‹ï¼Œæœ‰å¯èƒ½æ˜¯  <code>jvm</code>  å†…å­˜ç¡®å®ç››ä¸ä¸‹è¦åˆ†é…çš„å¯¹è±¡ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ é¢‘ç¹ <code>GC</code> ï¼Œä¸”æ”¶æ•ˆç”šä½å¯¼è‡´çš„ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯å®¿ä¸»æœºä¸Šå†…å­˜ä¸å¤Ÿæ€æ­» <code>jvm</code>  å¯¼è‡´çš„ï¼ŒåŠ è½½çš„ç±»è¿‡å¤§è¿‡å¤šé€ æˆçš„ï¼Œè™šæ‹Ÿå†…å­˜ä¸å¤Ÿç”¨ç­‰ç­‰ã€‚æœ€åä¹Ÿä¸è¦å¿½ç•¥ å †å¤–å†…å­˜çš„å†…å­˜æº¢å‡ºã€‚</p>\n<p>çº¿ä¸Šé‡åˆ°è¿™ç±»é—®é¢˜ï¼Œç¬¬ä¸€è¦åŠæ—¶æ­¢æŸï¼Œæ–¹å¼å¾ˆç®€å•ï¼Œé‡å¯å°±èƒ½è§£å†³ã€‚Â  Â ä¿è¯çº¿ä¸Šå¯ç”¨ä¹‹åï¼Œå†å»æŸ¥é—®é¢˜ï¼Œæ ¹æ²»é—®é¢˜ã€‚Â  åŒæ—¶ä¸ç”¨å¿˜äº†ç›‘æ§çº¿ä¸ŠæœåŠ¡æ˜¯å¦æœ‰å†…å­˜è¦æº¢å‡ºçš„æƒ…å†µï¼ŒåŠæ—¶é‡å¯ï¼Œä¸ºå¤„ç† <code>OOM</code>  é—®é¢˜äº‰å–æ—¶é—´ã€‚</p>\n<p>æ’æŸ¥é—®é¢˜æ—¶ï¼Œé¦–å…ˆæ‰¾åˆ°å¯¹åº” <code>jvm</code>  è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨ <code>jmap</code>  æ‰“å°å‡º å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>jhat</code>  æˆ–è€…  <code>mat</code>  å·¥å…·è¿›è¡Œåˆ†æï¼Œå®šä½åŸå› ã€‚è§£å†³é—®é¢˜ã€‚</p>\n<p>æœ€åï¼Œæˆ‘ä»¬åœ¨ <code>coding</code>  çš„æ—¶å€™ï¼Œè¦æ³¨æ„ä¸‹ï¼Œä¸è¦ç¼–å†™å¯¼è‡´ <code>OOM</code>  ä»£ç ã€‚â€œæœªæœ‰å½¢è€Œé™¤ä¹‹ï½â€</p>\n<h2 id=\"æŠ›ä¸ªé—®é¢˜~\"><a class=\"markdownIt-Anchor\" href=\"#æŠ›ä¸ªé—®é¢˜~\">#</a> æŠ›ä¸ªé—®é¢˜ï½</h2>\n<p>å‘ç”Ÿ OOMï¼Œç¨‹åºä¼šé€€å‡ºå—ï¼Ÿ</p>\n<blockquote>\n<p>ä¸‹æœŸè§</p>\n</blockquote>\n<h4 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h4>\n<p>å¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±<br>\n<img data-src=\"/images/qrcode.jpg\" alt=\"\"></p>\n",
            "tags": [
                "Java",
                "OOM",
                "JVM"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/19/BQ/LeetCode/0001-%E5%8F%8D%E8%BD%AC%E6%95%B0%E7%BB%84/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/19/BQ/LeetCode/0001-%E5%8F%8D%E8%BD%AC%E6%95%B0%E7%BB%84/",
            "title": "LC:åè½¬æ•°ç»„",
            "date_published": "2021-08-19T06:48:55.000Z",
            "content_html": "<h2 id=\"é¢˜ç›®\"><a class=\"markdownIt-Anchor\" href=\"#é¢˜ç›®\">#</a> é¢˜ç›®</h2>\n<blockquote>\n<p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„å…ƒç´ å‘å³ç§»åŠ¨Â kÂ ä¸ªä½ç½®ï¼Œå…¶ä¸­Â kÂ æ˜¯éè´Ÿæ•°ã€‚</p>\n</blockquote>\n<p>è¿›é˜¶ï¼š</p>\n<p>å°½å¯èƒ½æƒ³å‡ºæ›´å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>\nä½ å¯ä»¥ä½¿ç”¨ç©ºé—´å¤æ‚åº¦ä¸ºÂ O (1) çš„Â åŸåœ°Â ç®—æ³•è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ</p>\n<p>ç¤ºä¾‹ 1:</p>\n<p>è¾“å…¥: nums = [1,2,3,4,5,6,7], k = 3<br>\n è¾“å‡º: [5,6,7,1,2,3,4]<br>\n è§£é‡Š:<br>\n å‘å³æ—‹è½¬ 1 æ­¥: [7,1,2,3,4,5,6]<br>\n å‘å³æ—‹è½¬ 2 æ­¥: [6,7,1,2,3,4,5]<br>\n å‘å³æ—‹è½¬ 3 æ­¥: [5,6,7,1,2,3,4]</p>\n<p>ç¤ºä¾‹Â 2:</p>\n<p>è¾“å…¥ï¼šnums = [-1,-100,3,99], k = 2<br>\n è¾“å‡ºï¼š[3,99,-1,-100]<br>\n è§£é‡Š:<br>\n å‘å³æ—‹è½¬ 1 æ­¥: [99,-1,-100,3]<br>\n å‘å³æ—‹è½¬ 2 æ­¥: [3,99,-1,-100]</p>\n<div class=\"note warning\">\n<p>æç¤º</p>\n</div>\n<p>1 &lt;= nums.length &lt;= 2 * 104<br>\n-231 &lt;= nums[i] &lt;= 231 - 1<br>\n0 &lt;= k &lt;= 105</p>\n<hr>\n<div class=\"links\"><div class=\"item\" title=\"åŠ›æ‰£ï¼ˆLeetCodeï¼‰\" style=\"--block-color:#ffa015;\"><span class=\"exturl image\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcm90YXRlLWFycmF5\" data-background-image=\"https://static.leetcode-cn.com/cn-frontendx-assets/production/_next/static/images/lccn-logo-ce3d56eeedaae618e59e2ec5089e4834.svg\"></span>\n          <div class=\"info\">\n          <span class=\"exturl title\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS1jbi5jb20vcHJvYmxlbXMvcm90YXRlLWFycmF5\">åŠ›æ‰£ï¼ˆLeetCodeï¼‰</span>\n          <p class=\"desc\">https://leetcode-cn.com/</p>\n          </div></div></div>\n<h2 id=\"åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#åˆ†æ\">#</a> åˆ†æ</h2>\n<h3 id=\"è§£æ³•1é¡ºåºåç§»æ³•\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•1é¡ºåºåç§»æ³•\">#</a> è§£æ³• 1: é¡ºåºåç§»æ³•</h3>\n<p>å°†æœ€åä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™ä¸´æ—¶å˜é‡ï¼Œç„¶åå°†å…¶ä»–å…ƒç´ é¡ºåºåç§»ä¸€ä¸ªä½ç½®ã€‚é‡å¤æ­¤æ“ä½œ k æ¬¡ã€‚</p>\n<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯:</p>\n<ul>\n<li>æ—¶é—´å¤æ‚åº¦ã€‚è¿™ç§ç®—æ³•åœ¨æœ€ä¼˜æ—¶æ—¶é—´å¤æ‚åº¦æ˜¯ O (n). æœ€å·®æƒ…å†µä¸‹æ˜¯ O (n^2). åœ¨ LeetCode ä¸Šæ˜¯æ²¡æ³• AC çš„ã€‚</li>\n<li>k æ˜¯ä¼šå¤§äºæ•°ç»„é•¿åº¦çš„ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums, <span class=\"keyword\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums == <span class=\"keyword\">null</span> || k &lt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums.length &lt; k) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// è§£å†³k&gt;nums.lengthé—®é¢˜</span></span><br><span class=\"line\">        k = k % nums.length;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> length = nums.length;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; k; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> temp = nums[length - <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = length - <span class=\"number\">1</span>; j &gt; <span class=\"number\">0</span>; j--) &#123;</span><br><span class=\"line\">            nums[j] = nums[j - <span class=\"number\">1</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        nums[<span class=\"number\">0</span>] = temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™ç§è§£å†³æ–¹æ³•åœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹å°±ä¼šæŠ¥é”™ <code>è¶…å‡ºæ—¶é—´é™åˆ¶äº†</code> ã€‚<br>\nå³ä½¿ ä½ åœ¨å¾ªç¯ä¿®æ”¹ä½¿ç”¨  <code>System.arraycopy(nums, 0, nums, 1, length - 1);</code>  æ¥æ›¿æ¢æ‰å†…å±‚å¾ªç¯ï¼Œä¹Ÿæ˜¯ä¸å¯ä»¥ <code>AC</code>  çš„ã€‚</p>\n<h3 id=\"è§£æ³•2-ä¼˜åŒ–è§£æ³•1ç©ºé—´æ¢æ—¶é—´\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•2-ä¼˜åŒ–è§£æ³•1ç©ºé—´æ¢æ—¶é—´\">#</a> è§£æ³• 2: ä¼˜åŒ–è§£æ³• 1, ç©ºé—´æ¢æ—¶é—´</h3>\n<p>æŒ‰ç…§è§„å¾‹å°† nums æ•°ç»„ä¸­çš„å€¼ï¼Œèµ‹å€¼åˆ°æ–°æ•°ç»„ä¸­ã€‚ç„¶åä½¿ç”¨æ–°æ•°ç»„è¦†ç›–åŸæ•°ç»„ã€‚<br>\né‚£è§„å¾‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>\n è®¾ï¼š<br>\n <code>i</code>  ä¸ºæ•°ç»„çš„çš„ä¸‹æ ‡ã€‚  <code>newArr</code>  ä¸ºæ–°çš„æ•°ç»„ï¼Œ <code>n</code>  ä¸ºæ•°ç»„æ€»é•¿åº¦ï¼Œ<br>\n é‚£ä¹ˆ</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">newArr[(i+k)%n] = nums[i]</span><br></pre></td></tr></table></figure>\n<p><code>AC</code>  ä»£ç å¦‚ä¸‹:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums, <span class=\"keyword\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nums == <span class=\"keyword\">null</span> || k &lt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = nums.length;</span><br><span class=\"line\">    <span class=\"comment\">// æ–°æ•°ç»„</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span>[] newArr = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[n];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; k; i++) &#123;</span><br><span class=\"line\">        newArr[(i + k) % n] = nums[i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    System.arraycopy(newArr, <span class=\"number\">0</span>, nums, <span class=\"number\">0</span>, n);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>AC ä¹‹åæ˜¾ç¤ºï¼š<br>\næ‰§è¡Œç”¨æ—¶  <code>1 ms</code> <br>\n å†…å­˜æ¶ˆè€—ï¼š <code>55.1 MB</code></p>\n<p>è¿™ç§æ–¹å¼ï¼Œæ—¶é—´å¤æ‚åº¦å¾—åˆ°æ˜¾è‘—çš„æå‡ï¼Œä½†æ˜¯å¸¦æ¥äº†é¢å¤–çš„ç©ºé—´æ¶ˆè€—ã€‚è€Œä¸”è¿™ç§ç©ºé—´æ¶ˆè€—æ˜¯ç­‰äºåŸæ¥å ç”¨çš„æ•°æ®å¤§å°ã€‚</p>\n<p>é‚£æ˜¯å¦è¿˜æœ‰å…¶ä»–æ–¹å¼å‘¢ï¼Ÿ</p>\n<h3 id=\"è§£æ³•3-åè½¬\"><a class=\"markdownIt-Anchor\" href=\"#è§£æ³•3-åè½¬\">#</a> è§£æ³• 3: åè½¬</h3>\n<p>è¿™ç§æ–¹å¼æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„æ–¹å¼ï¼Œæœ‰ç‚¹ç±»ä¼¼äºè„‘ç­‹æ€¥è½¬å¼¯çš„æ„æ€ã€‚æŠ›å¼€ä¹‹å‰çš„ç¯è£…æ€è·¯ã€‚å°†è¿™ä¸ªæ•°ç»„çœ‹æˆå…·æœ‰æ–¹å‘çš„ä¸€ç»„æ•°æ®ã€‚å°†è¿™ç»„æ•°æ®åˆ†æˆä¸‰ç»„ï¼š <code>[0,k-1]</code> , <code>k</code> , <code>[k+1,length]</code> . å…ˆå°†  <code>[0,k-1]</code>  åè½¬ï¼Œå†æŠŠ  <code>[k+1,length]</code>  åè½¬ï¼Œæœ€åæŠŠè¿™ä¸ªæ•°ç»„åè½¬ã€‚è¿™æ ·æ“ä½œä¹‹åï¼Œå°±æ˜¯æœ€åç»“æœäº†ã€‚</p>\n<p>æ¯”å¦‚ï¼Œæ•°ç»„ï¼š <code>[1,2,3,4,5,6,7]</code> ,  <code>k=3</code></p>\n<p>ç¬¬ä¸€æ­¥ï¼šæŠŠæ•´ä½“æ•°ç»„è¿›è¡Œåè½¬:  <code>[1,2,3,4,5,6,7]</code>  =&gt;  <code>[7,6,5,4,3,2,1]</code> <br>\n ç¬¬äºŒæ­¥ï¼šæŠŠ <code>[0,k-1=2]</code>  çš„å…ƒç´ è¿›è¡Œåè½¬:  <code>[7,6,5,4,3,2,1]</code>  =&gt; <code>[5,6,7,4,3,2,1]</code> <br>\n ç¬¬ä¸‰æ­¥ï¼šæŠŠ <code>[k,n-1]</code>  çš„å…ƒç´ è¿›è¡Œåè½¬:  <code>[5,6,7,4,3,2,1]</code>  =&gt; <code>[5,6,7,1,2,3,4]</code></p>\n<p>å®ç°ä»£ç å¦‚ä¸‹:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">rotate</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums, <span class=\"keyword\">int</span> k)</span> </span>&#123;</span><br><span class=\"line\">    k %= nums.length;</span><br><span class=\"line\">    reverse(nums, <span class=\"number\">0</span>, nums.length - <span class=\"number\">1</span>);</span><br><span class=\"line\">    reverse(nums, <span class=\"number\">0</span>, k - <span class=\"number\">1</span>);</span><br><span class=\"line\">    reverse(nums, k, nums.length - <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">reverse</span><span class=\"params\">(<span class=\"keyword\">int</span>[] nums, <span class=\"keyword\">int</span> start, <span class=\"keyword\">int</span> end)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (start &lt; end) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> temp = nums[start];</span><br><span class=\"line\">        nums[start] = nums[end];</span><br><span class=\"line\">        nums[end] = temp;</span><br><span class=\"line\">        start += <span class=\"number\">1</span>;</span><br><span class=\"line\">        end -= <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ€è€ƒ\"><a class=\"markdownIt-Anchor\" href=\"#æ€è€ƒ\">#</a> æ€è€ƒ</h2>\n<p>å…³äºè¿™é“é¢˜ç›®çš„ä¸€ç‚¹å°æ€è€ƒ:</p>\n<ul>\n<li>è¿™é“é¢˜å…¶å®è¿˜æœ‰å¦å¤–ä¸€ç§è§£æ³•ï¼Œå°±æ˜¯é€šè¿‡å…¬å¼å»æ¨å¯¼å‡ºå…ƒç´ åº”è¯¥æœ€ç»ˆæ‰€åœ¨çš„ä½ç½®ï¼Œç›´æ¥è¿›è¡Œä½ç½®äº¤æ¢ã€‚è¿™ç§æ€è·¯ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚å…·ä½“è§£å†³å¯ä»¥å‚ç…§ä¸‹å®˜ç½‘çš„è§£é¢˜æ–¹æ³•ã€‚</li>\n<li>è¿™æ˜¯ä¸€é“å¾ˆç®€å•çš„é¢˜ç›®ï¼Œæœ€åå‡ºå¥‡çš„è§£æ³•ä¹Ÿæ˜¯é¢‡æ„Ÿæ„å¤–çš„ï¼Œæ€»æœ‰ä¸€ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰ã€‚æˆ‘ä¸€ç›´åœ¨æƒ³æ­¤æ³•çš„è§£é¢˜äººæ˜¯æ€ä¹ˆæƒ³åˆ°çš„å‘¢ã€‚<span class=\"label warning\">è¿™é‡Œé¢ä¸€å®šæ˜¯è•´å«ä¸€å®šçš„é€»è¾‘çš„ã€‚è¿™ç§å¤šæ¬¡åè½¬çš„é€»è¾‘ï¼Œæˆ–è®¸æ˜¯ä¸€ç§è§„å¾‹ï¼Ÿ</span> æˆ‘ä¸€ç›´æ²¡æœ‰æƒ³é€šã€‚</li>\n<li>å½“ä½ æƒ³åˆ°è¿™ä¸ªå¯ä»¥ç”¨ä¸€ä¸ªç¯å»è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œå¯èƒ½æ°¸è¿œå°±æƒ³ä¸å‡º &quot;åˆ©ç”¨æ–¹å‘&quot; å»è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚åè§‚é¢˜ç›®æ¥è®²ï¼Œä¸€ç›´éƒ½æ˜¯è¯´çš„æ•°ç»„ï¼Œè€Œ â€œç¯â€ æ˜¯æˆ‘ä»¬è‡ªå·±å¼ºåŠ çš„ä¸€ä¸ªæ€ç»´æ–¹å¼ã€‚ç¡®å®ï¼Œå½“æˆ‘ä»¬ä»ç¯çš„è§’åº¦å‡ºå‘ï¼Œçœ‹åˆ°çš„å°±ä¸æ˜¯é¢˜ç›®æœ¬èº«äº†ï¼Œçœ‹åˆ°çš„æ˜¯ä½ çš„é¢˜ç›®ã€‚<span class=\"label success\">âœ”ï¸ åè§‚ç°å®ï¼Œä½ ç†è§£çš„ç°å®å°±çœŸæ­£çš„æ˜¯ç°å®å—ï¼Ÿä½ æœ‰æ²¡æœ‰é™·å…¥è‡ªå·±çš„ â€œç¯â€ ä¸­å»å‘¢ï¼Ÿä¸å¦¨ï¼Œé‡æ–°çœ‹çœ‹ä½ èº«è¾¹çš„äººå’Œäº‹å§ï¼Œå°è¯•å‘ç°ä»–ä»¬æœ€çœŸå®çš„æ ·å­.</span></li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "æ•°æ®ç»“æ„",
                "leetCode",
                "é¢ç»ä¹‹ç®—æ³•é¢˜",
                "æ•°ç»„"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/18/git%E7%B3%BB%E5%88%97/%E7%B3%BB%E5%88%97%E5%BC%80%E7%AF%87/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/18/git%E7%B3%BB%E5%88%97/%E7%B3%BB%E5%88%97%E5%BC%80%E7%AF%87/",
            "title": "gitç³»åˆ—å¼€ç¯‡",
            "date_published": "2021-08-18T06:48:55.000Z",
            "content_html": "<p>è¿™ä¸ªæ˜¯ç»§  <code>Redis</code>  ,  <code>MySQL</code>  ä¹‹åçš„ç¬¬ä¸‰ä¸ªç³»åˆ—äº†ã€‚<br>\nç„¶è€Œï¼Œå‰ä¸¤ä¸ªç³»åˆ—è¿˜éƒ½æ²¡æœ‰å†™å®Œã€‚<br>\n <code>so</code> ,  <code>Redis</code>  å’Œ  <code>MySQL</code>  pause.</p>\n<p>åªæ˜¯æš‚åœï½ï¼Œæˆ‘ä¼šåœ¨æœªæ¥çš„ä¸‰å¹´å†…ï¼Œå°†å®ƒä»¬å…¨éƒ¨å®Œæˆã€‚</p>\n<p>å®ï½</p>\n<p><code>git</code> ï¼</p>\n<p>è¯´åˆ° <code>git</code> ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªäººï¼Œ <code>linus Torvalds</code>  ï¼ˆæ—çº³æ–¯ãƒ»æ‰˜ç“¦å…¹ï¼‰</p>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/LinusTorvalds01.jpg\" alt=\"linusÂ·Torvalds\"></p>\n<p>æ—çº³æ–¯ãƒ»æ‰˜ç“¦å…¹ æ˜¯å½“ä»Šä¸–ç•Œæœ€è‘—åçš„ç”µè„‘ç¨‹åºå‘˜ã€é»‘å®¢ä¹‹ä¸€ã€‚ä»–æ˜¯ linux å†…æ ¸çš„æœ€æ—©ä½œè€…ï¼Œéšåå‘èµ·äº†è¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œæ‹…ä»» linux å†…æ ¸çš„é¦–è¦æ¶æ„å¸ˆå’Œé¡¹ç›®åè°ƒè€…ã€‚å¹¶äº 2005 å¹´ 7 æœˆ 11 æ—¥ï¼Œå‘å¸ƒäº†ä»…ç”¨ 10 å¤©æ—¶é—´å¼€å‘å‡ºçš„æœ€æ—©ç‰ˆæœ¬çš„ git 0.99ã€‚åˆ°ä»Šå¤© (2020 å¹´ 7 æœˆ 13 æ—¥)ï¼Œæœ€æ–°çš„ç‰ˆæœ¬å·æ˜¯ 2.27. è¿™ä¸ªç³»åˆ—å°±ä»¥è¯¥ç‰ˆæœ¬è¿›è¡Œåˆ†äº«ã€‚</p>\n<p>å…³äºæ›´å¤šå†…å®¹ï¼ŒæŸ¥çœ‹è¿™é‡Œ -&gt; <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU2JTlFJTk3JUU3JUJBJUIzJUU2JTk2JUFGJUMyJUI3JUU2JTg5JTk4JUU3JTkzJUE2JUU1JTg1JUI5\">æ—çº³æ–¯ãƒ»æ‰˜ç“¦å…¹</span></p>\n<h2 id=\"git\"><a class=\"markdownIt-Anchor\" href=\"#git\">#</a> git</h2>\n<p><code>2002</code>  å¹´å¼€å§‹ï¼Œæ—çº³æ–¯ãƒ»æ‰˜ç“¦æ–¯ å†³å®šä½¿ç”¨  <code>BitKeeper</code>  ä½œä¸ºä¸»è¦çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥ç»´æŠ¤ä»£ç ã€‚ä½†æ˜¯ç¤¾åŒºä¸­å¾ˆå¤šäººè®¤ä¸ºï¼Œåº”è¯¥ä½¿ç”¨å¼€æºçš„ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶æ¥ç»´æŠ¤ä»£ç  æ—çº³æ–¯ãƒ»æ‰˜ç“¦æ–¯ä¹Ÿè€ƒè™‘ä½¿ç”¨ <code>monotone</code> ï¼Œä½†æ˜¯ æ—çº³æ–¯ãƒ»æ‰˜ç“¦æ–¯ å«Œå¼ƒå…¶æ€§èƒ½ä¸ä½³ã€‚åœ¨ <code>2005</code>  å¹´ï¼Œæ—çº³æ–¯å†³å®šè‡ªè¡Œå¼€å‘ä¸€å¥—ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚</p>\n<p>ä¸ºä»€ä¹ˆç§°ä¸º <code>git</code>  å‘¢ï¼Ÿ</p>\n<p><code>git</code>  åœ¨è‹±æ°ä¿šè¯­ä¸­è¡¨ç¤º ä¸æ„‰å¿«çš„äººã€‚</p>\n<p>ä¸‹é¢æ˜¯ æ—çº³æ–¯ãƒ»æ‰˜ç“¦å…¹ å¯¹ <code>git</code>  çš„æè¿°</p>\n<blockquote>\n<p>The name â€œgitâ€ was given by Linus Torvalds when he wrote the very first version. He described the tool as â€œthe stupid content trackerâ€ and the name as (depending on your way):<br>\nrandom three-letter combination that is pronounceable, and not actually used by any common UNIX command. The fact that it is a mispronunciation of â€œgetâ€ may or may not be relevant.<br>\nâ€œglobal information trackerâ€: youâ€™re in a good mood, and it actually works for you. Angels sing, and a light suddenly fills the room.<br>\nstupid. contemptible and despicable. simple. Take your pick from the dictionary of slang.</p>\n</blockquote>\n<p>æ—çº³æ–¯ãƒ»æ‰˜ç“¦å…¹åœ¨ç¼–å†™ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ—¶å°±ä½¿ç”¨äº† <code>â€œgitâ€</code>  è¿™ä¸ªåç§°ã€‚ ä»–å°†å·¥å…·æè¿°ä¸º â€œæ„šè ¢çš„å†…å®¹è·Ÿè¸ªå™¨â€ï¼Œå¹¶å°†å…¶æè¿°ä¸ºï¼ˆå–å†³äºæ‚¨çš„æ–¹å¼ï¼‰ï¼š</p>\n<ul>\n<li>å¯ä»¥å‘éŸ³å¿µå‡ºçš„éšæœºä¸‰ä¸ªå­—æ¯ç»„åˆï¼Œè€Œä¸”å¹¶æœªè¢«å®é™…ç”¨åœ¨ä»»ä½•  <code>UNIX</code>  æŒ‡ä»¤ä¸Šã€‚å®ƒæ˜¯ <code>â€œgetâ€</code>  çš„é”™è¯¯å‘éŸ³ï¼Œè¿™ç‚¹å¯èƒ½ç›¸å…³ä¹Ÿå¯èƒ½æ— å…³ã€‚</li>\n<li>â€œå…¨å±€çš„ä¿¡æ¯è·Ÿè¸ªå™¨â€ï¼šæ‚¨çš„å¿ƒæƒ…ä¸é”™ï¼Œå¯¹ä½ è€Œè¨€å®ƒä¹Ÿç¡®å®è¯´å¾—é€šã€‚å¤©ä½¿å”±æ­Œï¼Œæˆ¿é—´çªç„¶å……æ»¡å…‰æ˜ã€‚( <code>Global Information tracker</code> )</li>\n<li>æ„šè ¢çš„ã€‚é„™è§†å’Œå‘é„™çš„ã€‚ç®€å•ã€‚ä»ä¿šè¯­å­—å…¸ä¸­é€‰æ‹©ã€‚</li>\n</ul>\n<h3 id=\"gitçš„å®ç°åŸç†\"><a class=\"markdownIt-Anchor\" href=\"#gitçš„å®ç°åŸç†\">#</a> git çš„å®ç°åŸç†</h3>\n<p><code>git</code>  æ›´åƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œç›´æ¥ä»æœ¬æœºä¸Šè·å–æ•°æ®ï¼Œä¸ç”¨è¿æ¥æœåŠ¡ç«¯ï¼Œæ¯ä¸ªå¼€å‘è€…éƒ½å¯æœ‰å…¨éƒ¨å¼€å‘å†å²çš„æœ¬åœ°å‰¯æœ¬ï¼Œ <code>changes</code>  ä»è¿™ç§æœ¬åœ° <code>repository</code>  å¤åˆ¶ç»™å…¶ä»–å¼€å‘è€…ã€‚è¿™äº› <code>changes</code>  ä½œä¸ºæ–°å¢çš„å¼€å‘åˆ†æ”¯è¢«å¯¼å…¥ï¼Œå¯ä»¥ä¸æœ¬åœ°å¼€å‘åˆ†æ”¯åˆå¹¶ã€‚</p>\n<p>è€Œä¸”ï¼Œåˆ†æ”¯æ˜¯è½»é‡çš„ï¼Œä¸€ä¸ªåˆ†æ”¯æ˜¯å¯¹ä¸€ä¸ª <code>commit</code>  çš„å¼•ç”¨ã€‚</p>\n<p><code>git</code>  ä½¿ç”¨ C è¯­è¨€è¿›è¡Œå¼€å‘çš„ï¼Œä»¥è¿½æ±‚æ›´é«˜çš„æ€§èƒ½ã€‚ <code>git</code>  è‡ªåŠ¨å®Œæˆäº†åƒåœ¾å›æ”¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡  <code>git gc --prune</code></p>\n<p><code>git</code>  å­˜å‚¨æ¯ä¸ªæ–°åˆ›å»ºçš„ <code>object</code>  ä½œä¸ºä¸€ä¸ªå•ç‹¬æ–‡ä»¶ã€‚ä¸ºäº†å‹ç¼©å­˜å‚¨ç©ºé—´å ç”¨ï¼Œ  <code>packs</code>  æ“ä½œæŠŠå¾ˆå¤šæ–‡ä»¶ï¼ˆå¯å‘å¼ç±»ä¼¼åå­—çš„æ–‡ä»¶å¾€å¾€å…·æœ‰ç±»ä¼¼å†…å®¹ï¼‰ä½¿ç”¨å·®åˆ†å‹ç¼©å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆ <code>packfile</code> ï¼‰ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•æ–‡ä»¶ï¼ŒæŒ‡æ˜ <code>object</code>  åœ¨ <code>packfile</code>  ä¸­çš„åç§»å€¼ã€‚æ–°åˆ›å»ºçš„å¯¹è±¡ä»ç„¶ä½œä¸ºå•ç‹¬æ–‡ä»¶å­˜åœ¨ã€‚ <code>repacks</code>  æ“ä½œéå¸¸è´¹æ—¶é—´ï¼Œ <code>git</code>  ä¼šåœ¨ç©ºé—²æ—¶é—´è‡ªåŠ¨åšæ­¤æ“ä½œã€‚ä¹Ÿå¯ç”¨å‘½ä»¤ <code>git gc</code>  æ¥ç›´æ¥å¯åŠ¨ <code>repack</code> ã€‚ <code>packfile</code>  ä¸ç´¢å¼•æ–‡ä»¶éƒ½ç”¨ SHA-1 ä½œä¸ºæ ¡éªŒå’Œå¹¶ä½œä¸ºæ–‡ä»¶åã€‚ <code>git fsck</code>  å‘½ä»¤åšæ ¡éªŒå’Œçš„å®Œæ•´æ€§éªŒè¯ã€‚</p>\n<p>Git æœåŠ¡å™¨å…¸å‹çš„ TCP ç›‘å¬ç«¯å£ä¸º <code>9418</code> ã€‚</p>\n<p><code>git</code>  å’Œå…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ <code>CVS</code> ï¼‰æœ‰ä¸å°çš„å·®åˆ«ï¼Œ <code>git</code>  æœ¬èº«å…³å¿ƒæ–‡ä»¶çš„æ•´ä½“æ€§æ˜¯å¦æœ‰æ”¹å˜ï¼Œä½†å¤šæ•°çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¦‚ <code>CVS</code>  æˆ– <code>Subversion</code>  ç³»ç»Ÿåˆ™åœ¨ä¹æ–‡ä»¶å†…å®¹çš„å·®å¼‚ã€‚ <code>git</code>  æ‹’ç»ä¿æŒæ¯ä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬ä¿®è®¢å…³ç³»ã€‚å› æ­¤æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„å†å²éœ€è¦éå†å„ä¸ª <code>history</code>  å¿«ç…§ï¼› <code>git</code>  éšå¼å¤„ç†æ–‡ä»¶æ›´åï¼Œå³åŒåæ–‡ä»¶é»˜è®¤ä¸ºå…¶å‰èº«ï¼Œå¦‚æœæ²¡æœ‰åŒåæ–‡ä»¶åˆ™åœ¨å‰ä¸€ä¸ªç‰ˆæœ¬ä¸­æœç´¢å…·æœ‰ç±»ä¼¼å†…å®¹çš„æ–‡ä»¶.</p>\n<p>ä»¥ä¸Šç®€è¦ä»‹ç»ï¼Œå…ˆåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œ <code>git</code>  è¿™ä¸€ç³»åˆ—æ–‡ç« çš„ç›®å½•ã€‚</p>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> git ä»‹ç»</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> git å®‰è£…</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" disabled=\"true\"><label for=\"cbx_2\"> git ç®€å•ä½¿ç”¨<br>\nä»‹ç» git addã€commitã€mergeã€checkoutã€resetâ€¦ ç­‰åŸºç¡€å‘½ä»¤çš„ä½¿ç”¨ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" disabled=\"true\"><label for=\"cbx_3\"> git ä½¿ç”¨è¿›é˜¶<br>\nä»‹ç»ï¼šgit diffã€logã€reflogï¼Œcherry-pick ç­‰å‘½ä»¤çš„ä½¿ç”¨</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" disabled=\"true\"><label for=\"cbx_4\"> git é«˜çº§å‘½ä»¤</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" disabled=\"true\"><label for=\"cbx_5\"> git åº•å±‚å‘½ä»¤</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" disabled=\"true\"><label for=\"cbx_6\"> git åˆ†æ”¯</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" disabled=\"true\"><label for=\"cbx_7\"> git è¿œç¨‹ä»“åº“</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" disabled=\"true\"><label for=\"cbx_8\"> git å·¥ä½œæµ</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_9\" disabled=\"true\"><label for=\"cbx_9\"> git æœç´¢</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_10\" disabled=\"true\"><label for=\"cbx_10\"> git å†è°ˆé‡ç½®</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_11\" disabled=\"true\"><label for=\"cbx_11\"> git å®‰å…¨æ€§éªŒè¯</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_12\" disabled=\"true\"><label for=\"cbx_12\"> git é’©å­</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_13\" disabled=\"true\"><label for=\"cbx_13\"> git ä¼ è¾“åè®®</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_14\" disabled=\"true\"><label for=\"cbx_14\"> git æ•°æ®ç»´æŠ¤å’Œä¿®å¤</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_15\" disabled=\"true\"><label for=\"cbx_15\"> git å·¥ä½œåŸç†</label></li>\n</ul>\n<h3 id=\"æ¨èä¹¦ç±\"><a class=\"markdownIt-Anchor\" href=\"#æ¨èä¹¦ç±\">#</a> æ¨èä¹¦ç±</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXQtc2NtLmNvbS9ib29rL3poL3Yy\">git-doc</span><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGlhb3h1ZWZlbmcuY29tL3dpa2kvODk2MDQzNDg4MDI5NjAw\"> å»–é›ªå³° Git æ•™ç¨‹</span></p>\n<p><b>ä¸€ä¸ªä¸é”™çš„ Github ä»“åº“ï¼š</b> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Bjb3R0bGUvbGVhcm5HaXRCcmFuY2hpbmc=\">æ¸¸æˆä¸­å­¦ git</span></p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç›®å½•",
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/04/%E9%9D%A2%E7%BB%8F/%E7%BA%BF%E7%A8%8B%E6%B1%A0/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/04/%E9%9D%A2%E7%BB%8F/%E7%BA%BF%E7%A8%8B%E6%B1%A0/",
            "title": "JDKçš„å†…ç½®çº¿ç¨‹æ± ",
            "date_published": "2021-08-04T06:14:00.000Z",
            "content_html": "<h1 id=\"çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆ\"><a class=\"markdownIt-Anchor\" href=\"#çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆ\">#</a> çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ</h1>\n<p>çº¿ç¨‹æ± å¯ä»¥æ§åˆ¶çº¿ç¨‹è¿è¡Œçš„æ•°é‡ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡ï¼Œé‚£ä¹ˆè¶…å‡ºæ•°é‡çš„çº¿ç¨‹å°±ä¼šæ’é˜Ÿç­‰å€™ï¼Œç­‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚</p>\n<p>ä¸»è¦ç‰¹ç‚¹ä¸ºï¼š<br>\n1ã€é™ä½èµ„æºæ¶ˆè€—ï¼Œé€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚<br>\n2ã€æä¾›å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºï¼Œèƒ½å¤Ÿç«‹å³æ‰§è¡Œã€‚<br>\n3ã€æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</p>\n<h1 id=\"çº¿ç¨‹æ± å‚æ•°\"><a class=\"markdownIt-Anchor\" href=\"#çº¿ç¨‹æ± å‚æ•°\">#</a> çº¿ç¨‹æ± å‚æ•°ï¼š</h1>\n<ul>\n<li><code>corePoolSize</code> : çº¿ç¨‹æ± ä¸­å¸¸é©»çš„çº¿ç¨‹æ•°ã€‚</li>\n<li><code>maximumPoolSize</code> : çº¿ç¨‹æ± ä¸­èƒ½å¤Ÿå®¹çº³åŒæ—¶æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤å€¼å¿…é¡»å¤§äº 1.</li>\n<li><code>keepAliveTime</code> : å¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ã€‚å½“å‰çº¿ç¨‹æ± æ•°é‡è¶…è¿‡ <code>corePoolSize</code>  æ—¶ï¼Œå½“ç©ºé—²æ—¶é—´è¾¾ <code>keepAliveTime</code>  å€¼æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ç›´åˆ°å‰©ä¸‹ <code>corePoolSize</code>  ä¸ªçº¿ç¨‹ä¸ºæ­¢ã€‚</li>\n<li><code>unit</code> :  <code>keepAliveTime</code>  çš„å•ä½.</li>\n<li><code>workQueue</code> : ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªæ‰§è¡Œçš„ä»»åŠ¡.</li>\n<li><code>threadFactory</code> : è¡¨ç¤ºç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ã€‚</li>\n<li><code>headler</code> : æ‹’ç»ç­–ç•¥ï¼Œè¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”å·¥ä½œçº¿ç¨‹å¤§äºç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•° ( <code>maximumPoolSize</code> ) æ—¶é‡‡å–çš„æªæ–½ã€‚</li>\n</ul>\n<h1 id=\"çº¿ç¨‹æ± è¿è¡ŒåŸç†\"><a class=\"markdownIt-Anchor\" href=\"#çº¿ç¨‹æ± è¿è¡ŒåŸç†\">#</a> çº¿ç¨‹æ± è¿è¡ŒåŸç†ï¼š</h1>\n<ul>\n<li><code>1</code> . åœ¨åˆ›å»ºçº¿ç¨‹ä¹‹åï¼Œç­‰å¾…æäº¤è¿‡æ¥çš„ä»»åŠ¡è¯·æ±‚ã€‚</li>\n<li><code>2</code> . å½“è°ƒç”¨ <code>execute()</code>  æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­ï¼š\n<ul>\n<li><code>2.1</code> ã€å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº <code>corePoolSize</code> ï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚</li>\n<li><code>2.2</code> ã€å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº <code>corePoolSize</code> ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ã€‚</li>\n<li><code>2.3</code> ã€å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äº <code>maximumPoolSize</code> , é‚£ä¹ˆåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ l ç«‹åˆ»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚</li>\n<li><code>2.4</code> ã€å¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–è€…ç­‰äºè¿™ä¸ª <code>maximumPoolSize</code> , é‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œã€‚</li>\n</ul>\n</li>\n<li><code>3</code> ã€å½“çº¿ç¨‹æ‰§è¡Œå®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚</li>\n<li><code>4</code> ã€å½“çº¿ç¨‹æ— äº‹å¯åšè¶…è¿‡ä¸€å®šçš„æ—¶é—´ ( <code>keepAliveTime</code> ) æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­ï¼š<br>\nå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº <code>corePoolSize</code> ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«åœæ‰ã€‚<br>\næ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ° <code>corePoolSize</code>  çš„å¤§å°ã€‚</li>\n</ul>\n<h1 id=\"çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥\"><a class=\"markdownIt-Anchor\" href=\"#çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥\">#</a> çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥</h1>\n<p>æ‹’ç»ç­–ç•¥å®ç°äº†  <code>RejectedExecutionHandler</code>  æ¥å£ã€‚</p>\n<h2 id=\"jdkå†…ç½®çš„å››ç§\"><a class=\"markdownIt-Anchor\" href=\"#jdkå†…ç½®çš„å››ç§\">#</a> JDK å†…ç½®çš„å››ç§:</h2>\n<ul>\n<li><code>AbortPolicy</code>  (é»˜è®¤): ç›´æ¥æŠ›å‡º <code>RejectedExecutionException</code>  å¼‚å¸¸é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚</li>\n<li><code>CallerRunsPolicy</code> : â€œè°ƒç”¨è€…è¿è¡Œâ€ ä¸€ç§è¿è¡Œæœºåˆ¶ï¼Œè¯¥ç­–ç•¥æ—¢ä¸ä¼š æŠ›å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å›ç»™è°ƒç”¨è€…ï¼Œä»è€Œå‡è½»æ–°ä»»åŠ¡æµé‡ã€‚</li>\n<li><code>DiscardOldestPolicy</code> : æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ï¼Œç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ä¸­å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</li>\n<li><code>DiscardPolicy</code> : ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„</li>\n</ul>\n<h1 id=\"å¦‚ä½•é…ç½®çº¿ç¨‹æ± å‚æ•°\"><a class=\"markdownIt-Anchor\" href=\"#å¦‚ä½•é…ç½®çº¿ç¨‹æ± å‚æ•°\">#</a> å¦‚ä½•é…ç½®çº¿ç¨‹æ± å‚æ•°</h1>\n<ul>\n<li>\n<p>CPU å¯†é›†å‹:<br>\n éœ€è¦å¤§é‡çš„è¿ç®—ï¼Œæ²¡æœ‰é˜»å¡ã€‚CPU ä¸€ç›´åœ¨å…¨é€Ÿè¿è¡Œã€‚<br>\nCPU å¯†é›†å‹ä»»åŠ¡åªæœ‰åœ¨çœŸæ­£çš„å¤šæ ¸ CPU ä¸Šæ‰å¯ä»¥å¾—åˆ°åŠ é€Ÿ</p>\n<p><b>å‚è€ƒå…¬å¼ï¼š CPU æ ¸å¿ƒæ•° + 1 ä¸ªçº¿ç¨‹</b></p>\n</li>\n<li>\n<p>IO å¯†é›†å‹ï¼š<br>\nå³è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„ IOï¼Œå³å¤§é‡çš„é˜»å¡ã€‚<br>\nåœ¨å•çº¿ç¨‹ä¸Šè¿è¡Œ IO å¯†é›†å‹çš„ä»»åŠ¡ä¼šå¯¼è‡´æµªè´¹å¤§é‡çš„ CPU è¿ç®—èƒ½åŠ›æµªè´¹ç­‰å¾…ã€‚æ‰€ä»¥åœ¨ IO ç§˜ç±å‹ä»»åŠ¡é‡ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥å¤§å¤§çš„åŠ é€Ÿç¨‹åºè¿è¡Œï¼Œå³ä½¿åœ¨å•æ ¸ CPU ä¸Šï¼Œè¿™ç§åŠ é€Ÿä¸»è¦å°±æ˜¯åˆ©ç”¨äº†è¢«æµªè´¹æ‰çš„é˜»å¡æ—¶é—´ã€‚<br>\nIO å¯†é›†å‹ï¼Œå¤§éƒ¨åˆ†çº¿ç¨‹éƒ½ä¼šé˜»å¡ã€‚æ‰€ä»¥éœ€è¦å¤šé…ç½®çº¿ç¨‹ã€‚é…ç½®æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p>\n<p><b>1ã€å‚è€ƒå…¬å¼: CPU æ ¸æ•° / 1 - é˜»å¡ç³»æ•°ã€‚ é˜»å¡ç³»æ•°åœ¨ 0.8-0.9 ä¹‹é—´ã€‚</b><br>\næ¯”å¦‚ 8 æ ¸ CPU:</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mn>8</mn><mrow><mn>1</mn><mo>âˆ’</mo><mn>0.9</mn></mrow></mfrac><mo>=</mo><mn>80</mn></mrow><annotation encoding=\"application/x-tex\">\\frac{8}{1-0.9}=80</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2484389999999999em;vertical-align:-0.403331em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mbin mtight\">âˆ’</span><span class=\"mord mtight\">0</span><span class=\"mord mtight\">.</span><span class=\"mord mtight\">9</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">8</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.403331em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">8</span><span class=\"mord\">0</span></span></span></span></p>\n<p>ä¸ªçº¿ç¨‹<br>\n<b>2ã€å‚è€ƒå…¬å¼: CPU æ ¸æ•° * 2</b></p>\n</li>\n</ul>\n",
            "tags": [
                "çº¿ç¨‹æ± ",
                "é¢ç»"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8Bziplist/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8Bziplist/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹è¯¦è§£ ziplist",
            "date_published": "2021-08-02T10:18:55.000Z",
            "content_html": "<h2 id=\"è§£å¯†-ziplist\"><a class=\"markdownIt-Anchor\" href=\"#è§£å¯†-ziplist\">#</a> è§£å¯† ziplist.</h2>\n<p>ä¸ºä»€ä¹ˆå«è§£å¯†  <code>ziplist</code>  å‘¢ï¼Ÿå› ä¸ºä» ziplist ä¸­å–åˆ°æˆ‘ä»¬é¢„æœŸçš„å€¼ï¼ŒçœŸçš„å’Œè§£å¯†ä¸€æ ·ï¼çƒ§è„‘ï¼Œä½†æ˜¯æå…¶æœ‰è¶£ï¼ï¼</p>\n<h3 id=\"å¼•é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#å¼•é¢˜\">#</a> å¼•é¢˜</h3>\n<p>åœ¨ä»‹ç»  <code>Redis</code>  çš„æ•°æ®ç±»å‹  <code>list</code>  çš„æ—¶å€™ï¼Œæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¥è§¦  <code>ziplist</code>  è¿™ä¸€æ•°æ®ç»“æ„ã€‚</p>\n<p>ä¸çŸ¥é“æ˜¯å¦è¿˜è®°å¾—  <code>ziplist</code>  è¿™ç§æ•°æ®ç»“æ„çš„ç‰¹æ€§ã€‚å¦‚æœä¸è®°å¾—ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è¯¦ç»†çš„çœ‹ä¸‹è¿™ä¸ªæ•°æ®ç»“æ„ã€‚</p>\n<h3 id=\"é‡è¯»-ziplist-æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#é‡è¯»-ziplist-æ•°æ®ç»“æ„\">#</a> é‡è¯» ziplist æ•°æ®ç»“æ„</h3>\n<p><code>ziplist</code>  æ˜¯ç»è¿‡ç‰¹æ®Šç¼–ç çš„åŒå‘é“¾æ¥åˆ—è¡¨ï¼Œæ—¨åœ¨æé«˜å†…å­˜æ•ˆç‡ã€‚ å®ƒåŒæ—¶å­˜å‚¨å­—ç¬¦ä¸²å’Œæ•´æ•°å€¼ï¼Œå…¶ä¸­æ•´æ•°è¢«ç¼–ç ä¸ºå®é™…æ•´æ•°ï¼Œè€Œä¸æ˜¯ä¸€ç³»åˆ—å­—ç¬¦ã€‚å®ƒå…è®¸åœ¨  <code>O(1)</code>  æ—¶é—´åœ¨åˆ—è¡¨çš„ä»»ä¸€ä¾§è¿›è¡Œæ¨å’Œå¼¹å‡ºæ“ä½œã€‚</p>\n<p>ä½†æ˜¯ï¼Œç”±äºæ¯ä¸ªæ“ä½œéƒ½éœ€è¦é‡æ–°åˆ†é… <code>ziplist</code>  ä½¿ç”¨çš„å†…å­˜ï¼Œå› æ­¤å®é™…çš„å¤æ‚æ€§ä¸ <code>ziplist</code>  ä½¿ç”¨çš„å†…å­˜é‡æœ‰å…³ã€‚</p>\n<p><code>ziplist</code>  çš„æ•°æ®ç»“æ„æ€»è§ˆã€‚å¦‚ä¸‹å›¾</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/ziplist-01-Ziplist%E7%9A%84%E7%BB%93%E6%9E%84.png\" alt=\"\"></p>\n<p>æˆ‘æ¥ä¾æ¬¡è§£é‡Šä¸‹è¿™  <code>5</code>  ä¸ªéƒ¨åˆ†.</p>\n<ul>\n<li>\n<p><code>&lt;uint32_t zlbytes&gt;</code>  : å­˜å‚¨çš„  <code>ziplist</code>  å ç”¨çš„å­—èŠ‚æ•° (åŒ…å«  <code>zlbytes</code>  å­—æ®µæœ¬èº«çš„  <code>4</code>  ä¸ªå­—èŠ‚)ã€‚å› æ­¤ï¼šæ— éœ€éå†å°±èƒ½ç›´æ¥çŸ¥é“è¿™ä¸ªæ•°æ®ç»“æ„çš„å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>&lt;uint32_t zltail&gt;</code>  æ˜¯åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªæ¡ç›®çš„åç§»é‡ã€‚ è¿™å…è®¸åœ¨åˆ—è¡¨çš„å¦ä¸€ç«¯è¿›è¡Œå¼¹å‡ºæ“ä½œï¼Œè€Œæ— éœ€å®Œå…¨éå†ã€‚åœ¨ä»»æ„ä¸€ç«¯è¿›è¡Œ  <code>pop</code>  å’Œ  <code>push</code>  æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯  <code>O(1)</code>  .</p>\n</li>\n<li>\n<p><code>&lt;uint16_t zllen&gt;</code>  æ˜¯æ¡ç›®æ•°ã€‚å½“æ¡ç›®æ•°è¶…è¿‡ <code>2 ^ 16-2</code>  æ—¶ï¼Œæ­¤å€¼å°†è®¾ç½®ä¸º <code>2 ^ 16-1</code> ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éå†æ•´ä¸ªåˆ—è¡¨ä»¥äº†è§£å…¶åŒ…å«å¤šå°‘é¡¹äº†ã€‚</p>\n</li>\n<li>\n<p><code>&lt;uint8_t zlend&gt;</code>  æ˜¯ä»£è¡¨ <code>ziplist</code>  æœ«å°¾çš„ç‰¹æ®Šæ¡ç›®ã€‚ç¼–ç ä¸ºç­‰äº <code>255</code>  çš„å•ä¸ªå­—èŠ‚ã€‚</p>\n</li>\n<li>\n<p><code>&lt;entry&gt;</code>  : å¾€ä¸‹çœ‹.</p>\n</li>\n</ul>\n<h4 id=\"entry\"><a class=\"markdownIt-Anchor\" href=\"#entry\">#</a>  <code>Entry</code></h4>\n<p><code>ziplist</code>  ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½ä»¥åŒ…å«ä¸¤ä¸ªä¿¡æ¯çš„å…ƒæ•°æ®ä½œä¸ºå‰ç¼€ã€‚é¦–å…ˆï¼Œå­˜å‚¨å‰ä¸€ä¸ª  <code>entry</code>  çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½å¤Ÿä»ååˆ°å‰éå†åˆ—è¡¨ã€‚ç¬¬äºŒï¼Œæä¾›  <code>entry</code>  ç¼–ç ã€‚ å®ƒè¡¨ç¤ºæ¡ç›®ç±»å‹ï¼Œæ•´æ•°æˆ–å­—ç¬¦ä¸²ï¼Œå¯¹äºå­—ç¬¦ä¸²ï¼Œè¿˜è¡¨ç¤ºå­—ç¬¦ä¸²æœ‰æ•ˆè´Ÿè½½çš„é•¿åº¦ã€‚å› æ­¤ï¼Œèƒ½å¤Ÿåƒä¸‹é¢è¿™æ ·å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„  <code>entry</code> .</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/ziplist-01-entry%E7%9A%84%E7%BB%93%E6%9E%84.png\" alt=\"\"></p>\n<p>æœ‰æ—¶ï¼Œ <code>encoding</code>  ä¹Ÿå¯ä»¥ä»£è¡¨ <code>entry</code>  æœ¬èº«ï¼Œå°±åƒåé¢å°†è¦çœ‹åˆ°çš„å°æ•´æ•°ä¸€æ ·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>&lt;entry-data&gt;</code>  éƒ¨åˆ†ä¸¢å¤±äº†ï¼Œæˆ‘ä»¬çš„ <code>Entry</code>  ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/ziplist-01-entry%E7%9A%84%E7%BB%93%E6%9E%842.png\" alt=\"\"></p>\n<p>æˆ‘ä»¬æ¥å…·ä½“çœ‹ä¸‹  <code>Entry</code>  çš„ç¼–ç æ–¹å¼.</p>\n<h5 id=\"prevlen\"><a class=\"markdownIt-Anchor\" href=\"#prevlen\">#</a>  <code>prevlen</code></h5>\n<p><code>&lt;prevlen&gt;</code>  è¡¨ç¤º å‰ä¸€ä¸ª  <code>entry</code>  çš„é•¿åº¦ã€‚</p>\n<ul>\n<li>\n<p>å¦‚æœ å‰ä¸€ä¸ª  <code>entry</code>  çš„é•¿åº¦å°äº 254 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆè¿™ä¸ª  <code>Entry</code>  åªä¼šæ¶ˆè€—ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºè¯¥é•¿åº¦ã€‚ä¸€ä¸ªæ— ç¬¦å·çš„  <code>8</code>  ä½æ•´æ•°ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœå‰ä¸€ä¸ª  <code>entry</code>  é•¿åº¦å¤§äºæˆ–ç­‰äº <code>254</code>  å­—èŠ‚çš„æ—¶å€™ï¼Œå®ƒå°†å ç”¨ 5 ä¸ªå­—èŠ‚ã€‚ç¬¬ä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º  <code>254</code> ( <code>FE</code> ), ä»¥æŒ‡ç¤ºéšåçš„å€¼æ›´å¤§ã€‚ å…¶ä»–çš„å››ä¸ªå­—èŠ‚å°†ä½œä¸ºå‰ä¸€ä¸ª entry çš„é•¿åº¦çš„å€¼ã€‚</p>\n</li>\n</ul>\n<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“äº† ä¸‹é¢è¿™ç§ç¼–ç æ–¹å¼.</p>\n<p><code>&lt;prevlen form 9 to 253&gt; &lt;encoding&gt; &lt;entry-data&gt;</code></p>\n<p>æˆ–è€…</p>\n<p><code>&lt;prevlen 4 bytes unsigned little endian prevlen&gt; &lt;encoding&gt; &lt;entry-data&gt;</code></p>\n<h5 id=\"encoding\"><a class=\"markdownIt-Anchor\" href=\"#encoding\">#</a>  <code>encoding</code></h5>\n<p><code>entry</code>  ä¸­çš„  <code>encoding</code>  å­—æ®µå–å†³äº  <code>entry-data</code>  çš„å†…å®¹ã€‚</p>\n<ul>\n<li>\n<p>å¦‚æœ  <code>entry-data</code>  æ˜¯å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ <code>encoding</code>  ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰ä¸¤ä½ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦çš„ç¼–ç ç±»å‹ã€‚ç„¶åæ˜¯å­—ç¬¦ä¸²çš„å®é™…é•¿åº¦ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœ  <code>entry</code>  æ˜¯æ•´æ•°æ—¶ï¼Œå‰ <code>2</code>  ä½éƒ½æ˜¯ <code>1</code> ,ã€‚ æ¥ä¸‹æ¥çš„ä¸¤ä½ç”¨äºæŒ‡å®šåœ¨æ­¤æ ‡å¤´ä¹‹åå°†å­˜å‚¨å“ªç§ç±»å‹.</p>\n</li>\n</ul>\n<p>ç”±ä¸Šé¢çš„ä¸¤ç‚¹ï¼Œå°±è¶³ä»¥ç¡®å®š  <code>entry-data</code>  çš„ç±»å‹.</p>\n<p>ä¸åŒçš„ç±»å‹å’Œç¼–ç çš„æ¦‚è¿°å¦‚ä¸‹:</p>\n<h6 id=\"å­—ç¬¦ä¸²ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#å­—ç¬¦ä¸²ç±»å‹\">#</a> å­—ç¬¦ä¸²ç±»å‹</h6>\n<ul>\n<li>\n<p><code>a</code> .  <code>| 00pppppp |</code>  : å«ä¹‰æ˜¯å ç”¨ <code>1</code>  ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºé•¿åº¦å°äºæˆ–ç­‰äº <code>63</code>  ä¸ªå­—èŠ‚ï¼ˆ <code>6</code>  ä½ï¼‰çš„å­—ç¬¦ä¸²å€¼ã€‚Â   <code>pppppp</code>  è¡¨ç¤ºæ— ç¬¦å·çš„ 6 ä½é•¿åº¦ã€‚</p>\n</li>\n<li>\n<p><code>b</code> . <code>|01pppppp|qqqqqqqq|</code>  å«ä¹‰æ˜¯ç”¨ <code>2</code>  ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå°äºç­‰äº  <code>16383(2^14)</code>  ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸²çš„é•¿åº¦. (<b>è¿™é‡Œä½¿ç”¨å¤§ç«¯æ³•è®¡æ•°</b>)</p>\n</li>\n<li>\n<p><code>c</code> . <code>|10000000|qqqqqqqq|rrrrrrrr|ssssssss|tttttttt|</code>  å«ä¹‰æ˜¯ ä½¿ç”¨ 5 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå¤§äºç­‰äº 16384 ä¸ªå­—èŠ‚é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œåªæœ‰ 4 ä¸ªå­—èŠ‚è¡¨ç¤ºå…¶æœ€å¤§é•¿åº¦ä¸º  <code>2^32-1</code> . ä½ä½çš„ 6 ä½è¢«è®¾ç½®æˆ  <code>0</code> .(<b>è¿™é‡Œä½¿ç”¨å¤§ç«¯æ³•è®¡æ•°</b>)</p>\n</li>\n</ul>\n<h6 id=\"æ•´æ•°ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#æ•´æ•°ç±»å‹\">#</a> æ•´æ•°ç±»å‹</h6>\n<ul>\n<li><code>d</code> . <code>|11000000|</code> : å«ä¹‰æ˜¯ç”¨ <code>3</code>  ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ª <code>16</code>  ä½çš„æœ‰ç¬¦å·çš„çŸ­æ•´å½¢æ•° ( <code>short</code> )ã€‚</li>\n<li><code>e</code> . <code>|11010000|</code>  : å«ä¹‰æ˜¯ç”¨ <code>5</code>  ä¸ªå­—èŠ‚ è¡¨ç¤ºä¸€ä¸ª <code>32</code>  ä½çš„æœ‰ç¬¦åˆæ•´æ•°å‹ ( <code>int</code> ).</li>\n<li><code>f</code> . <code>|11100000|</code>  : å«ä¹‰æ˜¯ç”¨ <code>9</code>  ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºä¸€ä¸ª <code>64</code>  ä½çš„æœ‰ç¬¦åˆé•¿æ•´æ•° ( <code>long</code> )</li>\n<li><code>g</code> . <code>|11110000|</code>  : å«ä¹‰æ˜¯ç”¨ <code>4</code>  ä¸ªå­—èŠ‚è¡¨ç¤º <code>24</code>  ä½æœ‰ç¬¦å·æ•´æ•° (åªå ç”¨ 3 ä¸ªå­—èŠ‚)ã€‚PS: æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå‰é¢è¯´çš„å°æ•´å½¢æ•°ã€‚èŠ‚çº¦ç©ºé—´ã€‚å³å¦‚å›¾</li>\n<li><code>h</code> . <code>|11111110|</code>  :  å«ä¹‰æ˜¯ç”¨ <code>2</code>  ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ª <code>8</code>  ä½çš„æœ‰ç¬¦å·å°æ•´å½¢æ•°ã€‚ <code>1</code>  ä¸ªå­—èŠ‚ã€‚</li>\n<li><code>i</code> . <code>|1111xxxx|</code>  :<br>\n é™¤å»ä¸Šé¢åˆ—ä¸¾çš„å‡ ç±»ç¼–ç æ ‡è¯†ï¼Œè¿˜æœ‰ <code>|1111xxxx|</code>  çš„ç±»åˆ«ã€‚<br>\n( <code>xxxx</code>  åœ¨ <code>0000</code>  å’Œ <code>1101</code>  ä¹‹é—´) ç«‹å³ <code>4</code>  ä½æ•´æ•°ã€‚  <code>0</code>  åˆ° <code>12</code>  ä¹‹é—´çš„æ— ç¬¦å·æ•´æ•°ã€‚ç¼–ç å€¼å®é™…ä¸Šæ˜¯ <code>1</code>  åˆ° <code>13</code> ï¼Œå› ä¸ºä¸èƒ½ä½¿ç”¨ <code>0000</code>  å’Œ <code>1111</code> ï¼Œå› æ­¤åº”ä»ç¼–ç çš„ <code>4</code>  ä½å€¼ä¸­å‡å» <code>1</code>  ä»¥è·å¾—æ­£ç¡®çš„å€¼ã€‚</li>\n<li><code>j</code> . <code>|11111111| </code> - è¡¨ç¤º  <code>ziplist</code>  çš„ç‰¹æ®Š  <code>entry</code></li>\n</ul>\n<p>è¿™æ ·ï¼Œæ•´ä¸ª <code>Entry</code>  çš„ç¼–ç æ–¹å¼æˆ‘ä»¬å°±ææ˜ç™½äº†ã€‚<br>\nè¿™äº›éƒ½æ˜¯  <code>Redis</code>  ä¸­å®šä¹‰çš„è§„å®šï¼Œ æ‰€ä»¥æˆ‘ä»¬è®°ä½å°±è¡Œäº†ã€‚å¦‚æœè®©æˆ‘ä»¬è‡ªå·±å»è®¾è®¡ä¸€å¥—ç¼–ç æ–¹æ¡ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‚è€ƒè¿™ç§æ€è·¯å»è®¾è®¡ã€‚</p>\n<h3 id=\"é‚£æˆ‘ä»¬æ¥ä¸¾ä¸¤ä¸ªä¾‹å­æ¥è¯•è¯•èº«æ‰‹å§\"><a class=\"markdownIt-Anchor\" href=\"#é‚£æˆ‘ä»¬æ¥ä¸¾ä¸¤ä¸ªä¾‹å­æ¥è¯•è¯•èº«æ‰‹å§\">#</a> é‚£æˆ‘ä»¬æ¥ä¸¾ä¸¤ä¸ªä¾‹å­æ¥è¯•è¯•èº«æ‰‹å§ã€‚</h3>\n<h4 id=\"ä¾‹å­1-25\"><a class=\"markdownIt-Anchor\" href=\"#ä¾‹å­1-25\">#</a> ä¾‹å­ 1:  <code>25</code></h4>\n<h5 id=\"ç¼–ç æ–¹å¼\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–ç æ–¹å¼\">#</a> ç¼–ç æ–¹å¼</h5>\n<p><code>[0f 00 00 00] [0c 00 00 00] [02 00] [00 f3] [02 f6] [ff]</code></p>\n<h5 id=\"è§£æè¿‡ç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#è§£æè¿‡ç¨‹\">#</a> è§£æè¿‡ç¨‹</h5>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/ziplist-01-Ziplist%E4%BE%8B%E5%AD%90%E7%9A%84%E7%BB%93%E6%9E%841.png\" alt=\"ziplist-01-Ziplistä¾‹å­çš„ç»“æ„1.png\"></p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/ziplist-%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE.png\" alt=\"\"></p>\n<h4 id=\"ä¾‹å­2-hello-world\"><a class=\"markdownIt-Anchor\" href=\"#ä¾‹å­2-hello-world\">#</a> ä¾‹å­ 2:  <code>Hello World</code></h4>\n<p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯æ¥ç€ä¸Šé¢ä¾‹å­æ¥è®²ï¼Œæˆ‘ä»¬å†è®¾ç½®ä¸€ä¸ª å­—ç¬¦ä¸²  <code>Hello World</code>  ã€‚</p>\n<h5 id=\"ç¼–ç æ ¼å¼\"><a class=\"markdownIt-Anchor\" href=\"#ç¼–ç æ ¼å¼\">#</a> ç¼–ç æ ¼å¼</h5>\n<p><code>[02] [0b] [48 65 6c 6c 6f 20 57 6f 72 6c 64]</code></p>\n<h5 id=\"è§£æè¿‡ç¨‹-2\"><a class=\"markdownIt-Anchor\" href=\"#è§£æè¿‡ç¨‹-2\">#</a> è§£æè¿‡ç¨‹</h5>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/ziplist-01-Ziplist%E4%BE%8B%E5%AD%90%E7%9A%84%E7%BB%93%E6%9E%842.png\" alt=\"ziplist-01-Ziplistä¾‹å­çš„ç»“æ„2.png\"></p>\n<h5 id=\"é™„å½•-asciiç è¡¨å¯å±•ç¤ºå­—ç¬¦\"><a class=\"markdownIt-Anchor\" href=\"#é™„å½•-asciiç è¡¨å¯å±•ç¤ºå­—ç¬¦\">#</a> é™„å½•ï¼ŒASCII ç è¡¨ (å¯å±•ç¤ºå­—ç¬¦)</h5>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/ziplist-ASCII%E7%A0%81%E5%AD%97%E7%AC%A6%E8%A1%A8.png\" alt=\"\"></p>\n<p>ä»¥ä¸Šå†…å®¹ï¼Œå°±æ˜¯ <code>Redis</code>  çš„ <code>ziplist</code>  ç»“æ„çš„å†…å®¹äº†ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h3>\n<p>æœ¬ç¯‡æ–‡ç« çš„å†…å®¹ä¸»è¦æ˜¯æ›´åŠ è¯¦ç»†çš„åˆ†äº«äº† <code>ziplist</code>  çš„è¿™ç§æ•°æ®ç»“æ„çš„å†…éƒ¨ç»“æ„ä»¥åŠç¼–ç æ–¹å¼.</p>\n<ul>\n<li><code>ziplist</code>  ç”± <code>5</code>  éƒ¨åˆ†ç»„æˆã€‚å­˜å‚¨äº†ç›¸å…³ä¿¡æ¯:  <code>&lt;æ•´ä¸ªziplistçš„é•¿åº¦&gt;&lt;æœ€åä¸€ä¸ªentryçš„åç§»é‡&gt;&lt;entryçš„æ€»æ•°&gt;&lt;entries&gt;&lt;è¡¨ç¤ºç»“æŸçš„ç‰¹æ®Šentry&gt;</code></li>\n<li>ä¸€ä¸ª <code>entry</code>  ç”± <code>3</code>  éƒ¨åˆ†ç»„æˆï¼Œ <code>&lt;å‰ä¸€ä¸ªentryçš„é•¿åº¦&gt;&lt;ç¼–ç æ–¹å¼&gt;&lt;entryçš„å†…å®¹&gt;</code></li>\n<li>å…¶ä¸­ ç¼–ç æ–¹å¼ æ˜¯ç”± entry çš„å†…å®¹ å†³å®šçš„ã€‚æœ‰ 10 æ¡æ ‡å‡† (è§„å®š / åè®®)</li>\n<li>å¼•ç”¨äº†ä¸¤ä¸ªç¤ºä¾‹ ( <code>25</code>  å’Œ <code>Hello World</code> )ï¼Œæ ¹æ® <code>Redis</code>  çš„æ–¹å¼æ¥è§£ç .</li>\n</ul>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸå¾…æ‚¨çš„å…³æ³¨ï¼Œå¸Œæœ›å’Œä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/qrcode.jpg\" alt=\"äºŒç»´ç \"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-4-%E8%B7%B3%E8%A1%A8/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-4-%E8%B7%B3%E8%A1%A8/",
            "title": "Redisä¸­çš„æ•°æ®ç»“æ„ä¹‹è·³è¡¨åŠå…¶åŸç†",
            "date_published": "2021-08-01T16:00:00.000Z",
            "content_html": "<h2 id=\"å‰è¨€\"><a class=\"markdownIt-Anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h2>\n<p>æ–‡ä¸­é™„ä»£ç å®ç°. <a href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0\">ç”µæ¢¯ç›´è¾¾</a></p>\n<p>åœ¨å…¬ä¼—å·å›å¤ ã€è·³è¡¨ã€‘ ä¹Ÿå¯ä»¥è·å–å“¦ã€‚</p>\n<h3 id=\"ä»€ä¹ˆæ˜¯è·³è¡¨\"><a class=\"markdownIt-Anchor\" href=\"#ä»€ä¹ˆæ˜¯è·³è¡¨\">#</a> ä»€ä¹ˆæ˜¯è·³è¡¨</h3>\n<blockquote>\n<p>è·³è¡¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ã€‚å®ƒå…è®¸å¿«é€ŸæŸ¥è¯¢ä¸€ä¸ªæœ‰åºè¿ç»­å…ƒç´ çš„æ•°æ®é“¾è¡¨ã€‚è·³è·ƒåˆ—è¡¨çš„å¹³å‡æŸ¥æ‰¾å’Œæ’å…¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O (log n)ï¼Œä¼˜äºæ™®é€šé˜Ÿåˆ—çš„ O (n)ã€‚</p>\n</blockquote>\n <p align=right> from. ç»´åŸºç™¾ç§‘</p>\n<h3 id=\"å¼•é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#å¼•é¢˜\">#</a> å¼•é¢˜</h3>\n<p>çº¿æ€§è¡¨è¿™ç§æ•°æ®æœ‰ä¸¤ç§å…·ä½“å®ç°ï¼Œæ•°ç»„å’Œé“¾è¡¨ã€‚å…·ä½“çš„å†…å®¹ä¹‹å‰çš„æ–‡ç« é‡Œä¹Ÿæœ‰è¯´è¿‡ï¼Œå¯ä»¥ç¿»ç¿»çœ‹å“‡ï½ã€‚åœ¨è¿™é‡Œä¸¤ç§æ•°æ®ç»“æ„ä¸­ï¼Œæ•°ç»„çš„ä¼˜ç‚¹æ˜¯æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œè€Œé“¾è¡¨çš„ä¼˜ç‚¹æ˜¯å¢åˆ çš„æ•ˆç‡é«˜ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„ã€‚å…¶å®ï¼Œéä¹Ÿã€‚</p>\n<p>æ•°ç»„æ˜¯ä¸€ç§å†…å­˜è¿ç»­çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¼˜ç‚¹æ˜¯å¯ä»¥é€šè¿‡ <code>é¦–åœ°å€+N*(sizeOf(Node))</code>  æ¥å¿«é€Ÿè·å–æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ ã€‚å‡å¦‚æˆ‘ä»¬ä¸çŸ¥é“æŒ‡å®šå…ƒç´ çš„ä½ç½®å‘¢ï¼Ÿ</p>\n<p>é“¾è¡¨æ˜¯ä¸€ç§éå†…å­˜è¿ç»­çš„æ•°æ®ï¼Œå…¶ä¼˜ç‚¹æ˜¯é€šè¿‡æ”¹å˜æŒ‡é’ˆåœ°å€æ¥å¿«é€Ÿå¢å‡å…ƒç´ ã€‚å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œä½ é¦–å…ˆè¦çŸ¥é“ä½ è¦å¢åŠ  / åˆ é™¤çš„ç›®æ ‡å…ƒç´ æ˜¯å“ªä¸ªï¼æ‰€ä»¥ä¼šæµªè´¹  <code>O(n)</code>  çš„æŸ¥è¯¢æ—¶é—´ã€‚</p>\n<p>è¦è®ºæ•ˆç‡ï¼Œé‚£å°±è¦è¯´å¹³è¡¡æ ‘ ( <code>AVL</code> ) äº†ã€‚å¢åˆ æŸ¥çš„æ•ˆç‡éƒ½æ˜¯  <code>O(logN)</code> ã€‚ ä½†æ˜¯è¿™ç§æ•°æ®ç»“æ„ï¼ŒåŸç†æ¯”è¾ƒå¤æ‚ï¼Œå®ç°èµ·æ¥é‚£ä¸æ˜¯æ¯”è¾ƒå¤æ‚äº†ï¼Œé‚£æ˜¯ç›¸å½“å¤æ‚ã€‚å¢åˆ æ“ä½œï¼Œéƒ½éœ€è¦å…¶ä¾é å¹³è¡¡æ“ä½œå¼•å‘å­æ ‘çš„è°ƒæ•´ã€‚</p>\n<p>é‚£ä¹ˆï¼ŒæŒå£°æœ‰è¯·æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’: <b>è·³è¡¨</b>ã€‚</p>\n<h2 id=\"è·³è¡¨\"><a class=\"markdownIt-Anchor\" href=\"#è·³è¡¨\">#</a> è·³è¡¨</h2>\n<h3 id=\"æ¦‚å¿µ\"><a class=\"markdownIt-Anchor\" href=\"#æ¦‚å¿µ\">#</a> æ¦‚å¿µ</h3>\n<p>è·³è¡¨ ( <code>skip list</code> ) å…¨ç§° è·³è·ƒé“¾è¡¨ã€‚ æ˜¯ä¸€ç§ç±»é“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚</p>\n<p>è·³è¡¨çš„æ€§èƒ½å’Œå¹³è¡¡æ ‘çš„æ€§èƒ½æ˜¯ä¸€æ ·çš„ï¼Œåœ¨æ’å…¥ï¼Œåˆ é™¤ï¼Œæœç´¢çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯  <code>O(n)</code> , æ˜¯ä¸€ç§åˆ©ç”¨ç©ºé—´æ¢æ—¶é—´çš„æ•°æ®ç»“æ„ã€‚</p>\n<p>è·³è¡¨æ˜¯ä¸€ç§éšæœºåŒ–çš„æ•°æ®ç»“æ„ï¼Œç›®å‰å¼€æºè½¯ä»¶ Redis å’Œ LevelDB éƒ½æœ‰ç”¨åˆ°å®ƒã€‚</p>\n<p>è¿™é‡Œï¼Œå…ˆç»™å¤§å®¶çœ‹ä¸€ä¸ª<b>å¯èƒ½</b>çš„è·³è¡¨ç»“æ„ã€‚</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-02-%E5%8F%AF%E8%83%BD%E7%9A%84%E8%B7%B3%E8%A1%A8%E7%BB%93%E6%9E%841.png\" alt=\"è·³è¡¨-02-å¯èƒ½çš„è·³è¡¨ç»“æ„1.png\"></p>\n<p>ç°åœ¨æˆ‘è¦å‘Šè¯‰ä½ ï¼Œä¸Šé¢çš„è·³è¡¨æ˜¯ç”±ä¸‹é¢çš„è·³è¡¨ç»è¿‡å±‚å±‚ä¼˜åŒ–å¾—æ¥çš„ã€‚</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-01-%E6%9C%89%E5%BA%8F%E7%9A%84%E9%93%BE%E8%A1%A8.png\" alt=\"è·³è¡¨-01-æœ‰åºçš„é“¾è¡¨\"></p>\n<p>ä¸‹é¢æˆ‘ä»¬é’ˆå¯¹ä¸Šé¢çš„è·³è¡¨ç»“æ„æ¥åˆ†æä¸€ä¸‹ã€‚</p>\n<p>åˆšæ‰è¯´è¿‡äº†ï¼Œé“¾è¡¨å¢åˆ æ€§èƒ½ç½ªé­ç¥¸é¦–å°±æ˜¯æŸ¥æ‰¾æ“ä½œï¼å¯¹äºæŸ¥æ‰¾æ“ä½œï¼Œæ•ˆç‡æœ€é«˜çš„è«è¿‡äºäºŒåˆ†æŸ¥æ‰¾äº†ã€‚ä½†æ˜¯å¯¹äºç¬¬ä¸€ä¸ªæœ‰åºé“¾è¡¨ä¸­æ˜¯æ— æ³•ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾çš„ã€‚ä½†æ˜¯å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥éšæœºæŠ½é€‰ä¸­å…¶ä¸­çš„å‡ ä¸ªå…ƒç´ ï¼Œç»„æˆä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚å°±åƒä¸‹é¢è¿™æ ·ã€‚</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-03-%E6%8A%BD%E8%B1%A1%E5%87%BA%E6%96%B0%E7%9A%84%E4%B8%80%E5%B1%82.png\" alt=\"è·³è¡¨-03-æŠ½è±¡å‡ºæ–°çš„ä¸€å±‚.png\"></p>\n<p>å‡è®¾æˆ‘ä»¬è¦æ‰¾ <code>5</code>  è¿™ä¸ªå…ƒç´ ï¼Œåœ¨å•ç‹¬çš„æœ‰åºé“¾è¡¨ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ä»å¤´ç»“ç‚¹ä¾æ¬¡éå†åˆ°  <code>5</code>  è¿™ä¸ªèŠ‚ç‚¹ã€‚è·¯å¾„ä¸º <code>1-&gt;2-&gt;3-&gt;4-&gt;5</code> , ä¸‹å›¾ä¸­é»„è‰²çº¿è·¯å¾„ã€‚, ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ä»  <code>1-&gt;2-&gt;4-&gt;5</code> . ä¸‹å›¾ä¸­ç´«è‰²çº¿è·¯å¾„ã€‚æ—¢ç„¶æˆ‘ä»¬å¯ä»¥åŸæ¥çš„é“¾è¡¨æŠ½è±¡å‡ºä¸€ä¸ªæ–°çš„é“¾è¡¨ï¼Œé‚£æˆ‘ä»¬è¿˜å¯ä»¥ä»æ–°çš„é“¾è¡¨ä¸­å†æŠ½è±¡å‡ºä¸€ä¸ªæ–°çš„é“¾è¡¨ã€‚è¿™æ ·çš„è¯ï¼Œå°±ç›´æ¥å¯ä»¥  <code>1-&gt;4-&gt;5</code> , å°±å¯ä»¥æŸ¥åˆ°ä¸€ä¸ªæˆ‘ä»¬çš„ç›®æ ‡èŠ‚ç‚¹äº†ã€‚</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-04-%E5%86%8D%E6%8A%BD%E8%B1%A1%E5%87%BA%E6%96%B0%E7%9A%84%E4%B8%80%E5%B1%82.png\" alt=\"è·³è¡¨-04-å†æŠ½è±¡å‡ºæ–°çš„ä¸€å±‚.png\"></p>\n<p>å¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘è¦å‘Šè¯‰ä½ ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µäº†ã€‚</p>\n<p><strong>å±‚ï¼šå°±æ˜¯æˆ‘ä»¬å‡è®¾çš„æŠ½è±¡å‡ºæ¥çš„æ–°é“¾è¡¨ã€‚</strong></p>\n<p>å¯èƒ½ä½ å¾ˆå¥½å¥‡ï¼Œå±‚æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå­˜å‚¨å‘¢ï¼Ÿå¾ˆç®€å•å•Šï¼</p>\n<p>ä»¥åæˆ‘ä»¬æ¯ä¸ªé“¾è¡¨çš„å…ƒç´ æ˜¯æ€ä¹ˆå®šä¹‰çš„ï¼Ÿï¼Ÿ</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">NODE</span> &#123;</span></span><br><span class=\"line\">    T data;</span><br><span class=\"line\">    Node *next;</span><br><span class=\"line\">&#125; node;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬åªéœ€è¦å°† æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆæ”¹æˆä¸€ä¸ªæŒ‡é’ˆæ•°ç»„å°±å¯ä»¥äº†ï¼</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">NODE</span> &#123;</span></span><br><span class=\"line\">    T data;</span><br><span class=\"line\">    <span class=\"comment\">/// æŒ‡å‘åç»§å…ƒç´ çš„æŒ‡é’ˆæ•°ç»„</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Node</span> *<span class=\"title\">next</span>[<span class=\"title\">i</span>];</span></span><br><span class=\"line\">&#125; node;</span><br></pre></td></tr></table></figure>\n<p>äº†è§£äº†æ€ä¹ˆå­˜å‚¨ä¹‹åï¼Œé‚£æ€æ ·ç¡®å®šæŸä¸ªèŠ‚ç‚¹æœ‰å‡ å±‚å‘¢ï¼Ÿè¿™é‡Œæˆ‘å‘Šè¯‰ä½ å§ï¼Œéšæœºçš„ï¼æ€ä¹ˆéšæœºçš„å‘¢ï¼Ÿå°±æ˜¯é€šè¿‡éšæœºæ•°æ¥ç¡®å®šçš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ æŠ›ç¡¬å¸çš„å½¢å¼ã€‚ æ¯”å¦‚ä¸‹é¢çš„è¿™æ®µä»£ç .</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ç”Ÿæˆä¸€ä¸ªéšæœºæ•°</span></span><br><span class=\"line\"><span class=\"comment\"> * @return ä¸€ä¸ªéšæœºæ•°</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">random_level</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> level = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">rand</span>() % <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        level++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    level = (level &lt; MAX_LEVEL) ? level : MAX_LEVEL;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> level;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>é‚£æˆ‘ä»¬å°±å°è¯•ç€å®ç°ä¸€ä¸ªè·³è¡¨ã€‚</p>\n<h3 id=\"è·³è¡¨çš„å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#è·³è¡¨çš„å®ç°\">#</a> è·³è¡¨çš„å®ç°</h3>\n<ul>\n<li>å®šä¹‰è·³è¡¨çš„ç»“æ„</li>\n</ul>\n<p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæ¯ä¸ªèŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å‡ºä¸‹é¢çš„ç»“æ„ã€‚(å½“ç„¶ä¹Ÿæœ‰å…¶ä»–æ–¹å¼çš„å®ç°ï¼Œæ¬¢è¿äº¤æµï½)</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// èŠ‚ç‚¹</span></span><br><span class=\"line\">NODE &#123;</span><br><span class=\"line\">    T data,</span><br><span class=\"line\">    <span class=\"comment\">/// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°ç»„ï¼Œä»1å¼€å§‹ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">/// æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å¯¹åº”è¯¥å±‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">    <span class=\"comment\">/// next[1],æ˜¯ç¬¬ä¸€å±‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">/// next[2] æ˜¯ç¬¬äºŒå±‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ã€‚</span></span><br><span class=\"line\">    NODE []next;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// è·³è¡¨</span></span><br><span class=\"line\">SKIP_LIST&#123;</span><br><span class=\"line\">    NODE head;</span><br><span class=\"line\">    <span class=\"comment\">/// è¯¥è·³è¡¨çš„å±‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> level;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>æŸ¥æ‰¾æŒ‡å®šçš„å…ƒç´ </li>\n</ul>\n<p>ä¸Šé¢è¯´è¿‡äº† æŸ¥æ‰¾è¿‡ç¨‹ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥ç»™å‡ºä¼ªä»£ç äº†ã€‚</p>\n<p>ä¸»è¦é€»è¾‘æ˜¯ï¼šä»é«˜å±‚å¼€å§‹æŸ¥æ‰¾ç›´åˆ°æ‰¾åˆ°ç­‰äºæŒ‡å®šå…ƒç´ çš„èŠ‚ç‚¹ E æˆ–è€…ç¬¬ä¸€ä¸ªå¤§äºæŒ‡å®šå…ƒç´ çš„èŠ‚ç‚¹ Gã€‚å¦‚æœæ˜¯èŠ‚ç‚¹ Eï¼Œé‚£ä¹ˆç›´æ¥è¿”å›å°±å¥½äº†ã€‚å¦‚æœæ˜¯ G èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±ä»¥ G èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ L, åœ¨ä¸‹ä¸€å±‚è¿›è¡ŒæŸ¥æ‰¾ï¼Œé‡å¤ä¸Šé¢çš„é€»è¾‘ï¼Œç›´åˆ°æ‰¾åˆ°èŠ‚ç‚¹ Eï¼Œæˆ–è€…åˆ°è¾¾è·³è¡¨çš„ç»“å°¾ã€‚</p>\n<p>æ¯”å¦‚ä¸‹å›¾ä¸­æŸ¥æ‰¾  <code>5</code>  çš„è¿‡ç¨‹ä¸º:</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-08-%E6%9F%A5%E6%89%BE.png\" alt=\"è·³è¡¨-08-æŸ¥æ‰¾\"></p>\n<ul>\n<li><code>head-&gt;8</code> ,  <code>8&gt;5</code> , ä» <code>head</code>  å¼€å§‹ï¼Œå»ä¸‹ä¸€å±‚æŸ¥æ‰¾ã€‚</li>\n<li><code>head-&gt;4-&gt;8</code> ,  <code>8&gt;5</code> , ä»  <code>4</code>  å…ƒç´ å¼€å§‹æŸ¥æ‰¾ã€‚å»ä¸‹ä¸€å±‚æŸ¥æ‰¾</li>\n<li><code>head-&gt;4-&gt;8</code> ,  <code>8&gt;5</code> , ä»  <code>4</code>  å…ƒç´ å¼€å§‹æŸ¥æ‰¾ã€‚å»ä¸‹ä¸€å±‚æŸ¥æ‰¾.</li>\n<li><code>head-&gt;4-&gt;6</code> ,  <code>6&gt;5</code> , ä»  <code>4</code>  å…ƒç´ å¼€å§‹æŸ¥æ‰¾ã€‚å»ä¸‹ä¸€å±‚æŸ¥æ‰¾.</li>\n<li><code>head-&gt;4-&gt;5</code> ,  <code>5==5</code> , è¿”å›èŠ‚ç‚¹ <code>5</code> .</li>\n</ul>\n<p>å¦‚ä¸‹é¢çš„ä¼ªä»£ç ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">search</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">/// i è¡¨ç¤ºå±‚æ•°ï¼Œä»æœ€é«˜å±‚å¼€å§‹æŸ¥æ‰¾ ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((q = p-&gt;next[i]) &amp;&amp; q-&gt;k &lt; k) &#123;</span><br><span class=\"line\">            p = q;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (q &amp;&amp; k == q-&gt;data) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &amp;(q-&gt;data);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>æ„å»ºä¸€ä¸ªè·³è¡¨ã€‚</li>\n</ul>\n<p>ä¸Šé¢åˆ†æå¯ä»¥å¾—å‡ºæ¥ï¼Œè·³è¡¨æ˜¯ä¸€ä¸ªå¤šå±‚çš„æœ‰åºé“¾è¡¨ã€‚æ‰€ä»¥æˆ‘ä»¬å¯¹äºæ¯ä¸€å±‚éƒ½åƒæ“ä½œæ™®é€šé“¾è¡¨ä¸€æ ·å°±å¯ä»¥äº†ã€‚å°±åƒä¸‹é¢çš„è¿™æ ·:</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-06-%E6%8F%92%E5%85%A5.png\" alt=\"è·³è¡¨-06-æ’å…¥\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">insert</span> () &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ‰¾åˆ°è¦æ’å…¥çš„èŠ‚ç‚¹ä½ç½®ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">// levelæ˜¯æœ¬è·³è¡¨çš„å±‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = level<span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">        <span class=\"comment\">///éå†è¯¥å±‚å°äºæŒ‡å®šå€¼çš„å‰ä¸€ä¸ªå…ƒç´ </span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((q = p-&gt;next[i]) &amp;&amp; q-&gt;k &lt; k) &#123;</span><br><span class=\"line\">            p = q;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">/// æ–°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å±‚æŒ‡é’ˆã€‚</span></span><br><span class=\"line\">        update[i] = p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// éšæœºç”Ÿæˆè¯¥èŠ‚ç‚¹çš„å±‚æ•°,å¦‚æœç”Ÿæˆçš„å±‚æ•°å¤§äºå½“å‰å±‚ï¼Œéœ€è¦æ›´æ–°è·³è¡¨ä¸­è®°å½•çš„levelå€¼ã€‚</span></span><br><span class=\"line\">    new_level = <span class=\"built_in\">rand_level</span>();</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(new_level &gt; level) &#123;</span><br><span class=\"line\">        level = new_level;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// ç”Ÿæˆæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶é’ˆå¯¹æ¯ä¸€å±‚æ‰§è¡Œæ™®é€šé“¾è¡¨çš„æ’å…¥æ“ä½œã€‚</span></span><br><span class=\"line\">    new_node = <span class=\"built_in\">create_new_node</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = level - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">        <span class=\"comment\">/// ä¸‹é¢ä¸¤è¡Œä»£ç å°±æ˜¯æ™®é€šè¿æ¥çš„å¢åŠ æ–¹æ³•ã€‚</span></span><br><span class=\"line\">        <span class=\"comment\">/// æ–°èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ç¬¬iå±‚çš„èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">        new_node-&gt;next[i] = update[i]-&gt;next[i];</span><br><span class=\"line\">        update[i]-&gt;next[i] = q;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>åˆ é™¤è·³è¡¨çš„å…ƒç´ </li>\n</ul>\n<p>ä¸»è¦é€»è¾‘æ˜¯è¯¥èŠ‚ç‚¹çš„æ¯ä¸€å±‚éƒ½è¦åˆ é™¤.</p>\n<p>å³å¯¹æ¯ä¸€å±‚ï¼Œéƒ½è¦ è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘è¦åˆ é™¤èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-07-%E5%88%A0%E9%99%A4.png\" alt=\"è·³è¡¨-07-åˆ é™¤.png\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">del</span>() &#123;</span><br><span class=\"line\">    <span class=\"comment\">/// æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (; i &gt;= <span class=\"number\">0</span>; --i) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((q = p-&gt;next[i]) &amp;&amp; q-&gt;k &lt; k) &#123;</span><br><span class=\"line\">            p = q;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        update[i] = p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä»£ç å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#ä»£ç å®ç°\">#</a> ä»£ç å®ç°</h3>\n<p>ğŸ‘‰ <a href=\"https://github.com/fangjiaxiaobai/data_structures_and_algorithms/tree/master/01_data_structures/skiplist/c/01_fangjiaxiaobai\">è·³è¡¨ <code>C</code>  è¯­è¨€ç‰ˆæœ¬</a><br>\nğŸ‘‰ <a href=\"https://github.com/fangjiaxiaobai/data_structures_and_algorithms/tree/master/01_data_structures/skiplist/java/fangjiaxiaobai\">è·³è¡¨ <code>JAVA</code>  ç‰ˆæœ¬</a></p>\n<p>å…¶ä»–è¯­è¨€ï¼Œæ¯”å¦‚  <code>python</code> ,  <code>golang</code> ,  <code>c++</code> ,  <code>js</code> ,  <code>php</code> ,  <code>kotlin</code>  ç‰ˆæœ¬çš„ä»£ç ï¼Œä½ æœ‰æ²¡æœ‰å…´è¶£æä¸€æ³¢å‘¢ï¼ŸğŸ‘‰ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZhbmdqaWF4aWFvYmFpL2RhdGFfc3RydWN0dXJlc19hbmRfYWxnb3JpdGhtcw==\">èµæ•™åœ°å€</span></p>\n<p>å„ä½çœ‹å®˜å¯ä»¥é€‰æ‹©è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€æŸ¥çœ‹ã€‚å®ç°ä»£ç ä»…ä¾›å‚è€ƒã€‚å¦‚æœ‰é«˜è§ï¼Œæ¬¢è¿äº¤æµå“‡ï½ï¼Œè¿˜è¯·ä¸åèµæ•™ï¼</p>\n<p>ä¹Ÿæ¬¢è¿å¤§ä¾ æäº¤è‡ªå·±æ“…é•¿è¯­è¨€çš„ä»£ç åˆ°ä»“åº“ï½ï¼Œé›†æ€å¹¿ç›Šï¼Œä¸€èµ·äº¤æµï¼æœŸå¾…ï½ï½</p>\n<p>(ä»“åº“ä¸­çš„æ•°æ®ç»“æ„ä¸ç®—æ³•æŒç»­æ›´æ–°å“¦ï¼Œæ¬¢è¿ <code>star</code> )</p>\n<h3 id=\"æ—¶é—´å¤æ‚åº¦çš„åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#æ—¶é—´å¤æ‚åº¦çš„åˆ†æ\">#</a> æ—¶é—´å¤æ‚åº¦çš„åˆ†æ</h3>\n<p>å› ä¸ºè·³è¡¨çš„æ—¶é—´å¤æ‚åº¦å’Œè·³è¡¨çš„å±‚æ•°ä»¥åŠè¯¥å±‚ä¸Šçš„èŠ‚ç‚¹æ•°å’ŒèŠ‚ç‚¹åˆ†å¸ƒçš„ä½ç½®æœ‰å…³ï¼Œè€Œè¿™äº›å› ç´ éƒ½æ˜¯éšæœºçš„ã€‚ æ­¤ä¸­æ¶‰åŠäº†å¾ˆå¤šå¤æ‚çš„æ¦‚ç‡ç»Ÿè®¡å­¦çŸ¥è¯†ã€‚æ‰€ä»¥æˆ‘å°±æ‘˜è‡ªç»´åŸºç™¾ç§‘ä¸­çš„è¯´æ˜ï¼Œå¦‚ä¸‹:</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/%E8%B7%B3%E8%A1%A8-05-%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6.png\" alt=\"è·³è¡¨-05-çš„æ—¶é—´å¤æ‚åº¦png\"></p>\n<p>å¦‚æœçœ‹çš„ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆæƒ³ï¼š</p>\n<p>å¦‚æœæ¯ä¸¤ä¸ªèŠ‚ç‚¹æŠ½å‡ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºä¸Šä¸€çº§ç´¢å¼•çš„èŠ‚ç‚¹ï¼Œé‚£ç¬¬ä¸€çº§ç´¢å¼•çš„èŠ‚ç‚¹ä¸ªæ•°å¤§çº¦å°±æ˜¯  <code>n/2</code>  , ç¬¬äºŒçº§ç´¢å¼•æ˜¯  <code>n/4</code> , ç¬¬ä¸‰çº§å°±æ˜¯  <code>n/8</code> ã€‚ ä¹Ÿå°±æ˜¯è¯´ ç¬¬  <code>k</code>  çº§ç´¢å¼•èŠ‚ç‚¹ä¸ªæ•°æ˜¯  <code>n/(2^k)</code> ;</p>\n<p>å‡è®¾ï¼Œæˆ‘ä»¬æœ‰  <code>h</code>  å±‚ï¼Œæœ€é«˜å±‚ç´¢å¼•æœ‰ <code>2</code>  ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆï¼Œ å°±æ˜¯  <code>n/(2^k)=2</code> , é‚£ä¹ˆ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>N</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">k=log_2N-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>ï¼Œè¿™ä¸ªé“¾è¡¨çš„é«˜åº¦å°±æ˜¯ <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">log_2N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span>. å¦‚æœæ¯ä¸€å±‚è¦éå†  <code>m</code>  ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è·³è¡¨ä¸­æŸ¥è¯¢ä¸€ä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <code>O(m*logN)</code> .</p>\n<p>ç”±äºéšæœºåˆ†å¸ƒçš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ m å½“åšä¸€ä¸ªå¸¸æ•°ï¼Œæ‰€ä»¥ï¼Œæ—¶é—´å¤æ‚åº¦å¤§è‡´å¯ä»¥è®¤ä¸ºæ˜¯  <code>O(logN)</code></p>\n<h3 id=\"ç©ºé—´å¤æ‚åº¦çš„åˆ†æ\"><a class=\"markdownIt-Anchor\" href=\"#ç©ºé—´å¤æ‚åº¦çš„åˆ†æ\">#</a> ç©ºé—´å¤æ‚åº¦çš„åˆ†æ</h3>\n<p>æ ¹æ®æ•´ä½“ä»£ç å®ç°æ¥çœ‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†é“¾è¡¨çš„å½¢å¼æ¥å®ç°ã€‚å…¶ä¸­ï¼Œ <code>next</code>  æ”¹æˆäº†æ•°ç»„ç”¨æ¥å­˜å‚¨ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¹¶æ²¡æœ‰çœŸæ­£çš„å­˜å‚¨å¯¹è±¡ï¼Œ. ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨å¾ˆå¤šçš„å†…å­˜ï¼Œå½“ç„¶ï¼Œæ¯”ä¸€èˆ¬çš„é“¾è¡¨è¿˜æ˜¯è¦å¤šä¸€äº›çš„ã€‚å¯¹äºæˆ‘ä»¬å­˜å‚¨çš„å¯¹è±¡æ¥è®²ï¼Œç”¨äºå­˜å‚¨æŒ‡é’ˆçš„å†…å­˜ç›´æ¥å°±å¯ä»¥å¿½ç•¥äº†ã€‚æ—¶é—´å¤æ‚åº¦ä¸º  <code>O(N+m)</code> , å…¶ä¸­  <code>N&gt;&gt;m</code> ( <code>N</code>  è¿œè¿œå¤§äº <code>m</code> ).</p>\n<h3 id=\"æ¯”è¾ƒ\"><a class=\"markdownIt-Anchor\" href=\"#æ¯”è¾ƒ\">#</a> æ¯”è¾ƒ</h3>\n<h4 id=\"è·³è¡¨-ä¸å¹³è¡¡æ ‘-å“ˆå¸Œè¡¨çš„æ¯”è¾ƒ\"><a class=\"markdownIt-Anchor\" href=\"#è·³è¡¨-ä¸å¹³è¡¡æ ‘-å“ˆå¸Œè¡¨çš„æ¯”è¾ƒ\">#</a> è·³è¡¨ ä¸å¹³è¡¡æ ‘ã€å“ˆå¸Œè¡¨çš„æ¯”è¾ƒ</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:center\">è·³è¡¨</th>\n<th style=\"text-align:center\">å¹³è¡¡æ ‘</th>\n<th style=\"text-align:center\">å“ˆå¸Œè¡¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">æœ‰åºæ€§</td>\n<td style=\"text-align:center\">æœ‰åº</td>\n<td style=\"text-align:center\">æœ‰åº</td>\n<td style=\"text-align:center\">æ— åº</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">æŸ¥æ‰¾æ€§èƒ½</td>\n<td style=\"text-align:center\">O(logN)</td>\n<td style=\"text-align:center\">O(logN)</td>\n<td style=\"text-align:center\">O(N)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">å®ç°é€»è¾‘</td>\n<td style=\"text-align:center\">ç®€å•</td>\n<td style=\"text-align:center\">å¤æ‚</td>\n<td style=\"text-align:center\">ç®€å•</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">æ˜¯å¦æ”¯æŒèŒƒå›´æŸ¥æ‰¾</td>\n<td style=\"text-align:center\">æ”¯æŒ</td>\n<td style=\"text-align:center\">æ”¯æŒ</td>\n<td style=\"text-align:center\">ä¸æ”¯æŒ (æ— åº)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">æ—¶é—´å¤æ‚åº¦</td>\n<td style=\"text-align:center\">è¾ƒå°‘ï¼Œå–å†³ p å‚æ•°</td>\n<td style=\"text-align:center\">è¾ƒå¤§ (å’Œè·³è¡¨æ¯”ï¼Œå ç”¨å·¦å³å­æ ‘çš„ä¸¤ä¸ªæŒ‡é’ˆ)</td>\n<td style=\"text-align:center\">ä¸€èˆ¬</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"è§£é‡Šå¦‚ä¸‹\"><a class=\"markdownIt-Anchor\" href=\"#è§£é‡Šå¦‚ä¸‹\">#</a> è§£é‡Šå¦‚ä¸‹:</h4>\n<ul>\n<li>åœ¨åšèŒƒå›´æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¹³è¡¡æ ‘æ¯”è·³è¡¨æ“ä½œè¦å¤æ‚ã€‚åœ¨å¹³è¡¡æ ‘ä¸Šï¼Œæˆ‘ä»¬æ‰¾åˆ°æŒ‡å®šèŒƒå›´çš„å°å€¼ä¹‹åï¼Œè¿˜éœ€è¦ä»¥ä¸­åºéå†çš„é¡ºåºç»§ç»­å¯»æ‰¾å…¶å®ƒä¸è¶…è¿‡å¤§å€¼çš„èŠ‚ç‚¹ã€‚å¦‚æœä¸å¯¹å¹³è¡¡æ ‘è¿›è¡Œä¸€å®šçš„æ”¹é€ ï¼Œè¿™é‡Œçš„ä¸­åºéå†å¹¶ä¸å®¹æ˜“å®ç°ã€‚è€Œåœ¨è·³è¡¨ä¸Šè¿›è¡ŒèŒƒå›´æŸ¥æ‰¾å°±éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨æ‰¾åˆ°å°å€¼ä¹‹åï¼Œå¯¹ç¬¬ <code>1</code>  å±‚é“¾è¡¨è¿›è¡Œè‹¥å¹²æ­¥çš„éå†å°±å¯ä»¥å®ç°ã€‚</li>\n<li>å¹³è¡¡æ ‘çš„å¢åˆ æ“ä½œå¯èƒ½å¼•å‘å­æ ‘çš„å¹³è¡¡è°ƒæ•´ï¼Œè€Œè·³è¡¨çš„æ’å…¥å’Œåˆ é™¤åªéœ€è¦ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæ“ä½œç®€å•åˆå¿«é€Ÿã€‚</li>\n<li>ä»å†…å­˜å ç”¨ä¸Šæ¥è¯´ï¼Œè·³è¡¨æ¯”å¹³è¡¡æ ‘æ›´çµæ´»ä¸€äº›ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¹³è¡¡æ ‘æ¯ä¸ªèŠ‚ç‚¹åŒ…å« <code>2</code>  ä¸ªæŒ‡é’ˆï¼ˆåˆ†åˆ«æŒ‡å‘å·¦å³å­æ ‘ï¼‰ï¼Œè€Œè·³è¡¨æ¯ä¸ªèŠ‚ç‚¹åŒ…å«çš„æŒ‡é’ˆæ•°ç›®å¹³å‡ä¸º <code>1/(1-p)</code> ï¼Œå…·ä½“å–å†³äºå‚æ•° <code>p</code>  çš„å¤§å°ã€‚å¦‚æœåƒ <code>Redis</code>  é‡Œçš„å®ç°ä¸€æ ·ï¼Œå– <code>p=1/4</code> ï¼Œé‚£ä¹ˆå¹³å‡æ¯ä¸ªèŠ‚ç‚¹åŒ…å« <code>1.33</code>  ä¸ªæŒ‡é’ˆï¼Œæ¯”å¹³è¡¡æ ‘æ›´æœ‰ä¼˜åŠ¿ã€‚</li>\n<li>æŸ¥æ‰¾å•ä¸ª <code>key</code> ï¼Œè·³è¡¨å’Œå¹³è¡¡æ ‘çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º <code>O(log n)</code> ï¼Œå¤§ä½“ç›¸å½“ï¼›è€Œå“ˆå¸Œè¡¨åœ¨ä¿æŒè¾ƒä½çš„å“ˆå¸Œå€¼å†²çªæ¦‚ç‡çš„å‰æä¸‹ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ¥è¿‘ <code>O(1)</code> ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ã€‚</li>\n</ul>\n<p>æˆ‘è¿˜ä»ç½‘ä¸Šçœ‹åˆ°äº† <code>Redis</code>  çš„ä½œè€…é€‰æ‹© è·³è¡¨åšä¸º <code>zset</code>  åº•å±‚æ•°æ®ç»“æ„çš„åŸå› ï¼Œè´´åœ¨ä¸‹é¢ã€‚</p>\n<h4 id=\"redisä¸­ä½œè€…é€‰æ‹©skiplistçš„åŸå› \"><a class=\"markdownIt-Anchor\" href=\"#redisä¸­ä½œè€…é€‰æ‹©skiplistçš„åŸå› \">#</a>  <code>Redis</code>  ä¸­ä½œè€…é€‰æ‹© SkipList çš„åŸå› :</h4>\n<blockquote>\n<p>There are a few reasons:</p>\n<ol>\n<li>They are not very memory intensive. Itâ€™s up to you basically. Changing parameters about the probability of a node to have a given number of levels will make then less memory intensive than btrees.</li>\n<li>A sorted set is often target of many ZRANGE or ZREVRANGE operations, that is, traversing the skip list as a linked list. With this operation the cache locality of skip lists is at least as good as with other kind of balanced trees.</li>\n<li>They are simpler to implement, debug, and so forth. For instance thanks to the skip list simplicity I received a patch (already in Redis master) with augmented skip lists implementing ZRANK in O(log(N)). It required little changes to the code.</li>\n</ol>\n</blockquote>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<ul>\n<li>ç®€å•çš„ä»æ€§èƒ½è§’åº¦åˆ†æäº†æ•°ç»„å’Œé“¾è¡¨åœ¨æ€§èƒ½æ–¹é¢çš„éšœç¢ï¼Œå¼•å‡ºäº†æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’ï¼š è·³è¡¨ã€‚</li>\n<li>ç”»äº†ä¸€ä¸ªå¯èƒ½å‡ºç°çš„è·³è¡¨ç»“æ„ã€‚è¿™æ˜¯ä¸è·³è¡¨çš„åˆæ¬¡è§é¢ã€‚å¹¶ä»‹ç»äº†äºŒåˆ†æŸ¥æ‰¾çš„å˜ç›¸åº”ç”¨ã€‚å½“å‰ï¼Œè¿™éƒ½æ˜¯åŸºäºæœ‰åºé“¾è¡¨ä¸ºå‰æçš„ã€‚</li>\n<li>ä»‹ç»äº†é“¾è¡¨çš„å±‚çš„æ¦‚å¿µï¼Œè¿™æ˜¯è·³è¡¨ç›¸å¯¹äºé“¾è¡¨æœ€é‡è¦ä¸”å”¯ä¸€çš„æ¦‚å¿µï¼Œæœ‰äº†å®ƒæ‰æœ‰äº†æ—¶é—´å¤æ‚åº¦ä¸º <code>O(logN)</code>  çš„æŸ¥è¯¢æ•ˆç‡ï¼Œä»è€Œå®ç°äº†å¢åˆ æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ <code>O(logN)</code> ã€‚</li>\n<li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·å®Œæˆäº†è·³è¡¨çš„å®ç°é€»è¾‘ã€‚å¹¶ä¸”æä¾›äº†å¤šç§è¯­è¨€çš„è·³è¡¨å®ç°ç‰ˆæœ¬ã€‚å¸Œæœ›ä½ ä¹Ÿæäº¤ä»£ç åˆ°ä»“åº“ä¸­ï¼Œå¤§å®¶ä¸€èµ·äº¤æµï¼ŒæœŸå¾…ã€‚</li>\n<li>è·³è¡¨åœ¨å‘å±•çš„è¿‡ç¨‹ä¸­ä¹Ÿå‡ºç°å‡ ä¸ªå˜ç§ï¼Œæˆ‘ä»¬çš„è¿™ä¸ªåªæ˜¯ä¸€ä¸ªæœ€ç®€ç­”çš„å®ç°ã€‚ç”šè‡³æˆ‘ä»¬éƒ½æ²¡æœ‰è€ƒè™‘è¿‡å…ƒç´ ä¸ªæ•°ä¸å±‚æ•°çš„æœ€ä¼˜è§£ç­‰ç­‰é—®é¢˜ã€‚åé¢ä¼šæœ‰ä¸€ç¯‡æ–‡ç« åˆ†äº«çš„æ˜¯ <code>Redis</code>  ä¸­ <code>skiplist</code>  çš„å®ç°ã€‚æ•¬è¯·æœŸå¾…å§ï½</li>\n</ul>\n<h2 id=\"æ¨è\"><a class=\"markdownIt-Anchor\" href=\"#æ¨è\">#</a> æ¨è</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0yZzlPU1JLSnV6TQ==\">æŸé«˜æ ¡è·³è¡¨å…¬å¼€è¯¾ (éœ€ç§‘å­¦ä¸Šç½‘)</span></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis",
                "æ•°æ®ç»“æ„"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-7-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BHyperLogLogs/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-7-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BHyperLogLogs/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹ `HyperLogLogs`",
            "date_published": "2021-08-01T10:58:55.000Z",
            "content_html": "<h2 id=\"ä¹¦æ¥ä¸Šå›\"><a class=\"markdownIt-Anchor\" href=\"#ä¹¦æ¥ä¸Šå›\">#</a> ä¹¦æ¥ä¸Šå›</h2>\n<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ çš„  <code>bitmap</code>  è¿™ä¸€ <code>â€œæ•°æ®ç±»å‹â€</code> ã€‚å…¶å†…éƒ¨æ˜¯ç”± <code>sds</code>  è¿™ç§ç§æ•°æ®ç»“æ„ç¼–ç çš„ã€‚<br>\nå¦‚æœä¸è®°å¾—äº†ï¼Œé‚£å°±æ¥åç©¿æ¢­æœºå›å»çœ‹çœ‹å§ã€‚ <a href=\"./010-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E4%BD%8D%E5%9B%BEbitmap.md\">å¼€å§‹ç©¿æ¢­</a></p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸€ä¸ªæ–°çš„ <code>&quot;æ•°æ®ç±»å‹&quot;</code> , ä½å›¾ï¼Œ <code>HyperLogLogs</code> .ï¼ˆæ³¨æ„å•¦ï¼Œæ•°æ®ç±»å‹ï¼Œæˆ‘åˆåŠ äº†å¼•å·ï¼ï¼ï¼‰</p>\n<h2 id=\"hyperloglogsç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#hyperloglogsç®€ä»‹\">#</a>  <code>HyperLogLogs</code>  ç®€ä»‹</h2>\n<p><code>HyperLogLog</code>  æ˜¯ä¸€ç§<b>æ¦‚ç‡æ•°æ®ç»“æ„</b>ï¼Œç”¨äºå¯¹å”¯ä¸€äº‹ç‰©è¿›è¡Œè®¡æ•°ï¼ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™æ˜¯æŒ‡ä¼°è®¡é›†åˆçš„åŸºæ•°ï¼‰ã€‚</p>\n<p>æ³¨æ„å“¦ï¼Œ  <code>HyperlogLog</code>  å…¶å®æ˜¯ä¸€ç§åŸºæ•°è®¡æ•°ç®—æ³•ï¼Œå¹¶é <code>Redis</code>  ç‹¬æœ‰çš„ã€‚</p>\n<p>é€šå¸¸ï¼Œå¯¹å”¯ä¸€é¡¹ç›®è¿›è¡Œè®¡æ•°éœ€è¦ä½¿ç”¨ä¸è¦è®¡æ•°çš„é¡¹ç›®æ•°é‡æˆæ¯”ä¾‹çš„å†…å­˜é‡ï¼Œå› ä¸ºæ‚¨éœ€è¦è®°ä½è¿‡å»å·²ç»çœ‹åˆ°çš„å…ƒç´ ï¼Œä»¥é¿å…å¤šæ¬¡å¯¹å…¶è¿›è¡Œè®¡æ•°ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç»„ç®—æ³•ä¼šä»¥å†…å­˜æ¢å–ç²¾åº¦ï¼šä»¥ <code>Redis</code>  å®æ–½ä¸ºä¾‹ï¼Œæ‚¨å¾—å‡ºçš„å¸¦æœ‰æ ‡å‡†è¯¯å·®çš„ä¼°è®¡åº¦é‡æœ€ç»ˆä¼šå°äº <code>1ï¼…</code> ã€‚</p>\n<p>è¯¥ç®—æ³•çš„ç¥å¥‡ä¹‹å¤„åœ¨äºï¼Œæ‚¨ä¸å†éœ€è¦ä½¿ç”¨ä¸æ‰€è®¡æ•°é¡¹ç›®æ•°é‡æˆæ¯”ä¾‹çš„å†…å­˜é‡ï¼Œè€Œå¯ä»¥ä½¿ç”¨æ’å®šæ•°é‡çš„å†…å­˜ï¼åœ¨æœ€åçš„æƒ…å†µä¸‹ä¸º <code>12k</code>  å­—èŠ‚ï¼Œå¦‚æœæ‚¨çš„ <code>HyperLogLogs</code>  çœ‹åˆ°çš„å…ƒç´ å¾ˆå°‘ï¼Œè€Œä¸”å°‘å¾—å¤šã€‚</p>\n<p><code>Redis</code>  ä¸­çš„ <code>HyperLogLog</code>  å°½ç®¡åœ¨æŠ€æœ¯ä¸Šæ˜¯ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä½†è¢«ç¼–ç ä¸º <code>Rediså­—ç¬¦ä¸²</code>  ( <code>sds</code> )ï¼Œå› æ­¤æ‚¨å¯ä»¥è°ƒç”¨ <code>GET</code>  æ¥åºåˆ—åŒ– <code>HyperLogLogs</code> ï¼Œç„¶åè°ƒç”¨ <code>SET</code>  æ¥å°†å…¶ååºåˆ—åŒ–å›æœåŠ¡å™¨ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨æ–‡æœ«ä¼šå¤§ä½“ç¿»ä¸€ä¸‹æºç ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ HyperLogLog æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ã€‚</p>\n<h3 id=\"hyperloglog-çš„åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#hyperloglog-çš„åº”ç”¨åœºæ™¯\">#</a>  <code>HyperLogLog</code>  çš„åº”ç”¨åœºæ™¯</h3>\n<p>æ ¹æ® <code>HyperLogLog</code>  çš„ç‰¹æ€§æ¥çœ‹ï¼Œä½¿ç”¨äº†ä¸€ç§æ¦‚ç‡æ€§è®¡æ•°çš„åŠŸèƒ½ï¼Œè¿™æ ·çš„åŠŸèƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯å½“æ•°æ®ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œå…¶ç»Ÿè®¡çš„å€¼æ˜¯ä¸å‡†ç¡®çš„ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>\n<p>å°±æ˜¯æ¯”å¦‚ç»Ÿè®¡ä¸€ä¸ªç½‘ç«™çš„ <code>PV</code> ï¼Œ <code>PV</code>  æ•°å€¼æ˜¯  <code>123456789</code>  æˆ–è€…  <code>123456000</code>  è¿™ä¸¤è€…çš„å€¼å¯¹äºç®¡ç†è€…æ¥è®²æ˜¯ä¸€æ ·çš„ã€‚å¯¹äºä¸€äº›<b>å¯¹ç²¾åº¦è¦æ±‚ä¸å‡†ç¡®è€Œä¸”æ•°æ®é‡å¾ˆå¤§</b>çš„åœºæ™¯æ˜¯éå¸¸é€‚åˆçš„ã€‚</p>\n<p>æ¯”å¦‚ä»¥ä¸‹åœºæ™¯ï¼šè®¡ç®—ç½‘ç«™çš„ PVï¼ŒUVï¼Œç»Ÿè®¡æ—¥æ´»ï¼Œæœˆæ´»ï¼Œç»Ÿè®¡ç”¨æˆ·æ¯å¤©æœç´¢çš„è¯æ¡æ•°ç­‰ç­‰ã€‚</p>\n<h3 id=\"hyperloglog-çš„å¸¸ç”¨å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#hyperloglog-çš„å¸¸ç”¨å‘½ä»¤\">#</a>  <code>HyperLogLog</code>  çš„å¸¸ç”¨å‘½ä»¤</h3>\n<p><code>HyperLogLog</code>  åº”è¯¥æ˜¯ <code>Redis</code>  æ‰€æœ‰ç»“æ„ä¸­å‘½ä»¤æœ€å°‘çš„äº†ï¼Œåªæœ‰ä¸‰ä¸ªå‘½ä»¤ã€‚</p>\n<ul>\n<li><code>PFADD key element [element ...]</code></li>\n</ul>\n<p>æ·»åŠ å…ƒç´ ã€‚<br>\nå¦‚æœä¸€ä¸ª <code>HyperLogLog</code>  çš„ä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°åœ¨æ‰§è¡Œå‘½ä»¤è¿‡ç¨‹ä¸­å‘äº†å˜åŒ–ï¼Œ  <code>PFADD</code>  è¿”å› <code>1</code> ï¼Œå¦åˆ™è¿”å› <code>0</code> ï¼Œå¦‚æœæŒ‡å®šçš„ <code>key</code>  ä¸å­˜åœ¨ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç©ºçš„ <code>HyperLogLog</code>  ç»“æ„ï¼ˆæŒ‡å®šé•¿åº¦å’Œç¼–ç çš„å­—ç¬¦ä¸²ï¼‰.</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; pfadd k96 v1 v2 v3</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfadd k96 v4</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfadd k96 v1</span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfadd k96 v2 v3 v4</span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; </span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>PFCOUNT key [key ...]</code></li>\n</ul>\n<p>å½“å‚æ•°ä¸ºä¸€ä¸ª <code>key</code>  æ—¶ï¼Œè¿”å›å­˜å‚¨åœ¨ <code>HyperLogLog</code>  ç»“æ„ä½“çš„è¯¥å˜é‡çš„è¿‘ä¼¼åŸºæ•°ï¼Œå¦‚æœè¯¥å˜é‡ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› <code>0</code> .</p>\n<p>å½“å‚æ•°ä¸ºå¤šä¸ª <code>key</code>  æ—¶ï¼Œè¿”å›è¿™äº› <code>HyperLogLog</code>  å¹¶é›†çš„è¿‘ä¼¼åŸºæ•°ï¼Œè¿™ä¸ªå€¼æ˜¯å°†æ‰€ç»™å®šçš„æ‰€æœ‰ <code>key</code>  çš„ <code>HyperLoglog</code>  ç»“æ„åˆå¹¶åˆ°ä¸€ä¸ªä¸´æ—¶çš„ <code>HyperLogLog</code>  ç»“æ„ä¸­è®¡ç®—è€Œå¾—åˆ°çš„.</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; pfadd k97 v1 v2 v3 v4</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; PFCOUNT k97</span><br><span class=\"line\">(integer) <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"comment\"># æµ‹è¯•å¤šä¸ªkey</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; PFCOUNT k97 k96</span><br><span class=\"line\">(integer) <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; PFADD k97 v5 v6</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; PFCOUNT k97 k96</span><br><span class=\"line\">(integer) <span class=\"number\">6</span></span><br></pre></td></tr></table></figure>\n<p>åˆšæ‰è¯´äº†ï¼Œ <code>HyperLogLog</code>  åªæ˜¯å­˜å‚¨æ€»æ•°çš„ä¸€ç§ç»“æ„ï¼Œè€Œä¸”å…¶å€¼ä¹Ÿä¼šå’Œå®é™…å€¼æœ‰åå·®ã€‚æˆ‘ä»¬ä¸€èµ·æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªç»“æœ</p>\n<p>æˆ‘ä»¬å¾€ <code>Redis</code>  ä¸­æ’å…¥ <code>10000</code>  æ¡æ•°æ®ï¼ŒæŸ¥çœ‹å…¶  <code>pfcount</code>  çš„å€¼æ˜¯å¤šå°‘ã€‚</p>\n<p>ä½¿ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬å»æ’å…¥ ( <code>java</code>  å®ç°)ã€‚å…¬ä¼—å·å›å¤  <code>RedisClient</code>  å¯ä»¥è·å–å®Œæ•´æºç ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String host = <span class=\"string\">&quot;10.1.14.159&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> port = <span class=\"number\">6379</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">SocketRedisClient client = <span class=\"keyword\">new</span> SocketRedisClient(host, port);</span><br><span class=\"line\">String authCmd = client.exec(<span class=\"string\">&quot;auth moyang&quot;</span>);</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;ç™»å½•éªŒè¯ç»“æœ:&quot;</span> + authCmd);</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;åˆ é™¤å·²ç»å­˜åœ¨çš„key :&quot;</span> + client.exec(<span class=\"string\">&quot;del k97&quot;</span>));</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt;= <span class=\"number\">10000</span>; i++) &#123;</span><br><span class=\"line\">    String cmd = <span class=\"string\">&quot;pfadd k97 &quot;</span> + i;</span><br><span class=\"line\">    client.exec(cmd);</span><br><span class=\"line\"></span><br><span class=\"line\">    String cmd2 = <span class=\"string\">&quot;pfcount k97 &quot;</span>;</span><br><span class=\"line\">    String exec = client.exec(cmd2);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;æ‰§è¡Œå‘½ä»¤:&quot;</span> + cmd + <span class=\"string\">&quot; è¿”å›ç»“æœ:&quot;</span> + exec); <span class=\"comment\">// è¿”å›çš„ç»“æœæ˜¯æœªè§£æRedisåè®®çš„ã€‚</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">client.releases();</span><br></pre></td></tr></table></figure>\n<p>æ’å…¥å®Œæˆä¹‹åï¼Œå¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°  <code>pfCount</code>  çš„ç»“æœæ˜¯  <code>9988</code> .</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/pf-%E6%89%A7%E8%A1%8C10000%E6%AC%A1%E6%8F%92%E5%85%A5%E7%BB%93%E6%9E%9C.png\" alt=\"\"></p>\n<p>å¦‚æœä¸ç›¸ä¿¡æˆ‘ä»¬å¯ä»¥ åœ¨ <code>shell</code>  é‡Œçœ‹çœ‹ã€‚</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; pfcount k97</span><br><span class=\"line\">(integer) <span class=\"number\">9988</span></span><br></pre></td></tr></table></figure>\n<p>æˆ‘è¿™æ¬¡æµ‹è¯•æ­£å¥½ç›¸ç­‰ï¼Œå…¶å®ç”±äºè„šæœ¬çš„é—®é¢˜å‘¢ï¼Œä»ç¨‹åºé‡Œè·å–çš„å€¼å’Œ <code>shell</code>  é‡Œè·å–çš„å€¼ï¼Œå¯èƒ½ä¸ä¸€æ ·ï¼Œè¿™ç§æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ ä½¿ç”¨è„šæœ¬å•ç‹¬å†æ‰§è¡Œä¸€æ¬¡ï¼Œå°±ä¼šä¸€æ ·äº†ã€‚å…·ä½“åŸå› ï¼Œä¸èµ˜è¿°äº†ã€‚</p>\n<p>å¥½äº†ï¼Œæˆ‘ä»¬æ’å…¥äº† <code>10000</code>  æ¬¡ï¼Œä½†æ˜¯å¾—å‡ºçš„å€¼å´æ˜¯  <code>9988</code> ï¼Œ è¿™ä¹Ÿå°±éªŒè¯äº†å…¶ä¸ç²¾ç¡®æ€§ã€‚</p>\n<ul>\n<li><code>PFMERGE destkey sourcekey [sourcekey ...]</code></li>\n</ul>\n<p>å°†å¤šä¸ª  <code>HyperLogLog</code>  åˆå¹¶ï¼ˆ <code>merge</code> ï¼‰ä¸ºä¸€ä¸ª  <code>HyperLogLog</code>  ï¼Œ åˆå¹¶åçš„  <code>HyperLogLog</code>  çš„åŸºæ•°æ¥è¿‘äºæ‰€æœ‰è¾“å…¥  <code>HyperLogLog</code>  çš„å¯è§é›†åˆï¼ˆ <code>observed set</code> ï¼‰çš„å¹¶é›†.</p>\n<p>åˆå¹¶å¾—å‡ºçš„  <code>HyperLogLog</code>  ä¼šè¢«å‚¨å­˜åœ¨ç›®æ ‡å˜é‡ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰é‡Œé¢ï¼Œ å¦‚æœè¯¥é”®å¹¶ä¸å­˜åœ¨ï¼Œ é‚£ä¹ˆå‘½ä»¤åœ¨æ‰§è¡Œä¹‹å‰ï¼Œ ä¼šå…ˆä¸ºè¯¥é”®åˆ›å»ºä¸€ä¸ªç©ºçš„  <code>HyperLogLog</code> .</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; pfadd k98 v1 v2 v3</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfadd k98_1 v2 v3 v4</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfadd k98_2 v3 v4 v5</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfmerge k98 k98_1 k98_2</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfcount k98</span><br><span class=\"line\">(integer) <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfcount k98_1</span><br><span class=\"line\">(integer) <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; pfcount k98_2</span><br><span class=\"line\">(integer) <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šå°±æ˜¯  <code>HyperLogLog</code>  çš„å‘½ä»¤ï¼Œè€è§„çŸ©æˆ‘ä»¬ä¸‹ä¸€æ­¥æ¥çœ‹çœ‹  <code>HyperLogLog</code>  åœ¨ Redis ä¸­æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>\n<h3 id=\"hyperloglogçš„ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#hyperloglogçš„ç»“æ„\">#</a>  <code>HyperLogLog</code>  çš„ç»“æ„</h3>\n<p>åœ¨  <code>Clion</code>  ä¸­ç›´æ¥æŸ¥æ‰¾ <code>hyperloglog</code>  ï¼Œå°±æ˜¯  <code>hyperloglog</code>  çš„å®ç°äº†ã€‚</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/hyperloglog-%E6%9F%A5%E6%89%BE%E7%9B%AE%E5%BD%95.png\" alt=\"hyperloglog-æŸ¥æ‰¾ç›®å½•.png\"></p>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª  <code>struct</code></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">hllhdr</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> magic[<span class=\"number\">4</span>];      <span class=\"comment\">/* é­”æ•°: &quot;HYLL&quot; */</span></span><br><span class=\"line\">    <span class=\"keyword\">uint8_t</span> encoding;   <span class=\"comment\">/* HLL_DENSEæˆ–HLL_SPARSE */</span></span><br><span class=\"line\">    <span class=\"keyword\">uint8_t</span> notused[<span class=\"number\">3</span>]; <span class=\"comment\">/* ä¿ç•™ä»¥ä¾›å°†æ¥ä½¿ç”¨ï¼Œå¿…é¡»ä¸ºé›¶ã€‚ */</span></span><br><span class=\"line\">    <span class=\"keyword\">uint8_t</span> card[<span class=\"number\">8</span>];    <span class=\"comment\">/* ç¼“å­˜åŸºæ•°ï¼Œå°ç«¯ã€‚ */</span></span><br><span class=\"line\">    <span class=\"keyword\">uint8_t</span> registers[]; <span class=\"comment\">/* æ•°æ®å­—èŠ‚ã€‚ */</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªå°±æ˜¯  <code>HyperLogLog</code>  çš„å­˜å‚¨ç»“æ„äº†ã€‚è¿™é‡Œå¤§å®¶å¤§ä½“æœ‰ä¸ªå°è±¡å°±å¯ä»¥äº†ã€‚HyperLogLog æ˜¯ä¸€ç§åŸºæ•°ä¼°ç®—ç®—æ³•çš„å®ç°ã€‚åé¢æˆ‘ä»¬ä¼šä»‹ç»è¿™ç§<b>åŸºæ•°ä¼°ç®—æ³•</b>ã€‚</p>\n<h2 id=\"é¢„å‘Š\"><a class=\"markdownIt-Anchor\" href=\"#é¢„å‘Š\">#</a> é¢„å‘Š</h2>\n<p>æœ€åä¸€ä¸ª æ•°æ®ç±»å‹  <code>geohash</code>  (å¤šç»´ç©ºé—´ç‚¹ç´¢å¼•ç®—æ³•)ï¼ï¼ï¼</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/qrcode.jpg\" alt=\"å¾®ä¿¡äºŒç»´ç \"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-6-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E4%BD%8D%E5%9B%BEbitmap/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-6-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E4%BD%8D%E5%9B%BEbitmap/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹ä½å›¾ BitMap",
            "date_published": "2021-08-01T10:48:55.000Z",
            "content_html": "<h2 id=\"ä¹¦æ¥ä¸Šå›\"><a class=\"markdownIt-Anchor\" href=\"#ä¹¦æ¥ä¸Šå›\">#</a> ä¹¦æ¥ä¸Šå›</h2>\n<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ çš„  <code>zset</code>  é›†åˆè¿™ä¸€æ•°æ®ç±»å‹ã€‚å…¶å†…éƒ¨æ˜¯ç”± <code>skiplist</code>  å’Œ <code>hashtable</code>  è¿™ç§ä¸¤ç§æ•°æ®ç»“æ„ç¼–ç çš„ã€‚<br>\nå¦‚æœä¸è®°å¾—äº†ï¼Œé‚£å°±æ¥åç©¿æ¢­æœºå›å»çœ‹çœ‹å§ã€‚ <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-5-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset/\">å¼€å§‹ç©¿æ¢­</a></p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸€ä¸ªæ–°çš„ <code>&quot;æ•°æ®ç±»å‹&quot;</code> , ä½å›¾ï¼Œ <code>bitmap</code> .ï¼ˆæ³¨æ„å•¦ï¼Œæ•°æ®ç±»å‹ï¼Œæˆ‘åŠ äº†å¼•å·ï¼ï¼ï¼‰</p>\n<h2 id=\"bitmapç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#bitmapç®€ä»‹\">#</a>  <code>bitmap</code>  ç®€ä»‹</h2>\n<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ <code>bitmap</code> , æˆ‘ä»¬å…ˆä»åå­—ä¸Šæ¥è¯´ï¼Œ <code>bit</code> ï¼Œè®¡ç®—æœºä¸­æœ€å°çš„å•ä½ï¼Œä¸€ä¸ª <code>bit</code>  è¡¨ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶ä½ã€‚ <code>map</code> ï¼Œæ˜ å°„ï¼Œå›¾ã€‚æ‰€ä»¥ï¼Œ <code>bitmap</code>  å°±æ˜¯è¡¨ç¤ºå¯¹äºŒè¿›åˆ¶ä½çš„æ˜ å°„ã€‚é‚£å…·ä½“æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ <code>bitmap</code>  å…¶å®å°±æ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å¯¹äºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œï¼Œä»è€Œè¾¾åˆ°èŠ‚çº¦ç©ºé—´å ç”¨çš„ä½œç”¨ã€‚</p>\n<p>è€Œä¸”ï¼Œ <code>bitmap</code> ï¼Œä¸­æ–‡çš„æ„æ€å°±æ˜¯ä½å›¾ã€‚ ä¸çŸ¥é“ä½ ç”¨æ²¡ç”¨è¿‡ <code>C</code>  è¯­è¨€çš„ä½å›¾ç»“æ„ï¼Œä»–ä»¬çš„ç›®çš„éƒ½æ˜¯ä¸€æ ·ã€‚</p>\n<p>å¯èƒ½ä½ è¿˜æ˜¯ä¸ç†è§£ï¼Œåˆ«æ€¥ï¼Œå¾€ä¸‹çœ‹ã€‚</p>\n<p><code>bitmap</code>  æ€ä¹ˆç”¨å‘¢ï¼Ÿ</p>\n<p>æ°å·§ï¼Œå‰å‡ å¤©å°ç¼–åœ¨é¢è¯•ä¸­è¢«é—®åˆ°è¿‡è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p>é¢è¯•å®˜è¯´ï¼š <b>æœ‰ä¸ªä¸šåŠ¡åœºæ™¯ï¼šæˆ‘ä»¬è¿™è¾¹æœ‰ 10000 å®¶çº¿ä¸‹é—¨åº—ï¼Œæˆ‘ä»¬è¦å¯¹éƒ¨åˆ†é—¨åº—è¿›è¡Œå¹¿å‘ŠæŠ•æ”¾ï¼Œæ€ä¹ˆè®°å½•æŸæ¡å¹¿å‘ŠæŠ•æ”¾ç»™å“ªå®¶é—¨åº—é‡Œäº†å‘¢ï¼Ÿæˆ‘ä»¬çš„é—¨åº— <code>id</code>  æ˜¯é€’å¢çš„ã€‚</b></p>\n<p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥æœ‰ä¸‰å¼ è¡¨ï¼Œå¹¿å‘Šè¡¨ ( <code>G</code>  è¡¨)ï¼Œé—¨åº—è¡¨ï¼ˆ <code>M</code>  è¡¨ï¼‰ï¼Œå¹¿å‘Šé—¨åº—å…³è”è¡¨ï¼ˆ <code>GM</code>  è¡¨ï¼‰ã€‚</p>\n<p>å¦‚æœæˆ‘ä»¬æŠ•æ”¾å¹¿å‘Šçš„æ—¶å€™ï¼ŒæŠŠæ¯æ¡å¹¿å‘Šå’Œæ¯ä¸ªé—¨åº—çš„å…³è”ä½œä¸ºä¸€æ¡æ•°æ®æ’å…¥åˆ° <code>GM</code>  è¡¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨ä¸­çš„æ•°æ®é‡å¢é•¿è¿˜æ˜¯éå¸¸å¿«çš„ã€‚å¦‚æœæœ‰ <code>10</code>  ä¸‡å®¶é—¨åº—å‘¢ï¼Ÿå¹¿å‘Šçš„æŠ•æ”¾å’Œæ’¤é”€æ¯”è¾ƒé¢‘ç¹ã€‚ä¹Ÿå°±æ˜¯è¯´æ•°æ®çš„ä¿®æ”¹ä¹Ÿæ˜¯æ¯”è¾ƒé¢‘ç¹çš„ã€‚é‚£æ€ä¹ˆæå‘¢ï¼Ÿ</p>\n<p>é—¨åº—çš„ <code>id</code>  æ˜¯é€’å¢çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæï¼Œç”¨ <code>10001</code>  ä¸ªäºŒè¿›åˆ¶ä½è¡¨ç¤º <code>10000</code>  å®¶é—¨åº—çš„ idï¼Œå¦‚æœè¯¥é—¨åº—æŠ•æ”¾äº†è¯¥å¹¿å‘Šï¼Œå°±æŠŠè¯¥ä½ç½®ä¸Šçš„æ•°å­—ç½®ä¸º <code>1</code> ã€‚å¹¶ä¸”æ¯å››ä¸ªå­—èŠ‚è½¬æ¢æˆä¸€ä¸ªæ•´æ•°å‹æ•°ï¼Œå°†ï¼ˆ <code>10000/8/4</code> ï¼‰ <code>313</code>  ä¸ªæ•´å½¢æ•°æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è½¬æ¢æˆå­—ç¬¦ä¸²å­˜å‚¨åˆ° <code>GM</code>  è¡¨ä¸­ã€‚è¡¨ç¤ºä¸€æ¡å¹¿å‘Šå·²ç»æŠ•æ”¾çš„é—¨åº—ã€‚è¿™æ ·æˆ‘ä»¬å°±ä½¿ç”¨äº† <code>0.1kb</code>  å·¦å³çš„ç©ºé—´è®°å½•äº†æŸæ¡å¹¿å‘ŠæŠ•æ”¾é—¨åº—çš„æƒ…å†µã€‚</p>\n<p>å…¶å®å‘¢ï¼Œè¿™å°±æ˜¯ä½¿ç”¨ <code>bitmap</code>  è¿›è¡Œå­˜å‚¨çš„ã€‚</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ ä½å›¾ã€‚</p>\n<h2 id=\"bitmapçš„åŸºæœ¬å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#bitmapçš„åŸºæœ¬å‘½ä»¤\">#</a>  <code>bitmap</code>  çš„åŸºæœ¬å‘½ä»¤</h2>\n<ul>\n<li><code>SETBIT</code></li>\n</ul>\n<p><code>setbit key offset value</code></p>\n<p>å¯¹  <code>key</code>  æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè®¾ç½®æˆ–æ¸…é™¤æŒ‡å®šåç§»é‡ä¸Šçš„ä½ ( <code>bit</code> )ã€‚<br>\nä½çš„è®¾ç½®æˆ–æ¸…é™¤å–å†³äº  <code>value</code>  å‚æ•°ï¼Œå¯ä»¥æ˜¯  <code>0</code>  ä¹Ÿå¯ä»¥æ˜¯  <code>1</code>  ã€‚<br>\nå½“  <code>key</code>  ä¸å­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å€¼ã€‚<br>\nå­—ç¬¦ä¸²ä¼šè¿›è¡Œä¼¸å±• ( <code>grown</code> ) ä»¥ç¡®ä¿å®ƒå¯ä»¥å°†  <code>value</code>  ä¿å­˜åœ¨æŒ‡å®šçš„åç§»é‡ä¸Šã€‚å½“å­—ç¬¦ä¸²å€¼è¿›è¡Œä¼¸å±•æ—¶ï¼Œç©ºç™½ä½ç½®ä»¥  <code>0</code>  å¡«å……ã€‚<br>\n <code>offset</code>  å‚æ•°å¿…é¡»å¤§äºæˆ–ç­‰äº  <code>0</code>  ï¼Œå°äº  <code>2^32</code>  ( <code>bit</code>  æ˜ å°„è¢«é™åˆ¶åœ¨  <code>512 MB</code>  ä¹‹å†…)ã€‚</p>\n<p>å‡è®¾æˆ‘ä»¬ä½¿ç”¨ ä½å›¾æ¥å­˜å‚¨ <code>Redis</code>  è¿™ä¸ªå­—ç¬¦ä¸²ã€‚</p>\n<p>åœ¨æ¼”ç¤ºè¿™ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸‹ å¦‚ä½•ä½¿ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚</p>\n<p><code>Redis</code>  ä¸­çš„  <code>R</code>  å¯¹åº”  <code>ASCII</code>  ç æ˜¯:  <code>82</code> . è½¬åŒ–æˆäºŒè¿›åˆ¶å°±æ˜¯:  <code>0b01010010</code> , å…¶ä»–å­—ç¬¦ä¾æ¬¡å¦‚ä¸‹æ‰€ç¤ºï¼š<br>\n <code>Redis</code>  ä¸­çš„  <code>e</code>  å¯¹åº”  <code>ASCII</code>  ç æ˜¯:  <code>101</code> . è½¬åŒ–æˆäºŒè¿›åˆ¶å°±æ˜¯:  <code>0b01100101</code> ï¼Œ<br>\n <code>Redis</code>  ä¸­çš„  <code>d</code>  å¯¹åº”  <code>ASCII</code>  ç æ˜¯:  <code>100</code> . è½¬åŒ–æˆäºŒè¿›åˆ¶å°±æ˜¯:  <code>0b01100100</code> ï¼Œ<br>\n <code>Redis</code>  ä¸­çš„  <code>i</code>  å¯¹åº”  <code>ASCII</code>  ç æ˜¯:  <code>105</code> . è½¬åŒ–æˆäºŒè¿›åˆ¶å°±æ˜¯:  <code>0b01101001</code> ï¼Œ<br>\n <code>Redis</code>  ä¸­çš„  <code>s</code>  å¯¹åº”  <code>ASCII</code>  ç æ˜¯:  <code>115</code> . è½¬åŒ–æˆäºŒè¿›åˆ¶å°±æ˜¯:  <code>0b01110011</code> ã€‚</p>\n<p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘è¦å‘Šè¯‰ä½ ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šå¯¹äºä½å›¾çš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å®ç° <b>  <code>é›¶å­˜æ•´å–</code>  </b>ã€‚ ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>\n<p>æˆ‘æ¥ç»™ä½ æ¼”ç¤ºä¸€ä¸‹</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/bitmap-R%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6.png\" alt=\"Rå¯¹åº”çš„ä½å›¾\"></p>\n<p>å¦‚ä¸Šå›¾ï¼Œ <code>R</code>  è¿™ä¸ªå­—ç¬¦ï¼Œå¯¹åº”çš„æ¯ä¸ªäºŒè¿›åˆ¶ä¸Šçš„æ•°ã€‚ç”±äºä½å›¾ä¼šè‡ªåŠ¨å¡«å……ç©ºä½ä¸º 0ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®¾ç½®äºŒè¿›åˆ¶ä½ä¸Šä¸º <code>1</code>  çš„å°±å¯ä»¥äº†ã€‚å…·ä½“å‘½ä»¤å¦‚ä¸‹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; setbit k87 1 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 3 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 6 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; get k87</span><br><span class=\"line\">&quot;R&quot;</span><br></pre></td></tr></table></figure>\n<p>è§£é‡Šä¸€ä¸‹ï¼Œæˆ‘ä»¬æ ¹æ®  <code>R</code>  æ¯ä¸ªäºŒè¿›åˆ¶ä½ä¸Šæ•°å€¼è®¾ç½®åˆ° k87 ä¸­ï¼Œç„¶åé€šè¿‡ <code>get k87</code>  è¿™ä¸ªå‘½ä»¤ï¼Œè¿”å›äº†  <code>R</code> ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„  <code>é›¶å­˜æ•´å–</code> ã€‚å¦‚æœæˆ‘ç»§ç»­è®¾ç½®å‰©ä¸‹çš„  <code>edis</code>  å­—ç¬¦ä¸²å‘¢ï¼Ÿ</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/bitmap-Redis%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6.png\" alt=\"Rediså®Œæ•´çš„ä½å›¾\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; setbit k87 9 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 10 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 13 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 15 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 17 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 18 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 21 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 25 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 26 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 28 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 31 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 33 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 34 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 35 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 38 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; setbit k87 39 1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; get k87</span><br><span class=\"line\">&quot;Redis&quot;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œä½ å°±å¯èƒ½è¯´ï¼Œæœ‰è°ä¼šè¿™æ ·ä½¿ç”¨ï¼Œè‡ªå·±è®¡ç®—å‡ºæ¯ä¸ªä½ï¼Œç„¶åå»è·å–å®Œæ•´çš„ï¼Ÿ æ˜¯å•Šï¼Œä¸è¿‡è¿™é‡Œåªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜ ä½å›¾  <code>é›¶å­˜æ•´å–</code>  åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç€çœ‹ ä½å›¾  <code>æ•´å­˜é›¶å–</code> çš„åŠŸèƒ½ã€‚</p>\n<p>è¿™é‡Œå‘¢ï¼Œå°±è¦ä»‹ç»  <code>gitbit</code>  è¿™ä¸ªå‘½ä»¤ã€‚</p>\n<ul>\n<li><code>GETBIT</code></li>\n</ul>\n<p><code>GETBIT key offset</code></p>\n<p>å¯¹  <code>key</code>  æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®š <code>offset</code>  ä¸Šçš„ä½ ( <code>bit</code> ).</p>\n<p>å¦‚æœ <code>key</code>  ä¸å­˜åœ¨ï¼Œè·å– <code>offset</code>  è¶…å‡ºèŒƒå›´ï¼Œè¿”å› <code>0</code> .</p>\n<p>é¦–å…ˆæˆ‘ä»¬è®¾ç½® ä¸€ä¸ª  <code>string</code>  ç±»å‹çš„å­—ç¬¦ä¸²åˆ° <code>Redis</code>  ä¸­ï¼Œç„¶åä¾æ¬¡è·å–æ¯ä¸€ä½ä¸Šçš„å€¼ã€‚</p>\n<p>å¯ä»¥å’Œä¸‹å›¾è¿›è¡Œæ¯”å¯¹ã€‚</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/bitmap-Redis%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6.png\" alt=\"Rediså®Œæ•´çš„ä½å›¾\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; set k88 Redis</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 0</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 1</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 2</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 3</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 4</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 5</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 6</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 7</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 8</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 9</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 10</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ....</span></span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 38</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 39</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æ¼”ç¤ºè¶…å‡ºèŒƒå›´</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 40</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 41</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; getbit k88 42</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªå°±æ˜¯ ä½å›¾æä¾›çš„   <code>æ•´å­˜é›¶å–</code> çš„åŠŸèƒ½äº†ã€‚ç»¼åˆä¸Šé¢çš„ä¸¤é¡¹åŠŸèƒ½ï¼Œæˆ‘ä»¬è½»è€Œæ˜“ä¸¾çš„å°±å¯ä»¥å¾—å‡º Redis çš„ä½å›¾æ˜¯å¯ä»¥  <code>é›¶å­˜é›¶å–</code> çš„ã€‚å°±æ˜¯ä½¿ç”¨  <code>setbit</code>  å’Œ  <code>gitbit</code>  å‘½ä»¤äº†ã€‚è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚</p>\n<ul>\n<li><code>BITCOUNT</code></li>\n</ul>\n<p><code>bitCount key [start] [end]</code></p>\n<p>è®¡ç®—æŒ‡å®š <code>key</code>  çš„å¯¹åº”å­—ç¬¦ä¸²ï¼Œè¢«è®¾ç½®ä¸º <code>1</code>  çš„æ¯”ç‰¹ä½çš„æ•°é‡ã€‚</p>\n<p>è¿˜æ˜¯ä»¥ä¸Šé¢çš„ <code>Redis</code>  ä¸ºä¾‹ï¼Œä¸€å…±æ˜¯ <code>19</code>  ä½ <code>1</code> . æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›0</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; bitcount k89</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; set k89 Redis</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; bitcount k89 </span><br><span class=\"line\">(integer) 19</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æ³¨æ„è¿™é‡Œstart end éƒ½æ˜¯è¡¨ç¤ºå­—èŠ‚ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; bitcount k89 0 1 </span><br><span class=\"line\">(integer) 7</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªé€‚åˆä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨å‘¢ï¼Ÿ æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦è®¡ç®—æŸä¸ªç”¨æˆ·ç™»å½•å¤©æ•°ã€‚ç¬¬ä¸€å¤©ç™»å½•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ å¯ä»¥è®¾ç½®  <code>setbit user1 1 1</code> , ç¬¬äºŒå¤©è®¾ç½®  <code>setbit use1 2 1</code> , é‚£ä¹ˆä½¿ç”¨  <code>bitcount user1</code>  å°±èƒ½çŸ¥é“è¯¥ç”¨æˆ·æ€»å…±çš„ç™»å½•å¤©æ•°äº†ï¼Œä¹Ÿèƒ½å¤Ÿè®¡ç®—å‡ºè¯¥ç”¨æˆ·åœ¨å“ªå¤©ç™»å½•äº†ã€‚</p>\n<ul>\n<li><code>BITPOS</code></li>\n</ul>\n<p><code>bitpos key  bit [start] [end]</code></p>\n<p>è¿”å› key çš„æŒ‡å®šåŒºæ®µå†…å®¹ï¼Œç¬¬ä¸€ä¸ª bit çš„ä½ç½®ã€‚</p>\n<p>æ¯”å¦‚æˆ‘ä»¬ä»¥  <code>Redis</code>  ä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾</p>\n<p><img data-src=\"./images/bitmap-Redis%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6.png\" alt=\"\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; set key90 Redis</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; bitops key90 1</span><br><span class=\"line\">(error) ERR unknown command `bitops`, with args beginning with: `key90`, `1`, </span><br><span class=\"line\">127.0.0.1:6379&gt; bitpos key90 1</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; bitpos key90 0</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è¿™é‡Œçš„startå’Œendä¹ŸæŒ‡çš„æ˜¯å­—èŠ‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; bitpos key90 0 2 10</span><br><span class=\"line\">(integer) 16</span><br><span class=\"line\">127.0.0.1:6379&gt; bitpos key90 1 2 10</span><br><span class=\"line\">(integer) 17</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>BITOP</code></li>\n</ul>\n<p><code>BITOP operation destkey key [key â€¦]</code></p>\n<p>å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªä¿å­˜äºŒè¿›åˆ¶ä½çš„å­—ç¬¦ä¸² key è¿›è¡Œä½å…ƒæ“ä½œï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey ä¸Šã€‚</p>\n<p><code>operation</code>  å¯ä»¥æ˜¯  <code>AND</code>  ã€  <code>OR</code>  ã€  <code>NOT</code>  ã€  <code>XOR</code>  è¿™å››ç§æ“ä½œä¸­çš„ä»»æ„ä¸€ç§ï¼š</p>\n<p><code>BITOP AND destkey key [key ...]</code>  ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª  <code>key</code>  æ±‚é€»è¾‘å¹¶ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°  <code>destkey</code>  ã€‚</p>\n<p><code>BITOP OR destkey key [key ...]</code>  ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª  <code>key</code>  æ±‚é€»è¾‘æˆ–ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°  <code>destkey</code>  ã€‚</p>\n<p><code>BITOP XOR destkey key [key ...]</code>  ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª  <code>key</code>  æ±‚é€»è¾‘å¼‚æˆ–ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°  <code>destkey</code>  ã€‚</p>\n<p><code>BITOP NOT destkey key</code>  ï¼Œå¯¹ç»™å®š  <code>key</code>  æ±‚é€»è¾‘éï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°  <code>destkey</code>  ã€‚</p>\n<p>é™¤äº†  <code>NOT</code>  æ“ä½œä¹‹å¤–ï¼Œå…¶ä»–æ“ä½œéƒ½å¯ä»¥æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ª  <code>key</code>  ä½œä¸ºè¾“å…¥ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬åšä¸€ä¸ªç®€å•ä¾‹å­ã€‚</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; setbit k91_1 <span class=\"number\">0</span> <span class=\"number\">1</span></span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; setbit k91_1 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; setbit k91_1 <span class=\"number\">2</span> <span class=\"number\">1</span></span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; setbit k91_1 <span class=\"number\">3</span> <span class=\"number\">1</span></span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k91_1 <span class=\"comment\"># 1111 (ä½ä½-&gt;é«˜ä½)</span></span><br><span class=\"line\"><span class=\"string\">&quot;\\xf0&quot;</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; setbit k91_2 <span class=\"number\">3</span> <span class=\"number\">1</span></span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; setbit k91_2 <span class=\"number\">4</span> <span class=\"number\">1</span></span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; setbit k91_2 <span class=\"number\">5</span> <span class=\"number\">1</span></span><br><span class=\"line\">(integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k91_2 <span class=\"comment\"># 000111 (ä½ä½-&gt;é«˜ä½)</span></span><br><span class=\"line\"><span class=\"string\">&quot;\\x1c&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## and æ“ä½œ</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitop AND k91_d_1 k91_1 k91_2</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k91_d_1 <span class=\"comment\"># 000100 (ä½ä½-&gt;é«˜ä½)</span></span><br><span class=\"line\"><span class=\"string\">&quot;\\x10&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## OR æ“ä½œ</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitop OR k91_d_2 k91_1 k91_2</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k91_d_2 <span class=\"comment\"># 111111 (ä½ä½-&gt;é«˜ä½)</span></span><br><span class=\"line\"><span class=\"string\">&quot;\\xfc&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## XOR äº¦æˆ–æ“ä½œ</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitop XOR k91_d_3 k91_1 k92_2</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k91_d_3 <span class=\"comment\"># 111011 (ä½ä½-&gt;é«˜ä½)</span></span><br><span class=\"line\"><span class=\"string\">&quot;\\xf0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## NOT æ“ä½œ</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitop NOT k91_d_4 k91_1</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k91_d_4 <span class=\"comment\"># 00001111 (ä½ä½-&gt;é«˜ä½)</span></span><br><span class=\"line\"><span class=\"string\">&quot;\\x0f&quot;</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitop NOT k91_d_5 k91_2</span><br><span class=\"line\">(integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k91_d_5 <span class=\"comment\"># 111011 (ä½ä½-&gt;é«˜ä½)</span></span><br><span class=\"line\"><span class=\"string\">&quot;\\xe3&quot;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>BITFIELD</code></li>\n</ul>\n<p><code>BITFIELD key [GET type offset] [SET type offset value] [INCRBY type offset increment] [OVERFLOW WRAP|SAT|FAIL]</code></p>\n<p><code>BITFIELD</code>  å‘½ä»¤å¯ä»¥å°†ä¸€ä¸ª  <code>Redis</code>  å­—ç¬¦ä¸²çœ‹ä½œæ˜¯ä¸€ä¸ªç”±äºŒè¿›åˆ¶ä½ç»„æˆçš„æ•°ç»„ï¼Œ å¹¶å¯¹è¿™ä¸ªæ•°ç»„ä¸­å‚¨å­˜çš„é•¿åº¦ä¸åŒçš„æ•´æ•°è¿›è¡Œè®¿é—® ï¼ˆè¢«å‚¨å­˜çš„æ•´æ•°æ— éœ€è¿›è¡Œå¯¹é½ï¼‰ã€‚ æ¢å¥è¯è¯´ï¼Œ é€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼Œ ç”¨æˆ·å¯ä»¥æ‰§è¡Œè¯¸å¦‚ â€œå¯¹åç§»é‡  <code>1234</code>  ä¸Šçš„  <code>5</code>  ä½é•¿æœ‰ç¬¦å·æ•´æ•°è¿›è¡Œè®¾ç½®â€ã€ â€œè·å–åç§»é‡  <code>4567</code>  ä¸Šçš„  <code>31</code>  ä½é•¿æ— ç¬¦å·æ•´æ•°â€ ç­‰æ“ä½œã€‚ æ­¤å¤–ï¼Œ  <code>BITFIELD</code>  å‘½ä»¤è¿˜å¯ä»¥å¯¹æŒ‡å®šçš„æ•´æ•°æ‰§è¡ŒåŠ æ³•æ“ä½œå’Œå‡æ³•æ“ä½œï¼Œ å¹¶ä¸”è¿™äº›æ“ä½œå¯ä»¥é€šè¿‡è®¾ç½®å¦¥å–„åœ°å¤„ç†è®¡ç®—æ—¶å‡ºç°çš„æº¢å‡ºæƒ…å†µã€‚<br>\nè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„å‘½ä»¤äº†ã€‚æˆ‘ä»¬ä¾æ¬¡æ¥çœ‹çœ‹ã€‚</p>\n<ul>\n<li><code>GET type offset</code></li>\n</ul>\n<p><code>type</code>  æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ  <code>type</code>  æ˜¯è¿”å›çš„æ•°å€¼ç±»å‹ã€‚å¯é€‰å€¼æœ‰ï¼š <code>i8</code> ï¼ˆæœ‰ç¬¦å· <code>8</code>  ä¸ª <code>bit</code>  ä½ï¼‰, <code>i16</code> ï¼ˆæœ‰ç¬¦å· <code>16</code>  ä¸ª <code>bi</code> t ä½ï¼‰, <code>u8</code> ï¼ˆæ— ç¬¦å· <code>8</code>  ä¸ª <code>bit</code>  ä½ï¼‰, <code>u16</code> ï¼ˆæ— ç¬¦å· <code>16</code>  ä¸ª <code>bit</code>  ä½ï¼‰,â€¦</p>\n<p>è¿™ä¸ªçš„å‘½ä»¤çš„åŠŸèƒ½å°±æ˜¯è¿”å›æ‰§è¡Œçš„äºŒè¿›åˆ¶çš„èŒƒå›´ï¼Œ<b>offset æ˜¯æŒ‡ç¬¬å‡ ä¸ªäºŒè¿›åˆ¶ä½</b>ã€‚<br>\næ³¨æ„ï¼š<br>\n <code>BITFIELD</code>  å‘½ä»¤æœ€å¤§æ”¯æŒ <code>64</code>  ä½é•¿çš„æœ‰ç¬¦å·æ•´æ•°ä»¥åŠ  <code>63</code>  ä½é•¿çš„æ— ç¬¦å·æ•´æ•°ï¼Œ å…¶ä¸­æ— ç¬¦å·æ•´æ•°çš„  <code>63</code>  ä½é•¿åº¦é™åˆ¶æ˜¯ç”±äº  <code>Redis</code>  åè®®ç›®å‰è¿˜æ— æ³•è¿”å›  <code>64</code>  ä½é•¿çš„æ— ç¬¦å·æ•´æ•°è€Œå¯¼è‡´çš„ã€‚</p>\n<p>ç”¨ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; set k92 Redis</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k92 get i8 <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">82</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k92 get u8 <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">82</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k92 get i16 <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">21093</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k92 get u16 <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">21093</span></span><br></pre></td></tr></table></figure>\n<p>ç»“åˆä¸Šé¢çš„é‚£å¼ å›¾ï¼Œæˆ‘ä»¬çœ‹ä¸‹</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/bitmap-Redis%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6.png\" alt=\"Redisçš„bitmapå›¾\"></p>\n<p>æˆ‘ä»¬æ‰‹åŠ¨çš„å°†å‰ <code>8</code>  ä¸ª <code>bit</code>  ä½è£…æ¢æˆ <code>10</code>  è¿›åˆ¶ï¼Œå°±æ˜¯ <code>82</code> ã€‚é«˜ä½ä¸º <code>0</code> ï¼Œæ‰€ä»¥æ­¤æ—¶ï¼Œ <code>u8</code>  å’Œ <code>i8</code>  çš„å€¼æ˜¯ä¸€æ ·çš„ã€‚åŒæ ·çš„  <code>u16</code> , <code>i16</code> , <code>u24</code> , <code>u48</code> , å¤§å®¶å¯ä»¥è‡ªè¡ŒéªŒè¯ä¸€ä¸‹ã€‚</p>\n<ul>\n<li><code>SET type offset value</code></li>\n</ul>\n<p>è¿™ä¸ªå‘½ä»¤æ˜¯å’Œ <code>GET</code>  å‘½ä»¤ç›¸åçš„ä¸€ä¸ªå‘½ä»¤ã€‚</p>\n<p>ç›´æ¥ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; bitfield k93 SET u8 <span class=\"number\">0</span> <span class=\"number\">82</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k93</span><br><span class=\"line\"><span class=\"string\">&quot;R&quot;</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k93 SET u8 <span class=\"number\">8</span> <span class=\"number\">101</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k93</span><br><span class=\"line\"><span class=\"string\">&quot;Re&quot;</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k93 SET u8 <span class=\"number\">16</span> <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k93</span><br><span class=\"line\"><span class=\"string\">&quot;Red&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ... </span></span><br><span class=\"line\"><span class=\"comment\"># å‰©ä¸‹çš„iå’Œsï¼Œå¤§å®¶è‡ªå·±è¯•ä¸€ä¸‹å§</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>INCRBY type offset increment</code></li>\n</ul>\n<p>ä»åˆ¶å®šçš„åç§»ä½å¼€å§‹ï¼Œå¢åŠ  <code>increment</code> ã€‚</p>\n<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>\n<p>æ¥æ¼”ç¤ºä¸€ä¸‹:</p>\n<p>å­—ç¬¦ <code>A</code>  çš„ <code>ASCII</code>  ç æ˜¯ <code>65</code> ï¼Œ <code>R</code>  æ˜¯ <code>82</code> ï¼Œå¦‚æœä» <code>A</code>  å˜æˆ <code>R</code> ï¼Œéœ€è¦å¢åŠ  <code>17</code> ã€‚</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:<span class=\"number\">6379</span>&gt; set k94 A</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k94 INCRBY u8 <span class=\"number\">0</span> <span class=\"number\">17</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">82</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k94</span><br><span class=\"line\"><span class=\"string\">&quot;R&quot;</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k94 INCRBY u8 <span class=\"number\">8</span> <span class=\"number\">101</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">101</span>get</span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; get k94</span><br><span class=\"line\"><span class=\"string\">&quot;Re&quot;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>OVERFLOW WRAP|SAT|FAIL</code></li>\n</ul>\n<p>è¿™æ˜¯ <code>bitmap</code>  å¯¹  <code>INCRBY</code>  å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œå‘ç”Ÿå¼‚å¸¸è¡Œä¸ºçš„æ§åˆ¶ã€‚</p>\n<p>ç”¨æˆ·å¯ä»¥é€šè¿‡  <code>OVERFLOW</code>  å‘½ä»¤ä»¥åŠä»¥ä¸‹å±•ç¤ºçš„ä¸‰ä¸ªå‚æ•°ï¼Œ æŒ‡å®š  <code>BITFIELD</code>  å‘½ä»¤åœ¨æ‰§è¡Œè‡ªå¢æˆ–è€…è‡ªå‡æ“ä½œæ—¶ï¼Œ ç¢°ä¸Šå‘ä¸Šæº¢å‡ºï¼ˆ <code>overflow</code> ï¼‰æˆ–è€…å‘ä¸‹æº¢å‡ºï¼ˆ <code>underflow</code> ï¼‰æƒ…å†µæ—¶çš„è¡Œä¸ºï¼š</p>\n<p><code>WRAP</code>  ï¼š ä½¿ç”¨å›ç»•ï¼ˆ <code>wrap around</code> ï¼‰æ–¹æ³•å¤„ç†æœ‰ç¬¦å·æ•´æ•°å’Œæ— ç¬¦å·æ•´æ•°çš„æº¢å‡ºæƒ…å†µã€‚ å¯¹äºæ— ç¬¦å·æ•´æ•°æ¥è¯´ï¼Œ å›ç»•å°±åƒä½¿ç”¨æ•°å€¼æœ¬èº«ä¸èƒ½å¤Ÿè¢«å‚¨å­˜çš„æœ€å¤§æ— ç¬¦å·æ•´æ•°æ‰§è¡Œå–æ¨¡è®¡ç®—ï¼Œ è¿™ä¹Ÿæ˜¯  <code>C</code>  è¯­è¨€çš„æ ‡å‡†è¡Œä¸ºã€‚ å¯¹äºæœ‰ç¬¦å·æ•´æ•°æ¥è¯´ï¼Œ ä¸Šæº¢å°†å¯¼è‡´æ•°å­—é‡æ–°ä»æœ€å°çš„è´Ÿæ•°å¼€å§‹è®¡ç®—ï¼Œ è€Œä¸‹æº¢å°†å¯¼è‡´æ•°å­—é‡æ–°ä»æœ€å¤§çš„æ­£æ•°å¼€å§‹è®¡ç®—ã€‚ æ¯”å¦‚è¯´ï¼Œ å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå€¼ä¸º  <code>127</code>  çš„  <code>i8</code>  æ•´æ•°æ‰§è¡ŒåŠ ä¸€æ“ä½œï¼Œ é‚£ä¹ˆå°†å¾—åˆ°ç»“æœ  <code>-128</code>  ã€‚</p>\n<p><code>SAT</code>  ï¼š ä½¿ç”¨é¥±å’Œè®¡ç®—ï¼ˆ <code>saturation arithmetic</code> ï¼‰æ–¹æ³•å¤„ç†æº¢å‡ºï¼Œ ä¹Ÿå³æ˜¯è¯´ï¼Œ ä¸‹æº¢è®¡ç®—çš„ç»“æœä¸ºæœ€å°çš„æ•´æ•°å€¼ï¼Œ è€Œä¸Šæº¢è®¡ç®—çš„ç»“æœä¸ºæœ€å¤§çš„æ•´æ•°å€¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå€¼ä¸º  <code>120</code>  çš„  <code>i8</code>  æ•´æ•°æ‰§è¡ŒåŠ   <code>10</code>  è®¡ç®—ï¼Œ é‚£ä¹ˆå‘½ä»¤çš„ç»“æœå°†ä¸º  <code>i8</code>  ç±»å‹æ‰€èƒ½å‚¨å­˜çš„æœ€å¤§æ•´æ•°å€¼  <code>127</code>  ã€‚ ä¸æ­¤ç›¸åï¼Œ å¦‚æœä¸€ä¸ªé’ˆå¯¹  <code>i8</code>  å€¼çš„è®¡ç®—é€ æˆäº†ä¸‹æº¢ï¼Œ é‚£ä¹ˆè¿™ä¸ª i8 å€¼å°†è¢«è®¾ç½®ä¸º  <code>-127</code>  ã€‚</p>\n<p><code>FAIL</code>  ï¼š åœ¨è¿™ä¸€æ¨¡å¼ä¸‹ï¼Œ å‘½ä»¤å°†æ‹’ç»æ‰§è¡Œé‚£äº›ä¼šå¯¼è‡´ä¸Šæº¢æˆ–è€…ä¸‹æº¢æƒ…å†µå‡ºç°çš„è®¡ç®—ï¼Œ å¹¶å‘ç”¨æˆ·è¿”å›ç©ºå€¼è¡¨ç¤ºè®¡ç®—æœªè¢«æ‰§è¡Œã€‚</p>\n<p>æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹è¿™å‡ ç§æƒ…å†µ</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ WRAP æ–¹å¼ï¼Œé‡å¤æ‰§è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œåœ¨ä¸€ä¸ª2bitä¸Šï¼Œä» 0,1,2,3 æ¥å›æŠ˜è¿”ã€‚</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_1 OVERFLOW WRAP incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_1 OVERFLOW WRAP incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_1 OVERFLOW WRAP incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_1 OVERFLOW WRAP incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_1 OVERFLOW WRAP incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_1 OVERFLOW WRAP incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_1 OVERFLOW WRAP incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ SAT æ–¹å¼ï¼Œå½“è¦å‘ç”Ÿæº¢å‡ºçš„æ—¶å€™ï¼Œä¸å†æ‰§è¡Œã€‚</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_2 OVERFLOW SAT incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_2 OVERFLOW SAT incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_2 OVERFLOW SAT incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_2 OVERFLOW SAT incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_2 OVERFLOW SAT incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_2 OVERFLOW SAT incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95_2 OVERFLOW SAT incrby u2 <span class=\"number\">1</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (integer) <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨FAILæ¨¡å¼ï¼Œåˆ™è¿”å›(nil)ï¼Œä¸æ‰§è¡Œä¸”è¿”å›nil</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.0.1:<span class=\"number\">6379</span>&gt; bitfield k95 OVERFLOW FAIL incrby u2 <span class=\"number\">102</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>) (nil)</span><br></pre></td></tr></table></figure>\n<p><code>BITFIELD</code>  å‘½ä»¤çš„ä½œç”¨åœ¨äºå®ƒèƒ½å¤Ÿå°†å¾ˆå¤šå°çš„æ•´æ•°å‚¨å­˜åˆ°ä¸€ä¸ªé•¿åº¦è¾ƒå¤§çš„ä½å›¾ä¸­ï¼Œ åˆæˆ–è€…å°†ä¸€ä¸ªéå¸¸åºå¤§çš„é”®åˆ†å‰²ä¸ºå¤šä¸ªè¾ƒå°çš„é”®æ¥è¿›è¡Œå‚¨å­˜ï¼Œ ä»è€Œéå¸¸é«˜æ•ˆåœ°ä½¿ç”¨å†…å­˜ï¼Œ ä½¿å¾— Redis èƒ½å¤Ÿå¾—åˆ°æ›´å¤šä¸åŒçš„åº”ç”¨ â€”â€” ç‰¹åˆ«æ˜¯åœ¨å®æ—¶åˆ†æé¢†åŸŸï¼š  <code>BITFIELD</code>  èƒ½å¤Ÿä»¥æŒ‡å®šçš„æ–¹å¼å¯¹è®¡ç®—æº¢å‡ºè¿›è¡Œæ§åˆ¶çš„èƒ½åŠ›ï¼Œ ä½¿å¾—å®ƒå¯ä»¥è¢«åº”ç”¨äºè¿™ä¸€é¢†åŸŸã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯ <code>Redis</code>  ä¸­ <code>bitmap</code>  ç›¸å…³çš„å‘½ä»¤äº†ã€‚ä¸‹é¢æˆ‘ç®€å•çš„æ¥çœ‹ä¸‹ bitmap è¿™ç§ <code>&quot;æ•°æ®ç»“æ„&quot;</code>  æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>\n<p>æ³¨æ„ï¼Œè¿™é‡Œçš„æ•°æ®ç»“æ„æˆ‘è¿˜æ˜¯åŠ ä¸Šäº†å¼•å·ã€‚å…·ä½“ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<h3 id=\"bitmap-çš„å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#bitmap-çš„å®ç°\">#</a>  <code>bitmap</code>  çš„å®ç°</h3>\n<p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥å»çœ‹çœ‹æºç ä¸­æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ç›´æ¥æœæ–‡ä»¶  <code>bit</code></p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/bitmap-%E6%9F%A5%E6%89%BE%E7%9B%AE%E5%BD%95.png\" alt=\"bitmap-æŸ¥æ‰¾ç›®å½•\"></p>\n<p>æˆ‘ä»¬è¦çœ‹ <code>src</code>  ç›®å½•ä¸‹çš„ï¼Œæ‰€ä»¥ï¼Œç›´æ¥çœ‹ <code>bitops.c</code></p>\n<p>è¿™é‡Œæˆ‘ä»¬å°±æ˜¯ä»¥ä¸€ä¸ªå‘½ä»¤ <code>setbit</code>  ä¸ºä¾‹ç®€å•çš„æ¥çœ‹çœ‹ <code>bitmap</code>  çš„è¿è¡Œè¿‡ç¨‹ã€‚</p>\n<figure class=\"highlight c\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * SETBIT å‘½ä»¤çš„å®ç°</span></span><br><span class=\"line\"><span class=\"comment\"> * @param c å®¢æˆ·ç«¯å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setbitCommand</span><span class=\"params\">(client *c)</span> </span>&#123;</span><br><span class=\"line\">    robj *o; <span class=\"comment\">///  setbit key offset value ä¸­çš„ keyå¯¹åº”çš„Redis Objectã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *err = <span class=\"string\">&quot;bit is not an integer or out of range&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> bitoffset; <span class=\"comment\">/// æŒ‡å®šè¦ä¿®æ”¹çš„ä½çš„åç§»é‡</span></span><br><span class=\"line\">    <span class=\"keyword\">ssize_t</span> byte, bit;  <span class=\"comment\">/// byte: è¦ä¿®æ”¹çš„ä½ æ‰€å çš„å­—èŠ‚ã€‚ç¬¬byteä¸ªå­—èŠ‚ä¸Šã€‚ bitï¼Œåœ¨æ‰€å å­—èŠ‚ä¸­çš„ç¬¬bitä½ä¸Šã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> byteval, bitval; <span class=\"comment\">/// byteval: è¦ä¿®æ”¹çš„ä½æ‰€å çš„å­—èŠ‚çš„å€¼ã€‚åè¿›åˆ¶æ•°ã€‚  bitVal æ˜¯åŸæ¥çš„æŒ‡å®šbitä¸Šçš„å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">long</span> on; <span class=\"comment\">/// ä¿®æ”¹çš„å€¼ã€‚å°±æ˜¯ setbit key offset value ä¸­çš„valueã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// è§£æ offset å‚æ•°ï¼Œæ˜¯å¦ç¬¦åˆè§„èŒƒ(æ˜¯å¦ä½è´Ÿæ•°ï¼Œæ˜¯å¦è¶…è¿‡512M)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (getBitOffsetFromArgument(c, c-&gt;argv[<span class=\"number\">2</span>], &amp;bitoffset, <span class=\"number\">0</span>, <span class=\"number\">0</span>) != C_OK)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"comment\">/// è§£æ value å‚æ•° =&gt; èµ‹å€¼ç»™onå˜é‡</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (getLongFromObjectOrReply(c, c-&gt;argv[<span class=\"number\">3</span>], &amp;on, err) != C_OK)</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// éªŒè¯on(value)åªèƒ½æ˜¯0æˆ–è€…1</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (on &amp; ~<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        addReplyError(c, err);</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/// è¿”å›keyå¯¹åº”çš„å¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"comment\">/// è¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªOBJ_STRINGç±»å‹</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((o = lookupStringForBitCommand(c, bitoffset)) == <span class=\"literal\">NULL</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// è·å–å½“å‰ä½ç½®ä¸Šçš„å€¼</span></span><br><span class=\"line\">    byte = bitoffset &gt;&gt; <span class=\"number\">3</span>; <span class=\"comment\">/// è®¡ç®—å‡ºå­—èŠ‚ï¼Œç¡®å®šoffsetæ‰€åœ¨çš„å­—èŠ‚ã€‚</span></span><br><span class=\"line\">    byteval = ((<span class=\"keyword\">uint8_t</span> *) o-&gt;ptr)[byte]; <span class=\"comment\">/// å°†æŒ‡å®šå­—èŠ‚ä¸Šçš„æ•°è½¬æ¢æˆæ— ç¬¦å·æ•´å‹æ•°ã€‚</span></span><br><span class=\"line\">    bit = <span class=\"number\">7</span> - (bitoffset &amp; <span class=\"number\">0x7</span>); <span class=\"comment\">/// è®¡ç®—è¦ä¿®æ”¹çš„ä½ï¼Œæ˜¯å½“å‰å­—èŠ‚ä¸­çš„ç¬¬å‡ ä½ã€‚</span></span><br><span class=\"line\">    bitval = byteval &amp; (<span class=\"number\">1</span> &lt;&lt; bit); <span class=\"comment\">/// è®¡ç®—å‡ºä¿®æ”¹åçš„å€¼ã€‚(bitValæ˜¯ä¿®æ”¹åçš„æ•´ä¸ªå­—èŠ‚ä¸Šå€¼)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* Update byte with new bit value and return original value */</span></span><br><span class=\"line\">    <span class=\"comment\">/// æ›´æ–° String çš„å€¼ä¸º bitValï¼Œå¹¶ä¸”è¿”å›åŸæ¥çš„å€¼ã€‚</span></span><br><span class=\"line\">    byteval &amp;= ~(<span class=\"number\">1</span> &lt;&lt; bit); <span class=\"comment\">/// å°†å­—èŠ‚ä¸ŠåŸæ¥çš„å€¼ï¼ŒæŒ‡å®šä½ä¸Šç½®ä¸º0.(å³è¦èµ‹å€¼çš„ä½ï¼Œbitä¸ºå½“å‰å­—èŠ‚ä¸­çš„ä½ã€‚)</span></span><br><span class=\"line\">    byteval |= ((on &amp; <span class=\"number\">0x1</span>) &lt;&lt; bit); <span class=\"comment\">/// å°†onçš„å€¼å¤åˆ¶ç»™byteVal,å–æˆ–è¿ç®—ï¼Œå¦‚æœonä¸º1ï¼Œåˆ™1ï¼Œè‹¥onä¸º0ï¼Œåˆ™0ï¼Œä¸Šä¸€è¡Œä»£ç å·²ç»å°†æŒ‡å®šä½ç½®ç½®ä¸ºäº†0.</span></span><br><span class=\"line\">    ((<span class=\"keyword\">uint8_t</span> *) o-&gt;ptr)[byte] = byteval; <span class=\"comment\">/// ä¿®æ”¹å¯¹è±¡ä¸­æŒ‡å®šå­—èŠ‚çš„å€¼ã€‚</span></span><br><span class=\"line\">    signalModifiedKey(c-&gt;db, c-&gt;argv[<span class=\"number\">1</span>]); <span class=\"comment\">/// é€šçŸ¥ä¿®æ”¹äº†keyã€‚</span></span><br><span class=\"line\">    notifyKeyspaceEvent(NOTIFY_STRING, <span class=\"string\">&quot;setbit&quot;</span>, c-&gt;argv[<span class=\"number\">1</span>], c-&gt;db-&gt;id);</span><br><span class=\"line\">    server.dirty++; <span class=\"comment\">// ä»ä¸Šæ¬¡ä¿å­˜åˆ°æ•°æ®åº“çš„æ›´æ”¹æ¬¡æ•°</span></span><br><span class=\"line\">    addReply(c, bitval ? shared.cone : shared.czero); <span class=\"comment\">/// è¿”å›åŸæ¥çš„å€¼</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢ä»£ç å°±æ˜¯  <code>setBit</code>  å‘½ä»¤çš„å®ç°è¿‡ç¨‹äº†ï¼Œè¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä¸åšç ”ç©¶<b>æˆ‘ä»¬åªçœ‹ç¬¬ <code>27</code>  è¡Œ</b>. è¿™ä¸€è¡Œä¸­æœ‰ä¸€ä¸ª  <code>lookupStringForBitCommand</code>  æ–¹æ³•ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬çŒœæµ‹ä¸€ä¸‹ï¼Œ<b> <code>bitmap</code>  å…¶å®å°±æ˜¯ä¸€ä¸ª  <code>OBJ_STRING</code>  ç±»å‹çš„ç»“æ„</b>ã€‚</p>\n<p>åˆ°åº•æ˜¯ä¸æ˜¯å‘¢ï¼Ÿ</p>\n<p>çœ‹ä¸€ä¸‹æºç ã€‚</p>\n<figure class=\"highlight c\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * è¿™æ˜¯ç”¨äºéœ€è¦å°†ä½å†™å…¥å­—ç¬¦ä¸²å¯¹è±¡çš„å‘½ä»¤å®ç°çš„è¾…åŠ©å‡½æ•°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦åˆ™ï¼Œå¦‚æœå¯†é’¥æŒæœ‰é”™è¯¯çš„ç±»å‹ï¼Œåˆ™è¿”å›NULLï¼Œå¹¶ä¸”*å‘å®¢æˆ·ç«¯å‘é€é”™è¯¯ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * è¯¥å‘½ä»¤åˆ›å»ºæˆ–å¡«å……å­—ç¬¦ä¸²é›¶ï¼Œä»¥ä¾¿å¯ä»¥å¯»å€â€œ maxbitâ€ä½ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * è¯¥å¯¹è±¡æœ€ç»ˆè¿”å›ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦åˆ™ï¼Œå¦‚æœå¯†é’¥æŒæœ‰é”™è¯¯çš„ç±»å‹ï¼Œåˆ™è¿”å›NULLå¹¶å°†é”™è¯¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\">robj *<span class=\"title\">lookupStringForBitCommand</span><span class=\"params\">(client *c, <span class=\"keyword\">size_t</span> maxbit)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> byte = maxbit &gt;&gt; <span class=\"number\">3</span>; <span class=\"comment\">// è®¡ç®—å­—èŠ‚</span></span><br><span class=\"line\">    <span class=\"comment\">/// ä¸ºå†™æ“ä½œæ‰¾å‡ºä¸€ä¸ªkeyã€‚ ã€setbit key offset valueã€‘ä¸­argv[1] å³ä¸ºkey</span></span><br><span class=\"line\">    robj *o = lookupKeyWrite(c-&gt;db, c-&gt;argv[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// æ˜¯å¦æ‰¾åˆ°äº†key</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">/// æ²¡æœ‰æ‰¾åˆ°ã€‚ åˆ›å»ºä¸€ä¸ªå¯¹è±¡å†™å…¥ã€‚å¯¹è±¡ä¸ºOBJ_STRINGç±»å‹ã€‚</span></span><br><span class=\"line\">        o = createObject(OBJ_STRING, sdsnewlen(<span class=\"literal\">NULL</span>, byte + <span class=\"number\">1</span>));</span><br><span class=\"line\">        dbAdd(c-&gt;db, c-&gt;argv[<span class=\"number\">1</span>], o);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/// æ‰¾åˆ°äº†keyå¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯ OBJ_STRING ç±»å‹ç›´æ¥è¿”å›ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (checkType(c, o, OBJ_STRING)) <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"comment\">/// è·å–è¦ä¿®æ”¹çš„å¯¹è±¡ã€‚ä¸Šä¸€è¡Œä»£ç å·²ç»è¿›è¡Œäº†åˆ¤æ–­ï¼Œç¡®å®šå…¶ä¸º OBJ_STRING ç±»å‹ã€‚</span></span><br><span class=\"line\">        o = dbUnshareStringValue(c-&gt;db, c-&gt;argv[<span class=\"number\">1</span>], o);</span><br><span class=\"line\">        <span class=\"comment\">/// å¢åŠ  STRINGç±»å‹çš„é•¿åº¦</span></span><br><span class=\"line\">        o-&gt;ptr = sdsgrowzero(o-&gt;ptr, byte + <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨ç¬¬ <code>17</code>  è¡Œå’Œç¬¬ <code>23</code>  è¡Œã€‚å°±å¾ˆæ¸…æ¥šäº†ã€‚</p>\n<p>æ‰€ä»¥ï¼Œåœ¨æ–‡ç« ä¸€å¼€å§‹åŠ ä¸Šå¼•å·çš„ æ•°æ®ç»“æ„ ï¼Œè°œé¢˜å°±è§£å¼€äº†ã€‚</p>\n<p><b> <code>bitmap</code>  å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ï¼Œæœ¬è´¨ä¸Šæ˜¯ç”¨  <code>STRING</code>  è¿™ä¸ªæ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚</b></p>\n<p>å¦‚æœä½ æƒ³çœ‹ <code>bitmap</code>  çš„å…¨éƒ¨æºç ï¼Œé‚£ä¹ˆæ»¡è¶³ä½ ï¼ï¼ğŸ‘‰ğŸ‘‰ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvcmVkaXMuZ2l0\">ç‚¹å‡»è¿™é‡Œ</span>ğŸ‘ˆğŸ‘ˆ</p>\n<p><b>å…¬ä¼—å·é‡Œå›å¤  <code>redisæºç </code> ï¼Œå³å¯è·å–å®Œæ•´è·¯å¾„å“¦</b></p>\n<p>è™½ç„¶ redis æºç ä¸æ˜¯æˆ‘å†™çš„ï¼Œä½†æ˜¯æˆ‘çœ‹è¿‡çš„éƒ½åŠ ä¸Šæ³¨é‡Šå•¦ï½</p>\n<p>é™¤æ­¤ä¹‹å¤–ï¼Œå°ç™½è¿˜è‡ªå·±å®ç°äº†ä¸€ä¸ª  <code>bitmap</code> ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿  <code>star</code> .ğŸ‘‰ğŸ‘‰ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZhbmdqaWF4aWFvYmFpL2NvZGVfcmVwby9ibG9iL21hc3Rlci8wMV9kYXRhX3N0cnVjdHVyZXMvYml0bWFwL2JpdG1hcC9CaXRNYXAuamF2YQ==\">bitMap æºç ï¼Œç‚¹å‡»è¿™é‡Œ</span> ğŸ‘ˆğŸ‘ˆ</p>\n<p><b>å…¬ä¼—å·é‡Œå›å¤  <code>bitmap</code> , å³å¯è·å–å®Œæ•´è·¯å¾„å“¦</b></p>\n<p>å½“ç„¶: JDK ä¹Ÿæä¾›äº†ä¸€ä¸ª <code>BitMap</code>  çš„å®ç°ï¼Œå« <code>BitSet</code> ï¼Œä½äº <code>java.util</code>  åŒ…ä¸‹ã€‚å…¶åº•å±‚ä½¿ç”¨çš„æ˜¯ä¸€ä¸ª <code>long</code>  ç±»å‹çš„æ•°ç»„ï¼Œä¸€ä¸ª <code>long</code>  ä»£è¡¨ä¸€ä¸ª <code>word</code> ã€‚ä½† <code>BitSet</code>  æ²¡æœ‰è§£å†³ä¸Šé¢æåˆ°çš„è¾“å…¥ç¨€ç–çš„é—®é¢˜ã€‚è°·æ­Œå¼€æºçš„ <code>EWAHCompressedBitMap</code>  è§£å†³äº†è¾“å…¥ç¨€ç–çš„é—®é¢˜ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ã€‚</p>\n<table>\n<thead>\n<tr>\n<th><code>Redis</code>  çš„æ•°æ®ç±»å‹</th>\n<th style=\"text-align:center\">åº•å±‚å®ç°ç»“æ„</th>\n<th style=\"text-align:center\">æ–‡ç« å‚è€ƒ</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>STRING</code></td>\n<td style=\"text-align:center\"><code>sds</code></td>\n<td style=\"text-align:center\"><a href=\"https://mp.weixin.qq.com/s/0sGGSYe5zYNiLUrK5XTsWQ\">æ•°æ®ç±»å‹ä¹‹ <code>String</code> </a></td>\n</tr>\n<tr>\n<td><code>list</code></td>\n<td style=\"text-align:center\"><code>quicklist</code> ,  <code>ziplist</code></td>\n<td style=\"text-align:center\"><a href=\"https://mp.weixin.qq.com/s/n9fzELpKXR1d02yn0usyvg\">æ•°æ®ç±»å‹ä¹‹ <code>list</code> </a></td>\n</tr>\n<tr>\n<td><code>hash</code></td>\n<td style=\"text-align:center\"><code>ziplist</code> ,  <code>dict</code></td>\n<td style=\"text-align:center\"><a href=\"https://mp.weixin.qq.com/s/bQ-jnUuHKLC8-M4G8HpZ9w\">æ•°æ®ç±»å‹ä¹‹ <code>hash</code> </a></td>\n</tr>\n<tr>\n<td><code>set</code></td>\n<td style=\"text-align:center\"><code>dict</code>  , <code>intset</code></td>\n<td style=\"text-align:center\"><a href=\"https://mp.weixin.qq.com/s/qK-CujsG43kAjGpgXYhQWg\">æ•°æ®ç±»å‹ä¹‹ <code>set</code> </a></td>\n</tr>\n<tr>\n<td><code>zset</code></td>\n<td style=\"text-align:center\"><code>dict</code> ,  <code>skipList</code></td>\n<td style=\"text-align:center\"><a href=\"https://mp.weixin.qq.com/s/4fyT9XCLv2MYCtB1WH0Jvg\">æ•°æ®ç±»å‹ä¹‹ <code>zset</code> </a></td>\n</tr>\n<tr>\n<td><code>bitmap</code></td>\n<td style=\"text-align:center\"><code>sds</code></td>\n<td style=\"text-align:center\"><a href=\"#\">æ•°æ®ç±»å‹ä¹‹ <code>bitmap</code> </a></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>å¸Œæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/qrcode.jpg\" alt=\"å¾®ä¿¡äºŒç»´ç \"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-5-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-5-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹æœ‰åºé›†åˆ zset",
            "date_published": "2021-08-01T10:38:55.000Z",
            "content_html": "<h2 id=\"ä¹¦æ¥ä¸Šå›\"><a class=\"markdownIt-Anchor\" href=\"#ä¹¦æ¥ä¸Šå›\">#</a> ä¹¦æ¥ä¸Šå›</h2>\n<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ çš„  <code>set</code>  é›†åˆè¿™ä¸€æ•°æ®ç±»å‹ã€‚å…¶å†…éƒ¨æ˜¯ç”± <code>inset</code>  å’Œ <code>hashtable</code>  è¿™ç§ä¸¤ç§æ•°æ®ç»“æ„ç¼–ç çš„ã€‚<br>\nå¦‚æœä¸è®°å¾—äº†ï¼Œé‚£å°±æ¥åç©¿æ¢­æœºå›å»çœ‹çœ‹å§ã€‚ <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-4-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%9B%86%E5%90%88set/\">å¼€å§‹ç©¿æ¢­</a></p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸€ä¸ªæ–°çš„æ•°æ®ç±»å‹ï¼Œæœ‰åºé›†åˆ.  <code>zset</code> .</p>\n<h2 id=\"zsetç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#zsetç®€ä»‹\">#</a>  <code>zset</code>  ç®€ä»‹</h2>\n<p><code>zset</code>  , ä¸­æ–‡åå­—å« æœ‰åºé›†åˆã€‚åºè¿™ä¸ªå­—ï¼Œåœ¨ <code>Redis</code>  çš„å®ç°æ˜¯  <code>score</code>  å­—æ®µã€‚æˆ‘ä»¬å…ˆä¸æ€¥è¿™ä¸ªå­—æ®µï¼Œåé¢ä¼šä»‹ç»ã€‚</p>\n<p>åœ¨ <code>Redis</code>  ä¸­æœ‰åºçš„æ•°æ®ç±»å‹ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬å‰é¢å­¦ä¹ çš„  <code>list</code>  äº†ã€‚ å®ƒä»¬è¿˜éƒ½å¯ä»¥è·å¾—æŸä¸€å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚</p>\n<p>è€Œ  <code>zset</code>  çš„ä¼˜ç‚¹æ˜¯ï¼š  <code>list</code>  é€šè¿‡é“¾è¡¨å®ç°ï¼Œåœ¨ä¸¤ç«¯æ“ä½œæ•°æ®éƒ½å¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯æ“ä½œä¸­é—´çš„æ•°æ®å°±æ¯”è¾ƒæ…¢äº†ã€‚  <code>zset</code>  æ˜¯ç”¨  <code>hashtable</code>  å’Œ  <code>skiplist</code>  æ¥å®ç°çš„ã€‚å³ä½¿æ˜¯æ“ä½œä¸­é—´æ•°æ®ï¼Œé€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚æ—¶é—´å¤æ‚åº¦ä¸º:  <code>O(logN)</code></p>\n<p><code>zset</code>  çš„ç¼ºç‚¹å°±æ˜¯ï¼šå°±æ˜¯æ¯”è¾ƒè€—è´¹å†…å­˜ã€‚</p>\n<h2 id=\"zsetç±»å‹çš„åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#zsetç±»å‹çš„åº”ç”¨åœºæ™¯\">#</a>  <code>zset</code>  ç±»å‹çš„åº”ç”¨åœºæ™¯</h2>\n<ul>\n<li>å­˜å‚¨å­¦ç”Ÿæˆç»©å¿«é€Ÿåšæˆç»©æ’ååŠŸèƒ½ã€‚</li>\n<li>æ’è¡Œæ¦œï¼Œæ¯”å¦‚ï¼šåˆ—å‡ºæŸç”¨æˆ·å½“å‰çš„å…¨çƒæ’åï¼Œæ¯”èµ›ä¸­èƒœåœºæ•°æ’åã€‚</li>\n<li>å¸¦æƒé‡çš„æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½</li>\n</ul>\n<h2 id=\"zsetçš„åŸºæœ¬å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#zsetçš„åŸºæœ¬å‘½ä»¤\">#</a>  <code>zset</code>  çš„åŸºæœ¬å‘½ä»¤</h2>\n<h3 id=\"zadd\"><a class=\"markdownIt-Anchor\" href=\"#zadd\">#</a>  <code>zadd</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZADD key [NX|XX] [CH] [INCR] score member [score member ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å°† <code>member</code>  æ·»åŠ æœ‰åºé›†åˆä¸­.</p>\n<p>å¦‚æœ <code>member</code>  å­˜åœ¨ï¼Œä¼šæ›´æ–° <code>member</code>  çš„ <code>score</code>  å€¼ã€‚</p>\n<ul>\n<li>\n<p><code>NX</code>  è¡¨ç¤ºå­˜åœ¨ç›¸åŒçš„ <code>member</code>  å°±ä¼šè®¾ç½®å¤±è´¥ï¼ŒNX çš„ä½œç”¨å°±æ˜¯ æ–°å¢ <code>member</code> ï¼Œä¸ä¼šä¿®æ”¹ <code>Member</code></p>\n</li>\n<li>\n<p><code>XX</code>  è¡¨ç¤ºä¸å­˜åœ¨ç›¸åŒçš„ <code>member</code>  å°±ä¼šè®¾ç½®å¤±è´¥ã€‚æ‰€ä»¥:  <code>XX</code>  æ€»æ˜¯æ›´æ–°å…ƒç´ ã€‚ä¸ä¼šæ–°å¢å…ƒç´ </p>\n</li>\n<li>\n<p><code>CH</code> ( <code>change</code> ): è¿”å›ä¿®æ”¹çš„å…ƒç´ ä¸ªæ•°ã€‚æ›´æ”¹çš„å…ƒç´ æ˜¯æ·»åŠ çš„æ–°å…ƒç´ ä»¥åŠå·²ä¸ºå…¶æ›´æ–°åˆ†æ•°çš„ç°æœ‰å…ƒç´ ã€‚å› æ­¤ï¼Œå‘½ä»¤è¡Œä¸­æŒ‡å®šçš„å…·æœ‰ä¸è¿‡å»ç›¸åŒåˆ†æ•°çš„å…ƒç´ å°†ä¸è®¡ç®—åœ¨å†…ã€‚æ³¨æ„ï¼šé€šå¸¸ï¼Œ <code>ZADD</code>  çš„è¿”å›å€¼ä»…è®¡ç®—æ·»åŠ çš„æ–°å…ƒç´ çš„æ•°é‡ã€‚</p>\n</li>\n<li>\n<p><code>INCR</code> : æŒ‡å®šæ­¤é€‰é¡¹åï¼Œ <code>ZADD</code>  çš„è¡Œä¸ºç±»ä¼¼äº<a href=\"#ZINCRBY\"> <code>ZINCRBY</code> </a>ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹åªèƒ½æŒ‡å®šä¸€å¯¹å¾—åˆ†å…ƒç´ ã€‚</p>\n</li>\n<li>\n<p>æ¼”ç¤º</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># è®¾ç½®ä¸€ä¸ªå…ƒç´ </span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 1 m1</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># è®¾ç½®å¤šä¸ªå…ƒç´ </span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 2 m2 3 m3 4 m4 5 m5</span><br><span class=\"line\">(integer) 4</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æ¼”ç¤º NX è¯­ä¹‰,åªèƒ½æ–°å¢.</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 NX 5 m5</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 NX 6 m6</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 NX 6 m6</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æ¼”ç¤º XX è¯­è¨€,åªèƒ½ä¿®æ”¹</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 XX 7 m7</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 7 m7</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># è¿›è¡Œä¿®æ”¹ï¼Œæ³¨æ„è¿”å›å€¼. å¦‚æœè¦è¿”å›ä¸ªæ•°ï¼Œåˆ™åŠ  CH</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 XX 7 m7</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 XX 77 m7</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æ¼”ç¤ºCH, è¿”å›ä¿®æ”¹çš„ä¸ªæ•°</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 CH 8 m8 9 m9 10 m10</span><br><span class=\"line\">(integer) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 CH 8 m8 999 m9 10 m10</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æ¼”ç¤ºINCR, å¢é•¿</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 11 m11</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æ­¤æ—¶ score è¡¨ç¤ºçš„æ˜¯æ­¥é•¿</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k67 INCR 10 m11</span><br><span class=\"line\">&quot;21&quot;</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># æŸ¥çœ‹è®¾ç½®çš„å€¼ã€‚</span></span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k67 0 -1 WITHSCORES</span><br><span class=\"line\"> 1) &quot;m1&quot;</span><br><span class=\"line\"> 2) &quot;1&quot;</span><br><span class=\"line\"> 3) &quot;m2&quot;</span><br><span class=\"line\"> 4) &quot;2&quot;</span><br><span class=\"line\"> 5) &quot;m3&quot;</span><br><span class=\"line\"> 6) &quot;3&quot;</span><br><span class=\"line\"> 7) &quot;m4&quot;</span><br><span class=\"line\"> 8) &quot;4&quot;</span><br><span class=\"line\"> 9) &quot;m5&quot;</span><br><span class=\"line\">10) &quot;5&quot;</span><br><span class=\"line\">11) &quot;m6&quot;</span><br><span class=\"line\">12) &quot;6&quot;</span><br><span class=\"line\">13) &quot;m8&quot;</span><br><span class=\"line\">14) &quot;8&quot;</span><br><span class=\"line\">15) &quot;m10&quot;</span><br><span class=\"line\">16) &quot;10&quot;</span><br><span class=\"line\">17) &quot;m11&quot;</span><br><span class=\"line\">18) &quot;21&quot;</span><br><span class=\"line\">19) &quot;m7&quot;</span><br><span class=\"line\">20) &quot;77&quot;</span><br><span class=\"line\">21) &quot;m9&quot;</span><br><span class=\"line\">22) &quot;999&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"zscore\"><a class=\"markdownIt-Anchor\" href=\"#zscore\">#</a>  <code>zscore</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZSCORE key member</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>zset score</code></p>\n<p>æŸ¥çœ‹å¯¹åº”å…ƒç´ çš„ <code>score</code>  å€¼</p>\n<pre><code>* å½“`key`ä¸å­˜åœ¨æˆ–è€…`member`ä¸å­˜åœ¨çš„æ—¶å€™,è¿”å›`(nil)`\n</code></pre>\n<p>è¿”å› <code>score</code>  çš„å€¼ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># éªŒè¯k68ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›nil</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZSCORE k68 m1</span><br><span class=\"line\">(nil)</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k68 1 m1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å…ƒç´ çš„scoreå€¼</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZSCORE k68 m1</span><br><span class=\"line\"><span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># éªŒè¯ member ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZSCORE k68 m2</span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n<h3 id=\"zincrby\"><a class=\"markdownIt-Anchor\" href=\"#zincrby\">#</a>  <code>zincrby</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZINCRBY key increment member</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>zset increment by</code> <br>\n*  <code>increment</code> : æ­¥é•¿ã€‚<br>\n*  <code>member</code> : æŒ‡å®šçš„æˆå‘˜</p>\n<p>ä¸ºæœ‰åºé›†åˆ <code>key</code>  çš„æˆå‘˜ <code>member</code>  çš„ <code>score</code>  å€¼åŠ ä¸Š  <code>increment</code> ã€‚</p>\n<p>å¦‚æœ <code>key</code>  æˆ–è€… <code>member</code>  ä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢ä¸€ä¸ªå…ƒç´ ã€‚ç›¸å½“äº  <code>zadd</code> .</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ’å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„keyã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZINCRBY k69 10 m1</span><br><span class=\"line\"><span class=\"string\">&quot;10&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k69 0 -1 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;10&quot;</span></span><br><span class=\"line\"><span class=\"comment\">#ç´¯åŠ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZINCRBY k69 10 m1</span><br><span class=\"line\"><span class=\"string\">&quot;20&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k69 0 -1 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;20&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ç´¯åŠ ä¸€ä¸ªè´Ÿæ•°</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZINCRBY k69 -30 m1</span><br><span class=\"line\"><span class=\"string\">&quot;-10&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k69 0 -1 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;-10&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zcard\"><a class=\"markdownIt-Anchor\" href=\"#zcard\">#</a>  <code>zcard</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZCARD key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å› æœ‰åºé›†åˆçš„ <code>key</code>  ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚å³ <code>member</code>  çš„ä¸ªæ•°ã€‚<br>\nä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å› <code>0</code> .</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è¿”å›memberçš„ä¸ªæ•°</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k70 1 m1 2 m2 3 m3</span><br><span class=\"line\">(integer) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZCARD k70</span><br><span class=\"line\">(integer) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k70 4 m4 5 m5</span><br><span class=\"line\">(integer) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; ZCARD k70</span><br><span class=\"line\">(integer) 5</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›0</span></span><br><span class=\"line\">127.0.0.1:6379&gt; EXISTS k70_1</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; ZCARD k70_1</span><br><span class=\"line\">(integer) 0</span><br></pre></td></tr></table></figure>\n<h3 id=\"zcount\"><a class=\"markdownIt-Anchor\" href=\"#zcount\">#</a>  <code>zcount</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZCOUNT key min max</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›  <code>score</code>  å€¼åœ¨ <code>min</code>  å’Œ  <code>max</code>  ä¹‹é—´çš„å…ƒç´ çš„ä¸ªæ•°ã€‚åŒ…æ‹¬ç­‰äº  <code>min</code>  å’Œ  <code>max</code></p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k71 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; ZCOUNT k71 2 5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\"><span class=\"comment\">#ä¸å­˜åœ¨çš„keyæˆ–è€…ä¸åœ¨åŒºé—´å†…æ—¶ï¼Œè¿”å›0</span></span><br><span class=\"line\">127.0.0.1:6379&gt; zcount k71_1 0 10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; zcount k71 11 12</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; zcount k71 12 11</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h3 id=\"zrange\"><a class=\"markdownIt-Anchor\" href=\"#zrange\">#</a>  <code>zrange</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZRANGE key start stop [WITHSCORES]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿™ä¸ªå‘½ä»¤æˆ‘ä»¬å·²ç»ç”¨è¿‡ï¼Œå°±æ˜¯è¿”å›æŒ‡å®šå¼€å§‹ç»“æŸä½ç½®ä¸Šçš„å…ƒç´ ã€‚ä»  <code>0</code>  å¼€å§‹ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k72 1 3</span><br><span class=\"line\">1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k72 1 3 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;4&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zrevrange\"><a class=\"markdownIt-Anchor\" href=\"#zrevrange\">#</a>  <code>zrevrange</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZREVRANGE key start stop [WITHSCORES]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´çš„æˆå‘˜ã€‚<br>\nå…¶ä¸­æˆå‘˜çš„ä½ç½®æŒ‰  <code>score</code>  å€¼é€’å‡ (ä»å¤§åˆ°å°) æ¥æ’åˆ—ã€‚ å…·æœ‰ç›¸åŒ  <code>score</code>  å€¼çš„æˆå‘˜æŒ‰å­—å…¸åºçš„é€†åº ( <code>reverse lexicographical order</code> ) æ’åˆ—ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k73 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ zrange æ­£åºè¿”å›æ•°æ®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k73 0 3 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\">7) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">8) <span class=\"string\">&quot;4&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ zrevrange å€’åºè¿”å›æ•°æ®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZREVRANGE k73 0 3 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m10\\x11&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;10&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;9&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;8&quot;</span></span><br><span class=\"line\">7) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">8) <span class=\"string\">&quot;7&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zrangebyscore\"><a class=\"markdownIt-Anchor\" href=\"#zrangebyscore\">#</a>  <code>zrangebyscore</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>zset range by score</code></p>\n<p>ç±»ä¼¼  <code>zrange</code> , ä¸è¿‡æ˜¯æŒ‰ç…§  <code>score</code>  çš„å€¼è¿›è¡Œæ’åºçš„ã€‚</p>\n<p><code>[LIMIT offset count]</code> , æ˜¯ä» offset å¼€å§‹ï¼Œè¿”å› <code>count</code>  ä¸ªã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è¿”å› scoreå€¼åœ¨ [9,10]ä¹‹é—´çš„memberã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k74 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGEBYSCORE k74 9 10 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;9&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m10\\x11&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;10&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä»ç¬¬2ä¸ª(åŒºé—´å†…ç´¢å¼•ä¸º1)å¼€å§‹ï¼Œè¿”å›1ä¸ªå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGEBYSCORE k74 9 10 WITHSCORES LIMIT 1 1</span><br><span class=\"line\">1) <span class=\"string\">&quot;m10\\x11&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zrevrangebyscore\"><a class=\"markdownIt-Anchor\" href=\"#zrevrangebyscore\">#</a>  <code>zrevrangebyscore</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›æœ‰åºé›†  <code>key</code>  ä¸­ï¼Œ  <code>score</code>  å€¼ä»‹äº  <code>max</code>  å’Œ  <code>min</code>  ä¹‹é—´ (é»˜è®¤åŒ…æ‹¬ç­‰äº  <code>max</code>  æˆ–  <code>min</code>  ) çš„æ‰€æœ‰çš„æˆå‘˜ã€‚æœ‰åºé›†æˆå‘˜æŒ‰  <code>score</code>  å€¼é€’å‡ (ä»å¤§åˆ°å°) çš„æ¬¡åºæ’åˆ—ã€‚</p>\n<p>æ³¨æ„å„ä¸ªå‚æ•°çš„ä½ç½®å“¦ã€‚è¿™é‡Œå’Œ  <code>zrevrange</code>  çš„å‚æ•°ä¸ä¸€æ ·ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k75 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; ZREVRANGEBYSCORE k75 8 6 WITHSCORES </span><br><span class=\"line\">1) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;8&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;7&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZREVRANGEBYSCORE k75 8 6 WITHSCORES  LIMIT 1  1</span><br><span class=\"line\">1) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;7&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zrank\"><a class=\"markdownIt-Anchor\" href=\"#zrank\">#</a>  <code>zrank</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZRANK key member</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›æœ‰åºé›†  <code>key</code>  ä¸­æˆå‘˜  <code>member</code>  çš„æ’åã€‚å…¶ä¸­æœ‰åºé›†æˆå‘˜æŒ‰  <code>score</code>  å€¼é€’å¢ (ä»å°åˆ°å¤§) é¡ºåºæ’åˆ—</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k76 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; zrank k76 m4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; zrank k76 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 9</span><br></pre></td></tr></table></figure>\n<h3 id=\"zrevrank\"><a class=\"markdownIt-Anchor\" href=\"#zrevrank\">#</a>  <code>zrevrank</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZREVRANK key member</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›æœ‰åºé›†  <code>key</code>  ä¸­æˆå‘˜  <code>member</code>  çš„æ’åã€‚å…¶ä¸­æœ‰åºé›†æˆå‘˜æŒ‰  <code>score</code>  å€¼é€’å‡ (ä»å¤§åˆ°å°) æ’åºã€‚</p>\n<p>æ’åä»¥  <code>0</code>  ä¸ºåº•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ  <code>score</code>  å€¼æœ€å¤§çš„æˆå‘˜æ’åä¸º  <code>0</code>  ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k77 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; ZREVRANK k77 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; ZREVRANK k77 m4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br></pre></td></tr></table></figure>\n<h3 id=\"zrem\"><a class=\"markdownIt-Anchor\" href=\"#zrem\">#</a>  <code>zrem</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZREM key member [member ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>zset remove</code></p>\n<p>ç§»é™¤æœ‰åºé›†  <code>key</code>  ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œä¸å­˜åœ¨çš„æˆå‘˜å°†è¢«å¿½ç•¥ã€‚</p>\n<p>å½“  <code>key</code>  å­˜åœ¨ä½†ä¸æ˜¯æœ‰åºé›†ç±»å‹æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k78 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤m2,m3,m4</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZREM k78 m2 m3 m4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k78 0 -1 WITHSCORES</span><br><span class=\"line\"> 1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\"> 2) <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\"> 3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"> 4) <span class=\"string\">&quot;5&quot;</span></span><br><span class=\"line\"> 5) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\"> 6) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\"> 7) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\"> 8) <span class=\"string\">&quot;7&quot;</span></span><br><span class=\"line\"> 9) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">10) <span class=\"string\">&quot;8&quot;</span></span><br><span class=\"line\">11) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">12) <span class=\"string\">&quot;9&quot;</span></span><br><span class=\"line\">13) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\">14) <span class=\"string\">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zremrangebyrank\"><a class=\"markdownIt-Anchor\" href=\"#zremrangebyrank\">#</a>  <code>zremrangebyrank</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZREMRANGEBYRANK key start stop</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>ç§»é™¤æœ‰åºé›†  <code>key</code>  ä¸­ï¼ŒæŒ‡å®šæ’å ( <code>rank</code> ) åŒºé—´å†…çš„æ‰€æœ‰æˆå‘˜ã€‚</p>\n<p>åŒºé—´åˆ†åˆ«ä»¥ä¸‹æ ‡å‚æ•°  <code>start</code>  å’Œ  <code>stop</code>  æŒ‡å‡ºï¼ŒåŒ…å«  <code>start</code>  å’Œ  <code>stop</code>  åœ¨å†…ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k79 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤æ’åç¬¬2åˆ°æ’åç¬¬4çš„member</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZREMRANGEBYRANK k79 1 3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k79 0 -1 WITHSCORES</span><br><span class=\"line\"> 1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\"> 2) <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\"> 3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"> 4) <span class=\"string\">&quot;5&quot;</span></span><br><span class=\"line\"> 5) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\"> 6) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\"> 7) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\"> 8) <span class=\"string\">&quot;7&quot;</span></span><br><span class=\"line\"> 9) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">10) <span class=\"string\">&quot;8&quot;</span></span><br><span class=\"line\">11) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">12) <span class=\"string\">&quot;9&quot;</span></span><br><span class=\"line\">13) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\">14) <span class=\"string\">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zremrangebyscore\"><a class=\"markdownIt-Anchor\" href=\"#zremrangebyscore\">#</a> zremrangebyscore</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZREMRANGEBYSCORE key min max</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>ç§»é™¤æœ‰åºé›†  <code>key</code>  ä¸­ï¼Œæ‰€æœ‰  <code>score</code>  å€¼ä»‹äº  <code>min</code>  å’Œ  <code>max</code>  ä¹‹é—´ (åŒ…æ‹¬ç­‰äº  <code>min</code>  æˆ–  <code>max</code>  ) çš„æˆå‘˜ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k80 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ score&gt;=1 and score &lt;=9 çš„å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZREMRANGEBYSCORE k80 1 9</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 9</span><br><span class=\"line\">127.0.0.1:6379&gt; zrange k80 0 -1  WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zrangebylex\"><a class=\"markdownIt-Anchor\" href=\"#zrangebylex\">#</a> zrangebylex</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZRANGEBYLEX key min max [LIMIT offset count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å½“æœ‰åºé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å…·æœ‰ç›¸åŒçš„åˆ†å€¼æ—¶ï¼Œ æœ‰åºé›†åˆçš„å…ƒç´ ä¼šæ ¹æ®æˆå‘˜çš„å­—å…¸åºï¼ˆ <code>lexicographical ordering</code> ï¼‰æ¥è¿›è¡Œæ’åºï¼Œ è€Œè¿™ä¸ªå‘½ä»¤åˆ™å¯ä»¥è¿”å›ç»™å®šçš„æœ‰åºé›†åˆé”®  <code>key</code>  ä¸­ï¼Œ å€¼ä»‹äº  <code>min</code>  å’Œ  <code>max</code>  ä¹‹é—´çš„æˆå‘˜ã€‚</p>\n<p>æ³¨æ„:</p>\n<p>åˆæ³•çš„  <code>min</code>  å’Œ  <code>max</code>  å‚æ•°å¿…é¡»åŒ…å« ( æˆ–è€…  <code>[</code>  ï¼Œ å…¶ä¸­  <code>(</code>  è¡¨ç¤ºå¼€åŒºé—´ï¼ˆæŒ‡å®šçš„å€¼ä¸ä¼šè¢«åŒ…å«åœ¨èŒƒå›´ä¹‹å†…ï¼‰ï¼Œ è€Œ  <code>[</code>  åˆ™è¡¨ç¤ºé—­åŒºé—´ï¼ˆæŒ‡å®šçš„å€¼ä¼šè¢«åŒ…å«åœ¨èŒƒå›´ä¹‹å†…ï¼‰ã€‚</p>\n<p>ç‰¹æ®Šå€¼  <code>+</code>  å’Œ  <code>-</code>  åœ¨  <code>min</code>  å‚æ•°ä»¥åŠ  <code>max</code>  å‚æ•°ä¸­å…·æœ‰ç‰¹æ®Šçš„æ„ä¹‰ï¼Œ å…¶ä¸­  <code>+</code>  è¡¨ç¤ºæ­£æ— é™ï¼Œ è€Œ  <code>-</code>  è¡¨ç¤ºè´Ÿæ— é™ã€‚ å› æ­¤ï¼Œ å‘ä¸€ä¸ªæ‰€æœ‰æˆå‘˜çš„åˆ†å€¼éƒ½ç›¸åŒçš„æœ‰åºé›†åˆå‘é€å‘½ä»¤  <code>ZRANGEBYLEX &lt;zset&gt; - + </code> ï¼Œ å‘½ä»¤å°†è¿”å›æœ‰åºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </p>\n<blockquote>\n<p><code>lex</code> :<br>\n è¡¨ç¤ºå¦‚æœ <code>score</code>  ç›¸ç­‰ï¼Œåˆ™æŒ‰ç…§ <code>member</code>  çš„å­—å…¸é¡ºåºæ’åºã€‚<br>\næ­¤å¤–è¿™ä¸ªå‘½ä»¤ï¼Œæ¯”å¦‚ <code>ZRANGBYSCORE</code>  ç¨å¾®å¼ºå¤§ä¸€ç‚¹å„¿ã€‚å¯ä»¥æŒ‡å®šåŒºé—´èŒƒå›´ï¼Œå½“åªçŸ¥é“ <code>member</code> ï¼Œä¸çŸ¥é“ score çš„æ—¶å€™ï¼Œå¯ä»¥æ˜¯ä½¿ç”¨å¸¦æœ‰  <code>lex</code>  çš„å‘½ä»¤ã€‚</p>\n</blockquote>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; zadd k81 1 a 2 b 3 c 4 d 5 f 6 g</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› scoreå€¼åœ¨açš„scoreå€¼å’Œcçš„scoreå€¼ä¹‹é—´çš„member</span></span><br><span class=\"line\"><span class=\"comment\"># å³: score&gt; Score(a) &amp;&amp; score &lt;= Score(c)</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGEBYLEX k81 (a  [c </span><br><span class=\"line\">1) <span class=\"string\">&quot;b&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;c&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿”å› å°äºç­‰äºcçš„Scoreå€¼çš„å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGEBYLEX k81 -  [c </span><br><span class=\"line\">1) <span class=\"string\">&quot;a&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;b&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;c&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›æ‰€æœ‰å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGEBYLEX k81 - + </span><br><span class=\"line\">1) <span class=\"string\">&quot;a&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;b&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;c&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;d&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;f&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;g&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zlexcount\"><a class=\"markdownIt-Anchor\" href=\"#zlexcount\">#</a>  <code>zlexcount</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZLEXCOUNT key min max</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å¯¹äºä¸€ä¸ªæ‰€æœ‰æˆå‘˜çš„åˆ†å€¼éƒ½ç›¸åŒçš„æœ‰åºé›†åˆé”®  <code>key</code>  æ¥è¯´ï¼Œ è¿™ä¸ªå‘½ä»¤ä¼šè¿”å›è¯¥é›†åˆä¸­ï¼Œ æˆå‘˜ä»‹äº  <code>min</code>  å’Œ  <code>max</code>  èŒƒå›´å†…çš„å…ƒç´ æ•°é‡ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; zadd k82 1 a 2 b 3 c 4 d 5 f 6 g</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br><span class=\"line\">127.0.0.1:6379&gt; ZLEXCOUNT k82 2 5</span><br><span class=\"line\">(error) ERR min or max not valid string range item</span><br><span class=\"line\">127.0.0.1:6379&gt; ZLEXCOUNT k82 a b</span><br><span class=\"line\"><span class=\"comment\"># å¤§äºScore(a),å°äºç­‰äºScore(b)çš„member,åªæœ‰b.</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZLEXCOUNT k82 (a [b</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># å¤§äºScore(a),å°äºç­‰äºScore(d)çš„member,æœ‰b.c.dï¼Œä¸‰ä¸ª</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZLEXCOUNT k82 (a [d</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br></pre></td></tr></table></figure>\n<h3 id=\"zremrangebylex\"><a class=\"markdownIt-Anchor\" href=\"#zremrangebylex\">#</a>  <code>zremrangebylex</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZREMRANGEBYLEX key min max</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å¯¹äºä¸€ä¸ªæ‰€æœ‰æˆå‘˜çš„åˆ†å€¼éƒ½ç›¸åŒçš„æœ‰åºé›†åˆé”®  <code>key</code>  æ¥è¯´ï¼Œ è¿™ä¸ªå‘½ä»¤ä¼šç§»é™¤è¯¥é›†åˆä¸­ï¼Œ æˆå‘˜ä»‹äº  <code>min</code>  å’Œ  <code>max</code>  èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; zadd k83 1 a 2 b 3 c 4 d 5 f 6 g</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤ scoreå€¼åœ¨ (Score(a),Score(c)] ä¹‹é—´çš„member</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZREMRANGEBYLEX k83 (a [c</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"><span class=\"comment\"># åˆ é™¤äº†ï¼Œb,c</span></span><br><span class=\"line\">127.0.0.1:6379&gt; zrange k83 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;a&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;d&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;f&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;g&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zscan\"><a class=\"markdownIt-Anchor\" href=\"#zscan\">#</a> zscan</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZSCAN key cursor [MATCH pattern] [COUNT count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢å‘½ä»¤ã€‚ åŒ  <code>SCAN</code>  å‘½ä»¤ã€‚å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href=\"./010-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4.md\">010 - å…¶ä»–å‘½ä»¤</a></p>\n<p><code>SCAN</code>  å‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼ˆ <code>cursor based iterator</code> ï¼‰ï¼š  <code>SCAN</code>  å‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨ä¹‹åï¼Œ éƒ½ä¼šå‘ç”¨æˆ·è¿”å›ä¸€ä¸ªæ–°çš„æ¸¸æ ‡ï¼Œ ç”¨æˆ·åœ¨ä¸‹æ¬¡è¿­ä»£æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–°æ¸¸æ ‡ä½œä¸º  <code>SCAN</code>  å‘½ä»¤çš„æ¸¸æ ‡å‚æ•°ï¼Œ ä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k84 1 m1 2 m2 3 m3 4 m4 5 m5 6 m6 7 m7 8 m8 9 m9 10 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; zscan k84 0 MATCH m* COUNT 3</span><br><span class=\"line\">1) <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">2)  1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">    2) <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">    3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">    4) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">    5) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">    6) <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\">    7) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">    8) <span class=\"string\">&quot;4&quot;</span></span><br><span class=\"line\">    9) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">   10) <span class=\"string\">&quot;5&quot;</span></span><br><span class=\"line\">   11) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">   12) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\">   13) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">   14) <span class=\"string\">&quot;7&quot;</span></span><br><span class=\"line\">   15) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">   16) <span class=\"string\">&quot;8&quot;</span></span><br><span class=\"line\">   17) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">   18) <span class=\"string\">&quot;9&quot;</span></span><br><span class=\"line\">   19) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\">   20) <span class=\"string\">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zunionstore\"><a class=\"markdownIt-Anchor\" href=\"#zunionstore\">#</a>  <code>zunionstore</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]</code></p>\n<ul>\n<li>\n<p>è§£é‡Š<br>\nè®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†åˆçš„å¹¶é›†ï¼Œå…¶ä¸­ç»™å®š key çš„æ•°é‡å¿…é¡»ä»¥ numkeys å‚æ•°æŒ‡å®šï¼Œå¹¶å°†è¯¥å¹¶é›† (ç»“æœé›†) å‚¨å­˜åˆ° destination ã€‚<br>\nå¦‚æœ key ç›¸åŒçš„æ—¶å€™ï¼Œå¯¹åº”çš„ score å€¼ä¼šç›¸åŠ ã€‚</p>\n<ul>\n<li><code>WEIGHTS</code> : ä½¿ç”¨  <code>WEIGHTS</code>  é€‰é¡¹ï¼Œä½ å¯ä»¥ä¸º æ¯ä¸ª ç»™å®šæœ‰åºé›† åˆ†åˆ« æŒ‡å®šä¸€ä¸ªä¹˜æ³•å› å­ ( <code>multiplication factor</code> )ï¼Œæ¯ä¸ªç»™å®šæœ‰åºé›†çš„æ‰€æœ‰æˆå‘˜çš„  <code>score</code>  å€¼åœ¨ä¼ é€’ç»™èšåˆå‡½æ•° ( <code>aggregation function</code> ) ä¹‹å‰éƒ½è¦å…ˆä¹˜ä»¥è¯¥æœ‰åºé›†çš„å› å­ã€‚</li>\n<li><code>AGGREGATE</code> : ä½¿ç”¨  <code>AGGREGATE</code>  é€‰é¡¹ï¼Œä½ å¯ä»¥æŒ‡å®šå¹¶é›†çš„ç»“æœé›†çš„èšåˆæ–¹å¼ã€‚<br>\né»˜è®¤ä½¿ç”¨çš„å‚æ•°  <code>SUM</code>  ï¼Œå¯ä»¥å°†æ‰€æœ‰é›†åˆä¸­æŸä¸ªæˆå‘˜çš„  <code>score</code>  å€¼ä¹‹ å’Œ ä½œä¸ºç»“æœé›†ä¸­è¯¥æˆå‘˜çš„  <code>score</code>  å€¼ï¼›ä½¿ç”¨å‚æ•°  <code>MIN</code>  ï¼Œå¯ä»¥å°†æ‰€æœ‰é›†åˆä¸­æŸä¸ªæˆå‘˜çš„ æœ€å°  <code>score</code>  å€¼ä½œä¸ºç»“æœé›†ä¸­è¯¥æˆå‘˜çš„  <code>score</code>  å€¼ï¼›è€Œå‚æ•°  <code>MAX</code>  åˆ™æ˜¯å°†æ‰€æœ‰é›†åˆä¸­æŸä¸ªæˆå‘˜çš„ æœ€å¤§  <code>score</code>  å€¼ä½œä¸ºç»“æœé›†ä¸­è¯¥æˆå‘˜çš„  <code>score</code>  å€¼ã€‚</li>\n</ul>\n</li>\n<li>\n<p>æ¼”ç¤º</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; ZADD k85_1 1 m1 2 m2 3 m3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k85_2 1 m1 4 m4 5 m5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZUNIONSTORE k85 2 k85_1 k85_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; zrange k85 0 -1 WITHSCORES</span><br><span class=\"line\"> 1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\"> 2) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\"> 3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\"> 4) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\"> 5) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\"> 6) <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"> 7) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\"> 8) <span class=\"string\">&quot;4&quot;</span></span><br><span class=\"line\"> 9) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">10) <span class=\"string\">&quot;5&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¼”ç¤º Weightså‚æ•°ï¼š WEIGHTS 2 3</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡: ç¬¬ä¸€ä¸ªzsetçš„æ‰€æœ‰å…ƒç´  *2 ï¼Œç¬¬äºŒä¸ªæœ‰åºé›†åˆä¸­çš„å…ƒç´  *3</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZUNIONSTORE k85 2 k85_1 k85_2 WEIGHTS 2 3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k85 0 -1 WITHSCORES</span><br><span class=\"line\"> 1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\"> 2) <span class=\"string\">&quot;4&quot;</span></span><br><span class=\"line\"> 3) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\"> 4) <span class=\"string\">&quot;5&quot;</span></span><br><span class=\"line\"> 5) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\"> 6) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\"> 7) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\"> 8) <span class=\"string\">&quot;12&quot;</span></span><br><span class=\"line\"> 9) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">10) <span class=\"string\">&quot;15&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ¼”ç¤º Weightså‚æ•°ï¼š WEIGHTS 2 4</span></span><br><span class=\"line\"><span class=\"comment\"># æŒ‡: ç¬¬ä¸€ä¸ªzsetçš„æ‰€æœ‰å…ƒç´  *2 ï¼Œç¬¬äºŒä¸ªæœ‰åºé›†åˆä¸­çš„å…ƒç´  *3</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZUNIONSTORE k85 2 k85_1 k85_2 WEIGHTS 2 4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k85 0 -1 WITHSCORES</span><br><span class=\"line\"> 1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\"> 2) <span class=\"string\">&quot;4&quot;</span></span><br><span class=\"line\"> 3) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\"> 4) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\"> 5) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\"> 6) <span class=\"string\">&quot;6&quot;</span></span><br><span class=\"line\"> 7) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\"> 8) <span class=\"string\">&quot;16&quot;</span></span><br><span class=\"line\"> 9) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">10) <span class=\"string\">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zinterstore\"><a class=\"markdownIt-Anchor\" href=\"#zinterstore\">#</a> zinterstore</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ZINTERSTORE destination numkeys key [key â€¦] [WEIGHTS weight [weight â€¦]] [AGGREGATE SUM|MIN|MAX]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†çš„äº¤é›†ï¼Œå…¶ä¸­ç»™å®š  <code>key</code>  çš„æ•°é‡å¿…é¡»ä»¥  <code>numkeys</code>  å‚æ•°æŒ‡å®šï¼Œå¹¶å°†è¯¥äº¤é›† (ç»“æœé›†) å‚¨å­˜åˆ°  <code>destination</code>  ã€‚</p>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç»“æœé›†ä¸­æŸä¸ªæˆå‘˜çš„  <code>score</code>  å€¼æ˜¯æ‰€æœ‰ç»™å®šé›†ä¸‹è¯¥æˆå‘˜  <code>score</code>  å€¼ä¹‹å’Œ.</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; zadd k86_1 1 m1 2 m2 3 m3 4 m4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">127.0.0.1:6379&gt; ZADD k86_2 20 m2 30 m3 50 m5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; ZINTERSTORE k86 2 k86_1 k86_2 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"><span class=\"comment\"># å–äº¤é›†(é»˜è®¤ç›¸åŠ )</span></span><br><span class=\"line\">127.0.0.1:6379&gt; zrange k86 0 -1 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;22&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;33&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># WEIGTHS å‚æ•°å’Œä¸Šé¢çš„ ZUNIONSTOREå‘½ä»¤ä¸€æ ·.</span></span><br><span class=\"line\"><span class=\"comment\"># è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹, AGGREGATEå‚æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># é»˜è®¤ä½¿ç”¨çš„æ˜¯SUM. å°±æ˜¯æœ¬å‘½ä»¤ä¸­ä¸Šé¢çš„ä¾‹å­äº†.</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸‹é¢æ¼”ç¤ºMIN å’Œ MAX</span></span><br><span class=\"line\">127.0.0.1:6379&gt; ZINTERSTORE k86 2 k86_1 k86_2 AGGREGATE MIN</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k86 0 -1 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; ZINTERSTORE k86 2 k86_1 k86_2 AGGREGATE MAX</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; ZRANGE k86 0 -1 WITHSCORES</span><br><span class=\"line\">1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;20&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;30&quot;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"zsetçš„å†…éƒ¨ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#zsetçš„å†…éƒ¨ç»“æ„\">#</a>  <code>zset</code>  çš„å†…éƒ¨ç»“æ„</h2>\n<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ <code>skiplist</code> ï¼Œå¦‚æœå¿˜è®°äº† <code>hashtable</code> ï¼Œå°±çœ‹ç€<a href=\"2021/08/01/Redis%E7%B3%BB%E5%88%97/C-8-Redis%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E5%AD%97%E5%85%B8Dict/\">è¿™ç¯‡æ–‡ç« </a></p>\n<p>æˆ‘ä»¬ä»å‘½ä»¤ <code>zadd</code>  å…¥æ‰‹ï¼Œæ‰¾åˆ° <code>zset</code>  çš„ <code>add</code>  é€šç”¨æ–¹æ³• <code>zaddGenericCommand(c,ZADD_NONE);</code>  æ¥çœ‹ä¸€ä¸‹ã€‚çœç•¥äº†éƒ¨åˆ†ä»£ç ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">if</span> (server.zset_max_ziplist_entries == <span class=\"number\">0</span> ||</span><br><span class=\"line\">            server.zset_max_ziplist_value &lt; <span class=\"built_in\">sdslen</span>(c-&gt;argv[scoreidx+<span class=\"number\">1</span>]-&gt;ptr))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// åˆ›å»º OBJ_ENCODING_SKIPLIST ç¼–ç çš„ç»“æ„</span></span><br><span class=\"line\">    zobj = <span class=\"built_in\">createZsetObject</span>();</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/// åˆ›å»º OBJ_ZSET ç¼–ç çš„ç»“æ„</span></span><br><span class=\"line\">    zobj = <span class=\"built_in\">createZsetZiplistObject</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure>\n<p>æ¥çœ‹ä¸€ä¸‹  <code>createZsetObject()</code>  æ–¹æ³•çš„å®ç°ï¼Œå°±å†æ¸…æ™°ä¸è¿‡äº†ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// åˆ›å»º Zset å¯¹è±¡ã€‚</span></span><br><span class=\"line\"><span class=\"function\">robj *<span class=\"title\">createZsetObject</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\">    zset *zs = <span class=\"built_in\">zmalloc</span>(<span class=\"built_in\"><span class=\"keyword\">sizeof</span></span>(*zs));</span><br><span class=\"line\">    robj *o;</span><br><span class=\"line\"></span><br><span class=\"line\">    zs-&gt;dict = <span class=\"built_in\">dictCreate</span>(&amp;zsetDictType, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    zs-&gt;zsl = <span class=\"built_in\">zslCreate</span>();</span><br><span class=\"line\">    o = <span class=\"built_in\">createObject</span>(OBJ_ZSET, zs);</span><br><span class=\"line\">    o-&gt;encoding = OBJ_ENCODING_SKIPLIST;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åˆ°è¿™é‡Œï¼Œå°±æ˜¯æˆ‘ä»¬å’Œ  <code>zset</code>  è¿™ç§æ•°æ®ç±»å‹çš„åˆæ¬¡æ·±å…¥è§é¢äº†ã€‚ æˆ‘ä»¬å…ˆçœ‹ä¸‹  <code>zset</code>  è¿™ç§ç»“æ„ä½“çš„å®šä¹‰ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// æœ‰åºé›†åˆçš„ç»“æ„å®šä¹‰</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zset</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">/// å­—å…¸ï¼Œé”®ä¸ºæˆå‘˜,å€¼ä¸ºscore</span></span><br><span class=\"line\">    <span class=\"comment\">/// ç”¨äºæ”¯æŒ O(1) å¤æ‚åº¦çš„æŒ‰æˆå‘˜åˆ†å€¼æ“ä½œã€‚</span></span><br><span class=\"line\">    dict *dict;</span><br><span class=\"line\">    <span class=\"comment\">/// è·³è·ƒè¡¨,æŒ‰åˆ†å€¼æ’åºæˆå‘˜</span></span><br><span class=\"line\">    <span class=\"comment\">/// ç”¨äºæ”¯æŒå¹³å‡å¤æ‚åº¦ä¸º O(logN)çš„æŒ‰åˆ†å€¼å®šä½æˆå‘˜ä»¥åŠèŒƒå›´çš„æ“ä½œã€‚</span></span><br><span class=\"line\">    zskiplist *zsl;</span><br><span class=\"line\">&#125; zset;</span><br></pre></td></tr></table></figure>\n<p><code>dict</code>  å‰é¢å·²ç»çœ‹è¿‡äº†ï¼Œè¿™é‡Œæ¥çœ‹ä¸‹ <code>zskiplist</code> ã€‚</p>\n<h3 id=\"skiplist\"><a class=\"markdownIt-Anchor\" href=\"#skiplist\">#</a>  <code>skiplist</code></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// è·³è·ƒè¡¨</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplist</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">/// è¡¨å¤´ï¼Œè¡¨å°¾</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">header</span>, *<span class=\"title\">tail</span>;</span></span><br><span class=\"line\">    <span class=\"comment\">/// è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> length;</span><br><span class=\"line\">    <span class=\"comment\">/// è¡¨ä¸­å±‚æ•°æœ€å¤§çš„èŠ‚ç‚¹çš„å±‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> level;</span><br><span class=\"line\">&#125; zskiplist;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> &#123;</span></span><br><span class=\"line\">    sds ele;</span><br><span class=\"line\">    <span class=\"comment\">/// åˆ†æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">double</span> score;</span><br><span class=\"line\">    <span class=\"comment\">/// åé€€çš„æŒ‡é’ˆ</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">backward</span>;</span></span><br><span class=\"line\">    <span class=\"comment\">/// å±‚</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistLevel</span> &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">/// å‰è¿›æŒ‡é’ˆ</span></span><br><span class=\"line\">        <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">forward</span>;</span></span><br><span class=\"line\">        <span class=\"comment\">/// è·¨åº¦</span></span><br><span class=\"line\">        <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> span;</span><br><span class=\"line\">    &#125; level[];</span><br><span class=\"line\">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<ul>\n<li>æœ¬ç« æ˜¯ä¸€ä¸ªæ–°çš„å¸¸ç”¨æ•°æ®ç±»å‹ï¼Œ <code>ZSET</code>  æœ‰åºé›†åˆã€‚åº•å±‚çš„æ•°æ®ç»“æ„æ˜¯ä½¿ç”¨çš„æ˜¯  <code>skipList</code>  å’Œ  <code>hashtable</code>  . å…³äº <code>Skiplist</code>  çš„åˆæ­¥äº†è§£æ–‡ç« <a href=\"#\">ç©¿æ¢­æœº</a> å’Œ  <code>Redis</code>  ä¸­  <code>skiplist</code>  çš„å®ç°æºç è§£è¯»<a href=\"\">ç©¿æ¢­æœº</a></li>\n<li>ç„¶åç®€å•ä»‹ç»äº†  <code>Redis ZSET</code>  æ•°æ®ç±»å‹çš„åŸºç¡€ä½¿ç”¨åœºæ™¯ã€‚å…³é”®å­—æœ‰  <code>æœ‰åº</code> ï¼Œ <code>æ’å</code> ï¼Œ <code>æƒé‡</code> ç­‰.</li>\n<li><code>ZSET</code>  çš„  <code>20</code>  ä¸ªå¸¸æœ‰å‘½ä»¤ã€‚ åé¢æˆ‘ä¼šé’ˆå¯¹è¿™  <code>20</code>  ä¸ªå‘½ä»¤çš„å®ç°è¿›è¡Œç®€å•çš„åˆ†äº«.</li>\n<li>ç„¶åç®€å•çš„çœ‹äº†ä¸€ä¸‹ <code>Redis</code>  ä¸­çš„æ•°æ®ç»“æ„çš„å®ç°ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œ <code>Redis</code>  çš„æ•°æ®ç»“æ„æ˜¯åŠ¨æ€ç¼–ç çš„ï¼Œ  <code>ZSET</code>  æ˜¯æœ‰ <code>hashtable</code>  å’Œ  <code>skiplist</code>  å®ç°çš„ã€‚ skiplist æ˜¯ä¸€ä¸ªéå¸¸é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æŸ¥çš„æ•ˆç‡éƒ½æ˜¯  <code>O(logN)</code> . å®ç°åŸç†å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <a href=\"#\">ç›´é€šè½¦</a>ï¼Œé‡Œé¢æœ‰å‡ ç§æµè¡Œçš„è¯­è¨€çš„å®ç°ï¼Œå¯ä»¥é’ˆå¯¹è‡ªå·±æ“…é•¿çš„è¯­è¨€è¿›è¡ŒæŸ¥çœ‹ã€‚</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-4-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%9B%86%E5%90%88set/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-4-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%9B%86%E5%90%88set/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹é›†åˆ Set",
            "date_published": "2021-08-01T10:28:55.000Z",
            "content_html": "<h2 id=\"ä¹¦æ¥ä¸Šå›\"><a class=\"markdownIt-Anchor\" href=\"#ä¹¦æ¥ä¸Šå›\">#</a> ä¹¦æ¥ä¸Šå›</h2>\n<p>å‰ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å­¦ä¹ çš„æ˜¯ <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/\">Redis çš„æ•°æ®ç»“æ„ä¹‹ hash</a>ï¼Œ å­¦ä¹ äº†å…¶åŸºæœ¬çš„æ“ä½œå’Œä½¿ç”¨å†…éƒ¨æ•°æ®ç»“æ„æ˜¯ <code>hashtable</code>  å’Œ <code>ziplist</code> ï¼Œå…¶ä¸­ <code>Redis</code>  ä¸­çš„ <code>hashtable</code>  æ˜¯ç”¨  <code>dict</code>  è¡¨ç¤ºçš„ã€‚å¦‚æœä¸è®°å¾—äº†å…¶å†…éƒ¨æ„æˆï¼Œå°±å†çœ‹çœ‹çœ‹ç€<a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/\">ä¸Šç¯‡æ–‡ç« </a>å§ã€‚ç°åœ¨æˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸‹ä¸€ä¸ªæ•°æ®ç±»å‹  <code>set</code> ã€‚</p>\n<h2 id=\"setç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#setç®€ä»‹\">#</a>  <code>set</code>  ç®€ä»‹</h2>\n<p><code>Redis</code>  çš„  <code>set</code>  æ•°æ®ç±»å‹è¡¨ç¤º ä¸€å †ä¸é‡å¤å€¼çš„é›†åˆã€‚</p>\n<p><code>Redis</code>  çš„ <code>set</code>  æ•°æ®ç±»å‹æœ‰ä¸¤ç§ç¼–ç æ–¹å¼.  <code>OBJ_ENCODING_INTSET</code>  å’Œ  <code>OBJ_ENCODING_HT</code> .</p>\n<ul>\n<li>\n<p><code>OBJ_ENCODING_HT</code>  è¿™ç§ç¼–ç æ–¹å¼åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/\">07-Redis çš„æ•°æ®ç±»å‹ä¹‹ hash</a> ä¸­å·²ç»ç®€å•çš„ä»‹ç»è¿‡äº†ã€‚å…¶å®ç°çš„æ•°æ®ç»“æ„ä¸º  <code>dict</code> ã€‚</p>\n</li>\n<li>\n<p><code>OBJ_ENCODING_INTSET</code> , è¿™ç§ç¼–ç æ–¹å¼æ˜¯æˆ‘ä»¬è¦æ–°å­¦ä¹ çš„ç¼–ç æ–¹å¼ã€‚ <a href=\"#intset\">ç”µæ¢¯ç›´è¾¾</a></p>\n</li>\n</ul>\n<p>å¦‚æœä½ çœ‹åˆ°è¿™å¥è¯ï¼Œé‚£å°±è¯´æ˜ä½ æ˜¯ä¸€ä¸ªç‰¹åˆ«è®¤çœŸçš„äººã€‚å“ˆå“ˆå“ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆéµå¾ªæƒ¯ä¾‹ã€‚å…ˆå­¦ä¹  <code>set</code>  ç±»å‹ç›¸å…³çš„å‘½ä»¤ã€‚</p>\n<h2 id=\"setç±»å‹çš„åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#setç±»å‹çš„åº”ç”¨åœºæ™¯\">#</a>  <code>set</code>  ç±»å‹çš„åº”ç”¨åœºæ™¯</h2>\n<ul>\n<li>ç¤¾äº¤ç³»ç»Ÿä¸­å­˜å‚¨å…³æ³¨ä¿¡æ¯ï¼Œç‚¹èµä¿¡æ¯ï¼Œåˆ©ç”¨äº¤å¹¶å·®è¿ç®—ï¼Œè®¡ç®—å…±åŒå¥½å‹ç­‰ä¸šåŠ¡ä¸­ã€‚æ¯”å¦‚ <code>qq</code>  çš„å¥½å‹æ¨èé€»è¾‘ï¼Œå°±å¯ä»¥ä½¿ç”¨å·®é›†è¿ç®—ã€‚</li>\n<li>éœ€è¦å»é‡çš„ä¸šåŠ¡é€»è¾‘ä¸­ã€‚æŸä¸€æ—¶é—´ç«¯å†…ç³»ç»Ÿçš„å¢é•¿äººæ•°ã€‚</li>\n<li>ç»Ÿè®¡è®¿é—®ç½‘ç«™çš„ç‹¬ç«‹ <code>IP</code> ã€‚</li>\n</ul>\n<h2 id=\"setçš„åŸºæœ¬å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#setçš„åŸºæœ¬å‘½ä»¤\">#</a>  <code>set</code>  çš„åŸºæœ¬å‘½ä»¤</h2>\n<h3 id=\"sadd\"><a class=\"markdownIt-Anchor\" href=\"#sadd\">#</a>  <code>sadd</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SADD key member [member ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set add</code></p>\n<p>å°†ä¸€ä¸ªæˆ–å¤šä¸ª  <code>member</code>  å…ƒç´ åŠ å…¥åˆ°é›†åˆ  <code>key</code>  å½“ä¸­ï¼Œå·²ç»å­˜åœ¨äºé›†åˆçš„  <code>member</code>  å…ƒç´ å°†è¢«å¿½ç•¥ã€‚</p>\n<p>å‡å¦‚  <code>key</code>  ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªåªåŒ…å«  <code>member</code>  å…ƒç´ ä½œæˆå‘˜çš„é›†åˆã€‚</p>\n<p>å½“  <code>key</code>  ä¸æ˜¯é›†åˆç±»å‹æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; sadd k52 mem1 mem2 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; sadd k52 mem1 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; sadd k52 mem1 mem3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"smembers\"><a class=\"markdownIt-Anchor\" href=\"#smembers\">#</a>  <code>smembers</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SMEMBERS key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set members</code></p>\n<p>è¿”å›é›†åˆ  <code>key</code>  ä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚</p>\n<p>ä¸å­˜åœ¨çš„  <code>key</code>  è¢«è§†ä¸ºç©ºé›†åˆ</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æŸ¥è¯¢å…ƒç´ ï¼Œ æ³¨æ„ä¿å­˜æ˜¯æ— åºçš„.</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k53 m1 m2 m3 m4 m5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k53</span><br><span class=\"line\">1) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m5&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"sismember\"><a class=\"markdownIt-Anchor\" href=\"#sismember\">#</a>  <code>sismember</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SISMEMBER key member</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set is members</code></p>\n<p>åˆ¤æ–­  <code>member</code>  å…ƒç´ æ˜¯å¦é›†åˆ  <code>key</code>  çš„æˆå‘˜ã€‚</p>\n<p>å¦‚æœ  <code>member</code>  å…ƒç´ æ˜¯é›†åˆçš„æˆå‘˜ï¼Œè¿”å›  <code>1</code>  ã€‚ å¦‚æœ  <code>member</code>  å…ƒç´ ä¸æ˜¯é›†åˆçš„æˆå‘˜ï¼Œæˆ–  <code>key</code>  ä¸å­˜åœ¨ï¼Œè¿”å›  <code>0</code></p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k54 m1 m2 m3 m4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">127.0.0.1:6379&gt; SISMEMBER k54 m2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; SISMEMBER k54 m5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br></pre></td></tr></table></figure>\n<h3 id=\"spop\"><a class=\"markdownIt-Anchor\" href=\"#spop\">#</a>  <code>spop</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SPOP key [count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set pop</code></p>\n<p>ç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ <b>éšæœºä¸€ä¸ª</b> å…ƒç´ ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k55 m1 m2 m3 m4 m5 m6 m7 m8 m9 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># éšæœºç§»é™¤ä¸€ä¸ªå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; spop k55</span><br><span class=\"line\"><span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; spop k55</span><br><span class=\"line\"><span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; spop k55</span><br><span class=\"line\"><span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># éšæœºç§»é™¤3ä¸ªå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; spop k55 3</span><br><span class=\"line\">1) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹æ‰€æœ‰å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k55</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m6&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"srandmemeber\"><a class=\"markdownIt-Anchor\" href=\"#srandmemeber\">#</a>  <code>srandmemeber</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SRANDMEMBER key [count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set rand member</code></p>\n<p>è¿”å›é›†åˆä¸­çš„ éšæœº  <code>count</code>  ä¸ªå…ƒç´  (ä¸ä¼šåˆ é™¤å…ƒç´ )</p>\n<p>å¦‚æœ  <code>count</code>  ä¸ºæ­£æ•°ï¼Œä¸”å°äºé›†åˆåŸºæ•°ï¼Œé‚£ä¹ˆå‘½ä»¤è¿”å›ä¸€ä¸ªåŒ…å«  <code>count</code>  ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å„ä¸ç›¸åŒã€‚å¦‚æœ  <code>count</code>  å¤§äºç­‰äºé›†åˆåŸºæ•°ï¼Œé‚£ä¹ˆè¿”å›æ•´ä¸ªé›†åˆã€‚</p>\n<p>å¦‚æœ  <code>count</code>  ä¸ºè´Ÿæ•°ï¼Œé‚£ä¹ˆå‘½ä»¤è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å¯èƒ½ä¼šé‡å¤å‡ºç°å¤šæ¬¡ï¼Œè€Œæ•°ç»„çš„é•¿åº¦ä¸º  <code>count</code>  çš„ç»å¯¹å€¼ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k56 m1 m2 m3 m4 m5 m6 m7 m8 m9 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># éšæœºè¿”å›ä¸€ä¸ªå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; SRANDMEMBER k56 </span><br><span class=\"line\"><span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SRANDMEMBER k56 </span><br><span class=\"line\"><span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SRANDMEMBER k56 </span><br><span class=\"line\"><span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># countæ˜¯æ­£æ•°ï¼Œå°äºé›†åˆçš„å…ƒç´ æ•°,è¿”å›countä¸ªå…ƒç´ ï¼Œæ— é‡å¤å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; SRANDMEMBER k56 5</span><br><span class=\"line\">1) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># countæ˜¯æ­£æ•°ï¼Œå¤§äºé›†åˆçš„å…ƒç´ æ•°,è¿”å›æ•´ä¸ªé›†åˆ</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SRANDMEMBER k56 20</span><br><span class=\"line\"> 1) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"> 2) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\"> 3) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\"> 4) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\"> 5) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\"> 6) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\"> 7) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\"> 8) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\"> 9) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">10) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># countä¸ºè´Ÿæ•°ï¼Œ è¿”å›20ä¸ªé›†åˆä¸­çš„å…ƒç´ ï¼Œå…ƒç´ ä¼šé‡å¤</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SRANDMEMBER k56 -20</span><br><span class=\"line\"> 1) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\"> 2) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\"> 3) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\"> 4) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\"> 5) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\"> 6) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"> 7) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\"> 8) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\"> 9) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">10) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">11) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">12) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">13) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">14) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">15) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">16) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">17) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">18) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">19) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">20) <span class=\"string\">&quot;m6&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"srem\"><a class=\"markdownIt-Anchor\" href=\"#srem\">#</a>  <code>srem</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SREM key member [member ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set remove</code></p>\n<p>ç§»é™¤é›†åˆ  <code>key</code>  ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ª  <code>member</code>  å…ƒç´ ï¼Œä¸å­˜åœ¨çš„  <code>member</code>  å…ƒç´ ä¼šè¢«å¿½ç•¥ã€‚</p>\n<p>å½“  <code>key</code>  ä¸æ˜¯é›†åˆç±»å‹ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k57 m1 m2 m3 m4 m5 m6 m7 m8 m9 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; SREM k57 m1 m2 m3 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k57</span><br><span class=\"line\">1) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\">7) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SREM k57 m11 m12</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br></pre></td></tr></table></figure>\n<h3 id=\"smove\"><a class=\"markdownIt-Anchor\" href=\"#smove\">#</a>  <code>smove</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SMOVE source destination member</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set move</code></p>\n<p>å°†  <code>member</code>  å…ƒç´ ä»  <code>source</code>  é›†åˆç§»åŠ¨åˆ°  <code>destination</code>  é›†åˆã€‚</p>\n<p><b> <code>SMOVE</code>  æ˜¯åŸå­æ€§æ“ä½œ</b>ã€‚</p>\n<p>å¦‚æœ  <code>source</code>  é›†åˆä¸å­˜åœ¨æˆ–ä¸åŒ…å«æŒ‡å®šçš„  <code>member</code>  å…ƒç´ ï¼Œåˆ™  <code>SMOVE</code>  å‘½ä»¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œä»…è¿”å›  <code>0</code>  ã€‚å¦åˆ™ï¼Œ  <code>member</code>  å…ƒç´ ä»  <code>source</code>  é›†åˆä¸­è¢«ç§»é™¤ï¼Œå¹¶æ·»åŠ åˆ°  <code>destination</code>  é›†åˆä¸­å»ã€‚</p>\n<p>å½“  <code>destination</code>  é›†åˆå·²ç»åŒ…å«  <code>member</code>  å…ƒç´ æ—¶ï¼Œ  <code>SMOVE</code>  å‘½ä»¤åªæ˜¯ç®€å•åœ°å°†  <code>source</code>  é›†åˆä¸­çš„  <code>member</code>  å…ƒç´ åˆ é™¤ã€‚</p>\n<p>å½“  <code>source</code>  æˆ–  <code>destination</code>  ä¸æ˜¯é›†åˆç±»å‹æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k58 m1 m2 m3 m4 m5 m6 m7 m8 m9 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># ç§»åŠ¨ä¸¤ä¸ªå…ƒç´ åˆ°k58_dis</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SMOVE k58 k58_dis m1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; SMOVE k58 k58_dis m2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; SMOVE k58 k58_dis m1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"><span class=\"comment\"># k58ä¸­çš„m1ï¼Œm2 å·²è¢«ç§»é™¤ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k58</span><br><span class=\"line\">1) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;m10&quot;</span></span><br><span class=\"line\">7) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">8) <span class=\"string\">&quot;m9&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># k58_disä¸­çš„m1,m2</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k58_dis</span><br><span class=\"line\">1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m1&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"scard\"><a class=\"markdownIt-Anchor\" href=\"#scard\">#</a>  <code>scard</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SCARD key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›é›†åˆ  <code>key</code>  çš„åŸºæ•° (é›†åˆä¸­å…ƒç´ çš„æ•°é‡)ã€‚<br>\né›†åˆçš„åŸºæ•°ã€‚ å½“  <code>key</code>  ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›  <code>0</code></p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k59 m1 m2 m3 m4 m5 m6 m7 m8 m9 m10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\"><span class=\"comment\"># è·å–å…ƒç´ ä¸ªæ•°</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SCARD k59</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br></pre></td></tr></table></figure>\n<h3 id=\"sinter\"><a class=\"markdownIt-Anchor\" href=\"#sinter\">#</a>  <code>sinter</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code> SINTER key [key ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set intersection</code>  :  <code>set</code>  çš„äº¤é›†</p>\n<p>è¿”å›ä¸€ä¸ªé›†åˆçš„å…¨éƒ¨æˆå‘˜ï¼Œè¯¥é›†åˆæ˜¯æ‰€æœ‰ç»™å®šé›†åˆçš„äº¤é›†ã€‚</p>\n<p>ä¸å­˜åœ¨çš„  <code>key</code>  è¢«è§†ä¸ºç©ºé›†ã€‚</p>\n<p>å½“ç»™å®šé›†åˆå½“ä¸­æœ‰ä¸€ä¸ªç©ºé›†æ—¶ï¼Œç»“æœä¹Ÿä¸ºç©ºé›† (æ ¹æ®é›†åˆè¿ç®—å®šå¾‹)ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k60_1 m1 m2 m3 m4 m5 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k60_2 m2 m3 m4 m5 m6</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k60_3 m4 m5 m6 m7 m8</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\"><span class=\"comment\"># æŒ‡å®šäº†ä¸€ä¸ªkeyï¼Œè¿”å›é›†åˆçš„æ‰€æœ‰å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; SINTER k60_1</span><br><span class=\"line\">1) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¤šä¸ªkeyçš„æ—¶å€™ï¼Œè¿”å›é›†åˆçš„äº¤é›†ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SINTER k60_1 k60_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¤šä¸ªkeyçš„æ—¶å€™ï¼Œè¿”å›é›†åˆçš„äº¤é›†ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SINTER k60_1 k60_2 k60_3</span><br><span class=\"line\">1) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># k60_4ä¸å­˜åœ¨ï¼Œä¸ºç©ºé›†</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SINTER k60_1 k60_4</span><br><span class=\"line\">(empty list or <span class=\"built_in\">set</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"sinterstore\"><a class=\"markdownIt-Anchor\" href=\"#sinterstore\">#</a>  <code>sinterstore</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SINTERSTORE destination key [key ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set intersection and store</code></p>\n<p>è¿™ä¸ªå‘½ä»¤ç±»ä¼¼äº SINTER key [key â€¦] å‘½ä»¤ï¼Œè¿”å›é›†åˆçš„äº¤é›†ã€‚ä½†å®ƒå°†ç»“æœä¿å­˜åˆ° destination é›†åˆï¼Œè€Œä¸æ˜¯ç®€å•åœ°è¿”å›ç»“æœé›†ã€‚</p>\n<p>å¦‚æœ destination é›†åˆå·²ç»å­˜åœ¨ï¼Œåˆ™å°†å…¶è¦†ç›–ã€‚</p>\n<p>destination å¯ä»¥æ˜¯ key æœ¬èº«ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k61_1 m1 m2 m3 m4 m5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k61_2 m4 m5 m6 m7 m8</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\"><span class=\"comment\"># å°†k61_1 å’Œ k61_2 é›†åˆçš„äº¤é›†å­˜å‚¨åˆ°k61_disä¸­</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SINTERSTORE k61_dis k61_1 k61_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ k61_dis</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k61_dis</span><br><span class=\"line\">1) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># k61_1 å’Œ k61_2 æ²¡æœ‰å˜åŒ–</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k61_1</span><br><span class=\"line\">1) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k61_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;m7&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m8&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœç›®æ ‡é›†åˆ(k61_dis)å­˜åœ¨ï¼Œå…ƒç´ ä¼šè¢«è¦†ç›–æ‰ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k61_3 m1 m2 m3 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SINTERSTORE k61_dis k61_1 k61_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k61_dis</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m3&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"sunion\"><a class=\"markdownIt-Anchor\" href=\"#sunion\">#</a>  <code>sunion</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SUNION key [key ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set union</code></p>\n<p>è¿”å›ä¸€ä¸ªé›†åˆçš„å…¨éƒ¨æˆå‘˜ï¼Œå¦‚æœæ˜¯å¤šä¸ªé›†åˆ (key), è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†ã€‚</p>\n<p>ä¸å­˜åœ¨çš„ key è¢«è§†ä¸ºç©ºé›†ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k62_1 m1 m2 m3 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k62_2 m2 m3 m4 m5 m6 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\"><span class=\"comment\"># ä¸€ä¸ªkeyï¼Œè¿”å›æ•´ä¸ªé›†åˆã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SUNION k62_1</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¤šä¸ªkeyï¼Œè¿”å›å¹¶é›†</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SUNION k62_1 k62_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;m4&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"sunionstore\"><a class=\"markdownIt-Anchor\" href=\"#sunionstore\">#</a>  <code>sunionstore</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SUNIONSTORE destination key [key ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set union and store</code></p>\n<p>åŒ SINTERSTORE , åªä¸è¿‡å­˜å‚¨çš„æ˜¯å¹¶é›†çš„ç»“æœã€‚ å°†å¤šä¸ªé›†åˆçš„å¹¶é›†å­˜å‚¨åˆ° distination ä¸­ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k63_1 m1 m2 m3 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k63_2 m2 m3 m4 m5 m6 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; SUNIONSTORE k63_dis k62_1 k62_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k63_dis</span><br><span class=\"line\">1) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;m4&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"sdiff\"><a class=\"markdownIt-Anchor\" href=\"#sdiff\">#</a>  <code>sdiff</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SDIFF key [key ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set difference</code></p>\n<p>å¦‚æœæŒ‡å®šä¸€ä¸ªé›†åˆï¼Œ <code>key</code> ï¼Œè¿”å›ä¸€ä¸ªé›†åˆçš„å…¨éƒ¨æˆå‘˜ï¼Œ</p>\n<p>å¦‚æœæŒ‡å®šäº†å¤šä¸ªé›†åˆ ( <code>key</code> ), åˆ™è¿”å› æ‰€æœ‰ç»™å®šé›†åˆä¹‹é—´çš„å·®é›†ã€‚</p>\n<p>ä¸å­˜åœ¨çš„  <code>key</code>  è¢«è§†ä¸ºç©ºé›†ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k64_1 m1 m2 m3 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k64_2 m2 m3 m4 m5 m6 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\"><span class=\"comment\"># è¿”å› k64_1 - k64_2</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SDIFF k64_1 k64_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å› k64_2 - k64_1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SDIFF k64_2 k64_1</span><br><span class=\"line\">1) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"sdiffstore\"><a class=\"markdownIt-Anchor\" href=\"#sdiffstore\">#</a>  <code>sdiffstore</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SDIFFSTORE destination key [key ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å°†é›†åˆçš„å·®é›†å­˜å‚¨åˆ°  <code>destination</code>  é›†åˆä¸­.</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SADD k65_1 m1 m2 m3 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SADD k65_2 m2 m3 m4 m5 m6 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; SDIFFSTORE k65_dis_1 k65_1 k65_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k65_dis_1</span><br><span class=\"line\">1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SDIFFSTORE k65_dis_2 k65_2 k65_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; SMEMBERS k65_dis_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;m5&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"sscan\"><a class=\"markdownIt-Anchor\" href=\"#sscan\">#</a>  <code>sscan</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>SSCAN key cursor [MATCH pattern] [COUNT count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>set scan</code></p>\n<p>è¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢å‘½ä»¤ã€‚ åŒ  <code>SCAN</code>  å‘½ä»¤ã€‚å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href=\"./010-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4.md\">010 - å…¶ä»–å‘½ä»¤</a></p>\n<p><code>SCAN</code>  å‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼ˆ <code>cursor based iterator</code> ï¼‰ï¼š  <code>SCAN</code>  å‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨ä¹‹åï¼Œ éƒ½ä¼šå‘ç”¨æˆ·è¿”å›ä¸€ä¸ªæ–°çš„æ¸¸æ ‡ï¼Œ ç”¨æˆ·åœ¨ä¸‹æ¬¡è¿­ä»£æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–°æ¸¸æ ‡ä½œä¸º  <code>SCAN</code>  å‘½ä»¤çš„æ¸¸æ ‡å‚æ•°ï¼Œ ä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; SSCAN k66 1</span><br><span class=\"line\">1) <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">   5) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SSCAN k66 0</span><br><span class=\"line\">1) <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;m6&quot;</span></span><br><span class=\"line\">   2) <span class=\"string\">&quot;m1&quot;</span></span><br><span class=\"line\">   3) <span class=\"string\">&quot;m3&quot;</span></span><br><span class=\"line\">   4) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">   5) <span class=\"string\">&quot;m4&quot;</span></span><br><span class=\"line\">   6) <span class=\"string\">&quot;m5&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; SSCAN k66 1 MATCH m2 Count 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">2) 1) <span class=\"string\">&quot;m2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h2 id=\"setçš„å†…éƒ¨ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#setçš„å†…éƒ¨ç»“æ„\">#</a>  <code>set</code>  çš„å†…éƒ¨ç»“æ„</h2>\n<p>åœ¨ t_set.c è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">robj *<span class=\"title\">setTypeCreate</span><span class=\"params\">(sds value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">isSdsRepresentableAsLongLong</span>(value,<span class=\"literal\">NULL</span>) == C_OK)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">createIntsetObject</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">createSetObject</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¡¨æ˜ï¼Œ <code>set</code>  æ•°æ®ç±»å‹æ˜¯ç”±ä¸¤ç§æ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚</p>\n<p>è€Œåœ¨  <code>createSetObject()</code> ï¼ŒæŒ‡æ˜äº†å…¶ç¼–ç æ–¹å¼æ˜¯  <code>OBJ_ENCODING_HT</code> , å³å“ˆå¸Œè¡¨çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ dict è¿™ç§æ•°æ®ç»“æ„æ¥å­˜å‚¨çš„ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">robj *<span class=\"title\">createSetObject</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\">    dict *d = <span class=\"built_in\">dictCreate</span>(&amp;setDictType, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    robj *o = <span class=\"built_in\">createObject</span>(OBJ_SET, d);</span><br><span class=\"line\">    o-&gt;encoding = OBJ_ENCODING_HT;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"hashtable\"><a class=\"markdownIt-Anchor\" href=\"#hashtable\">#</a>  <code>hashtable</code></h3>\n<p>è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ç›´æ¥ä¸Š<a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/\">ç©¿æ¢­æœº</a>å§ã€‚</p>\n<h3 id=\"intset\"><a class=\"markdownIt-Anchor\" href=\"#intset\">#</a> intset</h3>\n<p>åœ¨ <code>createIntsetObject()</code>  ä¸­æŒ‡æ˜äº†ä½¿ç”¨çš„ç¼–ç æ–¹å¼æ˜¯  <code>OBJ_ENCODING_INTSET</code> . å¦‚ä¸‹ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">robj *<span class=\"title\">createIntsetObject</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\">    intset *is = <span class=\"built_in\">intsetNew</span>();</span><br><span class=\"line\">    robj *o = <span class=\"built_in\">createObject</span>(OBJ_SET, is);</span><br><span class=\"line\">    o-&gt;encoding = OBJ_ENCODING_INTSET;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬æ¥çœ‹çœ‹  <code>intset</code>  åˆ°åº•ä»€ä¹ˆä½•æ–¹åˆ©å™¨.</p>\n<p>æˆ‘ç›´æ¥å…¨é¡¹ç›®æœç´¢:  <code>intset</code>  ï¼Œå°±æ‰¾åˆ°äº†  <code>intset.h</code> .</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">intset</span> &#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">uint32_t</span> encoding; </span><br><span class=\"line\">    <span class=\"keyword\">uint32_t</span> length;</span><br><span class=\"line\">    <span class=\"keyword\">int8_t</span> contents[];</span><br><span class=\"line\">&#125; intset;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å­—æ®µè§£é‡Š\"><a class=\"markdownIt-Anchor\" href=\"#å­—æ®µè§£é‡Š\">#</a> å­—æ®µè§£é‡Š:</h4>\n<ul>\n<li><code>encoding</code> : æ•°æ®ç¼–ç ï¼Œè¡¨ç¤º <code>intset</code>  ä¸­çš„æ¯ä¸ªæ•°æ®å…ƒç´ ç”¨å‡ ä¸ªå­—èŠ‚æ¥å­˜å‚¨ã€‚å®ƒæœ‰ä¸‰ç§å¯èƒ½çš„å–å€¼ï¼š <code>INTSET_ENC_INT16</code>  è¡¨ç¤ºæ¯ä¸ªå…ƒç´ ç”¨ <code>2</code>  ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œ <code>INTSET_ENC_INT32</code>  è¡¨ç¤ºæ¯ä¸ªå…ƒç´ ç”¨ <code>4</code>  ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œ <code>INTSET_ENC_INT64</code>  è¡¨ç¤ºæ¯ä¸ªå…ƒç´ ç”¨ <code>8</code>  ä¸ªå­—èŠ‚å­˜å‚¨ã€‚å› æ­¤ï¼Œ <code>intset</code>  ä¸­å­˜å‚¨çš„æ•´æ•°æœ€å¤šåªèƒ½å ç”¨ <code>64bit</code> ã€‚</li>\n<li><code>length</code> : è¡¨ç¤º <code>intset</code>  ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚ <code>encoding</code>  å’Œ <code>length</code>  ä¸¤ä¸ªå­—æ®µæ„æˆäº† <code>intset</code>  çš„å¤´éƒ¨ï¼ˆ <code>header</code> ï¼‰ã€‚</li>\n<li><code>contents</code> : æ˜¯ä¸€ä¸ªæŸ”æ€§æ•°ç»„ï¼ˆ <code>flexible array member</code> ï¼‰ï¼Œè¡¨ç¤º <code>intset</code>  çš„ <code>header</code>  åé¢ç´§è·Ÿç€æ•°æ®å…ƒç´ ã€‚è¿™ä¸ªæ•°ç»„çš„æ€»é•¿åº¦ï¼ˆå³æ€»å­—èŠ‚æ•°ï¼‰ç­‰äº <code>encoding * length</code> ã€‚æŸ”æ€§æ•°ç»„åœ¨ <code>Redis</code>  çš„å¾ˆå¤šæ•°æ®ç»“æ„çš„å®šä¹‰ä¸­éƒ½å‡ºç°è¿‡ï¼ˆä¾‹å¦‚ <code>sds</code> ,  <code>quicklist</code> ,  <code>skiplist</code> ï¼‰ï¼Œç”¨äºè¡¨è¾¾ä¸€ä¸ªåç§»é‡ã€‚ <code>contents</code>  éœ€è¦å•ç‹¬ä¸ºå…¶åˆ†é…ç©ºé—´ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä¸åŒ…å«åœ¨ <code>intset</code>  ç»“æ„å½“ä¸­ã€‚</li>\n</ul>\n<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜.</p>\n<p>Redis æ˜¯å¦‚ä½•å†³å®šä¸€ä¸ª set ä½¿ç”¨å“ªç§ç¼–ç æ–¹å¼çš„å‘¢ï¼Ÿ</p>\n<p>set çš„ç¼–ç æ˜¯ç”±ç¬¬ä¸€ä¸ªå…ƒç´ å†³å®šçš„ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">robj *<span class=\"title\">setTypeCreate</span><span class=\"params\">(sds value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">isSdsRepresentableAsLongLong</span>(value,<span class=\"literal\">NULL</span>) == C_OK)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">createIntsetObject</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">createSetObject</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">isSdsRepresentableAsLongLong</span><span class=\"params\">(sds s, <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> *llval)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">string2ll</span>(s, <span class=\"built_in\">sdslen</span>(s), llval) ? C_OK : C_ERR;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚æœ  <code>value</code>  å¯ä»¥è½¬æ¢æˆ  <code>long long</code>  ç±»å‹çš„è¯ï¼Œå°±ä½¿ç”¨  <code>inset</code>  ç¼–ç æ–¹å¼ã€‚</p>\n<p>é€šè¿‡çœ‹æºç å‘ç°:</p>\n<p>å½“ <code>intset</code>  çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡  <code>set_max_intset_entries</code>  è¿™ä¸ªé…ç½®çš„æ—¶å€™ï¼Œå°±ä¼šä» <code>intset</code>  ç¼–ç  ( <code>OBJ_ENCODING_INTSET</code> ) è½¬æ¢æˆ  <code>ht</code>  ç¼–ç  ( <code>OBJ_ENCODING_HT</code> )ã€‚</p>\n<p>è¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨åç»­æ–‡ç« ä¸­è¯´æ˜è¿™é‡Œçš„æ–¹æ¡ˆã€‚</p>\n<p>å¥½äº†ï¼Œå…³äº set ç±»å‹çš„ä»‹ç»å°±åˆ°è¿™é‡Œäº†ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<ul>\n<li><code>set</code>  è¿™ç§ç±»å‹æ˜¯ä¸€ç§æ— é‡å¤å…ƒç´ çš„é›†åˆã€‚</li>\n<li><code>set</code>  çš„ä¸šåŠ¡åœºæ™¯å…³é”®å­—ï¼šå»é‡ï¼Œäº¤å¹¶å·®è¿ç®—ã€‚ä½†æ˜¯ä¸€å®šæ˜¯æ— åºçš„ã€‚å¦‚æœè¦æ±‚æœ‰åºçš„è¯ï¼Œé‚£å°± <a href=\"./09-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset.md\">ä¸‹ä¸€ç¯‡æ–‡ç«   zset</a> ~</li>\n<li><code>set</code>  çš„  <code>15</code>  ä¸ªå‘½ä»¤ï¼ŒåŠ¡å¿…ç†Ÿè®°ï¼ï¼ï¼</li>\n<li><code>set</code>  çš„å†…éƒ¨ç¼–ç æ–¹å¼ã€‚å“ˆå¸Œè¡¨ç¼–ç å’Œ <code>intset</code>  ç¼–ç ã€‚åé¢ä¼šæœ‰ å…³äº  <code>intset</code>  æ•°æ®ç»“æ„çš„è¯¦ç»†ä»‹ç»çš„æ–‡ç« ï½</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹ Hash",
            "date_published": "2021-08-01T07:18:55.000Z",
            "content_html": "<h2 id=\"ä¹¦æ¥ä¸Šå›\"><a class=\"markdownIt-Anchor\" href=\"#ä¹¦æ¥ä¸Šå›\">#</a> ä¹¦æ¥ä¸Šå›</h2>\n<p>å‰ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å­¦ä¹ çš„æ˜¯ <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-2-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist/\">Redis çš„æ•°æ®ç»“æ„ list</a>ï¼Œ å­¦ä¹ äº†å…¶åŸºæœ¬çš„æ“ä½œå’Œä½¿ç”¨å†…éƒ¨æ•°æ®ç»“æ„æ˜¯ <code>quicklist</code>  å’Œ <code>ziplist</code> ï¼Œè¿™ä¸¤ç§æ•°æ®ç»“æ„è™½ç„¶èµ·å¾—åå­—æ˜¯ <code>list</code> ï¼Œä½†æ˜¯å…¶å†…éƒ¨ç»“æ„å´æ˜¯é“¾è¡¨ã€‚å¦‚æœä¸è®°å¾—äº†å…¶å†…éƒ¨æ„æˆï¼Œå°±å†çœ‹çœ‹çœ‹ç€<a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-2-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist/\">ä¸Šç¯‡æ–‡ç« </a>å§ã€‚ç°åœ¨æˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸‹ä¸€ä¸ªæ•°æ®ç±»å‹  <code>hash</code></p>\n<h2 id=\"hashç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#hashç®€ä»‹\">#</a>  <code>hash</code>  ç®€ä»‹</h2>\n<p><code>hash</code>  æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚æ˜¯  <code>string</code>  ç±»å‹çš„  <code>key</code>  å’Œ  <code>value</code>  çš„æ˜ å°„è¡¨ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œæ¯ä¸ª <code>hash</code>  ç±»å‹å¯ä»¥å­˜å‚¨  <code>2^32-1</code>  ä¸ªé”®å€¼å¯¹ã€‚</p>\n<p><code>hash</code>  å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª å“ˆå¸Œè¡¨ã€‚ç±»ä¼¼äº  <code>Java</code>  é‡Œçš„ <code>HashTable</code> ã€‚</p>\n<p>ä½†æ˜¯  <code>Redis</code>  çš„å“ˆå¸Œæ˜¯æœ‰ä¸¤ç§æ•°æ®ç»“æ„ (å†…éƒ¨ç¼–ç ) æ¥è¡¨ç¤ºçš„ã€‚</p>\n<ul>\n<li>\n<p>ä¸€ç§æ˜¯  <code>ziplist</code>  , ä¸Šç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ç®€å•çš„ä»‹ç»äº† <code>ziplist</code>  çš„å†…éƒ¨æ„æˆï¼Œè§ <a href=\"./06-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist.md\">Redis çš„æ•°æ®ç»“æ„ list</a>, ä»¥åŠ <code>ziplist</code>  çš„ç¼–ç æ–¹å¼ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/C-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8Bziplist/\">10-Redis çš„æ•°æ®ç»“æ„ä¹‹ ziplist.md</a>. é‚£ä¹ˆ  <code>Redis</code>  ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨ <code>ziplist</code>  è¿™ç§ç¼–ç æ–¹å¼å‘¢ï¼Ÿ</p>\n<ul>\n<li>å½“  <code>hash</code>  ç±»å‹çš„å…ƒç´ çš„ä¸ªæ•°å°äº  <code>hash-max-ziplist-enties</code>  é…ç½®ï¼Œé»˜è®¤ <code>512</code> .</li>\n<li>æ‰€æœ‰çš„å€¼éƒ½å°äº <code>hash-max-ziplist-value</code>  çš„å€¼ï¼Œé»˜è®¤æ˜¯ <code>64</code>  ä¸ªå­—èŠ‚çš„æ—¶å€™ã€‚<br>\nå½“åŒæ—¶æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ï¼Œ å°±ä¼šä½¿ç”¨  <code>ziplist</code>  è¿™ç§ç»“æ„ã€‚</li>\n</ul>\n</li>\n</ul>\n<p>è¿™ç§æ–¹å¼æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯èŠ‚çº¦ç©ºé—´ã€‚</p>\n<ul>\n<li>å¦ä¸€ç§å°±æ˜¯ä½¿ç”¨  <code>hashtable</code>  æ¥ç¼–ç äº†ã€‚å½“ä¸æ»¡è¶³ä¸Šé¢æåŠçš„ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå°±ä¼šä½¿ç”¨  <code>hashtable</code>  æ¥ç¼–ç ã€‚å®é™…ä¸Šæ˜¯  <code>dict</code>  è¿™ç§æ•°æ®ç»“æ„ã€‚è¿™é‡Œæˆ‘ä»¬åˆå¯ä»¥å­¦ä¹ åˆ°ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„  <code>dict</code></li>\n</ul>\n<h2 id=\"hashçš„åº”ç”¨åœºæ™¯\"><a class=\"markdownIt-Anchor\" href=\"#hashçš„åº”ç”¨åœºæ™¯\">#</a> hash çš„åº”ç”¨åœºæ™¯</h2>\n<ul>\n<li>ç¼“å­˜å¯¹è±¡ä¿¡æ¯ï¼šå¯¹è±¡çš„æ¯ä¸ªå±æ€§å¯¹åº”ç€ <code>hash</code>  çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚æ”¹å˜çš„æ—¶å€™ï¼Œåªéœ€è¦æ”¹å˜å¯¹åº”çš„æŸä¸ª <code>filed-value</code>  å³å¯ã€‚</li>\n<li>ç¼“å­˜è´­ç‰©è½¦çš„ä¿¡æ¯ï¼šç”¨æˆ·çš„ <code>id</code>  ä¸º <code>key</code> ï¼Œ å•†å“çš„ <code>id</code>  ä¸º  <code>field</code> . å•†å“çš„æ•°é‡ä¸º <code>value</code> ã€‚ æ¯”å¦‚:  <code>hset userId productId productCount</code></li>\n</ul>\n<h2 id=\"hashçš„åŸºæœ¬å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#hashçš„åŸºæœ¬å‘½ä»¤\">#</a>  <code>hash</code>  çš„åŸºæœ¬å‘½ä»¤</h2>\n<h3 id=\"hset\"><a class=\"markdownIt-Anchor\" href=\"#hset\">#</a>  <code>hset</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>hset key field value</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å°†å“ˆå¸Œè¡¨  <code>hash</code>  ä¸­åŸŸ  <code>field</code>  çš„å€¼è®¾ç½®ä¸º  <code>value</code>  ã€‚</p>\n<p>å¦‚æœç»™å®šçš„å“ˆå¸Œè¡¨å¹¶ä¸å­˜åœ¨ï¼Œ é‚£ä¹ˆä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨å°†è¢«åˆ›å»ºå¹¶æ‰§è¡Œ  <code>HSET</code>  æ“ä½œã€‚</p>\n<p>å¦‚æœåŸŸ  <code>field</code>  å·²ç»å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œ é‚£ä¹ˆå®ƒçš„æ—§å€¼å°†è¢«æ–°å€¼  <code>value</code>  è¦†ç›–ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## è®¾ç½®ä¸€ä¸ªhashç»“æ„</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k38 f1 v38</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># è·å–ä¸€ä¸ªå­—æ®µ</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HGET k38 f1</span><br><span class=\"line\"><span class=\"string\">&quot;v38&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å€¼, æ³¨æ„è¿”å›çš„å€¼ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k38 f1 v38v38</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; HGET k38 f1</span><br><span class=\"line\"><span class=\"string\">&quot;v38v38&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hsetnx\"><a class=\"markdownIt-Anchor\" href=\"#hsetnx\">#</a>  <code>hsetnx</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HSETNX key field value</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å½“ä¸”ä»…å½“åŸŸ  <code>field</code>  å°šæœªå­˜åœ¨äºå“ˆå¸Œè¡¨çš„æƒ…å†µä¸‹ï¼Œ å°†å®ƒçš„å€¼è®¾ç½®ä¸º  <code>value</code>  ã€‚</p>\n<p>å¦‚æœç»™å®šåŸŸå·²ç»å­˜åœ¨äºå“ˆå¸Œè¡¨å½“ä¸­ï¼Œ é‚£ä¹ˆå‘½ä»¤å°†æ”¾å¼ƒæ‰§è¡Œè®¾ç½®æ“ä½œã€‚</p>\n<p>å¦‚æœå“ˆå¸Œè¡¨  <code>hash</code>  ä¸å­˜åœ¨ï¼Œ é‚£ä¹ˆä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨å°†è¢«åˆ›å»ºå¹¶æ‰§è¡Œ  <code>HSETNX</code>  å‘½ä»¤ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„ key</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HSETNX k39 f1 v39</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HGET k39 f1</span><br><span class=\"line\"><span class=\"string\">&quot;v39&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡è®¾ç½®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HSETNX k39 f1 v39v39</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; HGET k39 f1</span><br><span class=\"line\"><span class=\"string\">&quot;v39&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hget\"><a class=\"markdownIt-Anchor\" href=\"#hget\">#</a>  <code>hget</code></h3>\n<p>è¿™ä¸ªå‘½ä»¤ä¸Šé¢å·²ç»ç”¨åˆ°äº†ã€‚è¿™é‡Œå°±ä¸æµªè´¹æ—¶é—´äº†ã€‚</p>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HGET key field</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è·å–å¯¹åº”çš„  <code>key</code>  ä¸‹çš„åŸŸ  <code>field</code>  çš„å€¼ã€‚ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›  <code>nil</code></p>\n<h3 id=\"hgetall\"><a class=\"markdownIt-Anchor\" href=\"#hgetall\">#</a>  <code>hgetall</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HGETALL key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›å“ˆå¸Œè¡¨  <code>key</code>  ä¸­ï¼Œæ‰€æœ‰çš„åŸŸå’Œå€¼ã€‚</p>\n<p>åœ¨è¿”å›å€¼é‡Œï¼Œç´§è·Ÿæ¯ä¸ªåŸŸå ( <code>field name</code> ) ä¹‹åæ˜¯åŸŸçš„å€¼ ( <code>value</code> )ï¼Œæ‰€ä»¥è¿”å›å€¼çš„é•¿åº¦æ˜¯å“ˆå¸Œè¡¨å¤§å°çš„ä¸¤å€ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HGETALL k39 </span><br><span class=\"line\">1) <span class=\"string\">&quot;f1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v39&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; hset k39 f2 v39_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HGETALL k39 </span><br><span class=\"line\">1) <span class=\"string\">&quot;f1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v39&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;f2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;v39_2&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hexists\"><a class=\"markdownIt-Anchor\" href=\"#hexists\">#</a>  <code>hexists</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code> HEXISTS key field</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>æ£€æŸ¥ç»™å®šåŸŸ  <code>field</code>  æ˜¯å¦å­˜åœ¨äºå“ˆå¸Œè¡¨  <code>hash</code>  å½“ä¸­ã€‚</p>\n<p>å­˜åœ¨è¿”å› <code>1</code> , ä¸å­˜åœ¨è¿”å› <code>0</code> ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HEXISTS k40 f1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k40 f1 v40</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HEXISTS k40 f1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"del\"><a class=\"markdownIt-Anchor\" href=\"#del\">#</a>  <code>del</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HDEL key field [field ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>åˆ é™¤å“ˆå¸Œè¡¨ key ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šåŸŸï¼Œä¸å­˜åœ¨çš„åŸŸå°†è¢«å¿½ç•¥ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HSET k41 f1 v41_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k41 f2 v41_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k41 f3 v41_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HGETALL k41</span><br><span class=\"line\">1) <span class=\"string\">&quot;f1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v41_1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;f2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;v41_2&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;f3&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;v41_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HDEL k41 f1 f3 f4 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; HGETALL k41</span><br><span class=\"line\">1) <span class=\"string\">&quot;f2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v41_2&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hlen\"><a class=\"markdownIt-Anchor\" href=\"#hlen\">#</a>  <code>hlen</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HLEN key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›å“ˆå¸Œè¡¨  <code>key</code>  ä¸­åŸŸçš„æ•°é‡ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HSET k42 f1 v42_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k42 f2 v42_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k42 f3 v42_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; hlen k42</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br></pre></td></tr></table></figure>\n<h3 id=\"hstrlen\"><a class=\"markdownIt-Anchor\" href=\"#hstrlen\">#</a>  <code>hstrlen</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HSTRLEN key field</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›å“ˆå¸Œè¡¨  <code>key</code>  ä¸­ï¼Œ ä¸ç»™å®šåŸŸ  <code>field</code>  ç›¸å…³è”çš„å€¼çš„å­—ç¬¦ä¸²é•¿åº¦ï¼ˆ <code>string length</code> ï¼‰ã€‚</p>\n<p>å¦‚æœç»™å®šçš„é”®æˆ–è€…åŸŸä¸å­˜åœ¨ï¼Œ é‚£ä¹ˆå‘½ä»¤è¿”å›  <code>0</code>  ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HSET k43 f1 <span class=\"string\">&quot;Hello World&quot;</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HSTRLEN k43 f1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 11</span><br><span class=\"line\">127.0.0.1:6379&gt; HSTRLEN k43 f2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br></pre></td></tr></table></figure>\n<h3 id=\"hincrby\"><a class=\"markdownIt-Anchor\" href=\"#hincrby\">#</a> hincrby</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HINCRBY key field increment</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>ä¸ºå“ˆå¸Œè¡¨  <code>key</code>  ä¸­çš„åŸŸ  <code>field</code>  çš„å€¼åŠ ä¸Šå¢é‡  <code>increment</code>  ã€‚</p>\n<p>å¢é‡ä¹Ÿå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œç›¸å½“äºå¯¹ç»™å®šåŸŸè¿›è¡Œå‡æ³•æ“ä½œã€‚</p>\n<p>å¦‚æœ  <code>key</code>  ä¸å­˜åœ¨ï¼Œä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨è¢«åˆ›å»ºå¹¶æ‰§è¡Œ  <code>HINCRBY</code>  å‘½ä»¤ã€‚</p>\n<p>å¦‚æœåŸŸ  <code>field</code>  ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå‘½ä»¤å‰ï¼ŒåŸŸçš„å€¼è¢«åˆå§‹åŒ–ä¸º  <code>0</code>  ã€‚</p>\n<p>å¯¹ä¸€ä¸ªå‚¨å­˜å­—ç¬¦ä¸²å€¼çš„åŸŸ  <code>field</code>  æ‰§è¡Œ  <code>HINCRBY</code>  å‘½ä»¤å°†é€ æˆä¸€ä¸ªé”™è¯¯ã€‚</p>\n<p>æœ¬æ“ä½œçš„å€¼è¢«é™åˆ¶åœ¨  <code>64</code>  ä½ ( <code>bit</code> ) æœ‰ç¬¦å·æ•°å­—è¡¨ç¤ºä¹‹å†…ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸å­˜åœ¨çš„keyä¸åŸŸ field</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HINCRBY k45 f1 100</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 100</span><br><span class=\"line\">127.0.0.1:6379&gt; HINCRBY k45 f1 -200</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) -100</span><br><span class=\"line\">127.0.0.1:6379&gt; HINCRBY k45 f1 200</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 100</span><br><span class=\"line\"><span class=\"comment\"># é”™è¯¯çš„ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k45 f2 v45</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; HINCRBY k45 f2 100</span><br><span class=\"line\">(error) ERR <span class=\"built_in\">hash</span> value is not an <span class=\"built_in\">integer</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hincrbyfloat\"><a class=\"markdownIt-Anchor\" href=\"#hincrbyfloat\">#</a>  <code>hincrbyfloat</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HINCRBYFLOAT  key field increment</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>ä¸ºå“ˆå¸Œè¡¨  <code>key</code>  ä¸­çš„åŸŸ  <code>field</code>  åŠ ä¸Šæµ®ç‚¹æ•°å¢é‡  <code>increment</code>  ã€‚</p>\n<p>å¦‚æœå“ˆå¸Œè¡¨ä¸­æ²¡æœ‰åŸŸ  <code>field</code>  ï¼Œé‚£ä¹ˆ  <code>HINCRBYFLOAT</code>  ä¼šå…ˆå°†åŸŸ  <code>field</code>  çš„å€¼è®¾ä¸º  <code>0</code>  ï¼Œç„¶åå†æ‰§è¡ŒåŠ æ³•æ“ä½œã€‚</p>\n<p>å¦‚æœé”®  <code>key</code>  ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ  <code>HINCRBYFLOAT</code>  ä¼šå…ˆåˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå†åˆ›å»ºåŸŸ  <code>field</code>  ï¼Œæœ€åå†æ‰§è¡ŒåŠ æ³•æ“ä½œã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HINCRBYFLOAT  k46 f1 100.5</span><br><span class=\"line\"><span class=\"string\">&quot;100.5&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HINCRBYFLOAT  k46 f1 100.5</span><br><span class=\"line\"><span class=\"string\">&quot;201&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HINCRBYFLOAT  k46 f1 -100.5</span><br><span class=\"line\"><span class=\"string\">&quot;100.5&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; HSET k46 f2 v46_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<h3 id=\"hmset\"><a class=\"markdownIt-Anchor\" href=\"#hmset\">#</a>  <code>hmset</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HMSET key field value [field value ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>åŒæ—¶å°†å¤šä¸ª  <code>field-value</code>  (åŸŸ - å€¼) å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨  <code>key</code>  ä¸­ã€‚</p>\n<p>æ­¤å‘½ä»¤ä¼šè¦†ç›–å“ˆå¸Œè¡¨ä¸­å·²å­˜åœ¨çš„åŸŸã€‚</p>\n<p>å¦‚æœ  <code>key</code>  ä¸å­˜åœ¨ï¼Œä¸€ä¸ªç©ºå“ˆå¸Œè¡¨è¢«åˆ›å»ºå¹¶æ‰§è¡Œ  <code>HMSET</code>  æ“ä½œã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HMSET k47  f1 v47_1 f2 v47_2 f3 v47_3</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; HGETALL k47</span><br><span class=\"line\">1) <span class=\"string\">&quot;f1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v47_1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;f2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;v47_2&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;f3&quot;</span></span><br><span class=\"line\">6) <span class=\"string\">&quot;v47_3&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hmget\"><a class=\"markdownIt-Anchor\" href=\"#hmget\">#</a>  <code>hmget</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HMGET key field [field ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›å“ˆå¸Œè¡¨  <code>key</code>  ä¸­ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªç»™å®šåŸŸçš„å€¼ã€‚</p>\n<p>å¦‚æœç»™å®šçš„åŸŸä¸å­˜åœ¨äºå“ˆå¸Œè¡¨ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ª  <code>nil</code>  å€¼ã€‚</p>\n<p>å› ä¸ºä¸å­˜åœ¨çš„  <code>key</code>  è¢«å½“ä½œä¸€ä¸ªç©ºå“ˆå¸Œè¡¨æ¥å¤„ç†ï¼Œæ‰€ä»¥å¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„  <code>key</code>  è¿›è¡Œ  <code>HMGET</code>  æ“ä½œå°†è¿”å›ä¸€ä¸ªåªå¸¦æœ‰  <code>nil</code>  å€¼çš„è¡¨ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HMSET k48 f1 v1 f2 v2 f3 v3 f4 v4</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; hmget k48 f1 f3 f4</span><br><span class=\"line\">1) <span class=\"string\">&quot;v1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v3&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v4&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h3 id=\"hkeys\"><a class=\"markdownIt-Anchor\" href=\"#hkeys\">#</a>  <code>hkeys</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HKEYS key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›å“ˆå¸Œè¡¨  <code>key</code>  ä¸­çš„æ‰€æœ‰åŸŸã€‚</p>\n<p>å½“  <code>key</code>  ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›ä¸€ä¸ªç©ºè¡¨ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HMSET k49 f1 v1 f2 v2 f3 v3 f4 v4</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; HKEYS k49</span><br><span class=\"line\">1) <span class=\"string\">&quot;f1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;f2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;f3&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;f4&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hvals\"><a class=\"markdownIt-Anchor\" href=\"#hvals\">#</a>  <code>hvals</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HVALS key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›  <code>key</code>  å¯¹åº”çš„æ‰€æœ‰çš„ <code>value</code></p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HMSET k50 f1 v1 f2 v2 f3 v3 f4 v4 </span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; HVALS k50</span><br><span class=\"line\">1) <span class=\"string\">&quot;v1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v3&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;v4&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"hscan\"><a class=\"markdownIt-Anchor\" href=\"#hscan\">#</a>  <code>hscan</code></h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>HSCAN key cursor [MATCH pattern] [COUNT count]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢å‘½ä»¤ã€‚ åŒ SCAN å‘½ä»¤ã€‚å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href=\"./010-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4.md\">010 - å…¶ä»–å‘½ä»¤</a></p>\n<p><code>SCAN</code>  å‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼ˆ <code>cursor based iterator</code> ï¼‰ï¼š  <code>SCAN</code>  å‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨ä¹‹åï¼Œ éƒ½ä¼šå‘ç”¨æˆ·è¿”å›ä¸€ä¸ªæ–°çš„æ¸¸æ ‡ï¼Œ ç”¨æˆ·åœ¨ä¸‹æ¬¡è¿­ä»£æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–°æ¸¸æ ‡ä½œä¸º  <code>SCAN</code>  å‘½ä»¤çš„æ¸¸æ ‡å‚æ•°ï¼Œ ä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; HMSET k51  f1 v1 f2 v2 f3 v3 f4 v4 f5 v5 f6 v6 f7 v7 f8 v8</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; hscan k51 0 </span><br><span class=\"line\">1) <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">2)  1) <span class=\"string\">&quot;f1&quot;</span></span><br><span class=\"line\">    2) <span class=\"string\">&quot;v1&quot;</span></span><br><span class=\"line\">    3) <span class=\"string\">&quot;f2&quot;</span></span><br><span class=\"line\">    4) <span class=\"string\">&quot;v2&quot;</span></span><br><span class=\"line\">    5) <span class=\"string\">&quot;f3&quot;</span></span><br><span class=\"line\">    6) <span class=\"string\">&quot;v3&quot;</span></span><br><span class=\"line\">    7) <span class=\"string\">&quot;f4&quot;</span></span><br><span class=\"line\">    8) <span class=\"string\">&quot;v4&quot;</span></span><br><span class=\"line\">    9) <span class=\"string\">&quot;f5&quot;</span></span><br><span class=\"line\">   10) <span class=\"string\">&quot;v5&quot;</span></span><br><span class=\"line\">   11) <span class=\"string\">&quot;f6&quot;</span></span><br><span class=\"line\">   12) <span class=\"string\">&quot;v6&quot;</span></span><br><span class=\"line\">   13) <span class=\"string\">&quot;f7&quot;</span></span><br><span class=\"line\">   14) <span class=\"string\">&quot;v7&quot;</span></span><br><span class=\"line\">   15) <span class=\"string\">&quot;f8&quot;</span></span><br><span class=\"line\">   16) <span class=\"string\">&quot;v8&quot;</span></span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šï¼Œå°±æ˜¯  <code>Redis</code>  ä¸­ <code>hash</code>  ç±»å‹ç›¸å…³çš„ <code>15</code>  ä¸ªå‘½ä»¤äº†ã€‚åŠ¡å¿…ç†Ÿè®°ï½</p>\n<h2 id=\"hashçš„å†…éƒ¨ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#hashçš„å†…éƒ¨ç»“æ„\">#</a>  <code>hash</code>  çš„å†…éƒ¨ç»“æ„</h2>\n<p>åœ¨  <code>hash</code>  ç±»å‹ç®€ä»‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¯´è¿‡  <code>hash</code>  æ˜¯ç”¨ä¸¤ç§æ•°æ®ç»“æ„æ¥ç¼–ç çš„ã€‚</p>\n<ul>\n<li>\n<p><code>ziplist</code></p>\n</li>\n<li>\n<p><code>hashtable</code> ( <code>dict</code> )</p>\n</li>\n</ul>\n<p><code>ziplist</code>  ä¹‹å‰å·²ç»åˆ†äº«è¿‡äº†ã€‚å…·ä½“å‚è€ƒä¹‹å‰çš„æ–‡ç« å§ã€‚ <a href=\"./06-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist.md\">é“¾æ¥</a></p>\n<p>è¿™é‡Œæˆ‘ä»¬å°±ç®€å•çš„æ¥çœ‹ä¸‹  <code>hashtable</code> .</p>\n<p>æˆ‘ä»¬ç›´æ¥æœç´¢  <code>hash</code>  , å¯ä»¥å‘ç°  <code>t_hash.c</code>  è¿™ä¸ªæ–‡ä»¶ï¼Œå¼•å…¥äº†  <code>server.h</code>  . å¤§ä½“çœ‹äº†ä¸€ä¸‹ï¼Œéƒ½æ˜¯å‡½æ•°çš„å®ç°ã€‚é‚£æˆ‘ä»¬çœ‹ä¸‹  <code>server.h</code>  ï¼Œåº”è¯¥å­˜åœ¨å¯¹  <code>hastable</code>  çš„å®šä¹‰å§ã€‚ç„¶è€Œï¼Œå¹¶æ²¡æœ‰ã€‚</p>\n<p>é‚£æˆ‘ä»¬æ¥çœ‹ä¸‹ <code>t_hash.c</code>  ä¸­æ·»åŠ æ–¹æ³•çš„å®ç°å§.  <code>int hashTypeSet(robj *o, sds field, sds value, int flags)</code></p>\n<p>æºç å¤ªé•¿äº†ï¼Œè¿™é‡Œå°±ä¸ç²˜äº†ï¼Œ å¯ä»¥çœ‹<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vZmFuZ2ppYXhpYW9iYWkvcmVkaXMvYmxvYi9yZWRpczUuMF9jaGluZXNlX3RyYW5zbGF0ZS9zcmMvdF9oYXNoLmM=\">æºç </span></p>\n<p>é€šè¿‡æŸ¥çœ‹æºç å¯ä»¥å¾—å‡º:</p>\n<ul>\n<li><code>hash</code>  ç±»å‹çš„é»˜è®¤ç¼–ç æ˜¯  <code>OBJ_ZIPLIST</code> . å³é»˜è®¤æ˜¯ä½¿ç”¨  <code>ziplist</code>  è¿™ç§æ•°æ®ç»“æ„è¿›è¡Œç¼–ç å­˜å‚¨çš„ã€‚</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">robj *<span class=\"title\">createHashObject</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *zl = <span class=\"built_in\">ziplistNew</span>();</span><br><span class=\"line\">    robj *o = <span class=\"built_in\">createObject</span>(OBJ_HASH, zl);</span><br><span class=\"line\">    o-&gt;encoding = OBJ_ENCODING_ZIPLIST;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> o;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>å½“ <code>hash</code>  å…ƒç´ çš„ä¸ªæ•°å¤§äº  <code>hash_max_ziplist_entries</code>  æ—¶ä¼šï¼Œè½¬æ¢æˆ  <code>hashTable</code> ( <code>OBJ_ENCODING_HT</code> ),</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (<span class=\"built_in\">hashTypeLength</span>(o) &gt; server.hash_max_ziplist_entries)</span><br><span class=\"line\">            <span class=\"built_in\">hashTypeConvert</span>(o, OBJ_ENCODING_HT);</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>ä½†æ˜¯åœ¨  <code>redis 5.0.7</code>  ä¸­æš‚æ—¶ä¸æ”¯æŒè¿™ç§æ–¹å¼ï¼Œè¿˜æ²¡æœ‰å®ç°ã€‚(<b>æ²¡æœ‰å®ç°ä» <code>ziplist</code>  ç¼–ç è½¬åŒ–æˆ <code>hash</code>  ç¼–ç ã€‚</b>)</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">hashTypeConvert</span><span class=\"params\">(robj *o, <span class=\"keyword\">int</span> enc)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o-&gt;encoding == OBJ_ENCODING_ZIPLIST) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">hashTypeConvertZiplist</span>(o, enc);</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    <span class=\"comment\">/// è¿™é‡Œï¼ï¼ï¼</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (o-&gt;encoding == OBJ_ENCODING_HT) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">serverPanic</span>(<span class=\"string\">&quot;Not implemented&quot;</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">serverPanic</span>(<span class=\"string\">&quot;Unknown hash encoding&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>å½“åˆ›å»ºçš„ <code>hash</code>  ç±»å‹æ˜¯  <code>hashtable</code>  ç¼–ç  ( <code>OBJ_ENCODING_HT</code> ) æ—¶ï¼Œæ˜¯ä½¿ç”¨ <code>dict</code>  è¿™ç§ç±»å‹å­˜å‚¨çš„.</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// dictç±»å‹</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dict</span> &#123;</span></span><br><span class=\"line\">    dictType *type;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> *privdata;</span><br><span class=\"line\">    <span class=\"comment\">/// 2ä¸ªå“ˆå¸Œè¡¨æ¥å®ç°</span></span><br><span class=\"line\">    dictht ht[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"keyword\">long</span> rehashidx; <span class=\"comment\">/* rehashing not in progress if rehashidx == -1 */</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> iterators; <span class=\"comment\">/* number of iterators currently running */</span></span><br><span class=\"line\">&#125; dict;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// å“ˆå¸Œè¡¨å®ç°</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictht</span> &#123;</span></span><br><span class=\"line\">    dictEntry **table; <span class=\"comment\">/// å“ˆå¸Œè¡¨èŠ‚ç‚¹æŒ‡é’ˆæ•°æ®(javaæºç ä¸­çš„æ¡¶çš„æ¦‚å¿µ)</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> size; <span class=\"comment\">/// æŒ‡é’ˆæ•°ç»„çš„å¤§å°</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> sizemask; <span class=\"comment\">/// æŒ‡é’ˆæ•°æ®çš„é•¿åº¦æ©ç ,ç”¨äºè®¡ç®—ç´¢å¼•å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> used; <span class=\"comment\">/// å“ˆå¸Œè¡¨ç°æœ‰çš„èŠ‚ç‚¹æ•°é‡</span></span><br><span class=\"line\">&#125; dictht;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">///å“ˆå¸Œè¡¨çš„èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntry</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">/// é”®</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> *key;</span><br><span class=\"line\">    <span class=\"comment\">/// å€¼</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">union</span> &#123;</span></span><br><span class=\"line\">        <span class=\"keyword\">void</span> *val;</span><br><span class=\"line\">        <span class=\"keyword\">uint64_t</span> u64;</span><br><span class=\"line\">        <span class=\"keyword\">int64_t</span> s64;</span><br><span class=\"line\">        <span class=\"keyword\">double</span> d;</span><br><span class=\"line\">    &#125; v;</span><br><span class=\"line\">    <span class=\"comment\">/// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹: dictht æ˜¯ä½¿ç”¨é“¾åœ°å€æ³•æ¥å¤„ç†hashå†²çªã€‚</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntry</span> *<span class=\"title\">next</span>;</span></span><br><span class=\"line\">&#125; dictEntry;</span><br></pre></td></tr></table></figure>\n<p>æ•´ä¸ª  <code>dict</code>  ç»“æ„å°±å¯ä»¥è¿™ä¹ˆè¡¨ç¤º:</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/Redis-01-dict%E7%BB%93%E6%9E%84%E5%AD%98%E5%82%A8.png\" alt=\"Redis-01-dictç»“æ„å­˜å‚¨\"></p>\n<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†  <code>hash</code>  è¿™ç§ç±»å‹ï¼Œæ˜¯å¦‚ä½•å­˜å‚¨çš„äº†ã€‚ å¦‚æœä½ è¿˜æƒ³äº†è§£<br>\n <code>dict</code>  æ˜¯å¦‚ä½•  <code>rehash</code> , æ‰©å®¹ï¼Œç¼©å®¹ã€‚ä»¥åŠ  <code>dict api</code>  ç›¸å…³å®ç°çš„è¯ï¼Œç§»é©¾è¿™ç¯‡æ–‡ç« å§ã€‚ <a href=\"./Redis%E4%B8%AD%E7%9A%84dict%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.md\">èµ·é©¾ï½</a></p>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<ul>\n<li><code>hash</code>  ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œè¡¨ç»“æ„ã€‚é€šè¿‡ä¸¤ç§æ•°æ®ç»“æ„ <code>ziplist</code>  å’Œ  <code>hashtable</code> ( <code>dict</code> ) å®ç°ã€‚</li>\n<li>è¦ç†Ÿç»ƒæŒæ¡çš„  <code>hash</code>  ç›¸å…³çš„ <code>15</code>  ä¸ªå‘½ä»¤ã€‚</li>\n<li><code>hashtable</code>  çš„ç¼–ç æ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯ä½¿ç”¨çš„  <code>dict</code>  è¿™ç§ç¼–ç æ–¹å¼ã€‚æˆ‘ä»¬ç®€å•çš„å­¦ä¹ äº† <code>Redis</code>  ä¸­ <code>dict</code>  ç»“æ„çš„å®ç°ã€‚è¿˜æœ‰ä¸€ç¯‡ä¸“é—¨çš„æ–‡ç« ï¼Œæ¥ä»‹ç»  <code>dict</code>  çš„è¯¦ç»†å†…å®¹ã€‚</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-2-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-2-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹ List",
            "date_published": "2021-08-01T07:08:55.000Z",
            "content_html": "<h2 id=\"ä¹¦æ¥ä¸Šå›\"><a class=\"markdownIt-Anchor\" href=\"#ä¹¦æ¥ä¸Šå›\">#</a> ä¹¦æ¥ä¸Šå›</h2>\n<p>ä¸Šä¸€ç¯‡æ–‡ç«  <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BString/\">Redis çš„æ•°æ®ç»“æ„ string</a> æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†è¿™ç§ç±»å‹çš„å¸¸ç”¨å‘½ä»¤ï¼Œå¹¶ä¸”è¿˜å­¦ä¹ äº†  <code>Redis</code>  ä¸­çš„å­—ç¬¦ä¸²çš„ç»“æ„è¡¨ç¤ºä»¥åŠå¥½å¤„ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç€å­¦ä¹ å¦å¤–ä¸€ç§æ•°æ®ç»“æ„  <code>list</code> ã€‚</p>\n<h2 id=\"list-ç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#list-ç®€ä»‹\">#</a>  <code>list</code>  ç®€ä»‹</h2>\n<p><code>list</code> , ä¸€èˆ¬éƒ½ä¼šç§°ä¸ºåˆ—è¡¨ã€‚åœ¨ <code>Redis</code>  ä¸­ï¼Œè¿™ç§æ•°æ®ç»“æ„æ˜¯ä¸€ç§æ¯”è¾ƒçµæ´»çš„ç»“æ„ï¼Œç”±äºå…¶å…ƒç´ çš„æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥å……å½“æ ˆå’Œé˜Ÿåˆ—è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚å®é™…åœ¨å¼€å‘æ€»ä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ã€‚</p>\n<p>ä¸€ä¸ª <code>List</code>  æœ€å¤šå¯ä»¥åŒ…å«  <code>2^32-1</code>  ä¸ªå…ƒç´ ã€‚</p>\n<p>å¾ˆå¤šäººéƒ½ä¼šä»¥ä¸º <code>list</code>  æ˜¯ç”¨æ•°ç»„æ¥å®ç°çš„ï¼Œéä¹Ÿï¼Œéä¹Ÿã€‚å®ƒå†…éƒ¨æ˜¯ <code>quicklist</code>  è¿™ç§æ•°æ®ç»“æ„ã€‚æƒ³è¦å…ˆç¹ä¸ºå¿«çš„ï¼Œé‚£ä¹ˆå<a href=\"##%60list%60%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84%E4%B9%8B%60quicklist%60\">ç”µæ¢¯ç›´è¾¾</a>å§ã€‚</p>\n<h2 id=\"listçš„ç›¸å…³å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#listçš„ç›¸å…³å‘½ä»¤\">#</a>  <code>list</code>  çš„ç›¸å…³å‘½ä»¤</h2>\n<h3 id=\"lpushå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#lpushå‘½ä»¤\">#</a>  <code>LPUSH</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>LPUSH key value [value â€¦]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>lpush</code>  :  <code>left push</code> ã€‚</p>\n<p>å°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨ <code>key</code>  çš„è¡¨å¤´ï¼Œè¿”å›åˆ—è¡¨çš„é•¿åº¦ã€‚å…ƒç´ å¯ä»¥æ˜¯é‡å¤çš„ã€‚</p>\n<p>å¦‚æœ <code>key</code>  ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šå…ˆç©¿ä»¶ä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åå†æ‰§è¡Œ <code>push</code>  æ“ä½œ.</p>\n<p>å¦‚æœ <code>key</code>  å€¼å­˜åœ¨ï¼Œä½†æ˜¯ <code>value</code>  ç±»å‹ä¸æ˜¯åˆ—è¡¨ç±»å‹æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è®¾ç½®ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPUSH k22 v22</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥è¯¢æŒ‡å®šåŒºé—´å†…çš„æ•°æ®,ä½¿ç”¨lrangeå‘½ä»¤</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LRANGE k22 0 10</span><br><span class=\"line\">1) &quot;v22&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä¸€æ¬¡æ’å…¥å¤šä¸ªå€¼</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPUSH k22 v22_1 v22_2 v22_3 v22_4</span><br><span class=\"line\">(integer) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; LRANGE k22 0 10</span><br><span class=\"line\">1) &quot;v22_4&quot;</span><br><span class=\"line\">2) &quot;v22_3&quot;</span><br><span class=\"line\">3) &quot;v22_2&quot;</span><br><span class=\"line\">4) &quot;v22_1&quot;</span><br><span class=\"line\">5) &quot;v22&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"lpushx-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#lpushx-å‘½ä»¤\">#</a>  <code>lpushx</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>LPUSHX key value</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>ä»…å½“  <code>key</code>  å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰å°†  <code>value</code>  æ’å…¥åˆ—è¡¨çš„è¡¨å¤´ã€‚è¿”å›åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å½“keyå€¼ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œä¸ä¼šæ”¾å…¥åˆ—è¡¨ä¸­</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPUSHX k23 v23</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡å°è¯•æ”¾å…¥ï¼Œä¹Ÿä¸å¯ä»¥ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPUSHX k23 v23</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\"><span class=\"comment\"># å…ˆå¾€æ•°ç»„æ”¾å…¥ä¸€ä¸ªå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k23 v23</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡å°è¯•ä½¿ç”¨lpushxæ”¾å…¥æ•°æ®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPUSHX k23 v23_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"><span class=\"comment\"># å†æ¬¡å°è¯•ä½¿ç”¨lpushxæ”¾å…¥æ•°æ®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPUSHX k23 v23_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åˆ—è¡¨ k23 ä¸­çš„æ•°æ®ã€‚æ³¨æ„ï¼šå’Œæ’å…¥çš„é¡ºåºæ˜¯ç›¸åçš„ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; Lrange k23 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v23_2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v23_1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v23&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"rpush-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#rpush-å‘½ä»¤\">#</a>  <code>rpush</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>RPUSH key value [value ...]</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>rpush</code>  å°±æ˜¯ <code>right push</code> ã€‚å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼  <code>value</code>  æ’å…¥åˆ°åˆ—è¡¨  <code>key</code>  çš„è¡¨å°¾ (æœ€å³è¾¹)ã€‚è¿”å›åˆ—è¡¨çš„é•¿åº¦ã€‚</p>\n<p>å¦‚æœ  <code>key</code>  ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œç„¶ååœ¨æ‰§è¡Œ  <code>rpush</code>  æ“ä½œã€‚</p>\n<p>å¦‚æœ  <code>key</code>  å­˜åœ¨ï¼Œä½†æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ç±»å‹æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> å¾€åˆ—è¡¨ä¸­åŠ å…¥æ•°æ®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; RPUSH k24 v24</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; RPUSH k24 v24_1 v25_2 v25_3</span><br><span class=\"line\">(integer) 4</span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k24 0 -1</span><br><span class=\"line\">1) &quot;v24&quot;</span><br><span class=\"line\">2) &quot;v24_1&quot;</span><br><span class=\"line\">3) &quot;v25_2&quot;</span><br><span class=\"line\">4) &quot;v25_3&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æ¼”ç¤º key å­˜åœ¨ï¼Œä½†æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ç±»å‹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; set k24_1 v24_1</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; rpush k24_1 v24_1</span><br><span class=\"line\">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br></pre></td></tr></table></figure>\n<h3 id=\"rpushx-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#rpushx-å‘½ä»¤\">#</a>  <code>rpushx</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>rpushx key value</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>ä¸  <code>lpushx</code>  ç±»ä¼¼ï¼Œå¦‚æœ <code>key</code>  ä¸å­˜åœ¨æ—¶ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šæ“ä½œã€‚å¦‚æœ <code>key</code>  å­˜åœ¨ï¼Œæ‰ä¼šå°†å…ƒç´ æ·»åŠ åˆ°è¡¨å°¾ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œä¸ä¼šæ’å…¥æ•°æ®</span></span><br><span class=\"line\">127.0.0.1:6379&gt; rpushx k25 v25</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> å…ˆè®¾ç½®ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; rpush k25 v25_1</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; rpushx k25 v25_2</span><br><span class=\"line\">(integer) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; rpushx k25 v25_3</span><br><span class=\"line\">(integer) 3</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹åˆ—è¡¨ä¸­çš„æ•°æ®ã€‚æ³¨æ„å’Œæ’å…¥çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k25 0 -1</span><br><span class=\"line\">1) &quot;v25_1&quot;</span><br><span class=\"line\">2) &quot;v25_2&quot;</span><br><span class=\"line\">3) &quot;v25_3&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"lpop-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#lpop-å‘½ä»¤\">#</a>  <code>lpop</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>LPOP key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>left pop</code> ;</p>\n<p>ç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„å¤´å…ƒç´ ã€‚å½“ <code>key</code>  ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å› <code>nil</code></p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›nil</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPOP k26</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è®¾ç½®ä¸€ä¸ªåˆ—è¡¨ï¼Œæœ‰ä¸‰ä¸ªå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k26 v26_1 v26_2 v26_3</span><br><span class=\"line\">(integer) 3</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹åˆ—è¡¨ä¸­çš„å…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k26 0 -1</span><br><span class=\"line\">1) &quot;v26_3&quot;</span><br><span class=\"line\">2) &quot;v26_2&quot;</span><br><span class=\"line\">3) &quot;v26_1&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä¾æ¬¡popå‡ºå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpop k26</span><br><span class=\"line\">&quot;v26_3&quot;</span><br><span class=\"line\">127.0.0.1:6379&gt; lpop k26</span><br><span class=\"line\">&quot;v26_2&quot;</span><br><span class=\"line\">127.0.0.1:6379&gt; lpop k26</span><br><span class=\"line\">&quot;v26_1&quot;</span><br><span class=\"line\">127.0.0.1:6379&gt; lpop k26</span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>tipï¼š  <code>lpush</code>  +  <code>lpop</code>  =&gt; æ ˆï¼Œ <code>rpush</code>  +  <code>lpop</code>  =&gt; é˜Ÿåˆ—ã€‚</p>\n</blockquote>\n<h3 id=\"rpop-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#rpop-å‘½ä»¤\">#</a>  <code>rpop</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>rpop key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>rpop</code>  ï¼š  <code>right pop</code> ;</p>\n<p>å’Œ lpop ç›¸åã€‚ç§»é™¤å¹¶è¿”å›åˆ—è¡¨çš„å°¾å…ƒç´ ã€‚å¦‚æœ key ä¸å­˜åœ¨è¿”å› nilã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># key ä¸å­˜åœ¨ï¼Œè¿”å›nil</span></span><br><span class=\"line\">127.0.0.1:6379&gt; rpop k27</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"><span class=\"comment\"># å…ˆè®¾ç½®ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k27 v27_1 v27_2 v27_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k27 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v27_3&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v27_2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v27_1&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä¸€æ¬¡popæ¯ä¸ªå€¼</span></span><br><span class=\"line\">127.0.0.1:6379&gt; rpop k27</span><br><span class=\"line\"><span class=\"string\">&quot;v27_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; rpop k27</span><br><span class=\"line\"><span class=\"string\">&quot;v27_2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; rpop k27</span><br><span class=\"line\"><span class=\"string\">&quot;v27_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; rpop k27</span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>tip:  <code>lpush</code>  +  <code>rpop</code>  =&gt; é˜Ÿåˆ—ï¼Œ <code>rpush</code>  +  <code>rpop</code>  =&gt; æ ˆã€‚</p>\n</blockquote>\n<h3 id=\"lrange-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#lrange-å‘½ä»¤\">#</a>  <code>lrange</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>LRANGE key start stop</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è·å–æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ã€‚0 è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœè¶…è¿‡äº†å®é™…èŒƒå›´å°±è¿”å›ç©ºæ•°ç»„ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; LRANGE k22 0 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;v22_4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v22_3&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v22_2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;v22_1&quot;</span></span><br><span class=\"line\">5) <span class=\"string\">&quot;v22&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LRANGE k22 0 1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v22_4&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v22_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LRANGE k22 10 100</span><br><span class=\"line\">(empty list or <span class=\"built_in\">set</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"rpoplpush-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#rpoplpush-å‘½ä»¤\">#</a>  <code>rpoplpush</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>RPOPLPUSH source destination</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å°†  <code>source</code>  çš„å°¾å…ƒç´ æ’å…¥åˆ° <code>destination</code>  åˆ—è¡¨çš„å¤´å…ƒç´ ä¸­ï¼Œè¿”å›è¯¥å…ƒç´ ã€‚ æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚</p>\n<p>æ¯”å¦‚:  <code>source</code> :  <code>a,b,c</code></p>\n<p><code>distination</code> :  <code>1,2,3</code></p>\n<p>ä½¿ç”¨  <code>RPOPLPUSH source distination</code>  , åˆ™ï¼š</p>\n<p><code>source</code> :  <code>a,b</code></p>\n<p><code>distination</code> :  <code>c,1,2,3</code></p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®åˆ—è¡¨1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k28_1 v28_c v28_b v28_a</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®åˆ—è¡¨2</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k28_2 v28_3 v28_2 v28_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ rpoppushå‘½ä»¤</span></span><br><span class=\"line\">127.0.0.1:6379&gt; RPOPLPUSH k28_1 k28_2</span><br><span class=\"line\"><span class=\"string\">&quot;v28_c&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åˆ—è¡¨1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k28_1 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v28_a&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v28_b&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹åˆ—è¡¨2</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k28_2 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v28_c&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v28_1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v28_2&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;v28_3&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"lrem-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#lrem-å‘½ä»¤\">#</a>  <code>lrem</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>LREM key count value</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è‡³å¤šç§»é™¤åˆ—è¡¨ä¸­  <code>count</code>  ä¸ªä¸å‚æ•°  <code>value</code>  ç›¸ç­‰çš„å…ƒç´ ã€‚</p>\n<p>æœ‰ä»¥ä¸‹æƒ…æ³:</p>\n<p><code>count &gt; 0</code>  : ä»è¡¨å¤´å¼€å§‹å‘è¡¨å°¾æœç´¢ï¼Œç§»é™¤ä¸  <code>value</code>  ç›¸ç­‰çš„å…ƒç´ ï¼Œæœ€å¤šç§»é™¤ <code>count</code>  ä¸ª ã€‚</p>\n<p><code>count &lt; 0</code>  : ä»è¡¨å°¾å¼€å§‹å‘è¡¨å¤´æœç´¢ï¼Œç§»é™¤ä¸  <code>value</code>  ç›¸ç­‰çš„å…ƒç´ ï¼Œæœ€å¤šç§»é™¤ <code>|count|</code>  ä¸ªã€‚</p>\n<p><code>count = 0</code>  : ç§»é™¤è¡¨ä¸­æ‰€æœ‰ä¸  <code>value</code>  ç›¸ç­‰çš„å€¼ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æ¼”ç¤º count&gt;0 æ—¶</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è®¾ç½®ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k29_1 v29_1  v29  v29_2 v29 v29_3 v29</span><br><span class=\"line\">(integer) 6</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä»è¡¨å¤´å¼€å§‹ï¼Œç§»é™¤2ä¸ª v29</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lrem k29_1 2 v29</span><br><span class=\"line\">(integer) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k29_1 0 -1</span><br><span class=\"line\">1) &quot;v29_3&quot;</span><br><span class=\"line\">2) &quot;v29_2&quot;</span><br><span class=\"line\">3) &quot;v29&quot;</span><br><span class=\"line\">4) &quot;v29_1&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æ¼”ç¤ºcount&lt;0 æ—¶</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k29_2 v29_1 v29  v29_2 v29 v29_3 v29</span><br><span class=\"line\">(integer) 6</span><br><span class=\"line\">127.0.0.1:6379&gt; lrem k29_2 -2 v29</span><br><span class=\"line\">(integer) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; LRANGE k29_2 0 -1</span><br><span class=\"line\">1) &quot;v29&quot;</span><br><span class=\"line\">2) &quot;v29_3&quot;</span><br><span class=\"line\">3) &quot;v29_2&quot;</span><br><span class=\"line\">4) &quot;v29_1&quot;</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æ¼”ç¤ºcount=0æ—¶</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k29_3 v29_1 v29  v29_2 v29 v29_3 v29</span><br><span class=\"line\">(integer) 6</span><br><span class=\"line\">127.0.0.1:6379&gt; lrem k29_3 0 v29</span><br><span class=\"line\">(integer) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; LRANGE k29_3 0 -1</span><br><span class=\"line\">1) &quot;v29_3&quot;</span><br><span class=\"line\">2) &quot;v29_2&quot;</span><br><span class=\"line\">3) &quot;v29_1&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"llen-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#llen-å‘½ä»¤\">#</a>  <code>llen</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>LLEN key</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è·å–åˆ—è¡¨çš„é•¿åº¦ã€‚</p>\n<p>å¦‚æœ  <code>key</code>  ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å› <code>0</code> .</p>\n<p>å¦‚æœ  <code>key</code>  å¯¹åº”ç±»å‹ä¸æ˜¯  <code>list</code>  ï¼Œåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; llen k30</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k30 v30_1 v30_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; llen k30</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆ æ‰k30ï¼Œæ¼”ç¤ºï¼Œç±»å‹ä¸æ˜¯listçš„æ—¶å€™ï¼ŒæŠ¥é”™</span></span><br><span class=\"line\">127.0.0.1:6379&gt; del k30</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k30 v30</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; llen k30</span><br><span class=\"line\">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br></pre></td></tr></table></figure>\n<h3 id=\"lindex-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#lindex-å‘½ä»¤\">#</a>  <code>lindex</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>lindex key index</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>è¿”å›åˆ—è¡¨ä¸­ï¼Œä¸‹æ ‡ä¸º  <code>index</code>  çš„å…ƒç´ .  <code>-1</code>  è¡¨ç¤ºåˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœ <code>key</code>  ä¸å­˜åœ¨ï¼Œæˆ–è€… <code>index</code>  è¶…å‡ºèŒƒå›´ï¼Œè¿”å› <code>nil</code> ï¼Œ å¦‚æœ key ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; lpush k31 v31_3 v31_2 v31_1</span><br><span class=\"line\">(integer) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; LINDEX k31 2</span><br><span class=\"line\">&quot;v31_3&quot;</span><br><span class=\"line\">127.0.0.1:6379&gt; LINDEX k31 1</span><br><span class=\"line\">&quot;v31_2&quot;</span><br><span class=\"line\">127.0.0.1:6379&gt; LINDEX k31 0</span><br><span class=\"line\">&quot;v31_1&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"linsert-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#linsert-å‘½ä»¤\">#</a>  <code>linsert</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>linsert key BEFORE|AFTER pivot value</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å°† <code>value</code>  æ’å…¥åˆ° <code>key</code>  é˜Ÿåˆ— <code>pivot</code>  å€¼ä¹‹å‰æˆ–è€…ä¹‹åã€‚è¿”å›æ’å…¥å®Œæˆä¹‹ååˆ—è¡¨çš„é•¿åº¦ã€‚</p>\n<p>å¦‚æœ  <code>pivot</code>  ä¸å­˜åœ¨ æˆ–è€…  <code>key</code>  ä¸å­˜åœ¨ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p>\n<p>å¦‚æœ  <code>key</code>  å¯¹åº”çš„ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; linsert k32 BEFORE k31_1 k31_0</span><br><span class=\"line\">(integer) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k32 v32_1</span><br><span class=\"line\">(integer) 1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> k32_3 =&gt; pivotä¸å­˜åœ¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; linsert k32 BEFORE v32_3 v31_2</span><br><span class=\"line\">(integer) -1</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> pivotä¹‹å‰æ’å…¥</span></span><br><span class=\"line\">127.0.0.1:6379&gt; linsert k32 BEFORE v32_1 v31_0</span><br><span class=\"line\">(integer) 2</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> pivotä¹‹åæ’å…¥</span></span><br><span class=\"line\">127.0.0.1:6379&gt; linsert k32 AFTER v32_1 v31_2</span><br><span class=\"line\">(integer) 3</span><br></pre></td></tr></table></figure>\n<h3 id=\"lset-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#lset-å‘½ä»¤\">#</a> lset å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>lset key index value</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>å°†åˆ—è¡¨ä¸­çš„ ç´¢å¼•ä¸º <code>index</code>  çš„å€¼è®¾ç½®ä¸º <code>value</code> ã€‚ å¦‚æœ <code>index</code>  è¶…å‡ºèŒƒå›´ï¼Œåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; lpush k33 v33_3 v33_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k33 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v33_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v33_3&quot;</span></span><br><span class=\"line\"><span class=\"comment\">## å°†ç¬¬äºŒä¸ªå€¼ï¼Œç´¢å¼•ä¸º1ï¼Œè®¾ç½®ä¸ºv33_2</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lset k33 1 v33_2</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k33 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v33_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v33_2&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¶…å‡ºèŒƒå›´è¿”å›é”™è¯¯</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lset k33 2 v33_2</span><br><span class=\"line\">(error) ERR index out of range</span><br></pre></td></tr></table></figure>\n<h3 id=\"ltrim-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#ltrim-å‘½ä»¤\">#</a>  <code>ltrim</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>ltrim key start stop</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p>ä¿ç•™åˆ—è¡¨ä» <code>start</code>  åˆ° <code>stop</code>  ä¹‹é—´çš„å…ƒç´ ã€‚å…¶ä»–å…ƒç´ éƒ½å°†è¢«åˆ é™¤ã€‚ æ³¨æ„ï¼šåŒ…å« (ä¸åˆ é™¤) <code>start</code>  å’Œ <code>stop</code>  ä¸¤ä¸ªå…ƒç´ .</p>\n<p>å¦‚æœ <code>key</code>  ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å› <code>OK</code> , å¦‚æœ <code>key</code>  å¯¹åº”çš„ä¸æ˜¯åˆ—è¡¨ï¼Œç›´æ¥è¿”å›é”™è¯¯ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; lpush k34 v34_1 v34_2 v34_3 v34_4 v34_5 v34_6</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br><span class=\"line\">127.0.0.1:6379&gt; ltrim k34 1 4</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k34  0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v34_5&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v34_4&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v34_3&quot;</span></span><br><span class=\"line\">4) <span class=\"string\">&quot;v34_2&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"blpop-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#blpop-å‘½ä»¤\">#</a> blpop å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>BLPOP key [key ...] timeout</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>lpop</code>  çš„ é˜»å¡ç‰ˆæœ¬ã€‚  <code>block left pop</code></p>\n<p>å½“ç»™å®šåˆ—è¡¨å†…æ²¡æœ‰ä»»ä½•å…ƒç´ å¯ä¾›å¼¹å‡ºçš„æ—¶å€™ï¼Œè¿æ¥å°†è¢« BLPOP å‘½ä»¤é˜»å¡ï¼Œç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚<br>\nå½“ç»™å®šå¤šä¸ª key å‚æ•°æ—¶ï¼ŒæŒ‰å‚æ•° key çš„å…ˆåé¡ºåºä¾æ¬¡æ£€æŸ¥å„ä¸ªåˆ—è¡¨ï¼Œå¼¹å‡ºç¬¬ä¸€ä¸ªéç©ºåˆ—è¡¨çš„å¤´å…ƒç´ ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># pushåˆ°ä¸‰ç»„åˆ—è¡¨ï¼Œåˆ†åˆ«ä¸‰ä¸ªå…ƒç´ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k35 v35_1 v35_2 v35_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k35 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v35_3&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_2&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v35_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k35_1 v35_1 v35_2 v35_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k35_2 v35_1 v35_2 v35_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é˜»å¡è°ƒç”¨lpop, ä»å·¦åˆ°å³ ä¾æ¬¡popå…ƒç´ ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå…ƒç´ å¯ä»¥popã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35_2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35_2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k35_2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v35_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; blpop k35 k35_1 k35_2 10</span><br><span class=\"line\"><span class=\"comment\"># æ²¡æœ‰å…ƒç´ çš„æ—¶å€™ä¼šé˜»å¡ä¸€ç›´åˆ°è¶…æ—¶ã€‚</span></span><br><span class=\"line\">(nil)</span><br><span class=\"line\">(10.59s)</span><br></pre></td></tr></table></figure>\n<h3 id=\"brpop-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#brpop-å‘½ä»¤\">#</a>  <code>brpop</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>BRPOP key [key ...] timeout</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>rpop</code>  çš„é˜»å¡ç‰ˆæœ¬ã€‚  <code>block right pop</code> <br>\n å½“ç»™å®šå¤šä¸ª <code>key</code>  çš„æ—¶å€™ï¼ŒæŒ‰ç…§ <code>key</code>  çš„å…ˆåé¡ºåºä¾æ¬¡æ£€æŸ¥å„ä¸ªåˆ—è¡¨ã€‚ç›´åˆ°å¼¹å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…è¶…æ—¶ã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸¤ä¸ªåˆ—è¡¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k36 v36_1 v36_2 v36_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k36_1 v36_1 v36_2 v36_3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"><span class=\"comment\"># é˜»å¡å¼çš„popå‡ºæ¯ä¸ªå€¼ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOP k36 k36_1 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k36&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v36_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOP k36 k36_1 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k36&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v36_2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOP k36 k36_1 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k36&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v36_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOP k36 k36_1 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k36_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v36_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOP k36 k36_1 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k36_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v36_2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOP k36 k36_1 10</span><br><span class=\"line\">1) <span class=\"string\">&quot;k36_1&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v36_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOP k36 k36_1 10</span><br><span class=\"line\"><span class=\"comment\"># é˜»å¡10s</span></span><br><span class=\"line\">(nil)</span><br><span class=\"line\">(10.61s)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Tips:  <code>lpush</code>  +  <code>brpop</code>  =&gt; é˜»å¡é˜Ÿåˆ—ã€‚</p>\n</blockquote>\n<h3 id=\"brpoplpush-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#brpoplpush-å‘½ä»¤\">#</a>  <code>brpoplpush</code>  å‘½ä»¤</h3>\n<ul>\n<li>è¯­æ³•</li>\n</ul>\n<p><code>BRPOPLPUSH source destination timeout</code></p>\n<ul>\n<li>è§£é‡Š</li>\n</ul>\n<p><code>rpoplpush</code>  çš„é˜»å¡ç‰ˆæœ¬ã€‚  <code>block right left push</code> ã€‚</p>\n<p>å½“åˆ—è¡¨  <code>source</code>  ä¸ºç©ºçš„æ—¶å€™ï¼Œè¯¥å‘½ä»¤å°†é˜»å¡ï¼Œç›´åˆ°è¶…æ—¶ï¼Œæˆ–è€… source ä¸­æœ‰ä¸€ä¸ªå…ƒç´ å¯ä»¥ popã€‚</p>\n<ul>\n<li>æ¼”ç¤º</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k37_source v37_1 v37_2 v37_3 v37_4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\"><span class=\"comment\"># å°†sourceç§»åŠ¨åˆ°distinationä¸­ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOPLPUSH k37_source k37_distination 10</span><br><span class=\"line\"><span class=\"string\">&quot;v37_1&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹ä¸‹distinationã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lrange k37_distination 0 -1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v37_1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOPLPUSH k37_source k37_distination 10</span><br><span class=\"line\"><span class=\"string\">&quot;v37_2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOPLPUSH k37_source k37_distination 10</span><br><span class=\"line\"><span class=\"string\">&quot;v37_3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOPLPUSH k37_source k37_distination 10</span><br><span class=\"line\"><span class=\"string\">&quot;v37_4&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¿™æ—¶æˆ‘ä»¬å¯åŠ¨ä¸¤ä¸ªå®¢æˆ·ç«¯,æ¼”ç¤ºé˜»å¡ç›´åˆ°å¦ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œsourceåˆ—è¡¨ä¸­çš„æ’å…¥æ“ä½œã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯1ä¸­ç»§ç»­æ‰§è¡Œ BRPOPLPUSH, ç„¶åé©¬ä¸Šåœ¨å®¢æˆ·ç«¯2ä¸­ï¼Œè¾“å…¥&quot;LPUSH k37_source v37_5&quot;.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; BRPOPLPUSH k37_source k37_distination 10</span><br><span class=\"line\"><span class=\"string\">&quot;v37_5&quot;</span></span><br><span class=\"line\">(3.02s)</span><br><span class=\"line\"><span class=\"comment\"># å®¢æˆ·ç«¯2</span></span><br><span class=\"line\">127.0.0.1:6379&gt; LPUSH k37_source v37_5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br></pre></td></tr></table></figure>\n<h2 id=\"listå†…éƒ¨ç»“æ„ä¹‹quicklist\"><a class=\"markdownIt-Anchor\" href=\"#listå†…éƒ¨ç»“æ„ä¹‹quicklist\">#</a>  <code>list</code>  å†…éƒ¨ç»“æ„ä¹‹ <code>quicklist</code></h2>\n<h3 id=\"quicklist\"><a class=\"markdownIt-Anchor\" href=\"#quicklist\">#</a>  <code>quicklist</code></h3>\n<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>list</code>  çš„å†…éƒ¨å®ç°  <code>quicklist</code>  ç»“æ„.</p>\n<p>ç‰¹åˆ«æ³¨æ˜ï¼š  <code>quicklist</code>  æ˜¯åŒå‘çš„é“¾è¡¨ç»“æ„ã€‚</p>\n<p>åœ¨ <code>Redis</code>  ä¸­ä½¿ç”¨å¦‚ä¸‹ç»“æ„ä½“è¡¨ç¤º.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklist</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// å¤´ç»“ç‚¹</span></span><br><span class=\"line\">    quicklistNode *head;</span><br><span class=\"line\">    <span class=\"comment\">// å°¾ç»“ç‚¹</span></span><br><span class=\"line\">    quicklistNode *tail;</span><br><span class=\"line\">    <span class=\"comment\">// åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> count;</span><br><span class=\"line\">    <span class=\"comment\">// é“¾è¡¨çš„é•¿åº¦</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> len;</span><br><span class=\"line\">    <span class=\"comment\">// å•ä¸ªèŠ‚ç‚¹çš„å¡«å……å› å­</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> fill : <span class=\"number\">16</span>;</span><br><span class=\"line\">    <span class=\"comment\">// ä¸è¿›è¡ŒèŠ‚ç‚¹å‹ç¼©çš„æœ€å¤§æ·±åº¦</span></span><br><span class=\"line\">    <span class=\"comment\">// è¶…è¿‡è¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›è¡ŒèŠ‚ç‚¹å‹ç¼©</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> compress : <span class=\"number\">16</span>;</span><br><span class=\"line\">&#125; quicklist;</span><br></pre></td></tr></table></figure>\n<p><code>quicklist</code>  æ˜¯å›ä¸€ä¸ªé€šç”¨çš„åŒå‘é“¾æ¥å¿«é€Ÿåˆ—è¡¨å®ç°ã€‚å®ƒçš„æ¯ä¸ªèŠ‚ç‚¹ç”¨  <code>quicklistNode</code>  è¡¨ç¤ºã€‚</p>\n<p>ä¸€èµ·æ¥çœ‹ä¸‹  <code>qucklistNode</code>  æ˜¯ä»€ä¹ˆå§ã€‚</p>\n<h3 id=\"quicklistnode\"><a class=\"markdownIt-Anchor\" href=\"#quicklistnode\">#</a>  <code>quicklistNode</code></h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistNode</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistNode</span> *<span class=\"title\">prev</span>;</span></span><br><span class=\"line\">    <span class=\"comment\">// åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistNode</span> *<span class=\"title\">next</span>;</span></span><br><span class=\"line\">    <span class=\"comment\">// æ•°æ®æŒ‡é’ˆã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæŒ‡å‘çš„æ•°æ®æ²¡æœ‰è¢«å‹ç¼©,é‚£ä¹ˆä¼šæŒ‡å‘zipListç»“æ„ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœè¿›è¡Œäº†å‹ç¼©ï¼Œé‚£ä¹ˆä¼šæŒ‡å‘ quickLZFç»“æ„ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> *zl;</span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰èŠ‚ç‚¹çš„å¤§å°</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> sz;</span><br><span class=\"line\">    <span class=\"comment\">// å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> count : <span class=\"number\">16</span>;</span><br><span class=\"line\">    <span class=\"comment\">// ç¼–ç æ–¹å¼ï¼Œ1=RAWï¼Œ2=LZF</span></span><br><span class=\"line\">    <span class=\"comment\">// 1 è¡¨ç¤ºæœªè¢«å‹ç¼©</span></span><br><span class=\"line\">    <span class=\"comment\">// 2 è¡¨ç¤ºä½¿ç”¨LZFç»“æ„è¿›è¡Œçš„å‹ç¼©</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> encoding : <span class=\"number\">2</span>;   </span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨çš„å®¹å™¨æ˜¯ä»€ä¹ˆï¼Ÿ1=NONE,2=ZIPLIST</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> container : <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"comment\">// å‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦è¢«å‹ç¼©</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> recompress : <span class=\"number\">1</span>; </span><br><span class=\"line\">    <span class=\"comment\">// æ˜¯å¦å‹ç¼©</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> attempted_compress : <span class=\"number\">1</span>; </span><br><span class=\"line\">    <span class=\"comment\">// æš‚æ—¶ç•™å‡ºæ¥ï¼Œä»¥åä½¿ç”¨ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> extra : <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125; quicklistNode;</span><br></pre></td></tr></table></figure>\n<p><code>quicklistNode</code>  æ˜¯ä¸€ä¸ª <code>32byte</code>  çš„ç»“æ„ä½“ï¼Œç”¨äºæè¿°ä¸€ä¸ª <code>quicklist</code>  çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä»ä»£ç ä¸­å¯çœ‹å‡ºï¼Œä½¿ç”¨äº†ä½å›¾æ¥èŠ‚çº¦ç©ºé—´ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è¿˜æåˆ°ä¸¤ç§æ•°æ®ç»“æ„ï¼Œå¯¹åº”çš„æ˜¯ä»£ç ä¸­  <code>zl</code>  æŒ‡é’ˆï¼ŒæŒ‡å‘çš„ä½ç½®ï¼Œå¦‚æœæ•°æ®è¢«å‹ç¼©ï¼ŒæŒ‡å‘ <code>quicklistLZF</code>  å’Œ æ²¡æœ‰æ•°æ®æ²¡æœ‰è¢«å‹ç¼©å°±æ˜¯æŒ‡å‘  <code>ziplist</code> .</p>\n<h3 id=\"ziplist\"><a class=\"markdownIt-Anchor\" href=\"#ziplist\">#</a>  <code>ziplist</code></h3>\n<p><code>ziplist</code>  è¿™ç§ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”åœ¨æºç ä¸­ä¹Ÿæ²¡æœ‰ç»™å‡ºæ˜ç¡®å®šä¹‰ã€‚é‚£  <code>ziplist</code>  è¿™ä¹ˆç¥ç§˜çš„ç»“æ„åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p>\n<p>åˆ«ç€æ€¥ï¼Œæˆ‘ä»¬å…ˆå¤§ä½“ç†Ÿæ‚‰ä¸‹ <code>ziplist</code>  è¿™ç§ç»“æ„çš„è®¾è®¡æ„å›¾ã€‚</p>\n<p><code>ziplist</code>  æ˜¯ä¸€ä¸ªç»è¿‡ç‰¹æ®Šç¼–ç çš„åŒå‘é“¾è¡¨ï¼Œå®ƒçš„è®¾è®¡æ„å›¾å°±æ˜¯ æé«˜å­˜å‚¨æ•ˆç‡ï¼Œ  <code>ziplist</code>  å¯ä»¥ç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æˆ–è€…æ•´æ•°ï¼Œå…¶ä¸­æ•´æ•°æ˜¯æŒ‰ç…§çœŸæ­£çš„äºŒè¿›åˆ¶è¿›è¡Œç¼–ç çš„ã€‚ å®ƒèƒ½ä»¥ <code>O(1)</code>  çš„æ•ˆç‡åœ¨è¡¨çš„ä¸¤ç«¯è¿›è¡Œ <code>pop</code>  å’Œ <code>push</code>  æ“ä½œã€‚</p>\n<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ™®é€šçš„é“¾è¡¨æ¯é¡¹éƒ½æ˜¯ä¸€å—ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œå„é¡¹ä¹‹é—´éƒ½æ˜¯é€šè¿‡æŒ‡é’ˆè¿æ¥èµ·æ¥çš„ã€‚è¿™ç§æ–¹å¼ï¼Œä¼šå¸¦æ¥å¤§é‡çš„ç©ºé—´ç¢ç‰‡ï¼ŒæŒ‡é’ˆå¼•ç”¨ä¹Ÿä¼šå ç”¨éƒ¨åˆ†ç©ºé—´å†…å­˜ã€‚æ‰€ä»¥ <code>ziplist</code>  æ˜¯å°†è¡¨ä¸­æ¯é¡¹æ”¾åœ¨è¿ç»­çš„ç©ºé—´å†…å­˜ä¸­ (ç±»ä¼¼æ•°ç»„)ï¼Œ <code>ziplist</code>  è¿˜å¯¹å€¼é‡‡å–äº†ä¸€ä¸ªå¯å˜é•¿åº¦çš„å­˜å‚¨æ–¹å¼ï¼Œå¤§çš„å€¼å°±ç”¨å¤§ç©ºé—´ï¼Œå°çš„å€¼å°±ç”¨å°ç©ºé—´ã€‚</p>\n<h4 id=\"ziplistç»“æ„çš„å®˜æ–¹å®šä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#ziplistç»“æ„çš„å®˜æ–¹å®šä¹‰\">#</a> ziplist ç»“æ„çš„å®˜æ–¹å®šä¹‰ã€‚</h4>\n<blockquote>\n<p>The general layout of the ziplist is as follows:<br>\n <code>&lt;zlbytes&gt; &lt;zltail&gt; &lt;zllen&gt; &lt;entry&gt; &lt;entry&gt; ... &lt;entry&gt; &lt;zlend&gt;</code> <br>\n <code>&lt;uint32_t zlbytes&gt;</code>  is an unsigned integer to hold the number of bytes that  the ziplist occupies, including the four bytes of the zlbytes field itself.  This value needs to be stored to be able to resize the entire structure  without the need to traverse it first.<br>\n <code>&lt;uint32_t zltail&gt;</code>  is the offset to the last entry in the list. This allows  a pop operation on the far side of the list without the need for full  traversal.<br>\n <code>&lt;uint16_t zllen&gt;</code>  is the number of entries. When there are more than  2^16-2 entries, this value is set to 2^16-1 and we need to traverse the entire list to know how many items it holds.<br>\n <code>&lt;uint8_t zlend&gt;</code>  is a special entry representing the end of the ziplist. Is encoded as a single byte equal to 255. No other normal entry starts with a byte set to the value of 255.</p>\n</blockquote>\n<p>æ ¹æ®ä¸Šé¢ä¸­è§£é‡Šæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹è¿™ç§æ¨¡å‹ï¼š</p>\n<p><img data-src=\"./images/ziplist-01-Ziplist%E7%9A%84%E7%BB%93%E6%9E%84.png\" alt=\"\"></p>\n<p>å¦‚æœæ²¡æœ‰ç‰¹æ®ŠæŒ‡å®šçš„è¯ï¼Œéƒ½æ˜¯é‡‡ç”¨å°å°¾æ•°æ³•å­˜å‚¨çš„ã€‚</p>\n<ul>\n<li>\n<p><code>zlbytes</code> : å­˜å‚¨ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œç”¨äºå­˜å‚¨ ziplist çš„æ‰€ç”¨çš„å­—èŠ‚æ•°ï¼Œ(åŒ…æ‹¬ zlbytes å­—æ®µæœ¬èº«çš„å››ä¸ªå­—èŠ‚)ï¼Œå½“é‡æ–°åˆ†é…å†…å®¹çš„æ—¶å€™ï¼Œä¸éœ€è¦éå†æ•´ä¸ªåˆ—è¡¨æ¥è®¡ç®—å†…å­˜å¤§å°ã€‚</p>\n</li>\n<li>\n<p><code>zltail</code> : ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œè¡¨ç¤º ziplist ä¸­æœ€åä¸€ä¸ªå…ƒç´ çš„åç§»å­—èŠ‚æ•°ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿çš„æ‰¾åˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»è€Œå¯ä»¥ä»¥ O (1) çš„å¤æ‚åº¦åœ¨å°¾ç«¯è¿›è¡Œ pop å’Œ pushã€‚</p>\n</li>\n<li>\n<p><code>zllenï¼šå‹ç¼©åˆ—è¡¨åŒ…å«çš„ç»“ç‚¹çš„ä¸ªæ•°ï¼Œå³entryçš„ä¸ªæ•°ã€‚</code> <br>\nè¿™é‡Œçš„ <code>zllen</code>  æ˜¯å ç”¨ <code>16bit</code> , ä¹Ÿå°±æ˜¯è¯´æœ€å¤šå­˜å‚¨  <code>2^16-2</code>  ä¸ªã€‚ä½†æ˜¯ <code>ziplist</code>  è¶…äº† <code>2^16-2</code>  ä¸ªä¹Ÿæ˜¯å¯ä»¥è¡¨ç¤ºçš„ã€‚é‚£ç§æƒ…å†µå°±æ˜¯ <code>16</code>  ä¸ª <code>1</code>  çš„æ—¶å€™ï¼Œåªéœ€è¦ä»å¤´éå†åˆ°å°¾å°±å¥½äº†ã€‚</p>\n</li>\n<li>\n<p><code>entry</code> : çœŸæ­£å­˜æ”¾æ•°æ®çš„æ•°æ®é¡¹ï¼Œæ¯ä¸ªæ•°æ®é¡¹éƒ½æœ‰è‡ªå·±çš„å†…éƒ¨ç»“æ„ã€‚</p>\n</li>\n<li>\n<p><code>zlend</code> :  <code>ziplist</code>  çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œå€¼å›ºå®šç­‰äº <code>255</code> ï¼Œå°±æ˜¯ä¸€ä¸ªç»“æŸæ ‡è®°ã€‚</p>\n</li>\n</ul>\n<h4 id=\"entry-ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#entry-ç»“æ„\">#</a> entry ç»“æ„</h4>\n<p><code>entry</code>  æ˜¯ç”±ä¸‰éƒ¨åˆ†æ„æˆçš„ã€‚</p>\n<ul>\n<li>\n<p><code>previous lengthï¼ˆpre_entry_lengthï¼‰</code> ï¼š è¡¨ç¤ºå‰ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹å ç”¨çš„æ€»å­—èŠ‚æ•°ï¼Œè¿™ä¸ªå­—æ®µçš„ç”¨å¤„æ˜¯ä¸ºäº†è®© ziplist èƒ½å¤Ÿä»åå‘å‰éå†ï¼ˆä»åä¸€é¡¹çš„ä½ç½®ï¼Œåªéœ€å‘å‰åç§» <code>previous length</code>  ä¸ªå­—èŠ‚ï¼Œå°±æ‰¾åˆ°äº†å‰ä¸€é¡¹ï¼‰ã€‚è¿™ä¸ªå­—æ®µé‡‡ç”¨å˜é•¿ç¼–ç ã€‚</p>\n</li>\n<li>\n<p><code>encoding</code> ï¼ˆ <code>encoding&amp;cur_entry_length</code> ï¼‰ï¼šè¡¨ç¤ºå½“å‰æ•°æ®èŠ‚ç‚¹ content çš„å†…å®¹ç±»å‹ä»¥åŠé•¿åº¦ã€‚ä¹Ÿé‡‡ç”¨å˜é•¿ç¼–ç ã€‚</p>\n</li>\n<li>\n<p><code>entry-data</code> ï¼šè¡¨ç¤ºå½“å‰èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®ï¼Œ <code>entry-data</code>  çš„å†…å®¹ç±»å‹æœ‰æ•´æ•°ç±»å‹å’Œå­—èŠ‚æ•°ç»„ç±»å‹ï¼Œä¸”æŸäº›æ¡ä»¶ä¸‹ <code>entry-data</code>  çš„é•¿åº¦å¯èƒ½ä¸º <code>0</code> ã€‚</p>\n</li>\n</ul>\n<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡º  <code>ziplist</code>  æ˜¯ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ã€‚</p>\n<p><img data-src=\"./images/ziplist-01-entry%E7%9A%84%E7%BB%93%E6%9E%84.png\" alt=\"\"></p>\n<p>æœ‰æ—¶ï¼Œencoding ä¹Ÿå¯ä»¥ä»£è¡¨ entry æœ¬èº«ï¼Œå°±åƒå°æ•´æ•°ä¸€æ ·ã€‚</p>\n<p><img data-src=\"./images/ziplist-01-entry%E7%9A%84%E7%BB%93%E6%9E%842.png\" alt=\"\"></p>\n<p>è¿™é‡Œå°±æ˜¯å¤§ä½“çš„äº†è§£ä¸‹ ziplist è¿™ç§æ•°æ®ç»“æ„ã€‚</p>\n<blockquote>\n<p>è¿™é‡Œæ˜¯ä¸€ç¯‡å…³äº <a href=\"./10-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8Bziplist.md\">ziplist</a> è¯¦ç»†è§£è¯»çš„æ–‡ç« ã€‚</p>\n</blockquote>\n<h3 id=\"quicklistlzf\"><a class=\"markdownIt-Anchor\" href=\"#quicklistlzf\">#</a>  <code>quicklistLZF</code></h3>\n<p>çœ‹å®Œäº†æ¯”è¾ƒç¥ç§˜çš„ <code>ziplist</code>  ç»“æ„ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ <code>quicklist</code>  çš„å‹ç¼©èŠ‚ç‚¹çš„ç»“æ„  <code>quicklistLZF</code> ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * quicklistLZFæ˜¯ä¸€ä¸ª4 + Nå­—èŠ‚çš„ structã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * sz æ˜¯ compressed å­—æ®µçš„å­—èŠ‚é•¿åº¦ã€‚&#x27;compressed&#x27; æ˜¯é•¿åº¦ä¸º szçš„ LZFæ•°æ®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * æœªè¢«å‹ç¼©çš„é•¿åº¦ä¿å­˜åˆ° quicklistNode-&gt;szä¸­ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * å½“å‹ç¼©äº†quicklistNode-&gt;zlæ—¶ï¼ŒquicklistNode-&gt;zlæŒ‡å‘çš„æ˜¯ä¸€ä¸ª quicklistLZFç±»å‹çš„æ•°æ®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * æœªå‹ç¼©çš„æ—¶å€™ï¼ŒæŒ‡å‘çš„æ˜¯ziplist.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistLZF</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">///compressedæ•°ç»„é•¿åº¦ </span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> sz; </span><br><span class=\"line\">    <span class=\"keyword\">char</span> compressed[];</span><br><span class=\"line\">&#125; quicklistLZF;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<ul>\n<li><code>list</code>  ç›¸å…³çš„å‘½ä»¤ã€‚ä»¥åŠå¸¸è§çš„åº”ç”¨åœºæ™¯ã€‚æ¯”å¦‚æ ˆå’Œé˜Ÿåˆ—ç­‰ç­‰ã€‚</li>\n<li><code>list</code>  å…¶å®æ˜¯ä¸€ç§é“¾è¡¨ç»“æ„ï¼Œä½†æ˜¯ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„é“¾è¡¨ç»“æ„ã€‚</li>\n<li><code>list</code>  æ˜¯ç”±  <code>quicklist</code>  è¿™ç§æ•°æ®ç»“æ„å®ç°çš„ã€‚ <code>quicklist</code>  ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯ <code>quicklistNode</code> , è€Œ <code>quicklist</code>  ä¸­ <code>zl</code>  æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯ ä¸€ä¸ª <code>ziplist</code>  æˆ–è€… <code>quickListLZF</code> ã€‚</li>\n<li><code>ziplist</code>  æ˜¯ä¸€ä¸ªæ¯”è¾ƒç¥ç§˜çš„æ•°æ®ç»“æ„ï¼Œæœ‰ <code>5</code>  éƒ¨åˆ†æ„æˆï¼Œæ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œå¯ä»¥å®ç° <code>O(1)</code>  çš„å°¾ç«¯ <code>pop</code>  å’Œ <code>push</code>  æ“ä½œã€‚</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BString/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BString/",
            "title": "Redisæ•°æ®ç»“æ„ä¹‹ String",
            "date_published": "2021-08-01T06:58:55.000Z",
            "content_html": "<p>ä»Šå¤©æ¥èŠèŠ  <code>Redis</code>  çš„ <code>string</code> ï¼Œè¿™ä¸€æ•°æ®ç»“æ„ã€‚</p>\n<h3 id=\"stringç®€ä»‹\"><a class=\"markdownIt-Anchor\" href=\"#stringç®€ä»‹\">#</a>  <code>string</code>  ç®€ä»‹</h3>\n<p><code>string</code>  æ˜¯ <code>Redis</code>  ä¸­æœ€åŸºæœ¬ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„æ•°æ®ç»“æ„ã€‚ä¸€ä¸ªé”® ( <code>key</code> ) å¯¹åº”ç€ä¸€ä¸ª <code>string</code>  ç±»å‹çš„å€¼ ( <code>value</code> ). æˆ‘ä»¬éƒ½çŸ¥é“ <code>redis</code>  æ˜¯ä½¿ç”¨ <code>C</code>  è¯­è¨€æ¥ç¼–å†™çš„ï¼Œä½†æ˜¯  <code>string</code>  è¿™ä¸€ä¸ªæ•°æ®ç»“æ„å¹¶éæ˜¯ä½¿ç”¨ <code>C</code>  è¯­è¨€çš„  <code>string(char[])</code>  æ¥å®ç°çš„ï¼Œè¦æƒ³å…ˆäº†è§£ï¼Œé‚£å°±åšç”µæ¢¯å§ -&gt;( <a href=\"#%60Redis%60%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\">ç”µæ¢¯ç›´è¾¾</a> ).</p>\n<p>ç°åœ¨ï¼Œå…ˆæš‚ä¸”æŠ›å¼€å†…éƒ¨å®ç°ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æœ‰æ€ä¹ˆä½¿ç”¨è¿™ä¸€æ•°æ®ç»“æ„ã€‚</p>\n<h3 id=\"stringç›¸å…³å¸¸ç”¨å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#stringç›¸å…³å¸¸ç”¨å‘½ä»¤\">#</a>  <code>string</code>  ç›¸å…³å¸¸ç”¨å‘½ä»¤</h3>\n<h4 id=\"setå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#setå‘½ä»¤\">#</a>  <code>set</code>  å‘½ä»¤</h4>\n<p><code>SET key value [expiration EX seconds|PX milliseconds] [NX|XX]</code></p>\n<p>ä½¿ç”¨ç¤ºä¾‹:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ f1=&gt;f1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k1 v1</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># æ ¹æ®é”®æŸ¥è¯¢å€¼</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k1</span><br><span class=\"line\"><span class=\"string\">&quot;v1&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹(f2=&gt;f2),è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º10s</span></span><br><span class=\"line\"><span class=\"comment\"># EX è¡¨ç¤ºç§’</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k2 v2 EX 10</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; get k2</span><br><span class=\"line\"><span class=\"string\">&quot;v2&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ç­‰å¾…10sä¹‹åå»æŸ¥è¯¢f2</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k2</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹(f3=&gt;f3),è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 10000æ¯«ç§’</span></span><br><span class=\"line\"><span class=\"comment\"># PX è¡¨ç¤ºä¸ºæ¯«ç§’</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k3 v3 PX 10000</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; get k3</span><br><span class=\"line\"><span class=\"string\">&quot;v3&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k3</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.è®¾ç½®é”®å€¼å¯¹k4=&gt;v4,éªŒè¯&quot;å­˜åœ¨ç›¸åŒçš„keyå°±è®¾ç½®å¤±è´¥&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># setnx å‘½ä»¤ä¹Ÿå¯å®ç°,æ³¨æ„è¿”å›å€¼ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k4 v4 NX</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå­˜åœ¨ç›¸åŒçš„keyå°±è®¾ç½®å¤±è´¥(ä¸ä¸‹é¢çš„æ³¨æ„å¯¹æ¯”)</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k4 v4 NX</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.éªŒè¯&quot;ä¸å­˜åœ¨ç›¸åŒçš„keyå°±è®¾ç½®å¤±è´¥&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k5 v5 XX</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"><span class=\"comment\"># å…ˆè®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹,</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k5 v5 </span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸å­˜åœ¨ç›¸åŒçš„keyå°±è®¾ç½®å¤±è´¥</span></span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k5 v5 XX</span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n<h4 id=\"setnxå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#setnxå‘½ä»¤\">#</a>  <code>setnx</code>  å‘½ä»¤</h4>\n<p><code>setnx key value</code></p>\n<p><code>set if not exists</code>  çš„ç¼©å†™ã€‚å¦‚æœå·²å­˜åœ¨ key, è¿”å› 0, ä¸å­˜åœ¨è¿”å› 1. å¸¸ç”¨äºåˆ†å¸ƒå¼é”ã€‚</p>\n<p>ä½¿ç”¨å®ä¾‹</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„é”®å€¼å¯¹ k6=&gt;v6</span></span><br><span class=\"line\">127.0.0.1:6379&gt; setnx k6 v6</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœkeyå·²ç»å­˜åœ¨,åˆ™è¿”å›0ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; setnx k6 v6</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br></pre></td></tr></table></figure>\n<h4 id=\"setex-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#setex-å‘½ä»¤\">#</a>  <code>setEx</code>  å‘½ä»¤</h4>\n<p><code>setex key seconds value</code></p>\n<p>ç»™é”®å€¼å¯¹è®¾ç½®ç”Ÿå­˜æ—¶é—´ (ç§’çº§åˆ«)ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è®¾ç½®k7=&gt;v7è¿™ä¸ªé”®å€¼å¯¹çš„ç”Ÿå­˜æ—¶é—´ä¸º5s</span></span><br><span class=\"line\">127.0.0.1:6379&gt; setex k7 5 v7</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; get k7</span><br><span class=\"line\">&quot;v7&quot;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è¿‡5sç§’é’Ÿä¹‹å,å†æŸ¥çœ‹ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k7</span><br><span class=\"line\">(nil)</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h4 id=\"psetex-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#psetex-å‘½ä»¤\">#</a>  <code>psetEx</code>  å‘½ä»¤</h4>\n<p><code>psetex key milliseconds value</code></p>\n<blockquote>\n<p><code>tip</code> : å‘½ä»¤åŠ©è®°:  <code>psetex</code>  ,  <code>p</code>  ç›´æ¥çš„æ˜¯æ¯«ç§’ã€‚å¯ä»¥å‚è€ƒ <code>set</code>  å‘½ä»¤çš„ <code>PX</code>  é€‰é¡¹ã€‚</p>\n</blockquote>\n<p>ç»™é”®å€¼å¯¹è®¾ç½®ç”Ÿå­˜æ—¶é—´ (æ¯«ç§’çº§åˆ«)ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®é”®å€¼å¯¹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; psetex k8 5000 v8</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># è·å–k8çš„å€¼</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k8</span><br><span class=\"line\"><span class=\"string\">&quot;v8&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># 5sä¹‹åï¼Œè·å–k8çš„å€¼</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k8</span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n<h4 id=\"getå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#getå‘½ä»¤\">#</a>  <code>get</code>  å‘½ä»¤</h4>\n<p>è¿™ä¸ªå‘½ä»¤ä¸å¤šè¯´äº†ï¼Œè·å– <code>key</code>  ç›¸å…³è”çš„ <code>value</code> .  <code>get key</code></p>\n<h4 id=\"getsetå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#getsetå‘½ä»¤\">#</a>  <code>getset</code>  å‘½ä»¤</h4>\n<p><code>getset key value</code></p>\n<p>è®¾ç½®é”®å€¼å¯¹ï¼Œ <code>key=&gt;value</code> , å¦‚æœ <code>key</code>  å·²ç»å­˜åœ¨ï¼Œè¿”å›æ—§å€¼ã€‚ä¸å­˜åœ¨è¿”å›  <code>nil</code></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®é”®å€¼å¯¹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; getset k9 v9</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"><span class=\"comment\"># è·å–å€¼</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k9</span><br><span class=\"line\"><span class=\"string\">&quot;v9&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># åœ¨è®¾ç½®ä¸€æ¬¡k9,å€¼ä¸ºvv9,è¿”å›æ—§å€¼ v9</span></span><br><span class=\"line\">127.0.0.1:6379&gt; getset k9 vv9</span><br><span class=\"line\"><span class=\"string\">&quot;v9&quot;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>ps: å¦‚æœåŸæ¥çš„å­˜åœ¨ keyï¼Œä½†æ˜¯ value çš„ç±»å‹ä¸æ–°è®¾ç½®çš„ç±»å‹ä¸ä¸€è‡´ï¼Œä¼šæŠ›å‡ºå‘½ä»¤é”™è¯¯ã€‚</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸€ä¸ªlistç±»å‹ï¼Œkeyä¸ºk9_1, Valueä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ v9_1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k9_1 v9_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨getsetå‘½ä»¤è½½è®¾ç½®ä¸€æ¬¡,æŠ›å‡ºå‘½ä»¤é”™è¯¯ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; getset k9_1 vv9_1</span><br><span class=\"line\">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br></pre></td></tr></table></figure>\n<h4 id=\"strlen-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#strlen-å‘½ä»¤\">#</a>  <code>strlen</code>  å‘½ä»¤</h4>\n<p><code>strlen key</code></p>\n<p>è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å¦‚æœ key ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å› 0, å¦‚æœ key å¯¹åº”çš„ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›é”™è¯¯.</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k10 v10</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; strlen k10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"><span class=\"comment\"># æ¼”ç¤ºæŠ¥é”™</span></span><br><span class=\"line\">127.0.0.1:6379&gt; lpush k10_1 v10</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; strlen k10_1</span><br><span class=\"line\">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br></pre></td></tr></table></figure>\n<h4 id=\"appendå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#appendå‘½ä»¤\">#</a>  <code>APPEND</code>  å‘½ä»¤</h4>\n<p><code>APPEND key value</code>  å‘½ä»¤</p>\n<p>æ ¹æ® keyï¼Œç»™ key å¯¹åº”çš„å€¼è¿½åŠ å­—ç¬¦ä¸²ã€‚å¦‚æœ key ä¸å­˜åœ¨ï¼Œå°±è®¾ç½®ä¸€å¯¹é”®å€¼å¯¹ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœkeyä¸å­˜åœ¨åˆ™è®¾ç½®é”®å€¼å¯¹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; append k11 v11</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">127.0.0.1:6379&gt; get k11</span><br><span class=\"line\"><span class=\"string\">&quot;v11&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿½åŠ </span></span><br><span class=\"line\">127.0.0.1:6379&gt; append k11 v11</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br><span class=\"line\">127.0.0.1:6379&gt; get k11</span><br><span class=\"line\"><span class=\"string\">&quot;v11v11&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"setrangeå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#setrangeå‘½ä»¤\">#</a>  <code>setrange</code>  å‘½ä»¤</h4>\n<p><code>setrange key offset value</code></p>\n<p>ä»åç§»é‡  <code>offset</code>  å¼€å§‹è¦†å†™åŸæ¥ <code>key</code>  çš„å€¼ã€‚å¦‚æœ <code>key</code>  ä¸å­˜çš„æ—¶å€™å½“ä½œç©ºå­—ç¬¦ä¸²å¤„ç†ã€‚è¿”å›è¢«è®¾ç½®å <code>Value</code>  çš„é•¿åº¦ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># è®¾ç½®ä¸å­˜åœ¨çš„key</span></span><br><span class=\"line\">127.0.0.1:6379&gt; setrange k12 3 v12</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 6</span><br><span class=\"line\"><span class=\"comment\"># åœ¨offsetå‰çš„ç©ºä½ç½®ä¼šç”¨ \\x00 å¡«å……</span></span><br><span class=\"line\">127.0.0.1:6379&gt; get k12</span><br><span class=\"line\"><span class=\"string\">&quot;\\x00\\x00\\x00v12&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è®¾ç½®å·²ç»å­˜åœ¨çš„key</span></span><br><span class=\"line\">127.0.0.1:6379&gt; setrange k12 4 v12</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 7</span><br><span class=\"line\">127.0.0.1:6379&gt; get k12</span><br><span class=\"line\"><span class=\"string\">&quot;\\x00\\x00\\x00vv12&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"getrangeå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#getrangeå‘½ä»¤\">#</a>  <code>getrange</code>  å‘½ä»¤</h4>\n<p><code>getrange key start end</code></p>\n<p>è·å–æŒ‡å®šåŒºé—´çš„å€¼ã€‚æŠ¥é”™ start å’Œ end ä½ç½®ã€‚ç´¢å¼•ä½ç½®æ˜¯ä» 0 å¼€å§‹çš„ã€‚</p>\n<p>è´Ÿæ•°åç§»é‡è¡¨ç¤ºä»å­—ç¬¦åˆ›çš„æœ«ä½å¼€å§‹è®¡æ•°ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k13 v13v13v13</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; getrange k13 2 5</span><br><span class=\"line\"><span class=\"string\">&quot;3v13&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># ä»ç´¢å¼•ä¸º2å¤„ï¼Œåˆ°å€’æ•°ç¬¬4ä½ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; getrange k13 2 -4</span><br><span class=\"line\"><span class=\"string\">&quot;3v13&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœendå¤§äºValueçš„é•¿åº¦ï¼Œè¿”å›ç›®å‰startåˆ°ç»“æŸçš„éƒ¨åˆ†</span></span><br><span class=\"line\">127.0.0.1:6379&gt; getrange k13 3 10</span><br><span class=\"line\"><span class=\"string\">&quot;v13v13&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># è¶…è¿‡Valueçš„é•¿åº¦è¿”å›ä¸º &quot;&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; getrange k13 100 120</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"incr-å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#incr-å‘½ä»¤\">#</a>  <code>incr</code>  å‘½ä»¤</h4>\n<p><code>incr key</code></p>\n<p>åœ¨ key å¯¹åº”çš„ Value ä¸Šè¿›è¡Œè‡ªå¢ 1. å¦‚æœ Value å¯ä»¥è§£é‡Šä¸ºæ•°æ®ï¼Œåˆ™è‡ªå¢ï¼Œåä¹‹ï¼Œè¿”å›é”™è¯¯ã€‚</p>\n<p>è¿”å›å€¼ä¸ºè‡ªå¢åçš„å€¼ã€‚</p>\n<p>å¦‚æœ ke ä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆå§‹åŒ– key å¯¹åº”çš„ Value=0ï¼Œ ç„¶åå†è‡ªå¢ã€‚</p>\n<p>ç›¸å¯¹çš„æ˜¯: <a href=\"#%60DECR%60%E5%91%BD%E4%BB%A4\"> <code>DECR</code>  å‘½ä»¤</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; incr k14</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; get k14</span><br><span class=\"line\"><span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; incr k14</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br></pre></td></tr></table></figure>\n<h4 id=\"incrbyå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#incrbyå‘½ä»¤\">#</a>  <code>incrby</code>  å‘½ä»¤</h4>\n<p><code>incrby key increment</code></p>\n<p>å¸¦æœ‰æ­¥é•¿çš„è‡ªå¢å‘½ä»¤ã€‚</p>\n<p>ç›¸å¯¹çš„å‘½ä»¤æ˜¯: <a href=\"%60DECRBY%60%E5%91%BD%E4%BB%A4\"> <code>DECRBY</code>  å‘½ä»¤</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; incrby k15 5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">127.0.0.1:6379&gt; INCRBY k15 5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">127.0.0.1:6379&gt; INCRBY k15 5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 15</span><br></pre></td></tr></table></figure>\n<h4 id=\"incrbyfloatå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#incrbyfloatå‘½ä»¤\">#</a>  <code>INCRBYFLOAT</code>  å‘½ä»¤</h4>\n<p><code>INCRBYFLOAT key increment</code></p>\n<p>å¸¦æœ‰æ­¥é•¿çš„æµ®ç‚¹æ•°è‡ªå¢</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; INCRBYFLOAT k16 5.0</span><br><span class=\"line\"><span class=\"string\">&quot;5&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; INCRBYFLOAT k16 5.2</span><br><span class=\"line\"><span class=\"string\">&quot;10.2&quot;</span></span><br><span class=\"line\">127.0.0.1:6379&gt; INCRBYFLOAT k16 5.4</span><br><span class=\"line\"><span class=\"string\">&quot;15.6&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"decrå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#decrå‘½ä»¤\">#</a>  <code>DECR</code>  å‘½ä»¤</h4>\n<p><code>DECR key</code></p>\n<p>è‡ªå‡ <code>1</code> .</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœkeyï¼Œä¸å­˜åœ¨ï¼ŒåŒæ ·ä¼šåˆå§‹åŒ–ä¸º0ï¼Œç„¶åè‡ªå‡1</span></span><br><span class=\"line\">127.0.0.1:6379&gt; DECR k17</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) -1</span><br><span class=\"line\">127.0.0.1:6379&gt; DECR k17</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) -2</span><br><span class=\"line\">127.0.0.1:6379&gt; DECR k17</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) -3</span><br></pre></td></tr></table></figure>\n<h4 id=\"decrbyå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#decrbyå‘½ä»¤\">#</a>  <code>DECRBY</code>  å‘½ä»¤</h4>\n<p>å¸¦æœ‰æ­¥é•¿çš„è‡ªå‡å‘½ä»¤ï¼Œä¸ <a href=\"%60INCRBY%60%E5%91%BD%E4%BB%A4\"> <code>INCRBY</code>  å‘½ä»¤</a>ç›¸å¯¹ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¦‚æœkeyä¸å­˜åœ¨ï¼Œä¼šåˆå§‹åŒ–ä¸º0ï¼Œåœ¨è¿›è¡Œè‡ªå‡ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; DECRBY k18 5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) -5</span><br><span class=\"line\">127.0.0.1:6379&gt; DECRBY k18 5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) -10</span><br></pre></td></tr></table></figure>\n<h4 id=\"mgetå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#mgetå‘½ä»¤\">#</a>  <code>mget</code>  å‘½ä»¤</h4>\n<p><code>mget key [key ...]</code></p>\n<p>ä¸€æ¬¡æ€§è¿”å›å¤šä¸ª <code>key</code>  çš„å€¼ã€‚ å¦‚æœ <code>key</code>  ä¸å­˜åœ¨ï¼Œè¿”å›  <code>(nil)</code></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k19_0 v19_0</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">set</span> k19_1 v19_1</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; mget k19_0 k19_1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v19_0&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v19_1&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># å¦‚æœkeyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å› (nil)</span></span><br><span class=\"line\">127.0.0.1:6379&gt; mget k19_0 k19_1 k10_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;v19_0&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v19_1&quot;</span></span><br><span class=\"line\">3) (nil)</span><br></pre></td></tr></table></figure>\n<h4 id=\"msetå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#msetå‘½ä»¤\">#</a>  <code>mset</code>  å‘½ä»¤</h4>\n<p>åŒæ—¶ä¸ºè®¾ç½®å¤šä¸ªé”®å€¼å¯¹ã€‚ å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œç›´æ¥è¦†ç›–æ‰ã€‚</p>\n<p>æ³¨æ„ï¼š è¿™ä¸ªåŸå­æ€§æ“ä½œã€‚æ‰€æœ‰ç»™å®šçš„ key éƒ½ä¼šåœ¨åŒä¸€æ—¶é—´å†…è¢«è®¾ç½®ã€‚</p>\n<blockquote>\n<p>tips: å¦‚æœå¸Œæœ›ï¼Œå·²ç»å­˜åœ¨çš„ key ä¸è¢«è¦†ç›–ï¼Œå¯ä»¥å‚è€ƒ <a href=\"#%60msetnx%60%E5%91%BD%E4%BB%A4\"> <code>msetnx</code>  å‘½ä»¤</a></p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä¸€ä¸‹è®¾ç½®ä¸‰å¯¹</span></span><br><span class=\"line\">127.0.0.1:6379&gt; mset k20_0 v20_0 k20_1 v20_1 k20_2 v20_2</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; mget k20_0 k20_1 k20_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;v20_0&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v20_1&quot;</span></span><br><span class=\"line\">3) <span class=\"string\">&quot;v20_2&quot;</span></span><br><span class=\"line\"><span class=\"comment\"># æ¼”ç¤ºå·²æœ‰çš„keyå¯¹åº”çš„å€¼ä¼šè¢«è¦†ç›–æ‰ã€‚</span></span><br><span class=\"line\">127.0.0.1:6379&gt; mset k20_2 vv20_2 k20_3 v20_3</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; mget k20_2 k20_3</span><br><span class=\"line\">1) <span class=\"string\">&quot;vv20_2&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v20_3&quot;</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"msetnxå‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#msetnxå‘½ä»¤\">#</a>  <code>msetnx</code>  å‘½ä»¤</h4>\n<p><code>MSETNX key value [key value ...]</code></p>\n<p>å½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®šçš„ key ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰ä¼šè®¾ç½®é”®å€¼å¯¹ã€‚å³ä½¿æœ‰ä¸€ä¸ª key å­˜åœ¨ï¼Œè¯¥å‘½ä»¤ä¹Ÿä¸ä¼šè®¾ç½®å…¶ä»–çš„ key å¯¹åº”çš„é”®å€¼å¯¹.</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ¼”ç¤ºè®¾ç½®æˆåŠŸ</span></span><br><span class=\"line\">127.0.0.1:6379&gt; MSETNX k21_0 v21_0 k21_1 v21_1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; MGET k21_0 k21_1</span><br><span class=\"line\">1) <span class=\"string\">&quot;v21_0&quot;</span></span><br><span class=\"line\">2) <span class=\"string\">&quot;v21_1&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å­˜åœ¨å…¶ä¸­çš„ä¸€ä¸ªç»™å®škeyï¼Œå°±ä¸èƒ½è®¾ç½®æˆåŠŸ</span></span><br><span class=\"line\">127.0.0.1:6379&gt; msetnx k21_1 vv21_1 k21_2 v21_2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; MGET k21_1 k21_2</span><br><span class=\"line\">1) <span class=\"string\">&quot;v21_1&quot;</span></span><br><span class=\"line\">2) (nil)</span><br></pre></td></tr></table></figure>\n<h3 id=\"rediså¦‚ä½•å®ç°stringè¿™ä¸€æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#rediså¦‚ä½•å®ç°stringè¿™ä¸€æ•°æ®ç»“æ„\">#</a>  <code>Redis</code>  å¦‚ä½•å®ç° <code>String</code>  è¿™ä¸€æ•°æ®ç»“æ„</h3>\n<p>åœ¨  <code>string</code>  çš„ç›¸å…³å‘½ä»¤ä»‹ç»çš„æ—¶å€™ï¼Œæˆ‘å…¶å®ä½¿ç”¨ä¸€ä¸ªé”™è¯¯çš„æè¿°ã€‚å°±æ˜¯å°† <code>Redis</code>  çš„ <code>String</code>  ç±»å‹ç§°ä¸ºå­—ç¬¦ä¸²ã€‚è¿™ç§è¯´æ³•å…¶å®ä¸æ­£ç¡®çš„ã€‚</p>\n<p>åœ¨  <code>redis</code>  ä¸­ï¼Œ <code>string</code>  è¿™ä¸€æ•°æ®ç»“æ„ä½¿ç”¨ <code>sds</code>  æ¥è¡¨ç¤ºçš„ã€‚</p>\n<h4 id=\"sds\"><a class=\"markdownIt-Anchor\" href=\"#sds\">#</a>  <code>sds</code></h4>\n<p><code>sds</code>  æ˜¯  <code>simple dynamic string</code>  çš„ç®€ç§°ã€‚ æ„æ€æ˜¯  <code>ç®€å•çš„åŠ¨æ€å­—ç¬¦ä¸²</code> ã€‚ è¿™é‡Œé¢çš„ <code>string</code>  å°±æ˜¯å®æ‰“å®çš„ <code>C</code>  è¯­è¨€ä¸­çš„å­—ç¬¦ä¸² ( <code>char[]</code> ).  <code>Redis</code>  ä¹Ÿå¹¶éä¸€ç‚¹ä¹Ÿæ²¡æœ‰ä½¿ç”¨  <code>C</code>  è¯­è¨€çš„å­—ç¬¦ä¸²ï¼Œåƒä¸€äº›å­—é¢é‡å¸¸äº®ï¼Œæ—¥å¿—éƒ½æ˜¯ä½¿ç”¨ <code>C</code>  è¯­è¨€çš„å­—ç¬¦ä¸²ã€‚</p>\n<p>é‚£  <code>sds</code>  åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç»“æ„å‘¢ï¼Ÿ</p>\n<p>åœ¨æºç çš„  <code>src</code>  ç›®å½•ä¸‹ï¼Œæˆ‘æ‰¾åˆ°äº†  <code>sds.h</code>  è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™é‡Œè§„å®šäº†  <code>sds</code>  ç»“æ„ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> __<span class=\"title\">attribute__</span> ((__<span class=\"title\">packed__</span>)) <span class=\"title\">sdshdr64</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// è¡¨ç¤ºå·²ä½¿ç”¨çš„é•¿åº¦,å³buf[]çš„é•¿åº¦ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">uint64_t</span> len; </span><br><span class=\"line\">    <span class=\"comment\">// å·²åˆ†é…çš„é•¿åº¦(åŒ…æ‹¬æœªä½¿ç”¨çš„é•¿åº¦)</span></span><br><span class=\"line\">    <span class=\"comment\">// alloc-len,å¯¹åº”ç€ä¹‹å‰ç‰ˆæœ¬çš„free</span></span><br><span class=\"line\">    <span class=\"keyword\">uint64_t</span> alloc; </span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> flags; </span><br><span class=\"line\">    <span class=\"keyword\">char</span> buf[];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>tips: å¦‚æœä½ æ³¨æ„åˆ°äº†è¿™ä¸ªç»“æ„ä½“çš„å‘½åã€‚é‚£ä¹ˆæ¥çœ‹ä¸‹<a href=\"\">è¿™ç¯‡æ–‡ç« </a>å§ã€‚</p>\n</blockquote>\n<p><code>sds</code>  ä¿ç•™äº†  <code>C</code>  å­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„æƒ¯ä¾‹ã€‚ä¿ç•™çš„è¿™ä¸ªç©ºå­—ç¬¦çš„é•¿åº¦ä¸ä¼šä¿å­˜åœ¨  <code>len</code>  å­—æ®µä¸­ã€‚ä¿ç•™è¿™ä¸€æƒ¯ä¾‹çš„å¥½å¤„å°±æ˜¯å¯ä»¥ä½¿ç”¨ <code>C</code>  å­—ç¬¦ä¸²å‡½æ•°åº“çš„ä¸€äº›æ–¹æ³•ã€‚</p>\n<p>å‡è®¾æˆ‘ä»¬åˆ†é…äº† <code>10</code>  ä¸ªå­—èŠ‚ç©ºé—´ï¼Œåªä¿å­˜äº†  <code>redis</code>  è¿™ä¸ª <code>C</code>  å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ åœ¨ <code>sds</code>  ä¸­ï¼Œæ˜¯è¿™ä¹ˆè¡¨ç¤ºçš„ï¼š</p>\n<p><img data-src=\"/images/Redis%E7%B3%BB%E5%88%97/images/01-01-sds%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"01-01-sdsç¤ºæ„å›¾.png\"></p>\n<h4 id=\"ä½¿ç”¨sdsæ¯”ä½¿ç”¨cå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå¥½å¤„å‘¢\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨sdsæ¯”ä½¿ç”¨cå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå¥½å¤„å‘¢\">#</a> ä½¿ç”¨ <code>sds</code>  æ¯”ä½¿ç”¨ <code>C</code>  å­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</h4>\n<h5 id=\"è·å–å­—ç¬¦é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º-o1\"><a class=\"markdownIt-Anchor\" href=\"#è·å–å­—ç¬¦é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º-o1\">#</a> è·å–å­—ç¬¦é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º  <code>O(1)</code></h5>\n<p><code>C</code>  è¯­è¨€è·å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸º  <code>O(N)</code> . éœ€è¦éå†å­—ç¬¦ä¸²å¹¶ç´¯åŠ ï¼Œåˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸º  <code>'\\0'</code>  æ¥è·å¾—å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p>\n<p><code>sds</code>  åªéœ€è¦æ ¹æ®  <code>len</code>  å­—æ®µè·å–å³å¯ã€‚æ€ä¹ˆè·å–çš„å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬æ¥çœ‹ä¸‹æºç ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å®šä¹‰charç±»å‹çš„æŒ‡é’ˆç±»å‹ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">char</span> *sds;</span><br><span class=\"line\"><span class=\"comment\">// è·å–é•¿åº¦çš„ç»“æ„ä½“æŒ‡é’ˆçš„å®.</span></span><br><span class=\"line\"><span class=\"comment\">// å¯æ ¹æ®æŒ‡å‘bufçš„æŒ‡é’ˆè¿”å›æŒ‡å‘sdshdrç»“æ„ä½“é¦–åœ°å€çš„å®</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SDS_HDR(T,s) ((struct sdshdr##T *)((s)-(sizeof(struct sdshdr##T))))</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// sds ç›´æ¥æŒ‡å‘ç»“æ„ä½“é‡Œçš„buf</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">inline</span> <span class=\"keyword\">size_t</span> <span class=\"title\">sdslen</span><span class=\"params\">(<span class=\"keyword\">const</span> sds s)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// sdsæ˜¯ç›´æ¥æŒ‡å‘ç»“æ„ä½“é‡Œçš„bufæ•°æ®, å½“è·å–lenç­‰å­—æ®µçš„ä¿¡æ¯,åªéœ€è¦å‡å»ç»“æ„ä½“é•¿åº¦ï¼Œå›é€€ä¸€ä¸‹æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡Œä½¿ç”¨çš„å°¾æŒ‡é’ˆæ³•ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">char</span> flags = s[<span class=\"number\">-1</span>];</span><br><span class=\"line\">    <span class=\"comment\">// åˆ¤æ–­å±äºé‚£ç§ sdshdr,å¯¹åº”å‡å»ä¸åŒçš„åœ°å€ã€‚</span></span><br><span class=\"line\">    <span class=\"built_in\"><span class=\"keyword\">switch</span></span>(flags&amp;SDS_TYPE_MASK) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> SDS_TYPE_5:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">SDS_TYPE_5_LEN</span>(flags);</span><br><span class=\"line\">        <span class=\"keyword\">case</span> SDS_TYPE_8:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">SDS_HDR</span>(<span class=\"number\">8</span>,s)-&gt;len;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> SDS_TYPE_16:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">SDS_HDR</span>(<span class=\"number\">16</span>,s)-&gt;len;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> SDS_TYPE_32:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">SDS_HDR</span>(<span class=\"number\">32</span>,s)-&gt;len;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> SDS_TYPE_64:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">SDS_HDR</span>(<span class=\"number\">64</span>,s)-&gt;len;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"å¯ä»¥æœç»ç¼“å†²åŒºæº¢å‡º\"><a class=\"markdownIt-Anchor\" href=\"#å¯ä»¥æœç»ç¼“å†²åŒºæº¢å‡º\">#</a> å¯ä»¥æœç»ç¼“å†²åŒºæº¢å‡º</h5>\n<p><code>C</code>  è¯­è¨€æ˜¯ä¸ä¼šåˆ¤æ–­æ•°ç»„æ˜¯å¦è¶Šç•Œçš„ã€‚æ¯”å¦‚  <code>strcat</code>  æ–¹æ³•ï¼Œå¦‚æœå½“å‰çš„æ•°æ®ä¸èƒ½å®¹çº³æ‹¼æ¥ä¹‹åå­—ç¬¦æ—¶ï¼Œå¿…ç„¶ä¼šå‘ç”Ÿç¼“å­˜åŒºæº¢å‡ºã€‚<br>\nä½†æ˜¯  <code>sds</code>  åˆ™ä¸ä¼šã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹  <code>sds</code>  çš„å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹æ³•  <code>sdscat</code> ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// s åŸæ¥çš„å­—ç¬¦ä¸²ï¼Œtæ˜¯è¦æ‹¼æ¥çš„å­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"function\">sds <span class=\"title\">sdscat</span><span class=\"params\">(sds s, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *t)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">sdscatlen</span>(s, t, <span class=\"built_in\">strlen</span>(t));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">sds <span class=\"title\">sdscatlen</span><span class=\"params\">(sds s, <span class=\"keyword\">const</span> <span class=\"keyword\">void</span> *t, <span class=\"keyword\">size_t</span> len)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// è·å–åŸæ¥å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚(è§ä¸Šé¢çš„æ–¹æ³•)</span></span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> curlen = <span class=\"built_in\">sdslen</span>(s);</span><br><span class=\"line\">    <span class=\"comment\">// æ‰©å¤§sdså­—ç¬¦ä¸²æœ«å°¾çš„å¯ç”¨ç©ºé—´ï¼Œ</span></span><br><span class=\"line\">    <span class=\"comment\">//ä»¥ä¾¿è°ƒç”¨è€…ç¡®ä¿åœ¨è°ƒç”¨æ­¤å‡½æ•°åå¯ä»¥è¦†ç›–å­—ç¬¦ä¸²æœ«å°¾çš„addlenå­—èŠ‚ï¼Œ</span></span><br><span class=\"line\">    <span class=\"comment\">//å†ä¸ºnullé¡¹å†åŠ ä¸Šä¸€ä¸ªå­—èŠ‚ã€‚ å…·ä½“å®ç°ï¼Œå‚è€ƒæºç (sds.c:204)ã€‚</span></span><br><span class=\"line\">    s = <span class=\"built_in\">sdsMakeRoomFor</span>(s,len);</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœå†…å­˜åˆ†é…å¤±è´¥ï¼Œå°±ä¼šè¿”å›null</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s == <span class=\"literal\">NULL</span>) <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    <span class=\"comment\">// è°ƒç”¨Cè¯­è¨€çš„åˆ†é…</span></span><br><span class=\"line\">    <span class=\"built_in\">memcpy</span>(s+curlen, t, len);</span><br><span class=\"line\">    <span class=\"comment\">// sdsè®¾ç½® sdshdrçš„lenå­—æ®µçš„å€¼ã€‚</span></span><br><span class=\"line\">    <span class=\"built_in\">sdssetlen</span>(s, curlen+len);</span><br><span class=\"line\">    <span class=\"comment\">// æ·»åŠ æœ€åä¸€ä¸ªå­—ç¬¦ä¸º: &#x27;\\0&#x27;</span></span><br><span class=\"line\">    s[curlen+len] = <span class=\"string\">&#x27;\\0&#x27;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"sds-ä¼˜åŒ–äº†cè¯­è¨€çš„å†…å­˜åˆ†é…ç­–ç•¥\"><a class=\"markdownIt-Anchor\" href=\"#sds-ä¼˜åŒ–äº†cè¯­è¨€çš„å†…å­˜åˆ†é…ç­–ç•¥\">#</a> sds ä¼˜åŒ–äº† C è¯­è¨€çš„å†…å­˜åˆ†é…ç­–ç•¥</h5>\n<h6 id=\"ç©ºé—´é¢„åˆ†é…\"><a class=\"markdownIt-Anchor\" href=\"#ç©ºé—´é¢„åˆ†é…\">#</a> ç©ºé—´é¢„åˆ†é…</h6>\n<p>ç©ºé—´é¢„åˆ†é…ç­–ç•¥éµå¾ªä¸‹é¢çš„å…¬å¼:</p>\n<ul>\n<li>å¦‚æœ <code>SDS</code>  çš„é•¿åº¦å°äºæœ€å¤§çš„é¢„åˆ†é…ç©ºé—´ ( <code>1MB</code> ), é‚£ä¹ˆä¼šåˆ†é…ä¸¤å€çš„æ–°ç©ºé—´ï¼Œå†åŠ ä¸Šç»“å°¾çš„ç©ºå­—ç¬¦ <code>'\\0'</code>  ä¸¾ä¸ªä¾‹å­ï¼šåŸæœ‰çš„ <code>sds</code>  çš„ <code>len</code>  ä¸º <code>5</code> , <code>alloc</code>  ä¸º <code>5</code> , è¦æ‹¼æ¥çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º <code>15</code> , é‚£ä¹ˆæ–°åˆ†é…çš„ç©ºé—´å¤§å°æ˜¯:  <code>(5byte+15byte)*2 + 1byte = 41byte</code> .</li>\n<li>å¦‚æœ <code>sds</code>  çš„é•¿åº¦å¤§äºç­‰äºé»˜è®¤çš„é¢„åˆ†é…ç©ºé—´ï¼Œé‚£ä¹ˆå°±åœ¨æ–°åˆ†é…çš„ç©ºé—´å¤§å°åŸºç¡€ä¸Šï¼Œåœ¨åˆ†é… <code>1MB</code>  çš„ç©ºé—´ã€‚å¦‚æœä¿®æ”¹åçš„ï¼Œ <code>SDS</code>  çš„ <code>len</code>  æ˜¯  <code>20M</code> ï¼Œé‚£ä¹ˆ <code>alloc</code>  å°±æ˜¯  <code>20M + 1M + 1byte</code></li>\n</ul>\n<p>å…·ä½“åˆ†é…è¿‡ç¨‹è§ä¸‹é¢çš„æºç </p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// SDS é»˜è®¤æœ€å¤§çš„é¢„åˆ†é…ç©ºé—´ä¸º1M</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> SDS_MAX_PREALLOC (1024*1024)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// sds é¢„åˆ†é…ç©ºé—´</span></span><br><span class=\"line\"><span class=\"function\">sds <span class=\"title\">sdsMakeRoomFor</span><span class=\"params\">(sds s, <span class=\"keyword\">size_t</span> addlen)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> *sh, *newsh;</span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> avail = <span class=\"built_in\">sdsavail</span>(s);</span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> len, newlen;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> type, oldtype = s[<span class=\"number\">-1</span>] &amp; SDS_TYPE_MASK;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> hdrlen;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* å¦‚æœç©ºé—´è¶³å¤Ÿï¼Œç›´æ¥è¿”å› */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (avail &gt;= addlen) <span class=\"keyword\">return</span> s;</span><br><span class=\"line\"></span><br><span class=\"line\">    len = <span class=\"built_in\">sdslen</span>(s);</span><br><span class=\"line\">    sh = (<span class=\"keyword\">char</span>*)s-<span class=\"built_in\">sdsHdrSize</span>(oldtype);</span><br><span class=\"line\">    newlen = (len+addlen);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newlen &lt; SDS_MAX_PREALLOC)</span><br><span class=\"line\">        newlen *= <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        newlen += SDS_MAX_PREALLOC;</span><br><span class=\"line\"></span><br><span class=\"line\">    type = <span class=\"built_in\">sdsReqType</span>(newlen);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* Don&#x27;t use type 5: the user is appending to the string and type 5 is</span></span><br><span class=\"line\"><span class=\"comment\">     * not able to remember empty space, so sdsMakeRoomFor() must be called</span></span><br><span class=\"line\"><span class=\"comment\">     * at every appending operation. */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type == SDS_TYPE_5) type = SDS_TYPE_8;</span><br><span class=\"line\"></span><br><span class=\"line\">    hdrlen = <span class=\"built_in\">sdsHdrSize</span>(type);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldtype==type) &#123;</span><br><span class=\"line\">        newsh = <span class=\"built_in\">s_realloc</span>(sh, hdrlen+newlen+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newsh == <span class=\"literal\">NULL</span>) <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        s = (<span class=\"keyword\">char</span>*)newsh+hdrlen;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/* Since the header size changes, need to move the string forward,</span></span><br><span class=\"line\"><span class=\"comment\">         * and can&#x27;t use realloc */</span></span><br><span class=\"line\">        newsh = <span class=\"built_in\">s_malloc</span>(hdrlen+newlen+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newsh == <span class=\"literal\">NULL</span>) <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"built_in\">memcpy</span>((<span class=\"keyword\">char</span>*)newsh+hdrlen, s, len+<span class=\"number\">1</span>);</span><br><span class=\"line\">        <span class=\"built_in\">s_free</span>(sh);</span><br><span class=\"line\">        s = (<span class=\"keyword\">char</span>*)newsh+hdrlen;</span><br><span class=\"line\">        s[<span class=\"number\">-1</span>] = type;</span><br><span class=\"line\">        <span class=\"built_in\">sdssetlen</span>(s, len);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">sdssetalloc</span>(s, newlen);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h6 id=\"æƒ°æ€§ç©ºé—´é‡Šæ”¾\"><a class=\"markdownIt-Anchor\" href=\"#æƒ°æ€§ç©ºé—´é‡Šæ”¾\">#</a> æƒ°æ€§ç©ºé—´é‡Šæ”¾</h6>\n<p>å½“å¯¹ sds è¿›è¡Œç¼©çŸ­æ“ä½œæ—¶ï¼Œç¨‹åºå¹¶ä¸ä¼šç«‹é©¬å¯¹å†…å­˜é‡åˆ†é…æ¥å›æ”¶æ”¶ç¼©çš„ç©ºé—´ï¼Œè€Œæ˜¯ä»…ä»…æ”¹å˜ <code>len</code>  å±æ€§ï¼Œå¹¶ä¸”åœ¨é˜Ÿå¯¹åº”çš„ä½ç½®ä¸Šå°†å­—ç¬¦è®¾ç½®ä¸º:  <code>'\\0'</code></p>\n<p>ä»¥ å‡½æ•°  <code>sdstrim</code>  ä¸ºä¾‹ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">sds <span class=\"title\">sdstrim</span><span class=\"params\">(sds s, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *cset)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *start, *end, *sp, *ep;</span><br><span class=\"line\">    <span class=\"keyword\">size_t</span> len;</span><br><span class=\"line\"></span><br><span class=\"line\">    sp = start = s;</span><br><span class=\"line\">    ep = end = s+<span class=\"built_in\">sdslen</span>(s)<span class=\"number\">-1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(sp &lt;= end &amp;&amp; <span class=\"built_in\">strchr</span>(cset, *sp)) sp++;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(ep &gt; sp &amp;&amp; <span class=\"built_in\">strchr</span>(cset, *ep)) ep--;</span><br><span class=\"line\">    len = (sp &gt; ep) ? <span class=\"number\">0</span> : ((ep-sp)+<span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"comment\">// è¿›è¡Œç§»ä½</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s != sp) <span class=\"built_in\">memmove</span>(s, sp, len);</span><br><span class=\"line\">    <span class=\"comment\">// è®¾ç½®å­—ç¬¦ä¸²ç»“æŸç¬¦</span></span><br><span class=\"line\">    s[len] = <span class=\"string\">&#x27;\\0&#x27;</span>;</span><br><span class=\"line\">    <span class=\"comment\">// è®¾ç½®lenå­—æ®µçš„å€¼</span></span><br><span class=\"line\">    <span class=\"built_in\">sdssetlen</span>(s,len);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸Šè¿°å®ç°ä¸­ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå†…å­˜å›æ”¶ã€‚ <code>sds</code>  ä¹Ÿæä¾›äº†å†…å­˜å›æ”¶çš„å‡½æ•° <code>sds_free</code> . å…·ä½“å¯ä»¥çœ‹ <code>Redis 5.0.7</code>  ç‰ˆæºç .  <code>sds.c</code>  ç¬¬ <code>1120</code>  è¡Œã€‚è¿™é‡Œä¸å†æ·±å…¥å­¦ä¹ äº†ã€‚</p>\n<h4 id=\"äºŒè¿›åˆ¶å®‰å…¨\"><a class=\"markdownIt-Anchor\" href=\"#äºŒè¿›åˆ¶å®‰å…¨\">#</a> äºŒè¿›åˆ¶å®‰å…¨</h4>\n<p><code>sds</code>  çš„ <code>API</code>  éƒ½æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚å› ä¸º <code>Redis</code>  å¯¹  <code>sds</code>  ç»“æ„ä¸­çš„ <code>buf</code>  æ•°ç»„ä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å¤„ç†çš„ã€‚</p>\n<h4 id=\"å…¼å®¹éƒ¨åˆ†çš„cå­—ç¬¦ä¸²å‡½æ•°\"><a class=\"markdownIt-Anchor\" href=\"#å…¼å®¹éƒ¨åˆ†çš„cå­—ç¬¦ä¸²å‡½æ•°\">#</a> å…¼å®¹éƒ¨åˆ†çš„ <code>C</code>  å­—ç¬¦ä¸²å‡½æ•°</h4>\n<p><code>Redis</code>  è¿˜æ˜¯éµå¾ªäº† <code>C</code>  å­—ç¬¦ä¸²ä»¥  <code>'\\0'</code>  ç»“å°¾çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥ä¿å­˜äº†æ–‡æœ¬æ•°æ®çš„ <code>sds</code>  æ˜¯å¯ä»¥å¤ç”¨  <code>&lt;string.h&gt;</code>  åº“ä¸­çš„å‡½æ•°ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h3>\n<ul>\n<li>\n<p><code>string</code>  æ˜¯ <code>redis</code>  ä¸­æœ€ç®€å•çš„æ•°æ®ç»“æ„.  <code>string</code>  ä¸æ˜¯ <code>C</code>  å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å¯¹ <code>C</code>  å­—ç¬¦ä¸²è¿›è¡Œäº†å°è£….</p>\n</li>\n<li>\n<p>å­¦ä¹ äº† <code>string</code>  ç±»å‹ç›¸å…³çš„ <code>api</code> ã€‚  <code>set</code> , <code>setnx</code> , <code>setex</code> ,  <code>get</code> ,  <code>getset</code> ,  <code>incr</code> ,  <code>decr</code> ,â€¦</p>\n</li>\n<li>\n<p><code>sds</code>  è¿™ç§è®¾è®¡çš„å¥½å¤„ï¼Œæé«˜äº†æ€§èƒ½ï¼Œä¼˜åŒ–å†…å­˜åˆ†é…ï¼ŒäºŒè¿›åˆ¶å®‰å…¨ï¼Œå…¼å®¹ <code>C</code>  å­—ç¬¦ä¸²ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/02-Redis%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/02-Redis%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/",
            "title": "Redis å¤šä¸ªæ•°æ®åº“",
            "date_published": "2021-08-01T06:48:55.000Z",
            "content_html": "<p><code>Redis</code>  é»˜è®¤æä¾›äº† <code>16</code>  ä¸ªæ•°æ®åº“ã€‚æ¯ä¸ªæ•°æ®åº“éƒ½æœ‰ä¸€ä¸ª <code>id</code> , ä»  <code>0</code>  å¼€å§‹ï¼Œ[0,15]ã€‚ ä¸åŒçš„æ•°æ®åº“ä¸­æ•°æ®éš”ç¦»ä¿å­˜ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ redis çš„é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ•°æ®åº“çš„æ•°é‡ã€‚</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">database</span> <span class=\"string\">32</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>ä½¿ç”¨  <code>select &lt;ID&gt;</code>  å¯ä»¥åˆ‡æ¢æ•°æ®åº“.</li>\n</ul>\n<p>ç¤ºä¾‹å¦‚ä¸‹:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; select 1</span><br><span class=\"line\">OK</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ¼”ç¤ºæ•°æ®éš”ç¦»</span></span><br><span class=\"line\">127.0.0.1:6379[1]&gt; <span class=\"built_in\">set</span> <span class=\"built_in\">test</span> 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379[1]&gt; select 2</span><br><span class=\"line\">Ok</span><br><span class=\"line\">127.0.0.1:6379[2]&gt; get <span class=\"built_in\">test</span></span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥é€šè¿‡å‘½ä»¤ä¹‹å‰çš„éƒ¨åˆ†åŒºåˆ†æˆ‘ä»¬æ‰€åœ¨çš„æ•°æ®åº“.<br>\n <code>127.0.0.1:6379[2]&gt; select 2</code>  æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯åœ¨æ•°æ®åº“ <code>1</code>  ä¸­çš„ã€‚</p>\n<ul>\n<li>ä½¿ç”¨  <code>flushdb</code>  åªèƒ½åˆ é™¤ <b>è¯¥æ•°æ®åº“ (ä¸€ä¸ªåº“)</b> ä¸­çš„æ•°æ®ã€‚</li>\n<li>ä½¿ç”¨  <code>flushall</code>  å¯ä»¥åˆ é™¤ <b>æ‰€æœ‰åº“</b> ä¸­çš„æ•°æ®ã€‚</li>\n</ul>\n<h2 id=\"redisä½¿ç”¨åˆ†åº“çš„æ„ä¹‰\"><a class=\"markdownIt-Anchor\" href=\"#redisä½¿ç”¨åˆ†åº“çš„æ„ä¹‰\">#</a> redis ä½¿ç”¨åˆ†åº“çš„æ„ä¹‰</h2>\n<ul>\n<li>é¿å…ä¸åŒåº”ç”¨ç›¸åŒ <code>key</code>  çš„å½±å“ã€‚</li>\n<li>æ›´ä¾¿äºç®¡ç†ã€‚<br>\nä¸€ä¸ªå®ä¾‹ä¸Šè¿è¡Œå¤šä¸ªåº“ï¼Œåªè¿ç»´è¿™ä¸€ä¸ªå®ä¾‹å°±å¯ä»¥äº†ã€‚</li>\n<li>ä¹Ÿæœ‰ä¸å°‘æ–‡ç« è¯´ï¼Œredis çš„ä½œè€…æ›¾è¯´è¿‡ï¼Œâ€œå¤šæ•°æ®åº“çš„è®¾è®¡å¯èƒ½æ˜¯æœ€ç³Ÿç³•çš„å†³å®š.â€. Redis æ˜¯å•çº¿ç¨‹çš„ï¼Œå³ä½¿æ˜¯å¤šæ•°æ®åº“ä¹Ÿä¸ä¼šå¸¦æ¥æ€§èƒ½æå‡ã€‚ä½†æ˜¯è¿™ä¸ªå¹¶æ²¡æœ‰å’Œå‰é¢çš„ä¸¤ä¸ªå¥½å¤„å†²çªã€‚ä¸‹é¢æ˜¯ä½œè€…çš„åŸè¯:</li>\n</ul>\n<blockquote>\n<p>I understand how this can be useful, but unfortunately I consider Redis multiple database errors my worst decision in Redis design at allâ€¦ without any kind of real gain, it makes the internals a lot more complex. The reality is that databases donâ€™t scale well for a number of reason, like active expire of keys and VM. If the DB selection can be performed with a string I can see this feature being used as a scalable O(1) dictionary layer, that instead it is not.</p>\n</blockquote>\n<blockquote>\n<p>With DB numbers, with a default of a few DBs, we are communication better what this feature is and how can be used I think. I hope that at some point we can drop the multiple DBs support at all, but I think it is probably too late as there is a number of people relying on this feature for their work.</p>\n</blockquote>\n<h3 id=\"redisçš„åˆ†åº“æ˜¯æ€ä¹ˆå®ç°\"><a class=\"markdownIt-Anchor\" href=\"#redisçš„åˆ†åº“æ˜¯æ€ä¹ˆå®ç°\">#</a> Redis çš„åˆ†åº“æ˜¯æ€ä¹ˆå®ç°ï¼Ÿ</h3>\n<p><code>Redis</code>  æœåŠ¡å™¨é—´æ‰€æœ‰çš„æ•°æ®åº“éƒ½ä¿å­˜åœ¨ æœåŠ¡å™¨çŠ¶æ€  <code>redis.h/redisServer</code>  ç»“æ„çš„ db æ•°ç»„ä¸­ã€‚ <code>db</code>  æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª  <code>redis.h/redisDb</code>  ç»“æ„ã€‚æ¯ä¸ª <code>redisDb</code>  ç»“æ„ä»£è¡¨ä¸€ä¸ªæ•°æ®åº“.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">redisServer</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// ä¿å­˜æ‰€æœ‰æ•°æ®åº“</span></span><br><span class=\"line\">    redisDb *db;</span><br><span class=\"line\">    <span class=\"comment\">// æ•°æ®åº“çš„æ•°é‡(redis.confæ–‡ä»¶ä¸­ databaseé…ç½®çš„)</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> dbnum;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ¯ä¸ª <code>Redis</code>  å®¢æˆ·ç«¯éƒ½æœ‰è‡ªå·±çš„ç›®æ ‡æ•°æ®åº“ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œæ•°æ®åº“å†™å‘½ä»¤æˆ–è€…æ•°æ®åº“è¯»å‘½ä»¤çš„æ—¶å€™ï¼Œç›®æ ‡æ•°æ®åº“éƒ½ä¼šæˆä¸ºè¿™äº›å‘½ä»¤çš„æ“ä½œå¯¹è±¡.<br>\n æ¯ä¸ªå®¢æˆ·ç«¯ç”¨  <code>RedisClient</code>  æ¥æè¿°ã€‚  <code>RedisClient</code>  ç»“æ„çš„ <code>db</code>  å±æ€§è®°å½•äº†å®¢æˆ·ç«¯å½“å‰çš„ç›®æ ‡æ•°æ®åº“ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘  <code>redisDb</code>  çš„æŒ‡é’ˆ.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">redisClient</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// è®°å½•å®¢æˆ·ç«¯ç«¯æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“id</span></span><br><span class=\"line\">    redisDb *db;</span><br><span class=\"line\">&#125; redisClient;</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä¸¾ä¸ªä¾‹å­\"><a class=\"markdownIt-Anchor\" href=\"#ä¸¾ä¸ªä¾‹å­\">#</a> ä¸¾ä¸ªä¾‹å­:</h4>\n<p>å‡è®¾æˆ‘ä»¬å®¢æˆ·ç«¯è¿æ¥çš„æ˜¯æ•°æ®åº“ <code>1</code> , é‚£ä¹ˆå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯ä¹‹é—´çš„å…³ç³»æ˜¯è¿™æ ·çš„:</p>\n<p><img data-src=\"./images/00-01%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"00-01å¤šæ•°æ®åº“ç¤ºæ„å›¾\"></p>\n<p>å¦‚æœæˆ‘ä»¬è¿è¡Œ  <code>select 2</code> , å…¶å®ï¼Œå°±æ˜¯æ”¹å˜çš„ db çš„æŒ‡é’ˆã€‚è®©å®ƒæŒ‡å‘äº†  <code>db(2)</code> , è¿™å°±æ˜¯  <code>select</code>  å‘½ä»¤çš„è¿è¡ŒåŸç†ã€‚å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"./images/00-02%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"00-02å¤šæ•°æ®åº“ç¤ºæ„å›¾\"></p>\n<p>ä»¥ä¸Šå°±æ˜¯ å…³äº  <code>Redis</code>  å¤šæ•°æ®åº“çš„å†…å®¹äº†ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-Redis%E7%AE%80%E4%BB%8B%E4%BB%A5%E5%8F%8A%E4%B8%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AF%B9%E6%AF%94/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-Redis%E7%AE%80%E4%BB%8B%E4%BB%A5%E5%8F%8A%E4%B8%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AF%B9%E6%AF%94/",
            "title": "Redis ç®€ä»‹",
            "date_published": "2021-08-01T06:40:55.000Z",
            "content_html": "<p><code>Redis</code>  æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç ï¼ˆ <code>BSD</code>  è®¸å¯ï¼‰çš„å†…å­˜ä¸­æ•°æ®ç»“æ„å­˜å‚¨ï¼Œç”¨ä½œæ•°æ®åº“ï¼Œç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚å®ƒæ”¯æŒæ•°æ®ç»“æ„ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ï¼Œå“ˆå¸Œï¼Œåˆ—è¡¨ï¼Œé›†åˆï¼Œå¸¦èŒƒå›´æŸ¥è¯¢çš„æ’åºé›†åˆï¼Œä½å›¾ ( <code>bitMap</code> )ï¼Œè¶…æ—¥å¿— ( <code>hyperlog</code> )ï¼Œå¸¦æœ‰åŠå¾„æŸ¥è¯¢å’Œæµçš„åœ°ç†ç©ºé—´ç´¢å¼• ( <code>geohash</code> )ã€‚ <code>Redis</code>  è¿˜å†…ç½®äº†å‰¯æœ¬ï¼Œ <code>Lua</code>  è„šæœ¬ï¼Œ <code>LRU</code>  é©±é€ç­–ç•¥ï¼Œäº‹åŠ¡å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…æ€§ï¼Œå¹¶é€šè¿‡ <code>Redis Sentinel</code>  å’Œ <code>Redis Cluster</code>  è‡ªåŠ¨åˆ†åŒºæä¾›äº†é«˜å¯ç”¨æ€§ã€‚</p>\n<p><code>Redis</code>  è¿˜æ”¯æŒä¸€ä¸‹ç‰¹æ€§:</p>\n<ul>\n<li>äº‹åŠ¡</li>\n<li>å‘å¸ƒ / è®¢é˜…æ¨¡å¼</li>\n<li><code>lua</code>  è„šæœ¬</li>\n<li>é”®å€¼çš„å…è®¸ç”Ÿå­˜æ—¶é•¿.</li>\n<li><code>LRU</code>  é©±é€</li>\n<li>æ•…éšœè‡ªåŠ¨è½¬ç§»</li>\n</ul>\n<h2 id=\"ä¸å…¶ä»–æ•°æ®åº“å¯¹æ¯”\"><a class=\"markdownIt-Anchor\" href=\"#ä¸å…¶ä»–æ•°æ®åº“å¯¹æ¯”\">#</a> ä¸å…¶ä»–æ•°æ®åº“å¯¹æ¯”</h2>\n<p>ä¸å…¶ä»–æ•°æ®åº“çš„å¯¹æ¯”:</p>\n<table>\n<thead>\n<tr>\n<th>-</th>\n<th>Redis</th>\n<th>MongoDB</th>\n<th>Hbase</th>\n<th>Mysql</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>æ•°æ®åº“ç±»å‹</td>\n<td>NoSQL</td>\n<td>NOSQL</td>\n<td>NoSQL</td>\n<td>å…³ç³»å‹æ•°æ®åº“</td>\n</tr>\n<tr>\n<td>æ•°æ®ç±»å‹</td>\n<td>key-value, æä¾› String,List,zet ç­‰å¤šç§ç»“æ„</td>\n<td>Collection.Document.BSON</td>\n<td>åŸºäºåˆ—æ¨¡å¼çš„æ˜ å°„æ•°æ®åº“ï¼Œå¯è¡¨ç¤ºç®€å•çš„ key-value çš„æ˜ å°„å…³ç³»ã€‚</td>\n<td>DB.table.row/col</td>\n</tr>\n<tr>\n<td>æŒä¹…åŒ–</td>\n<td>æ”¯æŒ (RDB/AOF)</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒé›†ç¾¤</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n</tr>\n<tr>\n<td>ä½¿ç”¨åœºæ™¯</td>\n<td>ç¼“å­˜ (å†…å­˜ç¨³å®šï¼Œè¯»å†™æ€§èƒ½æä½³), è¯»å¤šå†™å°‘</td>\n<td>ä½¿ç”¨ Mysql ç­‰å…³ç³»å‹æ•°æ®åº“ï¼Œä½†æ˜¯ä¼šé‡åˆ°è¡¨ç»“æ„ä¸ç¨³å®šçš„æ—¶å€™ (çµæ´»)</td>\n<td>æ•°æ®åº“å¤§ï¼Œç‰¹åˆ«å¤§ï¼Œåˆ—æ•°æ®åº“ï¼Œé€‚åˆå†™å¤šè¯»å°‘çš„åœºæ™¯</td>\n<td>å¸¸è§„çš„æ•°æ®å­˜å‚¨</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒç´¢å¼•</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n</tr>\n<tr>\n<td>æ˜¯å¦æ”¯æŒäº‹åŠ¡</td>\n<td>æ”¯æŒ</td>\n<td>ä¸æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n<td>æ”¯æŒ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-%E5%AE%89%E8%A3%85%E5%8D%95%E6%9C%BA%E7%89%88Redis/",
            "url": "https://fangjiaxiaobai.github.io/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-%E5%AE%89%E8%A3%85%E5%8D%95%E6%9C%BA%E7%89%88Redis/",
            "title": "Redisçš„å•æœºéƒ¨ç½²",
            "date_published": "2021-08-01T06:38:55.000Z",
            "content_html": "<h1 id=\"æºç å®‰è£…\"><a class=\"markdownIt-Anchor\" href=\"#æºç å®‰è£…\">#</a> æºç å®‰è£…</h1>\n<h2 id=\"ä¸‹è½½åœ°å€\"><a class=\"markdownIt-Anchor\" href=\"#ä¸‹è½½åœ°å€\">#</a> ä¸‹è½½åœ°å€</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2Rvd25sb2FkLnJlZGlzLmlvL3JlbGVhc2VzL3JlZGlzLTUuMC43LnRhci5neg==\">http://download.redis.io/releases/redis-5.0.7.tar.gz</span></p>\n<h2 id=\"å®‰è£…æ­¥éª¤\"><a class=\"markdownIt-Anchor\" href=\"#å®‰è£…æ­¥éª¤\">#</a> å®‰è£…æ­¥éª¤</h2>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://download.redis.io/releases/redis-5.0.7.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar xvf redis-5.0.7.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">[root@fangjiaxiaobai <span class=\"built_in\">local</span>]<span class=\"comment\"># cd ./redis-5.0.7/</span></span><br><span class=\"line\">[root@fangjiaxiaobai redis-5.0.7]<span class=\"comment\"># make &amp;&amp; make install</span></span><br><span class=\"line\"></span><br><span class=\"line\">Hint: It<span class=\"string\">&#x27;s a good idea to run &#x27;</span>make <span class=\"built_in\">test</span><span class=\"string\">&#x27; ;)</span></span><br><span class=\"line\"><span class=\"string\"># å‡ºç°ä¸Šé¢çš„æç¤ºä»£è¡¨æˆåŠŸäº†</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯èƒ½å‡ºç°ä»¥ä¸‹é”™è¯¯\"><a class=\"markdownIt-Anchor\" href=\"#å¯èƒ½å‡ºç°ä»¥ä¸‹é”™è¯¯\">#</a> å¯èƒ½å‡ºç°ä»¥ä¸‹é”™è¯¯:</h3>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/sh: cc: <span class=\"built_in\">command</span> not found</span><br><span class=\"line\">è§£å†³æ–¹æ¡ˆ: yum install gcc</span><br><span class=\"line\"></span><br><span class=\"line\">jemalloc/jemalloc.h: No such file or directory</span><br><span class=\"line\">åŸå› æ˜¯jemallocé‡è½½äº†Linuxä¸‹çš„ANSI Cçš„mallocå’Œfreeå‡½æ•°ã€‚è§£å†³åŠæ³•ï¼šmakeæ—¶æ·»åŠ å‚æ•°ã€‚</span><br><span class=\"line\"></span><br><span class=\"line\">è§£å†³æ–¹æ¡ˆ: make MALLOC=libc</span><br></pre></td></tr></table></figure>\n<h3 id=\"å¯åŠ¨\"><a class=\"markdownIt-Anchor\" href=\"#å¯åŠ¨\">#</a> å¯åŠ¨</h3>\n<p>[root@fangjiaxiaobai ~]# cd /usr/local/redis-5.0.7/src/</p>\n<p>[root@fangjiaxiaobai init.d]# ./redis_6379 start</p>\n<h3 id=\"å…³é—­\"><a class=\"markdownIt-Anchor\" href=\"#å…³é—­\">#</a> å…³é—­</h3>\n<p>[root@fangjiaxiaobai src]# ./redis-cli -p 6379 shutdown</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/24/MySQL-series/MySQL-1-01.MySQL_version/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/24/MySQL-series/MySQL-1-01.MySQL_version/",
            "title": "01.æ•°æ®åº“ç‰ˆæœ¬",
            "date_published": "2021-07-24T06:48:55.000Z",
            "content_html": "<h2 id=\"mysqlæ•°æ®åº“çš„ç‰ˆæœ¬\"><a class=\"markdownIt-Anchor\" href=\"#mysqlæ•°æ®åº“çš„ç‰ˆæœ¬\">#</a>  <code>MySQL</code>  æ•°æ®åº“çš„ç‰ˆæœ¬</h2>\n<p><code>mysql-5.0</code>   :   <code>mysql-5.0</code>  ç‰ˆæœ¬ä¹‹å‰ï¼Œ <code>myisam</code>  é»˜è®¤æ”¯æŒçš„è¡¨å¤§å°ä¸º <code>4G</code> ã€‚ä» <code>mysql-5.0</code>  ä»¥åï¼Œ <code>MyISAM</code>  é»˜è®¤æ”¯æŒ <code>256T</code>  çš„è¡¨å•æ•°æ®ã€‚ <code>myisam</code>  åªç¼“å­˜ç´¢å¼•æ•°æ®ã€‚  <code>2005</code>  å¹´çš„ <code>5.0</code>  ç‰ˆæœ¬åˆæ·»åŠ äº†å­˜å‚¨è¿‡ç¨‹ã€æœåŠ¡ç«¯æ¸¸æ ‡ã€è§¦å‘å™¨ã€æŸ¥è¯¢ä¼˜åŒ–ä»¥åŠåˆ†å¸ƒå¼äº‹åŠ¡åŠŸèƒ½ã€‚</p>\n<p><code>MySQL5.1</code>   :   <code>2008</code>  å¹´å‘å¸ƒçš„ <code>MySQL 5.1</code>  çš„ç‰ˆæœ¬ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªå¢åŠ äº†å´©æºƒæ¢å¤åŠŸèƒ½çš„ <code>MyISAM</code> ï¼Œä½¿ç”¨è¡¨çº§é”ï¼Œä½†å¯ä»¥åšåˆ°è¯»å†™ä¸å†²çªï¼Œå³åœ¨è¿›è¡Œä»»ä½•ç±»å‹çš„æ›´æ–°æ“ä½œçš„åŒæ—¶éƒ½å¯ä»¥è¿›è¡Œè¯»æ“ä½œï¼Œä½†å¤šä¸ªå†™æ“ä½œä¸èƒ½å¹¶å‘ã€‚</p>\n<p><code>mysql5.5</code>  :   <code>2010</code>  å¹´ <code>12</code>  æœˆå‘å¸ƒ <code>mysql5.5</code>  ç‰ˆæœ¬é»˜è®¤å­˜å‚¨å¼•æ“æ›´æ”¹ä¸º <code>InnoDB</code>  å¤šä¸ªå›æ»šæ®µï¼ˆ <code>Multiple Rollback Segments</code> ï¼‰, ä¹‹å‰çš„ <code>innodb</code>  ç‰ˆæœ¬æœ€å¤§èƒ½å¤„ç† <code>1023</code>  ä¸ªå¹¶å‘å¤„ç†æ“ä½œï¼Œç°åœ¨ <code>mysql5.5</code>  å¯ä»¥å¤„ç†é«˜è¾¾ 128K çš„å¹¶å‘äº‹åŠ¡ï¼Œæ”¹å–„äº‹åŠ¡å¤„ç†ä¸­çš„å…ƒæ•°æ®é”å®šã€‚ä¾‹å¦‚ï¼Œäº‹ç‰©ä¸­ä¸€ä¸ªè¯­å¥éœ€è¦é”ä¸€ä¸ªè¡¨ï¼Œä¼šåœ¨äº‹ç‰©ç»“æŸæ—¶é‡Šæ”¾è¿™ä¸ªè¡¨ï¼Œè€Œä¸æ˜¯åƒä»¥å‰åœ¨è¯­å¥ç»“æŸæ—¶é‡Šæ”¾è¡¨ã€‚ å¢åŠ äº† <code>INFORMATION_SCHEMA</code>  è¡¨ï¼Œæ–°çš„è¡¨æä¾›äº†ä¸ InnoDB å‹ç¼©å’Œäº‹åŠ¡å¤„ç†é”å®šæœ‰å…³çš„å…·ä½“ä¿¡æ¯ã€‚</p>\n<h3 id=\"mysql56\"><a class=\"markdownIt-Anchor\" href=\"#mysql56\">#</a> mysql5.6</h3>\n<p><code>2013</code>  å¹´ <code>2</code>  æœˆå‘å¸ƒã€‚</p>\n<ul>\n<li>\n<p>å®‰å…¨æ€§è¿›è¡Œäº†åŠ å¼ºã€‚ç”¨æˆ·çš„è´¦å·å’Œå¯†ç è¿›è¡Œäº†æ›´å¼ºçš„åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ <code>sha256_passwordSHA-256</code>  å¯†ç å“ˆå¸Œçš„èº«ä»½éªŒè¯æ’ä»¶æ¥è¿›è¡ŒåŠ å¯†ã€‚ <code>mysql.user</code>  è¡¨ä¸­æ–°å¢äº† <code>password_expired</code>  å­—æ®µï¼Œè¿‡æœŸåï¼Œæ‰€æœ‰è¿æ¥çš„æ‰§è¡Œéƒ½ä¼šæŠ¥å‡ºå¼‚å¸¸ã€‚</p>\n</li>\n<li>\n<p><code>MySQL Server</code>  çš„å‚æ•°é»˜è®¤å€¼è¿›è¡Œäº†æ›´æ”¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:</p>\n</li>\n</ul>\n<p><img data-src=\"/images/MySQL-series/10101-MySQL5.6Server%E7%AB%AF%E5%8F%82%E6%95%B0%E4%BF%AE%E6%94%B9%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC.png\" alt=\"10101-MySQL5.6Serverç«¯å‚æ•°ä¿®æ”¹çš„é»˜è®¤å€¼.png\"></p>\n<ul>\n<li>\n<p><code>mysql5.6</code>  ç‰ˆæœ¬ä¸­ <code>InnoDB</code>  å¯ä»¥é™åˆ¶å¤§é‡è¡¨æ‰“å¼€çš„æ—¶å€™å†…å­˜å ç”¨è¿‡å¤šçš„é—®é¢˜ <code>InnoDB</code>  æ€§èƒ½åŠ å¼ºã€‚å¦‚å¤§å†…å­˜ä¼˜åŒ–ç­‰ <code>InnoDB</code>  æ­»é”ä¿¡æ¯å¯ä»¥è®°å½•åˆ°  <code>error</code>  æ—¥å¿—ï¼Œ<br>\n<b> <code>InnoDB</code>  å¼•æ“ä¹Ÿæ”¯æŒäº† <code>FULLTEXT</code>  ç´¢å¼•</b>ã€‚å¹¶ä½¿ç”¨ <code>MATCH() ... AGAINST</code>  è¯­æ³•æŸ¥è¯¢å®ƒä»¬ã€‚ <code>ALTER TABLE </code> åœ¨ä¸å¤åˆ¶è¡¨ï¼Œä¸é˜»æ­¢å¯¹è¡¨çš„æ’å…¥ï¼Œæ›´æ–°å’Œåˆ é™¤æˆ–ä¸¤è€…éƒ½ä¸è¿›è¡Œçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‰§è¡Œå¤šç§æ“ä½œã€‚<b> <code>InnoDB</code>  ä½¿ç”¨æ›´å¿«çš„æ–°ç®—æ³•æ¥æ£€æµ‹ æ­»é”</b></p>\n</li>\n<li>\n<p>åˆ†åŒºåŠŸèƒ½</p>\n<ul>\n<li>åˆ†åŒºçš„æœ€å¤§æ•°é‡å¢åŠ åˆ° <code>8192</code> ã€‚æ­¤æ•°é‡åŒ…æ‹¬è¡¨çš„æ‰€æœ‰åˆ†åŒºå’Œæ‰€æœ‰å­åˆ†åŒºã€‚</li>\n</ul>\n</li>\n<li>\n<p>å¤åˆ¶å’Œæ—¥å¿—è®°å½•</p>\n<ul>\n<li><code>MySQL</code>  ç°åœ¨æ”¯æŒä½¿ç”¨å…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ï¼ˆä¹Ÿç§°ä¸º  <code>GTID</code> ï¼‰è¿›è¡ŒåŸºäºäº‹åŠ¡çš„å¤åˆ¶ ã€‚è¿™æ ·ï¼Œå½“æ¯ä¸ªäº‹åŠ¡åœ¨åŸå§‹æœåŠ¡å™¨ä¸Šæäº¤å¹¶è¢«ä»»ä½•ä»å±æœåŠ¡å™¨åº”ç”¨æ—¶ï¼Œå°±å¯ä»¥è¯†åˆ«å’Œè·Ÿè¸ªæ¯ä¸ªäº‹åŠ¡ã€‚</li>\n<li><code>MySQL</code>  åŸºäºè¡Œçš„å¤åˆ¶ä»è¯¥ç‰ˆæœ¬å¼€å§‹æ”¯æŒè¡Œå›¾åƒæ§åˆ¶</li>\n</ul>\n</li>\n<li>\n<p>ä¼˜åŒ–å™¨å¢å¼ºåŠŸèƒ½</p>\n<ul>\n<li><code>limit</code>  æŸ¥è¯¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¦‚æœ <code>N</code>  è¡Œå…ƒç´ å°äºæ’åºç¼“å†²åŒºï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å†…å­˜æ’åºè€Œä¸æ˜¯åˆå¹¶æ–‡ä»¶ã€‚</li>\n<li>ä¼˜åŒ–å™¨å¯ä»¥æ›´æœ‰æ•ˆåœ°å¤„ç† <code>FROM</code>  å­å¥ä¸­çš„å­æŸ¥è¯¢ ï¼ˆå³æ´¾ç”Ÿè¡¨ï¼‰ã€‚FROM å­å¥ä¸­å­æŸ¥è¯¢çš„å®ç° è¢«æ¨è¿Ÿåˆ°æŸ¥è¯¢æ‰§è¡ŒæœŸé—´éœ€è¦å…¶å†…å®¹æ—¶ä¸ºæ­¢ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚åœ¨æŸ¥è¯¢æ‰§è¡ŒæœŸé—´ï¼Œä¼˜åŒ–å™¨å¯ä»¥å°†ç´¢å¼•æ·»åŠ åˆ°æ´¾ç”Ÿè¡¨ä¸­ï¼Œä»¥åŠ å¿«ä»ä¸­è·å–è¡Œçš„é€Ÿåº¦ã€‚</li>\n</ul>\n</li>\n<li>\n<p>æ•°æ®ç±»å‹</p>\n<ul>\n<li><code>MySQL</code>  ä» <code>5.6</code>  å¼€å§‹å…è®¸ <code>TIME</code> ï¼Œ <code>DATETIME</code>  å’Œ <code>TIMESTAMP</code>  å€¼çš„å°æ•°ç§’ï¼Œç²¾åº¦é«˜è¾¾å¾®ç§’ï¼ˆ <code>6</code>  ä½ï¼‰ã€‚\n<ul>\n<li>å–æ¶ˆäº†æ¯ä¸ªè¡¨æœ€å¤šå¯ä»¥è‡ªåŠ¨å°† <code>TIMESTAMP</code>  åˆ—åˆå§‹åŒ–æˆ–æ›´æ–°ä¸ºå½“å‰æ—¥æœŸå’Œæ—¶é—´çš„é™åˆ¶ã€‚ä»»ä½• <code>TIMESTAMP</code>  åˆ—å®šä¹‰éƒ½å¯ä»¥å…·æœ‰ <code>DEFAULT CURRENT_TIMESTAMP</code>  å’Œ <code>ON UPDATE CURRENT_TIMESTAMP</code>  å­å¥çš„ä»»æ„ç»„åˆã€‚æ­¤å¤–ï¼Œè¿™äº›å­å¥ç°åœ¨å¯ä»¥ä¸ DATETIME åˆ—å®šä¹‰ä¸€èµ·ä½¿ç”¨ã€‚</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>ä¸»æœºç¼“å­˜ã€‚<br>\n <code>MySQL</code>  ç°åœ¨æä¾›æœ‰å…³å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶å‘ç”Ÿé”™è¯¯çš„åŸå› çš„æ›´å¤šä¿¡æ¯ï¼Œä»¥åŠå¯¹ä¸»æœºç¼“å­˜çš„æ”¹è¿›è®¿é—®ï¼Œè¯¥ç¼“å­˜åŒ…å«å®¢æˆ·ç«¯ <code>IP</code>  åœ°å€å’Œä¸»æœºåä¿¡æ¯ï¼Œç”¨äºé¿å… <code>DNS</code>  æŸ¥æ‰¾ã€‚</p>\n</li>\n</ul>\n<h3 id=\"mysql57\"><a class=\"markdownIt-Anchor\" href=\"#mysql57\">#</a> mysql5.7</h3>\n<ul>\n<li>\n<p>å°†  <code>Undo</code>  ä»å…±äº«è¡¨ç©ºé—´  <code>ibdata</code>  æ–‡ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¯ä»¥åœ¨å®‰è£…  <code>MySQL</code>  æ—¶ç”±ç”¨æˆ·è‡ªè¡ŒæŒ‡å®šæ–‡ä»¶å¤§å°å’Œæ•°é‡ã€‚</p>\n</li>\n<li>\n<p>å¢åŠ äº†  <code>temporary</code>  ä¸´æ—¶è¡¨ç©ºé—´ï¼Œé‡Œé¢å­˜å‚¨ç€ä¸´æ—¶è¡¨æˆ–ä¸´æ—¶æŸ¥è¯¢ç»“æœé›†çš„æ•°æ®ã€‚</p>\n</li>\n<li>\n<p><code>Buffer Pool</code>  å¤§å°å¯ä»¥åŠ¨æ€ä¿®æ”¹ï¼Œæ— éœ€é‡å¯æ•°æ®åº“å®ä¾‹ï¼Œè¿™æ˜¯  <code>DBA</code>  çš„ç¦éŸ³ã€‚</p>\n</li>\n</ul>\n<h3 id=\"mysql-80-ç‰ˆæœ¬æ–°ç‰¹æ€§å¦‚ä¸‹\"><a class=\"markdownIt-Anchor\" href=\"#mysql-80-ç‰ˆæœ¬æ–°ç‰¹æ€§å¦‚ä¸‹\">#</a> MySQL 8.0 ç‰ˆæœ¬æ–°ç‰¹æ€§å¦‚ä¸‹ï¼š</h3>\n<ul>\n<li>\n<p>å°†  <code>InnoDB</code>  è¡¨çš„æ•°æ®å­—å…¸å’Œ  <code>Undo</code>  éƒ½ä»å…±äº«è¡¨ç©ºé—´  <code>ibdata</code>  ä¸­å½»åº•åˆ†ç¦»å‡ºæ¥äº†ï¼Œä»¥å‰éœ€è¦ <code>ibdata</code>  æ–‡ä»¶ä¸­æ•°æ®å­—å…¸ä¸ç‹¬ç«‹è¡¨ç©ºé—´  <code>ibd</code>  æ–‡ä»¶ä¸­æ•°æ®å­—å…¸ä¸€è‡´æ‰è¡Œï¼Œ <code>8.0</code>  ç‰ˆæœ¬å°±ä¸éœ€è¦äº†ã€‚</p>\n</li>\n<li>\n<p><code>temporary</code>  ä¸´æ—¶è¡¨ç©ºé—´ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªç‰©ç†æ–‡ä»¶ï¼Œè€Œä¸”å‡ä¸º  <code>InnoDB</code>  å­˜å‚¨å¼•æ“å¹¶èƒ½åˆ›å»ºç´¢å¼•ï¼Œè¿™æ ·åŠ å¿«äº†å¤„ç†çš„é€Ÿåº¦ã€‚</p>\n</li>\n<li>\n<p>ç”¨æˆ·å¯ä»¥åƒ  <code>Oracle</code>  æ•°æ®åº“é‚£æ ·è®¾ç½®ä¸€äº›è¡¨ç©ºé—´ï¼Œæ¯ä¸ªè¡¨ç©ºé—´å¯¹åº”å¤šä¸ªç‰©ç†æ–‡ä»¶ï¼Œæ¯ä¸ªè¡¨ç©ºé—´å¯ä»¥ç»™å¤šä¸ªè¡¨ä½¿ç”¨ï¼Œä½†ä¸€ä¸ªè¡¨åªèƒ½å­˜å‚¨åœ¨ä¸€ä¸ªè¡¨ç©ºé—´ä¸­ã€‚</p>\n</li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/23/MySQL-series/MySQL-1-00.intro/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/23/MySQL-series/MySQL-1-00.intro/",
            "title": "00.å¼€ç¯‡&&è¯´æ˜",
            "date_published": "2021-07-23T06:48:55.000Z",
            "content_html": "<h2 id=\"ç‰ˆæœ¬è¯´æ˜\"><a class=\"markdownIt-Anchor\" href=\"#ç‰ˆæœ¬è¯´æ˜\">#</a> ç‰ˆæœ¬è¯´æ˜</h2>\n<p>æœ¬ç³»åˆ—æ–‡ç« ï¼Œä»¥ MySQL 8.0.20 ç‰ˆæœ¬ä¸ºå®éªŒèƒŒæ™¯è¿›è¡Œç¼–å†™ã€‚</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9pbnRlcm5hbHMvZW4vYmluYXJ5LWxvZy1vdmVydmlldy5odG1s\">MySQL æ‰‹å†Œ</span></p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "MySQL"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/23/Redis%E7%B3%BB%E5%88%97/00-%E5%89%8D%E8%A8%80/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/23/Redis%E7%B3%BB%E5%88%97/00-%E5%89%8D%E8%A8%80/",
            "title": "Redis å¼€ç¯‡æ‚è°ˆ",
            "date_published": "2021-07-23T06:28:55.000Z",
            "content_html": "<h2 id=\"æ‚è°ˆ\"><a class=\"markdownIt-Anchor\" href=\"#æ‚è°ˆ\">#</a> æ‚è°ˆ</h2>\n<p>è¿™é‡Œè¯´äº›æ‚è°ˆå§ã€‚</p>\n<p>ä»¥ä¸‹çš„æ–‡ç« ä¸­ï¼ŒåŒä¸€ä¸ªåè¯å¹¶éä»£è¡¨çš„æ˜¯åŒä¸€ç§å¯¹è±¡ã€‚æ¯”å¦‚ listã€‚</p>\n<p>åœ¨ t_list.c ä¸­ï¼Œlist çš„è¡¨ç¤ºçš„ é¢å‘äºç”¨æˆ·çš„ Redis æ•°æ®ç»“æ„ List (åˆ—è¡¨)ã€‚è€Œåœ¨ adlsit.c ä¸­è¡¨ç¤ºçš„ Redis æ•°æ®ç»“æ„çš„åº•å±‚å®ç° list (å…¶å®æ˜¯é“¾è¡¨è¿™ç§æ•°æ®ç»“æ„ - æ­¤å¤„çš„æ•°æ®ç»“æ„ï¼Œè¡¨ç¤ºçœŸå®çš„æ•°æ®ç»“æ„)ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/23/Redis%E7%B3%BB%E5%88%97/00-%E7%9B%AE%E5%BD%95/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/23/Redis%E7%B3%BB%E5%88%97/00-%E7%9B%AE%E5%BD%95/",
            "title": "Redis å¼€ç¯‡ & è¯´æ˜",
            "date_published": "2021-07-23T06:18:55.000Z",
            "content_html": "<p>æœ¬ç³»åˆ—å­¦ä¹ ç¬”è®°ä»¥  <code>redis5.0.7</code>  ç‰ˆæœ¬ä¸ºåŸºç¡€è¿›è¡Œå­¦ä¹ .</p>\n<ul>\n<li><code>2021-07-21 Redis 6.0.6</code></li>\n<li><code>2019-12-19 Redis 6.x</code>  å¼€å§‹å‘å¸ƒï¼Œå…·ä½“å†…å®¹: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2FudGlyZXovcmVkaXMvNi4wLzAwLVJFTEVBU0VOT1RFUw==\">Redis 6.x ç‰ˆæœ¬å‘å¸ƒæ˜ç»†</span></li>\n</ul>\n<h2 id=\"å¼€ç¯‡è¯´æ˜\"><a class=\"markdownIt-Anchor\" href=\"#å¼€ç¯‡è¯´æ˜\">#</a> å¼€ç¯‡ &amp; è¯´æ˜</h2>\n<ul>\n<li><a href=\"/2021/07/23/Redis%E7%B3%BB%E5%88%97/00-%E5%89%8D%E8%A8%80/\">Redis å¼€ç¯‡ &amp; è¯´æ˜ </a></li>\n</ul>\n<h2 id=\"æ–°æ‰‹å…¥é—¨\"><a class=\"markdownIt-Anchor\" href=\"#æ–°æ‰‹å…¥é—¨\">#</a> æ–°æ‰‹å…¥é—¨</h2>\n<h3 id=\"åŸºç¡€æ¦‚å¿µ\"><a class=\"markdownIt-Anchor\" href=\"#åŸºç¡€æ¦‚å¿µ\">#</a> åŸºç¡€æ¦‚å¿µ</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-Redis%E7%AE%80%E4%BB%8B%E4%BB%A5%E5%8F%8A%E4%B8%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AF%B9%E6%AF%94/\">Redis ç®€ä»‹åŠå…¶ä»–æ•°æ®åº“å¯¹æ¯”</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/02-Redis%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/\">Redis çš„å¤šä¸ªæ•°æ®åº“</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-%E5%AE%89%E8%A3%85%E5%8D%95%E6%9C%BA%E7%89%88Redis/\">Redis çš„å•æœºéƒ¨ç½²</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" disabled=\"true\"><label for=\"cbx_3\"> Redis çš„é›†ç¾¤éƒ¨ç½² (æºç å®‰è£… /docker å®‰è£…)</label></li>\n</ul>\n<h3 id=\"äº”ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#äº”ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹\">#</a> äº”ç§å¸¸ç”¨çš„æ•°æ®ç±»å‹</h3>\n<blockquote>\n<p>å¸¸ç”¨çš„å‘½ä»¤ä»¥åŠæµ…æµ…çš„äº†è§£å†…éƒ¨ç»“æ„ã€‚</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BString/\">Redis æ•°æ®ç»“æ„ä¹‹  <code>String</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\"><label for=\"cbx_5\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-2-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist/\">Redis æ•°æ®ç»“æ„ä¹‹  <code>List</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" checked=\"true\" disabled=\"true\"><label for=\"cbx_6\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/\">Redis æ•°æ®ç»“æ„ä¹‹  <code>Hash</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" checked=\"true\" disabled=\"true\"><label for=\"cbx_7\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-4-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%9B%86%E5%90%88set/\">Redis æ•°æ®ç»“æ„ä¹‹é›†åˆ  <code>Set</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" checked=\"true\" disabled=\"true\"><label for=\"cbx_8\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-5-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset/\">Redis æ•°æ®ç»“æ„ä¹‹æœ‰åºé›†åˆ  <code>Zset</code> </a></label></li>\n</ul>\n<h3 id=\"çŸ¥é“ä¼šå¾ˆç‰›é€¼çš„æ•°æ®ç±»å‹\"><a class=\"markdownIt-Anchor\" href=\"#çŸ¥é“ä¼šå¾ˆç‰›é€¼çš„æ•°æ®ç±»å‹\">#</a> çŸ¥é“ä¼šå¾ˆç‰›é€¼çš„æ•°æ®ç±»å‹</h3>\n<blockquote>\n<p>å¸¸ç”¨çš„å‘½ä»¤ä»¥åŠæµ…æµ…çš„äº†è§£å†…éƒ¨ç»“æ„ã€‚</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_9\" checked=\"true\" disabled=\"true\"><label for=\"cbx_9\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-6-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E4%BD%8D%E5%9B%BEbitmap/\">Redis æ•°æ®ç»“æ„ä¹‹ä½å›¾  <code>BitMap</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_10\" checked=\"true\" disabled=\"true\"><label for=\"cbx_10\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-7-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BHyperLogLogs/\">Redis æ•°æ®ç»“æ„ä¹‹  <code>HyperLogLogs</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_11\" disabled=\"true\"><label for=\"cbx_11\"> GeoHash</label></li>\n</ul>\n<h3 id=\"å…¶ä»–å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#å…¶ä»–å‘½ä»¤\">#</a> å…¶ä»–å‘½ä»¤</h3>\n<blockquote>\n<p>é™¤äº†åŸºæœ¬çš„æ•°æ®ç»“æ„ä¹‹å¤–çš„ <code>Redis</code>  çš„å‘½ä»¤ã€‚</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_12\" disabled=\"true\"><label for=\"cbx_12\"> help</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_13\" disabled=\"true\"><label for=\"cbx_13\"> auth</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_14\" disabled=\"true\"><label for=\"cbx_14\"> scan</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_15\" disabled=\"true\"><label for=\"cbx_15\"> keys</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_16\" disabled=\"true\"><label for=\"cbx_16\"> select</label></li>\n</ul>\n<h2 id=\"å†…åŠŸå¿ƒæ³•\"><a class=\"markdownIt-Anchor\" href=\"#å†…åŠŸå¿ƒæ³•\">#</a> å†…åŠŸå¿ƒæ³•</h2>\n<h3 id=\"redisä¸­çš„æ•°æ®ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#redisä¸­çš„æ•°æ®ç»“æ„\">#</a> Redis ä¸­çš„æ•°æ®ç»“æ„</h3>\n<blockquote>\n<p><code>Redis</code>  å†…éƒ¨çš„æ•°æ®ç»“æ„è¯¦è§£</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_17\" checked=\"true\" disabled=\"true\"><label for=\"cbx_17\"> <a href=\"/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-4-%E8%B7%B3%E8%A1%A8/\">Redis ä¸­çš„æ•°æ®ç»“æ„ä¹‹è·³è¡¨åŠå…¶åŸç†</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_18\" checked=\"true\" disabled=\"true\"><label for=\"cbx_18\"> <a href=\"/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8Bziplist/\">Redis æ•°æ®ç»“æ„ä¹‹è¯¦è§£ <code>ziplist</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_19\" disabled=\"true\"><label for=\"cbx_19\"> intset</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_20\" disabled=\"true\"><label for=\"cbx_20\"> dict</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_21\" disabled=\"true\"><label for=\"cbx_21\"> skiplist</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_22\" disabled=\"true\"><label for=\"cbx_22\"> module object</label></li>\n</ul>\n<blockquote>\n<p>é«˜é˜¶ <code>Redis</code>  ä½¿ç”¨ï¼ŒåŠ©åŠ›æˆä¸ºå¤§ç‰›</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_23\" disabled=\"true\"><label for=\"cbx_23\"> Redis çš„æ•°æ®æ·˜æ±°æœºåˆ¶</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_24\" disabled=\"true\"><label for=\"cbx_24\"> æŒä¹…åŒ–ç­–ç•¥</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_25\" disabled=\"true\"><label for=\"cbx_25\"> ä¸»ä»å¤åˆ¶</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_26\" disabled=\"true\"><label for=\"cbx_26\"> äº‹åŠ¡æœºåˆ¶</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_27\" disabled=\"true\"><label for=\"cbx_27\"> å“¨å…µæœºåˆ¶</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_28\" disabled=\"true\"><label for=\"cbx_28\"> ç›‘å¯Ÿå™¨</label></li>\n</ul>\n<h2 id=\"å®æˆ˜ä¸åº”ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#å®æˆ˜ä¸åº”ç”¨\">#</a> å®æˆ˜ä¸åº”ç”¨</h2>\n<blockquote>\n<p>è¯´çš„å†å¤šï¼Œä¸å¦‚åŠ¨æ‰‹ç»ƒç»ƒ</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_29\" disabled=\"true\"><label for=\"cbx_29\"> Redis å®ç°åˆ†å¸ƒå¼é”ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_30\" disabled=\"true\"><label for=\"cbx_30\"> Redis å®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_31\" disabled=\"true\"><label for=\"cbx_31\"> å¸ƒéš†è¿‡æ»¤å™¨</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_32\" disabled=\"true\"><label for=\"cbx_32\"> é™æµå®ä¾‹</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_33\" disabled=\"true\"><label for=\"cbx_33\"> å»¶æ—¶é˜Ÿåˆ—</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_34\" disabled=\"true\"><label for=\"cbx_34\"> ç»Ÿè®¡ PV</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_35\" disabled=\"true\"><label for=\"cbx_35\"> é™æµ</label></li>\n</ul>\n<h2 id=\"è¿ç»´\"><a class=\"markdownIt-Anchor\" href=\"#è¿ç»´\">#</a> è¿ç»´</h2>\n<blockquote>\n<p>ä¸è®©åˆ«äººæ“¦å±è‚¡</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_36\" disabled=\"true\"><label for=\"cbx_36\"> é…ç½®æ–‡ä»¶è¯¦è§£</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_37\" disabled=\"true\"><label for=\"cbx_37\"> æ•°æ®æŒä¹…åŒ–</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_38\" disabled=\"true\"><label for=\"cbx_38\"> æ•°æ®è¿ç§»</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_39\" disabled=\"true\"><label for=\"cbx_39\"> å†è°ˆé›†ç¾¤</label></li>\n</ul>\n<h2 id=\"å…¶ä»–\"><a class=\"markdownIt-Anchor\" href=\"#å…¶ä»–\">#</a> å…¶ä»–</h2>\n<blockquote>\n<p>ä¸ä»…è¦æœ‰å†…æ¶µï¼Œæ›´è¦æœ‰é¢œå€¼ã€‚</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_40\" disabled=\"true\"><label for=\"cbx_40\">  <code>Redis</code>  é¢è¯•é¢˜</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_41\" disabled=\"true\"><label for=\"cbx_41\">  <code>Redis</code>  ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</label></li>\n</ul>\n<h2 id=\"å­¦ä¹ è·¯çº¿å›¾\"><a class=\"markdownIt-Anchor\" href=\"#å­¦ä¹ è·¯çº¿å›¾\">#</a> å­¦ä¹ è·¯çº¿å›¾</h2>\n<blockquote>\n<p>è¿™é‡Œæ˜¯ç¯å¡”ã€‚</p>\n</blockquote>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_42\" disabled=\"true\"><label for=\"cbx_42\"> è·¯çº¿å›¾</label></li>\n</ul>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "ç›®å½•",
                "Redis"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/23/pictures/pic20220127-super/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/23/pictures/pic20220127-super/",
            "title": "å›¾ç‰‡äºŒ-8K",
            "date_published": "2021-07-23T06:18:55.000Z",
            "content_html": "<p class=\"gallery\" data-height=\"120\"><img data-src=\"https://images.pexels.com/photos/1366630/pexels-photo-1366630.jpeg?cs=srgb&amp;dl=pexels-max-andrey-1366630.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"></p>\n",
            "tags": [
                "å›¾ç‰‡"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/23/pictures/pic20220127/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/23/pictures/pic20220127/",
            "title": "å›¾ç‰‡ä¸€",
            "date_published": "2021-07-23T06:18:55.000Z",
            "content_html": "<p class=\"gallery\" data-height=\"120\"><img data-src=\"https://gitee.com/fangjiaxiaobai/open-sources/raw/master/images/pexels-pixabay-207779.jpg\" alt=\"\"><br>\n<img data-src=\"https://gitee.com/fangjiaxiaobai/open-sources/raw/master/images/000004.jpg\" alt=\"\"><br>\n<img data-src=\"https://gitee.com/fangjiaxiaobai/open-sources/raw/master/images/000001.jpeg\" alt=\"\"><br>\n<img data-src=\"https://images.pexels.com/photos/1097456/pexels-photo-1097456.jpeg?cs=srgb&amp;dl=pexels-sebastiaan-stam-1097456.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"https://images.pexels.com/photos/1559285/pexels-photo-1559285.jpeg?cs=srgb&amp;dl=pexels-engin-akyurt-1559285.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"https://images.pexels.com/photos/1274260/pexels-photo-1274260.jpeg?cs=srgb&amp;dl=pexels-rakicevic-nenad-1274260.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"https://images.pexels.com/photos/589840/pexels-photo-589840.jpeg?cs=srgb&amp;dl=pexels-valiphotos-589840.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"https://images.pexels.com/photos/266004/pexels-photo-266004.jpeg?cs=srgb&amp;dl=pexels-pixabay-266004.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"https://images.pexels.com/photos/373934/pexels-photo-373934.jpeg?cs=srgb&amp;dl=pexels-burst-373934.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"https://images.pexels.com/photos/839011/pexels-photo-839011.jpeg?cs=srgb&amp;dl=pexels-andrea-piacquadio-839011.jpg&amp;fm=jpg\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"><br>\n<img data-src=\"\" alt=\"\"></p>\n",
            "tags": [
                "å›¾ç‰‡"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/RoadMap/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/RoadMap/",
            "title": "å…¨ç«™åœ°å›¾",
            "date_published": "2021-07-18T12:49:55.000Z",
            "content_html": "<details class=\"danger\"><summary>æ¨è&å¿…çœ‹</summary><div>\n<div class=\"tab\" data-id=\"mustlook\" data-title=\"è¿‘æ—¥ä¸Šæ–°\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> ğŸ‘‰ <a href=\"/series/onedayday/\">æ—¥æ‹±ä¸€å’</a>ğŸ”¥ğŸ”¥ğŸ”¥</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> ğŸ‘‰ <a href=\"/2021/09/01/rocketMQ/README/\">RocketMQ ç³»åˆ—</a>ğŸ”¥ğŸ”¥ğŸ”¥</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/dynamicPlan/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/\">åŠ¨æ€è§„åˆ’</a> ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" checked=\"true\" disabled=\"true\"><label for=\"cbx_3\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/\">å“ˆå¸Œç®—æ³•å’Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</a> ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/\">æ’åºç³»åˆ—ç®—æ³•ä¹‹ä¹ç§æ’åºç®—æ³•</a> ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\"><label for=\"cbx_5\"> ğŸ‘‰ <a href=\"/2021/08/23/Java%E7%B3%BB%E5%88%97/JDK/stream/Stream-basic/\">JDK çš„ Stream ä¹‹ç³»åˆ—ä¸€ åˆçª¥æµåŸç†</a>ğŸ”¥ğŸ”¥ğŸ”¥</label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"mustlook\" data-title=\"æåŠ›æ¨è\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" checked=\"true\" disabled=\"true\"><label for=\"cbx_6\"> <a href=\"/images/promotions/Redis%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98.jpg\">Redis æºç å‰–æå’Œè§£æ</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_7\" checked=\"true\" disabled=\"true\"><label for=\"cbx_7\"> <a href=\"/promotions/geekbang/\">å…¨éƒ¨è¯¾ç¨‹</a></label></li>\n</ul>\n</div>\n</div></details>\n<details class=\"success\"><summary>K8sç³»åˆ—</summary><div>\n<div class=\"tab\" data-id=\"k8s\" data-title=\"k8så®æ“ç¯‡\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_8\" checked=\"true\" disabled=\"true\"><label for=\"cbx_8\"> <a href=\"/2022/07/17/k8s/how-to-build/\">æ­å»º k8s é›†ç¾¤</a></label></li>\n</ul>\n</div>\n</div></details>\n<details class=\"primary\"><summary>RocketMQç³»åˆ—-å®æˆ˜&æºç è§£æ</summary><div>\n<div class=\"tab\" data-id=\"rocketMQ\" data-title=\"Rocketç³»åˆ—-å…¥é—¨\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_9\" checked=\"true\" disabled=\"true\"><label for=\"cbx_9\"> <a href=\"/2021/09/01/rocketMQ/1-01-RocketMQ%E7%AE%80%E4%BB%8B/\">Rocket ç³»åˆ— - å…¥é—¨</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_10\" checked=\"true\" disabled=\"true\"><label for=\"cbx_10\"> <a href=\"/2021/09/02/rocketMQ/1-02-RocketMQ%E6%A6%82%E5%BF%B5/\">æ¦‚å¿µ</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_11\" checked=\"true\" disabled=\"true\"><label for=\"cbx_11\"> <a href=\"/2021/09/03/rocketMQ/1-03-RocketMQ%E6%90%AD%E5%BB%BA/\">å®‰è£…</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_12\" checked=\"true\" disabled=\"true\"><label for=\"cbx_12\"> <a href=\"/2021/09/04/rocketMQ/1-04-00.RocketMQ%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/\">ä½¿ç”¨</a></label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_13\" checked=\"true\" disabled=\"true\"><label for=\"cbx_13\"> <a href=\"/2021/09/04/rocketMQ/1-04-01.%E5%9F%BA%E6%9C%AC%E6%A0%B7%E4%BE%8B/\">åŸºæœ¬æ ·ä¾‹</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_14\" checked=\"true\" disabled=\"true\"><label for=\"cbx_14\"> <a href=\"/2021/09/06/rocketMQ/1-04-02.%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF/\">é¡ºåºæ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_15\" checked=\"true\" disabled=\"true\"><label for=\"cbx_15\"> <a href=\"/2021/09/23/rocketMQ/1-04-03.%E5%BB%B6%E6%97%B6%E6%B6%88%E6%81%AF/\">å»¶æ—¶æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_16\" checked=\"true\" disabled=\"true\"><label for=\"cbx_16\"> <a href=\"/2021/09/23/rocketMQ/1-04-04.%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF/\">æ‰¹é‡æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_17\" checked=\"true\" disabled=\"true\"><label for=\"cbx_17\"> <a href=\"/2021/09/23/rocketMQ/1-04-05.%E8%BF%87%E6%BB%A4%E6%B6%88%E6%81%AF/\">è¿‡æ»¤æ¶ˆæ¯</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_18\" checked=\"true\" disabled=\"true\"><label for=\"cbx_18\"> <a href=\"/2021/09/23/rocketMQ/1-04-06.%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/\">äº‹åŠ¡æ¶ˆæ¯</a></label></li>\n</ul>\n</li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"rocketMQ\" data-title=\"Rocketç³»åˆ—-è¿›é˜¶\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_19\" checked=\"true\" disabled=\"true\"><label for=\"cbx_19\"> <a href=\"/2021/09/28/rocketMQ/2-01-RocketMQ-Arch-Start/\">æ¶æ„è®¾è®¡ä¹‹å¯åŠ¨è¿‡ç¨‹è¯¦è§£</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_20\" checked=\"true\" disabled=\"true\"><label for=\"cbx_20\"> <a href=\"/2021/09/28/rocketMQ/2-02-RocketMQ-Arch-Message/\">æ¶æ„è®¾è®¡ä¹‹æ¶ˆæ¯çš„æ”¶å‘è¿‡ç¨‹è¯¦è§£</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_21\" checked=\"true\" disabled=\"true\"><label for=\"cbx_21\"> <a href=\"/2022/01/02/rocketMQ/3-01-RocketMQ-Transaction-msg/\">äº‹åŠ¡æ¶ˆæ¯å®ç°åŸç†</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_22\" checked=\"true\" disabled=\"true\"><label for=\"cbx_22\"> <a href=\"/2022/05/16/rocketMQ/3-02-reliabllity-msg/\">æ¶ˆæ¯å¯é æ€§å®ç°åŸç†</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_23\" checked=\"true\" disabled=\"true\"><label for=\"cbx_23\"> <a href=\"/2022/07/09/rocketMQ/3-08-save-msg-detail/\">æ¶ˆæ¯åˆ·ç›˜è¿‡ç¨‹è¯¦è§£</a></label></li>\n</ul>\n</div>\n</div></details>\n<details class=\"success\"><summary>Javaç³»åˆ—</summary><div>\n<div class=\"tab\" data-id=\"java\" data-title=\"JDKåŸç†&æºç \">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_24\" checked=\"true\" disabled=\"true\"><label for=\"cbx_24\"> <a href=\"/2021/07/15/JDK%E6%BA%90%E7%A0%81/README/\">JDK åŸç† &amp; æºç  ç›®å½•</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_25\" checked=\"true\" disabled=\"true\"><label for=\"cbx_25\"> <a href=\"/2021/08/23/java%E7%B3%BB%E5%88%97/JDK/stream/Stream-basic/\">JDK çš„ Stream ä¹‹ç³»åˆ—ä¸€ åˆçª¥æµåŸç†</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_26\" checked=\"true\" disabled=\"true\"><label for=\"cbx_26\"> <a href=\"/2021/07/15/JDK%E6%BA%90%E7%A0%81/HashMap/HashMap/\">ã€HashMapã€‘å…¨ç½‘æœ€å…¨çš„ HashMap æºç è§£è¯»</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_27\" checked=\"true\" disabled=\"true\"><label for=\"cbx_27\"> <a href=\"/2021/07/15/JDK%E6%BA%90%E7%A0%81/HashMap/HashMap%E7%9A%84Hash%E5%87%BD%E6%95%B0%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E6%84%8F%E4%B9%89/\">ã€HashMapã€‘HashMap çš„ Hash å‡½æ•°åˆ°åº•æœ‰ä»€ä¹ˆæ„ä¹‰</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"java\" data-title=\"JVMåŸç†\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_28\" checked=\"true\" disabled=\"true\"><label for=\"cbx_28\"> <a href=\"/2021/08/19/java%E7%B3%BB%E5%88%97/JVM/OOM/\">JVM ä¹‹ä½ æ²¡è§è¿‡çš„ OOM</a></label></li>\n</ul>\n</div>\n</div></details>\n<details class=\"info\"><summary>åˆ·é¢˜</summary><div>\n<div class=\"tab\" data-id=\"bq\" data-title=\"LeetCode\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_29\" checked=\"true\" disabled=\"true\"><label for=\"cbx_29\"> <a href=\"/2021/08/19/BQ/LeetCode/001-%E5%8F%8D%E8%BD%AC%E6%95%B0%E7%BB%84/\">LC: åè½¬æ•°ç»„</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_30\" checked=\"true\" disabled=\"true\"><label for=\"cbx_30\"> <a href=\"/2021/08/29/BQ/LeetCode/002-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/\">LC: åè½¬é“¾è¡¨ I</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"bq\" data-title=\"æ­ç”µ\">\n<p><a href=\"/2021/10/13/BQ/hdoj/HD-1000/\">1000 A + B Problem</a><br>\n<a href=\"/2021/10/14/BQ/hdoj/HD-1001/\">1001 Sum Problem</a><br>\n<a href=\"/2021/10/15/BQ/hdoj/HD-1002/\">1002 A + B Problem II</a><br>\n<a href=\"/2021/10/16/BQ/hdoj/HD-1003/\">1003 Max Sum</a><br>\n<a href=\"/2021/10/17/BQ/hdoj/HD-1004/\">1004 Let the Balloon Rise</a><br>\n<a href=\"/2021/10/18/BQ/hdoj/HD-1005/\">1005 Number Sequence</a></p>\n</div>\n</div></details>\n<details class=\"warning\"><summary>æ•°æ®åº“ç³»åˆ—</summary><div>\n<div class=\"tab\" data-id=\"db\" data-title=\"MySQL\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_31\" checked=\"true\" disabled=\"true\"><label for=\"cbx_31\"> <a href=\"/series/MySQL/\">MySQL ç³»åˆ—ç›®å½•</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_32\" checked=\"true\" disabled=\"true\"><label for=\"cbx_32\"> <a href=\"/2021/07/23/MySQL%E7%B3%BB%E5%88%97/%E6%95%B0%E6%8D%AE%E5%BA%930-00.%E8%AF%B4%E6%98%8E/\">MySQL å¼€ç¯‡ &amp; è¯´æ˜</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_33\" checked=\"true\" disabled=\"true\"><label for=\"cbx_33\"> <a href=\"/2021/07/24/MySQL%E7%B3%BB%E5%88%97/%E6%95%B0%E6%8D%AE%E5%BA%931-01.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%89%88%E6%9C%AC/\">MySQL æ•°æ®åº“çš„ç‰ˆæœ¬</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"db\" data-title=\"Redis\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_34\" checked=\"true\" disabled=\"true\"><label for=\"cbx_34\"> <a href=\"/2021/07/23/Redis%E7%B3%BB%E5%88%97/00-%E7%9B%AE%E5%BD%95/\">Redis å¼€ç¯‡ &amp; è¯´æ˜ &amp; ç›®å½•</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_35\" checked=\"true\" disabled=\"true\"><label for=\"cbx_35\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-Redis%E7%AE%80%E4%BB%8B%E4%BB%A5%E5%8F%8A%E4%B8%8E%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AF%B9%E6%AF%94/\">Redis ç®€ä»‹åŠå…¶ä»–æ•°æ®åº“å¯¹æ¯”</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_36\" checked=\"true\" disabled=\"true\"><label for=\"cbx_36\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/02-Redis%E7%9A%84%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/\">Redis çš„å¤šä¸ªæ•°æ®åº“</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_37\" checked=\"true\" disabled=\"true\"><label for=\"cbx_37\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/01-%E5%AE%89%E8%A3%85%E5%8D%95%E6%9C%BA%E7%89%88Redis/\">Redis çš„å•æœºéƒ¨ç½²</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_38\" checked=\"true\" disabled=\"true\"><label for=\"cbx_38\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-1-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BString/\">Redis æ•°æ®ç»“æ„ä¹‹ <code>String</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_39\" checked=\"true\" disabled=\"true\"><label for=\"cbx_39\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-2-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Blist/\">Redis æ•°æ®ç»“æ„ä¹‹ <code>List</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_40\" checked=\"true\" disabled=\"true\"><label for=\"cbx_40\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-3-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8Bhash/\">Redis æ•°æ®ç»“æ„ä¹‹ <code>Hash</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_41\" checked=\"true\" disabled=\"true\"><label for=\"cbx_41\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-4-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%9B%86%E5%90%88set/\">Redis æ•°æ®ç»“æ„ä¹‹é›†åˆ <code>Set</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_42\" checked=\"true\" disabled=\"true\"><label for=\"cbx_42\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-5-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88zset/\">Redis æ•°æ®ç»“æ„ä¹‹æœ‰åºé›†åˆ <code>Zset</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_43\" checked=\"true\" disabled=\"true\"><label for=\"cbx_43\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-6-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E4%BD%8D%E5%9B%BEbitmap/\">Redis æ•°æ®ç»“æ„ä¹‹ä½å›¾ <code>BitMap</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_44\" checked=\"true\" disabled=\"true\"><label for=\"cbx_44\"> <a href=\"/2021/08/01/Redis%E7%B3%BB%E5%88%97/B-7-Redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8BHyperLogLogs/\">Redis æ•°æ®ç»“æ„ä¹‹ <code>HyperLogLogs</code> </a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_45\" checked=\"true\" disabled=\"true\"><label for=\"cbx_45\"> <a href=\"/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-4-%E8%B7%B3%E8%A1%A8/\">Redis ä¸­çš„æ•°æ®ç»“æ„ä¹‹è·³è¡¨åŠå…¶åŸç†</a></label></li>\n</ul>\n</div>\n</div></details>\n<details class=\"primary\"><summary>Gitç³»åˆ—</summary><div>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_46\" checked=\"true\" disabled=\"true\"><label for=\"cbx_46\"> <a href=\"/2021/07/18/git%E7%B3%BB%E5%88%97/02-Git%E4%BB%8B%E7%BB%8D/\">git ä»‹ç»</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_47\" checked=\"true\" disabled=\"true\"><label for=\"cbx_47\"> <a href=\"/2021/07/18/git%E7%B3%BB%E5%88%97/01-GIt%E5%AE%89%E8%A3%85/\">git å®‰è£…</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_48\" checked=\"true\" disabled=\"true\"><label for=\"cbx_48\"> <a href=\"/2021/07/18/git%E7%B3%BB%E5%88%97/03-git%E5%91%BD%E4%BB%A4%E4%B9%8B%E4%BB%8E%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E5%BC%80%E5%A7%8B/\">ä»åˆ›å»ºä»“åº“å¼€å§‹</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_49\" checked=\"true\" disabled=\"true\"><label for=\"cbx_49\"> <a href=\"/2021/07/18/git%E7%B3%BB%E5%88%97/04-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A41/\">git åŸºæœ¬å‘½ä»¤ä¸€</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_50\" checked=\"true\" disabled=\"true\"><label for=\"cbx_50\"> <a href=\"/2021/07/18/git%E7%B3%BB%E5%88%97/05-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A42%20git%E6%97%B6%E5%85%89%E6%9C%BA1/\">git åŸºæœ¬å‘½ä»¤äºŒ</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_51\" checked=\"true\" disabled=\"true\"><label for=\"cbx_51\"> <a href=\"/2021/07/18/git%E7%B3%BB%E5%88%97/06-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A43-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/\">git åŸºæœ¬å‘½ä»¤ä¸‰</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_52\" checked=\"true\" disabled=\"true\"><label for=\"cbx_52\"> <a href=\"/2021/07/18/git%E7%B3%BB%E5%88%97/07-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A44-%E6%A0%87%E7%AD%BE%E5%92%8C%E5%88%AB%E5%90%8D/\">git åŸºæœ¬å‘½ä»¤å››</a></label></li>\n</ul>\n</div></details>\n<details class=\"success\"><summary>æœç´¢ç›¸å…³</summary><div>\n<div class=\"tab\" data-id=\"seach\" data-title=\"ElasticSearch\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_53\" checked=\"true\" disabled=\"true\"><label for=\"cbx_53\"> <a href=\"/2021/08/31/es-series/01.ES%E7%AE%80%E4%BB%8B/\">1.ES ç®€ä»‹</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_54\" checked=\"true\" disabled=\"true\"><label for=\"cbx_54\"> <a href=\"/2021/08/31/es-series/02.ES%E5%AE%89%E8%A3%85/\">2.ES æ ˆå®‰è£…</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_55\" checked=\"true\" disabled=\"true\"><label for=\"cbx_55\"> <a href=\"/2021/08/31/es-series/03.ES%E9%85%8D%E7%BD%AE/\">3.ElasticSearch é…ç½®</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_56\" checked=\"true\" disabled=\"true\"><label for=\"cbx_56\"> <a href=\"/2021/08/31/es-series/04.ES%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/\">4. åŸºæœ¬æ¦‚å¿µ</a></label></li>\n</ul>\n</div>\n</div></details>\n<details class=\"danger\"><summary>æ•°æ®ç»“æ„ä¸ç®—æ³•</summary><div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"æ•°æ®ç»“æ„\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_57\" checked=\"true\" disabled=\"true\"><label for=\"cbx_57\"> ğŸº <a href=\"/2021/08/02/Redis%E7%B3%BB%E5%88%97/C-4-%E8%B7%B3%E8%A1%A8/\">è·³è¡¨</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"æ’åº\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_58\" checked=\"true\" disabled=\"true\"><label for=\"cbx_58\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/\">æ’åºå¼€ç¯‡</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_59\" checked=\"true\" disabled=\"true\"><label for=\"cbx_59\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/\">å†’æ³¡æ’åº</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_60\" checked=\"true\" disabled=\"true\"><label for=\"cbx_60\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/\">é€‰æ‹©æ’åº</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_61\" checked=\"true\" disabled=\"true\"><label for=\"cbx_61\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/\">å½’å¹¶æ’åº</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_62\" checked=\"true\" disabled=\"true\"><label for=\"cbx_62\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/\">å¿«é€Ÿæ’åº</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_63\" disabled=\"true\"><label for=\"cbx_63\"> ğŸ‘‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/sort/%E7%AE%97%E6%B3%9503-%E6%A1%B6%E6%8E%92%E5%BA%8F/\">æ¡¶æ’åº (Bubble Sort)</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"åŠ¨æ€è§„åˆ’\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_64\" disabled=\"true\"><label for=\"cbx_64\"> âœŠ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/dynamicPlan/%E7%AE%97%E6%B3%9501-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/\">åŠ¨æ€è§„åˆ’</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"å“ˆå¸Œç®—æ³•\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_65\" checked=\"true\" disabled=\"true\"><label for=\"cbx_65\"> ğŸ”¥ğŸ”¥ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/\">å“ˆå¸Œç®—æ³•å’Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_66\" checked=\"true\" disabled=\"true\"><label for=\"cbx_66\"> ğŸ”¥ğŸ”¥ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/hash/%E7%AE%97%E6%B3%9502-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/\">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"é€’å½’ç®—æ³•\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_67\" checked=\"true\" disabled=\"true\"><label for=\"cbx_67\"> ğŸ‰ <a href=\"/2021/09/01/dataStructuresAndAlgorithms/recursion/%E7%AE%97%E6%B3%9501-%E9%80%92%E5%BD%92/\">é€’å½’ç®—æ³•</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"æŸ¥æ‰¾\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_68\" disabled=\"true\"><label for=\"cbx_68\"> è¡¥è´§ä¸­â€¦</label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"èƒŒåŒ…\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_69\" disabled=\"true\"><label for=\"cbx_69\"> è¡¥è´§ä¸­â€¦</label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"dss\" data-title=\"è´ªå¿ƒ\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_70\" disabled=\"true\"><label for=\"cbx_70\"> è¡¥è´§ä¸­â€¦</label></li>\n</ul>\n</div>\n</div></details>\n<details class=\"warning\"><summary>é¢ç»</summary><div>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_71\" disabled=\"true\"><label for=\"cbx_71\"> <a href=\"\">èŠèŠé¢è¯•é‚£ç‚¹äº‹å„¿</a></label></li>\n</ul>\n</div></details>\n<details class=\"info\"><summary>æ¨å¹¿&æ¨è</summary><div>\n<div class=\"tab\" data-id=\"promotion\" data-title=\"æå®¢æ—¶é—´\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_72\" disabled=\"true\"><label for=\"cbx_72\"> <a href=\"/images/promotions/Redis%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98.jpg\">Redis åŸç†</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_73\" disabled=\"true\"><label for=\"cbx_73\"> <a href=\"/promotions/geekbang/\">å…¨éƒ¨è¯¾ç¨‹</a></label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"promotion\" data-title=\"ç§‘å­¦ä¸Šç½‘\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_74\" disabled=\"true\"><label for=\"cbx_74\"> è¡¥è´§ä¸­â€¦</label></li>\n</ul>\n</div>\n<div class=\"tab\" data-id=\"promotion\" data-title=\"ä¹¦ç±\">\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_75\" disabled=\"true\"><label for=\"cbx_75\"> è¡¥è´§ä¸­â€¦</label></li>\n</ul>\n</div>\n</div></details>\n",
            "tags": [
                "å…¨ç«™åœ°å›¾",
                "ç›®å½•"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/dataStructuresAndAlgorithms/SnowFlake/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/dataStructuresAndAlgorithms/SnowFlake/",
            "title": "é›ªèŠ±ç®—æ³•",
            "date_published": "2021-07-18T12:49:55.000Z",
            "content_html": "<h3 id=\"ä»‹ç»\"><a class=\"markdownIt-Anchor\" href=\"#ä»‹ç»\">#</a> ä»‹ç»</h3>\n<p>é›ªèŠ±ç®—æ³•æ˜¯  <code>twitter</code>  å¼€æºçš„ç”±  <code>64</code>  ä½æ•´æ•°ç»„æˆçš„åˆ†å¸ƒå¼ <code>id</code> ã€‚ç›®çš„æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­äº§ç”Ÿå…¨å±€å”¯ä¸€ä¸”è¶‹åŠ¿é€’å¢çš„ <code>ID</code> ã€‚</p>\n<p>å…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼š<b>ä½¿ç”¨ä¸€ä¸ª  <code>64 bit</code>  çš„  <code>long</code>  å‹çš„æ•°å­—ä½œä¸ºå…¨å±€å”¯ä¸€  <code>id</code> ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨ååˆ†å¹¿æ³›ï¼Œä¸” <code>ID</code>  å¼•å…¥äº†æ—¶é—´æˆ³ï¼Œä¿æŒè‡ªå¢æ€§ä¸”ä¸é‡å¤ã€‚</b></p>\n<h3 id=\"é›ªèŠ±ç®—æ³•çš„ç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#é›ªèŠ±ç®—æ³•çš„ç»“æ„\">#</a> é›ªèŠ±ç®—æ³•çš„ç»“æ„</h3>\n<p><img data-src=\"/images/%E7%AE%97%E6%B3%95/snowFlake%E7%AE%97%E6%B3%95%E7%BB%93%E6%9E%84%E5%9B%BE.png\" alt=\"\"></p>\n<ul>\n<li>æ ‡è¯†ï¼š æ²¡æœ‰å®é™…æ„ä¹‰ã€‚ä¸€èˆ¬éƒ½æ˜¯ 0ï¼Œéƒ½æ˜¯æ­£æ•°ã€‚</li>\n<li>æ—¶é—´æˆ³ï¼š  <code>41 bit</code>  å¯ä»¥è¡¨ç¤ºçš„æ•°å­—å¤šè¾¾  <code>2^41 - 1</code> ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ ‡è¯†  <code>2 ^ 41 - 1</code>  ä¸ªæ¯«ç§’å€¼ï¼Œæ¢ç®—æˆå¹´å°±æ˜¯è¡¨ç¤º  <code>69</code>  å¹´çš„æ—¶é—´ã€‚</li>\n<li>æœºå™¨ id: è¿™é‡Œæ ‡è¯†çš„æ˜¯æœºå™¨çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€èˆ¬ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼š <code>æœºæˆ¿id+æœºå™¨id</code> ã€‚ä¸€å…± <code>10</code>  ä½ï¼Œå¯ä»¥è¡¨ç¤º <code>1024</code>  å°æœºå™¨ã€‚</li>\n<li>åºåˆ—å·ï¼šå¯ä»¥ç”¨è¿™ä¸ª  <code>12 bit</code>  ä»£è¡¨çš„æ•°å­—æ¥åŒºåˆ†åŒä¸€ä¸ªæ¯«ç§’å†…çš„  <code>4096</code>  ä¸ªä¸åŒçš„  <code>id</code> ã€‚ä¹Ÿå°±æ˜¯åŒä¸€æ¯«ç§’å†…åŒä¸€å°æœºå™¨æ‰€ç”Ÿæˆçš„æœ€å¤§ ID æ•°é‡ä¸º <code>4096</code></li>\n</ul>\n<h3 id=\"é›ªèŠ±ç®—æ³•çš„å·¥ä½œæµç¨‹\"><a class=\"markdownIt-Anchor\" href=\"#é›ªèŠ±ç®—æ³•çš„å·¥ä½œæµç¨‹\">#</a> é›ªèŠ±ç®—æ³•çš„å·¥ä½œæµç¨‹</h3>\n<p>ä»¥ä¸€ä¸ªç®€å•çš„é›ªèŠ±ç®—æ³•å·¥ä½œæµç¨‹æ¥è¯´ã€‚å‡è®¾æœ‰ä¸€ä¸ªæœåŠ¡å‡è®¾è¦ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ <code>id</code> ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‘é€ä¸€ä¸ªè¯·æ±‚ç»™éƒ¨ç½²äº†  <code>SnowFlake</code>  ç®—æ³•çš„ç³»ç»Ÿï¼Œç”±è¿™ä¸ª  <code>SnowFlake</code>  ç®—æ³•ç³»ç»Ÿæ¥ç”Ÿæˆå”¯ä¸€  <code>id</code> ã€‚è¿™ä¸ª  <code>SnowFlake</code>  ç®—æ³•ç³»ç»Ÿé¦–å…ˆè‚¯å®šæ˜¯çŸ¥é“è‡ªå·±æ‰€åœ¨çš„æœºå™¨å·ï¼Œï¼ˆå‡è®¾æœºå™¨ id ä¸º 10bitï¼‰æ¥ç€  <code>SnowFlake</code>  ç®—æ³•ç³»ç»Ÿæ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œé¦–å…ˆå°±ä¼šç”¨äºŒè¿›åˆ¶ä½è¿ç®—çš„æ–¹å¼ç”Ÿæˆä¸€ä¸ª  <code>64 bit</code>  çš„  <code>long</code>  å‹  <code>id</code> ï¼Œ <code>64</code>  ä¸ª  <code>bit</code>  ä¸­çš„ç¬¬ä¸€ä¸ª  <code>bit</code>  æ˜¯æ— æ„ä¹‰çš„ã€‚æ¥ç€ç”¨å½“å‰æ—¶é—´æˆ³ï¼ˆå•ä½åˆ°æ¯«ç§’ï¼‰å ç”¨ <code>41</code>  ä¸ª  <code>bit</code> ï¼Œç„¶åæ¥ç€  <code>10</code>  ä¸ª  <code>bit</code>  è®¾ç½®æœºå™¨  <code>id</code> ã€‚æœ€åå†åˆ¤æ–­ä¸€ä¸‹ï¼Œå½“å‰è¿™å°æœºæˆ¿çš„è¿™å°æœºå™¨ä¸Šè¿™ä¸€æ¯«ç§’å†…ï¼Œè¿™æ˜¯ç¬¬å‡ ä¸ªè¯·æ±‚ï¼Œç»™è¿™æ¬¡ç”Ÿæˆ  <code>id</code>  çš„è¯·æ±‚ç´¯åŠ ä¸€ä¸ªåºå·ï¼Œä½œä¸ºæœ€åçš„  <code>12</code>  ä¸ª  <code>bit</code> ã€‚</p>\n<h3 id=\"é›ªèŠ±ç®—æ³•å®ç°\"><a class=\"markdownIt-Anchor\" href=\"#é›ªèŠ±ç®—æ³•å®ç°\">#</a> é›ªèŠ±ç®—æ³•å®ç°</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.fxb.algorithm;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * é›ªèŠ±ç®—æ³•ç”Ÿæˆå™¨</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * 1.todo: å¯ä»¥æŒ‡å®šä¸åŒæ•°æ®ä½æ•°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * 2.todo: å•ä¾‹</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> fangjiaxiaobai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020-10-24 23:51</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowFlakeGenerator</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å¼€å§‹æ—¶é—´æˆ³ (2015-01-01)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_TIMESTAMP = <span class=\"number\">1603556068000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ€»ä½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> BITS_COUNT = <span class=\"number\">64L</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æœºå™¨idæ‰€å çš„ä½æ•°,</span></span><br><span class=\"line\"><span class=\"comment\">     * é»˜è®¤æ˜¯5ä½ã€‚æœ€å¤šæ”¯æŒ31å°æœºå™¨</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_WORKER_ID_BITS = <span class=\"number\">5L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ•°æ®ä¸­å¿ƒidæ‰€å çš„ä½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     * å¯ä»¥ç†è§£ä¸ºæœºæˆ¿ã€‚é»˜è®¤æ˜¯5ä½ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_DATA_CENTER_ID_BITS = <span class=\"number\">5L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åºåˆ—åœ¨idä¸­å çš„ä½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_SEQUENCE_BITS = <span class=\"number\">12L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_MAX_WORKER_ID = ~(-<span class=\"number\">1L</span> &lt;&lt; DEFAULT_WORKER_ID_BITS);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ”¯æŒçš„æ•°æ®ä¸­å¿ƒæ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_MAX_DATA_CENTER_ID_BITS = ~(-<span class=\"number\">1L</span> &lt;&lt; DEFAULT_DATA_CENTER_ID_BITS);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_SEQUENCE_MASK = ~(-<span class=\"number\">1L</span> &lt;&lt; DEFAULT_SEQUENCE_BITS);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ—¶é—´æˆ³å‘å·¦ç§»22ä½(5+5+12)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_TIMESTAMP_LEFT_SHIFT = DEFAULT_SEQUENCE_BITS + DEFAULT_WORKER_ID_BITS + DEFAULT_DATA_CENTER_ID_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_DATA_CENTER_ID_SHIFT = DEFAULT_SEQUENCE_BITS + DEFAULT_WORKER_ID_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * workIdçš„ä½ç§»</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> DEFAULT_WORKER_ID_SHIFT = DEFAULT_SEQUENCE_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * å·¥ä½œæœºå™¨ID</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ•°æ®ä¸­å¿ƒID</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> dataCenterId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ”¯æŒçš„æœ€å¤§æ•°æ®ä¸­å¿ƒæ•°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> maxDataCenterId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ”¯æŒçš„æœ€å¤§workeridæ•°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> maxWorkerId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åºåˆ—å·çš„ä½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long sequenceBits;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * åºåˆ—å·çš„æ©ç </span></span><br><span class=\"line\"><span class=\"comment\">     * å³ï¼Œ2^sequenceBits</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long sequenceMask;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ¯«ç§’å†…åºåˆ—</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆ³</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> lastTimestamp = -<span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> dataCenterIdShift;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerIdShift;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ—¶é—´æˆ³çš„ä½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> timestampLeftShift;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * é»˜è®¤ æ¯ä¸ªæ•°æ®ä¸­å¿ƒå¯ä»¥å®¹çº³31å°æœºå™¨</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId     å·¥ä½œID</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> dataCenterId æ•°æ®ä¸­å¿ƒID</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SnowFlakeGenerator</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> dataCenterId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * æ ¹æ®è‡ªå·±çš„é…ç½®å†³å®šå®¹çº³çš„æœºå™¨æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId         å·¥ä½œæœºå™¨çš„id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> dataCenterId     æ•°æ®ä¸­å¿ƒçš„id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerIdBits     å·¥ä½œæœºå çš„ä½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> dataCenterIdBits æ•°æ®ä¸­å¿ƒå çš„ä½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SnowFlakeGenerator</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> dataCenterId, <span class=\"keyword\">long</span> workerIdBits, <span class=\"keyword\">long</span> dataCenterIdBits)</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SnowflakeId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">long</span> <span class=\"title\">nextId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> currentTimestamp = getCurrentTimeStamp();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(currentTimestamp &lt; lastTimestamp) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(</span><br><span class=\"line\">                    String.format(<span class=\"string\">&quot;Clock moved backwards.  Refusing to generate id for %d milliseconds&quot;</span>, lastTimestamp - currentTimestamp));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ—</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(lastTimestamp == currentTimestamp) &#123;</span><br><span class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; sequenceMask;</span><br><span class=\"line\">            <span class=\"comment\">//æ¯«ç§’å†…åºåˆ—æº¢å‡º</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(sequence == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³</span></span><br><span class=\"line\">                currentTimestamp = tilNextMillis(lastTimestamp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½®</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆ³</span></span><br><span class=\"line\">        lastTimestamp = currentTimestamp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((currentTimestamp - DEFAULT_TIMESTAMP) &lt;&lt; timestampLeftShift)</span><br><span class=\"line\">                | (dataCenterId &lt;&lt; dataCenterIdShift)</span><br><span class=\"line\">                | (workerId &lt;&lt; workerIdShift)</span><br><span class=\"line\">                | sequence;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆ³</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> å½“å‰æ—¶é—´æˆ³</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">tilNextMillis</span><span class=\"params\">(<span class=\"keyword\">long</span> lastTimestamp)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> timestamp = getCurrentTimeStamp();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class=\"line\">            timestamp = getCurrentTimeStamp();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> timestamp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * è·å–å½“å‰æ—¶é—´</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> å½“å‰æ—¶é—´æˆ³ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">long</span> <span class=\"title\">getCurrentTimeStamp</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> System.currentTimeMillis();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å®Œæ•´ä»£ç : <span class=\"exturl\" data-url=\"aHR0cDovL2R3ei5kYXRlL2NXbVI=\">http://dwz.date/cWmR</span></p>\n<p>å…¬ä¼—å·ä¸­å›å¤ ã€é›ªèŠ±ç®—æ³•ã€‘ï¼Œå¯ä»¥ç›´æ¥è·å–æºç æ–‡ä»¶ã€‚</p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "é›ªèŠ±ç®—æ³•",
                "ç®—æ³•"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/01-GIt%E5%AE%89%E8%A3%85/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/01-GIt%E5%AE%89%E8%A3%85/",
            "title": "å®‰è£…git",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h3 id=\"windowsä¸‹å®‰è£…\"><a class=\"markdownIt-Anchor\" href=\"#windowsä¸‹å®‰è£…\">#</a> windows ä¸‹å®‰è£…</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS5oay8/Z3dzX3JkPXNzbA==\">here</span></p>\n<h3 id=\"linuxä¸‹å®‰è£…\"><a class=\"markdownIt-Anchor\" href=\"#linuxä¸‹å®‰è£…\">#</a> linux ä¸‹å®‰è£…</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS5oay8/Z3dzX3JkPXNzbA==\">here</span></p>\n<h3 id=\"macä¸‹å®‰è£…\"><a class=\"markdownIt-Anchor\" href=\"#macä¸‹å®‰è£…\">#</a> mac ä¸‹å®‰è£…</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS5oay8/Z3dzX3JkPXNzbA==\">here</span></p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/02-Git%E4%BB%8B%E7%BB%8D/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/02-Git%E4%BB%8B%E7%BB%8D/",
            "title": "Gitä»‹ç»",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h2 id=\"gitæ˜¯ç›®å‰æœ€å…ˆè¿›çš„ç‰ˆæœ¬æ§åˆ¶ç®¡ç†ç³»ç»Ÿ-b\"><a class=\"markdownIt-Anchor\" href=\"#gitæ˜¯ç›®å‰æœ€å…ˆè¿›çš„ç‰ˆæœ¬æ§åˆ¶ç®¡ç†ç³»ç»Ÿ-b\">#</a>  <code>Git</code>  æ˜¯ç›®å‰æœ€å…ˆè¿›çš„ç‰ˆæœ¬æ§åˆ¶ç®¡ç†ç³»ç»Ÿã€‚</b></h2>\n<p>æœ¬è´¨ä¸Šè®²ï¼Œ <code>git</code>  æ˜¯ä¸€ä¸ªå†…å®¹å¯»å€æ–‡ä»¶ç³»ç»Ÿã€‚å…¶æ ¸å¿ƒéƒ¨åˆ†æ˜¯ä¸€ä¸ªç®€å•çš„é”®å€¼å¯¹æ•°æ®åº“ ( <code>key-value data store</code> ). ä½ å¯ä»¥æƒ³åƒ <code>git</code>  ä»“åº“ä¸­æ’å…¥ä»»æ„ç±»å‹çš„å†…å®¹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå”¯ä¸€çš„é”®ï¼Œé€šè¿‡è¯¥é”®å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å†æ¬¡å–å›è¯¥å†…å®¹ã€‚</p>\n<h2 id=\"gitå…ˆè¿›åœ¨å“ªé‡Œ\"><a class=\"markdownIt-Anchor\" href=\"#gitå…ˆè¿›åœ¨å“ªé‡Œ\">#</a>  <code>git</code>  å…ˆè¿›åœ¨å“ªé‡Œï¼Ÿ</h2>\n<ul>\n<li>\n<p>ç›´æ¥è®°å½•å¿«ç…§ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒå·®å¼‚ã€‚<br>\nè¿™ä¹Ÿæ˜¯ <code>git</code>  å’Œå…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿçš„ä¸»è¦å·®åˆ«ã€‚å…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ ( <code>CVS</code> , <code>Subversion</code> , <code>Perforce</code> , <code>Bazaar</code>  ç­‰) å­˜å‚¨å„ä¸ªç‰ˆæœ¬ä¹‹é—´ï¼Œæ¯ä¸ªæ–‡ä»¶éšæ—¶é—´é€æ¸ç´¯ç§¯çš„å·®å¼‚ã€‚è¿™ç±»ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿç§°ä¸º åŸºäºå·®å¼‚çš„ç‰ˆæœ¬æ§åˆ¶ã€‚å¦‚ä¸‹å›¾:<br>\n<img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E4%BB%8B%E7%BB%8D01.png\" alt=\"gitä»‹ç»01.png\"></p>\n<p><code>git</code>  åˆ™ä¸ç„¶ï¼Œå½“ä½ æäº¤æ›´æ–°æˆ–è€…ä¿å­˜é¡¹ç›®çŠ¶æ€çš„æ—¶å€™ï¼Œå®ƒåŸºæœ¬ä¸Šå°±ä¼šå¯¹å½“æ—¶çš„å…¨éƒ¨æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¿«ç…§å¹¶ä¿å­˜è¿™ä¸ªå¿«ç…§çš„ç´¢å¼•ã€‚ä¸ºäº†æ•ˆç‡ï¼Œå¦‚æœæ²¡æœ‰æ²¡æœ‰ä¿®æ”¹ï¼Œ <code>git</code>  ä¸å†é‡æ–°å­˜å‚¨è¯¥æ–‡ <code>git</code>  ä»¶ï¼Œè€Œæ˜¯åªä¿ç•™ä¸€ä¸ªè¿æ¥æŒ‡å‘ä¹‹å‰å­˜å‚¨çš„æ–‡ä»¶ã€‚ <code>Git</code>  å¯¹å¾…æ‰€ç®¡ç†çš„æ•°æ®æ›´åƒæ˜¯ä¸€ä¸ªå¿«ç…§æµã€‚å¦‚ä¸‹å›¾:<br>\n<img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E4%BB%8B%E7%BB%8D02.png\" alt=\"gitä»‹ç»02.png\"></p>\n<p><b> <code>git</code>  æ›´åƒæ˜¯ä¸€ä¸ªå°å‹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸åªæ˜¯ä¸€ä¸ªç®€å•çš„ CVSã€‚</b></p>\n</li>\n<li>\n<p><code>git</code>  è¿‘ä¹æ‰€æœ‰æ“ä½œéƒ½åœ¨æœ¬åœ°æ‰§è¡Œ<br>\nè¿™æ„å‘³ç€ä¸ç®¡æœ‰æ— ç½‘ç»œï¼Œä½ éƒ½å¯ä»¥å·¥ä½œã€‚æ²¡æœ‰ç½‘ç»œçš„æ—¶å€™ï¼Œä½ ç…§å¸¸å¯ä»¥æäº¤ä»£ç ï¼Œç­‰åˆ°æœ‰ç½‘çš„æ—¶å€™ï¼Œåœ¨è¿›è¡Œä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ã€‚è€Œä½¿ç”¨ <code>Subversion</code> ï¼Œ <code>CVS</code>  çš„è¯ï¼Œåªèƒ½ä¿®æ”¹æ–‡ä»¶ï¼Œä½†æ˜¯ä¸èƒ½æäº¤ã€‚</p>\n</li>\n<li>\n<p><code>git</code>  ä¿è¯å®Œæ•´æ€§<br>\n <code>Git</code>  ä¸­æ‰€æœ‰çš„æ•°æ®åœ¨å­˜å‚¨å‰éƒ½è®¡ç®—æ ¡éªŒå’Œï¼Œç„¶åä»¥æ ¡éªŒå’Œæ¥å¼•ç”¨ã€‚è¿™å°±æ˜¯è¯´ï¼Œ <code>Git</code>  ä¼šçŸ¥é“ä½ æ‰€æœ‰çš„æ›´æ”¹ä»»ä½•æ–‡ä»¶å†…å®¹æˆ–è€…ç›®å½•å†…å®¹ï¼Œè¿™ä¸ªæ˜¯æ„æˆ git å“²å­¦ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚ <code>Git</code>  ä½¿ç”¨è®¡ç®—æ ¡éªŒå’Œçš„æœºåˆ¶å«åš  <code>SHA-1</code>  æ•£åˆ— ( <code>hash</code> , å“ˆå¸Œ)ã€‚è¿™æ˜¯ä¸€ä¸ªç”± <code>40</code>  ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ ( <code>0-9</code>  å’Œ <code>a-f</code> ) ç»„æˆçš„å­—ç¬¦ä¸²ï¼ŒåŸºäº Git ä¸­æ–‡ä»¶çš„å†…å®¹å’Œç›®å½•ç»“æ„è®¡ç®—å‡ºæ¥çš„ã€‚ <code>Git</code>  æ•°æ®åº“ä¸­ä¿å­˜çš„ä¿¡æ¯éƒ½æ˜¯ä»¥æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œå€¼æ¥ç´¢å¼•æ•°æ®ï¼Œè€Œä¸æ˜¯æ–‡ä»¶åã€‚</p>\n</li>\n<li>\n<p><code>Git</code>  ä¸€èˆ¬éƒ½åªæ·»åŠ æ•°æ®<br>\næ‰§è¡Œçš„æ‰€æœ‰çš„ <code>git</code>  æ“ä½œï¼Œå‡ ä¹åªå¾€æ•°æ®åº“ä¸­æ·»åŠ æ•°æ®ã€‚ä¸€æ—¦ä½ æäº¤äº†å¿«ç…§åˆ° <code>git</code>  ä¸­ï¼Œå°±éš¾ä»¥å†ä¸¢å¤±æ•°æ®ï¼Œç‰¹åˆ«æ˜¯å®šæœŸçš„æ¨é€åˆ°äº†è¿œç¨‹ä»“åº“ã€‚</p>\n</li>\n</ul>\n<h2 id=\"gitçš„ä¸‰ç§çŠ¶æ€\"><a class=\"markdownIt-Anchor\" href=\"#gitçš„ä¸‰ç§çŠ¶æ€\">#</a>  <code>git</code>  çš„ä¸‰ç§çŠ¶æ€</h2>\n<p><code>git</code>  å¯¹æ–‡ä»¶çš„ç®¡ç†ï¼Œæœ‰ä¸‰ç§çŠ¶æ€ã€‚</p>\n<ul>\n<li>å·²ä¿®æ”¹ï¼šè¡¨ç¤ºä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</li>\n<li>å·²æš‚å­˜ï¼šè¡¨ç¤ºå¯¹ä¸€ä¸ªå·²ä¿®æ”¹æ–‡ä»¶çš„å½“å‰ç‰ˆæœ¬åšäº†æ ‡è®°ï¼Œä½¿ä¹‹åœ¨ä¸‹æ¬¡æäº¤çš„å¿«ç…§ä¸­ã€‚</li>\n<li>å·²æäº¤ï¼šè¡¨ç¤ºæ•°æ®å·²ç»å®‰å…¨çš„ä¿å­˜åˆ°äº†æœ¬åœ°çš„ git æ•°æ®åº“ä¸­ã€‚</li>\n</ul>\n<p>è¿™ä¸‰ç§çŠ¶æ€åˆ†åˆ«ä»£è¡¨äº† <code>git</code>  çš„ä¸‰ä¸ªå·¥ä½œåŒºã€‚å·¥ä½œåŒºï¼Œæš‚å­˜åŒºä»¥åŠ <code>git</code>  ç›®å½• (ç‰ˆæœ¬åº“)ã€‚å¦‚ä¸‹å›¾</p>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E4%BB%8B%E7%BB%8D03.png\" alt=\"gitä»‹ç»03\"></p>\n<p>å·¥ä½œåŒºæ˜¯å¯¹é¡¹ç›®çš„æŸä¸ªç‰ˆæœ¬ç‹¬ç«‹æå–å‡ºæ¥çš„å†…å®¹ã€‚è¿™äº›ä» <code>git</code>  ä»“åº“çš„å‹ç¼©æ•°æ®åº“ä¸­æå–å‡ºæ¥çš„æ–‡ä»¶ï¼Œæ”¾åœ¨ç£ç›˜ä¸Šä¾›ä½ ä½¿ç”¨æˆ–ä¿®æ”¹ã€‚</p>\n<p>æš‚å­˜åŒºæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¿å­˜äº†ä¸‹æ¬¡å°†è¦æäº¤çš„æ–‡ä»¶åˆ—è¡¨ä¿¡æ¯ã€‚ <code>git</code>  ä¸­ç§°ä¸ºç´¢å¼•ï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯ç§°ä¸ºæš‚å­˜åŒºã€‚<br>\n <code>Git</code>  ä»“åº“ç›®å½•æŒ‡çš„å°±æ˜¯ .git ç›®å½• (.git)ã€‚ä¸‹èŠ‚å°±ä»åˆ›å»ºä»“åº“å¼€å§‹å­¦èµ·ã€‚</p>\n<h2 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h2>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/04-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A41/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/04-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A41/",
            "title": "gitåŸºæœ¬ä½¿ç”¨ä¸€",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<p>ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å­¦ä¹ äº† ä½¿ç”¨ <code>git</code>  å¦‚ä½•åˆ›å»ºä¸€ä¸ªä»“åº“ã€‚è€Œä¸”è¿˜è¯¦ç»†çš„ä»‹ç»äº† <code>git</code>  å„ä¸ªå·¥ä½œç›®å½•çš„ä½œç”¨ã€‚</p>\n<p><code>git</code> :  <code>global information tracker</code></p>\n<p><code>git</code>  å…¶å®æ˜¯å†…å®¹å¯»å€æ–‡ä»¶ç³»ç»Ÿã€‚æœ¬è´¨æ˜¯ä¸€ä¸ª <code>key-value</code>  çš„æ•°æ®åº“ã€‚åœ¨ä¸Šä¸€ç¯‡æ–‡ç« äº†è§£äº† <code>git</code>  çš„å››ç§å¯¹è±¡ï¼šæäº¤å¯¹è±¡ï¼Œæ•°æ®å¯¹è±¡ï¼Œæ ‘å¯¹è±¡å’Œæ ‡ç­¾å¯¹è±¡ã€‚è¿˜å­¦ä¹ äº† <code>git</code>  çš„å¼•ç”¨ ( <code>HEAD</code> , <code>Index</code> , <code>refs</code>  ç›®å½•)ï¼Œä»¥åŠæœ€åå­¦ä¹ äº† <code>git</code>  çš„å‹ç¼©ï¼Œ( <code>git gc</code> ).</p>\n<p>ä»Šå¤©æˆ‘ä»¬ä» ç®€å•çš„ git ä½¿ç”¨æµç¨‹è¯´èµ·ã€‚</p>\n<p>ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä»“åº“.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git init .</span><br><span class=\"line\">Initialized empty Git repository in /private/tmp/gitlearn/.git/</span><br><span class=\"line\">âœ  gitlearn git:(master)</span><br></pre></td></tr></table></figure>\n<p>æ–°å»ºå®Œä»“åº“ä¹‹åï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå¯¹ä»“åº“è¿›è¡Œé…ç½®ã€‚</p>\n<h3 id=\"git-config\"><a class=\"markdownIt-Anchor\" href=\"#git-config\">#</a> git config</h3>\n<p><code>git</code>  è‡ªå¸¦äº†ä¸€ä¸ª  <code>git config</code>  å·¥å…·æ¥å¸®åŠ©è®¾ç½®æ§åˆ¶ Git å¤–è§‚å’Œè¡Œä¸ºçš„é…ç½®å˜é‡ã€‚è¿™äº›å˜é‡å­˜å‚¨åœ¨ä¸‰ä¸ªä¸åŒçš„ä½ç½®ã€‚</p>\n<ul>\n<li><code>A</code> : <code>/etc/gitconfig</code>  æ–‡ä»¶ï¼šåŒ…å«ç³»ç»Ÿä¸Šæ¯ä¸€ä¸ªç”¨æˆ·ä»¥åŠä»–ä»¬ä»“åº“çš„é€šç”¨é…ç½®ã€‚ å¦‚æœæ‰§è¡Œ  <code>git config</code>  æ—¶ï¼Œå¸¦ä¸Š --system é€‰é¡¹ï¼Œå°±ä¼šè¯»å†™è¯¥é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å±æ€§ã€‚</li>\n<li><code>B</code> : <code>~/.gitconfig</code>  æˆ–  <code>~/.config/git/config</code>  æ–‡ä»¶ï¼šåªé’ˆå¯¹å½“å‰ç”¨æˆ·ã€‚ä½¿ç”¨  <code>--global</code>  é€‰é¡¹ä¼šè®© <code>git</code>  è¯»å†™æ­¤æ–‡ä»¶ï¼Œè¿™ä¼šå¯¹ä½ ç³»ç»Ÿçš„ä¸Šçš„<b>æ‰€æœ‰</b>ä»“åº“ç”Ÿæ•ˆã€‚</li>\n<li><code>C</code> : å½“å‰ä½¿ç”¨ä»“åº“çš„ <code>git</code>  ç›®å½•çš„ <code>config</code>  æ–‡ä»¶ ( <code>.git/config</code> ): åªé’ˆå¯¹å½“å‰ä»“åº“ã€‚ å¯ä»¥ä½¿ç”¨  <code>--local</code>  é€‰é¡¹è®© <code>git</code>  å¼ºåˆ¶è¯»å†™æ­¤æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¹Ÿä¼šä½¿ç”¨å®ƒã€‚</li>\n</ul>\n<p>è¯»å–é¡ºåºä¸ºï¼š  <code>A</code> -&gt; <code>B</code> -&gt; <code>C</code> ,  <code>C</code>  ä¼šè¦†ç›– <code>B</code>  ä¸­ç›¸åŒçš„é…ç½®ï¼Œ <code>B</code>  ä¼šè¦†ç›– <code>A</code>  ä¸­ç›¸åŒçš„é…ç½®ã€‚</p>\n<blockquote>\n<p>å¯ä»¥é€šè¿‡ git config --list --show origin å‘½ä»¤æŸ¥æŸ¥æ–‡ä»¶ä½ç½®ä»¥åŠå‘½ä»¤æ‰€åœ¨çš„æ–‡ä»¶ã€‚</p>\n</blockquote>\n<p>ä¸€èˆ¬æˆ‘ä»¬æ–°å»ºäº†ä»“åº“ï¼Œæˆ–è€…  <code>clone</code>  ä¸€ä¸ªè¿œç¨‹ä»“åº“åˆ°æœ¬åœ°ä¹‹åï¼Œ<b>ç¬¬ä¸€ä»¶äº‹å°±æ˜¯é…ç½®è‡ªå·±çš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€ã€‚</b></p>\n<p>åˆšæ‰è¯´è¿‡ï¼Œä¸‰ç§é…ç½®æ–¹å¼çš„ä½œç”¨èŒƒå›´ï¼Œè¿™é‡Œ<b>ä¸€èˆ¬æƒ…å†µä¸‹</b>ä¼šä½¿ç”¨  <code>--global</code> ã€‚ å½“å‰ç™»å½•çš„ç”¨æˆ·éƒ½ä¼šä½¿ç”¨ä¸€æ ·çš„é…ç½®ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global user.name &quot;fangjiaxiaobai&quot;</span><br><span class=\"line\">$ git config --global user.email &quot;fangjiaxiaobai@163.com&quot;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼</p>\n<p>æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹é…ç½®çš„ç»“æœã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git config --global --list</span><br><span class=\"line\">user.name=fangjiaxiaobai</span><br><span class=\"line\">user.email=fangjiaxiaobai@163.com</span><br></pre></td></tr></table></figure>\n<h4 id=\"ä¿®æ”¹-git-çš„é»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨\"><a class=\"markdownIt-Anchor\" href=\"#ä¿®æ”¹-git-çš„é»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨\">#</a> ä¿®æ”¹ git çš„é»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨</h4>\n<p><code>git</code>  çš„æ–‡æœ¬ç¼–è¾‘å™¨æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p>\n<p>å½“æˆ‘ä»¬çš„æ–‡ä»¶ åœ¨ æäº¤ä»£ç ï¼Œæ‹‰å–è¿œç¨‹ä»£ç æˆ–è€…åˆ‡æ¢åˆ†æ”¯å‡ºç°å†²çªçš„æ—¶å€™ï¼Œ <code>git</code>  å‘½ä»¤è¡Œçª—å£å°±ä¼šæœ‰ä¸€ä¸ªå¤„ç†å†²çªä¹‹åå¡«å†™ <code>commit</code>  ä¿¡æ¯çš„å‘½ä»¤è¡Œçª—å£ï¼Œè¿™é‡Œä½¿ç”¨çš„ç¼–è¾‘å™¨å°±æ˜¯ æˆ‘ä»¬è¦è¯´çš„ â€œæ–‡æœ¬ç¼–è¾‘å™¨äº†â€ã€‚</p>\n<p><code>git</code>  ä¸­é»˜è®¤çš„æ–‡æœ¬ç¼–è¾‘å™¨æ˜¯  <code>nano</code>  ç¼–è¾‘å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨  <code>vim</code>  ç¼–è¾‘å™¨ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— git config --global core.editor &quot;vim&quot;</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git config --global -l</span><br><span class=\"line\">user.name=fangjiaxiaobai</span><br><span class=\"line\">user.email=fangjiaxiaobai@163.com</span><br><span class=\"line\">core.editor=vim</span><br></pre></td></tr></table></figure>\n<p>é…ç½®å®Œä»“åº“ï¼Œä¹‹åï¼Œæˆ‘ä»¬å°±æ­£å¼å¼€å§‹ä½¿ç”¨  <code>git</code>  äº†ã€‚</p>\n<h3 id=\"ä½¿ç”¨-git-è¿›è¡Œå·¥ä½œ\"><a class=\"markdownIt-Anchor\" href=\"#ä½¿ç”¨-git-è¿›è¡Œå·¥ä½œ\">#</a> ä½¿ç”¨  <code>git</code>  è¿›è¡Œå·¥ä½œ</h3>\n<p>ç®€å•æ¥è®²ï¼Œæˆ‘ä»¬åªéœ€ä¸‰æ­¥ï¼Œä¸¤ä¸ªå‘½ä»¤å°±å¯ä»¥å®Œæˆæ–‡ä»¶çš„ç‰ˆæœ¬æ§åˆ¶ã€‚</p>\n<ul>\n<li>ä¿®æ”¹æ–‡ä»¶ (åˆ›å»ºæ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œåˆ é™¤æ–‡ä»¶)</li>\n<li>ä½¿ç”¨  <code>git add .</code>  å°†æ–‡ä»¶çº³å…¥ç‰ˆæœ¬ç®¡ç†</li>\n<li>ä½¿ç”¨  <code>git commit -m &quot;xxx&quot;</code>  å°†æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬ä»“åº“ã€‚</li>\n</ul>\n<p>åœ¨æˆ‘ä»¬çš„å·¥ä½œç›®å½•ä¸­ (æ¯”å¦‚  <code>gitlearn/</code> ), æ‰€æœ‰çš„æ–‡ä»¶åªæœ‰ä¸¤ç§çŠ¶æ€ï¼š  <code>å·²è·Ÿè¸ª</code> å’Œ <code>æœªè·Ÿè¸ª</code> ã€‚</p>\n<p>å·²è·Ÿè¸ªçš„æ–‡ä»¶æ˜¯æŒ‡è¢«çº³å…¥ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶ã€‚åœ¨ä¸Šä¸€æ¬¡å¿«ç…§ä¸­æœ‰ä»–ä»¬çš„è®°å½•ï¼Œåœ¨å·¥ä½œä¸€æ®µæ—¶é—´åï¼Œä»–ä»¬çš„çŠ¶æ€å¯èƒ½æ˜¯æœªä¿®æ”¹ï¼Œå·²ä¿®æ”¹ï¼Œæˆ–è€…å·²ç»æ”¾å…¥äº† <code>æš‚å­˜åŒº</code>  $^â¶ $ã€‚</p>\n<p>æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼šå°±æ˜¯ å³ä¸å­˜åœ¨ä¸Šæ¬¡å¿«ç…§ä¸­ï¼Œä¹Ÿæ²¡æœ‰è¢«æ”¾å…¥æš‚å­˜åŒºä¸­ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¬å†æ¬¡çš„ä»‹ç»ä¸€ä¸‹ <code>git</code>  çš„å·¥ä½œåŒºåŸŸ:</p>\n<p>å·¥ä½œåŒºï¼Œæš‚å­˜åŒºï¼Œç‰ˆæœ¬åº“ã€‚</p>\n<p>å·¥ä½œåŒºï¼Œå°±æ˜¯æˆ‘ä»¬ä¿®æ”¹çš„æ–‡ä»¶ã€‚åŒ…æ‹¬ï¼šæ–°å»ºæ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œåˆ é™¤æ–‡ä»¶ã€‚<br>\næš‚å­˜åŒºï¼Œå°±æ˜¯ <code>git</code>  å°†æˆ‘ä»¬ä¿®æ”¹çš„æ–‡ä»¶è®°å½•èµ·æ¥èµ·æ¥ã€‚<br>\nç‰ˆæœ¬åº“ï¼Œå°±æ˜¯ <code>git</code>  çš„è®°å½•çš„ç‰ˆæœ¬å˜æ›´å†å²ã€‚å°±æ˜¯  <code>.git</code>  ç›®å½•ä¸‹çš„ <code>objects/</code>  ç­‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚å³æˆ‘ä»¬ è¿›è¡Œäº† <code>commit</code>  æ“ä½œä¹‹åå°±ä¼šè¿›å…¥äº†ç‰ˆæœ¬åº“ã€‚</p>\n<h3 id=\"è®©-git-è·Ÿè¸ªæˆ‘ä»¬çš„æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#è®©-git-è·Ÿè¸ªæˆ‘ä»¬çš„æ–‡ä»¶\">#</a> è®©  <code>git</code>  è·Ÿè¸ªæˆ‘ä»¬çš„æ–‡ä»¶</h3>\n<p>ä½¿ç”¨  <code>git add</code>  å‘½ä»¤ï¼Œå¯ä»¥è®© <code>git</code>  å¼€å§‹è·Ÿè¸ªä¸€ä¸ªæ–‡ä»¶ã€‚</p>\n<p>ä½¿ <code>git</code>  è·Ÿè¸ªæ–‡ä»¶  <code>README.md</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;test gitè·Ÿè¸ªæ–‡ä»¶&#x27; &gt; README.md</span><br><span class=\"line\"># æŸ¥çœ‹å·¥ä½œåŒºä¸­æ–‡ä»¶çš„çŠ¶æ€</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\"></span><br><span class=\"line\">No commits yet</span><br><span class=\"line\"></span><br><span class=\"line\">Untracked files:</span><br><span class=\"line\">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class=\"line\"></span><br><span class=\"line\">\tREADME.md</span><br><span class=\"line\"></span><br><span class=\"line\">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†ï¼Œæœªè·Ÿè¸ªçš„è¯¥æ–‡ä»¶ï¼š  <code>README.md</code> ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>git add</code>  å‘½ä»¤ï¼Œå°†æœªè·Ÿè¸ªçš„æ–‡ä»¶çº³å…¥è·Ÿè¸ªèŒƒå›´ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— git add README.md</span><br><span class=\"line\"># æŸ¥çœ‹æ–‡ä»¶çš„çŠ¶æ€</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\"></span><br><span class=\"line\">No commits yet</span><br><span class=\"line\"></span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   README.md</span><br></pre></td></tr></table></figure>\n<p><code>Changes to be committed</code> : å°†è¦æäº¤çš„å˜æ›´ã€‚è¯´æ˜ä¸‹é¢çš„æ–‡ä»¶å·²ç»æ˜¯æš‚å­˜çŠ¶æ€äº†ã€‚ä½¿ç”¨  <code>git rm --cached &lt;file&gt;...</code>  å‘½ä»¤å¯ä»¥å–æ¶ˆæš‚å­˜ã€‚æ­¤æ—¶ <code>README.md</code>  æ–‡ä»¶å·²ç»æ˜¯ <code>git</code>  è·Ÿè¸ªçš„äº†ã€‚æˆ‘ä»¬å†æ¬¡ä¿®æ”¹ä¸€ä¸‹  <code>README.md</code>  æ–‡ä»¶ã€‚æŸ¥çœ‹ä¸€ä¸‹å·¥ä½œåŒºä¸­æ–‡ä»¶çš„çŠ¶æ€.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— echo &#x27;test å†æ¬¡ä¿®æ”¹å·²ç»è¢«è·Ÿè¸ªçš„æ–‡ä»¶&#x27; &gt;&gt; README.md</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\"></span><br><span class=\"line\">No commits yet</span><br><span class=\"line\"></span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   README.md</span><br><span class=\"line\"></span><br><span class=\"line\">Changes not staged for commit:</span><br><span class=\"line\">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class=\"line\">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class=\"line\"></span><br><span class=\"line\">\tmodified:   README.md</span><br></pre></td></tr></table></figure>\n<p>åˆçœ‹åˆ°äº† <code>Changes not staged for commit</code> ï¼š è¿˜æ²¡æœ‰è¢«æš‚å­˜çš„æäº¤å»æäº¤ã€‚è¯´æ˜ç¬¬äºŒæ¬¡çš„å˜æ›´è¿˜æ²¡æœ‰è¢« <code>git</code>  è·Ÿè¸ªèµ·æ¥ã€‚è¿™å°±éœ€è¦æˆ‘ä»¬åœ¨è¿è¡Œä¸€æ¬¡ <code>git add README.md</code>  å‘½ä»¤äº†ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— git add README.md</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\"></span><br><span class=\"line\">No commits yet</span><br><span class=\"line\"></span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   README.md</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡æ›´æ”¹ä¹Ÿè¢« <code>git</code>  è·Ÿè¸ªäº†èµ·æ¥ã€‚</p>\n<p><code>git status</code>  å‘½ä»¤çš„è¾“å‡ºååˆ†è¯¦ç»†ï¼Œå¯ä»¥ä½¿ç”¨ <code>git status -s(--short)</code>  å‘½ä»¤ï¼Œè¾“å‡ºéå¸¸ç®€æ´çš„ç»“æœ.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— git status -s</span><br><span class=\"line\">A  README.md</span><br></pre></td></tr></table></figure>\n<p>è¾“å‡ºç»“æœçš„æ ¼å¼æ˜¯è¿™æ ·çš„:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">XX file1</span><br><span class=\"line\">XX file2</span><br></pre></td></tr></table></figure>\n<p>å·¦åˆ— XX: ç¬¬ä¸€ä¸ª X è¡¨ç¤ºï¼Œæš‚å­˜åŒºçš„çŠ¶æ€ï¼Œç¬¬äºŒä¸ª X è¡¨ç¤ºå·¥ä½œåŒºçš„çŠ¶æ€ã€‚</p>\n<p>XX çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>æ–°æ·»åŠ çš„æœªè·Ÿè¸ªæ–‡ä»¶å‰é¢æœ‰ï¼Ÿï¼Ÿæ ‡è®°</li>\n<li>æ–°æ·»åŠ åˆ°æš‚å­˜åŒºä¸­çš„æ–‡ä»¶å‰é¢æœ‰ A æ ‡è®°</li>\n<li>ä¿®æ”¹è¿‡çš„æ–‡ä»¶å‰é¢æœ‰ M æ ‡è®°ã€‚</li>\n</ul>\n<h3 id=\"æäº¤åˆ°ç‰ˆæœ¬åº“\"><a class=\"markdownIt-Anchor\" href=\"#æäº¤åˆ°ç‰ˆæœ¬åº“\">#</a> æäº¤åˆ°ç‰ˆæœ¬åº“</h3>\n<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æäº¤æ–‡ä»¶äº†ã€‚æœ€å¥½åœ¨æ¯æ¬¡æäº¤ä¹‹å‰éƒ½ç”¨  <code>git status</code>  çœ‹ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ˜¯å¦éƒ½æ”¾å…¥ æš‚å­˜åŒºäº†ã€‚ç„¶åå†ç”¨  <code>git commit</code>  è¿›è¡Œæäº¤ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\"></span><br><span class=\"line\">No commits yet</span><br><span class=\"line\"></span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   README.md</span><br><span class=\"line\"># æäº¤ä»£ç </span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;first commit&quot;</span><br><span class=\"line\">[master (root-commit) fb554b5] first commit</span><br><span class=\"line\"> 1 file changed, 2 insertions(+)</span><br><span class=\"line\"> create mode 100644 README.md</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæäº¤åå®ƒä¼šå‘Šè¯‰ä½ ï¼Œå½“å‰æ˜¯åœ¨å“ªä¸ªåˆ†æ”¯ï¼ˆ <code>master</code> ï¼‰æäº¤çš„ï¼Œæœ¬æ¬¡æäº¤çš„å®Œæ•´  <code>SHA-1</code>  æ ¡éªŒå’Œæ˜¯ä»€ä¹ˆï¼ˆ <code>463dc4f</code> ï¼‰ï¼Œä»¥åŠåœ¨æœ¬æ¬¡æäº¤ä¸­ï¼Œæœ‰å¤šå°‘æ–‡ä»¶ä¿®è®¢è¿‡ï¼Œå¤šå°‘è¡Œæ·»åŠ å’Œåˆ æ”¹è¿‡ã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬æœ€ç®€å•çš„å¼€å‘æµç¨‹äº†ã€‚</p>\n<p>è¿™æ—¶ï¼Œå¦‚æœæˆ‘ä¸æƒ³æŸä¸ªæ–‡ä»¶çº³å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶è¿˜å¿…é¡»è¦åœ¨å·¥ä½œåŒºä¸­å‘¢ï¼Ÿ</p>\n<h4 id=\"å¿½ç•¥æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#å¿½ç•¥æ–‡ä»¶\">#</a> å¿½ç•¥æ–‡ä»¶</h4>\n<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºï¼š  <code>.gitignore</code>  çš„æ–‡ä»¶ï¼Œåˆ—å‡ºè¦å¿½ç•¥çš„æ–‡ä»¶çš„æ¨¡å¼ã€‚</p>\n<p><code>.gitignore</code>  æ–‡ä»¶çš„æ ¼å¼è§„èŒƒå¦‚ä¸‹ï¼š</p>\n<ul>\n<li>æ‰€æœ‰ç©ºè¡Œæˆ–è€…ä»¥ # å¼€å¤´çš„è¡Œéƒ½ä¼šè¢« Git å¿½ç•¥ã€‚</li>\n<li>å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ glob æ¨¡å¼åŒ¹é…ï¼Œå®ƒä¼šé€’å½’åœ°åº”ç”¨åœ¨æ•´ä¸ªå·¥ä½œåŒºä¸­ã€‚</li>\n<li>åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ/ï¼‰å¼€å¤´é˜²æ­¢é€’å½’ã€‚</li>\n<li>åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ/ï¼‰ç»“å°¾æŒ‡å®šç›®å½•ã€‚</li>\n<li>è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ ä¸Šå¹å·ï¼ˆ!ï¼‰å–åã€‚</li>\n</ul>\n<p>æ‰€è°“çš„  <code>glob</code>  æ¨¡å¼æ˜¯æŒ‡  <code>shell</code>  æ‰€ä½¿ç”¨çš„ç®€åŒ–äº†çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ æ˜Ÿå· <code>ï¼ˆ*ï¼‰</code> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ï¼› <code>[abc]</code>  åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦ ï¼ˆè¿™ä¸ªä¾‹å­è¦ä¹ˆåŒ¹é…ä¸€ä¸ª  <code>a</code> ï¼Œè¦ä¹ˆåŒ¹é…ä¸€ä¸ª  <code>b</code> ï¼Œè¦ä¹ˆåŒ¹é…ä¸€ä¸ª  <code>c</code> ï¼‰ï¼› é—®å· <code>ï¼ˆ?ï¼‰</code> åªåŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼›å¦‚æœåœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨çŸ­åˆ’çº¿åˆ†éš”ä¸¤ä¸ªå­—ç¬¦ï¼Œ è¡¨ç¤ºæ‰€æœ‰åœ¨è¿™ä¸¤ä¸ªå­—ç¬¦èŒƒå›´å†…çš„éƒ½å¯ä»¥åŒ¹é…ï¼ˆæ¯”å¦‚  <code>[0-9]</code>  è¡¨ç¤ºåŒ¹é…æ‰€æœ‰  <code>0</code>  åˆ°  <code>9</code>  çš„æ•°å­—ï¼‰ã€‚ ä½¿ç”¨ä¸¤ä¸ªæ˜Ÿå·ï¼ˆ <code>**</code> ï¼‰è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸­é—´ç›®å½•ï¼Œæ¯”å¦‚  <code>a/**/z</code>  å¯ä»¥åŒ¹é…  <code>a/z</code>  ã€  <code>a/b/z</code>  æˆ–  <code>a/b/c/z</code>  ç­‰ã€‚</p>\n<p>æ¥çœ‹ä¸€ä¸ª  <code>.gitignore</code>  æ–‡ä»¶çš„ä¾‹å­:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å¿½ç•¥æ‰€æœ‰çš„ .a æ–‡ä»¶</span></span><br><span class=\"line\">*.a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½†è·Ÿè¸ªæ‰€æœ‰çš„ lib.aï¼Œå³ä¾¿ä½ åœ¨å‰é¢å¿½ç•¥äº† .a æ–‡ä»¶</span></span><br><span class=\"line\">!lib.a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åªå¿½ç•¥å½“å‰ç›®å½•ä¸‹çš„ TODO æ–‡ä»¶ï¼Œè€Œä¸å¿½ç•¥ subdir/TODO</span></span><br><span class=\"line\">/TODO</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¿½ç•¥ä»»ä½•ç›®å½•ä¸‹åä¸º build çš„æ–‡ä»¶å¤¹</span></span><br><span class=\"line\">build/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¿½ç•¥ doc/notes.txtï¼Œä½†ä¸å¿½ç•¥ doc/server/arch.txt</span></span><br><span class=\"line\">doc/*.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¿½ç•¥ doc/ ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ä¸‹çš„ .pdf æ–‡ä»¶</span></span><br><span class=\"line\">doc/**/*.pdf</span><br></pre></td></tr></table></figure>\n<p>å‡è®¾ï¼šæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªåå«ï¼š  <code>git.log</code>  çš„æ–‡ä»¶ã€‚åœ¨æ›´æ—©çš„ä¸€ä¸ªå¿«ç…§ä¸­ï¼Œå·²ç»æŠŠå®ƒçº³å…¥äº†ç‰ˆæœ¬åº“ä¸­ã€‚ç°åœ¨æˆ‘ä»¬è¦æŠŠå®ƒç§»é™¤æ‰ã€‚åº”è¯¥æ€ä¹ˆåŠå‘¢</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">### å‡†å¤‡å·¥ä½œ</span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;test remove logs files&#x27; &gt; git.log</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test remove logs files&quot;</span><br><span class=\"line\">[master b83b8f1] test remove logs files</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"> create mode 100644 git.log</span><br><span class=\"line\"></span><br><span class=\"line\"> ### ç§»é™¤ git.log</span><br><span class=\"line\">âœ  gitlearn git:(master) git rm git.log</span><br><span class=\"line\">rm &#x27;git.log&#x27;</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tdeleted:    git.log</span><br><span class=\"line\"># æ–°å»º .gitignore æ–‡ä»¶</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— echo &#x27;*.log&#x27; &gt; .gitignore</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\"># æŸ¥çœ‹æ–‡ä»¶çš„çŠ¶æ€</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   .gitignore</span><br><span class=\"line\">\tdeleted:    git.log</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— echo &#x27;*.log&#x27; &gt; .gitignore</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   .gitignore</span><br><span class=\"line\">\tdeleted:    git.log</span><br><span class=\"line\"></span><br><span class=\"line\"># æäº¤æ–‡ä»¶</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test remove logs files - remove git.log&quot;</span><br><span class=\"line\">[master 9118876] test remove logs files - remove git.log</span><br><span class=\"line\"> 2 files changed, 1 insertion(+), 1 deletion(-)</span><br><span class=\"line\"> create mode 100644 .gitignore</span><br><span class=\"line\"> delete mode 100644 git.log</span><br><span class=\"line\">âœ  gitlearn git:(master) git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">nothing to commit, working tree clean</span><br><span class=\"line\"># éªŒè¯ä¸€ä¸‹git.logæ–‡ä»¶ä¼šä¸ä¼šè¢«gitè·Ÿè¸ª</span><br><span class=\"line\"></span><br><span class=\"line\"># ä¿®æ”¹äº†git.logæ–‡ä»¶ä¹‹åï¼Œgitä¸ä¼šè·Ÿè¸ªå…¶å˜æ›´ã€‚</span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;test track git.log??&#x27; &gt; git.log</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>\n<p>æ³¨æ„ï¼š</p>\n<p>è¿è¡Œ  <code>git rm</code>  å‘½ä»¤å¹¶ä¸èƒ½åˆ é™¤æ–‡ä»¶ï¼æ˜¯ä» <code>git</code>  ä¸­åˆ é™¤ï¼Œä½¿ <code>git</code>  ä¸åœ¨è·Ÿè¸ªå…¶å˜åŒ–ã€‚</p>\n<p>æœ‰æ—¶å€™ï¼Œä½¿ç”¨  <code>git rm</code>  å‘½ä»¤å¹¶ä¸èƒ½ä½¿æ–‡ä»¶ä¸è¢« <code>git</code>  è·Ÿè¸ªï¼Œå› ä¸ºåœ¨ç¼“å­˜ä¸­è¿˜è·Ÿè¸ªäº†æ–‡ä»¶ã€‚ è¿™ä½¿ï¼Œå¯ä»¥ä½¿ç”¨  <code>git rm -rf --cached</code>  å‘½ä»¤ä½¿ <code>git</code>  ä¸è·Ÿè¸ªæ–‡ä»¶ã€‚</p>\n<p><code>git rm</code>  å‘½ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨  <code>glob</code>  æ¨¡å¼ã€‚</p>\n<h3 id=\"æŸ¥çœ‹æ–‡ä»¶çš„ä¿®æ”¹å†…å®¹\"><a class=\"markdownIt-Anchor\" href=\"#æŸ¥çœ‹æ–‡ä»¶çš„ä¿®æ”¹å†…å®¹\">#</a> æŸ¥çœ‹æ–‡ä»¶çš„ä¿®æ”¹å†…å®¹</h3>\n<p><code>git</code>  æä¾›äº†ä¸€ä¸ªå‘½ä»¤ <code>git diff</code>  å¯ä»¥æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹äº†é‚£äº›åœ°æ–¹.</p>\n<p>å‡è®¾ï¼šæˆ‘ä»¬ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘è¦çœ‹ä¸€ä¸‹ä¿®æ”¹çš„å†…å®¹ (æ­¤æ—¶è¿˜æ²¡æœ‰æäº¤ã€‚)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;test diff&#x27; &gt; README.md</span><br><span class=\"line\"></span><br><span class=\"line\">## æŸ¥çœ‹ä¸åŒ</span><br><span class=\"line\">### æ¯”è¾ƒçš„æ˜¯ï¼š å·¥ä½œç›®å½•ä¸­å½“å‰æ–‡ä»¶å’Œæš‚å­˜åŒºåŸŸå¿«ç…§ä¹‹é—´çš„å·®å¼‚ã€‚</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git diff</span><br><span class=\"line\">diff --git a/README.md b/README.md</span><br><span class=\"line\">index 2afbeed..b69a2df 100644</span><br><span class=\"line\">--- a/README.md</span><br><span class=\"line\">+++ b/README.md</span><br><span class=\"line\">@@ -1,2 +1 @@</span><br><span class=\"line\">-test gitè·Ÿè¸ªæ–‡ä»¶</span><br><span class=\"line\">-test å†æ¬¡ä¿®æ”¹å·²ç»è¢«è·Ÿè¸ªçš„æ–‡ä»¶</span><br><span class=\"line\">+test diff</span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨  <code>--staged</code>  é€‰é¡¹å¯ä»¥æ¯”è¾ƒ å·²æš‚å­˜æ–‡ä»¶ä¸æœ€åä¸€æ¬¡æäº¤çš„æ–‡ä»¶å·®å¼‚ã€‚<br>\n<b>è¯·æ³¨æ„ï¼Œ <code>git diff</code>  æœ¬èº«åªæ˜¾ç¤ºå°šæœªæš‚å­˜çš„æ”¹åŠ¨ï¼Œè€Œä¸æ˜¯è‡ªä¸Šæ¬¡æäº¤ä»¥æ¥æ‰€åšçš„æ‰€æœ‰æ”¹åŠ¨ã€‚ æ‰€ä»¥æœ‰æ—¶å€™ä½ ä¸€ä¸‹å­æš‚å­˜äº†æ‰€æœ‰æ›´æ–°è¿‡çš„æ–‡ä»¶ï¼Œè¿è¡Œ  <code>git diff</code>  åå´ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œå°±æ˜¯è¿™ä¸ªåŸå› ã€‚</b></p>\n<h3 id=\"ç§»åŠ¨æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#ç§»åŠ¨æ–‡ä»¶\">#</a> ç§»åŠ¨æ–‡ä»¶</h3>\n<p>å¯ä»¥ä½¿ç”¨  <code>git mv</code>  å‘½ä»¤æ¥ç§»åŠ¨æ–‡ä»¶ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— git mv README.md README.md.md</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git status</span><br><span class=\"line\">On branch master</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\trenamed:    README.md -&gt; README.md.md</span><br><span class=\"line\"></span><br><span class=\"line\">Changes not staged for commit:</span><br><span class=\"line\">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class=\"line\">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class=\"line\"></span><br><span class=\"line\">\tmodified:   README.md.md</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªå‘½ä»¤å°±ç›¸å½“äºï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mv README.md README.md.md</span><br><span class=\"line\">$ git rm README.md</span><br><span class=\"line\">$ git add README.md.md</span><br></pre></td></tr></table></figure>\n<p>æœ¬ç¯‡æ–‡ç« å°±åˆ°è¿™é‡Œå•¦ï¼Œä¸‹ä¸€ç¯‡ï½<b>git çš„æ—¶å…‰æœº</b></p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/07-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A44-%E6%A0%87%E7%AD%BE%E5%92%8C%E5%88%AB%E5%90%8D/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/07-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A44-%E6%A0%87%E7%AD%BE%E5%92%8C%E5%88%AB%E5%90%8D/",
            "title": "git åŸºç¡€ - æ ‡ç­¾ å’Œ åˆ«å",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h3 id=\"æ ‡ç­¾\"><a class=\"markdownIt-Anchor\" href=\"#æ ‡ç­¾\">#</a> æ ‡ç­¾</h3>\n<p>æ ‡ç­¾æœ€ä¸»è¦çš„ä½œç”¨æ˜¯ï¼Œäººä»¬ä¼šä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥å‘å¸ƒèŠ‚ç‚¹ï¼Œä½œä¸ºä¸€ä¸ªé‡Œç¨‹ç¢‘ç­‰ç‰¹æ®Šæ„ä¹‰çš„æ ‡è¯†ã€‚</p>\n<p><code>git</code>  ä¸­æ ‡ç­¾ä½¿ç”¨  <code>tag</code>  æ¥è¡¨ç¤ºã€‚å¯¹åº”ç€  <code>git tag</code>  è¿™ä¸ªå‘½ä»¤ã€‚</p>\n<p>å…ˆçœ‹ä¸€ä¸‹  <code>git tag</code>  å‘½ä»¤å§ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git tag [-a | -s | -u &lt;keyid&gt;] [-f] [-m &lt;msg&gt; | -F &lt;file&gt;]</span><br><span class=\"line\">        &lt;tagname&gt; [&lt;commit&gt; | &lt;object&gt;]</span><br><span class=\"line\">git tag -d &lt;tagname&gt;...</span><br><span class=\"line\">git tag [-n[&lt;num&gt;]] -l [--contains &lt;commit&gt;] [--no-contains &lt;commit&gt;]</span><br><span class=\"line\">        [--points-at &lt;object&gt;] [--column[=&lt;options&gt;] | --no-column]</span><br><span class=\"line\">        [--create-reflog] [--sort=&lt;key&gt;] [--format=&lt;format&gt;]</span><br><span class=\"line\">        [--[no-]merged [&lt;commit&gt;]] [&lt;pattern&gt;...]</span><br><span class=\"line\">git tag -v [--format=&lt;format&gt;] &lt;tagname&gt;...</span><br></pre></td></tr></table></figure>\n<p>è€è§„çŸ©ï¼Œè¿™é‡Œæˆ‘ä»¬ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤ã€‚</p>\n<h4 id=\"æ ‡ç­¾å‘½ä»¤\"><a class=\"markdownIt-Anchor\" href=\"#æ ‡ç­¾å‘½ä»¤\">#</a> æ ‡ç­¾å‘½ä»¤</h4>\n<p><code>git</code>  æ”¯æŒä¸¤ç§æ ‡ç­¾ï¼Œ è½»é‡æ ‡ç­¾ å’Œ é™„æ³¨æ ‡ç­¾ã€‚</p>\n<p>è½»é‡æ ‡ç­¾ æ˜¯ä¸€ä¸ª <code>ä¸ä¼šæ”¹å˜çš„åˆ†æ”¯</code> ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç‰¹å®šçš„æäº¤å¼•ç”¨ã€‚<br>\nè€Œé™„æ³¨æ ‡ç­¾æ˜¯å­˜å‚¨åœ¨ Git æ•°æ®åº“ä¸­çš„ä¸€ä¸ªå®Œæ•´å¯¹è±¡ï¼Œ å®ƒä»¬æ˜¯å¯ä»¥è¢«æ ¡éªŒçš„ï¼Œå…¶ä¸­åŒ…å«æ‰“æ ‡ç­¾è€…çš„åå­—ã€ç”µå­é‚®ä»¶åœ°å€ã€æ—¥æœŸæ—¶é—´ï¼Œ æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªæ ‡ç­¾ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ GNU Privacy Guard ï¼ˆGPGï¼‰ç­¾åå¹¶éªŒè¯ã€‚ é€šå¸¸ä¼šå»ºè®®åˆ›å»ºé™„æ³¨æ ‡ç­¾ï¼Œè¿™æ ·ä½ å¯ä»¥æ‹¥æœ‰ä»¥ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚ä½†æ˜¯å¦‚æœä½ åªæ˜¯æƒ³ç”¨ä¸€ä¸ªä¸´æ—¶çš„æ ‡ç­¾ï¼Œ æˆ–è€…å› ä¸ºæŸäº›åŸå› ä¸æƒ³è¦ä¿å­˜è¿™äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç”¨è½»é‡æ ‡ç­¾ã€‚</p>\n<p>è¿™é‡Œæˆ‘ä»¥åŠŸèƒ½ä¸ºç‚¹ï¼ŒåŒæ—¶ä»‹ç»ä¸¤ç§æ ‡ç­¾çš„ä½¿ç”¨çš„æ–¹å¼ã€‚</p>\n<h5 id=\"åˆ›å»ºæ ‡ç­¾\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºæ ‡ç­¾\">#</a> åˆ›å»ºæ ‡ç­¾</h5>\n<h6 id=\"åˆ›å»ºé™„æ³¨æ ‡ç­¾\"><a class=\"markdownIt-Anchor\" href=\"#åˆ›å»ºé™„æ³¨æ ‡ç­¾\">#</a> åˆ›å»ºé™„æ³¨æ ‡ç­¾</h6>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  git_learn git:(master) git log --pretty=oneline</span><br><span class=\"line\">cbfebb28dde6707bf9dcc95175506a5c4cd4bfb4 (HEAD -&gt; master) commit 3</span><br><span class=\"line\">76400568f6397322f7d57d13834fa5ff6fbed2d9 commit 2</span><br><span class=\"line\">5758ef102fd4924ffbcf4c0cfeddac503deb32a9 commit 1</span><br><span class=\"line\"></span><br><span class=\"line\">## æ·»åŠ æ ‡ç­¾</span><br><span class=\"line\">âœ  git_learn git:(master) git tag -a v1.0 cbfebb28dde6707bf9dcc95175506a5c4cd4bfb4 -m &quot;ç¬¬ä¸€ä¸ªtag&quot;</span><br><span class=\"line\">## æŸ¥çœ‹æ ‡ç­¾çš„å†…å®¹</span><br><span class=\"line\">âœ  git_learn git:(master) git show v1.0</span><br><span class=\"line\"># è¾“å‡ºæ˜¾ç¤ºäº†æ‰“æ ‡ç­¾è€…çš„ä¿¡æ¯ã€æ‰“æ ‡ç­¾çš„æ—¥æœŸæ—¶é—´ã€é™„æ³¨ä¿¡æ¯ï¼Œç„¶åæ˜¾ç¤ºå…·ä½“çš„æäº¤ä¿¡æ¯ã€‚  2</span><br><span class=\"line\">tag v1.0</span><br><span class=\"line\">Tagger: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Fri Jul 31 08:51:24 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">ç¬¬ä¸€ä¸ªtag</span><br><span class=\"line\"></span><br><span class=\"line\">commit cbfebb28dde6707bf9dcc95175506a5c4cd4bfb4 (HEAD -&gt; master, tag: v1.0)</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Fri Jul 31 08:45:24 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    commit 3</span><br><span class=\"line\"></span><br><span class=\"line\">diff --git a/test3.txt b/test3.txt</span><br><span class=\"line\">new file mode 100644</span><br><span class=\"line\">index 0000000..e69de29</span><br></pre></td></tr></table></figure>\n<p><code>-m</code>  é€‰é¡¹æŒ‡å®šäº†ä¸€æ¡å°†ä¼šå­˜å‚¨åœ¨æ ‡ç­¾ä¸­çš„ä¿¡æ¯ã€‚ å¦‚æœæ²¡æœ‰ä¸ºé™„æ³¨æ ‡ç­¾æŒ‡å®šä¸€æ¡ä¿¡æ¯ï¼ŒGit ä¼šå¯åŠ¨ç¼–è¾‘å™¨è¦æ±‚ä½ è¾“å…¥ä¿¡æ¯</p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/05-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A42%20git%E6%97%B6%E5%85%89%E6%9C%BA1/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/05-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A42%20git%E6%97%B6%E5%85%89%E6%9C%BA1/",
            "title": "gitåŸºæœ¬å‘½ä»¤äºŒ",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<p><code>git</code>  çš„æ—¶å…‰æœº (ç®€åŒ–ç‰ˆ)</p>\n<ul>\n<li><code>git log</code> ï¼šæŸ¥çœ‹å†å²è®°å½•</li>\n<li><code>git commit -amend</code> ï¼šé‡å†™ä¸Šä¸€æ¬¡çš„æäº¤å†å²</li>\n</ul>\n<h3 id=\"git-log\"><a class=\"markdownIt-Anchor\" href=\"#git-log\">#</a>  <code>git log</code></h3>\n<p><code>git</code>  æœ‰ä¸€ä¸ªç‰¹åˆ«å®ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥è®©æˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰çš„å†å²æ›´æ”¹è®°å½•ã€‚è¿™ä¸ªå‘½ä»¤å°±æ˜¯  <code>git log</code> .</p>\n<p>é¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸€ä¸ªä»“åº“ã€‚éšä¾¿è¿›è¡Œ <code>5</code>  æ¬¡æ›´æ”¹ï¼Œ <code>5</code>  æäº¤ã€‚</p>\n<p>æ‰§è¡Œå¦‚ä¸‹çš„æ“ä½œ:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git init .</span><br><span class=\"line\">Initialized empty Git repository in /private/tmp/gitlearn/.git/</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— echo &#x27;ç¬¬ä¸€è¡Œ&#x27; &gt; testGitLog</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test git-log 1 &quot;</span><br><span class=\"line\">[master (root-commit) 0718ac9] test git-log 1</span><br><span class=\"line\"> 2 files changed, 2 insertions(+)</span><br><span class=\"line\"> create mode 100644 .gitignore</span><br><span class=\"line\"> create mode 100644 testGitLog</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;ç¬¬äºŒè¡Œ&#x27; &gt;&gt; testGitLog</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -a -m &quot;test git-log 2 &quot;</span><br><span class=\"line\">[master f8248a5] test git-log 2</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;ç¬¬ä¸‰è¡Œ&#x27; &gt;&gt; testGitLog</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -a -m &quot;test git-log 3 &quot;</span><br><span class=\"line\">[master b282b88] test git-log 3</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;ç¬¬å››è¡Œ&#x27; &gt;&gt; testGitLog</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -a -m &quot;test git-log 4 &quot;</span><br><span class=\"line\">[master b9df1bb] test git-log 4</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;ç¬¬äº”è¡Œ&#x27; &gt;&gt; testGitLog</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -a -m &quot;test git-log 5 &quot;</span><br><span class=\"line\">[master 769db1c] test git-log 5</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>\n<p>è¿è¡Œä¸€ä¸‹  <code>git log</code>  æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è¾“å‡ºçš„å†…å®¹ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">commit 769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master)</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:36:11 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 5</span><br><span class=\"line\"></span><br><span class=\"line\">commit b9df1bb5c10f6602f7fa889ca91759a2e45e69cb</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:36:01 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 4</span><br><span class=\"line\"></span><br><span class=\"line\">commit b282b882317b118095eb921e707e449f45fdeef6</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:35:48 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 3</span><br><span class=\"line\"></span><br><span class=\"line\">commit f8248a5fbc18a90710c95cee475b34797299bc61</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:35:30 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 2</span><br><span class=\"line\"></span><br><span class=\"line\">commit 0718ac9a20021971d6f1a09a3ef72e36b6fd73c9</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:34:39 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 1</span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¼ å…¥ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ï¼Œ <code>git log</code>  ä¼šæŒ‰ç…§å…ˆåé¡ºåºåˆ—å‡ºæ‰€æœ‰çš„æäº¤ï¼Œæ—¶é—´æœ€è¿‘çš„æ›´æ–°æ’åœ¨æœ€ä¸Šé¢ã€‚</p>\n<p>è¯¥å‘½ä»¤ä¼šåˆ—å‡ºæ¯æ¬¡æäº¤çš„ SHA-1 æ ¡éªŒå’Œï¼Œä½œè€…çš„åå­—å’Œç”µå­é‚®ç®±ï¼Œæäº¤æ—¶é—´ï¼Œä»¥åŠæäº¤è¯´æ˜ã€‚</p>\n<p><code>git log</code>  è¿˜æœ‰å¾ˆå¤šæˆ‘ä»¬é€‰é¡¹ï¼Œæˆ‘åœ¨åé¢æœ‰ä¸€ç¯‡æ–‡ç« å†™äº† git çš„å‘½ä»¤å¤§å…¨ï¼Œå¹¶ä¸”ä¼šä¿æŒæ›´æ–°å“¦ã€‚</p>\n<h4 id=\"git-logå‘½ä»¤é€‰é¡¹\"><a class=\"markdownIt-Anchor\" href=\"#git-logå‘½ä»¤é€‰é¡¹\">#</a>  <code>git log</code>  å‘½ä»¤é€‰é¡¹</h4>\n<p>è¿™é‡Œæˆ‘ä»¬å°±å…ˆä»‹ç»ä¸€å†™å¸¸ç”¨çš„å‘½ä»¤é€‰é¡¹ã€‚</p>\n<h5 id=\"æ˜¾ç¤ºæ¯æ¬¡æäº¤æ‰€å¼•å…¥çš„å·®å¼‚-patch\"><a class=\"markdownIt-Anchor\" href=\"#æ˜¾ç¤ºæ¯æ¬¡æäº¤æ‰€å¼•å…¥çš„å·®å¼‚-patch\">#</a> æ˜¾ç¤ºæ¯æ¬¡æäº¤æ‰€å¼•å…¥çš„å·®å¼‚  <code>--patch</code></h5>\n<p><code>git log --patch</code>  æˆ–è€…  <code>git log -p</code>  ä¼šæ˜¾ç¤ºæ¯æ¬¡æäº¤æ‰€å¼•å…¥çš„å·®å¼‚ï¼Œä¼šæŒ‰ç…§è¡¥ä¸çš„æ–¹å¼å±•ç¤ºã€‚åé¢ä¹Ÿå¯ä»¥åŠ ä¸Šæ•°å­—æ¥é™åˆ¶ä¸‹é¢æ˜¾ç¤ºå‡ æ¬¡æäº¤ã€‚æ¯”å¦‚ï¼š <code>git log -p -1</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">commit 769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master)</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:36:11 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 5</span><br><span class=\"line\"></span><br><span class=\"line\">diff --git a/testGitLog b/testGitLog</span><br><span class=\"line\">index 11c20cd..844b7e8 100644</span><br><span class=\"line\">--- a/testGitLog</span><br><span class=\"line\">+++ b/testGitLog</span><br><span class=\"line\">@@ -2,3 +2,4 @@</span><br><span class=\"line\"> ç¬¬äºŒè¡Œ</span><br><span class=\"line\"> ç¬¬ä¸‰è¡Œ</span><br><span class=\"line\"> ç¬¬å››è¡Œ</span><br><span class=\"line\">+ç¬¬äº”è¡Œ</span><br><span class=\"line\"></span><br><span class=\"line\">commit b9df1bb5c10f6602f7fa889ca91759a2e45e69cb</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:36:01 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 4</span><br><span class=\"line\"></span><br><span class=\"line\">diff --git a/testGitLog b/testGitLog</span><br><span class=\"line\">index f1c8e85..11c20cd 100644</span><br><span class=\"line\">--- a/testGitLog</span><br><span class=\"line\">+++ b/testGitLog</span><br><span class=\"line\">@@ -1,3 +1,4 @@</span><br><span class=\"line\"> ç¬¬ä¸€è¡Œ</span><br><span class=\"line\"> ç¬¬äºŒè¡Œ</span><br><span class=\"line\"> ç¬¬ä¸‰è¡Œ</span><br><span class=\"line\">+ç¬¬å››è¡Œ</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>é™åˆ¶æäº¤æ•°æ¼”ç¤ºï¼š</p>\n<p><code>git log -p -1</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">commit 769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master)</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:36:11 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 5</span><br><span class=\"line\"></span><br><span class=\"line\">diff --git a/testGitLog b/testGitLog</span><br><span class=\"line\">index 11c20cd..844b7e8 100644</span><br><span class=\"line\">--- a/testGitLog</span><br><span class=\"line\">+++ b/testGitLog</span><br><span class=\"line\">@@ -2,3 +2,4 @@</span><br><span class=\"line\"> ç¬¬äºŒè¡Œ</span><br><span class=\"line\"> ç¬¬ä¸‰è¡Œ</span><br><span class=\"line\"> ç¬¬å››è¡Œ</span><br><span class=\"line\">+ç¬¬äº”è¡Œ</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªé€‰é¡¹å¯ä»¥åœ¨æ¯æ¬¡æäº¤çš„ä¸‹é¢åˆ—å‡ºæ‰€æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œæœ‰å¤šå°‘æ–‡ä»¶è¢«ä¿®æ”¹äº†ä»¥åŠè¢«ä¿®æ”¹è¿‡çš„æ–‡ä»¶çš„å“ªäº›è¡Œè¢«ç§»é™¤æˆ–æ˜¯æ·»åŠ äº†ã€‚ åœ¨æ¯æ¬¡æäº¤çš„æœ€åè¿˜æœ‰ä¸€ä¸ªæ€»ç»“ã€‚</p>\n<h5 id=\"æŸ¥çœ‹æ¯æ¬¡æäº¤çš„ç®€ç•¥ç»Ÿè®¡ä¿¡æ¯-git-log-stat\"><a class=\"markdownIt-Anchor\" href=\"#æŸ¥çœ‹æ¯æ¬¡æäº¤çš„ç®€ç•¥ç»Ÿè®¡ä¿¡æ¯-git-log-stat\">#</a> æŸ¥çœ‹æ¯æ¬¡æäº¤çš„ç®€ç•¥ç»Ÿè®¡ä¿¡æ¯ï¼Œ <code>git log --stat</code></h5>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">commit 769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master)</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Date:   Tue Jul 21 15:36:11 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 5</span><br><span class=\"line\"></span><br><span class=\"line\">## ä»€ä¹ˆæ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œå¢åŠ è¿˜æ˜¯åˆ é™¤</span><br><span class=\"line\"> testGitLog | 1 +</span><br><span class=\"line\">## ä¸€å…±ä¿®æ”¹äº†å¤šå°‘æ–‡ä»¶</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<h4 id=\"æ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—-pretty\"><a class=\"markdownIt-Anchor\" href=\"#æ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—-pretty\">#</a> æ ¼å¼åŒ–è¾“å‡ºæ—¥å¿—  <code>--pretty</code></h4>\n<p>è¿™ä¸ªé€‰é¡¹å¯ä»¥ä½¿ä¸åŒäºé»˜è®¤æ ¼å¼åŒ–çš„æ–¹å¼å±•ç¤ºæäº¤å†å²ã€‚å®ƒæä¾›äº†å‡ ç§å†…å»ºçš„æ ¼å¼åŒ–æ–¹å¼ï¼Œé™¤æ­¤ä¹‹å¤–ä½¿ç”¨è€…è¿˜å¯ä»¥è‡ªå®šä¹‰æ ¼å¼åŒ–æ–¹å¼ã€‚</p>\n<h6 id=\"å†…å»ºä¸€oneline\"><a class=\"markdownIt-Anchor\" href=\"#å†…å»ºä¸€oneline\">#</a> å†…å»ºä¸€ï¼šoneline</h6>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log --pretty=oneline</span><br><span class=\"line\">769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master) test git-log 5</span><br><span class=\"line\">b9df1bb5c10f6602f7fa889ca91759a2e45e69cb test git-log 4</span><br><span class=\"line\">b282b882317b118095eb921e707e449f45fdeef6 test git-log 3</span><br><span class=\"line\">f8248a5fbc18a90710c95cee475b34797299bc61 test git-log 2</span><br><span class=\"line\">0718ac9a20021971d6f1a09a3ef72e36b6fd73c9 test git-log 1</span><br></pre></td></tr></table></figure>\n<h6 id=\"å†…å»ºäºŒ-short\"><a class=\"markdownIt-Anchor\" href=\"#å†…å»ºäºŒ-short\">#</a> å†…å»ºäºŒï¼š short</h6>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log --pretty=short</span><br><span class=\"line\">commit 769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master)</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 5</span><br><span class=\"line\"></span><br><span class=\"line\">commit b9df1bb5c10f6602f7fa889ca91759a2e45e69cb</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 4</span><br><span class=\"line\"></span><br><span class=\"line\">commit b282b882317b118095eb921e707e449f45fdeef6</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 3</span><br><span class=\"line\"></span><br><span class=\"line\">commit f8248a5fbc18a90710c95cee475b34797299bc61</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 2</span><br><span class=\"line\"></span><br><span class=\"line\">commit 0718ac9a20021971d6f1a09a3ef72e36b6fd73c9</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 1</span><br></pre></td></tr></table></figure>\n<h6 id=\"å†…å»ºä¸‰full\"><a class=\"markdownIt-Anchor\" href=\"#å†…å»ºä¸‰full\">#</a> å†…å»ºä¸‰ï¼šfull</h6>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log --pretty=full</span><br><span class=\"line\">commit 769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master)</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Commit: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 5</span><br><span class=\"line\"></span><br><span class=\"line\">commit b9df1bb5c10f6602f7fa889ca91759a2e45e69cb</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Commit: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 4</span><br><span class=\"line\"></span><br><span class=\"line\">commit b282b882317b118095eb921e707e449f45fdeef6</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Commit: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 3</span><br><span class=\"line\"></span><br><span class=\"line\">commit f8248a5fbc18a90710c95cee475b34797299bc61</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Commit: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 2</span><br><span class=\"line\"></span><br><span class=\"line\">commit 0718ac9a20021971d6f1a09a3ef72e36b6fd73c9</span><br><span class=\"line\">Author: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">Commit: fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 1</span><br></pre></td></tr></table></figure>\n<h6 id=\"å†…å»ºå››fuller\"><a class=\"markdownIt-Anchor\" href=\"#å†…å»ºå››fuller\">#</a> å†…å»ºå››ï¼šfuller</h6>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log --pretty=fullter</span><br><span class=\"line\"></span><br><span class=\"line\">commit 769db1cd5ba091162707a3e648d67ec8e6913d2b (HEAD -&gt; master)</span><br><span class=\"line\">Author:     fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">AuthorDate: Tue Jul 21 15:36:11 2020 +0800</span><br><span class=\"line\">Commit:     fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">CommitDate: Tue Jul 21 15:36:11 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 5</span><br><span class=\"line\"></span><br><span class=\"line\">commit b9df1bb5c10f6602f7fa889ca91759a2e45e69cb</span><br><span class=\"line\">Author:     fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">AuthorDate: Tue Jul 21 15:36:01 2020 +0800</span><br><span class=\"line\">Commit:     fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">CommitDate: Tue Jul 21 15:36:01 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test git-log 4</span><br><span class=\"line\"></span><br><span class=\"line\">commit b282b882317b118095eb921e707e449f45fdeef6</span><br><span class=\"line\">Author:     fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">AuthorDate: Tue Jul 21 15:35:48 2020 +0800</span><br><span class=\"line\">Commit:     fangjiaxiaobai &lt;fangjiaxiaobai@163.com&gt;</span><br><span class=\"line\">CommitDate: Tue Jul 21 15:35:48 2020 +0800</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h6 id=\"æœ€nbçš„format\"><a class=\"markdownIt-Anchor\" href=\"#æœ€nbçš„format\">#</a> æœ€ NB çš„ï¼šformat</h6>\n<p>è¿™ä¸ªé€‰é¡¹ç›®å¯ä»¥è®©æˆ‘ä»¬å®šåˆ¶è®°å½•çš„æ˜¾ç¤ºæ ¼å¼ï¼Œè¿™ç§å¹¶ä¸ä¼šéšç€ git çš„æ›´æ–°è€Œå‘ç”Ÿæ”¹å˜ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log --pretty=format:&quot;%h-%an,%ar:%s&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">769db1c - fangjiaxiaobai, 27 minutes ago:test git-log 5</span><br><span class=\"line\">b9df1bb - fangjiaxiaobai, 27 minutes ago:test git-log 4</span><br><span class=\"line\">b282b88 - fangjiaxiaobai, 27 minutes ago:test git-log 3</span><br><span class=\"line\">f8248a5 - fangjiaxiaobai, 27 minutes ago:test git-log 2</span><br><span class=\"line\">0718ac9 - fangjiaxiaobai, 28 minutes ago:test git-log 1</span><br></pre></td></tr></table></figure>\n<p>format åé¢çš„åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ<br>\nè¿™é‡Œåˆ—å‡ºäº† Format çš„å¸¸ç”¨å‚æ•°ã€‚</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">å‚æ•°</th>\n<th style=\"text-align:left\">å«ä¹‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">%H</td>\n<td style=\"text-align:left\">æäº¤çš„å®Œæ•´å“ˆå¸Œå€¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%h</td>\n<td style=\"text-align:left\">æäº¤çš„ç®€å†™å“ˆå¸Œå€¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%T</td>\n<td style=\"text-align:left\">æ ‘çš„å®Œæ•´å“ˆå¸Œå€¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%t</td>\n<td style=\"text-align:left\">æ ‘çš„ç®€å†™å“ˆå¸Œå€¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%P</td>\n<td style=\"text-align:left\">çˆ¶æäº¤çš„å®Œæ•´å“ˆå¸Œå€¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%p</td>\n<td style=\"text-align:left\">çˆ¶æäº¤çš„ç®€å†™å“ˆå¸Œå€¼</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%an</td>\n<td style=\"text-align:left\">ä½œè€…åå­—</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%ae</td>\n<td style=\"text-align:left\">ä½œè€…çš„ç”µå­é‚®ä»¶åœ°å€</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%ad</td>\n<td style=\"text-align:left\">ä½œè€…ä¿®è®¢æ—¥æœŸï¼ˆå¯ä»¥ç”¨ --date = é€‰é¡¹ æ¥å®šåˆ¶æ ¼å¼ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%ar</td>\n<td style=\"text-align:left\">ä½œè€…ä¿®è®¢æ—¥æœŸï¼ŒæŒ‰å¤šä¹…ä»¥å‰çš„æ–¹å¼æ˜¾ç¤º</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%cn</td>\n<td style=\"text-align:left\">æäº¤è€…çš„åå­—</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%ce</td>\n<td style=\"text-align:left\">æäº¤è€…çš„ç”µå­é‚®ä»¶åœ°å€</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%cd</td>\n<td style=\"text-align:left\">æäº¤æ—¥æœŸ</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%cr</td>\n<td style=\"text-align:left\">æäº¤æ—¥æœŸï¼ˆè·ä»Šå¤šé•¿æ—¶é—´ï¼‰</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">%s</td>\n<td style=\"text-align:left\">æäº¤è¯´æ˜</td>\n</tr>\n</tbody>\n</table>\n<p>å’¦ï½ï¼Ÿä½œè€…å’Œæäº¤è¿™æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mtext>â·</mtext></msup></mrow><annotation encoding=\"application/x-tex\">^â·</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.363em;vertical-align:0em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.363em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">â·</span></span></span></span></span></span></span></span></span></span></span><br>\nè¿™é‡Œï¼Œå°ç™½å°±è¦å–ä¸€ä¸ªå…³å­äº†ã€‚ä¸è¿‡ç­”æ¡ˆå°±åœ¨è¿™ä¸ªç³»åˆ—é‡Œï½ã€‚å› ä¸ºåœ¨ç›®å‰è¿™æ€»å•åˆ†æ”¯çš„æœ¬åœ°å¼€å‘ç¯å¢ƒé‡Œï¼Œæäº¤è€…å°±æ˜¯ä½œè€…ã€‚<br>\nå¦å¤–åœ¨å¤šåˆ†æ”¯çš„å¼€å‘è¿‡è½¦ä¸­ï¼Œä½¿ç”¨  <code>format</code>  é…åˆ  <code>--graph</code>  é€‰é¡¹å°±å°¤ä¸ºæœ‰ç”¨ã€‚åé¢ä»‹ç»ï½</p>\n<h5 id=\"é™åˆ¶è¾“å‡ºæ€§çš„é€‰é¡¹\"><a class=\"markdownIt-Anchor\" href=\"#é™åˆ¶è¾“å‡ºæ€§çš„é€‰é¡¹\">#</a> é™åˆ¶è¾“å‡ºæ€§çš„é€‰é¡¹</h5>\n<p>ä¸Šé¢ç”¨è¿‡äº†  <code>-&lt;number&gt;</code>  çš„æ–¹å¼æ¥æ˜¾ç¤º git log è¾“å‡ºæ—¥å¿—çš„æ¡æ•°ï¼Œgit è¿˜æä¾›äº† ç±»ä¼¼äºï¼š  <code>--since</code>  å’Œ  <code>--until</code> ,  <code>--before</code>  ç­‰æ—¶é—´é™åˆ¶çš„é€‰é¡¹ç›®ã€‚</p>\n<p>æ¯”å¦‚ï¼š  <code>git log --since=2.weeks</code>  è¾“å‡º 2 å‘¨ä¹‹å†…çš„æäº¤è®°å½•ã€‚</p>\n<p>è¯¥å‘½ä»¤å¯ç”¨çš„æ ¼å¼ååˆ†ä¸°å¯Œ â€”â€” å¯ä»¥æ˜¯ç±»ä¼¼ â€œ2008-01-15â€ çš„å…·ä½“çš„æŸä¸€å¤©ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»ä¼¼ â€œ2 years 1 day 3 minutes agoâ€ çš„ç›¸å¯¹æ—¥æœŸã€‚<br>\nè¿˜å¯ä»¥è¿‡æ»¤å‡ºåŒ¹é…æŒ‡å®šæ¡ä»¶çš„æäº¤ã€‚ ç”¨  <code>--author</code>  é€‰é¡¹æ˜¾ç¤ºæŒ‡å®šä½œè€…çš„æäº¤ï¼Œç”¨  <code>--grep</code>  é€‰é¡¹æœç´¢æäº¤è¯´æ˜ä¸­çš„å…³é”®å­—ã€‚</p>\n<p>å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„è¿‡æ»¤å™¨æ˜¯ -Sï¼ˆä¿—ç§° <code>â€œpickaxeâ€</code>  é€‰é¡¹ï¼Œå– â€œç”¨é¹¤å˜´é”„åœ¨åœŸé‡Œæ¡çŸ³å¤´â€ ä¹‹æ„ï¼‰ï¼Œ å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶ä¸”åªä¼šæ˜¾ç¤ºé‚£äº›æ·»åŠ æˆ–åˆ é™¤äº†è¯¥å­—ç¬¦ä¸²çš„æäº¤ã€‚ å‡è®¾ä½ æƒ³æ‰¾å‡ºæ·»åŠ æˆ–åˆ é™¤äº†å¯¹æŸä¸€ä¸ªç‰¹å®šå‡½æ•°çš„å¼•ç”¨çš„æäº¤ï¼Œå¯ä»¥è°ƒç”¨ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git log -S function_name</span><br></pre></td></tr></table></figure>\n<p>æœ€åä¸€ä¸ªå¾ˆå®ç”¨çš„  <code>git log</code>  é€‰é¡¹æ˜¯è·¯å¾„ï¼ˆ <code>path</code> ï¼‰ï¼Œ å¦‚æœåªå…³å¿ƒæŸäº›æ–‡ä»¶æˆ–è€…ç›®å½•çš„å†å²æäº¤ï¼Œå¯ä»¥åœ¨  <code>git log</code>  é€‰é¡¹çš„æœ€åæŒ‡å®šå®ƒä»¬çš„è·¯å¾„ã€‚ å› ä¸ºæ˜¯æ”¾åœ¨æœ€åä½ç½®ä¸Šçš„é€‰é¡¹ï¼Œæ‰€ä»¥ç”¨ä¸¤ä¸ªçŸ­åˆ’çº¿ï¼ˆ <code>--</code> ï¼‰éš”å¼€ä¹‹å‰çš„é€‰é¡¹å’Œåé¢é™å®šçš„è·¯å¾„åã€‚</p>\n<h2 id=\"git-commit-amend\"><a class=\"markdownIt-Anchor\" href=\"#git-commit-amend\">#</a>  <code>git commit --amend</code></h2>\n<p>è¿™ä¸ªå‘½ä»¤å¯ä»¥è®©æˆ‘ä»¬é‡å†™ä¸Šä¸€æ¬¡çš„æäº¤è®°å½•ã€‚<br>\næ¯”å¦‚æœ‰ä¸‹é¢è¿™æ ·çš„åœºæ™¯ï¼š</p>\n<p>å°ç™½ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæäº¤äº†ä¹‹åå‘ç°å†™äº†ä¸€ä¸ªé”™åˆ«å­—ï¼Œå°ç™½åˆæƒ³ä¿æŒ <code>git</code>  æäº¤å†å²çš„æ•´æ´ã€‚è¿™æ—¶  <code>git commit -amend</code>  å°±æ´¾ä¸Šäº†ç”¨åœºäº†ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) git log --pretty=oneline</span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;ç¬¬ç•™è¡Œ&#x27; &gt;&gt; testGitLog</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -a -m &quot;test git-log 6 &quot;</span><br><span class=\"line\">[detached HEAD f65b589] test git-log 6</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\">âœ  gitlearn git:(master) vim testGitLog</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -a --amend -m &quot;test git-log 6 &quot;</span><br><span class=\"line\">[detached HEAD 1afd020] test git-log 6</span><br><span class=\"line\"> Date: Tue Jul 21 16:36:43 2020 +0800</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"></span><br><span class=\"line\"> # æŸ¥çœ‹æäº¤æ—¥å¿—</span><br><span class=\"line\">âœ  gitlearn git:(master) git log --pretty=oneline</span><br><span class=\"line\">1afd020466eb9b519cec80415cb1e9c587612511 (HEAD) test git-log 6</span><br><span class=\"line\">769db1cd5ba091162707a3e648d67ec8e6913d2b test git-log 5</span><br><span class=\"line\">b9df1bb5c10f6602f7fa889ca91759a2e45e69cb test git-log 4</span><br><span class=\"line\">b282b882317b118095eb921e707e449f45fdeef6 test git-log 3</span><br><span class=\"line\">f8248a5fbc18a90710c95cee475b34797299bc61 test git-log 2</span><br><span class=\"line\">0718ac9a20021971d6f1a09a3ef72e36b6fd73c9 test git-log 1</span><br><span class=\"line\">(END)</span><br></pre></td></tr></table></figure>\n<p>æ³¨æ„ï¼ è¿™é‡Œç¬¬äºŒæ¬¡æäº¤çš„ç»“æœä¼šæ›¿æ¢æ‰ä¹‹å‰çš„ä¸€æ¬¡æäº¤ã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡ ç®€çº¦ç‰ˆæœ¬æ—¶å…‰æœºçš„æ‰€æœ‰å†…å®¹äº†ã€‚ä¸‹ä¸€ç¯‡ è¿œç¨‹ä»“åº“</p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/06-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A43-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/06-git%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A43-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/",
            "title": "gitå‘½ä»¤3 - è¿œç¨‹ä»“åº“",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h1 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> </h1>\n<p>è¿œç¨‹ä»“åº“æŒ‡çš„æ˜¯ æ‰˜ç®¡åˆ°å› ç‰¹ç½‘æˆ–è€…å…¶ä»–ç½‘ç»œä¸­çš„é¡¹ç›®çš„ç‰ˆæœ¬åº“ã€‚</p>\n<p>å¯ä»¥ä½¿ç”¨  <code>git remote</code>  å‘½ä»¤æ¥é…ç½®è¿œç¨‹ä»“åº“ã€‚</p>\n<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹  <code>git remote</code>  å‘½ä»¤éƒ½æœ‰ä»€ä¹ˆå­é€‰é¡¹.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote [-v | --verbose]</span><br><span class=\"line\">git remote add [-t &lt;branch&gt;] [-m &lt;master&gt;] [-f] [--[no-]tags] [--mirror=&lt;fetch|push&gt;] &lt;name&gt; &lt;url&gt;</span><br><span class=\"line\">git remote rename &lt;old&gt; &lt;new&gt;</span><br><span class=\"line\">git remote remove &lt;name&gt;</span><br><span class=\"line\">git remote set-head &lt;name&gt; (-a | --auto | -d | --delete | &lt;branch&gt;)</span><br><span class=\"line\">git remote set-branches [--add] &lt;name&gt; &lt;branch&gt;...</span><br><span class=\"line\">git remote get-url [--push] [--all] &lt;name&gt;</span><br><span class=\"line\">git remote set-url [--push] &lt;name&gt; &lt;newurl&gt; [&lt;oldurl&gt;]</span><br><span class=\"line\">git remote set-url --add [--push] &lt;name&gt; &lt;newurl&gt;</span><br><span class=\"line\">git remote set-url --delete [--push] &lt;name&gt; &lt;url&gt;</span><br><span class=\"line\">git remote [-v | --verbose] show [-n] &lt;name&gt;...</span><br><span class=\"line\">git remote prune [-n | --dry-run] &lt;name&gt;...</span><br><span class=\"line\">git remote [-v | --verbose] update [-p | --prune] [(&lt;group&gt; | &lt;remote&gt;)...]</span><br></pre></td></tr></table></figure>\n<p>ä¸‹é¢æˆ‘ä»¬åªä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„è¿œç¨‹ä»“åº“çš„å‘½ä»¤</p>\n<h3 id=\"é…ç½®è¿œç¨‹ä»“åº“-git-remote-add\"><a class=\"markdownIt-Anchor\" href=\"#é…ç½®è¿œç¨‹ä»“åº“-git-remote-add\">#</a> é…ç½®è¿œç¨‹ä»“åº“ -  <code>git remote add</code></h3>\n<p><code>git remote add [-t &lt;branch&gt;] [-m &lt;master&gt;] [-f] [--[no-]tags] [--mirror=&lt;fetch|push&gt;] &lt;name&gt; &lt;url&gt;</code></p>\n<p>é¦–å…ˆåœ¨é¡µé¢ä¸Šæ–°å»ºä¸€ä¸ªç©ºçš„ä»“åº“å¤‡ç”¨ã€‚<br>\n<img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/web%E9%A1%B5%E9%9D%A2%E4%B8%8A%E6%96%B0%E5%BB%BAgit%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93.png\" alt=\"webé¡µé¢ä¸Šæ–°å»ºgitè¿œç¨‹ä»“åº“.png\"><br>\n æ¼”ç¤ºä¸€ä¸‹ä½¿ç”¨:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git init .</span><br><span class=\"line\">Initialized empty Git repository in /private/tmp/gitlearn/.git/</span><br><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;æ¼”ç¤ºé…ç½®è¿œç¨‹ä»“åº“&#x27; &gt; testRemoteGit</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;æ–°å¢ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆå§‹åŒ–é¡¹ç›®&quot;</span><br><span class=\"line\">[master (root-commit) 5ed81fa] æ–°å¢ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆå§‹åŒ–é¡¹ç›®</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"> create mode 100644 testRemoteGit</span><br><span class=\"line\"> # é…ç½®è¿œç¨‹ä»“åº“</span><br><span class=\"line\">âœ  gitlearn git:(master) git remote add origin https://gitee.com/fangjiaxiaobai/gitlearn.git</span><br><span class=\"line\"># æŸ¥çœ‹è¿œç¨‹ä»“åº“</span><br><span class=\"line\">âœ  gitlearn git:(master) git remote -v</span><br><span class=\"line\">origin\thttps://gitee.com/fangjiaxiaobai/gitlearn.git (fetch)</span><br><span class=\"line\">origin\thttps://gitee.com/fangjiaxiaobai/gitlearn.git (push)</span><br><span class=\"line\"></span><br><span class=\"line\">## åœ¨å¢åŠ ä¸€ä¸ªè¿œç¨‹ä»“åº“</span><br><span class=\"line\">âœ  gitlearn git:(master) git remote add origin2 http://git.baijiahulian.com/wangxiyue/gitlearn.git</span><br><span class=\"line\">âœ  gitlearn git:(master) git remote -v</span><br><span class=\"line\">origin\thttps://gitee.com/fangjiaxiaobai/gitlearn.git (fetch)</span><br><span class=\"line\">origin\thttps://gitee.com/fangjiaxiaobai/gitlearn.git (push)</span><br><span class=\"line\">origin2\thttp://git.baijiahulian.com/wangxiyue/gitlearn.git (fetch)</span><br><span class=\"line\">origin2\thttp://git.baijiahulian.com/wangxiyue/gitlearn.git (push)</span><br></pre></td></tr></table></figure>\n<h3 id=\"å°†æœ¬åœ°çš„æ–‡ä»¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­\"><a class=\"markdownIt-Anchor\" href=\"#å°†æœ¬åœ°çš„æ–‡ä»¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­\">#</a> å°†æœ¬åœ°çš„æ–‡ä»¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) git push origin master</span><br><span class=\"line\">Counting objects: 3, done.</span><br><span class=\"line\">Writing objects: 100% (3/3), 281 bytes | 281.00 KiB/s, done.</span><br><span class=\"line\">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class=\"line\">remote: Powered by GITEE.COM [GNK-5.0]</span><br><span class=\"line\">To https://gitee.com/fangjiaxiaobai/gitlearn.git</span><br><span class=\"line\"> * [new branch]      master -&gt; master</span><br><span class=\"line\">âœ  gitlearn git:(master)</span><br></pre></td></tr></table></figure>\n<h3 id=\"ä»gitä»“åº“ä¸­æ‹‰å–æ•°æ®\"><a class=\"markdownIt-Anchor\" href=\"#ä»gitä»“åº“ä¸­æ‹‰å–æ•°æ®\">#</a> ä» git ä»“åº“ä¸­æ‹‰å–æ•°æ®</h3>\n<p>å¯ä»¥ä½¿ç”¨  <code>git fetch</code>  å‘½ä»¤ã€‚ æˆ‘ä»¬ç°åœ¨é¡µé¢ä¸Šçš„ä¸€ä¸ªä»“åº“ä¸­æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶æ¥æ¼”ç¤ºä¸€ä¸‹ fetch çš„åŠŸèƒ½ã€‚</p>\n<p>åœ¨é¡µé¢å°±è¡Œç‚¹å‡»ç¼–è¾‘ï¼Œç„¶ååŠ ä¸Š  <code>è¿™é‡Œæ˜¯åœ¨è¿œç¨‹ä»“åº“ä¸­åŠ å…¥çš„å†…å®¹ã€‚</code> è¿™æ ·ä¸€å¥è¯ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) git fetch origin</span><br><span class=\"line\">remote: Enumerating objects: 5, done.</span><br><span class=\"line\">remote: Counting objects: 100% (5/5), done.</span><br><span class=\"line\">remote: Compressing objects: 100% (2/2), done.</span><br><span class=\"line\">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class=\"line\">Unpacking objects: 100% (3/3), done.</span><br><span class=\"line\">From https://gitee.com/fangjiaxiaobai/gitlearn</span><br><span class=\"line\">   5ed81fa..62be3ab  master     -&gt; origin/master</span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨  <code>git pull</code>  ä¹Ÿå¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚</p>\n<h3 id=\"æŸ¥çœ‹æŸä¸ªè¿œç¨‹ä»“åº“\"><a class=\"markdownIt-Anchor\" href=\"#æŸ¥çœ‹æŸä¸ªè¿œç¨‹ä»“åº“\">#</a> æŸ¥çœ‹æŸä¸ªè¿œç¨‹ä»“åº“</h3>\n<p><code>git remote show</code>  æ¥æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¸­çš„å†…å®¹ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) git remote show origin</span><br><span class=\"line\">* remote origin</span><br><span class=\"line\">  Fetch URL: https://gitee.com/fangjiaxiaobai/gitlearn.git</span><br><span class=\"line\">  Push  URL: https://gitee.com/fangjiaxiaobai/gitlearn.git</span><br><span class=\"line\">  HEAD branch: master</span><br><span class=\"line\">  Remote branch:</span><br><span class=\"line\">    master tracked</span><br><span class=\"line\">  Local ref configured for &#x27;git push&#x27;:</span><br><span class=\"line\">    master pushes to master (local out of date)</span><br></pre></td></tr></table></figure>\n<p>å®ƒä¼šåˆ—å‡ºè¿œç¨‹ä»“åº“çš„  <code>URL</code>  ä¸è·Ÿè¸ªåˆ†æ”¯çš„ä¿¡æ¯ã€‚å› ä¸ºæˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªæ–°å»ºçš„ä»“åº“ï¼Œè¿™é‡Œæˆ‘ç²˜è´´ä¸€ä¸ªå¾ˆå¤šæ¬¡æäº¤çš„é¡¹ç›®æ¥çœ‹ä¸€ä¸‹ã€‚</p>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/gitRemote%E5%88%86%E6%94%AF%E7%8A%B6%E6%80%81.png\" alt=\"gitRemoteåˆ†æ”¯çŠ¶æ€\"></p>\n<p>è¿™ä¸ªå‘½ä»¤åˆ—å‡ºäº†å½“ä½ åœ¨ç‰¹å®šçš„åˆ†æ”¯ä¸Šæ‰§è¡Œ  <code>git push</code>  ä¼šè‡ªåŠ¨åœ°æ¨é€åˆ°å“ªä¸€ä¸ªè¿œç¨‹åˆ†æ”¯ã€‚ å®ƒä¹ŸåŒæ ·åœ°åˆ—å‡ºäº†å“ªäº›è¿œç¨‹åˆ†æ”¯ä¸åœ¨ä½ çš„æœ¬åœ°ï¼Œå“ªäº›è¿œç¨‹åˆ†æ”¯å·²ç»ä»æœåŠ¡å™¨ä¸Šç§»é™¤äº†ï¼Œ è¿˜æœ‰å½“ä½ æ‰§è¡Œ  <code>git pull</code>  æ—¶å“ªäº›æœ¬åœ°åˆ†æ”¯å¯ä»¥ä¸å®ƒè·Ÿè¸ªçš„è¿œç¨‹åˆ†æ”¯è‡ªåŠ¨åˆå¹¶ã€‚</p>\n<h4 id=\"é‡å‘½åè¿œç¨‹ä»“åº“\"><a class=\"markdownIt-Anchor\" href=\"#é‡å‘½åè¿œç¨‹ä»“åº“\">#</a> é‡å‘½åè¿œç¨‹ä»“åº“</h4>\n<p>ä½¿ç”¨  <code>git remote renam</code> e å‘½ä»¤å¯ä»¥æ¥é‡å‘½åä»“åº“ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) git remote rename origin giteeOrigin</span><br><span class=\"line\">âœ  gitlearn git:(master) git remote -v</span><br><span class=\"line\">giteeOrigin\thttps://gitee.com/fangjiaxiaobai/gitlearn.git (fetch)</span><br><span class=\"line\">giteeOrigin\thttps://gitee.com/fangjiaxiaobai/gitlearn.git (push)</span><br><span class=\"line\">origin2\thttp://git.baijiahulian.com/wangxiyue/gitlearn.git (fetch)</span><br><span class=\"line\">origin2\thttp://git.baijiahulian.com/wangxiyue/gitlearn.git (push)</span><br></pre></td></tr></table></figure>\n<h4 id=\"åˆ é™¤è¿œç¨‹åˆ†æ”¯\"><a class=\"markdownIt-Anchor\" href=\"#åˆ é™¤è¿œç¨‹åˆ†æ”¯\">#</a> åˆ é™¤è¿œç¨‹åˆ†æ”¯</h4>\n<p>ä½¿ç”¨å‘½ä»¤  <code>git remote remove</code>  å‘½ä»¤å¯ä»¥åˆ é™¤è¿œç¨‹ä»“åº“ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) git remote remove giteeOrigin</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git remote -v</span><br><span class=\"line\">origin2\thttp://git.baijiahulian.com/wangxiyue/gitlearn.git (fetch)</span><br><span class=\"line\">origin2\thttp://git.baijiahulian.com/wangxiyue/gitlearn.git (push)</span><br></pre></td></tr></table></figure>\n<p>ä¸€æ—¦ä½ ä½¿ç”¨è¿™ç§æ–¹å¼åˆ é™¤äº†ä¸€ä¸ªè¿œç¨‹ä»“åº“ï¼Œé‚£ä¹ˆæ‰€æœ‰å’Œè¿™ä¸ªè¿œç¨‹ä»“åº“ç›¸å…³çš„è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ä»¥åŠé…ç½®ä¿¡æ¯ä¹Ÿä¼šä¸€èµ·è¢«åˆ é™¤ã€‚</p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/20-git%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/20-git%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B/",
            "title": "gitå¼€å‘æ¨¡å‹ - github-flow",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h3 id=\"github-flow\"><a class=\"markdownIt-Anchor\" href=\"#github-flow\">#</a>  <code>github flow</code></h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ndWlkZXMuZ2l0aHViLmNvbS9pbnRyb2R1Y3Rpb24vZmxvdy8=\">å‚è€ƒåœ°å€</span></p>\n<p><code>GitHub flow</code>  æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ï¼ŒåŸºäºåˆ†æ”¯çš„å·¥ä½œæµï¼Œå®ƒæ”¯æŒå®šæœŸè¿›è¡Œéƒ¨ç½²çš„å›¢é˜Ÿå’Œé¡¹ç›®ã€‚</p>\n<p><code>gitHub flow</code>  ä¸»è¦åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p>\n<h4 id=\"1åˆ›å»ºåˆ†æ”¯\"><a class=\"markdownIt-Anchor\" href=\"#1åˆ›å»ºåˆ†æ”¯\">#</a> 1. åˆ›å»ºåˆ†æ”¯</h4>\n<p><img data-src=\"./images/github-flow6.png\" alt=\"github-flow6.png\"></p>\n<p>åœ¨ä½ å‡†å¤‡è¿›è¡Œå¼€å‘çš„æ—¶å€™ï¼Œæˆ–è€…çªç„¶æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œæƒ³è¦é©¬ä¸Šå»å®ç°çš„æ—¶å€™ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªåˆ†æ”¯ã€‚</p>\n<p>åˆ†æ”¯æ˜¯ <code>Git</code>  ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ•´ä¸ª <code>GitHub</code>  æµç¨‹éƒ½ä»¥æ­¤ä¸ºåŸºç¡€ã€‚åªæœ‰ä¸€ä¸ªè§„åˆ™ï¼š <code>master</code>  åˆ†æ”¯ä¸­çš„ä»»ä½•å†…å®¹å§‹ç»ˆéƒ½æ˜¯å¯éƒ¨ç½²çš„ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†åŠŸèƒ½æˆ–ä¿®è®¢æ—¶ï¼Œè¦åœ¨ä¸»åˆ†æ”¯ä¹‹å¤–åˆ›å»ºæ–°åˆ†æ”¯éå¸¸é‡è¦ã€‚æ‚¨çš„åˆ†æ”¯åç§°åº”å…·æœ‰æè¿°æ€§ï¼ˆä¾‹å¦‚ï¼Œé‡æ„èº«ä»½éªŒè¯ï¼Œç”¨æˆ·å†…å®¹ç¼“å­˜å¯†é’¥ï¼Œ <code>make-retina</code>  å¤´åƒï¼‰ï¼Œä»¥ä¾¿å…¶ä»–äººå¯ä»¥çœ‹åˆ°æ­£åœ¨å¤„ç†çš„å†…å®¹ã€‚</p>\n<h4 id=\"2-æ·»åŠ æäº¤\"><a class=\"markdownIt-Anchor\" href=\"#2-æ·»åŠ æäº¤\">#</a> 2. æ·»åŠ æäº¤</h4>\n<p><img data-src=\"./images/github-flow6.png\" alt=\"github-flow6.png\"></p>\n<p>åˆ›å»ºåˆ†æ”¯åï¼Œå°±è¯¥å¼€å§‹è¿›è¡Œæ›´æ”¹äº†ã€‚æ¯å½“æ·»åŠ ï¼Œç¼–è¾‘æˆ–åˆ é™¤æ–‡ä»¶æ—¶ï¼Œæ‚¨éƒ½åœ¨è¿›è¡Œæäº¤ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°åˆ†æ”¯ä¸­ã€‚æ·»åŠ æäº¤çš„è¿‡ç¨‹ä¼šä½¿ git è·Ÿè¸ªæ‚¨åœ¨åŠŸèƒ½åˆ†æ”¯ä¸Šå·¥ä½œçš„è¿›åº¦ã€‚æäº¤è¿˜ä¼šä¸ºæ‚¨çš„å·¥ä½œåˆ›å»ºé€æ˜çš„å†å²è®°å½•ï¼Œå…¶ä»–äººå¯ä»¥å‚è€ƒè¯¥å†å²è®°å½•æ¥äº†è§£æ‚¨çš„å·¥ä½œä»¥åŠåŸå› ã€‚æ¯ä¸ªæäº¤éƒ½æœ‰ä¸€ä¸ªå…³è”çš„æäº¤æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯æ˜¯è¯´æ˜ä¸ºä»€ä¹ˆè¿›è¡Œç‰¹å®šæ›´æ”¹çš„è¯´æ˜ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡æäº¤éƒ½è¢«è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„å˜æ›´å•å…ƒã€‚å¦‚æœå‘ç°é”™è¯¯æˆ–å†³å®šæœå¦ä¸€ä¸ªæ–¹å‘å‰è¿›ï¼Œåˆ™å¯ä»¥å›æ»šæ›´æ”¹ã€‚</p>\n<h4 id=\"3æ‰“å¼€æ‹‰å–è¯·æ±‚\"><a class=\"markdownIt-Anchor\" href=\"#3æ‰“å¼€æ‹‰å–è¯·æ±‚\">#</a> 3. æ‰“å¼€æ‹‰å–è¯·æ±‚</h4>\n<p><img data-src=\"./images/github-flow6.png\" alt=\"github-flow6.png\"></p>\n<p>å°†æˆ‘ä»¬æœ¬åœ°å¼€å‘çš„ä»£ç  <code>commit</code>  äº†ä¹‹åï¼Œåœ¨ <code>push</code>  è¿œç¨‹ä»“åº“ä¹‹å‰ï¼Œæˆ‘ä»¬è¦ å‘èµ·ä¸€æ¬¡  <code>pull request</code> . è¿™æœ€ç›´æ¥çš„æ•ˆæœå°±æ˜¯å¦‚æœå­˜åœ¨å†²çªï¼Œæˆ‘ä»¬å°±å¯ä»¥ç°åœ¨æœ¬åœ°å®Œæˆå†²çªçš„å¤„ç†ã€‚å…¶æ¬¡ï¼Œé€šè¿‡ <code>pull request</code>  æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å›¢é˜Ÿä¸­å…¶ä»–æˆå‘˜çš„å·¥ä½œå†…å®¹ï¼Œè·å–è¯¥é¡¹ç›®ä¸­æœ€æ–°çš„ä»£ç ã€‚</p>\n<h4 id=\"4è®¨è®ºå¹¶æ£€æŸ¥æ‚¨çš„ä»£ç \"><a class=\"markdownIt-Anchor\" href=\"#4è®¨è®ºå¹¶æ£€æŸ¥æ‚¨çš„ä»£ç \">#</a> 4. è®¨è®ºå¹¶æ£€æŸ¥æ‚¨çš„ä»£ç </h4>\n<p><img data-src=\"./images/github-flow6.png\" alt=\"github-flow6.png\"></p>\n<p>æ‰“å¼€ â€œæ‹‰å–è¯·æ±‚â€ åï¼Œå®¡é˜…æ‚¨æ‰€åšæ›´æ”¹çš„äººå‘˜æˆ–å›¢é˜Ÿå¯èƒ½ä¼šæœ‰ç–‘é—®æˆ–æ„è§ã€‚ä¹Ÿè®¸ç¼–ç é£æ ¼ä¸é¡¹ç›®å‡†åˆ™ä¸åŒ¹é…ï¼Œæ›´æ”¹ç¼ºå°‘å•å…ƒæµ‹è¯•ï¼Œæˆ–è€…ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆä¸é”™ï¼Œå¹¶ä¸”é“å…·äº•äº•æœ‰æ¡ã€‚æå–è¯·æ±‚æ—¨åœ¨é¼“åŠ±å’Œæ•è·è¿™ç§ç±»å‹çš„å¯¹è¯ã€‚æ‚¨è¿˜å¯ä»¥æ ¹æ®æœ‰å…³æäº¤çš„è®¨è®ºå’Œåé¦ˆç»§ç»­æ¨é€åˆ°åˆ†æ”¯æœºæ„ã€‚å¦‚æœæœ‰äººè¯„è®ºæ‚¨å¿˜è®°åšæŸäº‹ï¼Œæˆ–è€…ä»£ç ä¸­æœ‰é”™è¯¯ï¼Œåˆ™å¯ä»¥åœ¨åˆ†æ”¯æœºæ„ä¸­å¯¹å…¶è¿›è¡Œä¿®å¤ï¼Œç„¶åè¿›è¡Œæ›´æ”¹ã€‚ <code>GitHub</code>  å°†åœ¨ç»Ÿä¸€çš„ â€œæ‹‰å–è¯·æ±‚â€ è§†å›¾ä¸­æ˜¾ç¤ºæ‚¨çš„æ–°æäº¤ä»¥åŠæ‚¨å¯èƒ½æ”¶åˆ°çš„ä»»ä½•å…¶ä»–åé¦ˆã€‚</p>\n<h4 id=\"éƒ¨ç½²\"><a class=\"markdownIt-Anchor\" href=\"#éƒ¨ç½²\">#</a> éƒ¨ç½²</h4>\n<p><img data-src=\"./images/github-flow5.png\" alt=\"github-flow5.png\"></p>\n<p>å€ŸåŠ© <code>GitHub</code> ï¼Œæ‚¨å¯ä»¥ä»åˆ†æ”¯æœºæ„è¿›è¡Œéƒ¨ç½²ï¼Œä»¥åœ¨æ­£å¼åˆå¹¶ä¹‹å‰è¿›è¡Œç”Ÿäº§ä¸­çš„æœ€ç»ˆæµ‹è¯•ã€‚å®¡æ ¸æ‹‰å–è¯·æ±‚å¹¶ä¸”åˆ†æ”¯æœºæ„é€šè¿‡æµ‹è¯•åï¼Œæ‚¨å¯ä»¥éƒ¨ç½²æ›´æ”¹ä»¥åœ¨ç”Ÿäº§ä¸­è¿›è¡ŒéªŒè¯ã€‚å¦‚æœæ‚¨çš„åˆ†æ”¯æœºæ„å¼•èµ·é—®é¢˜ï¼Œåˆ™å¯ä»¥é€šè¿‡å°†ç°æœ‰çš„ä¸»æœåŠ¡å™¨éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­æ¥å›æ»šå®ƒã€‚</p>\n<h4 id=\"åˆå¹¶åˆ°masteråˆ†æ”¯\"><a class=\"markdownIt-Anchor\" href=\"#åˆå¹¶åˆ°masteråˆ†æ”¯\">#</a> åˆå¹¶åˆ° master åˆ†æ”¯</h4>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/github-flow6.png\" alt=\"github-flow6.png\"></p>\n<p>ç°åœ¨æ‚¨çš„æ›´æ”¹å·²åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¾—åˆ°éªŒè¯ï¼Œæ˜¯æ—¶å€™å°†ä»£ç åˆå¹¶åˆ° <code>master</code>  åˆ†æ”¯ä¸­äº†ã€‚åˆå¹¶åï¼Œæ‹‰å–è¯·æ±‚ä¼šä¿ç•™ä»£ç å†å²æ›´æ”¹çš„è®°å½•ã€‚å› ä¸ºå®ƒä»¬æ˜¯å¯æœç´¢çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä½¿ä»»ä½•äººéƒ½èƒ½åŠæ—¶è¿”å›ï¼Œä»¥äº†è§£åšå‡ºå†³å®šçš„åŸå› å’Œæ–¹å¼ã€‚</p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/14-git%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/14-git%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4/",
            "title": "å…¶ä»–å‘½ä»¤",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usage: git [--version] [--help] [-C &lt;path&gt;] [-c name=value]</span><br><span class=\"line\">           [--exec-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]</span><br><span class=\"line\">           [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]</span><br><span class=\"line\">           [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]</span><br><span class=\"line\">           &lt;command&gt; [&lt;args&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\">available git commands in &#x27;/usr/local/git/libexec/git-core&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">  add                       diff-index                merge-octopus             reset</span><br><span class=\"line\">  add--interactive          diff-tree                 merge-one-file            rev-list</span><br><span class=\"line\">  am                        difftool                  merge-ours                rev-parse</span><br><span class=\"line\">  annotate                  difftool--helper          merge-recursive           revert</span><br><span class=\"line\">  apply                     fast-export               merge-resolve             rm</span><br><span class=\"line\">  archimport                fast-import               merge-subtree             send-email</span><br><span class=\"line\">  archive                   fetch                     merge-tree                send-pack</span><br><span class=\"line\">  bisect                    fetch-pack                mergetool                 sh-i18n--envsubst</span><br><span class=\"line\">  bisect--helper            filter-branch             mktag                     shell</span><br><span class=\"line\">  blame                     fmt-merge-msg             mktree                    shortlog</span><br><span class=\"line\">  branch                    for-each-ref              mv                        show</span><br><span class=\"line\">  bundle                    format-patch              name-rev                  show-branch</span><br><span class=\"line\">  cat-file                  fsck                      notes                     show-index</span><br><span class=\"line\">  check-attr                fsck-objects              p4                        show-ref</span><br><span class=\"line\">  check-ignore              gc                        pack-objects              stage</span><br><span class=\"line\">  check-mailmap             get-tar-commit-id         pack-redundant            stash</span><br><span class=\"line\">  check-ref-format          grep                      pack-refs                 status</span><br><span class=\"line\">  checkout                  gui                       patch-id                  stripspace</span><br><span class=\"line\">  checkout-index            gui--askpass              prune                     submodule</span><br><span class=\"line\">  cherry                    hash-object               prune-packed              submodule--helper</span><br><span class=\"line\">  cherry-pick               help                      pull                      subtree</span><br><span class=\"line\">  citool                    http-backend              push                      svn</span><br><span class=\"line\">  clean                     http-fetch                quiltimport               symbolic-ref</span><br><span class=\"line\">  clone                     http-push                 read-tree                 tag</span><br><span class=\"line\">  column                    imap-send                 rebase                    unpack-file</span><br><span class=\"line\">  commit                    index-pack                rebase--helper            unpack-objects</span><br><span class=\"line\">  commit-tree               init                      receive-pack              update-index</span><br><span class=\"line\">  config                    init-db                   reflog                    update-ref</span><br><span class=\"line\">  count-objects             instaweb                  remote                    update-server-info</span><br><span class=\"line\">  credential                interpret-trailers        remote-ext                upload-archive</span><br><span class=\"line\">  credential-cache          log                       remote-fd                 upload-pack</span><br><span class=\"line\">  credential-cache--daemon  ls-files                  remote-ftp                var</span><br><span class=\"line\">  credential-store          ls-remote                 remote-ftps               verify-commit</span><br><span class=\"line\">  cvsexportcommit           ls-tree                   remote-http               verify-pack</span><br><span class=\"line\">  cvsimport                 mailinfo                  remote-https              verify-tag</span><br><span class=\"line\">  cvsserver                 mailsplit                 remote-testsvn            web--browse</span><br><span class=\"line\">  daemon                    merge                     repack                    whatchanged</span><br><span class=\"line\">  describe                  merge-base                replace                   worktree</span><br><span class=\"line\">  diff                      merge-file                request-pull              write-tree</span><br><span class=\"line\">  diff-files                merge-index               rerere</span><br><span class=\"line\"></span><br><span class=\"line\">git commands available from elsewhere on your $PATH</span><br><span class=\"line\"></span><br><span class=\"line\">  credential-osxkeychain</span><br><span class=\"line\"></span><br><span class=\"line\">&#x27;git help -a&#x27; and &#x27;git help -g&#x27; list available subcommands and some</span><br><span class=\"line\">concept guides. See &#x27;git help &lt;command&gt;&#x27; or &#x27;git help &lt;concept&gt;&#x27;</span><br><span class=\"line\">to read about a specific subcommand or concept.</span><br></pre></td></tr></table></figure>\n<p>é™¤å»ä¸Šç¯‡æ–‡ç« ä¸­ä»‹ç»çš„å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤å°±ç›¸å¯¹é«˜ç«¯äº†ï½ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŒ‘ä¸€äº›å¯ä»¥ç”¨å¾—åˆ°æ¥åˆ†äº«ã€‚</p>\n<h3 id=\"å‘½ä»¤è§£é‡Š\"><a class=\"markdownIt-Anchor\" href=\"#å‘½ä»¤è§£é‡Š\">#</a> å‘½ä»¤è§£é‡Š</h3>\n<ul>\n<li>git hash-object</li>\n</ul>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/13-git%E5%91%BD%E4%BB%A4/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/13-git%E5%91%BD%E4%BB%A4/",
            "title": "gitå‘½ä»¤",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<p>æœ¬ç« å¼€å§‹å­¦ä¹ ä¸€äº›åœ¨å¼€å‘ä¸­å¸¸ç”¨çš„ git å‘½ä»¤</p>\n<p>å…ˆçœ‹ä¸€ä¸‹ git æœ‰å¤šå°‘ä¸ªå‘½ä»¤ã€‚</p>\n<p>ç›´æ¥åœ¨ å‘½ä»¤è¡Œä¸­è¾“å…¥ git å³å¯ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  / git</span><br><span class=\"line\">usage: git [--version] [--help] [-C &lt;path&gt;] [-c name=value]</span><br><span class=\"line\">           [--exec-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]</span><br><span class=\"line\">           [-p | --paginate | --no-pager] [--no-replace-objects] [--bare]</span><br><span class=\"line\">           [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]</span><br><span class=\"line\">           &lt;command&gt; [&lt;args&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\">These are common Git commands used in various situations:</span><br><span class=\"line\"></span><br><span class=\"line\">start a working area (see also: git help tutorial)</span><br><span class=\"line\">   clone      Clone a repository into a new directory</span><br><span class=\"line\">   init       Create an empty Git repository or reinitialize an existing one</span><br><span class=\"line\"></span><br><span class=\"line\">work on the current change (see also: git help everyday)</span><br><span class=\"line\">   add        Add file contents to the index</span><br><span class=\"line\">   mv         Move or rename a file, a directory, or a symlink</span><br><span class=\"line\">   reset      Reset current HEAD to the specified state</span><br><span class=\"line\">   rm         Remove files from the working tree and from the index</span><br><span class=\"line\"></span><br><span class=\"line\">examine the history and state (see also: git help revisions)</span><br><span class=\"line\">   bisect     Use binary search to find the commit that introduced a bug</span><br><span class=\"line\">   grep       Print lines matching a pattern</span><br><span class=\"line\">   log        Show commit logs</span><br><span class=\"line\">   show       Show various types of objects</span><br><span class=\"line\">   status     Show the working tree status</span><br><span class=\"line\"></span><br><span class=\"line\">grow, mark and tweak your common history</span><br><span class=\"line\">   branch     List, create, or delete branches</span><br><span class=\"line\">   checkout   Switch branches or restore working tree files</span><br><span class=\"line\">   commit     Record changes to the repository</span><br><span class=\"line\">   diff       Show changes between commits, commit and working tree, etc</span><br><span class=\"line\">   merge      Join two or more development histories together</span><br><span class=\"line\">   rebase     Reapply commits on top of another base tip</span><br><span class=\"line\">   tag        Create, list, delete or verify a tag object signed with GPG</span><br><span class=\"line\"></span><br><span class=\"line\">collaborate (see also: git help workflows)</span><br><span class=\"line\">   fetch      Download objects and refs from another repository</span><br><span class=\"line\">   pull       Fetch from and integrate with another repository or a local branch</span><br><span class=\"line\">   push       Update remote refs along with associated objects</span><br><span class=\"line\"></span><br><span class=\"line\">&#x27;git help -a&#x27; and &#x27;git help -g&#x27; list available subcommands and some</span><br><span class=\"line\">concept guides. See &#x27;git help &lt;command&gt;&#x27; or &#x27;git help &lt;concept&gt;&#x27;</span><br><span class=\"line\">to read about a specific subcommand or concept.</span><br></pre></td></tr></table></figure>\n<p>å°æœ‹å‹ï¼Œä½ ä»¥ä¸º git å°±è¿™å‡ ä¸ªå‘½ä»¤å—ï¼Ÿ</p>\n<p>å¤ªå•çº¯ï¼ï¼ï¼<br>\nè¿˜æœ‰å¾ˆå¤šå‘½ä»¤ï¼ï¼ ä¸‹ç¯‡åˆ†äº«ï¼ˆä¹Ÿåˆ†äº«ä¸å®Œï¼‰</p>\n<h3 id=\"git-clone\"><a class=\"markdownIt-Anchor\" href=\"#git-clone\">#</a> git clone</h3>\n<h3 id=\"git-init\"><a class=\"markdownIt-Anchor\" href=\"#git-init\">#</a> git init</h3>\n<h3 id=\"git-add\"><a class=\"markdownIt-Anchor\" href=\"#git-add\">#</a> git add</h3>\n<h3 id=\"git-commit\"><a class=\"markdownIt-Anchor\" href=\"#git-commit\">#</a> git commit</h3>\n<h3 id=\"git-checkout\"><a class=\"markdownIt-Anchor\" href=\"#git-checkout\">#</a> git checkout</h3>\n<h3 id=\"git-log\"><a class=\"markdownIt-Anchor\" href=\"#git-log\">#</a> git log</h3>\n<h3 id=\"git-tag\"><a class=\"markdownIt-Anchor\" href=\"#git-tag\">#</a> git tag</h3>\n<h3 id=\"git-diff\"><a class=\"markdownIt-Anchor\" href=\"#git-diff\">#</a> git diff</h3>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/git%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/git_update-index/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/git%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/git_update-index/",
            "title": "gitå‘½ä»¤è¯¦è§£ä¹‹ git update-index",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h3 id=\"å®˜æ–¹\"><a class=\"markdownIt-Anchor\" href=\"#å®˜æ–¹\">#</a> å®˜æ–¹</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usage: git update-index [&lt;options&gt;] [--] [&lt;file&gt;...]</span><br><span class=\"line\"></span><br><span class=\"line\">    -q                    continue refresh even when index needs update</span><br><span class=\"line\">    --ignore-submodules   refresh: ignore submodules</span><br><span class=\"line\">    --add                 do not ignore new files</span><br><span class=\"line\">    --replace             let files replace directories and vice-versa</span><br><span class=\"line\">    --remove              notice files missing from worktree</span><br><span class=\"line\">    --unmerged            refresh even if index contains unmerged entries</span><br><span class=\"line\">    --refresh             refresh stat information</span><br><span class=\"line\">    --really-refresh      like --refresh, but ignore assume-unchanged setting</span><br><span class=\"line\">    --cacheinfo &lt;mode&gt;,&lt;object&gt;,&lt;path&gt;</span><br><span class=\"line\">                          add the specified entry to the index</span><br><span class=\"line\">    --chmod (+/-)x        override the executable bit of the listed files</span><br><span class=\"line\">    --assume-unchanged    mark files as &quot;not changing&quot;</span><br><span class=\"line\">    --no-assume-unchanged</span><br><span class=\"line\">                          clear assumed-unchanged bit</span><br><span class=\"line\">    --skip-worktree       mark files as &quot;index-only&quot;</span><br><span class=\"line\">    --no-skip-worktree    clear skip-worktree bit</span><br><span class=\"line\">    --info-only           add to index only; do not add content to object database</span><br><span class=\"line\">    --force-remove        remove named paths even if present in worktree</span><br><span class=\"line\">    -z                    with --stdin: input lines are terminated by null bytes</span><br><span class=\"line\">    --stdin               read list of paths to be updated from standard input</span><br><span class=\"line\">    --index-info          add entries from standard input to the index</span><br><span class=\"line\">    --unresolve           repopulate stages #2 and #3 for the listed paths</span><br><span class=\"line\">    -g, --again           only update entries that differ from HEAD</span><br><span class=\"line\">    --ignore-missing      ignore files missing from worktree</span><br><span class=\"line\">    --verbose             report actions to standard output</span><br><span class=\"line\">    --clear-resolve-undo  (for porcelains) forget saved unresolved conflicts</span><br><span class=\"line\">    --index-version &lt;n&gt;   write index in this format</span><br><span class=\"line\">    --split-index         enable or disable split index</span><br><span class=\"line\">    --untracked-cache     enable/disable untracked cache</span><br><span class=\"line\">    --test-untracked-cache</span><br><span class=\"line\">                          test if the filesystem supports untracked cache</span><br><span class=\"line\">    --force-untracked-cache</span><br><span class=\"line\">                          enable untracked cache without testing the filesystem</span><br></pre></td></tr></table></figure>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/git%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/README/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/git%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/README/",
            "title": "gitå‘½ä»¤è¯¦è§£",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h2 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> </h2>\n<h3 id=\"ç›®å½•\"><a class=\"markdownIt-Anchor\" href=\"#ç›®å½•\">#</a> ç›®å½•</h3>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" disabled=\"true\"><label for=\"cbx_0\"> <a href=\"./git_update-index.md\">git update-index</a></label></li>\n</ul>\n<h3 id=\"å°æŠ€å·§\"><a class=\"markdownIt-Anchor\" href=\"#å°æŠ€å·§\">#</a> å°æŠ€å·§</h3>\n<ul>\n<li>æŸä¸ªæ–‡ä»¶éœ€è¦è¢«ç®¡ç†ï¼Œä½†æ˜¯è¦å¿½ç•¥å…¶ä¿®æ”¹çš„å†…å®¹ã€‚ <a href=\"./git_update-index.md\">git update-index</a><br>\ngit update-index --no-skip-worktree åŒæ ·å¯ä»¥ã€‚<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL3EvMTAxMDAwMDAwMDQzMDQyNg==\">å‚è€ƒæ–‡æ¡£</span>   <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50ZmF1bHQuY29tL3EvMTAxMDAwMDAwMDM1ODU4OA==\">å‚è€ƒæ–‡æ¡£ 2</span></li>\n</ul>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/git%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/git_ls-files/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/git%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/git_ls-files/",
            "title": "gitå‘½ä»¤è¯¦è§£ä¹‹ git ls-files",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">usage: git ls-files [&lt;options&gt;] [&lt;file&gt;...]</span><br><span class=\"line\"></span><br><span class=\"line\">    -z                    paths are separated with NUL character</span><br><span class=\"line\">    -t                    identify the file status with tags</span><br><span class=\"line\">    -v                    use lowercase letters for &#x27;assume unchanged&#x27; files</span><br><span class=\"line\">    -c, --cached          show cached files in the output (default)</span><br><span class=\"line\">    -d, --deleted         show deleted files in the output</span><br><span class=\"line\">    -m, --modified        show modified files in the output</span><br><span class=\"line\">    -o, --others          show other files in the output</span><br><span class=\"line\">    -i, --ignored         show ignored files in the output</span><br><span class=\"line\">    -s, --stage           show staged contents&#x27; object name in the output</span><br><span class=\"line\">    -k, --killed          show files on the filesystem that need to be removed</span><br><span class=\"line\">    --directory           show &#x27;other&#x27; directories&#x27; names only</span><br><span class=\"line\">    --eol                 show line endings of files</span><br><span class=\"line\">    --empty-directory     don&#x27;t show empty directories</span><br><span class=\"line\">    -u, --unmerged        show unmerged files in the output</span><br><span class=\"line\">    --resolve-undo        show resolve-undo information</span><br><span class=\"line\">    -x, --exclude &lt;pattern&gt;</span><br><span class=\"line\">                          skip files matching pattern</span><br><span class=\"line\">    -X, --exclude-from &lt;file&gt;</span><br><span class=\"line\">                          exclude patterns are read from &lt;file&gt;</span><br><span class=\"line\">    --exclude-per-directory &lt;file&gt;</span><br><span class=\"line\">                          read additional per-directory exclude patterns in &lt;file&gt;</span><br><span class=\"line\">    --exclude-standard    add the standard git exclusions</span><br><span class=\"line\">    --full-name           make the output relative to the project top directory</span><br><span class=\"line\">    --recurse-submodules  recurse through submodules</span><br><span class=\"line\">    --error-unmatch       if any &lt;file&gt; is not in the index, treat this as an error</span><br><span class=\"line\">    --with-tree &lt;tree-ish&gt;</span><br><span class=\"line\">                          pretend that paths removed since &lt;tree-ish&gt; are still present</span><br><span class=\"line\">    --abbrev[=&lt;n&gt;]        use &lt;n&gt; digits to display SHA-1s</span><br><span class=\"line\">    --debug               show debugging data</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/03-git%E5%91%BD%E4%BB%A4%E4%B9%8B%E4%BB%8E%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E5%BC%80%E5%A7%8B/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/18/git%E7%B3%BB%E5%88%97/03-git%E5%91%BD%E4%BB%A4%E4%B9%8B%E4%BB%8E%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E5%BC%80%E5%A7%8B/",
            "title": "ä»åˆ›å»ºä»“åº“å¼€å§‹",
            "date_published": "2021-07-18T06:49:55.000Z",
            "content_html": "<h2 id=\"ä»åˆ›å»ºä»“åº“å¼€å§‹\"><a class=\"markdownIt-Anchor\" href=\"#ä»åˆ›å»ºä»“åº“å¼€å§‹\">#</a> ä»åˆ›å»ºä»“åº“å¼€å§‹</h2>\n<p>è¿™ç¯‡æ–‡ç« åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬åœ¨ä½¿ç”¨ git è¿›è¡Œç‰ˆæœ¬ç®¡ç†æ—¶å€™çš„å¸¸ç”¨çš„æ“ä½œï¼æˆ‘ä»¬ä»åˆ›å»ºä»“åº“å¼€å§‹ï½</p>\n<p>è·å–ä»£ç ä»“åº“çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä»é›¶å¼€å§‹åˆå§‹åŒ–ä¸€ä¸ª git ä»“åº“ï¼Œå¦ä¸€ç§æ˜¯ clone ä»–äººçš„ä»“åº“ã€‚</p>\n<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œç„¶ååˆå§‹åŒ–ä¸€ä¸ªä»“åº“ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/ cd</span><br><span class=\"line\"># åˆ›å»ºç©ºç›®å½•</span><br><span class=\"line\">~ mkdir gitlearn</span><br><span class=\"line\">~ cd gitlearn</span><br><span class=\"line\"># åˆå§‹åŒ–ä»“åº“</span><br><span class=\"line\">~ git init .</span><br></pre></td></tr></table></figure>\n<p>å°±è¿™æ ·æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªäº†<b>æœ¬åœ°ä»“åº“</b>, å›¢é˜Ÿåˆä½œçš„æ—¶å€™è¿™æ ·è‚¯å®šä¸è¡Œçš„ï¼Œä¸è¡Œï¼Œåé¢æˆ‘ä»¬åä»‹ç»åˆ°ã€‚<br>\næˆ–è€… æˆ‘ä»¬è¿˜å¯ä»¥å…‹éš†ä¸€ä¸ª<b>è¿œç¨‹ä»“åº“</b></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https://gitee.com/fangjiaxiaobai/gitlearn.git</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ–°å»ºçš„ä»“åº“ç›®å½•ä¸‹éƒ½æœ‰ä»€ä¹ˆæ–‡ä»¶ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) l</span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x   3 bjhl  wheel    96B  7 13 18:23 .</span><br><span class=\"line\">drwxr-xr-x   3 bjhl  wheel    96B  7 13 18:23 ..</span><br><span class=\"line\">drwxr-xr-x  10 bjhl  wheel   320B  7 13 18:25 .git</span><br><span class=\"line\">âœ  gitlearn git:(master) cd .git</span><br><span class=\"line\">âœ  .git git:(master) l</span><br><span class=\"line\">total 24</span><br><span class=\"line\">drwxr-xr-x  10 bjhl  wheel   320B  7 13 18:30 .</span><br><span class=\"line\">drwxr-xr-x   3 bjhl  wheel    96B  7 13 18:23 ..</span><br><span class=\"line\">-rw-r--r--   1 bjhl  wheel    16B  7 13 20:38 COMMIT_EDITMSG # å­˜å‚¨æœ€æ–°ä¸€æ¬¡çš„commitä¿¡æ¯</span><br><span class=\"line\">-rw-r--r--   1 bjhl  wheel    23B  7 13 18:23 HEAD ## å½“å‰è¢«æ£€å‡ºçš„åˆ†æ”¯</span><br><span class=\"line\">drwxr-xr-x   2 bjhl  wheel    64B  7 13 18:23 branches # æ‰€æœ‰åˆ†æ”¯</span><br><span class=\"line\">-rw-r--r--   1 bjhl  wheel   315B  7 13 18:23 config # åŒ…å«é¡¹ç›®ç‰¹æœ‰çš„é…ç½®é€‰é¡¹</span><br><span class=\"line\">-rw-r--r--   1 bjhl  wheel    73B  7 13 18:23 description #Git webé¡µé¢ç¨‹åºä½¿ç”¨</span><br><span class=\"line\">drwxr-xr-x  12 bjhl  wheel   384B  7 13 18:23 hooks # åŒ…å«å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯çš„é’©å­è„šæœ¬</span><br><span class=\"line\">drwxr-xr-x   3 bjhl  wheel    96B  7 13 18:23 info # åŒ…å«ä¸€ä¸ªå…¨å±€æ€§æ’é™¤æ–‡ä»¶ï¼Œç”¨ä»¥é˜²æ­¢é‚£äº›ä¸å¸Œæœ›è¢«çº³å…¥ç‰ˆæœ¬ç®¡ç†çš„æ–‡ä»¶ï¼Œ.gitignoreæ–‡ä»¶ä¸­è®°å½•çš„</span><br><span class=\"line\">-rw-r--r--   1 bjhl  wheel   126B  7 13 20:39 index ## ä¿å­˜æš‚å­˜åŒºä¿¡æ¯(è¿›è¡Œstashæ“ä½œä¹‹åå‡ºç°çš„)</span><br><span class=\"line\">drwxr-xr-x   4 bjhl  wheel   128B  7 13 18:23 objects ## å­˜å‚¨æ‰€æœ‰æ•°æ®çš„å†…å®¹</span><br><span class=\"line\">drwxr-xr-x   4 bjhl  wheel   128B  7 13 18:23 refs ## å­˜å‚¨æŒ‡å‘æ•°æ®ï¼ˆåˆ†æ”¯ï¼Œè¿œç¨‹ä»“åº“å’Œæ ‡ç­¾ç­‰ï¼‰çš„æäº¤å¯¹è±¡çš„æŒ‡é’ˆã€‚</span><br></pre></td></tr></table></figure>\n<p>å…¶ä¸­æœ‰å››ä¸ªæ¡ç›®éå¸¸é‡è¦ï¼Œæˆ‘ç”¨  <code>##</code>  è¿›è¡Œäº†æ ‡æ³¨ã€‚ åˆ†åˆ«æ˜¯ï¼š <code>HEAD</code>  æ–‡ä»¶ï¼Œ <code>index</code>  æ–‡ä»¶ï¼Œ <code>objects</code>  ç›®å½•ï¼Œ <code>refs</code>  ç›®å½•ã€‚</p>\n<p><b>å¦‚æœä½ æƒ³åªæ˜¯æƒ³äº†è§£ git çš„è¯ï¼Œé‚£ä¹ˆä¸‹é¢çš„å†…å®¹å°±å¯ä»¥å¿½ç•¥äº†ã€‚</b></p>\n<p>æˆ‘ä»¬æ¥æä¸€ç‚¹æœ‰è¶£çš„ä¸œè¥¿ã€‚</p>\n<h3 id=\"objectsç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯ä»€ä¹ˆä¸œè¥¿-gitå¯¹è±¡\"><a class=\"markdownIt-Anchor\" href=\"#objectsç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯ä»€ä¹ˆä¸œè¥¿-gitå¯¹è±¡\">#</a>  <code>objects/</code>  ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿâ€“  Git å¯¹è±¡</h3>\n<p>å‰é¢è¯´è¿‡ï¼Œ <code>git</code>  æ˜¯ä¸€ä¸ªå†…å®¹å¯»å€æ–‡ä»¶ç³»ç»Ÿã€‚==&gt;  <code>git</code>  æ˜¯ä¸€ä¸ªç®€å•çš„é”®å€¼å¯¹æ•°æ®åº“ã€‚</p>\n<p>å³ï¼Œä½ å¯ä»¥å‘ <code>git</code>  ä»“åº“ä¸­æ’å…¥ä»»åŠ¡ç±»å‹çš„å†…å®¹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå”¯ä¸€çš„é”®ã€‚é€šè¿‡è¯¥é”®å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å†æ¬¡å–å›è¯¥å†…å®¹ã€‚</p>\n<p>ä¸Šé¢è¯´è¿‡ï¼Œ <code>objects</code>  ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯æ‰€æœ‰æ•°æ®çš„å†…å®¹ã€‚åœ¨ <code>git</code>  ä¸­ï¼Œæ•°æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯æˆ‘ä»¬å·¥ä½œç›®å½•çš„æ‰€æœ‰æ–‡ä»¶çš„å¿«ç…§ï¼</p>\n<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªè¿˜æ²¡æœ‰å­¦ä¹ çš„å‘½ä»¤ã€‚</p>\n<ul>\n<li><code>git add .</code> ï¼š å°†ç›®å½•ä¸­çš„æ–‡ä»¶çº³å…¥ç‰ˆæœ¬åº“è¿›è¡Œç®¡ç†èµ·æ¥ã€‚æ­¤æ—¶çš„çŠ¶æ€æ˜¯ï¼š <code>å·²æš‚å­˜(æ–°å»º)</code> ã€‚æš‚å­˜åŒºçš„ç›®å½•æ ‘ä¼šè¢«æ›´æ–°ï¼ŒåŒæ—¶å·¥ä½œåŒºä¿®æ”¹ (æ–°å¢çš„) æ–‡ä»¶å†…å®¹è¢«å†™å…¥åˆ°å¯¹è±¡åº“ä¸­çš„ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ï¼Œè€Œè¯¥å¯¹è±¡çš„ id ä¼šè¢«è®°å½•åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ç´¢å¼•ä¸­ã€‚</li>\n<li><code>git commit -m 'xxx'</code> ï¼šå°†ç›®å½•ä¸­çš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ç‰ˆæœ¬åº“ã€‚æ­¤æ—¶çš„çŠ¶æ€æ˜¯ï¼š <code>å·²æäº¤</code> ã€‚è¿™æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘å†™åˆ°ç‰ˆæœ¬åº“ä¸­ï¼Œå¯¹åº”çš„åˆ†æ”¯ä¼šè¿›è¡Œç›¸åº”çš„æ›´æ–°ã€‚</li>\n</ul>\n<p>é‚£ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹ï¼š <code>objects</code>  ç›®å½•ä¸‹å­˜å‚¨çš„æ–‡ä»¶ã€‚</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹ <code>object</code>  ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹objectsä¸‹çš„æ–‡ä»¶</span></span><br><span class=\"line\">~ l .git/objects </span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x   4 bjhl  wheel   128B  7 14 11:30 .</span><br><span class=\"line\">drwxr-xr-x  10 bjhl  wheel   320B  7 14 11:30 ..</span><br><span class=\"line\">drwxr-xr-x   2 bjhl  wheel    64B  7 14 11:30 info</span><br><span class=\"line\">drwxr-xr-x   2 bjhl  wheel    64B  7 14 11:30 pack</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š test-objects-files-01.txt</span></span><br><span class=\"line\">âœ  gitlearn git:(master) sudo touch test-objects-files-01.txt</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— l .git/objects</span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x   4 root  wheel   128B  7 14 15:10 .</span><br><span class=\"line\">drwxr-xr-x  10 root  wheel   320B  7 14 15:10 ..</span><br><span class=\"line\">drwxr-xr-x   2 root  wheel    64B  7 14 15:10 info</span><br><span class=\"line\">drwxr-xr-x   2 root  wheel    64B  7 14 15:10 pack</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä¿®æ”¹æ–‡ä»¶</span></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— sudo vim test-objects-files-01.txt</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— l .git/objects</span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x   4 root  wheel   128B  7 14 15:10 .</span><br><span class=\"line\">drwxr-xr-x  10 root  wheel   320B  7 14 15:10 ..</span><br><span class=\"line\">drwxr-xr-x   2 root  wheel    64B  7 14 15:10 info</span><br><span class=\"line\">drwxr-xr-x   2 root  wheel    64B  7 14 15:10 pack</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— l .git/objects</span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxrwxrwx   5 root  wheel   160B  7 14 15:34 .</span><br><span class=\"line\">drwxrwxrwx  11 root  wheel   352B  7 14 15:34 ..</span><br><span class=\"line\">drwxr-xr-x   3 bjhl  wheel    96B  7 14 15:34 37</span><br><span class=\"line\">drwxrwxrwx   2 root  wheel    64B  7 14 15:10 info</span><br><span class=\"line\">drwxrwxrwx   2 root  wheel    64B  7 14 15:10 pack</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/37/17929ecb3efabae427dbe3725654b3de1a114b # blobç±»å‹(æ–‡ä»¶)</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä½¿ç”¨git cat-fileæ¥çœ‹ä¸‹ä¸€ä¸‹æ–‡ä»¶çš„å†…å®¹</span></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git cat-file -p 3717929ecb3efabae427dbe3725654b3de1a114b</span><br><span class=\"line\">test - objects - files - ç¬¬ä¸€è¡Œ</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æˆ‘ä»¬è¿›è¡Œcommit</span></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test-object-files add&quot;</span><br><span class=\"line\">[master (root-commit) 1883fd5] test-object-files add</span><br><span class=\"line\"> Committer: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ..çœç•¥éƒ¨åˆ†æç¤º</span></span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"> create mode 100755 test-objects-files-01.txt</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æ¥çœ‹ä¸€ä¸‹objectsç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/18/83fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">./.git/objects/37/17929ecb3efabae427dbe3725654b3de1a114b</span><br><span class=\"line\">./.git/objects/54/500d5d74f828d1a3193fb685084b87aaf419c7</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p 54500d5d74f828d1a3193fb685084b87aaf419c7</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è¡¨ç¤ºå­˜å‚¨çš„äº‹blobæ ¼å¼çš„æ–‡ä»¶ï¼Œtest-objects-files-01.txt</span></span><br><span class=\"line\">100755 blob 3717929ecb3efabae427dbe3725654b3de1a114b\ttest-objects-files-01.txt</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p 1883fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> å­˜å‚¨çš„æ˜¯ æ ‘å¯¹è±¡(åé¢æœ‰ä»‹ç»)</span></span><br><span class=\"line\">tree 54500d5d74f828d1a3193fb685084b87aaf419c7</span><br><span class=\"line\">author bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt; 1594712728 +0800</span><br><span class=\"line\">committer bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt; 1594712728 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">test-object-files add</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>git cat-file<br>\n è¿™ä¸ªå‘½ä»¤å¯ä»¥å®ç°ä» <code>git</code>  ä»“åº“ä¸­å–å›æ•°æ®ã€‚-p å‚æ•°å¯ä»¥è‡ªåŠ¨åˆ¤æ–­å†…å®¹çš„ç±»å‹ã€‚è¿˜æœ‰ä¸€ä¸ªå†™å…¥çš„å‘½ä»¤ã€‚ <code>git hash-object</code>  . ä¸‹é¢ç®€å•æ¼”ç¤ºä¸€ä¸‹ã€‚</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) echo &#x27;test hash-object function&#x27; | git hash-object -w --stdin</span><br><span class=\"line\">11a5f11388c345846bbaa060a98d8e93a1114e99</span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p 11a5f11388c345846bbaa060a98d8e93a1114e99</span><br><span class=\"line\">test hash-object function</span><br><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/11/a5f11388c345846bbaa060a98d8e93a1114e99</span><br><span class=\"line\">./.git/objects/18/83fd5aefeb430cb25150e531e92e38f0176f0d # commit-id </span><br><span class=\"line\">./.git/objects/37/17929ecb3efabae427dbe3725654b3de1a114b # æ–‡ä»¶</span><br><span class=\"line\">./.git/objects/54/500d5d74f828d1a3193fb685084b87aaf419c7 # æ ‘å¯¹è±¡</span><br></pre></td></tr></table></figure>\n<p>ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ <code>git</code>  ä¸­å«æœ‰ï¼Œ <code>blob</code>   <code>commit-id</code> ï¼Œ <code>tree</code> ï¼Œè¿™ä¸‰ç§å¯¹è±¡ã€‚<br>\nè¿™å…¶å®å°±æ˜¯  <code>Git</code>  çš„å¯¹è±¡ï¼šæ•°æ®å¯¹è±¡ï¼Œæäº¤å¯¹è±¡ï¼Œæ ‘å¯¹è±¡ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª <code>git</code>  çš„å¯¹è±¡ - æ ‘å¯¹è±¡</p>\n<h3 id=\"æ ‘å¯¹è±¡\"><a class=\"markdownIt-Anchor\" href=\"#æ ‘å¯¹è±¡\">#</a> æ ‘å¯¹è±¡</h3>\n<p>æ ‘å¯¹è±¡èƒ½å¤Ÿè§£å†³æ–‡ä»¶åä¿å­˜çš„é—®é¢˜ï¼Œä¹Ÿå…è®¸å¤šä¸ªæ–‡ä»¶ç»„ç»‡åˆ°ä¸€èµ·ã€‚æ‰€æœ‰å†…å®¹å‡ä»¥æ ‘å¯¹è±¡å’Œæ•°æ®ç‹¬äº«çš„å½¢å¼å­˜å‚¨ï¼Œå…¶ä¸­æ ‘å¯¹è±¡å¯¹åº”äº† UNIX ä¸­çš„ç›®å½•é¡¹ï¼Œæ•°æ®å¯¹è±¡åˆ™å¤§è‡´ä¸Šå¯¹åº”äº† <code>inodes</code>  æˆ–è€…æ–‡ä»¶å†…å®¹ã€‚</p>\n<p>ä¸€ä¸ªæ ‘å¯¹è±¡åŒ…å«äº†ä¸€æ¡æˆ–å¤šæ¡æ ‘å¯¹è±¡è®°å½•ï¼Œæ¯æ¡è®°å½•å«æœ‰ä¸€ä¸ªæŒ‡å‘æ•°æ®å¯¹è±¡æˆ–è€…å­æ ‘å¯¹è±¡çš„ <code>SHA-1</code>  æŒ‡é’ˆï¼Œä»¥åŠç›¸åº”çš„æ¨¡å¼ï¼Œç±»å‹ï¼Œæ–‡ä»¶åä¿¡æ¯ã€‚</p>\n<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œåˆšæ‰çš„ä¸‰ä¸ª <code>objects</code>  ä¸‹çš„æ ¡éªŒå’Œã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p 1883fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">tree 54500d5d74f828d1a3193fb685084b87aaf419c7</span><br><span class=\"line\">test-object-files add</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p 54500d5d74f828d1a3193fb685084b87aaf419c7</span><br><span class=\"line\">100755 blob 3717929ecb3efabae427dbe3725654b3de1a114b\ttest-objects-files-01.txt</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p 3717929ecb3efabae427dbe3725654b3de1a114b</span><br><span class=\"line\">test - objects - files - ç¬¬ä¸€è¡Œ</span><br></pre></td></tr></table></figure>\n<p>æˆ‘æ ¹æ® æ•°å¯¹è±¡  <code>1883fd</code>  æ‰¾åˆ°äº†  <code>54500d</code>  (è¡¨ç¤ºå¯¹åº”çš„ txt æ–‡ä»¶)ï¼Œç„¶åå¯ä»¥æ ¹æ® txt æ–‡ä»¶ï¼Œçœ‹åˆ°è¿™æ¬¡æäº¤çš„å†…å®¹ <code>371792</code> . å¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%9501.png\" alt=\"gitå·¥ä½œç›®å½•01.png\"></p>\n<p>è¿™æ—¶ï¼Œæˆ‘ä»¬åœ¨å°è¯•ä»ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæäº¤ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) sudo vim test-objects-files-01.txt</span><br><span class=\"line\">Password:</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/18/83fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">./.git/objects/37/17929ecb3efabae427dbe3725654b3de1a114b # æ–‡ä»¶</span><br><span class=\"line\">./.git/objects/54/500d5d74f828d1a3193fb685084b87aaf419c7 # æ ‘å¯¹è±¡</span><br><span class=\"line\">./.git/objects/11/a5f11388c345846bbaa060a98d8e93a1114e99 # test hash-object function (æœ¬æ¬¡å®éªŒå¯ä»¥å¿½ç•¥)</span><br><span class=\"line\">## ä¸‹é¢ä¸¤è¡Œæ˜¯æ–°å¢çš„ï¼Œæœ¬æ¬¡æ“ä½œç”Ÿæˆçš„ã€‚</span><br><span class=\"line\">./.git/objects/5b/22ea83f2e8555371b818a7e441d4156795af04 #å†…å®¹: test - objects - files - ç¬¬ä¸€è¡Œ \\n test - objects - files - ç¬¬äºŒè¡Œ</span><br><span class=\"line\"></span><br><span class=\"line\">## æäº¤åˆ°ç‰ˆæœ¬åº“ä¸­ã€‚</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test-object-files updated&quot;</span><br><span class=\"line\">[master 200e059] test-object-files updated</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/18/83fd5aefeb430cb25150e531e92e38f0176f0d # commit - id</span><br><span class=\"line\">./.git/objects/37/17929ecb3efabae427dbe3725654b3de1a114b # æ–‡ä»¶</span><br><span class=\"line\">./.git/objects/54/500d5d74f828d1a3193fb685084b87aaf419c7 # æ ‘å¯¹è±¡</span><br><span class=\"line\">./.git/objects/11/a5f11388c345846bbaa060a98d8e93a1114e99 # test hash-object function(æœ¬æ¬¡å®ç°å¿½ç•¥) </span><br><span class=\"line\">./.git/objects/5b/22ea83f2e8555371b818a7e441d4156795af04 # æ–‡ä»¶</span><br><span class=\"line\"># ä¸‹é¢ä¸¤è¡Œæ˜¯æ–°å¢çš„ï¼Œæœ¬æ¬¡æ“ä½œç”Ÿæˆçš„</span><br><span class=\"line\">./.git/objects/20/0e059f0c0b178378aecd6736f384a74d28df94 # commit-id</span><br><span class=\"line\">./.git/objects/20/db6c4af7677b7509d2b323b503733405e4987e # æ ‘å¯¹è±¡</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬çš„æ“ä½œå¦‚ä¸‹ï¼š</p>\n<ol>\n<li>åœ¨ git ä»“åº“ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å°†å®ƒçº³å…¥ç‰ˆæœ¬ç®¡ç†ï¼Œæäº¤åˆ°äº†ç‰ˆæœ¬åº“ä¸­</li>\n<li>ä¿®æ”¹äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”å†æ¬¡æäº¤åˆ°äº†ç‰ˆæœ¬åº“ä¸­ã€‚</li>\n</ol>\n<p>ç»è¿‡è¿™ä¸ªä¸¤ä¸ªæ­¥éª¤ä¹‹åï¼Œå‡ºç°äº†å¦‚ä¸‹å›¾çš„  <code>git</code>  æ ‘å¯¹è±¡ã€‚</p>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D02.png\" alt=\"gitå·¥ä½œç›®å½•ä»‹ç»02.png\"></p>\n<p>è¿™æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨  <code>git log</code>  å‘½ä»¤æ¥æŸ¥çœ‹æ—¥å¿—ã€‚å¯ä»¥å‘ç°ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">commit 200e059f0c0b178378aecd6736f384a74d28df94 (HEAD -&gt; master)</span><br><span class=\"line\">Author: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\">Date:   Tue Jul 14 16:24:02 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test-object-files updated</span><br><span class=\"line\"></span><br><span class=\"line\">commit 1883fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">Author: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\">Date:   Tue Jul 14 15:45:28 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test-object-files add</span><br></pre></td></tr></table></figure>\n<p>ä¸ºäº†ä¾¿äºå¤§å®¶ç†è§£ï¼Œå’±ä»¬ç»§ç»­ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼ŒåŠ ä¸Šç¬¬ä¸‰è¡Œæ•°æ®:  <code>test - objects - files - ç¬¬ä¸‰è¡Œ</code> ï¼š</p>\n<p>ç„¶åæ‰§è¡Œ</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\">git commit -m &quot;test-object-files updated 02&quot;</span><br></pre></td></tr></table></figure>\n<p>ç„¶åæŸ¥çœ‹ <code>objects</code>  ç›®å½•ä¸‹çš„æ–‡ä»¶å†…å®¹:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/11/a5f11388c345846bbaa060a98d8e93a1114e99</span><br><span class=\"line\">./.git/objects/18/83fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">./.git/objects/20/0e059f0c0b178378aecd6736f384a74d28df94</span><br><span class=\"line\">./.git/objects/20/db6c4af7677b7509d2b323b503733405e4987e</span><br><span class=\"line\">./.git/objects/37/17929ecb3efabae427dbe3725654b3de1a114b</span><br><span class=\"line\">./.git/objects/54/500d5d74f828d1a3193fb685084b87aaf419c7</span><br><span class=\"line\">./.git/objects/5b/22ea83f2e8555371b818a7e441d4156795af04</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ä»¥ä¸‹ä¸‰è¡Œæ˜¯æœ¬æ¬¡commitäº§ç”Ÿçš„ã€‚</span></span><br><span class=\"line\">./.git/objects/a6/2a79d99b37bc5c44ca083cd40f9e4c00aae0bd # commit-idï¼Œæäº¤å¯¹è±¡</span><br><span class=\"line\">./.git/objects/ba/f6b0843a522f8e77f326d2615cb37ed290d06e # æ–‡ä»¶ï¼Œæ•°æ®å¯¹è±¡</span><br><span class=\"line\">./.git/objects/c4/3622f1e8e728f88eb11adfee1ea08d41c792a0 # æ ‘å¯¹è±¡</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p a62a79d99b37bc5c44ca083cd40f9e4c00aae0bd</span><br><span class=\"line\">tree c43622f1e8e728f88eb11adfee1ea08d41c792a0</span><br><span class=\"line\">parent 200e059f0c0b178378aecd6736f384a74d28df94</span><br><span class=\"line\">test-object-files updated 02</span><br><span class=\"line\"></span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p c43622f1e8e728f88eb11adfee1ea08d41c792a0</span><br><span class=\"line\">100755 blob baf6b0843a522f8e77f326d2615cb37ed290d06e\ttest-objects-files-01.txt</span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p baf6b0843a522f8e77f326d2615cb37ed290d06e</span><br><span class=\"line\">test - objects - files - ç¬¬ä¸€è¡Œ</span><br><span class=\"line\">test - objects - files - ç¬¬äºŒè¡Œ</span><br><span class=\"line\">test - objects - files - ç¬¬ä¸‰è¡Œ</span><br></pre></td></tr></table></figure>\n<p>åšå®Œä¸Šé¢çš„æ“ä½œä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>objects</code>  ç›®å½•ä¸‹çš„æ ‘ç»“æ„å›¾ã€‚</p>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D03.png\" alt=\"gitå·¥ä½œç›®å½•ä»‹ç»03.png\"></p>\n<h4 id=\"objectsç›®å½•æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#objectsç›®å½•æ€»ç»“\">#</a> objects ç›®å½•æ€»ç»“</h4>\n<ul>\n<li>ä½œç”¨ï¼š å­˜æ”¾æ‰€æœ‰æ•°æ®çš„å†…å®¹ã€‚</li>\n<li><code>git</code>  æ˜¯ä¸€ä¸ªå†…å®¹å­˜æ‰§æ–‡ä»¶ç®¡ç†ç³»ç»Ÿã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ª <code>KV</code>  æ•°æ®åº“ï¼Œå¯¹åº”çš„ <code>key-value</code>  æ”¾åˆ°äº† <code>objects</code>  ç›®å½•ä¸‹ï¼Œå­˜å‚¨å½¢å¼æ˜¯ä¸€ä¸ª <code>40</code>  ä½åå…­æœºåˆ¶çš„æ ¡éªŒå’Œã€‚ <code>key</code>  æ˜¯æ–‡ä»¶åï¼Œ <code>value</code>  æ˜¯æ–‡ä»¶å†…å®¹ã€‚</li>\n<li>å­¦ä¹ äº†ä¸¤ä¸ªåº•å±‚å‘½ä»¤ï¼š  <code>git cat-file</code>  å’Œ  <code>git hash-object</code> . æ›´å¤šåº•å±‚å‘½ä»¤å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ã€‚// TODO</li>\n<li><b>æ¼”ç¤ºä¸€ä¸ªæ–‡ä»¶çš„ä¸‰æ¬¡æ›´æ–°æ—¶å˜åŒ–è¿‡ç¨‹ï¼Œä»¥åŠå„ä¸ªç‰ˆæœ¬ä¹‹é—´çš„è¿­ä»£è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯å¤šä¸ªæ–‡ä»¶å‘¢ï¼Ÿè¿™é‡Œå¤§å®¶å¯ä»¥å»è¯•ä¸€ä¸‹ï¼Œå°±ä¼šæ›´æ¸…æ™°çš„ç†è§£æ ‘å¯¹è±¡äº†ã€‚ï¼ˆè¿™é‡Œæ¼”ç¤ºä¸€ä¸ªæ–‡ä»¶å¹¶ä¸èƒ½å®Œå…¨çš„è§£é‡Šæ¸…æ ‘å¯¹è±¡è¿™ä¸ªæ¦‚å¿µï¼‰</b></li>\n</ul>\n<h2 id=\"gitå¼•ç”¨-gitå·¥ä½œç›®å½•ä¸‹çš„refsç›®å½•\"><a class=\"markdownIt-Anchor\" href=\"#gitå¼•ç”¨-gitå·¥ä½œç›®å½•ä¸‹çš„refsç›®å½•\">#</a> Git å¼•ç”¨ï¼Œ git å·¥ä½œç›®å½•ä¸‹çš„ refs ç›®å½•ï¼</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) l ./.git/refs/</span><br><span class=\"line\">drwxrwxrwx   3 root  wheel    96B  7 14 17:02 heads</span><br><span class=\"line\">drwxrwxrwx   2 root  wheel    64B  7 14 15:10 tags</span><br></pre></td></tr></table></figure>\n<ul>\n<li>heads ç›®å½•ï¼Œå­˜å‚¨å„ä¸ªåˆ†æ”¯çš„ HEAD æŒ‡é’ˆæŒ‡å‘çš„ç‰ˆæœ¬ã€‚</li>\n<li>tags ç›®å½•ï¼Œgit tag å‘½ä»¤äº§ç”Ÿçš„ç»“æœã€‚</li>\n</ul>\n<h4 id=\"headsç›®å½•\"><a class=\"markdownIt-Anchor\" href=\"#headsç›®å½•\">#</a> heads ç›®å½•</h4>\n<p>æˆ‘ä»¬è¿˜æ˜¯æ ¹æ® objects éƒ¨é—¨çš„æ“ä½œæ¥æ¼”ç¤ºè¿™éƒ¨åˆ†çš„å†…å®¹ã€‚<br>\nå¦‚ä¸‹å›¾ã€‚</p>\n<p><img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D04-object%E7%9B%AE%E5%BD%95%E6%80%BB%E7%BB%93.png\" alt=\"gitå·¥ä½œç›®å½•ä»‹ç»04-objectç›®å½•æ€»ç»“.png\"></p>\n<p>é€šè¿‡æŸ¥çœ‹æˆ‘ä»¬ç›®å‰æ˜¯åœ¨  <code>a62a79d99b37bc5c44ca083cd40f9e4c00aae0bd</code>  è¿™ä¸ªç‰ˆæœ¬ä¸Šã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) cat ./.git/refs/heads/master</span><br><span class=\"line\">a62a79d99b37bc5c44ca083cd40f9e4c00aae0bd</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡  <code>git update-ref</code>  å‘½ä»¤æ¥å®ç°åˆ‡æ¢ç‰ˆæœ¬ (å›é€€åˆ°åˆ¶å®šçš„ç‰ˆæœ¬ä¸Š)</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æˆ‘ä»¬å…ˆä½¿ç”¨ git log å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸‹æäº¤è®°å½•</span></span><br><span class=\"line\"></span><br><span class=\"line\">commit a62a79d99b37bc5c44ca083cd40f9e4c00aae0bd (HEAD -&gt; master)</span><br><span class=\"line\">Author: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\">Date:   Tue Jul 14 17:02:46 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test-object-files updated 02</span><br><span class=\"line\"></span><br><span class=\"line\">commit 200e059f0c0b178378aecd6736f384a74d28df94</span><br><span class=\"line\">Author: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\">Date:   Tue Jul 14 16:24:02 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test-object-files updated</span><br><span class=\"line\"></span><br><span class=\"line\">commit 1883fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">Author: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\">Date:   Tue Jul 14 15:45:28 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test-object-files add</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æˆ‘ä»¬è¦å›é€€åˆ°ç¬¬äºŒä¸ªç‰ˆæœ¬ä¸Šã€‚ä½¿ç”¨ git update-ref,æ›´æ–°å¼•ç”¨ã€‚</span></span><br><span class=\"line\">âœ .git git:(master) git update-ref refs/heads/master 200e059f0c0b178378aecd6736f384a74d28df94</span><br><span class=\"line\"><span class=\"comment\"># å†å»æŸ¥çœ‹gitçš„Headç›®å½•ä¸‹çš„ç‰ˆæœ¬å·</span></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— cat ./.git/refs/heads/master</span><br><span class=\"line\">200e059f0c0b178378aecd6736f384a74d28df94</span><br><span class=\"line\"><span class=\"comment\"># è¿™ä¸ªæ—¶å€™å†ä½¿ç”¨ git log å»çœ‹æ—¥å¿—ï¼š</span></span><br><span class=\"line\">commit 200e059f0c0b178378aecd6736f384a74d28df94 (HEAD -&gt; master)</span><br><span class=\"line\">Author: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\">Date:   Tue Jul 14 16:24:02 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test-object-files updated</span><br><span class=\"line\"></span><br><span class=\"line\">commit 1883fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">Author: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\">Date:   Tue Jul 14 15:45:28 2020 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">    test-object-files add</span><br><span class=\"line\"><span class=\"comment\"># å†å»çœ‹æˆ‘ä»¬çš„æ–‡ä»¶: æ˜¯ä¸ä¼šæ›´æ–°å·¥ä½œåŒºå†…å®¹çš„ã€‚</span></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— cat test-objects-files-01.txt</span><br><span class=\"line\"><span class=\"built_in\">test</span> - objects - files - ç¬¬ä¸€è¡Œ</span><br><span class=\"line\"><span class=\"built_in\">test</span> - objects - files - ç¬¬äºŒè¡Œ</span><br><span class=\"line\"><span class=\"built_in\">test</span> - objects - files - ç¬¬ä¸‰è¡Œ</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ git update-ref æ¥åˆ›å»ºæ–°çš„åˆ†æ”¯ã€‚</span></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— <span class=\"built_in\">cd</span> .git</span><br><span class=\"line\">âœ  .git git:(master) git update-ref refs/heads/<span class=\"built_in\">test</span> 200e059f0c0b178378aecd6736f384a74d28df94</span><br><span class=\"line\"><span class=\"comment\"># æŸ¥çœ‹teståˆ†æ”¯çš„æ—¥å¿—</span></span><br><span class=\"line\">âœ  .git git:(master) git <span class=\"built_in\">log</span> --pretty=oneline <span class=\"built_in\">test</span></span><br><span class=\"line\">200e059f0c0b178378aecd6736f384a74d28df94 (HEAD -&gt; master, <span class=\"built_in\">test</span>) test-object-files updated</span><br><span class=\"line\">1883fd5aefeb430cb25150e531e92e38f0176f0d test-object-files add</span><br><span class=\"line\"><span class=\"comment\"># è¿™æ—¶æˆ‘ä»¬å»æŸ¥çœ‹æˆ‘ä»¬æ‰€å¤„çš„åˆ†æ”¯, å‘ç°æˆ‘ä»¬ä»ç„¶å¤„åœ¨masterä¸Šï¼Œå¹¶æ²¡æœ‰è¿›è¡Œåˆ‡æ¢ã€‚</span></span><br><span class=\"line\">âœ  .git git:(master) git branch</span><br><span class=\"line\">* master</span><br><span class=\"line\">  <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†ï¼Œè™½ç„¶åªæ˜¯ä¿®æ”¹çš„è®°å½•çš„æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬å·¥ä½œåŒºçš„æ–‡ä»¶è¿›è¡Œæ›´æ–°ã€‚æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>\n<h3 id=\"headæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#headæ–‡ä»¶\">#</a> HEAD æ–‡ä»¶</h3>\n<p><code>HEAD</code>  æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªç¬¦å·å¼•ç”¨ï¼ŒæŒ‡å‘ç›®å‰æ‰€åœ¨çš„åˆ†æ”¯ã€‚æ‰€è°“ç¬¦å·å¼•ç”¨ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘å…¶ä»–å¼•ç”¨çš„æŒ‡é’ˆã€‚</p>\n<p>æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹  <code>HEAD</code>  æ–‡ä»¶ä¸­çš„å†…å®¹</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) âœ— cat .git/HEAD</span><br><span class=\"line\">ref: refs/heads/master</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œå‘¢ï¼Œæœ‰ä¸€ä¸ªå‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°ä¿®æ”¹  <code>HEAD</code>  æ–‡ä»¶çš„å†…å®¹</p>\n<p><b>git symbolic-ref</b></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹å½“å‰æ‰€åœ¨çš„åˆ†æ”¯</span></span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git symbolic-ref HEAD</span><br><span class=\"line\">refs/heads/master</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> è®¾ç½®å½“å‰æ‰€åœ¨çš„åˆ†æ”¯</span></span><br><span class=\"line\">âœ  .git git:(master) git symbolic-ref HEAD refs/heads/test</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> å·²ç»å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æŠŠåˆ†æ”¯åˆ‡æ¢åˆ°äº†<span class=\"built_in\">test</span></span></span><br><span class=\"line\">âœ  .git git:(test)</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æˆ‘ä»¬å»çœ‹ å·¥ä½œåŒºé‡Œçš„æ–‡ä»¶ï¼Œå‘ç°å¹¶æ²¡æœ‰å˜åŒ–ï¼</span></span><br><span class=\"line\">âœ  .git git:(test) cat ../test-objects-files-01.txt</span><br><span class=\"line\">test - objects - files - ç¬¬ä¸€è¡Œ</span><br><span class=\"line\">test - objects - files - ç¬¬äºŒè¡Œ</span><br><span class=\"line\">test - objects - files - ç¬¬ä¸‰è¡Œ</span><br></pre></td></tr></table></figure>\n<p>æ–‡ä»¶çš„å†…å®¹çš„ï¼Œä¿®æ”¹å°±å¿…é¡»ä½¿ç”¨  <code>git checkout</code>  /  <code>git reset</code>  äº†ã€‚</p>\n<p>æˆ‘ä»¬å›æ¥æ¥ç€çœ‹ refs ç›®å½•çš„å¦ä¸€ä¸ªç›®å½•ï¼štags.</p>\n<p>tags æ˜¯ git tag å‘½ä»¤çš„äº§ç‰©ã€‚</p>\n<p>ç„¶åï¼Œåœ¨ git ä¸­ï¼Œtags å…¶å®æ˜¯æ ‡ç­¾å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€ä¸ªæ ‡ç­¾åˆ›å»ºè€…ä¿¡æ¯ï¼Œä¸€ä¸ªæ—¥æœŸï¼Œä¸€æ®µæ³¨é‡Šä¿¡æ¯ï¼Œä»¥åŠä¸€ä¸ªæŒ‡é’ˆã€‚æ ‡ç­¾å¯¹è±¡é€šå¸¸æŒ‡å‘ä¸€ä¸ªæäº¤å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ ‘å¯¹è±¡ã€‚æ°¸è¿œéƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ªæäº¤å¯¹è±¡ã€‚</p>\n<p>æ ‡ç­¾åˆ†ä¸º é™„æ³¨æ ‡ç­¾ å’Œ è½»é‡æ ‡ç­¾ã€‚</p>\n<p>ä½¿ç”¨å‘½ä»¤</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># å¸¸è§ä¸€ä¸ªè½»é‡æ ‡ç­¾ -&gt; ä¸€ä¸ªå›ºå®šçš„å¼•ç”¨</span><br><span class=\"line\">âœ  .git git:(test) git update-ref refs/tags/v1.0 1883fd5aefeb430cb25150e531e92e38f0176f0d</span><br></pre></td></tr></table></figure>\n<p>åˆ›å»ºä¸€ä¸ªé™„æ³¨æ ‡ç­¾çš„æ—¶å€™ï¼Œgit ä¼šåˆ›å»ºä¸€ä¸ªæ ‡ç­¾å¯¹è±¡ï¼Œå¹¶è®°å½•ä¸€ä¸ªå¼•ç”¨æ¥æŒ‡å‘è¯¥æ ‡ç­¾å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥æŒ‡å‘è¦æäº¤çš„å¯¹è±¡ã€‚</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  .git git:(test) git tag -a v1.1 1883fd5aefeb430cb25150e531e92e38f0176f0d -m &#x27;é™„æ³¨æ ‡ç­¾&#x27;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹æ ‡ç­¾å¯¹è±¡ã€‚</span></span><br><span class=\"line\">âœ  .git git:(test) cat refs/tags/v1.1</span><br><span class=\"line\">3f224b87d02aa196b0b8331aa28389a172e3f723</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹é™„æ³¨æ ‡ç­¾è¯¦ç»†çš„å†…å®¹</span></span><br><span class=\"line\">âœ  .git git:(test) git cat-file -p 3f224b87d02aa196b0b8331aa28389a172e3f723</span><br><span class=\"line\">object 1883fd5aefeb430cb25150e531e92e38f0176f0d</span><br><span class=\"line\">type commit</span><br><span class=\"line\">tag v1.1</span><br><span class=\"line\">tagger bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt; 1594727545 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">é™„æ³¨æ ‡ç­¾</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¿œç¨‹å¼•ç”¨\"><a class=\"markdownIt-Anchor\" href=\"#è¿œç¨‹å¼•ç”¨\">#</a> è¿œç¨‹å¼•ç”¨</h4>\n<p>åœ¨ git çš„å¼•ç”¨ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªè¿œç¨‹å¼•ç”¨ã€‚</p>\n<p>è¿™ä¸ªç›®å½•ä¼šåœ¨æˆ‘ä»¬é…ç½®è¿œç¨‹ä»“åº“çš„æ—¶å€™å‡ºç°ï¼Œæˆ‘ä»¬ä¸€èµ·é…ç½®ä¸€ä¸‹è¿œç¨‹ä»“åº“</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> é…ç½®è¿œç¨‹ä»“åº“</span></span><br><span class=\"line\">âœ  gitlearn git:(master) git remote add origin https://gitee.com/fangjiaxiaobai/gitlearn.git</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> push åˆ°è¿œç¨‹åˆ†æ”¯ã€‚</span></span><br><span class=\"line\">âœ  gitlearn git:(master) git push origin master</span><br><span class=\"line\">Counting objects: 6, done.</span><br><span class=\"line\">Delta compression using up to 8 threads.</span><br><span class=\"line\">Compressing objects: 100% (5/5), done.</span><br><span class=\"line\">Writing objects: 100% (6/6), 548 bytes | 548.00 KiB/s, done.</span><br><span class=\"line\">Total 6 (delta 0), reused 0 (delta 0)</span><br><span class=\"line\">remote: Powered by GITEE.COM [GNK-5.0]</span><br><span class=\"line\">To https://gitee.com/fangjiaxiaobai/gitlearn.git</span><br><span class=\"line\"> * [new branch]      master -&gt; master</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹ .gitç›®å½•ä¸‹ï¼Œå‡ºç°äº†remotes</span></span><br><span class=\"line\"> âœ  gitlearn git:(master) l ./.git/refs/</span><br><span class=\"line\">total 8</span><br><span class=\"line\">drwxrwxrwx   6 root  wheel   192B  7 14 19:58 .</span><br><span class=\"line\">drwxrwxrwx  16 root  wheel   512B  7 14 19:58 ..</span><br><span class=\"line\">drwxrwxrwx   4 root  wheel   128B  7 14 19:56 heads</span><br><span class=\"line\">drwxr-xr-x   3 bjhl  wheel    96B  7 14 19:58 remotes</span><br><span class=\"line\">-rw-r--r--   1 bjhl  wheel    41B  7 14 19:56 stash # è¿›è¡Œgit stashå‘½ä»¤åå‡ºç°</span><br><span class=\"line\">drwxrwxrwx   4 root  wheel   128B  7 14 19:52 tags</span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> æŸ¥çœ‹å¯¹åº”remoteé…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">âœ  gitlearn git:(master) cat .git/refs/remotes/origin/master</span><br><span class=\"line\">200e059f0c0b178378aecd6736f384a74d28df94</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªæ ¡éªŒç è¡¨ç¤º ï¼Œè¿œç¨‹ç‰ˆæœ¬åº“ä¸­å’Œæœ¬åœ°çš„ç‰ˆæœ¬åº“ä¸­æœ€æ–°ä¸€æ¬¡äº¤äº’çš„ commit id ã€‚</p>\n<p>è¿œç¨‹å¼•ç”¨å’Œåˆ†æ”¯ä¹‹é—´æœ€ä¸»è¦çš„åŒºåˆ«ï¼Œå°±æ˜¯è¿œç¨‹å¼•ç”¨æ˜¯åªè¯»çš„ã€‚Git æ°¸è¿œä¸ä¼šè®² HEAD å¼•ç”¨æŒ‡å‘è¯¥è¿œç¨‹å¼•ç”¨ï¼Œå› æ­¤ï¼Œä¸å¯èƒ½é€šè¿‡ commit æ¥æ›´æ–°è¿œç¨‹å¼•ç”¨ã€‚</p>\n<h3 id=\"indexæ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#indexæ–‡ä»¶\">#</a> Index æ–‡ä»¶</h3>\n<p>è¿™ä¸ªæ–‡ä»¶æ˜¯  <code>git stage</code>  çš„æ–‡ä»¶ä¿¡æ¯å­˜æ”¾åœ°ï¼Œæ ¹æ®è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰å“ªäº›æ–‡ä»¶ï¼Œæˆ–è€…å“ªäº›æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œè€Œåœ¨ <code>commit</code>  ä¹‹åï¼Œåˆ™ä¼šæŠŠç›¸åº”çš„ä¿¡æ¯å­˜å…¥  <code>.git/objects</code>  æ–‡ä»¶å¤¹ä¸‹ã€‚é€šè¿‡  <code>git ls-files -s</code>  å¯ä»¥æŸ¥ çœ‹  <code>index</code>  æ–‡ä»¶ä¸­çš„  <code>stage</code>  æ–‡ä»¶çš„ä¿¡æ¯ã€‚</p>\n<p><code>Index</code>  æ–‡ä»¶æ˜¯ç”¨äºŒè¿›åˆ¶å­˜å‚¨çš„ï¼ŒåŒ…å«æœ‰  <code>ctime</code>  å’Œ  <code>mtime</code>  æ—¶é—´ä¿¡æ¯ï¼Œæ–‡ä»¶å­˜å‚¨çš„è®¾å¤‡ä¿¡æ¯ï¼Œç£ç›˜çš„ <code>inode</code>  ä¿¡æ¯ï¼Œæ–‡ä»¶çš„  <code>mode</code>  ä¿¡æ¯ï¼Œ <code>UID</code> ï¼Œ <code>GID</code> ï¼Œæ–‡ä»¶å¤§å°ï¼Œæ–‡ä»¶çš„ <code>SHA-1</code>  ç ï¼Œ <code>flag</code> ï¼Œæ–‡ä»¶çš„ <code>file path</code>  ç­‰ä¿¡æ¯ã€‚</p>\n<p>å„ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æŒ‰ç…§ä¸€å®šçš„æ’åˆ—é¡ºåºè¿›è¡Œæ’å¸ƒã€‚æäº¤çš„æ—¶å€™ï¼ŒæŒ‰ç…§è¿™ç§çº¦å®šè¿›è¡Œè§£æã€‚</p>\n<h2 id=\"åŒ…æ–‡ä»¶\"><a class=\"markdownIt-Anchor\" href=\"#åŒ…æ–‡ä»¶\">#</a> åŒ…æ–‡ä»¶</h2>\n<p>åœ¨æ–‡ç« ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬å°±è¯´è¿‡ï¼Œgit æ˜¯åŸºäºå¿«ç…§çš„æ–¹å¼æ¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„ã€‚è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬æ¯è¿›è¡Œä¸€æ¬¡ commit æ“ä½œï¼Œgit å°±æ˜¯å­˜å‚¨ä¸€ä»½æˆ‘ä»¬æ‰€æœ‰çš„æ–‡ä»¶ã€‚é‚£ä¹ˆï¼Œä¸€ä¸ªå¤§é¡¹ç›®ï¼Œé‚£å²‚ä¸æ˜¯ä¼šå ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ï¼Ÿï¼Ÿ</p>\n<p>æˆ‘ä»¬å…ˆåšä¸ªå®éªŒã€‚çœ‹çœ‹ git ä¼šä¸ä¼šå ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ï¼Ÿ</p>\n<p><b>é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªä»“åº“</b></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># åˆ›å»ºä»“åº“</span><br><span class=\"line\">âœ  gitlearn git init .</span><br><span class=\"line\">Initialized empty Git repository in /private/tmp/gitlearn/.git/</span><br><span class=\"line\"># æ·»åŠ æ–‡ä»¶</span><br><span class=\"line\">âœ  gitlearn git:(master) touch test-package-file</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— vim test-package-file</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test package file 1&quot;</span><br><span class=\"line\">[master (root-commit) 12cbb50] test package file 1</span><br><span class=\"line\"> Committer: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"> create mode 100644 test-package-file</span><br><span class=\"line\"># æŸ¥çœ‹æ•°æ®å¯¹è±¡çš„id</span><br><span class=\"line\">âœ  gitlearn git:(master)  git cat-file -p master^&#123;tree&#125;</span><br><span class=\"line\">100644 blob c2e8644a8379ab0cf4f2bc5a14160d94608502f7\ttest-package-file</span><br><span class=\"line\"># ä¿®æ”¹ test ,æ·»åŠ  test package file * 700</span><br><span class=\"line\">âœ  gitlearn git:(master) vim test-package-file</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— vim test-package-file</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test package file 2&quot;</span><br><span class=\"line\">[master 421177c] test package file 2</span><br><span class=\"line\"> Committer: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\"> 1 file changed, 740 insertions(+)</span><br><span class=\"line\"># æŸ¥çœ‹ç¬¬äºŒæ¬¡æäº¤çš„æ•°æ®å¯¹è±¡çš„id</span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -p master^&#123;tree&#125;</span><br><span class=\"line\">100644 blob 363980e2f742592594e01648888a661d2d0479b9\ttest-package-file</span><br><span class=\"line\">### æŸ¥çœ‹ä¸¤æ¬¡æ•°æ®å¯¹è±¡çš„å¤§å°</span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -s c2e8644a8379ab0cf4f2bc5a14160d94608502f7</span><br><span class=\"line\">18</span><br><span class=\"line\">âœ  gitlearn git:(master) git cat-file -s 363980e2f742592594e01648888a661d2d0479b9</span><br><span class=\"line\">13338</span><br><span class=\"line\"></span><br><span class=\"line\">## æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸¤æ¬¡æ–‡ä»¶å­˜å‚¨çš„æ–‡ä»¶ã€‚</span><br><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/12/cbb50359469eb29efe29945a3b18e262f6e862</span><br><span class=\"line\">./.git/objects/36/3980e2f742592594e01648888a661d2d0479b9</span><br><span class=\"line\">./.git/objects/42/1177c9026e757e7e123b6ee589bcffa067eb96</span><br><span class=\"line\">./.git/objects/8e/0703665933215a57787a3117b079d4c8cb1921</span><br><span class=\"line\">./.git/objects/c2/e8644a8379ab0cf4f2bc5a14160d94608502f7</span><br><span class=\"line\">./.git/objects/c3/1d0ebb18efdfc791a254ab58a01ff2ed0136e4</span><br></pre></td></tr></table></figure>\n<p>ç°åœ¨ <code>git</code>  ä¸­å­˜å‚¨äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡æäº¤å’Œç¬¬äºŒæ¬¡æäº¤çš„å†…å®¹ã€‚</p>\n<p>å¦‚æœ <code>git</code>  åƒ <code>SVN</code>  ä¸€æ ·è®°å½•å˜æ›´çš„å†…å®¹çš„è¯ï¼Œæ˜¯ä¸æ˜¯æ›´å¥½å‘¢ï¼Ÿ</p>\n<p><code>git</code>  ä¸Šæœ¬æ¥å¯ä»¥é‚£ä¹ˆåšã€‚  <code>git</code>  æœ€åˆå‘ç£ç›˜ä¸­å­˜å‚¨å¯¹è±¡æ—¶æ‰€ä½¿ç”¨çš„æ ¼å¼ç§°ä¸º æ¾æ•£å¯¹è±¡æ ¼å¼ã€‚ ä½†æ˜¯ï¼Œ <code>git</code>  ä¼šæ—¶ä¸æ—¶çš„å°†å¤šä¸ªå¯¹è±¡æ‰“åŒ…æˆä¸€ä¸ª ç§°ä¸º â€œåŒ…æ–‡ä»¶â€ çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ¥èŠ‚çœç©ºé—´å’Œæ•ˆç‡ã€‚</p>\n<p>å½“ä»“åº“ä¸­æœ‰å¤ªå¤šçš„ æ¾æ•£å¯¹è±¡ï¼Œæˆ–è€…æ‰‹åŠ¨æ‰§è¡Œ  <code>git gc</code>  å‘½ä»¤ï¼Œæˆ–è€…å‘è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œæ¨é€æ—¶ï¼Œ <code>git</code>  éƒ½ä¼šè¿™ä¹ˆåšã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># æ‰§è¡Œä¸€ä¸‹ git gc</span><br><span class=\"line\">âœ  gitlearn git:(master) git gc</span><br><span class=\"line\">Counting objects: 6, done.</span><br><span class=\"line\">Delta compression using up to 8 threads.</span><br><span class=\"line\">Compressing objects: 100% (3/3), done.</span><br><span class=\"line\">Writing objects: 100% (6/6), done.</span><br><span class=\"line\">Total 6 (delta 0), reused 0 (delta 0)</span><br><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/info/packs</span><br><span class=\"line\">./.git/objects/pack/pack-275c7b3d69b1acacc114c081d6ffa61d6683e8a1.idx</span><br><span class=\"line\">./.git/objects/pack/pack-275c7b3d69b1acacc114c081d6ffa61d6683e8a1.pack</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ªåŒ…æ–‡ä»¶ ( <code>.pack</code> ) å’Œä¸€ä¸ªç´¢å¼•æ–‡ä»¶ ( <code>.idx</code> )ã€‚åŒ…æ–‡ä»¶æŠ±æ„§äº†åˆšæ‰ä»ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ç§»é™¤çš„æ‰€æœ‰å¯¹è±¡çš„å†…å®¹ï¼Œç´¢å¼•æ–‡ä»¶åŒ…å«äº†æ–‡ä»¶çš„åç§»ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åç§»æ–‡ä»¶å¿«é€Ÿçš„å®šä½ä»»æ„ä¸€ä¸ªæŒ‡å®šå¯¹è±¡ã€‚</p>\n<p><code>git</code>  æ‰“åŒ…å¯¹è±¡æ—¶ï¼Œä¼šæŸ¥æ‰¾å‘½åä»¥åŠå¤§å°ç›¸è¿‘çš„æ–‡ä»¶ï¼Œå¹¶åªä¿å­˜æ–‡ä»¶ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨  <code>git verify-pack</code>  è¿™ä¸ªåº•å±‚å‘½ä»¤æŸ¥çœ‹å·²ç»æ‰“åŒ…å†…å®¹:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  gitlearn git:(master) git verify-pack -v .git/objects/pack/pack-275c7b3d69b1acacc114c081d6ffa61d6683e8a1.idx</span><br><span class=\"line\">421177c9026e757e7e123b6ee589bcffa067eb96 commit 238 160 12</span><br><span class=\"line\">12cbb50359469eb29efe29945a3b18e262f6e862 commit 190 131 172</span><br><span class=\"line\">363980e2f742592594e01648888a661d2d0479b9 blob   13338 80 303</span><br><span class=\"line\">c31d0ebb18efdfc791a254ab58a01ff2ed0136e4 tree   45 55 383</span><br><span class=\"line\">8e0703665933215a57787a3117b079d4c8cb1921 tree   45 56 438</span><br><span class=\"line\">c2e8644a8379ab0cf4f2bc5a14160d94608502f7 blob   18 28 494</span><br><span class=\"line\">non delta: 6 objects</span><br><span class=\"line\">.git/objects/pack/pack-275c7b3d69b1acacc114c081d6ffa61d6683e8a1.pack: ok</span><br></pre></td></tr></table></figure>\n<p>å…¶ä¸­ç¬¬ä¸‰åˆ—æ˜¯åœ¨åŒ…æ–‡ä»¶ä¸­å„ä¸ªå¯¹è±¡çš„å¤§å°ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ ‘å¯¹è±¡æ˜¯ <code>45</code>  å­—èŠ‚ï¼Œæ•°æ®å¯¹è±¡å’Œæäº¤å¯¹è±¡ï¼Œéƒ½æ˜¯åŸæ¥çš„å¤§å°ã€‚</p>\n<p>æ˜¾ç„¶è¿™æ¬¡å¹¶æ²¡æœ‰è¿›è¡Œå‹ç¼©ã€‚ æˆ‘ä»¬å†æ¬¡ä¿®æ”¹æ–‡ä»¶ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ä¿®æ”¹æ–‡ä»¶ï¼š æœ€åä¸€è¡Œæ·»åŠ  test package file</span><br><span class=\"line\">âœ  gitlearn git:(master) vim test-package-file</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git add .</span><br><span class=\"line\">âœ  gitlearn git:(master) âœ— git commit -m &quot;test package file 3&quot;</span><br><span class=\"line\">[master 2ab3a27] test package file 3</span><br><span class=\"line\"> Committer: bjhl &lt;bjhl@bjhldeMacBook-Pro.local&gt;</span><br><span class=\"line\"> 1 file changed, 1 insertion(+)</span><br><span class=\"line\"> # æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶</span><br><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/2a/b3a275bf16a86f77e632127ccf62bcecf98579</span><br><span class=\"line\">./.git/objects/84/003569b2725d79bc209821c9c3dbb5c2ef8a8d</span><br><span class=\"line\">./.git/objects/df/e088f704e98a835ed3ca2ce31919947d63f884</span><br><span class=\"line\">./.git/objects/info/packs</span><br><span class=\"line\">./.git/objects/pack/pack-275c7b3d69b1acacc114c081d6ffa61d6683e8a1.idx</span><br><span class=\"line\">./.git/objects/pack/pack-275c7b3d69b1acacc114c081d6ffa61d6683e8a1.pack</span><br><span class=\"line\"># è¿›è¡Œæ‰“åŒ…</span><br><span class=\"line\">âœ  gitlearn git:(master) git gc</span><br><span class=\"line\">Counting objects: 9, done.</span><br><span class=\"line\">Delta compression using up to 8 threads.</span><br><span class=\"line\">Compressing objects: 100% (5/5), done.</span><br><span class=\"line\">Writing objects: 100% (9/9), done.</span><br><span class=\"line\">Total 9 (delta 1), reused 5 (delta 0)</span><br><span class=\"line\">âœ  gitlearn git:(master) sh /opt/util/dirfile.sh ./.git/objects</span><br><span class=\"line\">./.git/objects/info/packs</span><br><span class=\"line\">./.git/objects/pack/pack-a30aa1dcd93c0fadc605cf3fb5828e8cf186ef29.idx</span><br><span class=\"line\">./.git/objects/pack/pack-a30aa1dcd93c0fadc605cf3fb5828e8cf186ef29.pack</span><br><span class=\"line\"># æŸ¥çœ‹æ‰“åŒ…çš„å†…å®¹</span><br><span class=\"line\">âœ  gitlearn git:(master) git verify-pack -v .git/objects/pack/pack-a30aa1dcd93c0fadc605cf3fb5828e8cf186ef29.idx</span><br><span class=\"line\">2ab3a275bf16a86f77e632127ccf62bcecf98579 commit 238 160 12</span><br><span class=\"line\">421177c9026e757e7e123b6ee589bcffa067eb96 commit 238 160 172</span><br><span class=\"line\">12cbb50359469eb29efe29945a3b18e262f6e862 commit 190 131 332</span><br><span class=\"line\">84003569b2725d79bc209821c9c3dbb5c2ef8a8d tree   45 56 555</span><br><span class=\"line\">c31d0ebb18efdfc791a254ab58a01ff2ed0136e4 tree   45 55 611</span><br><span class=\"line\">8e0703665933215a57787a3117b079d4c8cb1921 tree   45 56 684</span><br><span class=\"line\">dfe088f704e98a835ed3ca2ce31919947d63f884 blob   13356 92 463 # ç¬¬ä¸‰æ¬¡æäº¤</span><br><span class=\"line\">363980e2f742592594e01648888a661d2d0479b9 blob   7 18 666 1 dfe088f704e98a835ed3ca2ce31919947d63f884 # ç¬¬äºŒæ¬¡æäº¤</span><br><span class=\"line\">c2e8644a8379ab0cf4f2bc5a14160d94608502f7 blob   18 28 740 # ç¬¬ä¸€æ¬¡æäº¤</span><br><span class=\"line\">non delta: 8 objects</span><br><span class=\"line\">chain length = 1: 1 object</span><br><span class=\"line\">.git/objects/pack/pack-a30aa1dcd93c0fadc605cf3fb5828e8cf186ef29.pack: ok</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬å¯ä»¥åˆ°çœ‹åˆ° ç¬¬ä¸‰æ¬¡æäº¤çš„å†…å®¹æ˜¯  <code>13356</code>  å­—èŠ‚ï¼Œè€Œç¬¬äºŒæ¬¡æäº¤çš„å†…å®¹åªæœ‰  <code>7</code>  ä¸ªå­—èŠ‚ã€‚æ˜¾ç„¶ï¼Œ <code>git</code>  è¿™æ¬¡è¿›è¡Œå‹ç¼©ã€‚å¦å¤–ï¼Œç¬¬ä¸‰ä¸ªç‰ˆæœ¬æ˜¯ä¿å­˜äº†æœ€æ–°çš„æ–‡ä»¶å†…å®¹ï¼ŒåŸå§‹ç‰ˆæœ¬æ˜¯ä»¥å·®å¼‚æ–¹å¼å­˜åœ¨çš„ -- è¿™æ˜¯å› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéœ€è¦å¿«é€Ÿçš„è®¿é—®æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<ul>\n<li><code>git</code>  åˆ›å»ºä»“åº“ä¸¤ç§æ–¹å¼ï¼šæœ¬åœ°åˆ›å»ºï¼Œ <code>clone</code>  ä»“åº“</li>\n<li><code>git</code>  ä»“åº“çš„ç›®å½•ç»“æ„\n<ul>\n<li><code>objects</code>  ç›®å½•<br>\næˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæœ€ç®€å•çš„ä¸‰æ¬¡æäº¤æ¥çœ‹äº†ä¸€ä¸‹ <code>git</code>  ä»“åº“æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ã€‚<br>\nè¿™é‡Œï¼Œæˆ‘è´´ä¸Šè¿™å¼ æˆ‘ä»¬æ“ä½œè¿‡ç¨‹çš„å›¾ï¼ŒåŠ æ·±ä¸€ä¸‹å°è±¡.<br>\n<img data-src=\"/images/git%E7%B3%BB%E5%88%97/images/git%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D04-object%E7%9B%AE%E5%BD%95%E6%80%BB%E7%BB%93.png\" alt=\"gitå·¥ä½œç›®å½•ä»‹ç»04-objectç›®å½•æ€»ç»“.png\"></li>\n<li><code>refs</code> : å¼•ç”¨\n<ul>\n<li>å››ç§å¯¹è±¡ï¼šæäº¤å¯¹è±¡ï¼Œæ•°æ®å¯¹è±¡ï¼Œæ ‘å¯¹è±¡ï¼Œæ ‡ç­¾å¯¹è±¡ã€‚</li>\n<li>æ ‘å¯¹è±¡:  <code>commit-&gt;tree-&gt;blob</code>  (æ–‡ä»¶)  <span class=\"spoiler\" title=\"...\">è¯¾åä½œä¸šï¼šå¤šæ–‡ä»¶çš„æäº¤è®°å½•</span></li>\n<li><code>heads/master</code> ,  <code>heads/test/</code> , <code>tags/</code> . è¿™å‡ ä¸ªæ–‡ä»¶çš„ä½œç”¨</li>\n<li><code>git symbolic</code>  å‘½ä»¤ï¼Œ</li>\n</ul>\n</li>\n<li><code>Index</code>  æ–‡ä»¶ã€‚è®°å½•å½“å‰å“ªäº›æ–‡ä»¶è¢«ä¿®æ”¹ï¼Œæ–°å¢ã€‚</li>\n<li>åŒ…æ–‡ä»¶ï¼š è§£å†³ git å·¥ä½œç›®å½•è¿‡å¤§çš„é—®é¢˜ã€‚å‹ç¼©ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "git"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/README/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/README/",
            "title": "ã€ç›®å½•ã€‘JDKæºç è§£è¯»ç›®å½•",
            "date_published": "2021-07-15T06:48:55.000Z",
            "content_html": "<h2 id=\"ç›®å½•\"><a class=\"markdownIt-Anchor\" href=\"#ç›®å½•\">#</a> ç›®å½•</h2>\n<h4 id=\"javautil\"><a class=\"markdownIt-Anchor\" href=\"#javautil\">#</a> java.util</h4>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> <a href=\"/2021/07/15/source%20code/HashMap/HashMap/\">HashMap</a></label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> <a href=\"/2021/07/15/source%20code/HashMap/HashMap%E7%9A%84Hash%E5%87%BD%E6%95%B0%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E6%84%8F%E4%B9%89/\">HashMap çš„ Hash å‡½æ•°åˆ°åº•æœ‰ä»€ä¹ˆæ„ä¹‰.md</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" disabled=\"true\"><label for=\"cbx_2\"> <a href=\"./HashMap/HashMap%E5%88%B0%E5%BA%95%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84.md\">HashMap åˆ°åº•ä¸ºä»€ä¹ˆæ˜¯ä¸å®‰å…¨çš„.md</a></label></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"javautilconcurrency\"><a class=\"markdownIt-Anchor\" href=\"#javautilconcurrency\">#</a> java.util.concurrency</h4>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" disabled=\"true\"><label for=\"cbx_3\"> ConcurrentHashMap</label></li>\n</ul>\n<h4 id=\"javalang\"><a class=\"markdownIt-Anchor\" href=\"#javalang\">#</a> java.lang</h4>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" checked=\"true\" disabled=\"true\"><label for=\"cbx_4\"> <a href=\"2021/07/15/source%20code/String/String/\">String.md</a></label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_5\" checked=\"true\" disabled=\"true\"><label for=\"cbx_5\"> <a href=\"./threadLocal/ThreadLocal%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.md\">ThreadLocal æºç åˆ†æ.md</a></label>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_6\" checked=\"true\" disabled=\"true\"><label for=\"cbx_6\"> <a href=\"./threadLocal/ThreadLocal%E7%9A%84%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95.md\">ThreadLocal çš„å“ˆå¸Œç®—æ³•.md</a></label></li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "ç›®å½•",
                "æºç "
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/HashMap/HashMap%E7%9A%84Hash%E5%87%BD%E6%95%B0%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E6%84%8F%E4%B9%89/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/HashMap/HashMap%E7%9A%84Hash%E5%87%BD%E6%95%B0%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E6%84%8F%E4%B9%89/",
            "title": "HashMapçš„Hashå‡½æ•°åˆ°åº•æœ‰ä»€ä¹ˆæ„ä¹‰",
            "date_published": "2021-07-15T06:48:55.000Z",
            "content_html": "<h2 id=\"jdk18-hashmapä¸­hashå€¼è®¡ç®—æºç \"><a class=\"markdownIt-Anchor\" href=\"#jdk18-hashmapä¸­hashå€¼è®¡ç®—æºç \">#</a> jdk1.8 HashMap ä¸­ hash å€¼è®¡ç®—æºç </h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ‰°åŠ¨å‡½æ•°</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">hash</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (key == <span class=\"keyword\">null</span>) ? <span class=\"number\">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å…¶ä¸­çš„key.hashCodeè°ƒç”¨çš„æ˜¯åº•å±‚çš„nativeæ–¹æ³•ã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">native</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span></span>;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ key çš„ hashCode å€¼å‘¢ï¼Ÿ</li>\n</ul>\n<p>å¦‚æœç›´æ¥ä½¿ç”¨ key çš„ hashCode () å‡½æ•°çš„æ—¶å€™ï¼Œå°† hash å€¼ä½œä¸‹æ ‡è®¿é—® Map çš„æ•°ç»„çš„è¯ï¼Œç”±äº 2 è¿›åˆ¶çš„å–å€¼èŒƒå›´æ˜¯ [-2<sup>31,2</sup>31), åŠ èµ·æ¥å¤§äºæœ‰ 40 äº¿çš„æ˜ å°„ç©ºé—´ã€‚åªè¦ hash å‡½æ•°æ•£åˆ—çš„æ¯”è¾ƒæ¾æ•£ï¼Œé‚£ä¹ˆä¹…å¾ˆéš¾å‡ºç°ç¢°æ’ã€‚å½“ç„¶ï¼Œ40 äº¿çš„æ•°æ®ï¼Œå†…å­˜ä¹Ÿæ˜¯æ”¾ä¸ä¸‹çš„ã€‚æ‰€ä»¥ä¸èƒ½ç›´æ¥æ‹¿ key çš„ hashCodeã€‚</p>\n<ul>\n<li>Q: ä¸ºä»€ä¹ˆè¦è¿›è¡Œ  <code>h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>  è¿™ä¸ªè¿ç®—å‘¢ï¼Ÿ</li>\n</ul>\n<p>è¿™ä¸ªé—®é¢˜å°±è¦ä»è®¡ç®—å‡ºçš„ hash å€¼çš„ä½œç”¨ä¸Šæ¥åˆ‡å…¥äº†ï¼ŒhashMap è®¡ç®—è¿™ä¸ª hash å€¼å°±æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿå¢åˆ æ”¹æŸ¥çš„æ—¶å€™ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚é‚£ä¹ˆ hashMap æ˜¯æ€ä¹ˆç¡®å®šä½ç½®çš„å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ HashMap ä¸­çš„æ•°ç»„æ˜¯ tab å­—æ®µã€‚æ ¹æ® tab æ‰¾åˆ°ï¼Œåœ¨ <code>final HashMap.Node&lt;K,V&gt; getNode(int hash, Object key)</code>  æ–¹æ³•ä¸­ï¼Œæœ‰è¿™ä¹ˆ <code>tab[(n - 1) &amp; hash]</code>  ä½¿ç”¨ã€‚ n æ˜¯æ•°ç»„çš„é•¿åº¦.<br>\n è¿™é‡Œ n-1 ç›¸å½“äºä¸€ä¸ª <code>ä½ä½æ©ç </code> ï¼Œå’Œ hash è¿›è¡Œä¸æ“ä½œçš„ç»“æœå°±æ˜¯æ•£åˆ—å€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œä¿ç•™ä½ä½ï¼Œç”¨æ¥åšä¸‹æ ‡è®¿é—®ã€‚è¿™ä¹ˆçœ‹ï¼Œå°±ç®—æˆ‘ä»¬çš„ hash æ•£åˆ—åˆ†å¸ƒå†æ¾æ•£ï¼Œå†²çªä¹Ÿä¼šå¾ˆä¸¥é‡ã€‚ä»¥é»˜è®¤é•¿åº¦ 16 ä¸ºä¾‹ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  11111111  11111111 11110000 11101010  # nativeæ–¹æ³• HashCode()</span><br><span class=\"line\">&amp; 00000000  00000000 00000000 00001111  # é»˜è®¤åˆå§‹é•¿åº¦ 15 = 16 -1</span><br><span class=\"line\">  -------------------------------------</span><br><span class=\"line\">  00000000  00000000 00000000 00001010  # è¿›è¡Œ&amp;æ“ä½œï¼Œè®¡ç®—å‡ºçš„ä¸‹æ ‡ä¸º10</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬çœ‹ä¸‹ä½¿ç”¨æ‰°åŠ¨å‡½æ•°è®¡ç®—åçš„ç»“æœ:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># æ‰°åŠ¨å‡½æ•°è®¡ç®—è¿‡ç¨‹:</span><br><span class=\"line\">   h=hashCode():  11111111  11111111  11110000  11101010  # nativeæ–¹æ³• HashCode()</span><br><span class=\"line\">   -------------------------------------------------------------------------------</span><br><span class=\"line\">              h:  11111111  11111111  11110000  11101010  # nativeæ–¹æ³• HashCode()è®¡ç®—å‡ºçš„å€¼ã€‚</span><br><span class=\"line\">   ^     h&gt;&gt;&gt;16:  00000000  00000000  11111111  11111111  # hashCodeå·¦ç§»16ä½=&gt;é«˜16ä½å˜ä½ä½</span><br><span class=\"line\">   -----------------------------------------------------------------------------------</span><br><span class=\"line\">hash=h^(h&gt;&gt;&gt;16):  11111111  11111111  00001111  00010101  # æ‰°åŠ¨å‡½æ•°è®¡ç®—å‡ºçš„å€¼</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># ä¸æ©ç åš&amp;è¿ç®—=&gt;è®¡ç®—æ•°ç»„ä¸‹æ ‡</span><br><span class=\"line\">hash=h^(h&gt;&gt;&gt;16):  11111111  11111111  00001111  00010101  # æ‰°åŠ¨å‡½æ•°è®¡ç®—å‡ºçš„å€¼</span><br><span class=\"line\">            &amp;  :  00000000  00000000  00000000  00001111  # ä½ä½æ©ç =&gt; hashMapä¸­æ•°ç»„çš„é•¿åº¦</span><br><span class=\"line\">    -----------------------------------------------------------------------------------</span><br><span class=\"line\">                             ....                  00101  # =&gt;è®¡ç®—å‡ºçš„ä¸‹æ ‡ä¸º5.</span><br></pre></td></tr></table></figure>\n<h3 id=\"peter-lawleyçš„ä¸€ç¯‡ä¸“æ æ–‡ç« an-introduction-to-optimising-a-hashing-strategyé‡Œçš„çš„ä¸€ä¸ªå®éªŒ\"><a class=\"markdownIt-Anchor\" href=\"#peter-lawleyçš„ä¸€ç¯‡ä¸“æ æ–‡ç« an-introduction-to-optimising-a-hashing-strategyé‡Œçš„çš„ä¸€ä¸ªå®éªŒ\">#</a> Peter Lawley çš„ä¸€ç¯‡ä¸“æ æ–‡ç« ã€ŠAn introduction to optimising a hashing strategyã€‹é‡Œçš„çš„ä¸€ä¸ªå®éªŒ</h3>\n<p><img data-src=\"/images/JavaSourceCode/HashMap/hashMap%E6%89%B0%E5%8A%A8%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%9C%E7%94%A8.png\" alt=\"hashMapæ‰°åŠ¨å‡½æ•°çš„ä½œç”¨.png\"></p>\n<p>ç»“æœæ˜¾ç¤ºï¼Œå½“ HashMap æ•°ç»„é•¿åº¦ä¸º 512 çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ç”¨æ©ç å–ä½ 9 ä½çš„æ—¶å€™ï¼Œåœ¨æ²¡æœ‰æ‰°åŠ¨å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå‘ç”Ÿäº† 103 æ¬¡ç¢°æ’ï¼Œæ¥è¿‘ 30%ã€‚è€Œåœ¨ä½¿ç”¨äº†æ‰°åŠ¨å‡½æ•°ä¹‹ååªæœ‰ 92 æ¬¡ç¢°æ’ã€‚ç¢°æ’å‡å°‘äº†å°†è¿‘ 10%ã€‚çœ‹æ¥æ‰°åŠ¨å‡½æ•°ç¡®å®è¿˜æ˜¯æœ‰åŠŸæ•ˆçš„ã€‚</p>\n<h2 id=\"jdk7ä¸­çš„hashmapè®¡ç®—hashçš„æ–¹å¼\"><a class=\"markdownIt-Anchor\" href=\"#jdk7ä¸­çš„hashmapè®¡ç®—hashçš„æ–¹å¼\">#</a> JDK7 ä¸­çš„ HashMap è®¡ç®— hash çš„æ–¹å¼</h2>\n<h2 id=\"å‚è€ƒæ–‡ç« \"><a class=\"markdownIt-Anchor\" href=\"#å‚è€ƒæ–‡ç« \">#</a> å‚è€ƒæ–‡ç« </h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vemhlbmd3YW5nL3AvODEzNjE2NC5odG1s\">HashMap ä¸­çš„ hash å‡½æ•°</span></p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "æºç ",
                "HashMap",
                "JDK",
                "JDK8"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/String/String/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/String/String/",
            "title": "Stringç±»æºç è§£æ",
            "date_published": "2021-07-15T06:48:55.000Z",
            "content_html": "<p>ä¸€ã€ç­¾åï¼š</p>\n<p><code>public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence</code></p>\n<ul>\n<li>String ä¸èƒ½è¢«ç»§æ‰¿ï¼Œ</li>\n<li>å®ç°äº† Serializableï¼šå¯è¢«åºåˆ—åŒ–ã€‚</li>\n<li>å®ç°äº† Comparableï¼šå¯ä»¥æ¯”è¾ƒï¼Œæ’åºï¼Œ</li>\n<li>å®ç°äº† CharSequenceï¼šå€¼æ˜¯å¯è¯»åºåˆ—ã€‚</li>\n</ul>\n<p>äºŒã€æˆå‘˜å˜é‡ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">char</span> value[];Â  <span class=\"comment\">// å­˜å‚¨å­—ç¬¦ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> hash;Â Â Â Â  <span class=\"comment\">// ç¼“å­˜å­—ç¬¦ä¸²çš„hashå€¼ã€‚</span></span><br><span class=\"line\">Private <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ObjectStreamField[] serialPersistentFields = <span class=\"keyword\">new</span> ObjectStreamFiled[<span class=\"number\">0</span>];Â  <span class=\"comment\">// å­—ç¬¦ä¸²ç±»è¢«æŒ‡å®šè½¬åŒ–åºåˆ—åŒ–æµåè®®ä¸­ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">/** use serialVersionUID from JDK 1.0.2 for interoperability */</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">6849794470754667710L</span>;</span><br></pre></td></tr></table></figure>\n<p><code>Value</code>  æ˜¯ <code>final</code>  çš„ï¼Œæ‰€ä»¥ <code>String</code>  ä¸€æ—¦å®šä¹‰ä¹‹åï¼Œå°±ä¸å¯å˜çš„ã€‚</p>\n<p>ä¸‰ã€æ„é€ å‡½æ•°ï¼š</p>\n<p>å››ã€å¸¸ç”¨æ–¹æ³•ï¼š</p>\n<p>ç”±äº String ä¸­é‡è½½çš„æ–¹æ³•å¤ªå¤šäº†ï¼Œæ‰€ä»¥å°±åªå†™æ–¹æ³•åäº†ã€‚</p>\n<p>1.Â   <code>getBytes</code> :</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] getBytes() &#123;</span><br><span class=\"line\">Â Â  <span class=\"keyword\">return</span> StringCoding.encode(value, <span class=\"number\">0</span>, value.length);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥ä¸Šé¢çš„è¿™ä¸ªæ–¹æ³•ä¸ºä¾‹ï¼šå®ƒäº¤ç»™äº† <code>StringCoding.encode</code>  å»è·å– <code>bytes</code> ã€‚ç„¶è€Œ <code>StringEncoder</code>  å»è°ƒç”¨äº† <code>StringEncoder</code>  çš„ç›¸åº”æ–¹æ³•è·å– <code>bytes</code> ã€</p>\n<p>2.Â  equals</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object anObject)</span> </span>&#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span> == anObject) &#123;Â Â  <span class=\"comment\">// å¦‚æœåœ°å€éƒ½ç›¸åŒçš„è¯ï¼Œé‚£è‚¯å®šå°±æ˜¯åŒä¸€ä¸ªäº†</span></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;Â </span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (anObject <span class=\"keyword\">instanceof</span> String) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  String anotherString = (String)anObject;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> n = value.length;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (n == anotherString.value.length) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> v1[] = value;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> v2[] = anotherString.value;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â <span class=\"keyword\">while</span> (n-- != <span class=\"number\">0</span>) &#123;Â  <span class=\"comment\">//ä¸é”™çš„ç¼–ç é£æ ¼ã€‚æ¯”forè¦å¥½ä¸€ç‚¹ï¼Ÿ</span></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (v1[i] != v2[i])</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  i++;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">Â Â Â  &#125;</span><br></pre></td></tr></table></figure>\n<p>3.Â  equalsIgnoreCase:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">equalsIgnoreCase</span><span class=\"params\">(String anotherString)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">return</span> (<span class=\"keyword\">this</span> == anotherString) ? <span class=\"keyword\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  Â Â : (anotherString != <span class=\"keyword\">null</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â  &amp;&amp; (anotherString.value.length == value.length)</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â  &amp;&amp; regionMatches(<span class=\"keyword\">true</span>, <span class=\"number\">0</span>, anotherString, <span class=\"number\">0</span>, value.length);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">regionMatches</span><span class=\"params\">(<span class=\"keyword\">boolean</span> ignoreCase, <span class=\"keyword\">int</span> toffset,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\"></span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">Â Â Â Â Â Â Â Â Â Â Â  String other, <span class=\"keyword\">int</span> ooffset, <span class=\"keyword\">int</span> len)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> ta[] = value;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> to = toffset;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> pa[] = other.value;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> po = ooffset;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"comment\">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> ((ooffset &lt; <span class=\"number\">0</span>) || (toffset &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  || (toffset &gt; (<span class=\"keyword\">long</span>)value.length - len)</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  || (ooffset &gt; (<span class=\"keyword\">long</span>)other.value.length - len)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">while</span> (len-- &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> c1 = ta[to++];</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> c2 = pa[po++];</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (c1 == c2) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (ignoreCase) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// If characters don&#x27;t match but case may be ignored,</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// try converting both characters to uppercase.</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// If the results match, then the comparison scan should</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// continue.</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> u1 = Character.toUpperCase(c1);</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> u2 = Character.toUpperCase(c2);</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (u1 == u2) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// Unfortunately, conversion to uppercase does not work properly</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// for the Georgian alphabet, which has strange rules about case</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// conversion.Â  So we need to make one last check before</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"comment\">// exiting.</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (Character.toLowerCase(u1) == Character.toLowerCase(u2)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â  &#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨ regionMatches ä¸­é¦–å…ˆå¯¹ä¼ å…¥çš„å‚æ•°ï¼Œè¿›è¡Œåˆæ³•æ€§åˆ¤æ–­ã€‚ç„¶åå–å‡ºæ¯ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”è¾ƒä¸€ä¸‹ï¼Œç›¸åŒå°±ä¸‹ä¸ªå­—ç¬¦ï¼Œä¸åŒï¼Œéƒ½è½¬æ¢æˆå¤§å†™ï¼Œæ¯”è¾ƒä¸€æ¬¡ï¼Œå¦‚æœç›¸åŒå°±æ¯”è¾ƒä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸ç›¸åŒå°±éƒ½è½¬åŒ–æˆå°å†™åœ¨æ¯”è¾ƒä¸€ä¸‹ã€‚è§£é‡Šæ˜¯è¯´ï¼šæœ‰æ—¶å€™ï¼Œè½¬å¤§å†™ä¸ä¸€å®šæ¯æ¬¡éƒ½ä¼šæ­£ç¡®ã€‚</p>\n<p>4.Â  startsWith:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">startsWith</span><span class=\"params\">(String prefix, <span class=\"keyword\">int</span> toffset)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> ta[] = value;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> to = toffset;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> pa[] = prefix.value;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> po = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> pc = prefix.value.length;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"comment\">// Note: toffset might be near -1&gt;&gt;&gt;1.</span></span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> ((toffset &lt; <span class=\"number\">0</span>) || (toffset &gt; value.length - pc)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">while</span> (--pc &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (ta[to++] != pa[po++]) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â  &#125;</span><br></pre></td></tr></table></figure>\n<p>5.Â  endsWith</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">endsWith</span><span class=\"params\">(String suffix)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â  <span class=\"keyword\">return</span> startsWith(suffix, value.length - suffix.value.length);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>6.Â  é‡ç‚¹æ¥äº†ï¼šhashCode</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> h = hash;Â  <span class=\"comment\">///å…ˆè·å–ç¼“å­˜ä¸­çš„hashå€¼ã€‚</span></span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">if</span>(h == <span class=\"number\">0</span> &amp;&amp; value.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> val[] = value;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; value.length; i++) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â  h = <span class=\"number\">31</span> * h + val[i];Â Â  <span class=\"comment\">// hashå€¼ç®—æ³•ã€‚31</span></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  hash = h;</span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> h;</span><br><span class=\"line\">Â Â Â  &#125;</span><br></pre></td></tr></table></figure>\n<p>7.Â  replace</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">replace</span><span class=\"params\">(<span class=\"keyword\">char</span> oldChar, <span class=\"keyword\">char</span> newChar)</span> </span>&#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (oldChar != newChar) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> len = value.length;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">int</span> i = -<span class=\"number\">1</span>;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span>[] val = value; <span class=\"comment\">/* avoid getfield opcode */</span></span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">while</span> (++i &lt; len) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (val[i] == oldChar) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">break</span>;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">if</span> (i &lt; len) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â <span class=\"keyword\">char</span> buf[] = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[len];</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; i; j++) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  buf[j] = val[j];</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">while</span> (i &lt; len) &#123;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">char</span> c = val[i];</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  buf[i] = (c == oldChar) ? newChar : c;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  i++;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> String(buf, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">Â Â Â Â Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â  &#125;</span><br><span class=\"line\">Â Â Â Â Â Â Â  <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">Â Â Â  &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "æºç ",
                "JDK",
                "JDK8",
                "String"
            ]
        },
        {
            "id": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/HashMap/HashMap/",
            "url": "https://fangjiaxiaobai.github.io/2021/07/15/JDK%E6%BA%90%E7%A0%81/HashMap/HashMap/",
            "title": "å…¨ç½‘æœ€å…¨çš„ HashMap æºç è§£è¯»",
            "date_published": "2021-07-15T06:48:55.000Z",
            "content_html": "<h2 id=\"è¦æ€è€ƒçš„é—®é¢˜\"><a class=\"markdownIt-Anchor\" href=\"#è¦æ€è€ƒçš„é—®é¢˜\">#</a> è¦æ€è€ƒçš„é—®é¢˜</h2>\n<ul>\n<li>HashMap çš„åº•å±‚æ•°æ®ç»“æ„ (èŠ‚ç‚¹ç»“æ„ï¼Œè¿™ç§ç»“æ„æœ‰ä»€ä¹ˆä¼˜ç‚¹)</li>\n<li>å¦‚ä½•å¤„ç† hash å†²çª</li>\n<li>æ€ä¹ˆæ‰©å®¹ï¼Ÿæ‰©å±•æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>å¢åˆ æ”¹æŸ¥è¿‡ç¨‹</li>\n<li>é“¾è¡¨åˆ°çº¢é»‘æ ‘çš„è½¬æ¢è¿‡ç¨‹ï¼Œåä¹‹ï¼Ÿ</li>\n<li>çº¢é»‘æ ‘ç›¸å…³ (è§å¦ä¸€ç¯‡æ•°æ®ç»“æ„ä¹‹çº¢é»‘æ ‘)</li>\n<li>hash è®¡ç®—</li>\n</ul>\n<h2 id=\"è¾¾åˆ°çš„ç›®æ ‡\"><a class=\"markdownIt-Anchor\" href=\"#è¾¾åˆ°çš„ç›®æ ‡\">#</a> è¾¾åˆ°çš„ç›®æ ‡</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_0\" checked=\"true\" disabled=\"true\"><label for=\"cbx_0\"> æŒæ¡åº•å±‚æ•°æ®ç»“æ„</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_1\" checked=\"true\" disabled=\"true\"><label for=\"cbx_1\"> æŒæ¡æ‰©å®¹åŸç†</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_2\" checked=\"true\" disabled=\"true\"><label for=\"cbx_2\"> æŒæ¡ hash å†²çªçš„å¤„ç†è¿‡ç¨‹</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_3\" checked=\"true\" disabled=\"true\"><label for=\"cbx_3\"> æŒæ¡å¢åˆ æ”¹æŸ¥è¿‡ç¨‹</label></li>\n</ul>\n<h2 id=\"çœ‹ä¹‹å‰è¦æŒæ¡çš„çŸ¥è¯†ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#çœ‹ä¹‹å‰è¦æŒæ¡çš„çŸ¥è¯†ç‚¹\">#</a> çœ‹ä¹‹å‰è¦æŒæ¡çš„çŸ¥è¯†ç‚¹</h2>\n<h3 id=\"çº¢é»‘æ ‘\"><a class=\"markdownIt-Anchor\" href=\"#çº¢é»‘æ ‘\">#</a> çº¢é»‘æ ‘</h3>\n<h2 id=\"çœ‹ä¹‹å‰å¤§ä½“äº†è§£çš„çŸ¥è¯†ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#çœ‹ä¹‹å‰å¤§ä½“äº†è§£çš„çŸ¥è¯†ç‚¹\">#</a> çœ‹ä¹‹å‰å¤§ä½“äº†è§£çš„çŸ¥è¯†ç‚¹</h2>\n<h3 id=\"hashç®—æ³•\"><a class=\"markdownIt-Anchor\" href=\"#hashç®—æ³•\">#</a> hash ç®—æ³•</h3>\n<h3 id=\"poissonåˆ†å¸ƒ\"><a class=\"markdownIt-Anchor\" href=\"#poissonåˆ†å¸ƒ\">#</a> Poisson åˆ†å¸ƒ</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Qb2lzc29uX2Rpc3RyaWJ1dGlvbg==\">poisson åˆ†å¸ƒ</span></p>\n<h2 id=\"å¼€å§‹\"><a class=\"markdownIt-Anchor\" href=\"#å¼€å§‹\">#</a> å¼€å§‹</h2>\n<h3 id=\"hashmapçš„ç»§æ‰¿ä½“ç³»\"><a class=\"markdownIt-Anchor\" href=\"#hashmapçš„ç»§æ‰¿ä½“ç³»\">#</a> HashMap çš„ç»§æ‰¿ä½“ç³»</h3>\n<p><img data-src=\"/images/JavaSourceCode/HashMap/HashMap01-%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB.png\" alt=\"HashMap01-ç»§æ‰¿ä½“ç³».png\"></p>\n<ul>\n<li>AbstractMap: map çš„æŠ½è±¡ç±»ï¼Œä»¥æœ€å¤§é™åº¦çš„å‡å°‘å®ç° Map æ¥å£çš„ç±»çš„å·¥ä½œé‡ã€‚</li>\n</ul>\n<h3 id=\"hashmapç»“æ„\"><a class=\"markdownIt-Anchor\" href=\"#hashmapç»“æ„\">#</a> hashMap ç»“æ„</h3>\n<h3 id=\"å­—æ®µè§£é‡Š\"><a class=\"markdownIt-Anchor\" href=\"#å­—æ®µè§£é‡Š\">#</a> å­—æ®µè§£é‡Š</h3>\n<h4 id=\"å¸¸é‡å­—æ®µé»˜è®¤å€¼å­—æ®µ\"><a class=\"markdownIt-Anchor\" href=\"#å¸¸é‡å­—æ®µé»˜è®¤å€¼å­—æ®µ\">#</a> å¸¸é‡å­—æ®µ (é»˜è®¤å€¼å­—æ®µ)</h4>\n<ul>\n<li>DEFAULT_INITIAL_CAPACITY=1&lt;&lt;4: é»˜è®¤çš„åˆå§‹å®¹é‡ï¼Œé»˜è®¤æ˜¯ä¸º 16, å¿…é¡»æ˜¯ 2 çš„ n æ¬¡æ–¹ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè§æ‰©å®¹çš„æ–¹æ³•ã€‚</li>\n<li>DEFAULT_LOAD_FACTOR=0.75f: é»˜è®¤çš„è´Ÿè½½å› å­ã€‚å®ƒå’Œå“ˆå¸Œè¡¨çš„å®¹é‡çš„ä¹˜ç§¯æ˜¯å†³å®šæ˜¯å¦é‡æ–° hash çš„é˜ˆå€¼ã€‚</li>\n<li>TREEIFY_THRESHOLD=8: ä½¿ç”¨æ ‘è€Œä¸æ˜¯é“¾è¡¨çš„è®¡æ•°é˜ˆå€¼ã€‚å½“æ¡¶çš„å…ƒç´ æ·»åŠ åˆ°å…·æœ‰è‡³å°‘è¿™ä¹ˆå¤šèŠ‚ç‚¹æ—¶ï¼Œæ¡¶è¢«è½¬æ¢ä¸ºæ ‘ã€‚</li>\n<li>UNTREEIFY_THRESHOLD=6: ç”¨äºåœ¨è°ƒæ•´å¤§å°æ“ä½œæœŸé—´è§£é™¤ï¼ˆæ‹†åˆ†ï¼‰æ¡¶çš„æ¡¶è®¡æ•°é˜ˆå€¼ã€‚(untreeifying ä¸æ˜¯ä¸€ä¸ªè‹±è¯­å•è¯ï¼Œè¿™é‡Œçš„ä»¥æ˜¯éæ ‘åŒ–ï¼Œå³è½¬æ¢æˆæ™®é€šåˆ—è¡¨çš„è¿‡ç¨‹). ä¹Ÿå°±æ˜¯è¯´ä»æ ‘è½¬æ¢æˆæ™®é€šçš„æ¡¶ (é“¾è¡¨) çš„é˜ˆå€¼ã€‚</li>\n<li>MAXIMUM_CAPACITY=1&lt;&lt;30: æœ€å¤§çš„å®¹é‡:  <code>1&lt;&lt;30</code> ï¼Œå¦‚æœå…·æœ‰å‚æ•°çš„ä»»ä¸€æ„é€ å‡½æ•°éšå¼æŒ‡å®šæ›´é«˜çš„å€¼ï¼Œåˆ™ä½¿ç”¨æ­¤å‚æ•°ã€‚å¿…é¡»æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œå°äºç­‰äº <code>1&lt;&lt;30</code></li>\n<li>MIN_TREEIFY_CAPACITY=64: å®¹å™¨å¯ä»¥æ ‘åŒ–çš„æœ€å°å®¹é‡ (å¦åˆ™ï¼Œå¦‚æœ bin ä¸­çš„èŠ‚ç‚¹å¤ªå¤šï¼Œåˆ™ä¼šè°ƒæ•´è¡¨çš„å¤§å°.) åº”è¯¥è‡³å°‘ä¸º 4 * TREEIFY_THRESHOLDï¼Œä»¥é¿å…è°ƒæ•´å¤§å°å’Œæ ‘åŒ–é˜ˆå€¼ä¹‹é—´çš„å†²çª.</li>\n</ul>\n<h4 id=\"ç±»å±æ€§\"><a class=\"markdownIt-Anchor\" href=\"#ç±»å±æ€§\">#</a> ç±»å±æ€§</h4>\n<ul>\n<li>table:  <code>transient HashMap.Node&lt;K,V&gt;[] table</code> ; table åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ï¼Œå¹¶æ ¹æ®éœ€è¦è°ƒæ•´å¤§å°ã€‚åˆ†é…æ—¶ï¼Œé•¿åº¦å§‹ç»ˆæ˜¯ 2 çš„å¹‚ã€‚(æˆ‘ä»¬è¿˜åœ¨ä¸€äº›æ“ä½œä¸­å®¹å¿é•¿åº¦ä¸ºé›¶ï¼Œä»¥å…è®¸å½“å‰ä¸éœ€è¦çš„è‡ªä¸¾æœºåˆ¶)</li>\n<li>entrySet:  <code>transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet</code> ; ä¿å­˜ç¼“å­˜çš„ entrySet.</li>\n<li>size:  <code>transient int size</code> ; map ä¸­å…ƒç´ çš„æ•°é‡ã€‚ç»“æ„ä¿®æ”¹æ˜¯é‚£äº›æ”¹å˜ HashMap ä¸­æ˜ å°„æ•°é‡æˆ–ä»¥å…¶ä»–æ–¹å¼ä¿®æ”¹å…¶å†…éƒ¨ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œrehashï¼‰çš„ä¿®æ”¹ã€‚æ­¤å­—æ®µç”¨äºåœ¨ HashMap çš„ Collection-views ä¸Šå¿«é€Ÿç”Ÿæˆè¿­ä»£å™¨ (è§ ConcurrentModificationException)</li>\n</ul>\n<hr>\n<p>æ³¨æ„ï¼šè¿™äº›å­—æ®µéƒ½æ˜¯  <code>transient</code>  çš„ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<ul>\n<li>loadFactor:  <code>final float loadFactor;</code>  hash è¡¨çš„è´Ÿè½½å› å­ï¼Œåœ¨å®ä¾‹åŒ– hashTable çš„æ—¶å€™æŒ‡å®šï¼Œè¯¥å¯¹è±¡å†…ä¸èƒ½å˜æ›´ (final);</li>\n<li>threshold:  <code>int threshold;</code> , ä¸‹ä¸€æ¬¡è°ƒæ•´å®¹å™¨å¤§å°çš„é˜ˆå€¼. threshold=capacity * load factor</li>\n</ul>\n<h4 id=\"hashmapçš„ä¸¤ç§èŠ‚ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#hashmapçš„ä¸¤ç§èŠ‚ç‚¹\">#</a> HashMap çš„ä¸¤ç§èŠ‚ç‚¹</h4>\n<ul>\n<li>åŸºæœ¬çš„å“ˆå¸Œæ¡¶çš„èŠ‚ç‚¹ (é“¾è¡¨çš„ç»“ç‚¹) Node</li>\n</ul>\n<p><code>static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt;</code>  å®ƒç»§æ‰¿äº† Map çš„ Entry, æ˜¯å¯¹å­ç±»çš„è¡Œä¸ºè§„èŒƒã€‚è¦æ±‚æä¾›äº† getKey (),getValue () ç­‰å¸¸ç”¨æ–¹æ³•ã€‚</p>\n<p>é“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„å¦‚ä¸‹:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> hash; <span class=\"comment\">// é¿å…é‡å¤è®¡ç®—keyçš„hashå€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> K key;</span><br><span class=\"line\">    V value;</span><br><span class=\"line\">    <span class=\"comment\">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class=\"line\">    HashMap.Node&lt;K,V&gt; next;</span><br><span class=\"line\"></span><br><span class=\"line\">    Node(<span class=\"keyword\">int</span> hash, K key, V value, HashMap.Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hash = hash;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.key = key;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.next = next;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> K <span class=\"title\">getKey</span><span class=\"params\">()</span>        </span>&#123; <span class=\"keyword\">return</span> key; &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title\">getValue</span><span class=\"params\">()</span>      </span>&#123; <span class=\"keyword\">return</span> value; &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> key + <span class=\"string\">&quot;=&quot;</span> + value; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// todo æ²¡æœ‰æ‰¾åˆ°åœ¨å“ªé‡Œä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title\">setValue</span><span class=\"params\">(V newValue)</span> </span>&#123;</span><br><span class=\"line\">        V oldValue = value;</span><br><span class=\"line\">        value = newValue;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o == <span class=\"keyword\">this</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o <span class=\"keyword\">instanceof</span> Map.Entry) &#123;</span><br><span class=\"line\">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class=\"line\">                    Objects.equals(value, e.getValue()))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Tree çš„èŠ‚ç‚¹ TreeNode</li>\n</ul>\n<p><code>static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt;</code>  ç»§æ‰¿äº†å…¶å­ç±»çš„ Entry, å­ç±»çš„ Entry ç»§æ‰¿äº†çˆ¶ç±»çš„ Node. æ³¨æ„äº†ï¼Œè¿™é‡Œä¹ä¸€çœ‹è¿˜æŒºä¹±ã€‚æ¥å¼ å›¾å§ã€‚<br>\n<img data-src=\"/images/JavaSourceCode/HashMap/hashMap%E7%9A%84%E8%8A%82%E7%82%B9%E7%9A%84%E7%BB%A7%E6%89%BF%E5%9B%BE.png\" alt=\"hashMapçš„èŠ‚ç‚¹çš„ç»§æ‰¿å›¾.png\"></p>\n<p>è¿™é‡Œå‘¢ï¼ŒTreeNode å…¶å®æ˜¯ Node çš„å­™å­ï¼Œä¹Ÿå°±æ˜¯è¯´ HashMap çš„æ ‘èŠ‚ç‚¹æ˜¯é“¾è¡¨èŠ‚ç‚¹çš„å­™å­è¾ˆå„¿çš„ã€‚<br>\nä¸ºä»€ä¹ˆè¦ä½¿ä¸¤ç§èŠ‚ç‚¹æœ‰ç»§æ‰¿å…³ç³»å‘¢ï¼Ÿä¸ºä»€ä¹ˆ TreeNode ä¸ç›´æ¥ç»§æ‰¿ Node èŠ‚ç‚¹å‘¢ï¼Ÿ</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TreeNode</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">LinkedHashMap</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K,V&gt; parent;  <span class=\"comment\">// red-black tree links</span></span><br><span class=\"line\">    HashMap.TreeNode&lt;K,V&gt; left;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K,V&gt; right;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K,V&gt; prev;    <span class=\"comment\">// needed to unlink next upon deletion</span></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> red;</span><br><span class=\"line\">    TreeNode(<span class=\"keyword\">int</span> hash, K key, V val, HashMap.Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(hash, key, val, next);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// çœç•¥å…¶ä»–ä»£ç </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"hashmapå¢åŠ æ–¹æ³•-hashmapput\"><a class=\"markdownIt-Anchor\" href=\"#hashmapå¢åŠ æ–¹æ³•-hashmapput\">#</a> HashMap å¢åŠ æ–¹æ³• HashMap#put ()</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">*  å°†æŒ‡å®šçš„valueå’Œkeyå…³è”åœ¨mapä¸­ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">*  å¦‚æœmapä¸­å·²ç»å­˜åœ¨äº†key,é‚£ä¹ˆå°†ä¼šæ›¿æ¢æ‰è€çš„valueã€‚</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> key key æŒ‡å®šçš„key</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> value value å’ŒæŒ‡å®škeyå…³è”çš„value</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@return</span> å¦‚æœè¿”å›äº†valueï¼Œå°±è¯´æ˜mapä¸­åŸæ¥å’Œkeyå…³è”æ˜¯æœ‰å€¼çš„ã€‚å¦‚æœè¿”å›nullå°±è¯´æ˜æ²¡æœ‰valueã€‚</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> putVal(hash(key), key, value, <span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œå°±æ¯”è¾ƒæœ‰çœ‹ç‚¹äº†ï¼Œ1. è¿™é‡Œæ˜¯ hashMap çš„å¢åŠ æ–¹æ³•ï¼Œå¢åŠ æ–¹æ³•é‡Œå¿…ç„¶ä¼šé‡åˆ° hash å†²çªçš„é—®é¢˜ï¼Œæˆ‘ä»¬ç­‰ä¼šçœ‹ä¸‹ hash å†²çªæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Œè¿˜ä¼šæ¶‰åŠåˆ°æ‰©å®¹çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ¥çœ‹çœ‹ä»–æ˜¯æ€ä¹ˆæ‰©å®¹çš„ï¼Œæ‰©å®¹çš„è¿‡ç¨‹ä¸­è¿˜ä¼šé‡åˆ°æ™®é€šçš„æ¡¶è½¬æ¢æˆæ ‘çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ hash å€¼æ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ã€‚</p>\n<ul>\n<li TODO=\"\" å’Œjdk1.7ä¸­çš„æ¯”è¾ƒ=\"\"><code>hash</code>  å€¼çš„è®¡ç®—</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * è®¡ç®—keyçš„hashCodeå¹¶ä¸”å’ŒhashCodeå€¼é«˜16ä½è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚(å¼‚æˆ–: ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1)</span></span><br><span class=\"line\"><span class=\"comment\"> * æ··å’Œä½ä½å’Œé«˜ä½ï¼Œå°±æ˜¯ä¸ºäº†åŠ å¤§ä½ä½çš„éšæœºæ€§,è€Œä¸”æ··åˆåçš„ä½ä½æºæ‚äº†é«˜ä½çš„éƒ¨åˆ†ç‰¹å¾,</span></span><br><span class=\"line\"><span class=\"comment\"> * è¿™æ ·é«˜ä½çš„ä¿¡æ¯ä¹Ÿè¢«å˜ç›¸çš„ä¿ç•™äº†ä¸‹æ¥ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">hash</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> h;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (key == <span class=\"keyword\">null</span>) ? <span class=\"number\">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class=\"number\">16</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿè§<a href=\"/2021/07/15/source%20code/HashMap/HashMap%E7%9A%84Hash%E5%87%BD%E6%95%B0%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E6%84%8F%E4%B9%89/\"> HashMap çš„ Hash å‡½æ•°åˆ°åº•æœ‰ä»€ä¹ˆæ„ä¹‰</a></p>\n<ul>\n<li>é‚£æˆ‘ä»¬æ¥ä¸‹æ¥ç€çœ‹ <code>putVal()</code>  æ–¹æ³•ã€‚</li>\n</ul>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å®ç°Map.putç›¸å…³çš„æ–¹æ³•ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash hash for key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key the key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value the value to put</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> onlyIfAbsent if true, don&#x27;t change existing value</span></span><br><span class=\"line\"><span class=\"comment\"> *                     å¦‚æœæ˜¯trueçš„,ä¸ä¼šä¿®æ”¹å­˜åœ¨çš„å€¼ã€‚è¿”å›è€çš„å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> evict if false, the table is in creation mode.</span></span><br><span class=\"line\"><span class=\"comment\"> *              å¦‚æœä¸ºfalseçš„æ—¶å€™,è¡¨å±äºåˆ›å»ºæ¨¡å¼,ç¬¬ä¸€æ¬¡æ–°å¢å…ƒç´ çš„æ—¶å€™ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> previous value, or null if none</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> V <span class=\"title\">putVal</span><span class=\"params\">(<span class=\"keyword\">int</span> hash, K key, V value, <span class=\"keyword\">boolean</span> onlyIfAbsent,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                <span class=\"keyword\">boolean</span> evict)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    HashMap.Node&lt;K,V&gt;[] tab;</span><br><span class=\"line\">    HashMap.Node&lt;K,V&gt; p;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n, i;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) == <span class=\"keyword\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ•°ç»„ä¸ºnull,æˆ–è€…æ•°ç»„é•¿åº¦ä¸º0çš„æ—¶å€™ï¼Œæ•°ç»„éœ€è¦è°ƒæ•´å¤§å°ã€‚</span></span><br><span class=\"line\">        n = (tab = resize()).length;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((p = tab[i = (n - <span class=\"number\">1</span>) &amp; hash]) == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"comment\">// å®šä½åˆ°æ•°ç»„çš„æ¡¶ä¸ºnullçš„æ—¶å€™,åˆ›å»ºæ¡¶å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚next=null;</span></span><br><span class=\"line\">        tab[i] = newNode(hash, key, value, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ¡¶ä¸ä¸ºnullï¼Œåˆ™åˆ›å»ºé“¾è¡¨</span></span><br><span class=\"line\">        HashMap.Node&lt;K,V&gt; e; K k;</span><br><span class=\"line\">        <span class=\"comment\">// pè¡¨ç¤ºå½“å‰æ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</span></span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ–°å¢çš„å…ƒç´ å’Œç¬¬ä¸€ä¸ªå…ƒç´ ç›¸ç­‰çš„è¯(å‡ºç°hashå†²çª),æš‚å­˜å·²ç»å­˜åœ¨çš„å…ƒç´ åˆ°å˜é‡eä¸­ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">                ((k = p.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            e = p;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> HashMap.TreeNode)</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">            e = ((HashMap.TreeNode&lt;K,V&gt;)p).putTreeVal(<span class=\"keyword\">this</span>, tab, hash, key, value);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// é“¾è¡¨å…ƒç´ æ–°å¢çš„è¿‡ç¨‹äº†ã€‚</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> binCount = <span class=\"number\">0</span>; ; ++binCount) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((e = p.next) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    p.next = newNode(hash, key, value, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class=\"number\">1</span>)</span><br><span class=\"line\">                        <span class=\"comment\">// å¦‚æœæ¡¶å†…çš„å…ƒç´ æ•°é‡è¾¾åˆ°æ ‘åŒ–çš„é˜ˆå€¼,å°†é“¾è¡¨è½¬æ¢æˆæ ‘ã€‚</span></span><br><span class=\"line\">                        treeifyBin(tab, hash);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                    <span class=\"comment\">// å¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ å’Œè¦æ–°å¢çš„å…ƒç´ hash,keyéƒ½ç›¸ç­‰çš„è¯,ç›´æ¥è¿›è¡Œæ–°å¢æ“ä½œã€‚</span></span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                p = e;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e != <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// existing mapping for key</span></span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœåŸæ¥çš„å…ƒç´ ä¸ä¸ºç©º,ä¿ç•™åŸæ¥çš„å€¼ã€‚</span></span><br><span class=\"line\">            V oldValue = e.value;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!onlyIfAbsent || oldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                <span class=\"comment\">// è¦†ç›–æ‰åŸæ¥çš„value;</span></span><br><span class=\"line\">                e.value = value;</span><br><span class=\"line\">            <span class=\"comment\">// ç•™ä¸€ä¸ªæ— æ–¹æ³•ä½“çš„æ–¹æ³•ï¼Œä¾›å­ç±»æ‰©å±•</span></span><br><span class=\"line\">            afterNodeAccess(e);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// failFastè®¡æ•°</span></span><br><span class=\"line\">    ++modCount;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (++size &gt; threshold)</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœtableä¸­çš„æ¡¶çš„æ•°é‡è¶…è¿‡äº†é˜ˆå€¼ã€‚æ‰©å®¹ã€‚</span></span><br><span class=\"line\">        resize();</span><br><span class=\"line\">    <span class=\"comment\">// ä¾›å­ç±»æ‰©å±•çš„æ–¹æ³•ã€‚</span></span><br><span class=\"line\">    afterNodeInsertion(evict);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ®µä»£ç é‡Œä¸­æœ‰ä¸‰å¤„é‡è¦çš„åœ°æ–¹ï¼Œ <code>resize()</code> , <code>treeifyBin()</code> , <code>putTreeNode()</code> , æ¥ä¸‹æ¥æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚</p>\n<h4 id=\"resize\"><a class=\"markdownIt-Anchor\" href=\"#resize\">#</a> resize</h4>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åˆå§‹åŒ–ï¼Œæˆ–è€…åŠ å€è¡¨æ ¼çš„å¤§å°</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦‚æœä¸ºnullæ—¶å€™ï¼Œæ ¹æ®å­—æ®µthresholdçš„åˆå§‹å®¹é‡è¿›è¡Œåˆ†é…</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦åˆ™ï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨äºŒæ¬¡å¹‚æ‰©å±•ï¼Œæ‰€ä»¥æ¯ä¸ªbinä¸­çš„å…ƒç´ å¿…é¡»ä¿æŒç›¸åŒçš„ç´¢å¼•ï¼Œæˆ–è€…åœ¨æ–°è¡¨ä¸­ä»¥ä¸¤ä¸ªåç§»çš„å¹‚ç§»åŠ¨</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> the table æ–°çš„è¡¨</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> HashMap.Node&lt;K, V&gt;[] resize() &#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt;[] oldTab = table;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldCap = (oldTab == <span class=\"keyword\">null</span>) ? <span class=\"number\">0</span> : oldTab.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> oldThr = threshold;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> newCap, newThr = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldCap &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ—§è¡¨çš„å¤§å°å¤§äº0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// hashè¡¨è¾¾åˆ°æœ€å¤§å®¹é‡</span></span><br><span class=\"line\">            threshold = Integer.MAX_VALUE;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldTab;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((newCap = oldCap &lt;&lt; <span class=\"number\">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class=\"line\">                oldCap &gt;= DEFAULT_INITIAL_CAPACITY) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœç¿»å€åæ—§è¡¨å¤§å°&lt;æœ€å¤§è¡¨é•¿åº¦ï¼Œå¹¶ä¸”æ—§è¡¨é•¿åº¦&gt;é»˜è®¤åˆå§‹åŒ–é•¿åº¦ã€‚</span></span><br><span class=\"line\">            <span class=\"comment\">// æ‰©å®¹çš„é˜ˆå€¼ä¹Ÿç¿»å€ã€‚ è¿˜æ˜¯ç­‰çº§ table.length*loadFactor</span></span><br><span class=\"line\">            newThr = oldThr &lt;&lt; <span class=\"number\">1</span>; <span class=\"comment\">// double threshold</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldThr &gt; <span class=\"number\">0</span>) &#123; <span class=\"comment\">// initial capacity was placed in threshold</span></span><br><span class=\"line\">        <span class=\"comment\">// æ—§è¡¨é•¿åº¦&lt;=0,æ—§çš„threshold&gt;0,</span></span><br><span class=\"line\">        <span class=\"comment\">// å°±æŠŠthresholdè®¾ç½®ä¸ºè¡¨é•¿åº¦ã€‚</span></span><br><span class=\"line\">        newCap = oldThr;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;               <span class=\"comment\">// zero initial threshold signifies using defaults</span></span><br><span class=\"line\">        <span class=\"comment\">// è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚</span></span><br><span class=\"line\">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class=\"line\">        newThr = (<span class=\"keyword\">int</span>) (DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newThr == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœæ–°çš„æ‰©ç¼©å®¹é˜ˆå€¼ç­‰äº0,è®¾ç½®æ–°çš„æ‰©ç¼©å®¹é˜ˆå€¼ä¸ºæ–°çš„å®¹é‡*è´Ÿè½½å› å­.</span></span><br><span class=\"line\">        <span class=\"keyword\">float</span> ft = (<span class=\"keyword\">float</span>) newCap * loadFactor;</span><br><span class=\"line\">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class=\"keyword\">float</span>) MAXIMUM_CAPACITY ?</span><br><span class=\"line\">                (<span class=\"keyword\">int</span>) ft : Integer.MAX_VALUE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    threshold = newThr;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// é‡æ–°åˆ›å»ºæ–°çš„hashè¡¨</span></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings(&#123;&quot;rawtypes&quot;, &quot;unchecked&quot;&#125;)</span></span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt;[] newTab = (HashMap.Node&lt;K, V&gt;[]) <span class=\"keyword\">new</span> HashMap.Node[newCap];</span><br><span class=\"line\">    table = newTab;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ—§è¡¨ä¸ä¸ºç©º,è¿›è¡Œæ‰©å®¹.</span></span><br><span class=\"line\">    <span class=\"comment\">// å¦åˆ™(æ—§è¡¨ä¸ºç©º)å°±è¿›è¡Œåˆå§‹åŒ–è¿‡ç¨‹.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (oldTab != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class=\"line\">            HashMap.Node&lt;K, V&gt; e;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((e = oldTab[j]) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                oldTab[j] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.next == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// å¦‚æœå½“å‰æ¡¶åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                    newTab[e.hash &amp; (newCap - <span class=\"number\">1</span>)] = e;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> HashMap.TreeNode) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// å¦‚æœå½“å‰æ¡¶æ˜¯æ£µçº¢é»‘æ ‘</span></span><br><span class=\"line\">                    ((HashMap.TreeNode&lt;K, V&gt;) e).split(<span class=\"keyword\">this</span>, newTab, j, oldCap);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// preserve order</span></span><br><span class=\"line\">                    <span class=\"comment\">// æ¡¶æ˜¯é“¾è¡¨,å°†è¯¥æ¡¶å†…çš„å…ƒç´ é‡æ–°åˆ†é…åˆ°è¡¨ä¸­ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    HashMap.Node&lt;K, V&gt; loHead = <span class=\"keyword\">null</span>, loTail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                    HashMap.Node&lt;K, V&gt; hiHead = <span class=\"keyword\">null</span>, hiTail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                    HashMap.Node&lt;K, V&gt; next;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// éå†æ¡¶å†…çš„å…ƒç´ ï¼Œå°†å…ƒç´ é‡æ–°åˆ†é…åˆ°hashè¡¨å†…çš„å„ä¸ªæ¡¶ä¸­ã€‚</span></span><br><span class=\"line\">                    <span class=\"comment\">// å…·ä½“çš„å®ç°è¿‡ç¨‹æ˜¯: å°†å½“å‰çš„å…ƒç´ çš„hashå€¼å’Œå®¹é‡å–&amp;,å¦‚æœ&gt;0,é‚£å°±è¯´æ˜è¯¥å…ƒç´ åº”è¯¥åˆ†é…åˆ°æ–°çš„æ¡¶å†…ã€‚</span></span><br><span class=\"line\">                    <span class=\"comment\">// æ¡¶çš„ä½ç½®å°±æ˜¯: oldCap+j.å³æ¡¶åŸæ¥å®¹å™¨+è¯¥å…ƒç´ æ‰€åœ¨çš„æ¡¶çš„ä¸‹æ ‡ã€‚(hiHeadæ‰€æ ‡è¯†çš„ä½ç½®)</span></span><br><span class=\"line\">                    <span class=\"comment\">// åä¹‹å¦‚æœhashå€¼æ˜¯==0çš„,é‚£ä¹ˆè¯¥å…ƒç´ å°±åº”è¯¥è¿˜åœ¨å½“å‰æ¡¶å†…ã€‚(loHeadæ‰€æ ‡è¯†çš„ä½ç½®)</span></span><br><span class=\"line\">                    <span class=\"comment\">// è¿™é‡Œæ‰€è¯´çš„ä½ç½®éƒ½æ˜¯æŒ‡æ¡¶çš„ä¸‹æ ‡,æ•´ä¸ªè¡¨éƒ½æ˜¯æ–°çš„äº†,ä½ç½®è‚¯å®šéƒ½å˜äº†ã€‚</span></span><br><span class=\"line\">                    <span class=\"comment\">// ä¸ºä»€ä¹ˆå¯ä»¥è¿™ä¹ˆå®ç°å‘¢ï¼Ÿ</span></span><br><span class=\"line\">                    <span class=\"comment\">// å› ä¸ºæ‰©å®¹çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯åŸæ¥å®¹é‡çš„2å€è¿›è¡Œæ‰©å®¹çš„ã€‚æ‰€ä»¥å°±å¯ä»¥ä½¿ç”¨(oldCap+j)çš„æ–¹å¼æ¥ç¡®å®šå…ƒç´ çš„æ–°ä½ç½®äº†ã€‚</span></span><br><span class=\"line\">                    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                        next = e.next;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> ((e.hash &amp; oldCap) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                            <span class=\"comment\">// è¿˜åœ¨åŸæ¡¶ä¸­</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (loTail == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                                loHead = e;</span><br><span class=\"line\">                            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"comment\">// ä½ç½®æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º,ä½¿ç”¨e=nextçš„æ—¶å€™ï¼Œnextä¸ºnullçš„æƒ…å†µã€‚</span></span><br><span class=\"line\">                                <span class=\"comment\">// åœ¨æ¡¶å†…å…ƒç´ éå†å®Œæˆå,ä¼šæŠŠæ¡¶çš„æœ€åä¸€ä¸ªå…ƒç´ çš„nextç½®ä¸ºnullã€‚</span></span><br><span class=\"line\">                                loTail.next = e;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            loTail = e;</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"comment\">// æ”¾ç½®åˆ°æ–°çš„æ¡¶å†…ã€‚</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (hiTail == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                                hiHead = e;</span><br><span class=\"line\">                            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"comment\">// ä½ç½®æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º,ä½¿ç”¨e=nextçš„æ—¶å€™ï¼Œnextä¸ºnullçš„æƒ…å†µã€‚</span></span><br><span class=\"line\">                                <span class=\"comment\">// åœ¨æ¡¶å†…å…ƒç´ éå†å®Œæˆå,ä¼šæŠŠæ¡¶çš„æœ€åä¸€ä¸ªå…ƒç´ çš„nextç½®ä¸ºnullã€‚</span></span><br><span class=\"line\">                                hiTail.next = e;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            hiTail = e;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">while</span> ((e = next) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (loTail != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        loTail.next = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                        <span class=\"comment\">// åŸæ¥æ¡¶çš„ä½ç½®ã€‚</span></span><br><span class=\"line\">                        newTab[j] = loHead;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (hiTail != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        hiTail.next = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                        <span class=\"comment\">// ç¡®å®šæ–°æ¡¶çš„ä½ç½®</span></span><br><span class=\"line\">                        newTab[j + oldCap] = hiHead;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> newTab;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>çœ‹ä¸€ä¸ªæ•£åˆ—è¿˜ç®—éå¸¸å‡åŒ€çš„ä¾‹å­æ¥çœ‹æ‰©å®¹è¿‡ç¨‹ã€‚</p>\n<p><img data-src=\"/images/JavaSourceCode/HashMap/hashMap04-Put%E6%96%B9%E6%B3%95%E8%BF%87%E7%A8%8B01.png\" alt=\"hashMap04-Putæ–¹æ³•è¿‡ç¨‹01.png\"></p>\n<p>é‚£ä¹ˆè¿›è¡Œæ‰©å®¹çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p>\n<p><img data-src=\"/images/JavaSourceCode/HashMap/hashMap05-resize%E6%96%B9%E6%B3%9501.png\" alt=\"hashMap05-resizeæ–¹æ³•01.png\"></p>\n<p>ä»¥å…ƒç´  1 å’Œ 12 ä¸ºä¾‹ï¼Œçœ‹æ‰©å®¹è¿‡ç¨‹:<br>\n å…ƒç´  1 çš„ hash å€¼ä¸º 49.(ä»¥ hashMap è®¡ç®— hash å€¼çš„æ–¹å¼å¾—å‡ºã€‚)ï¼Œ ä¸ 15 å– &amp; è®¡ç®—æ¡¶çš„ä¸‹æ ‡ä¸º 1, æ‰©å®¹åï¼Œä¸ 31 å– &amp;, è®¡ç®—æ¡¶çš„ä¸‹æ ‡ä¸º 17. æ‰€ä»¥æ‰©å®¹å‰ä½ç½®æ˜¯ 0ï¼Œæ‰©å®¹åå…ƒç´  1 çš„å­˜æ”¾ä½ç½®æ˜¯ 17ã€‚<br>\nä»£ç ä¸­æ˜¯æ€ä¹ˆå®Œæˆè¿™ä¸ªè¿‡ç¨‹çš„å‘¢ï¼Ÿ<br>\nå’Œæ‰©å®¹å‰ hash è¡¨çš„å®¹é‡å– &amp;, å¾—  <code>49 &amp; 16 = 16 &gt; 0</code>  (ä»£ç ç¬¬ 86-96 è¡Œ), æ–°çš„æ¡¶çš„å¤´èŠ‚ç‚¹ (å¯¹åº”ä»£ç é‡Œçš„ hiHead) å°±æ˜¯å½“å‰èŠ‚ç‚¹ 1ï¼Œå°¾èŠ‚ç‚¹ (hiTail) èµ‹ä¸ºå½“å‰èŠ‚ç‚¹ã€‚ç„¶åè¿›è¡Œä¸‹ä¸€æ¬¡ <code>do...while</code>  å¾ªç¯ï¼Œå¤„ç†èŠ‚ç‚¹ 12, è®¡ç®—å‡ºèŠ‚ç‚¹ 12 çš„ hash å€¼ä¸º <code>1569</code> , è¿›è¡Œè®¡ç®— <code>1569 &amp; 16 = 0 == 0</code>  åŸæ¥æ¡¶çš„å¤´ç»“ç‚¹æ˜¯èŠ‚ç‚¹ 12, å°¾èŠ‚ç‚¹ä¹Ÿæ˜¯èŠ‚ç‚¹ 12 (å¯¹åº”ç€ä»£ç ç¬¬ 76-86 è¡Œ), è¿™æ · hitail å’Œ loTail å‡ä¸ä¸º null, æ‰€ä»¥ç„¶åç›´æ¥ä½¿ç”¨ <code>newTab[j] = loHead;</code>  å’Œ  <code>newTab[j + oldCap] = hiHead;</code>  çš„æ–¹å¼ç¡®å®šæ¡¶çš„ä½ç½®ã€‚è¿™ä¸ªæ¡ˆä¾‹é‡Œï¼Œå¤„ç†å®ŒèŠ‚ç‚¹ 12 æ‰ä¼šç¡®å®šæ¡¶çš„ä½ç½®ã€‚å› ä¸ºåŸæ¥çš„è¡¨ä¸­ä¸‹æ ‡ä¸º 1 çš„æ¡¶ä¸­æœ‰ä¸¤ä¸ªå…ƒç´  1 å’Œ 12. é‚£æ¡¶é‡Œåªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ <code>newTab[e.hash &amp; (newCap - 1)] = e;</code>  e æ˜¯å½“å‰èŠ‚ç‚¹ï¼ŒnewCap æ˜¯æ–°è¡¨çš„å®¹é‡ã€‚</p>\n<blockquote>\n<p>å¦‚æœä½ æƒ³é—®ä¸ºä»€ä¹ˆèƒ½ä½¿ç”¨   <code>hash &amp; olcCap==0?</code>  æ¥å†³å®šæ˜¯ <code>newTab[j]</code>  è¿˜æ˜¯  <code>newTab[j+oldCap]</code>  è¿™ç§æ–¹å¼æ¥ç¡®å®šæ–°çš„æ¡¶çš„ä¸‹æ ‡çš„è¯ã€‚ é‚£ä¹ˆåŸå› å°±æ˜¯æ‰©å®¹ä½¿ç”¨çš„æ˜¯ 2 æ¬¡å¹‚çš„æ–¹å¼ï¼Œå®¹é‡æ˜¯åŸæ¥å®¹é‡çš„ 2 å€ã€‚æ‰€ä»¥å°±å¯ä»¥ä½¿ç”¨  <code>hash &amp; olcCap==0?</code>  æ¥åˆ¤æ–­äº†ã€‚</p>\n</blockquote>\n<p>è¿™ä¸ªä¾‹å­å‘¢ï¼Œæ¼”ç¤ºäº†æ‰©å®¹è¿‡ç¨‹ä¸­çš„é“¾è¡¨çš„æ–°å¢å’Œæ‰©å®¹è¿‡ç¨‹ã€‚å†å›å¤´çœ‹ resize æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µæˆ‘ä»¬æ²¡æœ‰åˆ†æè¿‡ã€‚é‚£å°±æ˜¯</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> HashMap.TreeNode) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœå½“å‰æ¡¶æ˜¯æ£µçº¢é»‘æ ‘</span></span><br><span class=\"line\">    ((HashMap.TreeNode&lt;K, V&gt;) e).split(<span class=\"keyword\">this</span>, newTab, j, oldCap);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * å°†åŸæ¥æ ‘æ¡¶ä¸­çš„èŠ‚ç‚¹æ‹†åˆ†ä¸ºæ›´ä½æˆ–æ›´é«˜çš„æ ‘æ¡¶,å¦‚æœå¤ªå°çš„è¯å°±è½¬åŒ–æˆé“¾è¡¨</span></span><br><span class=\"line\"><span class=\"comment\">    * åªè¢«resizeæ–¹æ³•è°ƒç”¨</span></span><br><span class=\"line\"><span class=\"comment\">    *</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> map   hashè¡¨</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> tab   è¡¨ä¸­çš„æŒ‡å®šçš„æ¡¶çš„å¤´ç»“ç‚¹(æ¡¶æ˜¯ä¸€ä¸ªæ£µæ ‘)</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> index è¦æ‹†åˆ†çš„hashè¡¨çš„èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> bit   the bit of hash to split on è¦åˆ†è£‚çš„hashä½</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">split</span><span class=\"params\">(HashMap&lt;K, V&gt; map, HashMap.Node&lt;K, V&gt;[] tab, <span class=\"keyword\">int</span> index, <span class=\"keyword\">int</span> bit)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K, V&gt; b = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"comment\">// Relink into lo and hi lists, preserving order</span></span><br><span class=\"line\">    HashMap.TreeNode&lt;K, V&gt; loHead = <span class=\"keyword\">null</span>, loTail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K, V&gt; hiHead = <span class=\"keyword\">null</span>, hiTail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// lcä»£è¡¨çš„æ˜¯åŸæ¥çš„æ¡¶çš„å…ƒç´ çš„æ•°é‡</span></span><br><span class=\"line\">    <span class=\"comment\">// hcä»£è¡¨æ–°çš„æ¡¶ä¸­çš„å…ƒç´ çš„æ•°é‡, ç”¨æ¥å’ŒUNTREEIFY_THRESHOLDæ¯”è¾ƒå†³å®šæ˜¯å¦è¦è½¬æ¢ç»“æ„.</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> lc = <span class=\"number\">0</span>, hc = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡Œè¿˜æ˜¯å½“åšé“¾è¡¨å»å¤„ç†ï¼ŒæŠŠæ¡¶å†…çš„å…ƒç´ é‡æ–°æ•£åˆ—ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (HashMap.TreeNode&lt;K, V&gt; e = b, next; e != <span class=\"keyword\">null</span>; e = next) &#123;</span><br><span class=\"line\">        next = (HashMap.TreeNode&lt;K, V&gt;) e.next;</span><br><span class=\"line\">        e.next = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((e.hash &amp; bit) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((e.prev = loTail) == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                loHead = e;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                loTail.next = e;</span><br><span class=\"line\">            loTail = e;</span><br><span class=\"line\">            ++lc;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((e.prev = hiTail) == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                hiHead = e;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                hiTail.next = e;</span><br><span class=\"line\">            hiTail = e;</span><br><span class=\"line\">            ++hc;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//  æ•£åˆ—å®Œåï¼Œåˆ¤æ–­åŸæ¥çš„æ¡¶(lo)å’Œæ–°çš„æ¡¶ä¸­çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class=\"line\">    <span class=\"comment\">//  ç„¶åå†³å®šè½¬æ¢ä¸ºæ ‘è¿˜æ˜¯é“¾è¡¨</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loHead != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (lc &lt;= UNTREEIFY_THRESHOLD)</span><br><span class=\"line\">            tab[index] = loHead.untreeify(map);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            tab[index] = loHead;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (hiHead != <span class=\"keyword\">null</span>) <span class=\"comment\">// (else is already treeified)</span></span><br><span class=\"line\">                loHead.treeify(tab);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hiHead != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (hc &lt;= UNTREEIFY_THRESHOLD)</span><br><span class=\"line\">            tab[index + bit] = hiHead.untreeify(map);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            tab[index + bit] = hiHead;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (loHead != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                hiHead.treeify(tab);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å°†æ ‘é‡æ–°ç©¿æ¢æˆé“¾è¡¨çš„è¿‡ç¨‹å°±æ¯”è¾ƒç®€å•äº†ï¼š</p>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * Returns a list of non-TreeNodes replacing those linked from</span></span><br><span class=\"line\"><span class=\"comment\">    * this node.</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> HashMap.<span class=\"function\">Node&lt;K, V&gt; <span class=\"title\">untreeify</span><span class=\"params\">(HashMap&lt;K, V&gt; map)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt; hd = <span class=\"keyword\">null</span>, tl = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (HashMap.Node&lt;K, V&gt; q = <span class=\"keyword\">this</span>; q != <span class=\"keyword\">null</span>; q = q.next) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// replacementNode:å°†TreeNodeè½¬æˆNode</span></span><br><span class=\"line\">        HashMap.Node&lt;K, V&gt; p = map.replacementNode(q, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tl == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            hd = p;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            tl.next = p;</span><br><span class=\"line\">        tl = p;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hd;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œå°±æ˜¯å’Œçº¢é»‘æ ‘ç›¸å…³çš„å†…å®¹äº†ï¼Œè¿™é‡Œå…³é”®çš„æ˜¯ split è°ƒç”¨äº†ä¸€ä¸ª treeify çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åŒæ—¶ä¹Ÿè¢« treeifyBin è°ƒç”¨äº†ã€‚æ‰€ä»¥ treeify æ–¹æ³•å°±å’Œ treeifyBin æ–¹æ³•ä¸€å—åˆ†äº«ã€‚<br>\né¡ºä¾¿æä¸€å˜´ï¼Œä»–ä»¬æœ‰å¦‚ä¸‹çš„å…³ç³»:</p>\n<p><img data-src=\"/images/JavaSourceCode/HashMap/hashMap06-%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB.png\" alt=\"hashMap06-çº¢é»‘æ ‘ç›¸å…³æ–¹æ³•è°ƒç”¨å…³ç³».png\"><br>\n å…¶ä¸­è“è‰²çš„æ˜¯çº¢é»‘æ ‘çš„æ–¹æ³•ï¼Œé»„è‰²çš„æ˜¯ HashMap è°ƒç”¨çš„æ–¹æ³•ã€‚</p>\n<h4 id=\"treeifybin\"><a class=\"markdownIt-Anchor\" href=\"#treeifybin\">#</a> treeifyBin</h4>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* å°†é“¾è¡¨è½¬æ¢æˆæ ‘ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">* æ›¿æ¢ç»™å®šhashå€¼çš„ç´¢å¼•å¤„çš„æ¡¶çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¦‚æœè¡¨å¤ªå°(table.lengthå°äº64),å°±è°ƒæ•´å¤§å°.è¿™é‡Œå…¶å®æ˜¯å¯¹hashè¡¨çš„ä¸€ç§ä¼˜åŒ–,é˜²æ­¢å› ä¸ºè¡¨é•¿åº¦å¤ªå°è€Œè½¬æ¢æˆæ ‘,é€ æˆæ€§èƒ½æµªè´¹</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param</span> hash ç”¨äºç¡®å®šæ¡¶çš„ä½ç½®ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">treeifyBin</span><span class=\"params\">(HashMap.Node&lt;K, V&gt;[] tab, <span class=\"keyword\">int</span> hash)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n, index;</span><br><span class=\"line\">    <span class=\"comment\">// é“¾è¡¨çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt; e;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœhashè¡¨ä¸ºç©ºæˆ–è€…hashè¡¨çš„é•¿åº¦å°äºæœ€å°åŒ–çš„æ ‘åŒ–å®¹é‡(64)ï¼Œè¿™æ—¶ä¼šé‡è°ƒæ•´å¤§å°ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">// å°†å®¹é‡æ‰©å¤§ä¸ºåŸæ¥çš„ä¸¤å€ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (tab == <span class=\"keyword\">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY) &#123;</span><br><span class=\"line\">        resize();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        `HashMap.TreeNode&lt;K, V&gt; hd = <span class=\"keyword\">null</span>, tl = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ„å»ºä¸€ä¸ªæ ‘çš„èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; p = replacementTreeNode(e, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœå°¾ä¸ºnull,è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹æ˜¯è¯¥æ¡¶ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ</span></span><br><span class=\"line\">            <span class=\"comment\">// æ‰€ä»¥è¦å°†å…¶èµ‹äºå¤´èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tl == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                hd = p;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å°†è¯¥èŠ‚ç‚¹æ”¾åœ¨å°¾èŠ‚ç‚¹åã€‚</span></span><br><span class=\"line\">                p.prev = tl;</span><br><span class=\"line\">                tl.next = p;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// å½“å‰èŠ‚ç‚¹ä½œä¸ºå°¾èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">            tl = p;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœè¯¥æ¡¶ä¸­æœ‰å…ƒç´ ï¼Œåˆ™è¿›è¡Œæ ‘åŒ–ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab[index] = hd) != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            hd.treeify(tab);</span><br><span class=\"line\">        &#125;`</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å…¶å®å‘¢ï¼Œè¿™ä¸ª <code>treeifyBin</code>  æ–¹æ³•è¿˜æ˜¯åšäº†ä¸€äº›å°†æ¡¶æ ‘åŒ–çš„å‰ç½®æ“ä½œï¼Œç„¶åå°†è£…æœ‰ <code>TreeNode</code>  èŠ‚ç‚¹çš„æ¡¶äº¤ç»™äº† <code>treeify</code>  æ–¹æ³•å»çœŸæ­£çš„è½¬æ¢ä¸ºä¸€æ£µçº¢é»‘æ ‘ã€‚é‚£æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸‹ <code>treeify</code>  æ–¹æ³•ã€‚æ³¨æ„è¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨ <code>HashMap.TreeNode#treeify()</code></p>\n<h5 id=\"treeifyæ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#treeifyæ–¹æ³•\">#</a> treeify () æ–¹æ³•</h5>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Forms tree of the nodes linked from this node.</span></span><br><span class=\"line\"><span class=\"comment\"> * æŠŠè¯¥èŠ‚ç‚¹è¿æ¥çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆä¸€æ£µæ ‘ã€‚(æ ‘åŒ–çš„è¿‡ç¨‹)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">treeify</span><span class=\"params\">(HashMap.Node&lt;K, V&gt;[] tab)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¯¥æ£µæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">    HashMap.TreeNode&lt;K, V&gt; root = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// xæ˜¯éå†çš„æ¯ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (HashMap.TreeNode&lt;K, V&gt; x = <span class=\"keyword\">this</span>, next; x != <span class=\"keyword\">null</span>; x = next) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å­˜ä¸‹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚(æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ)</span></span><br><span class=\"line\">        next = (HashMap.TreeNode&lt;K, V&gt;) x.next;</span><br><span class=\"line\">        x.left = x.right = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">// å¯¹æ ¹èŠ‚ç‚¹å°±è¡Œèµ‹å€¼(æ— çˆ¶èŠ‚ç‚¹,é»‘è‰²)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (root == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            x.parent = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            x.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            root = x;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            K k = x.key;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> h = x.hash;</span><br><span class=\"line\">            Class&lt;?&gt; kc = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (HashMap.TreeNode&lt;K, V&gt; p = root; ; ) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// dir,è´Ÿå€¼å’Œ0ä¸ºå·¦å­æ ‘ï¼Œæ­£å€¼ä¸ºå³å­æ ‘ã€‚</span></span><br><span class=\"line\">                <span class=\"keyword\">int</span> dir, ph;</span><br><span class=\"line\">                K pk = p.key;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/*************åˆ¤æ–­èŠ‚ç‚¹åœ¨å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ -start***************/</span></span><br><span class=\"line\">                <span class=\"comment\">// hä¸ºå½“å‰èŠ‚ç‚¹çš„hashå€¼ã€‚</span></span><br><span class=\"line\">                <span class=\"comment\">// pæ˜¯çˆ¶èŠ‚ç‚¹, phæ˜¯çˆ¶èŠ‚ç‚¹çš„hashå€¼ã€‚</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((ph = p.hash) &gt; h) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// æ”¾åœ¨å·¦å­æ ‘</span></span><br><span class=\"line\">                    dir = -<span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ph &lt; h) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// æ”¾åœ¨åˆå­æ ‘</span></span><br><span class=\"line\">                    dir = <span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//å¦‚æœå½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„hashå€¼ç›¸ç­‰:</span></span><br><span class=\"line\">                <span class=\"comment\">//å¦‚æœèŠ‚ç‚¹çš„keyå®ç°äº†Comparable, æˆ–è€… çˆ¶èŠ‚ç‚¹å’Œå½“å‰èŠ‚ç‚¹çš„keyä¸ºä¸€ä¸ªã€‚</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((kc == <span class=\"keyword\">null</span> &amp;&amp; (kc = comparableClassFor(k)) == <span class=\"keyword\">null</span>) ||</span><br><span class=\"line\">                        (dir = compareComparables(kc, k, pk)) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// kæ˜¯å½“å‰èŠ‚ç‚¹çš„keyï¼Œpkæ˜¯çˆ¶èŠ‚ç‚¹çš„key</span></span><br><span class=\"line\">                    <span class=\"comment\">// æ ¹æ®hashMapå®šä¹‰çš„è§„åˆ™,åˆ¤æ–­å½“å‰èŠ‚ç‚¹åº”è¯¥ä½äºå·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ã€‚</span></span><br><span class=\"line\">                    dir = tieBreakOrder(k, pk);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">/*************åˆ¤æ–­èŠ‚ç‚¹åœ¨å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ -end***************/</span></span><br><span class=\"line\"></span><br><span class=\"line\">                HashMap.TreeNode&lt;K, V&gt; xp = p;</span><br><span class=\"line\">                <span class=\"comment\">// p==null,ä»£è¡¨ç€éå†åˆ°äº†å¶å­èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((p = (dir &lt;= <span class=\"number\">0</span>) ? p.left : p.right) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// xpæ˜¯å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                    x.parent = xp;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (dir &lt;= <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                        xp.left = x;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        xp.right = x;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"comment\">// å¹³è¡¡æ’å…¥çš„çº¢é»‘æ ‘(å®Œæˆæ’å…¥åï¼Œçº¢é»‘æ ‘çš„æ€§è´¨å¯èƒ½è¢«ç ´å,è¿™é‡Œè¿›è¡Œé‡æ–°å¹³è¡¡)</span></span><br><span class=\"line\">                    root = balanceInsertion(root, x);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//ç¡®ä¿çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯æ¡¶çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">    moveRootToFront(tab, root);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>åœ¨è¿™é‡Œå‘¢ï¼Œæœ‰ 3 ä¸ªæ–¹æ³•æ²¡æœ‰ä»”ç»†å»è¯´æ˜ï¼Œåˆ†åˆ«æ˜¯ tieBreakOrder (),balanceInsertion () å’Œ moveRootToFront (tab, root), æ³¨æ„ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•åœ¨ä¸‹é¢çš„ PutTreeVal ä¸­ä¹Ÿæœ‰è°ƒç”¨ã€‚å½“ç„¶åŒ…æ‹¬è°ƒæ•´å¹³è¡¡çš„å·¦æ—‹ (rotateLeft), å³æ—‹ (rotateRight) æ–¹æ³•ã€‚æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹å§ã€‚</p>\n<h5 id=\"balanceinsertionæ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#balanceinsertionæ–¹æ³•\">#</a> balanceInsertion æ–¹æ³•</h5>\n<p>åœ¨è¯´è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œå…ˆæ€»ç»“ä¸‹çº¢é»‘æ ‘å˜æ¢çš„ 5 æ¡è§„åˆ™ã€‚</p>\n<ul>\n<li>è§„åˆ™ 1: çº¢é»‘æ ‘ä¸ºç©ºæ ‘ ==&gt; {<mark>ç›´æ¥æ’å…¥å½“å‰èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ¶‚ä¸ºé»‘è‰²ã€‚</mark>}</li>\n<li>è§„åˆ™ 2: æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰² ==&gt; {<mark>ç›´æ¥æ’å…¥å½“å‰èŠ‚ç‚¹.</mark>}</li>\n<li>è§„åˆ™ 3: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œå¹¶ä¸”å”å”èŠ‚ç‚¹æ˜¯çº¢è‰²ã€‚==&gt; {<mark>çˆ¶èŠ‚ç‚¹æ¶‚é»‘ï¼Œå”å”èŠ‚ç‚¹æ¶‚é»‘ï¼Œç¥–çˆ¶èŠ‚ç‚¹æ¶‚çº¢.</mark>}</li>\n<li>è§„åˆ™ 4: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œå”å”æ˜¯é»‘è‰²ï¼Œå½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘. ==&gt; {<mark>å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä½œä¸ºæ–°çš„å½“å‰èŠ‚ç‚¹ï¼Œä»¥æ–°çš„å½“å‰èŠ‚ç‚¹å·¦æ—‹ã€‚</mark>}</li>\n<li>è§„åˆ™ 5: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œå”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œå½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘. ==&gt; {<mark>çˆ¶èŠ‚ç‚¹å˜ä¸ºé»‘è‰²ï¼Œç¥–çˆ¶èŠ‚ç‚¹å˜ä¸ºçº¢è‰²ï¼Œä»¥ç¥–çˆ¶èŠ‚ç‚¹ä¸ºæ”¯ç‚¹å³æ—‹.</mark>}<br>\n ä¸‹é¢ç»“åˆä»£ç çœ‹ HashMap æ˜¯æ€ä¹ˆå®ç°ä¸Šé¢è¿™ä¸ª 5 ä¸ªè§„åˆ™çš„:</li>\n</ul>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * è°ƒæ•´çº¢é»‘æ ‘</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> root æ ¹èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> x å½“å‰èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> &lt;K, V&gt; HashMap.<span class=\"function\">TreeNode&lt;K, V&gt; <span class=\"title\">balanceInsertion</span><span class=\"params\">(HashMap.TreeNode&lt;K, V&gt; root,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                                        HashMap.TreeNode&lt;K, V&gt; x)</span> </span>&#123;</span><br><span class=\"line\">    x.red = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    <span class=\"comment\">// xp: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹(çˆ¶èŠ‚ç‚¹)</span></span><br><span class=\"line\">    <span class=\"comment\">// xpp: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹(ç¥–çˆ¶èŠ‚ç‚¹)</span></span><br><span class=\"line\">    <span class=\"comment\">// xppl: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘(å”å”èŠ‚ç‚¹)</span></span><br><span class=\"line\">    <span class=\"comment\">// xppr: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘(å”å”èŠ‚ç‚¹)</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (HashMap.TreeNode&lt;K, V&gt; xp, xpp, xppl, xppr; ; ) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// è§„åˆ™1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((xp = x.parent) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            x.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰² æˆ–è€…ç¥–çˆ¶èŠ‚ç‚¹ä¸ºç©º==&gt;è§„åˆ™2</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!xp.red || (xpp = xp.parent) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// çˆ¶èŠ‚ç‚¹æ˜¯å·¦å­æ ‘</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (xp == (xppl = xpp.left)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// çˆ¶èŠ‚ç‚¹æ˜¯å·¦å­æ ‘,ä¸”ç¥–çˆ¶èŠ‚ç‚¹å­˜åœ¨å³å­æ ‘(å”å”èŠ‚ç‚¹ä¸ºå³å­æ ‘)ï¼Œå¹¶ä¸”å”å”ä¸ºçº¢è‰²ã€‚ ==&gt; çˆ¶èŠ‚ç‚¹æ˜¯å³å­æ ‘æ—¶çš„æ€§è´¨1.</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((xppr = xpp.right) != <span class=\"keyword\">null</span> &amp;&amp; xppr.red) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å”å”èŠ‚ç‚¹æ¶‚é»‘</span></span><br><span class=\"line\">                xppr.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">// çˆ¶èŠ‚ç‚¹æ¶‚é»‘</span></span><br><span class=\"line\">                xp.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">// ç¥–çˆ¶èŠ‚ç‚¹æ¶‚çº¢</span></span><br><span class=\"line\">                xpp.red = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                <span class=\"comment\">// ä»¥ç¥–çˆ¶èŠ‚ç‚¹ä¸ºæ–°çš„å½“å‰èŠ‚ç‚¹</span></span><br><span class=\"line\">                x = xpp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// ç¥–çˆ¶èŠ‚ç‚¹æ²¡æœ‰å³å­æ ‘æˆ–è€…æœ‰å³å­æ ‘,é¢œè‰²ä¸ºé»‘è‰²ã€‚</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘==&gt; è§„åˆ™4</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (x == xp.right) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// å·¦æ—‹</span></span><br><span class=\"line\">                    root = rotateLeft(root, x = xp);</span><br><span class=\"line\">                    <span class=\"comment\">// è®¾ç½®ç¥–çˆ¶èŠ‚ç‚¹è¦ä¹ˆä¸ºç©ºè¦ä¹ˆæ˜¯çˆ¶èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                    xpp = (xp = x.parent) == <span class=\"keyword\">null</span> ? <span class=\"keyword\">null</span> : xp.parent;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// è§„åˆ™5</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (xp != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// çˆ¶èŠ‚ç‚¹æ¶‚æˆé»‘è‰²</span></span><br><span class=\"line\">                    <span class=\"comment\">// æ­¤æ—¶xpå¯èƒ½ä¸ºroot.</span></span><br><span class=\"line\">                    xp.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// å¦‚æœxpä¸æ˜¯rootçš„æ—¶å€™ã€‚</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (xpp != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// ç¥–çˆ¶èŠ‚ç‚¹æ¶‚æˆçº¢è‰²,å³æ—‹ã€‚</span></span><br><span class=\"line\">                        xpp.red = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                        root = rotateRight(root, xpp);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// çˆ¶èŠ‚ç‚¹ä¸æ˜¯å·¦å­æ ‘==&gt; çˆ¶èŠ‚ç‚¹æ˜¯å³å­æ ‘ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å”å”èŠ‚ç‚¹(ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘),å”å”ä¸ºçº¢è‰² ==&gt; è§„åˆ™3</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (xppl != <span class=\"keyword\">null</span> &amp;&amp; xppl.red) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// å”å”æ¶‚é»‘</span></span><br><span class=\"line\">                xppl.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">// çˆ¶èŠ‚ç‚¹æ¶‚é»‘</span></span><br><span class=\"line\">                xp.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                <span class=\"comment\">// ç¥–çˆ¶èŠ‚ç‚¹æ¶‚çº¢</span></span><br><span class=\"line\">                xpp.red = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                <span class=\"comment\">// ä»¥ç¥–çˆ¶èŠ‚ç‚¹ä¸ºæ–°çš„å½“å‰èŠ‚ç‚¹</span></span><br><span class=\"line\">                x = xpp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// ç¥–çˆ¶èŠ‚ç‚¹æ²¡æœ‰å³å­æ ‘æˆ–è€…æœ‰å³å­æ ‘,é¢œè‰²ä¸ºé»‘è‰²ã€‚ ==&gt; è§„åˆ™4</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// å½“å‰èŠ‚ç‚¹æ˜¯å·¦å­æ ‘</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (x == xp.left) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// å³æ—‹</span></span><br><span class=\"line\">                    root = rotateRight(root, x = xp);</span><br><span class=\"line\">                    <span class=\"comment\">// è®¾ç½®ç¥–çˆ¶èŠ‚ç‚¹è¦ä¹ˆä¸ºç©ºè¦ä¹ˆæ˜¯çˆ¶èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                    xpp = (xp = x.parent) == <span class=\"keyword\">null</span> ? <span class=\"keyword\">null</span> : xp.parent;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// ==&gt; è§„åˆ™5</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (xp != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    xp.red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// å¦‚æœæœ‰ç¥–çˆ¶</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (xpp != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// ç¥–çˆ¶èŠ‚ç‚¹æ¶‚æˆçº¢è‰²,å³æ—‹ã€‚</span></span><br><span class=\"line\">                        xpp.red = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                        root = rotateLeft(root, xpp);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"rotateleft-å·¦æ—‹\"><a class=\"markdownIt-Anchor\" href=\"#rotateleft-å·¦æ—‹\">#</a> rotateLeft å·¦æ—‹</h5>\n<p>è¿™é‡Œçš„ä»£ç ä¸èƒ½ç”¨è¯­è¨€æè¿°ï¼ŒçœŸçš„æ˜¯åªèƒ½æ„ä¼šä¸èƒ½è¨€ä¼ å•Šã€‚</p>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &lt;K, V&gt; HashMap.<span class=\"function\">TreeNode&lt;K, V&gt; <span class=\"title\">rotateLeft2</span><span class=\"params\">(HashMap.TreeNode&lt;K, V&gt; root, HashMap.TreeNode&lt;K, V&gt; p)</span> </span>&#123;</span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; r, pp, rl;</span><br><span class=\"line\">            <span class=\"comment\">// pæ˜¯çˆ¶èŠ‚ç‚¹</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (p != <span class=\"keyword\">null</span> &amp;&amp; p.right != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// å³å­©å­</span></span><br><span class=\"line\">        r = p.right;</span><br><span class=\"line\">        <span class=\"comment\">// å³å­©å­æœ‰å·¦å­©å­çš„è¯.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (r.left != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å³å­©å­å˜æˆå³å­©å­çš„å·¦å­©å­ã€‚å³rlå˜æˆäº†pçš„å³å­©å­ã€‚</span></span><br><span class=\"line\">            p.right = r.left;</span><br><span class=\"line\">            rl = r.left;</span><br><span class=\"line\">            rl.parent = p;</span><br><span class=\"line\">            <span class=\"comment\">// æ³¨æ„æ­¤æ—¶ræ²¡æœ‰å…³è”ã€‚</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        pp = p.parent;</span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœpæ²¡æœ‰æœ‰çˆ¶èŠ‚ç‚¹çš„è¯ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p.parent == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å°†rçš„çˆ¶èŠ‚ç‚¹ç½®ä¸ºnull</span></span><br><span class=\"line\">            r.parent = p.parent;</span><br><span class=\"line\">            <span class=\"comment\">// é¢œè‰²æ¶‚æˆé»‘è‰²ï¼Œå¹¶ä¸”rå°±æ˜¯æ ¹èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">            (root = r).red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//  å¦‚æœpèŠ‚ç‚¹æœ‰çˆ¶èŠ‚ç‚¹ï¼Œå¹¶ä¸”pæ˜¯å·¦å­æ ‘çš„è¯</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pp.left == p) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å°†ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘ç½®ä¸ºr,</span></span><br><span class=\"line\">            pp.left = r;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å°†ç¥–çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘ç½®ä¸ºr,</span></span><br><span class=\"line\">            pp.right = r;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å°†rå’Œpè¿æ¥èµ·æ¥ã€‚</span></span><br><span class=\"line\">        r.left = p;</span><br><span class=\"line\">        p.parent = r;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ³¨æ„ä¸‹ï¼Œè¿™é‡Œçš„ä»£ç æ˜¯æˆ‘ä¿®æ”¹ä¹‹åï¼ŒJDK çš„æºç çœ‹èµ·æ¥å¾ˆç²¾ç®€ï¼Œç†è§£èµ·æ¥ï¼Œå•§å•§å•§ã€‚</p>\n<p>MD, æ¥å¼ å›¾:</p>\n<p><img data-src=\"/images/JavaSourceCode/HashMap/HashMap07-%E5%B7%A6%E6%97%8B%E7%9A%84%E8%BF%87%E7%A8%8B.png\" alt=\"HashMap07-å·¦æ—‹çš„è¿‡ç¨‹.md\"></p>\n<p>è¿™é‡Œå‡è®¾å³å­©å­æ˜¯æœ‰å·¦å­©å­çš„ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£å°±ç›´æ¥å»æ‰ç»¿è‰²çš„ rl å°±å¥½äº†ã€‚</p>\n<h5 id=\"rotateright\"><a class=\"markdownIt-Anchor\" href=\"#rotateright\">#</a> rotateRight</h5>\n<p>å³æ—‹çš„è¿‡ç¨‹åŒç†:</p>\n<figure class=\"highlight java\"><figcaption><span>&#123;,.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &lt;K, V&gt; HashMap.<span class=\"function\">TreeNode&lt;K, V&gt; <span class=\"title\">rotateRight</span><span class=\"params\">(HashMap.TreeNode&lt;K, V&gt; root,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                                         HashMap.TreeNode&lt;K, V&gt; p)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K, V&gt; l, pp, lr;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (p != <span class=\"keyword\">null</span> &amp;&amp; (l = p.left) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((lr = p.left = l.right) != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            lr.parent = p;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((pp = l.parent = p.parent) == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            (root = l).red = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pp.right == p)</span><br><span class=\"line\">            pp.right = l;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            pp.left = l;</span><br><span class=\"line\">        l.right = p;</span><br><span class=\"line\">        p.parent = l;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™å›¾å•Šï¼Œæœ‰ç©ºå†åšå§ã€‚ä»Šå¤©å¤ªç´¯äº†ã€‚</p>\n<p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•:</p>\n<h5 id=\"moveroottofront\"><a class=\"markdownIt-Anchor\" href=\"#moveroottofront\">#</a> moveRootToFront</h5>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * Ensures that the given root is the first node of its bin.</span></span><br><span class=\"line\"><span class=\"comment\">  * // ç¡®ä¿çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯æ¡¶çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">  * ä¸ºä»€ä¹ˆä¸ç›´æ¥å°†tab[index]==root? æ˜¯ä¸ºäº†æ ‘é‡æ–°è½¬æ¢æˆé“¾è¡¨çš„æ—¶å€™ä½¿ç”¨çš„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> &lt;K, V&gt; <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">moveRootToFront</span><span class=\"params\">(HashMap.Node&lt;K, V&gt;[] tab, HashMap.TreeNode&lt;K, V&gt; root)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (root != <span class=\"keyword\">null</span> &amp;&amp; tab != <span class=\"keyword\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> index = (n - <span class=\"number\">1</span>) &amp; root.hash;</span><br><span class=\"line\">        HashMap.TreeNode&lt;K, V&gt; first = (HashMap.TreeNode&lt;K, V&gt;) tab[index];</span><br><span class=\"line\">        <span class=\"comment\">// åˆ¤æ–­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å’Œrootæ˜¯ä¸æ˜¯ç›¸ç­‰çš„,åˆ¤æ–­çš„æ˜¯åœ°å€ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (root != first) &#123;</span><br><span class=\"line\">            HashMap.Node&lt;K, V&gt; rn;</span><br><span class=\"line\">            tab[index] = root;</span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; rp = root.prev;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((rn = root.next) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// rootçš„åä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡å‘å‰çš„æŒ‡é’ˆæŒ‡å‘rootçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                ((HashMap.TreeNode&lt;K, V&gt;) rn).prev = rp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (rp != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// rootçš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡å‘åçš„æŒ‡é’ˆæŒ‡å‘rootçš„åä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                rp.next = rn;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (first != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‰æŒ‡é’ˆæŒ‡å‘root</span></span><br><span class=\"line\">                first.prev = root;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// rootçš„åå‘æŒ‡é’ˆæŒ‡å‘first</span></span><br><span class=\"line\">            root.next = first;</span><br><span class=\"line\">            <span class=\"comment\">// rootçš„å‰å‘æŒ‡é’ˆç½®ä¸ºnull</span></span><br><span class=\"line\">            root.prev = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// é€’å½’ä¸å˜æ£€æŸ¥</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">assert</span> <span class=\"title\">checkInvariants</span><span class=\"params\">(root)</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"puttreenode\"><a class=\"markdownIt-Anchor\" href=\"#puttreenode\">#</a> putTreeNode</h4>\n<figure class=\"highlight java\"><figcaption><span>&#123;./line-bumbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> HashMap.<span class=\"function\">TreeNode&lt;K, V&gt; <span class=\"title\">putTreeVal</span><span class=\"params\">(HashMap&lt;K, V&gt; map, HashMap.Node&lt;K, V&gt;[] tab,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                                <span class=\"keyword\">int</span> h, K k, V v)</span> </span>&#123;</span><br><span class=\"line\">    Class&lt;?&gt; kc = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> searched = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K, V&gt; root = (parent != <span class=\"keyword\">null</span>) ? root() : <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (HashMap.TreeNode&lt;K, V&gt; p = root; ; ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> dir, ph;</span><br><span class=\"line\">        K pk;</span><br><span class=\"line\">        <span class=\"comment\">/***************åˆ¤æ–­ å·¦å³å­æ ‘ ******************/</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((ph = p.hash) &gt; h) &#123;</span><br><span class=\"line\">            dir = -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ph &lt; h) &#123;</span><br><span class=\"line\">            dir = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((pk = p.key) == k || (k != <span class=\"keyword\">null</span> &amp;&amp; k.equals(pk))) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> p;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((kc == <span class=\"keyword\">null</span> &amp;&amp;</span><br><span class=\"line\">                (kc = comparableClassFor(k)) == <span class=\"keyword\">null</span>) ||</span><br><span class=\"line\">                (dir = compareComparables(kc, k, pk)) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!searched) &#123;</span><br><span class=\"line\">                HashMap.TreeNode&lt;K, V&gt; q, ch;</span><br><span class=\"line\">                searched = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (((ch = p.left) != <span class=\"keyword\">null</span> &amp;&amp;</span><br><span class=\"line\">                        (q = ch.find(h, k, kc)) != <span class=\"keyword\">null</span>) ||</span><br><span class=\"line\">                        ((ch = p.right) != <span class=\"keyword\">null</span> &amp;&amp;</span><br><span class=\"line\">                                (q = ch.find(h, k, kc)) != <span class=\"keyword\">null</span>))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> q;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            dir = tieBreakOrder(k, pk);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/***************åˆ¤æ–­ å·¦å³å­æ ‘ end******************/</span></span><br><span class=\"line\"></span><br><span class=\"line\">        HashMap.TreeNode&lt;K, V&gt; xp = p;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((p = (dir &lt;= <span class=\"number\">0</span>) ? p.left : p.right) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            HashMap.Node&lt;K, V&gt; xpn = xp.next;</span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; x = map.newTreeNode(h, k, v, xpn);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (dir &lt;= <span class=\"number\">0</span>)</span><br><span class=\"line\">                xp.left = x;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                xp.right = x;</span><br><span class=\"line\">            xp.next = x;</span><br><span class=\"line\">            x.parent = x.prev = xp;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (xpn != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                ((HashMap.TreeNode&lt;K, V&gt;) xpn).prev = x;</span><br><span class=\"line\">            <span class=\"comment\">// è¿™é‡Œæ¯”è¾ƒé‡è¦äº†ï¼Œä¸è¿‡æˆ‘ä»¬åœ¨treeifyä¸­å·²ç»è¯´è¿‡äº†ã€‚</span></span><br><span class=\"line\">            moveRootToFront(tab, balanceInsertion(root, x));</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·ï¼ŒHashMap çš„æ–°å¢è¿‡ç¨‹æˆ‘ä»¬å°±å¤„ç†å®Œäº†ã€‚</p>\n<h3 id=\"hashmapåˆ é™¤æ–¹æ³•-hashmapremove\"><a class=\"markdownIt-Anchor\" href=\"#hashmapåˆ é™¤æ–¹æ³•-hashmapremove\">#</a> HashMap åˆ é™¤æ–¹æ³• HashMap#remove ()</h3>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ä»mapä¸­åˆ é™¤æŒ‡å®šçš„key,å¦‚æœkeyå­˜åœ¨çš„è¯</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key key whose mapping is to be removed from the map</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> value å¦‚æœkeyå­˜åœ¨,è¿”å›keyå¯¹åº”çš„Value,å¦‚æœä¸å­˜åœ¨è¿”å›null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = removeNode(hash(key), key, <span class=\"keyword\">null</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>)) == <span class=\"keyword\">null</span> ?</span><br><span class=\"line\">            <span class=\"keyword\">null</span> : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å…¶ä¸­è®¡ç®— hash å€¼çš„æ–¹æ³•è¿˜æ˜¯å’Œä¹‹å‰çš„ä¸€æ ·ã€‚</p>\n<h4 id=\"removenode\"><a class=\"markdownIt-Anchor\" href=\"#removenode\">#</a> removeNode</h4>\n<figure class=\"highlight java\"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Implements Map.remove and related methods.</span></span><br><span class=\"line\"><span class=\"comment\"> * å®ç°Map.removeç›¸å…³çš„æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> hash       hashCode</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key       key</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value     value</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> matchValue å¦‚æœæ˜¯trueï¼Œä»…åœ¨valueç›¸ç­‰çš„æ—¶å€™åˆ é™¤ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> movable   å¦‚æœä¸ºfalseï¼Œåˆ™åœ¨åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ä¸ç§»åŠ¨å…¶ä»–èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> è¿”å›åˆ é™¤çš„èŠ‚ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> HashMap.<span class=\"function\">Node&lt;K, V&gt; <span class=\"title\">removeNode</span><span class=\"params\">(<span class=\"keyword\">int</span> hash, Object key, Object value,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                    <span class=\"keyword\">boolean</span> matchValue, <span class=\"keyword\">boolean</span> movable)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt;[] tab;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt; p;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n, index;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"keyword\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">            (p = tab[index = (n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        HashMap.Node&lt;K, V&gt; node = <span class=\"keyword\">null</span>, e;</span><br><span class=\"line\">        K k;</span><br><span class=\"line\">        V v;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">                ((k = p.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            node = p;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((e = p.next) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> HashMap.TreeNode) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// æ‰¾åˆ°çº¢é»‘æ ‘ä¸­çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">                node = ((HashMap.TreeNode&lt;K, V&gt;) p).getTreeNode(hash, key);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// åˆ é™¤é“¾è¡¨ä¸­çš„èŠ‚ç‚¹1: æŸ¥æ‰¾åˆ°èŠ‚ç‚¹çš„ä½ç½®ã€‚</span></span><br><span class=\"line\">                <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                            ((k = e.key) == key ||</span><br><span class=\"line\">                                    (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class=\"line\">                        node = e;</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    p = e;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// çœŸæ­£çš„å»åˆ é™¤çš„è¿‡ç¨‹ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (node != <span class=\"keyword\">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class=\"line\">                (value != <span class=\"keyword\">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (node <span class=\"keyword\">instanceof</span> HashMap.TreeNode) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// åˆ é™¤çº¢é»‘æ ‘çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">                ((HashMap.TreeNode&lt;K, V&gt;) node).removeTreeNode(<span class=\"keyword\">this</span>, tab, movable);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (node == p) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// æ¡¶ä¸­åªæœ‰å½“å‰çš„èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">                tab[index] = node.next;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// é“¾è¡¨ä¸­èŠ‚ç‚¹çš„åˆ é™¤</span></span><br><span class=\"line\">                p.next = node.next;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// ä¿®æ”¹æ¬¡æ•°+1</span></span><br><span class=\"line\">            ++modCount;</span><br><span class=\"line\">            --size;</span><br><span class=\"line\">            afterNodeRemoval(node);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> node;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿˜æœ‰ä¸€ä¸ªæœ€éš¾ç†è§£çš„æ–¹æ³•è½åœ¨äº†çº¢é»‘æ ‘çš„ç§»é™¤ä¸Šäº†ã€‚</p>\n<h4 id=\"hashmaptreenoderemovetreenode\"><a class=\"markdownIt-Anchor\" href=\"#hashmaptreenoderemovetreenode\">#</a> HashMap#TreeNode#removeTreeNode</h4>\n<p>è¿˜æ˜¯å…ˆçœ‹ä¸‹çº¢é»‘æ ‘çš„åˆ é™¤æ˜¯æ€ä¹ˆå›äº‹ã€‚</p>\n<p>åœ¨åˆ é™¤æ–¹æ³•è°ƒç”¨ä¹‹å‰å¿…é¡»è¦æœ‰å­˜åœ¨çš„ç»™å®šèŠ‚ç‚¹ã€‚<br>\nè¿™æ¯”å…¸å‹çš„çº¢é»‘åˆ é™¤ä»£ç æ›´æ··ä¹±ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½å°†å†…éƒ¨èŠ‚ç‚¹çš„å†…å®¹ä¸å¶å­åç»§äº¤æ¢ï¼Œåè€…ç”±éå†æœŸé—´å¯ç‹¬ç«‹è®¿é—®çš„ â€œä¸‹ä¸€ä¸ªâ€ æŒ‡é’ˆå›ºå®šã€‚ æ‰€ä»¥æˆ‘ä»¬äº¤æ¢æ ‘é“¾æ¥ã€‚ å¦‚æœå½“å‰æ ‘ä¼¼ä¹æœ‰å¤ªå°‘çš„èŠ‚ç‚¹ï¼Œåˆ™çº¢é»‘æ ‘ (bin) å°†è½¬æ¢å›æ™®é€šçš„é“¾è¡¨ (æ™®é€š bin). ï¼ˆæµ‹è¯•ä¼šåœ¨ 2 åˆ° 6 ä¸ªèŠ‚ç‚¹ä¹‹é—´è§¦å‘ï¼Œå…·ä½“å–å†³äºæ ‘ç»“æ„ï¼‰ã€‚<br>\nä¸Šé¢æ˜¯ removeTreeNode æ–¹æ³•çš„è§£é‡Šã€‚è¯´å®è¯ï¼Œæ²¡ç†è§£â€¦</p>\n<p>HashMap çš„åˆ é™¤ä¸åŒäºæ™®é€šçš„çº¢é»‘æ ‘çš„åˆ é™¤ï¼Œå› ä¸ºå®ƒå…¶ä¸­è¿˜ç»´æŠ¤äº†ï¼Œä¸€ä¸ªé“¾è¡¨çš„æŒ‡å‘. HashMap é‡‡ç”¨çš„æ˜¯å°†æ ‘ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œæ¢ä½ï¼Œé¢œè‰²ä¹Ÿè¦è¿›è¡Œäº’æ¢ï¼Œæ¥ä¿è¯çº¢é»‘æ ‘çš„å¹³è¡¡ï¼Œå¹¶ä¸æ”¹å˜äºŒè€…åœ¨é“¾è¡¨ä¸­çš„ä½ç½®ï¼Œäº’æ¢åï¼Œåˆ é™¤èŠ‚ç‚¹æ­¤æ—¶çš„å·¦å­æ ‘æ˜¯ç©ºçš„ï¼Œå°†é—®é¢˜è½¬æ¢æˆäº†å¯¹å·¦å­æ ‘ä¸ºç©ºçš„èŠ‚ç‚¹çš„åˆ é™¤ã€‚</p>\n<p>æœ‰ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼Œåƒä¸‡ä¸è¦å¼„æ··äº†ï¼Œå°±æ˜¯ TreeNode ä¸­è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯è°ï¼Ÿï¼Ÿ</p>\n<p>åˆ é™¤çš„ç­¾åæ˜¯è¿™æ ·çš„: <code> final void removeTreeNode(HashMap&lt;K, V&gt; map, HashMap.Node&lt;K, V&gt;[] tab,boolean movable)</code> , å¹¶æ²¡æœ‰ä¼  TreeNode å•Šï¼Ÿæ˜¯ä¸æ˜¯ï¼Ÿï¼Ÿ</p>\n<p>å¹²å—å‘¢ï¼å¤§å…„å˜šã€‚è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯ï¼šthis å•Šã€‚æˆ‘ä»¬ç°åœ¨èµ°åˆ°äº† TreeNode å†…éƒ¨äº†ï¼ï¼å®ƒæœ¬èº«å°±æ˜¯è¦è¢«åˆ é™¤çš„èŠ‚ç‚¹å•Šã€‚</p>\n<p>å¥½äº†ï¼Œé‚£æˆ‘ç°åœ¨è¦å‘Šè¯‰ä½ ï¼šåˆ é™¤è‡ªå·±ï¼</p>\n<p>HashMap åˆ é™¤çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œå®é™…ä¸Šå°±æ˜¯ TreeNode è‡ªå·±åˆ é™¤è‡ªå·±ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆåˆ çš„å‘¢ï¼Ÿ</p>\n<p>å®ƒåˆ†æˆäº†ä¸‰æ­¥:</p>\n<ul>\n<li>1. å°†åˆ é™¤èŠ‚ç‚¹ä»åŒé“¾å‘é“¾è¡¨ä¸­åˆ é™¤.</li>\n<li>2. å°†åˆ é™¤èŠ‚ç‚¹ä¸å…¶å³å­æ ‘æœ€å°èŠ‚ç‚¹äº’æ¢ï¼Œä¹‹åå¹³è¡¡æ ‘</li>\n<li>3. å°†æ ‘æ ¹èŠ‚ç‚¹ï¼Œç§»åŠ¨åˆ° <code>tab[index]</code>  æŒ‡é’ˆå¤„</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">removeTreeNode</span><span class=\"params\">(HashMap&lt;K, V&gt; map, HashMap.Node&lt;K, V&gt;[] tab,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">                                  <span class=\"keyword\">boolean</span> movable)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ³¨æ„äº†ï¼š è¿™ä¸ªæ—¶å€™è¢«åˆ é™¤çš„èŠ‚ç‚¹æ˜¯è°??</span></span><br><span class=\"line\">        <span class=\"comment\">// æ˜¯this.</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> n;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tab == <span class=\"keyword\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ‰¾åˆ°å¯¹åº”çš„ç´¢å¼•(ç¡®å®šå¯¹åº”æ¡¶çš„ä½ç½®), n æ˜¯å½“å‰è¡¨çš„é•¿åº¦</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> index = (n - <span class=\"number\">1</span>) &amp; hash;</span><br><span class=\"line\">        <span class=\"comment\">// first: ç¬¬ä¸€ä¸ªæ ‘èŠ‚ç‚¹(å½“å‰ä¸ºçˆ¶èŠ‚ç‚¹),rootï¼Œçˆ¶èŠ‚ç‚¹ã€‚rl:</span></span><br><span class=\"line\">        HashMap.TreeNode&lt;K, V&gt; first = (HashMap.TreeNode&lt;K, V&gt;) tab[index], root = first, rl;</span><br><span class=\"line\">        <span class=\"comment\">// succ:ä¸‹ä¸€ä¸ªèŠ‚ç‚¹(é“¾è¡¨çš„æŒ‡å‘)ã€‚pred, å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">        HashMap.TreeNode&lt;K, V&gt; succ = (HashMap.TreeNode&lt;K, V&gt;) next, pred = prev;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pred == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å‰ä¸€ä¸ªä¸ºç©ºæ—¶ï¼Œå³å½“å‰æ¥æ˜¯çˆ¶èŠ‚ç‚¹:(è¢«åˆ é™¤çš„èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹)</span></span><br><span class=\"line\">            tab[index] = first = succ;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¦æµ‹,å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªæ‰§è¡Œå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªã€‚(æ„ä¼š)</span></span><br><span class=\"line\">            pred.next = succ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (succ != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å½“å‰èŠ‚ç‚¹çš„åèŠ‚ç‚¹ä¸ä¸ºnull,åä¸€ä¸ªèŠ‚ç‚¹çš„å‰èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„å‰èŠ‚ç‚¹(æ„ä¼š)</span></span><br><span class=\"line\">            succ.prev = pred;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (first == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœåˆ é™¤å½“å‰èŠ‚ç‚¹ï¼Œè¯¥æ¡¶å˜æˆäº†nullçš„ã€‚å°±ç›´æ¥è¿”å›</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (root.parent != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// é‡ç½®table[index]å¤„ä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">            root = root.root();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// PS: è¯´ç‚¹æ²¡ç”¨ï¼Œ JDKé™¤äº†éƒ¨åˆ†ifelseä¸åŠ æ‹¬å·ä¹‹å¤–ï¼Œ</span></span><br><span class=\"line\">        <span class=\"comment\">// å…¶å®æ¢è¡Œï¼Œè¿˜æ˜¯ç”¨çš„æŒºå¤šçš„ï¼Œçœ‹èµ·æ¥ä¹ŸæŒºèˆ’æœçš„ã€‚</span></span><br><span class=\"line\">        <span class=\"comment\">// å€¼å¾—å€Ÿé‰´</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (root == <span class=\"keyword\">null</span></span><br><span class=\"line\">                || (movable &amp;&amp; (root.right == <span class=\"keyword\">null</span></span><br><span class=\"line\">                || (rl = root.left) == <span class=\"keyword\">null</span></span><br><span class=\"line\">                || rl.left == <span class=\"keyword\">null</span>))) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ ‘å¤ªå°äº†ï¼Œå°†æ ‘è½¬æ¢æˆé“¾è¡¨</span></span><br><span class=\"line\">            tab[index] = first.untreeify(map);  <span class=\"comment\">// too small</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">/*****æ³¨æ„ï¼ï¼ï¼ æ­¤æ—¶å·²ç»ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤äº†, ç¬¬ä¸€æ­¥èµ°å®Œã€‚******/</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// pæ˜¯å¾…åˆ é™¤çš„èŠ‚ç‚¹ï¼Œplå½“å‰èŠ‚ç‚¹çš„å·¦å­©å­èŠ‚ç‚¹,prå½“å‰èŠ‚ç‚¹çš„å³å­©å­èŠ‚ç‚¹,replacement,ç”¨æ¥äº¤æ¢çš„èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">        HashMap.TreeNode&lt;K, V&gt; p = <span class=\"keyword\">this</span>, pl = left, pr = right, replacement;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pl != <span class=\"keyword\">null</span> &amp;&amp; pr != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// sä¸ºå³å­æ ‘çš„æœ€å°çš„èŠ‚ç‚¹,slä¸ºå·¦å­æ ‘(ä¸€ä¸‹äº”è¡Œå’Œæºç ç•¥æœ‰ä¸åŒ)</span></span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; s = pr, sl = s.left;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (sl != <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// find successor</span></span><br><span class=\"line\">                s = sl;</span><br><span class=\"line\">                sl = s.left;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// äº¤æ¢é¢œè‰²</span></span><br><span class=\"line\">            <span class=\"keyword\">boolean</span> c = s.red;</span><br><span class=\"line\">            s.red = p.red;</span><br><span class=\"line\">            p.red = c; <span class=\"comment\">// swap colors</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// äº¤æ¢èŠ‚ç‚¹è¿æ¥</span></span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; sr = s.right;</span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; pp = p.parent;</span><br><span class=\"line\">            <span class=\"comment\">// præ˜¯å½“å‰èŠ‚ç‚¹çš„å³å­©å­èŠ‚ç‚¹</span></span><br><span class=\"line\">            <span class=\"comment\">// sæ˜¯å½“å‰èŠ‚ç‚¹çš„å³å­æ ‘çš„æœ€å°çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">            <span class=\"comment\">// pçš„å³å­æ ‘,åªæœ‰sè¿™ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (s == pr) &#123; <span class=\"comment\">// p was s&#x27;s direct parent</span></span><br><span class=\"line\">                p.parent = s;</span><br><span class=\"line\">                s.right = p;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"comment\">// spï¼š æœ€å°èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class=\"line\">                HashMap.TreeNode&lt;K, V&gt; sp = s.parent;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((p.parent = sp) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (s == sp.left)</span><br><span class=\"line\">                        sp.left = p;</span><br><span class=\"line\">                    <span class=\"keyword\">else</span></span><br><span class=\"line\">                        sp.right = p;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((s.right = pr) != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                    pr.parent = s;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// ç½®nullå­©å­ã€‚</span></span><br><span class=\"line\">            p.left = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((p.right = sr) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                sr.parent = p;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((s.left = pl) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                pl.parent = s;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((s.parent = pp) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                root = s;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p == pp.left) &#123;</span><br><span class=\"line\">                pp.left = s;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                pp.right = s;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// ç¡®å®šè¦äº¤æ¢çš„èŠ‚ç‚¹å®Œæ¯•ï¼Œäº¤æ¢èŠ‚ç‚¹</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sr != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                replacement = sr;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                replacement = p;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pl != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å½“å‰æ ‘åªå«æœ‰å·¦å­æ ‘</span></span><br><span class=\"line\">            replacement = pl;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pr != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å½“å‰æ ‘ï¼Œåªæœ‰åˆå­æ ‘</span></span><br><span class=\"line\">            replacement = pr;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// æ— å­©å­</span></span><br><span class=\"line\">            replacement = p;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (replacement != p) &#123;</span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; pp = replacement.parent = p.parent;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pp == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                root = replacement;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p == pp.left)</span><br><span class=\"line\">                pp.left = replacement;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                pp.right = replacement;</span><br><span class=\"line\">            p.left = p.right = p.parent = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// æ˜¯å¦è¦è¿›è¡Œé‡å¹³è¡¡æ ‘?</span></span><br><span class=\"line\">        HashMap.TreeNode&lt;K, V&gt; r = p.red ? root : balanceDeletion(root, replacement);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// åœ¨å¹³è¡¡ååˆ é™¤è¯¥èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (replacement == p) &#123;  <span class=\"comment\">// detach</span></span><br><span class=\"line\">            HashMap.TreeNode&lt;K, V&gt; pp = p.parent;</span><br><span class=\"line\">            p.parent = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pp != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p == pp.left)</span><br><span class=\"line\">                    pp.left = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p == pp.right)</span><br><span class=\"line\">                    pp.right = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// å‚æ•°moveableæ§åˆ¶æ˜¯å¦åˆ é™¤èŠ‚ç‚¹åç¡®ä¿æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ºé“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (movable) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å°†æ ‘æ ¹èŠ‚ç‚¹ï¼Œç§»åŠ¨åˆ°tab[index]æŒ‡é’ˆå¤„</span></span><br><span class=\"line\">            moveRootToFront(tab, r);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™æ ·å‘¢ï¼Œæ•´ä¸ªåˆ é™¤è¿‡ç¨‹å°±å®Œæˆäº†ã€‚<br>\nç”¨å®˜æ–¹ä¸­çš„è¯ï¼Œæ¯”è¾ƒæ··ä¹±ã€‚å°¤å…¶æ˜¯æ¶‰åŠåˆ°çº¢é»‘æ ‘çš„åˆ é™¤ï¼Œè¿™éƒ¨åˆ†å†…å®¹ã€‚è¿˜æ˜¯éœ€è¦å¥½å¥½æ¶ˆåŒ–ï¼Œæ¶ˆåŒ–çš„ã€‚</p>\n<p>ä¸‹é¢æˆ‘ä»¬è¿˜å‰©ä¸‹ä¸¤ä¸ªå†…å®¹ï¼šä¿®æ”¹å’ŒæŸ¥æ‰¾</p>\n<h3 id=\"hashmapçš„æŸ¥æ‰¾æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#hashmapçš„æŸ¥æ‰¾æ–¹æ³•\">#</a> HashMap çš„æŸ¥æ‰¾æ–¹æ³•</h3>\n<p><code>HashMap</code>  çš„æŸ¥æ‰¾çš„æ–¹æ³•ï¼Œæœ‰ <code>get</code> , <code>getOrDefault</code> . å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å‰è€…ä¸å­˜åœ¨çš„æ—¶å€™è¿”å›çš„æ˜¯ <code>null</code> ï¼Œåè€…è¿”å›çš„å°±æ˜¯ <code>defaultValue</code> .</p>\n<p>å…ˆæ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ ¹æ®æŒ‡å®šçš„keyè¿”å›æ˜ å°„çš„Valueï¼Œå½“æ²¡æœ‰åŒ…å«keyçš„æ˜ å°„æ—¶ï¼Œä¼šè¿”å› null</span></span><br><span class=\"line\"><span class=\"comment\"> * æ›´æ­£å¼çš„æƒ…å†µä¸‹ï¼š å¦‚æœå­˜åœ¨ä¸€ä¸ªkey(K)çš„æ˜ å°„ value (V),ä½¿å¾— key==null?K==null:key.equals(K),</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦‚æœç­‰å¼çš„å€¼ä¸º true, é‚£ä¹ˆè¿”å›V</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦åˆ™è¿”å› null</span></span><br><span class=\"line\"><span class=\"comment\"> * ä¸èƒ½é€šè¿‡ è¿”å›å€¼ä¸ºnull æ¥åˆ¤æ–­æ˜¯å¦å«æœ‰&lt;K,V&gt; æ˜ å°„ï¼Œå› ä¸ºHashMapå…è®¸valueä¸ºnullã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = getNode(hash(key), key)) == <span class=\"keyword\">null</span> ? <span class=\"keyword\">null</span> : e.value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">getOrDefault</span><span class=\"params\">(Object key, V defaultValue)</span> </span>&#123;</span><br><span class=\"line\">    Node&lt;K,V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (e = getNode(hash(key), key)) == <span class=\"keyword\">null</span> ? defaultValue : e.value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè°ƒç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªæ–¹æ³•ï¼Œé¡ºè—¤æ‘¸ç“œï¼Œæˆ‘ä»¬çœ‹è¿™ä¸ª  <code>getNode</code>  æ–¹æ³•.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> HashMap.<span class=\"function\">Node&lt;K, V&gt; <span class=\"title\">getNode</span><span class=\"params\">(<span class=\"keyword\">int</span> hash, Object key)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt;[] tab;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt; first, e;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n;</span><br><span class=\"line\">    K k;</span><br><span class=\"line\">    <span class=\"comment\">// æ•°ç»„ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å¯¹åº”çš„æ¡¶(bin)ä¸ä¸ºnull</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"keyword\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">            (first = tab[(n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// æ£€æŸ¥æ˜¯å¦ä¸ºæ¡¶å†…çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ»¡è¶³</span></span><br><span class=\"line\">        <span class=\"comment\">// ä¸ºä»€ä¹ˆè¦æ£€æµ‹ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥è¿›å…¥å¾ªç¯æˆ–è€…æ ‘èŠ‚ç‚¹çš„æ£€æµ‹ä¸è¡Œå—?</span></span><br><span class=\"line\">        <span class=\"comment\">// å‡è®¾ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ç›®çš„èŠ‚ç‚¹,å¯ä»¥ç›´æ¥è¿”å›ï¼Œå°‘æ‰§è¡Œä¸€æ¬¡ifåˆ¤æ–­ï¼Œæ¥åˆ¤æ–­å…¶æ˜¯æ ‘èŠ‚ç‚¹è¿˜æ˜¯é“¾è¡¨èŠ‚ç‚¹ã€‚</span></span><br><span class=\"line\">        <span class=\"comment\">// å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¾ªç¯ä¹Ÿä¼šå°‘æ‰§è¡Œä¸€æ¬¡,æ ‘èŠ‚ç‚¹çš„éå†ï¼Œä¹Ÿä¼šå°‘éå†ä¸€æ¬¡ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (first.hash == hash &amp;&amp; <span class=\"comment\">// always check first node</span></span><br><span class=\"line\">                ((k = first.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> first;</span><br><span class=\"line\">        <span class=\"comment\">//å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸æ˜¯è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((e = first.next) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœæ˜¯æ ‘èŠ‚ç‚¹</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (first <span class=\"keyword\">instanceof</span> HashMap.TreeNode) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> ((HashMap.TreeNode&lt;K, V&gt;) first).getTreeNode(hash, key);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// å¦‚æœæ˜¯é“¾è¡¨,éå†æŸ¥æ‰¾ã€‚</span></span><br><span class=\"line\">            <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> e;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ç”±äº jdk8 ä¹‹åï¼Œæœ‰ä¸¤ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿˜è¯´è¿‡ï¼Œè¿™ä¸¤ç§èŠ‚ç‚¹æ˜¯  <code>çˆ·å­™</code>  çš„å…³ç³».<br>\n é“¾è¡¨çš„èŠ‚ç‚¹éå†å°±ä¸ç”¨çœ‹äº†ï¼Œæ¯”è¾ƒç®€å•ã€‚æˆ‘ä»¬çœ‹ä¸‹ çº¢é»‘æ ‘çš„èŠ‚ç‚¹çš„æŸ¥æ‰¾:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> HashMap.<span class=\"function\">TreeNode&lt;K, V&gt; <span class=\"title\">getTreeNode</span><span class=\"params\">(<span class=\"keyword\">int</span> h, Object k)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœå½“å‰èŠ‚ç‚¹ä¸æ˜¯æ ¹èŠ‚ç‚¹,æ‰¾åˆ°æ ¹èŠ‚ç‚¹ï¼Œè°ƒç”¨findè¿›è¡ŒæŸ¥æ‰¾,</span></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ˜¯æ ¹èŠ‚ç‚¹ï¼Œè°ƒç”¨findè¿›è¡ŒæŸ¥æ‰¾ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ((parent != <span class=\"keyword\">null</span>) ? root() : <span class=\"keyword\">this</span>).find(h, k, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">* çº¢é»‘æ ‘çš„æŸ¥æ‰¾ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">* ä»æ ¹èŠ‚ç‚¹å¼€å§‹, ç›´æ¥åˆ¤æ–­hashå€¼å³å¯ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">* å¦‚æœhashå€¼ï¼Œå°äºå½“å‰èŠ‚ç‚¹hashå€¼ï¼Œå¯¹å…¶å·¦å­æ ‘è¿›è¡Œéå†ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">* åä¹‹ï¼Œå¯¹å³å­æ ‘è¿›è¡Œéå†ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">* keyå€¼ç›¸ç­‰ç›´æ¥è¿”å›.</span></span><br><span class=\"line\"><span class=\"comment\">* æ³¨æ„: è¿™é‡Œæœ‰å·¦å³å­æ ‘ä¸ºnullçš„æƒ…å†µã€‚</span></span><br><span class=\"line\"><span class=\"comment\">* å¯¹æ¥kå’Œkçš„ç±»è¿›è¡Œæ¯”è¾ƒ,åˆ¤æ–­å…¶è¦éå†çš„æ ‘ä¸ºå·¦å­æ ‘æˆ–è€…å³å­æ ‘ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> HashMap.<span class=\"function\">TreeNode&lt;K, V&gt; <span class=\"title\">find</span><span class=\"params\">(<span class=\"keyword\">int</span> h, Object k, Class&lt;?&gt; kc)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.TreeNode&lt;K, V&gt; p = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> ph, dir;</span><br><span class=\"line\">        K pk;</span><br><span class=\"line\">        HashMap.TreeNode&lt;K, V&gt; pl = p.left, pr = p.right, q;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((ph = p.hash) &gt; h)</span><br><span class=\"line\">            p = pl;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ph &lt; h)</span><br><span class=\"line\">            p = pr;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((pk = p.key) == k || (k != <span class=\"keyword\">null</span> &amp;&amp; k.equals(pk)))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> p;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pl == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            p = pr;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pr == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            p = pl;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((kc != <span class=\"keyword\">null</span> ||</span><br><span class=\"line\">                (kc = comparableClassFor(k)) != <span class=\"keyword\">null</span>) &amp;&amp;</span><br><span class=\"line\">                (dir = compareComparables(kc, k, pk)) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            p = (dir &lt; <span class=\"number\">0</span>) ? pl : pr;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((q = pr.find(h, k, kc)) != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> q;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            p = pl;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (p != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªæŸ¥æ‰¾å…³é”®å› ç´ åœ¨äºåˆ¤æ–­å¯¹å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘è¿›è¡Œé€’å½’éå†åŒ¹é…ã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯çº¢é»‘æ ‘çš„æŸ¥æ‰¾è¿‡ç¨‹äº†ã€‚</p>\n<h3 id=\"hashmapçš„å…¶ä»–å¸¸ç”¨æ–¹æ³•\"><a class=\"markdownIt-Anchor\" href=\"#hashmapçš„å…¶ä»–å¸¸ç”¨æ–¹æ³•\">#</a> HashMap çš„å…¶ä»–å¸¸ç”¨æ–¹æ³•</h3>\n<p>è¿™äº›æ–¹æ³•ä¸­çš„å®ç°ï¼Œæˆ‘ä»¬å¤§éƒ¨åˆ†éƒ½åˆ†äº«è¿‡äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç®€å•çš„çœ‹ä¸‹å…¶æ˜¯å¦‚ä½•è°ƒç”¨çš„å°±å¥½äº†.</p>\n<h4 id=\"hashmapcontainskey-å’Œ-hashmapcontainsvalue\"><a class=\"markdownIt-Anchor\" href=\"#hashmapcontainskey-å’Œ-hashmapcontainsvalue\">#</a>  <code>HashMap.containsKey()</code>  å’Œ  <code>HashMap.containsValue()</code></h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦‚æœMapä¸­åŒ…å«ä¸€ä¸ªæ˜ å°„å…³ç³»,åˆ™è¿”å›true,æ³¨æ„æ˜¯åŒ…å«æ˜ å°„å…³ç³»å°±ä¼šè¿”å›ture.</span></span><br><span class=\"line\"><span class=\"comment\"> * hashMap.put(&quot;1&quot;,null),ä¹Ÿä¼šè¿”å›true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">containsKey</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> getNode(hash(key), key) != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦‚æœå­˜åœ¨æŒ‡å®šçš„Value,å°±ä¼šè¿”å›true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">containsValue</span><span class=\"params\">(Object value)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt;[] tab;</span><br><span class=\"line\">    V v;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœtableçš„é•¿åº¦ä¸ä¸ºç©º</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"keyword\">null</span> &amp;&amp; size &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// éå†æ¯ä¸ªbin</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// éå†binä¸‹çš„æ¯ä¸ªNode</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (HashMap.Node&lt;K, V&gt; e = tab[i]; e != <span class=\"keyword\">null</span>; e = e.next) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((v = e.value) == value ||</span><br><span class=\"line\">                        (value != <span class=\"keyword\">null</span> &amp;&amp; value.equals(v)))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™é‡Œä¸ºä»€ä¹ˆå¯ä»¥é€šè¿‡  <code>.next</code>  çš„æ–¹å¼å»éå†å‘¢ï¼Ÿ<br>\n è¿™ä¸ªä¸»è¦æ˜¯è€ƒè™‘åœ¨è½¬æ¢æˆæ ‘èŠ‚ç‚¹å’Œæ ‘èŠ‚ç‚¹çš„æ–°å¢çš„æ—¶å€™ã€‚ <code>hashMap</code>  åœ¨è¿™ä¸¤ä¸ªæ—¶åˆ»éƒ½å¯¹ <code>HashMap</code>  çš„ <code>next</code>  &quot;æŒ‡é’ˆ&quot; è¿›è¡Œäº†ç»´æŠ¤ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œå°±å¯ä»¥æ˜ç™½äº†ï¼Œä¸ºä»€ä¹ˆæ ‘åŒ–èŠ‚ç‚¹æ—¶å€™è¿˜è¦ç»´æŠ¤ <code>.next</code>  äº†.</p>\n<h4 id=\"hashmapsize\"><a class=\"markdownIt-Anchor\" href=\"#hashmapsize\">#</a>  <code>HashMap.size()</code></h4>\n<p><code>HashMap</code>   çš„  <code>size</code>  å‡½æ•°æœ€ç®€å•äº†ï¼Œå› ä¸º  <code>HashMap</code>  å†…éƒ¨æœ¬æ¥å°±ç»´æŠ¤äº†ä¸€ä¸ª  <code>size</code>  å­—æ®µï¼Œæ¥è®°å½•  <code>HashMap</code>  çš„å…ƒç´ æ•°é‡.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * è¿”å›HashMapçš„æ˜ å°„æ•°é‡</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">size</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"hashmapisempty\"><a class=\"markdownIt-Anchor\" href=\"#hashmapisempty\">#</a>  <code>HashMap.isEmpty()</code></h4>\n<p>HashMap çš„ isEmpty åŒæ ·ç®€å•ï¼ŒåºŸè¯å°‘è¯´ï¼Œçœ‹ä¸‹å®ƒçš„å®ç°</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦‚æœä¸ºæ˜ å°„æ•°é‡ä¸º0çš„æ—¶å€™ï¼Œè¿”å›true</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isEmpty</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> size == <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"hashmapentryset\"><a class=\"markdownIt-Anchor\" href=\"#hashmapentryset\">#</a>  <code>HashMap.entrySet()</code></h4>\n<p>è¿™ä¸ªæ–¹æ³•æ˜¯æˆ‘ä»¬åœ¨éå†çš„æ—¶å€™ï¼Œå¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„å®ç°æœ‰ç‚¹å°å¤æ‚ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * è¿”å›è¿™ä¸ªMapé‡Œæ˜ å°„å…³ç³»çš„ä¸€ä¸ª Set è§†å›¾.</span></span><br><span class=\"line\"><span class=\"comment\"> * ä¿®æ”¹HashMapä¼šå½±å“è¿™ä¸ª Set è§†å›¾, åŒæ ·çš„ï¼Œåœ¨è¿™ä¸ªè§†å›¾é‡Œä¿®æ”¹, ä¹Ÿä¼šå½±å“HashMap</span></span><br><span class=\"line\"><span class=\"comment\"> * å¦‚æœé€šè¿‡å¯¹è§†å›¾çš„è¿­ä»£è¿‡ç¨‹æ¥ä¿®æ”¹HashMap(é™¤äº†è¿­ä»£å™¨è‡ªèº«çš„removeæ–¹æ³•,æˆ–è€…å¯¹è¿­ä»£å™¨è¿”å›çš„Entryçš„setValueæ“ä½œ),</span></span><br><span class=\"line\"><span class=\"comment\"> * ä¿®æ”¹çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> * è¿™ä¸ª set è§†å›¾, æ”¯æŒå…ƒç´ çš„åˆ é™¤, ä¹Ÿä¼šä» HashMap ä¸­åˆ é™¤å¯¹åº”çš„å…ƒç´ .</span></span><br><span class=\"line\"><span class=\"comment\"> *  æ”¯æŒ Iterator.remove, Set.remove,  Set.removeAll, Set.retainAll, Set.clear ç­‰æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"> * ä½†æ˜¯å®ƒä¸æ”¯æŒ add, addAll æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet() &#123;</span><br><span class=\"line\">    Set&lt;Map.Entry&lt;K, V&gt;&gt; es;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (es = entrySet) == <span class=\"keyword\">null</span> ? (entrySet = <span class=\"keyword\">new</span> HashMap.EntrySet()) : es;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ <code>entrySet</code>  è¿™ä¸ªå±æ€§çš„ä¸º <code>null</code>  çš„æ—¶å€™ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªç©ºçš„ <code>HashMap</code>  çš„ <code>entry</code> , å¦åˆ™å°±è¿”å› <code>entrySet(es)</code> .<br>\n é‚£ä¹ˆ  <code>entrySet</code>  è¿™ä¸ªå­—æ®µæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ</p>\n<p>æœ€å…ˆ HashMap å®šä¹‰äº†ä¸€ä¸ªè¿™æ ·çš„å­—æ®µã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * ä¿å­˜ç¼“å­˜çš„ entrySet().</span></span><br><span class=\"line\"><span class=\"comment\"> * æ³¨æ„: è¿™ä¸ªAbstractMap çš„å­—æ®µä¼šè¢« keySet() å’Œ values()ä½¿ç”¨ã€‚</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet;</span><br></pre></td></tr></table></figure>\n<p>å¥½äº†ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹  <code>HashMap.EntrySet()</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * EntrySet ç»§æ‰¿çš„æ˜¯ AbstractSet,</span></span><br><span class=\"line\"><span class=\"comment\">    * æ³›å‹ä¼ å…¥</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EntrySet</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractSet</span>&lt;<span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>, <span class=\"title\">V</span>&gt;&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">size</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> size;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        HashMap.<span class=\"keyword\">this</span>.clear();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * ç›´æ¥è°ƒç”¨ HashMap è¿­ä»£å™¨</span></span><br><span class=\"line\"><span class=\"comment\">        *</span></span><br><span class=\"line\"><span class=\"comment\">        * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Iterator&lt;Map.Entry&lt;K, V&gt;&gt; iterator() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> HashMap.EntryIterator();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * åˆ¤æ–­æ˜¯å¦å­˜åœ¨,</span></span><br><span class=\"line\"><span class=\"comment\">        * ç›´æ¥è°ƒç”¨çš„æ˜¯hashMapçš„getNodeæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">contains</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!(o <span class=\"keyword\">instanceof</span> Map.Entry))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        Map.Entry&lt;?, ?&gt; e = (Map.Entry&lt;?, ?&gt;) o;</span><br><span class=\"line\">        Object key = e.getKey();</span><br><span class=\"line\">        HashMap.Node&lt;K, V&gt; candidate = getNode(hash(key), key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> candidate != <span class=\"keyword\">null</span> &amp;&amp; candidate.equals(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * ç›´æ¥è°ƒç”¨çš„ HashMapçš„åˆ é™¤æ–¹æ³•.</span></span><br><span class=\"line\"><span class=\"comment\">        * ä»è¿™ä¸ªæ–¹æ³•ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥, æˆ‘ä»¬åœ¨ setè¯•å›¾ä¸­åˆ é™¤å…ƒç´ æ˜¯ä¼šç›´æ¥å½±å“Hashmapçš„ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">remove</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (o <span class=\"keyword\">instanceof</span> Map.Entry) &#123;</span><br><span class=\"line\">            Map.Entry&lt;?, ?&gt; e = (Map.Entry&lt;?, ?&gt;) o;</span><br><span class=\"line\">            Object key = e.getKey();</span><br><span class=\"line\">            Object value = e.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> removeNode(hash(key), key, value, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>) != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * entrySet çš„åˆ†éš”å™¨</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Spliterator&lt;Map.Entry&lt;K, V&gt;&gt; spliterator() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> HashMap.EntrySpliterator&lt;&gt;(HashMap.<span class=\"keyword\">this</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * entrySet çš„è¿­ä»£å™¨</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"keyword\">super</span> Map.Entry&lt;K, V&gt;&gt; action)</span> </span>&#123;</span><br><span class=\"line\">        HashMap.Node&lt;K, V&gt;[] tab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (action == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> mc = modCount;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (HashMap.Node&lt;K, V&gt; e = tab[i]; e != <span class=\"keyword\">null</span>; e = e.next)</span><br><span class=\"line\">                    action.accept(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ConcurrentModificationException();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"hashmapreplace\"><a class=\"markdownIt-Anchor\" href=\"#hashmapreplace\">#</a>  <code>HashMap.replace()</code></h4>\n<p>è¿™ä¸ªæ˜¯  <code>HashMap</code>  è¦†ç›–æ‰ <code>JDK8</code>  ç‰ˆæœ¬ä¸­ çš„æ›¿æ¢æ–¹æ³•ï¼Œå°†åˆ¶å®šçš„ <code>K-V</code>  æ˜ å°„æ›¿æ¢æ‰ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šåŒ¹é… <code>Value</code>  çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">replace</span><span class=\"params\">(K key, V oldValue, V newValue)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt; e;</span><br><span class=\"line\">    V v;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) != <span class=\"keyword\">null</span> &amp;&amp;</span><br><span class=\"line\">            ((v = e.value) == oldValue || (v != <span class=\"keyword\">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</span><br><span class=\"line\">        e.value = newValue;</span><br><span class=\"line\">        afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªä¹Ÿæ˜¯è¦†ç›–  <code>JDK8</code>  ç‰ˆæœ¬ä¸­  <code>Map</code>  çš„æ–¹æ³•ï¼Œè¿”å›åŸæ¥çš„å€¼ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">replace</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt; e;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((e = getNode(hash(key), key)) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        V oldValue = e.value;</span><br><span class=\"line\">        e.value = value;</span><br><span class=\"line\">        afterNodeAccess(e);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"hashmapforeach\"><a class=\"markdownIt-Anchor\" href=\"#hashmapforeach\">#</a>  <code>HashMap.forEach()</code></h4>\n<p>è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œå®ç°ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">forEach</span><span class=\"params\">(BiConsumer&lt;? <span class=\"keyword\">super</span> K, ? <span class=\"keyword\">super</span> V&gt; action)</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt;[] tab;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (action == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (size &gt; <span class=\"number\">0</span> &amp;&amp; (tab = table) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> mc = modCount;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; tab.length; ++i) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (HashMap.Node&lt;K, V&gt; e = tab[i]; e != <span class=\"keyword\">null</span>; e = e.next)</span><br><span class=\"line\">                action.accept(e.key, e.value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (modCount != mc)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ConcurrentModificationException();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"hashmapclear\"><a class=\"markdownIt-Anchor\" href=\"#hashmapclear\">#</a>  <code>HashMap.clear()</code></h4>\n<p>æ¸…ç©ºæ–¹æ³•ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼Œé€ä¸€ç½®ç©º <code>null</code>   <code>HashMap</code>  çš„æ¯ä¸ª <code>bin</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    HashMap.Node&lt;K, V&gt;[] tab;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((tab = table) != <span class=\"keyword\">null</span> &amp;&amp; size &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        size = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; tab.length; ++i)</span><br><span class=\"line\">            tab[i] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"é—®é¢˜è§£ç­”\"><a class=\"markdownIt-Anchor\" href=\"#é—®é¢˜è§£ç­”\">#</a> é—®é¢˜è§£ç­”</h2>\n<ul>\n<li>å¦‚æœæˆ‘çš„ HashMap çš„åˆå§‹å¤§å°è®¾ç½®ä¸º <code>[3|9|12]</code> , ç¬¬ä¸€æ¬¡æ‰©å®¹çš„æ—¶å€™ï¼Œå®¹é‡å˜ä¸ºäº†å¤šå°‘ï¼Ÿæ˜¯å¦‚ä½•è¿›è¡Œæ‰©å®¹çš„ï¼Ÿ</li>\n<li>(æœ‰æ¯’çš„é—®é¢˜) å‡è®¾ Hash è¡¨çš„é•¿åº¦æ˜¯ 32, å·²çŸ¥æŸä¸€ä¸ª bin ä¸­çš„é“¾è¡¨é•¿åº¦ä¸º 7, å¦‚æœæ–°å¢ä¸€ä¸ªå…ƒç´ è¿˜æ˜¯åœ¨è¯¥ bin ä¸­çš„æ—¶ï¼Œä¼šè¿›è¡Œä»€ä¹ˆæ“ä½œï¼Ÿ  <code>resize</code>  è¿˜æ˜¯ <code>treeifyBin</code> ? å‡è®¾å®Œæˆè¿™ä¸ªæ“ä½œåè¯¥ bin ä¸­å…ƒç´ æ•°é‡æ²¡å˜ï¼Œåˆæ–°å¢ä¸€ä¸ªå…ƒç´ è¿˜æ˜¯åˆ°è¯¥ bin ä¸­ï¼Œè¿™æ—¶è¿›è¡Œä»€ä¹ˆæ“ä½œï¼Ÿ</li>\n</ul>\n<h2 id=\"æ€»ç»“\"><a class=\"markdownIt-Anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<ul>\n<li>è¡¨ä¸­å…è®¸ null çš„é”®å’Œ null å€¼ã€‚</li>\n<li>çº¿ç¨‹ä¸åŒæ­¥ï¼Œ</li>\n<li>ä¸ä¿è¯å…ƒç´ çš„é¡ºåºã€‚</li>\n</ul>\n<h2 id=\"ç½‘ä¸Šå¸¸è§é¢è¯•é—®é¢˜æ±‡æ€»ä»¥åŠå‚è€ƒè§£ç­”\"><a class=\"markdownIt-Anchor\" href=\"#ç½‘ä¸Šå¸¸è§é¢è¯•é—®é¢˜æ±‡æ€»ä»¥åŠå‚è€ƒè§£ç­”\">#</a> ç½‘ä¸Šå¸¸è§é¢è¯•é—®é¢˜æ±‡æ€»ä»¥åŠå‚è€ƒè§£ç­”</h2>\n<h2 id=\"å†·é—¨çŸ¥è¯†ç‚¹\"><a class=\"markdownIt-Anchor\" href=\"#å†·é—¨çŸ¥è¯†ç‚¹\">#</a> å†·é—¨çŸ¥è¯†ç‚¹</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"cbx_4\" disabled=\"true\"><label for=\"cbx_4\"> failFast æœºåˆ¶ã€‚</label></li>\n</ul>\n<h2 id=\"jdkå˜æ›´å†å²è¯´æ˜\"><a class=\"markdownIt-Anchor\" href=\"#jdkå˜æ›´å†å²è¯´æ˜\">#</a> JDK å˜æ›´å†å²è¯´æ˜</h2>\n<h2 id=\"è¯¾åå¨±ä¹\"><a class=\"markdownIt-Anchor\" href=\"#è¯¾åå¨±ä¹\">#</a> è¯¾åå¨±ä¹</h2>\n<ul>\n<li>java å®ç°çº¢é»‘æ ‘</li>\n<li>è‡ªå®šä¹‰å®ç° hashMapã€‚</li>\n</ul>\n<h2 id=\"å‚è€ƒæ–‡æ¡£ç­”è°¢\"><a class=\"markdownIt-Anchor\" href=\"#å‚è€ƒæ–‡æ¡£ç­”è°¢\">#</a> å‚è€ƒæ–‡æ¡£ &amp; ç­”è°¢</h2>\n<h2 id=\"æ„Ÿå—\"><a class=\"markdownIt-Anchor\" href=\"#æ„Ÿå—\">#</a> æ„Ÿå—</h2>\n<ul>\n<li>æ³¨é‡Šï¼šæ–°å­—æ®µè¦åŠ æ³¨é‡Šæ ‡æ³¨æ­¤å­—æ®µçš„ä½œç”¨ï¼Œè¯¥å­—æ®µæ˜¯ä»€ä¹ˆå«ä¹‰ã€‚</li>\n</ul>\n<hr>\n<p>é˜…è¯»ä¹‹å‰è®°å½•</p>\n<p>1. å›¾è§£ã€‚é‡åˆ°é—®é¢˜ï¼Œç”»å›¾è¯´æ˜ã€‚<br>\n2. ä¸€å®šè¦æœ‰è‡ªå·±çš„ç†è§£ã€‚<br>\n3. å¯¹æ¯”å…¶ä»–ç‰ˆæœ¬ JDKã€‚</p>\n<h3 id=\"æœ€å\"><a class=\"markdownIt-Anchor\" href=\"#æœ€å\">#</a> æœ€å</h3>\n<p>æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±</p>\n<p><img data-src=\"/images/qrcode.jpg\" alt=\"æœŸæœ›ä¸ä½ ä¸€èµ·é‡è§æ›´å¥½çš„è‡ªå·±\"></p>\n",
            "tags": [
                "æºç ",
                "HashMap",
                "JDK",
                "JDK8"
            ]
        }
    ]
}